(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const nt of document.querySelectorAll('link[rel="modulepreload"]'))d(nt);new MutationObserver(nt=>{for(const at of nt)if(at.type==="childList")for(const ht of at.addedNodes)ht.tagName==="LINK"&&ht.rel==="modulepreload"&&d(ht)}).observe(document,{childList:!0,subtree:!0});function j(nt){const at={};return nt.integrity&&(at.integrity=nt.integrity),nt.referrerPolicy&&(at.referrerPolicy=nt.referrerPolicy),nt.crossOrigin==="use-credentials"?at.credentials="include":nt.crossOrigin==="anonymous"?at.credentials="omit":at.credentials="same-origin",at}function d(nt){if(nt.ep)return;nt.ep=!0;const at=j(nt);fetch(nt.href,at)}})();function getDefaultExportFromCjs(b){return b&&b.__esModule&&Object.prototype.hasOwnProperty.call(b,"default")?b.default:b}var react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l=Symbol.for("react.element"),n=Symbol.for("react.portal"),p$1=Symbol.for("react.fragment"),q=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),t=Symbol.for("react.provider"),u=Symbol.for("react.context"),v$1=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),z$1=Symbol.iterator;function A$1(b){return b===null||typeof b!="object"?null:(b=z$1&&b[z$1]||b["@@iterator"],typeof b=="function"?b:null)}var B$1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$1=Object.assign,D$1={};function E$1(b,g,j){this.props=b,this.context=g,this.refs=D$1,this.updater=j||B$1}E$1.prototype.isReactComponent={};E$1.prototype.setState=function(b,g){if(typeof b!="object"&&typeof b!="function"&&b!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,b,g,"setState")};E$1.prototype.forceUpdate=function(b){this.updater.enqueueForceUpdate(this,b,"forceUpdate")};function F(){}F.prototype=E$1.prototype;function G$1(b,g,j){this.props=b,this.context=g,this.refs=D$1,this.updater=j||B$1}var H$1=G$1.prototype=new F;H$1.constructor=G$1;C$1(H$1,E$1.prototype);H$1.isPureReactComponent=!0;var I$1=Array.isArray,J=Object.prototype.hasOwnProperty,K$1={current:null},L$1={key:!0,ref:!0,__self:!0,__source:!0};function M$1(b,g,j){var d,nt={},at=null,ht=null;if(g!=null)for(d in g.ref!==void 0&&(ht=g.ref),g.key!==void 0&&(at=""+g.key),g)J.call(g,d)&&!L$1.hasOwnProperty(d)&&(nt[d]=g[d]);var _t=arguments.length-2;if(_t===1)nt.children=j;else if(1<_t){for(var bt=Array(_t),kt=0;kt<_t;kt++)bt[kt]=arguments[kt+2];nt.children=bt}if(b&&b.defaultProps)for(d in _t=b.defaultProps,_t)nt[d]===void 0&&(nt[d]=_t[d]);return{$$typeof:l,type:b,key:at,ref:ht,props:nt,_owner:K$1.current}}function N$1(b,g){return{$$typeof:l,type:b.type,key:g,ref:b.ref,props:b.props,_owner:b._owner}}function O$1(b){return typeof b=="object"&&b!==null&&b.$$typeof===l}function escape$1(b){var g={"=":"=0",":":"=2"};return"$"+b.replace(/[=:]/g,function(j){return g[j]})}var P$1=/\/+/g;function Q$1(b,g){return typeof b=="object"&&b!==null&&b.key!=null?escape$1(""+b.key):g.toString(36)}function R$1(b,g,j,d,nt){var at=typeof b;(at==="undefined"||at==="boolean")&&(b=null);var ht=!1;if(b===null)ht=!0;else switch(at){case"string":case"number":ht=!0;break;case"object":switch(b.$$typeof){case l:case n:ht=!0}}if(ht)return ht=b,nt=nt(ht),b=d===""?"."+Q$1(ht,0):d,I$1(nt)?(j="",b!=null&&(j=b.replace(P$1,"$&/")+"/"),R$1(nt,g,j,"",function(kt){return kt})):nt!=null&&(O$1(nt)&&(nt=N$1(nt,j+(!nt.key||ht&&ht.key===nt.key?"":(""+nt.key).replace(P$1,"$&/")+"/")+b)),g.push(nt)),1;if(ht=0,d=d===""?".":d+":",I$1(b))for(var _t=0;_t<b.length;_t++){at=b[_t];var bt=d+Q$1(at,_t);ht+=R$1(at,g,j,bt,nt)}else if(bt=A$1(b),typeof bt=="function")for(b=bt.call(b),_t=0;!(at=b.next()).done;)at=at.value,bt=d+Q$1(at,_t++),ht+=R$1(at,g,j,bt,nt);else if(at==="object")throw g=String(b),Error("Objects are not valid as a React child (found: "+(g==="[object Object]"?"object with keys {"+Object.keys(b).join(", ")+"}":g)+"). If you meant to render a collection of children, use an array instead.");return ht}function S$1(b,g,j){if(b==null)return b;var d=[],nt=0;return R$1(b,d,"","",function(at){return g.call(j,at,nt++)}),d}function T$1(b){if(b._status===-1){var g=b._result;g=g(),g.then(function(j){(b._status===0||b._status===-1)&&(b._status=1,b._result=j)},function(j){(b._status===0||b._status===-1)&&(b._status=2,b._result=j)}),b._status===-1&&(b._status=0,b._result=g)}if(b._status===1)return b._result.default;throw b._result}var U$1={current:null},V$1={transition:null},W$1={ReactCurrentDispatcher:U$1,ReactCurrentBatchConfig:V$1,ReactCurrentOwner:K$1};react_production_min.Children={map:S$1,forEach:function(b,g,j){S$1(b,function(){g.apply(this,arguments)},j)},count:function(b){var g=0;return S$1(b,function(){g++}),g},toArray:function(b){return S$1(b,function(g){return g})||[]},only:function(b){if(!O$1(b))throw Error("React.Children.only expected to receive a single React element child.");return b}};react_production_min.Component=E$1;react_production_min.Fragment=p$1;react_production_min.Profiler=r;react_production_min.PureComponent=G$1;react_production_min.StrictMode=q;react_production_min.Suspense=w;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$1;react_production_min.cloneElement=function(b,g,j){if(b==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+b+".");var d=C$1({},b.props),nt=b.key,at=b.ref,ht=b._owner;if(g!=null){if(g.ref!==void 0&&(at=g.ref,ht=K$1.current),g.key!==void 0&&(nt=""+g.key),b.type&&b.type.defaultProps)var _t=b.type.defaultProps;for(bt in g)J.call(g,bt)&&!L$1.hasOwnProperty(bt)&&(d[bt]=g[bt]===void 0&&_t!==void 0?_t[bt]:g[bt])}var bt=arguments.length-2;if(bt===1)d.children=j;else if(1<bt){_t=Array(bt);for(var kt=0;kt<bt;kt++)_t[kt]=arguments[kt+2];d.children=_t}return{$$typeof:l,type:b.type,key:nt,ref:at,props:d,_owner:ht}};react_production_min.createContext=function(b){return b={$$typeof:u,_currentValue:b,_currentValue2:b,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},b.Provider={$$typeof:t,_context:b},b.Consumer=b};react_production_min.createElement=M$1;react_production_min.createFactory=function(b){var g=M$1.bind(null,b);return g.type=b,g};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(b){return{$$typeof:v$1,render:b}};react_production_min.isValidElement=O$1;react_production_min.lazy=function(b){return{$$typeof:y,_payload:{_status:-1,_result:b},_init:T$1}};react_production_min.memo=function(b,g){return{$$typeof:x,type:b,compare:g===void 0?null:g}};react_production_min.startTransition=function(b){var g=V$1.transition;V$1.transition={};try{b()}finally{V$1.transition=g}};react_production_min.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};react_production_min.useCallback=function(b,g){return U$1.current.useCallback(b,g)};react_production_min.useContext=function(b){return U$1.current.useContext(b)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(b){return U$1.current.useDeferredValue(b)};react_production_min.useEffect=function(b,g){return U$1.current.useEffect(b,g)};react_production_min.useId=function(){return U$1.current.useId()};react_production_min.useImperativeHandle=function(b,g,j){return U$1.current.useImperativeHandle(b,g,j)};react_production_min.useInsertionEffect=function(b,g){return U$1.current.useInsertionEffect(b,g)};react_production_min.useLayoutEffect=function(b,g){return U$1.current.useLayoutEffect(b,g)};react_production_min.useMemo=function(b,g){return U$1.current.useMemo(b,g)};react_production_min.useReducer=function(b,g,j){return U$1.current.useReducer(b,g,j)};react_production_min.useRef=function(b){return U$1.current.useRef(b)};react_production_min.useState=function(b){return U$1.current.useState(b)};react_production_min.useSyncExternalStore=function(b,g,j){return U$1.current.useSyncExternalStore(b,g,j)};react_production_min.useTransition=function(){return U$1.current.useTransition()};react_production_min.version="18.2.0";react.exports=react_production_min;var reactExports=react.exports;const React=getDefaultExportFromCjs(reactExports);var client={},reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(b){function g(zn,Yn){var sn=zn.length;zn.push(Yn);e:for(;0<sn;){var qn=sn-1>>>1,Kn=zn[qn];if(0<nt(Kn,Yn))zn[qn]=Yn,zn[sn]=Kn,sn=qn;else break e}}function j(zn){return zn.length===0?null:zn[0]}function d(zn){if(zn.length===0)return null;var Yn=zn[0],sn=zn.pop();if(sn!==Yn){zn[0]=sn;e:for(var qn=0,Kn=zn.length,wr=Kn>>>1;qn<wr;){var Gn=2*(qn+1)-1,rn=zn[Gn],dn=Gn+1,kn=zn[dn];if(0>nt(rn,sn))dn<Kn&&0>nt(kn,rn)?(zn[qn]=kn,zn[dn]=sn,qn=dn):(zn[qn]=rn,zn[Gn]=sn,qn=Gn);else if(dn<Kn&&0>nt(kn,sn))zn[qn]=kn,zn[dn]=sn,qn=dn;else break e}}return Yn}function nt(zn,Yn){var sn=zn.sortIndex-Yn.sortIndex;return sn!==0?sn:zn.id-Yn.id}if(typeof performance=="object"&&typeof performance.now=="function"){var at=performance;b.unstable_now=function(){return at.now()}}else{var ht=Date,_t=ht.now();b.unstable_now=function(){return ht.now()-_t}}var bt=[],kt=[],Vt=1,qt=null,zt=3,jt=!1,Kt=!1,Ft=!1,nn=typeof setTimeout=="function"?setTimeout:null,Lt=typeof clearTimeout=="function"?clearTimeout:null,Nt=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Ht(zn){for(var Yn=j(kt);Yn!==null;){if(Yn.callback===null)d(kt);else if(Yn.startTime<=zn)d(kt),Yn.sortIndex=Yn.expirationTime,g(bt,Yn);else break;Yn=j(kt)}}function on(zn){if(Ft=!1,Ht(zn),!Kt)if(j(bt)!==null)Kt=!0,nr(en);else{var Yn=j(kt);Yn!==null&&hr(on,Yn.startTime-zn)}}function en(zn,Yn){Kt=!1,Ft&&(Ft=!1,Lt(Gt),Gt=-1),jt=!0;var sn=zt;try{for(Ht(Yn),qt=j(bt);qt!==null&&(!(qt.expirationTime>Yn)||zn&&!hn());){var qn=qt.callback;if(typeof qn=="function"){qt.callback=null,zt=qt.priorityLevel;var Kn=qn(qt.expirationTime<=Yn);Yn=b.unstable_now(),typeof Kn=="function"?qt.callback=Kn:qt===j(bt)&&d(bt),Ht(Yn)}else d(bt);qt=j(bt)}if(qt!==null)var wr=!0;else{var Gn=j(kt);Gn!==null&&hr(on,Gn.startTime-Yn),wr=!1}return wr}finally{qt=null,zt=sn,jt=!1}}var cn=!1,Ut=null,Gt=-1,$t=5,un=-1;function hn(){return!(b.unstable_now()-un<$t)}function Bn(){if(Ut!==null){var zn=b.unstable_now();un=zn;var Yn=!0;try{Yn=Ut(!0,zn)}finally{Yn?ar():(cn=!1,Ut=null)}}else cn=!1}var ar;if(typeof Nt=="function")ar=function(){Nt(Bn)};else if(typeof MessageChannel<"u"){var sr=new MessageChannel,ur=sr.port2;sr.port1.onmessage=Bn,ar=function(){ur.postMessage(null)}}else ar=function(){nn(Bn,0)};function nr(zn){Ut=zn,cn||(cn=!0,ar())}function hr(zn,Yn){Gt=nn(function(){zn(b.unstable_now())},Yn)}b.unstable_IdlePriority=5,b.unstable_ImmediatePriority=1,b.unstable_LowPriority=4,b.unstable_NormalPriority=3,b.unstable_Profiling=null,b.unstable_UserBlockingPriority=2,b.unstable_cancelCallback=function(zn){zn.callback=null},b.unstable_continueExecution=function(){Kt||jt||(Kt=!0,nr(en))},b.unstable_forceFrameRate=function(zn){0>zn||125<zn?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):$t=0<zn?Math.floor(1e3/zn):5},b.unstable_getCurrentPriorityLevel=function(){return zt},b.unstable_getFirstCallbackNode=function(){return j(bt)},b.unstable_next=function(zn){switch(zt){case 1:case 2:case 3:var Yn=3;break;default:Yn=zt}var sn=zt;zt=Yn;try{return zn()}finally{zt=sn}},b.unstable_pauseExecution=function(){},b.unstable_requestPaint=function(){},b.unstable_runWithPriority=function(zn,Yn){switch(zn){case 1:case 2:case 3:case 4:case 5:break;default:zn=3}var sn=zt;zt=zn;try{return Yn()}finally{zt=sn}},b.unstable_scheduleCallback=function(zn,Yn,sn){var qn=b.unstable_now();switch(typeof sn=="object"&&sn!==null?(sn=sn.delay,sn=typeof sn=="number"&&0<sn?qn+sn:qn):sn=qn,zn){case 1:var Kn=-1;break;case 2:Kn=250;break;case 5:Kn=1073741823;break;case 4:Kn=1e4;break;default:Kn=5e3}return Kn=sn+Kn,zn={id:Vt++,callback:Yn,priorityLevel:zn,startTime:sn,expirationTime:Kn,sortIndex:-1},sn>qn?(zn.sortIndex=sn,g(kt,zn),j(bt)===null&&zn===j(kt)&&(Ft?(Lt(Gt),Gt=-1):Ft=!0,hr(on,sn-qn))):(zn.sortIndex=Kn,g(bt,zn),Kt||jt||(Kt=!0,nr(en))),zn},b.unstable_shouldYield=hn,b.unstable_wrapCallback=function(zn){var Yn=zt;return function(){var sn=zt;zt=Yn;try{return zn.apply(this,arguments)}finally{zt=sn}}}})(scheduler_production_min);scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p(b){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+b,j=1;j<arguments.length;j++)g+="&args[]="+encodeURIComponent(arguments[j]);return"Minified React error #"+b+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(b,g){ha(b,g),ha(b+"Capture",g)}function ha(b,g){for(ea[b]=g,b=0;b<g.length;b++)da.add(g[b])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(b){return ja.call(ma,b)?!0:ja.call(la,b)?!1:ka.test(b)?ma[b]=!0:(la[b]=!0,!1)}function pa(b,g,j,d){if(j!==null&&j.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return d?!1:j!==null?!j.acceptsBooleans:(b=b.toLowerCase().slice(0,5),b!=="data-"&&b!=="aria-");default:return!1}}function qa(b,g,j,d){if(g===null||typeof g>"u"||pa(b,g,j,d))return!0;if(d)return!1;if(j!==null)switch(j.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function v(b,g,j,d,nt,at,ht){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=d,this.attributeNamespace=nt,this.mustUseProperty=j,this.propertyName=b,this.type=g,this.sanitizeURL=at,this.removeEmptyString=ht}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(b){z[b]=new v(b,0,!1,b,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(b){var g=b[0];z[g]=new v(g,1,!1,b[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(b){z[b]=new v(b,2,!1,b.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(b){z[b]=new v(b,2,!1,b,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(b){z[b]=new v(b,3,!1,b.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(b){z[b]=new v(b,3,!0,b,null,!1,!1)});["capture","download"].forEach(function(b){z[b]=new v(b,4,!1,b,null,!1,!1)});["cols","rows","size","span"].forEach(function(b){z[b]=new v(b,6,!1,b,null,!1,!1)});["rowSpan","start"].forEach(function(b){z[b]=new v(b,5,!1,b.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(b){return b[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(b){var g=b.replace(ra,sa);z[g]=new v(g,1,!1,b,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(b){var g=b.replace(ra,sa);z[g]=new v(g,1,!1,b,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(b){var g=b.replace(ra,sa);z[g]=new v(g,1,!1,b,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(b){z[b]=new v(b,1,!1,b.toLowerCase(),null,!1,!1)});z.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(b){z[b]=new v(b,1,!1,b.toLowerCase(),null,!0,!0)});function ta(b,g,j,d){var nt=z.hasOwnProperty(g)?z[g]:null;(nt!==null?nt.type!==0:d||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(qa(g,j,nt,d)&&(j=null),d||nt===null?oa(g)&&(j===null?b.removeAttribute(g):b.setAttribute(g,""+j)):nt.mustUseProperty?b[nt.propertyName]=j===null?nt.type===3?!1:"":j:(g=nt.attributeName,d=nt.attributeNamespace,j===null?b.removeAttribute(g):(nt=nt.type,j=nt===3||nt===4&&j===!0?"":""+j,d?b.setAttributeNS(d,g,j):b.setAttribute(g,j))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(b){return b===null||typeof b!="object"?null:(b=Ja&&b[Ja]||b["@@iterator"],typeof b=="function"?b:null)}var A=Object.assign,La;function Ma(b){if(La===void 0)try{throw Error()}catch(j){var g=j.stack.trim().match(/\n( *(at )?)/);La=g&&g[1]||""}return`
`+La+b}var Na=!1;function Oa(b,g){if(!b||Na)return"";Na=!0;var j=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(kt){var d=kt}Reflect.construct(b,[],g)}else{try{g.call()}catch(kt){d=kt}b.call(g.prototype)}else{try{throw Error()}catch(kt){d=kt}b()}}catch(kt){if(kt&&d&&typeof kt.stack=="string"){for(var nt=kt.stack.split(`
`),at=d.stack.split(`
`),ht=nt.length-1,_t=at.length-1;1<=ht&&0<=_t&&nt[ht]!==at[_t];)_t--;for(;1<=ht&&0<=_t;ht--,_t--)if(nt[ht]!==at[_t]){if(ht!==1||_t!==1)do if(ht--,_t--,0>_t||nt[ht]!==at[_t]){var bt=`
`+nt[ht].replace(" at new "," at ");return b.displayName&&bt.includes("<anonymous>")&&(bt=bt.replace("<anonymous>",b.displayName)),bt}while(1<=ht&&0<=_t);break}}}finally{Na=!1,Error.prepareStackTrace=j}return(b=b?b.displayName||b.name:"")?Ma(b):""}function Pa(b){switch(b.tag){case 5:return Ma(b.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return b=Oa(b.type,!1),b;case 11:return b=Oa(b.type.render,!1),b;case 1:return b=Oa(b.type,!0),b;default:return""}}function Qa(b){if(b==null)return null;if(typeof b=="function")return b.displayName||b.name||null;if(typeof b=="string")return b;switch(b){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof b=="object")switch(b.$$typeof){case Ca:return(b.displayName||"Context")+".Consumer";case Ba:return(b._context.displayName||"Context")+".Provider";case Da:var g=b.render;return b=b.displayName,b||(b=g.displayName||g.name||"",b=b!==""?"ForwardRef("+b+")":"ForwardRef"),b;case Ga:return g=b.displayName||null,g!==null?g:Qa(b.type)||"Memo";case Ha:g=b._payload,b=b._init;try{return Qa(b(g))}catch{}}return null}function Ra(b){var g=b.type;switch(b.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return b=g.render,b=b.displayName||b.name||"",g.displayName||(b!==""?"ForwardRef("+b+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(g);case 8:return g===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function Sa(b){switch(typeof b){case"boolean":case"number":case"string":case"undefined":return b;case"object":return b;default:return""}}function Ta(b){var g=b.type;return(b=b.nodeName)&&b.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function Ua(b){var g=Ta(b)?"checked":"value",j=Object.getOwnPropertyDescriptor(b.constructor.prototype,g),d=""+b[g];if(!b.hasOwnProperty(g)&&typeof j<"u"&&typeof j.get=="function"&&typeof j.set=="function"){var nt=j.get,at=j.set;return Object.defineProperty(b,g,{configurable:!0,get:function(){return nt.call(this)},set:function(ht){d=""+ht,at.call(this,ht)}}),Object.defineProperty(b,g,{enumerable:j.enumerable}),{getValue:function(){return d},setValue:function(ht){d=""+ht},stopTracking:function(){b._valueTracker=null,delete b[g]}}}}function Va(b){b._valueTracker||(b._valueTracker=Ua(b))}function Wa(b){if(!b)return!1;var g=b._valueTracker;if(!g)return!0;var j=g.getValue(),d="";return b&&(d=Ta(b)?b.checked?"true":"false":b.value),b=d,b!==j?(g.setValue(b),!0):!1}function Xa(b){if(b=b||(typeof document<"u"?document:void 0),typeof b>"u")return null;try{return b.activeElement||b.body}catch{return b.body}}function Ya(b,g){var j=g.checked;return A({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:j??b._wrapperState.initialChecked})}function Za(b,g){var j=g.defaultValue==null?"":g.defaultValue,d=g.checked!=null?g.checked:g.defaultChecked;j=Sa(g.value!=null?g.value:j),b._wrapperState={initialChecked:d,initialValue:j,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function ab(b,g){g=g.checked,g!=null&&ta(b,"checked",g,!1)}function bb(b,g){ab(b,g);var j=Sa(g.value),d=g.type;if(j!=null)d==="number"?(j===0&&b.value===""||b.value!=j)&&(b.value=""+j):b.value!==""+j&&(b.value=""+j);else if(d==="submit"||d==="reset"){b.removeAttribute("value");return}g.hasOwnProperty("value")?cb(b,g.type,j):g.hasOwnProperty("defaultValue")&&cb(b,g.type,Sa(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(b.defaultChecked=!!g.defaultChecked)}function db(b,g,j){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var d=g.type;if(!(d!=="submit"&&d!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+b._wrapperState.initialValue,j||g===b.value||(b.value=g),b.defaultValue=g}j=b.name,j!==""&&(b.name=""),b.defaultChecked=!!b._wrapperState.initialChecked,j!==""&&(b.name=j)}function cb(b,g,j){(g!=="number"||Xa(b.ownerDocument)!==b)&&(j==null?b.defaultValue=""+b._wrapperState.initialValue:b.defaultValue!==""+j&&(b.defaultValue=""+j))}var eb=Array.isArray;function fb(b,g,j,d){if(b=b.options,g){g={};for(var nt=0;nt<j.length;nt++)g["$"+j[nt]]=!0;for(j=0;j<b.length;j++)nt=g.hasOwnProperty("$"+b[j].value),b[j].selected!==nt&&(b[j].selected=nt),nt&&d&&(b[j].defaultSelected=!0)}else{for(j=""+Sa(j),g=null,nt=0;nt<b.length;nt++){if(b[nt].value===j){b[nt].selected=!0,d&&(b[nt].defaultSelected=!0);return}g!==null||b[nt].disabled||(g=b[nt])}g!==null&&(g.selected=!0)}}function gb(b,g){if(g.dangerouslySetInnerHTML!=null)throw Error(p(91));return A({},g,{value:void 0,defaultValue:void 0,children:""+b._wrapperState.initialValue})}function hb(b,g){var j=g.value;if(j==null){if(j=g.children,g=g.defaultValue,j!=null){if(g!=null)throw Error(p(92));if(eb(j)){if(1<j.length)throw Error(p(93));j=j[0]}g=j}g==null&&(g=""),j=g}b._wrapperState={initialValue:Sa(j)}}function ib(b,g){var j=Sa(g.value),d=Sa(g.defaultValue);j!=null&&(j=""+j,j!==b.value&&(b.value=j),g.defaultValue==null&&b.defaultValue!==j&&(b.defaultValue=j)),d!=null&&(b.defaultValue=""+d)}function jb(b){var g=b.textContent;g===b._wrapperState.initialValue&&g!==""&&g!==null&&(b.value=g)}function kb(b){switch(b){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(b,g){return b==null||b==="http://www.w3.org/1999/xhtml"?kb(g):b==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":b}var mb,nb=function(b){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,j,d,nt){MSApp.execUnsafeLocalFunction(function(){return b(g,j,d,nt)})}:b}(function(b,g){if(b.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in b)b.innerHTML=g;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=mb.firstChild;b.firstChild;)b.removeChild(b.firstChild);for(;g.firstChild;)b.appendChild(g.firstChild)}});function ob(b,g){if(g){var j=b.firstChild;if(j&&j===b.lastChild&&j.nodeType===3){j.nodeValue=g;return}}b.textContent=g}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(b){qb.forEach(function(g){g=g+b.charAt(0).toUpperCase()+b.substring(1),pb[g]=pb[b]})});function rb(b,g,j){return g==null||typeof g=="boolean"||g===""?"":j||typeof g!="number"||g===0||pb.hasOwnProperty(b)&&pb[b]?(""+g).trim():g+"px"}function sb(b,g){b=b.style;for(var j in g)if(g.hasOwnProperty(j)){var d=j.indexOf("--")===0,nt=rb(j,g[j],d);j==="float"&&(j="cssFloat"),d?b.setProperty(j,nt):b[j]=nt}}var tb=A({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(b,g){if(g){if(tb[b]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(p(137,b));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(p(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(p(61))}if(g.style!=null&&typeof g.style!="object")throw Error(p(62))}}function vb(b,g){if(b.indexOf("-")===-1)return typeof g.is=="string";switch(b){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(b){return b=b.target||b.srcElement||window,b.correspondingUseElement&&(b=b.correspondingUseElement),b.nodeType===3?b.parentNode:b}var yb=null,zb=null,Ab=null;function Bb(b){if(b=Cb(b)){if(typeof yb!="function")throw Error(p(280));var g=b.stateNode;g&&(g=Db(g),yb(b.stateNode,b.type,g))}}function Eb(b){zb?Ab?Ab.push(b):Ab=[b]:zb=b}function Fb(){if(zb){var b=zb,g=Ab;if(Ab=zb=null,Bb(b),g)for(b=0;b<g.length;b++)Bb(g[b])}}function Gb(b,g){return b(g)}function Hb(){}var Ib=!1;function Jb(b,g,j){if(Ib)return b(g,j);Ib=!0;try{return Gb(b,g,j)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(b,g){var j=b.stateNode;if(j===null)return null;var d=Db(j);if(d===null)return null;j=d[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(b=b.type,d=!(b==="button"||b==="input"||b==="select"||b==="textarea")),b=!d;break e;default:b=!1}if(b)return null;if(j&&typeof j!="function")throw Error(p(231,g,typeof j));return j}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb(b,g,j,d,nt,at,ht,_t,bt){var kt=Array.prototype.slice.call(arguments,3);try{g.apply(j,kt)}catch(Vt){this.onError(Vt)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(b){Ob=!0,Pb=b}};function Tb(b,g,j,d,nt,at,ht,_t,bt){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(b,g,j,d,nt,at,ht,_t,bt){if(Tb.apply(this,arguments),Ob){if(Ob){var kt=Pb;Ob=!1,Pb=null}else throw Error(p(198));Qb||(Qb=!0,Rb=kt)}}function Vb(b){var g=b,j=b;if(b.alternate)for(;g.return;)g=g.return;else{b=g;do g=b,g.flags&4098&&(j=g.return),b=g.return;while(b)}return g.tag===3?j:null}function Wb(b){if(b.tag===13){var g=b.memoizedState;if(g===null&&(b=b.alternate,b!==null&&(g=b.memoizedState)),g!==null)return g.dehydrated}return null}function Xb(b){if(Vb(b)!==b)throw Error(p(188))}function Yb(b){var g=b.alternate;if(!g){if(g=Vb(b),g===null)throw Error(p(188));return g!==b?null:b}for(var j=b,d=g;;){var nt=j.return;if(nt===null)break;var at=nt.alternate;if(at===null){if(d=nt.return,d!==null){j=d;continue}break}if(nt.child===at.child){for(at=nt.child;at;){if(at===j)return Xb(nt),b;if(at===d)return Xb(nt),g;at=at.sibling}throw Error(p(188))}if(j.return!==d.return)j=nt,d=at;else{for(var ht=!1,_t=nt.child;_t;){if(_t===j){ht=!0,j=nt,d=at;break}if(_t===d){ht=!0,d=nt,j=at;break}_t=_t.sibling}if(!ht){for(_t=at.child;_t;){if(_t===j){ht=!0,j=at,d=nt;break}if(_t===d){ht=!0,d=at,j=nt;break}_t=_t.sibling}if(!ht)throw Error(p(189))}}if(j.alternate!==d)throw Error(p(190))}if(j.tag!==3)throw Error(p(188));return j.stateNode.current===j?b:g}function Zb(b){return b=Yb(b),b!==null?$b(b):null}function $b(b){if(b.tag===5||b.tag===6)return b;for(b=b.child;b!==null;){var g=$b(b);if(g!==null)return g;b=b.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(b){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,b,void 0,(b.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(b){return b>>>=0,b===0?32:31-(pc(b)/qc|0)|0}var rc=64,sc=4194304;function tc(b){switch(b&-b){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return b&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return b&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return b}}function uc(b,g){var j=b.pendingLanes;if(j===0)return 0;var d=0,nt=b.suspendedLanes,at=b.pingedLanes,ht=j&268435455;if(ht!==0){var _t=ht&~nt;_t!==0?d=tc(_t):(at&=ht,at!==0&&(d=tc(at)))}else ht=j&~nt,ht!==0?d=tc(ht):at!==0&&(d=tc(at));if(d===0)return 0;if(g!==0&&g!==d&&!(g&nt)&&(nt=d&-d,at=g&-g,nt>=at||nt===16&&(at&4194240)!==0))return g;if(d&4&&(d|=j&16),g=b.entangledLanes,g!==0)for(b=b.entanglements,g&=d;0<g;)j=31-oc(g),nt=1<<j,d|=b[j],g&=~nt;return d}function vc(b,g){switch(b){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(b,g){for(var j=b.suspendedLanes,d=b.pingedLanes,nt=b.expirationTimes,at=b.pendingLanes;0<at;){var ht=31-oc(at),_t=1<<ht,bt=nt[ht];bt===-1?(!(_t&j)||_t&d)&&(nt[ht]=vc(_t,g)):bt<=g&&(b.expiredLanes|=_t),at&=~_t}}function xc(b){return b=b.pendingLanes&-1073741825,b!==0?b:b&1073741824?1073741824:0}function yc(){var b=rc;return rc<<=1,!(rc&4194240)&&(rc=64),b}function zc(b){for(var g=[],j=0;31>j;j++)g.push(b);return g}function Ac(b,g,j){b.pendingLanes|=g,g!==536870912&&(b.suspendedLanes=0,b.pingedLanes=0),b=b.eventTimes,g=31-oc(g),b[g]=j}function Bc(b,g){var j=b.pendingLanes&~g;b.pendingLanes=g,b.suspendedLanes=0,b.pingedLanes=0,b.expiredLanes&=g,b.mutableReadLanes&=g,b.entangledLanes&=g,g=b.entanglements;var d=b.eventTimes;for(b=b.expirationTimes;0<j;){var nt=31-oc(j),at=1<<nt;g[nt]=0,d[nt]=-1,b[nt]=-1,j&=~at}}function Cc(b,g){var j=b.entangledLanes|=g;for(b=b.entanglements;j;){var d=31-oc(j),nt=1<<d;nt&g|b[d]&g&&(b[d]|=g),j&=~nt}}var C=0;function Dc(b){return b&=-b,1<b?4<b?b&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(b,g){switch(b){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(g.pointerId)}}function Tc(b,g,j,d,nt,at){return b===null||b.nativeEvent!==at?(b={blockedOn:g,domEventName:j,eventSystemFlags:d,nativeEvent:at,targetContainers:[nt]},g!==null&&(g=Cb(g),g!==null&&Fc(g)),b):(b.eventSystemFlags|=d,g=b.targetContainers,nt!==null&&g.indexOf(nt)===-1&&g.push(nt),b)}function Uc(b,g,j,d,nt){switch(g){case"focusin":return Lc=Tc(Lc,b,g,j,d,nt),!0;case"dragenter":return Mc=Tc(Mc,b,g,j,d,nt),!0;case"mouseover":return Nc=Tc(Nc,b,g,j,d,nt),!0;case"pointerover":var at=nt.pointerId;return Oc.set(at,Tc(Oc.get(at)||null,b,g,j,d,nt)),!0;case"gotpointercapture":return at=nt.pointerId,Pc.set(at,Tc(Pc.get(at)||null,b,g,j,d,nt)),!0}return!1}function Vc(b){var g=Wc(b.target);if(g!==null){var j=Vb(g);if(j!==null){if(g=j.tag,g===13){if(g=Wb(j),g!==null){b.blockedOn=g,Ic(b.priority,function(){Gc(j)});return}}else if(g===3&&j.stateNode.current.memoizedState.isDehydrated){b.blockedOn=j.tag===3?j.stateNode.containerInfo:null;return}}}b.blockedOn=null}function Xc(b){if(b.blockedOn!==null)return!1;for(var g=b.targetContainers;0<g.length;){var j=Yc(b.domEventName,b.eventSystemFlags,g[0],b.nativeEvent);if(j===null){j=b.nativeEvent;var d=new j.constructor(j.type,j);wb=d,j.target.dispatchEvent(d),wb=null}else return g=Cb(j),g!==null&&Fc(g),b.blockedOn=j,!1;g.shift()}return!0}function Zc(b,g,j){Xc(b)&&j.delete(g)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(b,g){b.blockedOn===g&&(b.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(b){function g(nt){return ad(nt,b)}if(0<Kc.length){ad(Kc[0],b);for(var j=1;j<Kc.length;j++){var d=Kc[j];d.blockedOn===b&&(d.blockedOn=null)}}for(Lc!==null&&ad(Lc,b),Mc!==null&&ad(Mc,b),Nc!==null&&ad(Nc,b),Oc.forEach(g),Pc.forEach(g),j=0;j<Qc.length;j++)d=Qc[j],d.blockedOn===b&&(d.blockedOn=null);for(;0<Qc.length&&(j=Qc[0],j.blockedOn===null);)Vc(j),j.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(b,g,j,d){var nt=C,at=cd.transition;cd.transition=null;try{C=1,fd(b,g,j,d)}finally{C=nt,cd.transition=at}}function gd(b,g,j,d){var nt=C,at=cd.transition;cd.transition=null;try{C=4,fd(b,g,j,d)}finally{C=nt,cd.transition=at}}function fd(b,g,j,d){if(dd){var nt=Yc(b,g,j,d);if(nt===null)hd(b,g,d,id,j),Sc(b,d);else if(Uc(nt,b,g,j,d))d.stopPropagation();else if(Sc(b,d),g&4&&-1<Rc.indexOf(b)){for(;nt!==null;){var at=Cb(nt);if(at!==null&&Ec(at),at=Yc(b,g,j,d),at===null&&hd(b,g,d,id,j),at===nt)break;nt=at}nt!==null&&d.stopPropagation()}else hd(b,g,d,null,j)}}var id=null;function Yc(b,g,j,d){if(id=null,b=xb(d),b=Wc(b),b!==null)if(g=Vb(b),g===null)b=null;else if(j=g.tag,j===13){if(b=Wb(g),b!==null)return b;b=null}else if(j===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;b=null}else g!==b&&(b=null);return id=b,null}function jd(b){switch(b){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var b,g=ld,j=g.length,d,nt="value"in kd?kd.value:kd.textContent,at=nt.length;for(b=0;b<j&&g[b]===nt[b];b++);var ht=j-b;for(d=1;d<=ht&&g[j-d]===nt[at-d];d++);return md=nt.slice(b,1<d?1-d:void 0)}function od(b){var g=b.keyCode;return"charCode"in b?(b=b.charCode,b===0&&g===13&&(b=13)):b=g,b===10&&(b=13),32<=b||b===13?b:0}function pd(){return!0}function qd(){return!1}function rd(b){function g(j,d,nt,at,ht){this._reactName=j,this._targetInst=nt,this.type=d,this.nativeEvent=at,this.target=ht,this.currentTarget=null;for(var _t in b)b.hasOwnProperty(_t)&&(j=b[_t],this[_t]=j?j(at):at[_t]);return this.isDefaultPrevented=(at.defaultPrevented!=null?at.defaultPrevented:at.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var j=this.nativeEvent;j&&(j.preventDefault?j.preventDefault():typeof j.returnValue!="unknown"&&(j.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var j=this.nativeEvent;j&&(j.stopPropagation?j.stopPropagation():typeof j.cancelBubble!="unknown"&&(j.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),g}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(b){return b.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(b){return b.relatedTarget===void 0?b.fromElement===b.srcElement?b.toElement:b.fromElement:b.relatedTarget},movementX:function(b){return"movementX"in b?b.movementX:(b!==yd&&(yd&&b.type==="mousemove"?(wd=b.screenX-yd.screenX,xd=b.screenY-yd.screenY):xd=wd=0,yd=b),wd)},movementY:function(b){return"movementY"in b?b.movementY:xd}}),Bd=rd(Ad),Cd=A({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A({},sd,{clipboardData:function(b){return"clipboardData"in b?b.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(b){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(b):(b=Od[b])?!!g[b]:!1}function zd(){return Pd}var Qd=A({},ud,{key:function(b){if(b.key){var g=Md[b.key]||b.key;if(g!=="Unidentified")return g}return b.type==="keypress"?(b=od(b),b===13?"Enter":String.fromCharCode(b)):b.type==="keydown"||b.type==="keyup"?Nd[b.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(b){return b.type==="keypress"?od(b):0},keyCode:function(b){return b.type==="keydown"||b.type==="keyup"?b.keyCode:0},which:function(b){return b.type==="keypress"?od(b):b.type==="keydown"||b.type==="keyup"?b.keyCode:0}}),Rd=rd(Qd),Sd=A({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A({},Ad,{deltaX:function(b){return"deltaX"in b?b.deltaX:"wheelDeltaX"in b?-b.wheelDeltaX:0},deltaY:function(b){return"deltaY"in b?b.deltaY:"wheelDeltaY"in b?-b.wheelDeltaY:"wheelDelta"in b?-b.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae=ia&&"CompositionEvent"in window,be=null;ia&&"documentMode"in document&&(be=document.documentMode);var ce=ia&&"TextEvent"in window&&!be,de=ia&&(!ae||be&&8<be&&11>=be),ee=String.fromCharCode(32),fe=!1;function ge(b,g){switch(b){case"keyup":return $d.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he(b){return b=b.detail,typeof b=="object"&&"data"in b?b.data:null}var ie=!1;function je(b,g){switch(b){case"compositionend":return he(g);case"keypress":return g.which!==32?null:(fe=!0,ee);case"textInput":return b=g.data,b===ee&&fe?null:b;default:return null}}function ke(b,g){if(ie)return b==="compositionend"||!ae&&ge(b,g)?(b=nd(),md=ld=kd=null,ie=!1,b):null;switch(b){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return de&&g.locale!=="ko"?null:g.data;default:return null}}var le={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me(b){var g=b&&b.nodeName&&b.nodeName.toLowerCase();return g==="input"?!!le[b.type]:g==="textarea"}function ne(b,g,j,d){Eb(d),g=oe(g,"onChange"),0<g.length&&(j=new td("onChange","change",null,j,d),b.push({event:j,listeners:g}))}var pe=null,qe=null;function re(b){se(b,0)}function te(b){var g=ue(b);if(Wa(g))return b}function ve(b,g){if(b==="change")return g}var we=!1;if(ia){var xe;if(ia){var ye="oninput"in document;if(!ye){var ze=document.createElement("div");ze.setAttribute("oninput","return;"),ye=typeof ze.oninput=="function"}xe=ye}else xe=!1;we=xe&&(!document.documentMode||9<document.documentMode)}function Ae(){pe&&(pe.detachEvent("onpropertychange",Be),qe=pe=null)}function Be(b){if(b.propertyName==="value"&&te(qe)){var g=[];ne(g,qe,b,xb(b)),Jb(re,g)}}function Ce(b,g,j){b==="focusin"?(Ae(),pe=g,qe=j,pe.attachEvent("onpropertychange",Be)):b==="focusout"&&Ae()}function De(b){if(b==="selectionchange"||b==="keyup"||b==="keydown")return te(qe)}function Ee(b,g){if(b==="click")return te(g)}function Fe(b,g){if(b==="input"||b==="change")return te(g)}function Ge(b,g){return b===g&&(b!==0||1/b===1/g)||b!==b&&g!==g}var He=typeof Object.is=="function"?Object.is:Ge;function Ie(b,g){if(He(b,g))return!0;if(typeof b!="object"||b===null||typeof g!="object"||g===null)return!1;var j=Object.keys(b),d=Object.keys(g);if(j.length!==d.length)return!1;for(d=0;d<j.length;d++){var nt=j[d];if(!ja.call(g,nt)||!He(b[nt],g[nt]))return!1}return!0}function Je(b){for(;b&&b.firstChild;)b=b.firstChild;return b}function Ke(b,g){var j=Je(b);b=0;for(var d;j;){if(j.nodeType===3){if(d=b+j.textContent.length,b<=g&&d>=g)return{node:j,offset:g-b};b=d}e:{for(;j;){if(j.nextSibling){j=j.nextSibling;break e}j=j.parentNode}j=void 0}j=Je(j)}}function Le(b,g){return b&&g?b===g?!0:b&&b.nodeType===3?!1:g&&g.nodeType===3?Le(b,g.parentNode):"contains"in b?b.contains(g):b.compareDocumentPosition?!!(b.compareDocumentPosition(g)&16):!1:!1}function Me(){for(var b=window,g=Xa();g instanceof b.HTMLIFrameElement;){try{var j=typeof g.contentWindow.location.href=="string"}catch{j=!1}if(j)b=g.contentWindow;else break;g=Xa(b.document)}return g}function Ne(b){var g=b&&b.nodeName&&b.nodeName.toLowerCase();return g&&(g==="input"&&(b.type==="text"||b.type==="search"||b.type==="tel"||b.type==="url"||b.type==="password")||g==="textarea"||b.contentEditable==="true")}function Oe(b){var g=Me(),j=b.focusedElem,d=b.selectionRange;if(g!==j&&j&&j.ownerDocument&&Le(j.ownerDocument.documentElement,j)){if(d!==null&&Ne(j)){if(g=d.start,b=d.end,b===void 0&&(b=g),"selectionStart"in j)j.selectionStart=g,j.selectionEnd=Math.min(b,j.value.length);else if(b=(g=j.ownerDocument||document)&&g.defaultView||window,b.getSelection){b=b.getSelection();var nt=j.textContent.length,at=Math.min(d.start,nt);d=d.end===void 0?at:Math.min(d.end,nt),!b.extend&&at>d&&(nt=d,d=at,at=nt),nt=Ke(j,at);var ht=Ke(j,d);nt&&ht&&(b.rangeCount!==1||b.anchorNode!==nt.node||b.anchorOffset!==nt.offset||b.focusNode!==ht.node||b.focusOffset!==ht.offset)&&(g=g.createRange(),g.setStart(nt.node,nt.offset),b.removeAllRanges(),at>d?(b.addRange(g),b.extend(ht.node,ht.offset)):(g.setEnd(ht.node,ht.offset),b.addRange(g)))}}for(g=[],b=j;b=b.parentNode;)b.nodeType===1&&g.push({element:b,left:b.scrollLeft,top:b.scrollTop});for(typeof j.focus=="function"&&j.focus(),j=0;j<g.length;j++)b=g[j],b.element.scrollLeft=b.left,b.element.scrollTop=b.top}}var Pe=ia&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re=null,Se=null,Te=!1;function Ue(b,g,j){var d=j.window===j?j.document:j.nodeType===9?j:j.ownerDocument;Te||Qe==null||Qe!==Xa(d)||(d=Qe,"selectionStart"in d&&Ne(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Se&&Ie(Se,d)||(Se=d,d=oe(Re,"onSelect"),0<d.length&&(g=new td("onSelect","select",null,g,j),b.push({event:g,listeners:d}),g.target=Qe)))}function Ve(b,g){var j={};return j[b.toLowerCase()]=g.toLowerCase(),j["Webkit"+b]="webkit"+g,j["Moz"+b]="moz"+g,j}var We={animationend:Ve("Animation","AnimationEnd"),animationiteration:Ve("Animation","AnimationIteration"),animationstart:Ve("Animation","AnimationStart"),transitionend:Ve("Transition","TransitionEnd")},Xe={},Ye={};ia&&(Ye=document.createElement("div").style,"AnimationEvent"in window||(delete We.animationend.animation,delete We.animationiteration.animation,delete We.animationstart.animation),"TransitionEvent"in window||delete We.transitionend.transition);function Ze(b){if(Xe[b])return Xe[b];if(!We[b])return b;var g=We[b],j;for(j in g)if(g.hasOwnProperty(j)&&j in Ye)return Xe[b]=g[j];return b}var $e=Ze("animationend"),af=Ze("animationiteration"),bf=Ze("animationstart"),cf=Ze("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(b,g){df.set(b,g),fa(g,[b])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(b,g,j){var d=b.type||"unknown-event";b.currentTarget=j,Ub(d,g,void 0,b),b.currentTarget=null}function se(b,g){g=(g&4)!==0;for(var j=0;j<b.length;j++){var d=b[j],nt=d.event;d=d.listeners;e:{var at=void 0;if(g)for(var ht=d.length-1;0<=ht;ht--){var _t=d[ht],bt=_t.instance,kt=_t.currentTarget;if(_t=_t.listener,bt!==at&&nt.isPropagationStopped())break e;nf(nt,_t,kt),at=bt}else for(ht=0;ht<d.length;ht++){if(_t=d[ht],bt=_t.instance,kt=_t.currentTarget,_t=_t.listener,bt!==at&&nt.isPropagationStopped())break e;nf(nt,_t,kt),at=bt}}}if(Qb)throw b=Rb,Qb=!1,Rb=null,b}function D(b,g){var j=g[of];j===void 0&&(j=g[of]=new Set);var d=b+"__bubble";j.has(d)||(pf(g,b,2,!1),j.add(d))}function qf(b,g,j){var d=0;g&&(d|=4),pf(j,b,d,g)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(b){if(!b[rf]){b[rf]=!0,da.forEach(function(j){j!=="selectionchange"&&(mf.has(j)||qf(j,!1,b),qf(j,!0,b))});var g=b.nodeType===9?b:b.ownerDocument;g===null||g[rf]||(g[rf]=!0,qf("selectionchange",!1,g))}}function pf(b,g,j,d){switch(jd(g)){case 1:var nt=ed;break;case 4:nt=gd;break;default:nt=fd}j=nt.bind(null,g,j,b),nt=void 0,!Lb||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(nt=!0),d?nt!==void 0?b.addEventListener(g,j,{capture:!0,passive:nt}):b.addEventListener(g,j,!0):nt!==void 0?b.addEventListener(g,j,{passive:nt}):b.addEventListener(g,j,!1)}function hd(b,g,j,d,nt){var at=d;if(!(g&1)&&!(g&2)&&d!==null)e:for(;;){if(d===null)return;var ht=d.tag;if(ht===3||ht===4){var _t=d.stateNode.containerInfo;if(_t===nt||_t.nodeType===8&&_t.parentNode===nt)break;if(ht===4)for(ht=d.return;ht!==null;){var bt=ht.tag;if((bt===3||bt===4)&&(bt=ht.stateNode.containerInfo,bt===nt||bt.nodeType===8&&bt.parentNode===nt))return;ht=ht.return}for(;_t!==null;){if(ht=Wc(_t),ht===null)return;if(bt=ht.tag,bt===5||bt===6){d=at=ht;continue e}_t=_t.parentNode}}d=d.return}Jb(function(){var kt=at,Vt=xb(j),qt=[];e:{var zt=df.get(b);if(zt!==void 0){var jt=td,Kt=b;switch(b){case"keypress":if(od(j)===0)break e;case"keydown":case"keyup":jt=Rd;break;case"focusin":Kt="focus",jt=Fd;break;case"focusout":Kt="blur",jt=Fd;break;case"beforeblur":case"afterblur":jt=Fd;break;case"click":if(j.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":jt=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":jt=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":jt=Vd;break;case $e:case af:case bf:jt=Hd;break;case cf:jt=Xd;break;case"scroll":jt=vd;break;case"wheel":jt=Zd;break;case"copy":case"cut":case"paste":jt=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":jt=Td}var Ft=(g&4)!==0,nn=!Ft&&b==="scroll",Lt=Ft?zt!==null?zt+"Capture":null:zt;Ft=[];for(var Nt=kt,Ht;Nt!==null;){Ht=Nt;var on=Ht.stateNode;if(Ht.tag===5&&on!==null&&(Ht=on,Lt!==null&&(on=Kb(Nt,Lt),on!=null&&Ft.push(tf(Nt,on,Ht)))),nn)break;Nt=Nt.return}0<Ft.length&&(zt=new jt(zt,Kt,null,j,Vt),qt.push({event:zt,listeners:Ft}))}}if(!(g&7)){e:{if(zt=b==="mouseover"||b==="pointerover",jt=b==="mouseout"||b==="pointerout",zt&&j!==wb&&(Kt=j.relatedTarget||j.fromElement)&&(Wc(Kt)||Kt[uf]))break e;if((jt||zt)&&(zt=Vt.window===Vt?Vt:(zt=Vt.ownerDocument)?zt.defaultView||zt.parentWindow:window,jt?(Kt=j.relatedTarget||j.toElement,jt=kt,Kt=Kt?Wc(Kt):null,Kt!==null&&(nn=Vb(Kt),Kt!==nn||Kt.tag!==5&&Kt.tag!==6)&&(Kt=null)):(jt=null,Kt=kt),jt!==Kt)){if(Ft=Bd,on="onMouseLeave",Lt="onMouseEnter",Nt="mouse",(b==="pointerout"||b==="pointerover")&&(Ft=Td,on="onPointerLeave",Lt="onPointerEnter",Nt="pointer"),nn=jt==null?zt:ue(jt),Ht=Kt==null?zt:ue(Kt),zt=new Ft(on,Nt+"leave",jt,j,Vt),zt.target=nn,zt.relatedTarget=Ht,on=null,Wc(Vt)===kt&&(Ft=new Ft(Lt,Nt+"enter",Kt,j,Vt),Ft.target=Ht,Ft.relatedTarget=nn,on=Ft),nn=on,jt&&Kt)t:{for(Ft=jt,Lt=Kt,Nt=0,Ht=Ft;Ht;Ht=vf(Ht))Nt++;for(Ht=0,on=Lt;on;on=vf(on))Ht++;for(;0<Nt-Ht;)Ft=vf(Ft),Nt--;for(;0<Ht-Nt;)Lt=vf(Lt),Ht--;for(;Nt--;){if(Ft===Lt||Lt!==null&&Ft===Lt.alternate)break t;Ft=vf(Ft),Lt=vf(Lt)}Ft=null}else Ft=null;jt!==null&&wf(qt,zt,jt,Ft,!1),Kt!==null&&nn!==null&&wf(qt,nn,Kt,Ft,!0)}}e:{if(zt=kt?ue(kt):window,jt=zt.nodeName&&zt.nodeName.toLowerCase(),jt==="select"||jt==="input"&&zt.type==="file")var en=ve;else if(me(zt))if(we)en=Fe;else{en=De;var cn=Ce}else(jt=zt.nodeName)&&jt.toLowerCase()==="input"&&(zt.type==="checkbox"||zt.type==="radio")&&(en=Ee);if(en&&(en=en(b,kt))){ne(qt,en,j,Vt);break e}cn&&cn(b,zt,kt),b==="focusout"&&(cn=zt._wrapperState)&&cn.controlled&&zt.type==="number"&&cb(zt,"number",zt.value)}switch(cn=kt?ue(kt):window,b){case"focusin":(me(cn)||cn.contentEditable==="true")&&(Qe=cn,Re=kt,Se=null);break;case"focusout":Se=Re=Qe=null;break;case"mousedown":Te=!0;break;case"contextmenu":case"mouseup":case"dragend":Te=!1,Ue(qt,j,Vt);break;case"selectionchange":if(Pe)break;case"keydown":case"keyup":Ue(qt,j,Vt)}var Ut;if(ae)e:{switch(b){case"compositionstart":var Gt="onCompositionStart";break e;case"compositionend":Gt="onCompositionEnd";break e;case"compositionupdate":Gt="onCompositionUpdate";break e}Gt=void 0}else ie?ge(b,j)&&(Gt="onCompositionEnd"):b==="keydown"&&j.keyCode===229&&(Gt="onCompositionStart");Gt&&(de&&j.locale!=="ko"&&(ie||Gt!=="onCompositionStart"?Gt==="onCompositionEnd"&&ie&&(Ut=nd()):(kd=Vt,ld="value"in kd?kd.value:kd.textContent,ie=!0)),cn=oe(kt,Gt),0<cn.length&&(Gt=new Ld(Gt,b,null,j,Vt),qt.push({event:Gt,listeners:cn}),Ut?Gt.data=Ut:(Ut=he(j),Ut!==null&&(Gt.data=Ut)))),(Ut=ce?je(b,j):ke(b,j))&&(kt=oe(kt,"onBeforeInput"),0<kt.length&&(Vt=new Ld("onBeforeInput","beforeinput",null,j,Vt),qt.push({event:Vt,listeners:kt}),Vt.data=Ut))}se(qt,g)})}function tf(b,g,j){return{instance:b,listener:g,currentTarget:j}}function oe(b,g){for(var j=g+"Capture",d=[];b!==null;){var nt=b,at=nt.stateNode;nt.tag===5&&at!==null&&(nt=at,at=Kb(b,j),at!=null&&d.unshift(tf(b,at,nt)),at=Kb(b,g),at!=null&&d.push(tf(b,at,nt))),b=b.return}return d}function vf(b){if(b===null)return null;do b=b.return;while(b&&b.tag!==5);return b||null}function wf(b,g,j,d,nt){for(var at=g._reactName,ht=[];j!==null&&j!==d;){var _t=j,bt=_t.alternate,kt=_t.stateNode;if(bt!==null&&bt===d)break;_t.tag===5&&kt!==null&&(_t=kt,nt?(bt=Kb(j,at),bt!=null&&ht.unshift(tf(j,bt,_t))):nt||(bt=Kb(j,at),bt!=null&&ht.push(tf(j,bt,_t)))),j=j.return}ht.length!==0&&b.push({event:g,listeners:ht})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(b){return(typeof b=="string"?b:""+b).replace(xf,`
`).replace(yf,"")}function Af(b,g,j){if(g=zf(g),zf(b)!==g&&j)throw Error(p(425))}function Bf(){}var Cf=null,Df=null;function Ef(b,g){return b==="textarea"||b==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(b){return Hf.resolve(null).then(b).catch(If)}:Ff;function If(b){setTimeout(function(){throw b})}function Kf(b,g){var j=g,d=0;do{var nt=j.nextSibling;if(b.removeChild(j),nt&&nt.nodeType===8)if(j=nt.data,j==="/$"){if(d===0){b.removeChild(nt),bd(g);return}d--}else j!=="$"&&j!=="$?"&&j!=="$!"||d++;j=nt}while(j);bd(g)}function Lf(b){for(;b!=null;b=b.nextSibling){var g=b.nodeType;if(g===1||g===3)break;if(g===8){if(g=b.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return b}function Mf(b){b=b.previousSibling;for(var g=0;b;){if(b.nodeType===8){var j=b.data;if(j==="$"||j==="$!"||j==="$?"){if(g===0)return b;g--}else j==="/$"&&g++}b=b.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(b){var g=b[Of];if(g)return g;for(var j=b.parentNode;j;){if(g=j[uf]||j[Of]){if(j=g.alternate,g.child!==null||j!==null&&j.child!==null)for(b=Mf(b);b!==null;){if(j=b[Of])return j;b=Mf(b)}return g}b=j,j=b.parentNode}return null}function Cb(b){return b=b[Of]||b[uf],!b||b.tag!==5&&b.tag!==6&&b.tag!==13&&b.tag!==3?null:b}function ue(b){if(b.tag===5||b.tag===6)return b.stateNode;throw Error(p(33))}function Db(b){return b[Pf]||null}var Sf=[],Tf=-1;function Uf(b){return{current:b}}function E(b){0>Tf||(b.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G(b,g){Tf++,Sf[Tf]=b.current,b.current=g}var Vf={},H=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(b,g){var j=b.type.contextTypes;if(!j)return Vf;var d=b.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===g)return d.__reactInternalMemoizedMaskedChildContext;var nt={},at;for(at in j)nt[at]=g[at];return d&&(b=b.stateNode,b.__reactInternalMemoizedUnmaskedChildContext=g,b.__reactInternalMemoizedMaskedChildContext=nt),nt}function Zf(b){return b=b.childContextTypes,b!=null}function $f(){E(Wf),E(H)}function ag(b,g,j){if(H.current!==Vf)throw Error(p(168));G(H,g),G(Wf,j)}function bg(b,g,j){var d=b.stateNode;if(g=g.childContextTypes,typeof d.getChildContext!="function")return j;d=d.getChildContext();for(var nt in d)if(!(nt in g))throw Error(p(108,Ra(b)||"Unknown",nt));return A({},j,d)}function cg(b){return b=(b=b.stateNode)&&b.__reactInternalMemoizedMergedChildContext||Vf,Xf=H.current,G(H,b),G(Wf,Wf.current),!0}function dg(b,g,j){var d=b.stateNode;if(!d)throw Error(p(169));j?(b=bg(b,g,Xf),d.__reactInternalMemoizedMergedChildContext=b,E(Wf),E(H),G(H,b)):E(Wf),G(Wf,j)}var eg=null,fg=!1,gg=!1;function hg(b){eg===null?eg=[b]:eg.push(b)}function ig(b){fg=!0,hg(b)}function jg(){if(!gg&&eg!==null){gg=!0;var b=0,g=C;try{var j=eg;for(C=1;b<j.length;b++){var d=j[b];do d=d(!0);while(d!==null)}eg=null,fg=!1}catch(nt){throw eg!==null&&(eg=eg.slice(b+1)),ac(fc,jg),nt}finally{C=g,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(b,g){kg[lg++]=ng,kg[lg++]=mg,mg=b,ng=g}function ug(b,g,j){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=b;var d=rg;b=sg;var nt=32-oc(d)-1;d&=~(1<<nt),j+=1;var at=32-oc(g)+nt;if(30<at){var ht=nt-nt%5;at=(d&(1<<ht)-1).toString(32),d>>=ht,nt-=ht,rg=1<<32-oc(g)+nt|j<<nt|d,sg=at+b}else rg=1<<at|j<<nt|d,sg=b}function vg(b){b.return!==null&&(tg(b,1),ug(b,1,0))}function wg(b){for(;b===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;b===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I=!1,zg=null;function Ag(b,g){var j=Bg(5,null,null,0);j.elementType="DELETED",j.stateNode=g,j.return=b,g=b.deletions,g===null?(b.deletions=[j],b.flags|=16):g.push(j)}function Cg(b,g){switch(b.tag){case 5:var j=b.type;return g=g.nodeType!==1||j.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(b.stateNode=g,xg=b,yg=Lf(g.firstChild),!0):!1;case 6:return g=b.pendingProps===""||g.nodeType!==3?null:g,g!==null?(b.stateNode=g,xg=b,yg=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(j=qg!==null?{id:rg,overflow:sg}:null,b.memoizedState={dehydrated:g,treeContext:j,retryLane:1073741824},j=Bg(18,null,null,0),j.stateNode=g,j.return=b,b.child=j,xg=b,yg=null,!0):!1;default:return!1}}function Dg(b){return(b.mode&1)!==0&&(b.flags&128)===0}function Eg(b){if(I){var g=yg;if(g){var j=g;if(!Cg(b,g)){if(Dg(b))throw Error(p(418));g=Lf(j.nextSibling);var d=xg;g&&Cg(b,g)?Ag(d,j):(b.flags=b.flags&-4097|2,I=!1,xg=b)}}else{if(Dg(b))throw Error(p(418));b.flags=b.flags&-4097|2,I=!1,xg=b}}}function Fg(b){for(b=b.return;b!==null&&b.tag!==5&&b.tag!==3&&b.tag!==13;)b=b.return;xg=b}function Gg(b){if(b!==xg)return!1;if(!I)return Fg(b),I=!0,!1;var g;if((g=b.tag!==3)&&!(g=b.tag!==5)&&(g=b.type,g=g!=="head"&&g!=="body"&&!Ef(b.type,b.memoizedProps)),g&&(g=yg)){if(Dg(b))throw Hg(),Error(p(418));for(;g;)Ag(b,g),g=Lf(g.nextSibling)}if(Fg(b),b.tag===13){if(b=b.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(p(317));e:{for(b=b.nextSibling,g=0;b;){if(b.nodeType===8){var j=b.data;if(j==="/$"){if(g===0){yg=Lf(b.nextSibling);break e}g--}else j!=="$"&&j!=="$!"&&j!=="$?"||g++}b=b.nextSibling}yg=null}}else yg=xg?Lf(b.stateNode.nextSibling):null;return!0}function Hg(){for(var b=yg;b;)b=Lf(b.nextSibling)}function Ig(){yg=xg=null,I=!1}function Jg(b){zg===null?zg=[b]:zg.push(b)}var Kg=ua.ReactCurrentBatchConfig;function Lg(b,g){if(b&&b.defaultProps){g=A({},g),b=b.defaultProps;for(var j in b)g[j]===void 0&&(g[j]=b[j]);return g}return g}var Mg=Uf(null),Ng=null,Og=null,Pg=null;function Qg(){Pg=Og=Ng=null}function Rg(b){var g=Mg.current;E(Mg),b._currentValue=g}function Sg(b,g,j){for(;b!==null;){var d=b.alternate;if((b.childLanes&g)!==g?(b.childLanes|=g,d!==null&&(d.childLanes|=g)):d!==null&&(d.childLanes&g)!==g&&(d.childLanes|=g),b===j)break;b=b.return}}function Tg(b,g){Ng=b,Pg=Og=null,b=b.dependencies,b!==null&&b.firstContext!==null&&(b.lanes&g&&(Ug=!0),b.firstContext=null)}function Vg(b){var g=b._currentValue;if(Pg!==b)if(b={context:b,memoizedValue:g,next:null},Og===null){if(Ng===null)throw Error(p(308));Og=b,Ng.dependencies={lanes:0,firstContext:b}}else Og=Og.next=b;return g}var Wg=null;function Xg(b){Wg===null?Wg=[b]:Wg.push(b)}function Yg(b,g,j,d){var nt=g.interleaved;return nt===null?(j.next=j,Xg(g)):(j.next=nt.next,nt.next=j),g.interleaved=j,Zg(b,d)}function Zg(b,g){b.lanes|=g;var j=b.alternate;for(j!==null&&(j.lanes|=g),j=b,b=b.return;b!==null;)b.childLanes|=g,j=b.alternate,j!==null&&(j.childLanes|=g),j=b,b=b.return;return j.tag===3?j.stateNode:null}var $g=!1;function ah(b){b.updateQueue={baseState:b.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function bh(b,g){b=b.updateQueue,g.updateQueue===b&&(g.updateQueue={baseState:b.baseState,firstBaseUpdate:b.firstBaseUpdate,lastBaseUpdate:b.lastBaseUpdate,shared:b.shared,effects:b.effects})}function ch(b,g){return{eventTime:b,lane:g,tag:0,payload:null,callback:null,next:null}}function dh(b,g,j){var d=b.updateQueue;if(d===null)return null;if(d=d.shared,K&2){var nt=d.pending;return nt===null?g.next=g:(g.next=nt.next,nt.next=g),d.pending=g,Zg(b,j)}return nt=d.interleaved,nt===null?(g.next=g,Xg(d)):(g.next=nt.next,nt.next=g),d.interleaved=g,Zg(b,j)}function eh(b,g,j){if(g=g.updateQueue,g!==null&&(g=g.shared,(j&4194240)!==0)){var d=g.lanes;d&=b.pendingLanes,j|=d,g.lanes=j,Cc(b,j)}}function fh(b,g){var j=b.updateQueue,d=b.alternate;if(d!==null&&(d=d.updateQueue,j===d)){var nt=null,at=null;if(j=j.firstBaseUpdate,j!==null){do{var ht={eventTime:j.eventTime,lane:j.lane,tag:j.tag,payload:j.payload,callback:j.callback,next:null};at===null?nt=at=ht:at=at.next=ht,j=j.next}while(j!==null);at===null?nt=at=g:at=at.next=g}else nt=at=g;j={baseState:d.baseState,firstBaseUpdate:nt,lastBaseUpdate:at,shared:d.shared,effects:d.effects},b.updateQueue=j;return}b=j.lastBaseUpdate,b===null?j.firstBaseUpdate=g:b.next=g,j.lastBaseUpdate=g}function gh(b,g,j,d){var nt=b.updateQueue;$g=!1;var at=nt.firstBaseUpdate,ht=nt.lastBaseUpdate,_t=nt.shared.pending;if(_t!==null){nt.shared.pending=null;var bt=_t,kt=bt.next;bt.next=null,ht===null?at=kt:ht.next=kt,ht=bt;var Vt=b.alternate;Vt!==null&&(Vt=Vt.updateQueue,_t=Vt.lastBaseUpdate,_t!==ht&&(_t===null?Vt.firstBaseUpdate=kt:_t.next=kt,Vt.lastBaseUpdate=bt))}if(at!==null){var qt=nt.baseState;ht=0,Vt=kt=bt=null,_t=at;do{var zt=_t.lane,jt=_t.eventTime;if((d&zt)===zt){Vt!==null&&(Vt=Vt.next={eventTime:jt,lane:0,tag:_t.tag,payload:_t.payload,callback:_t.callback,next:null});e:{var Kt=b,Ft=_t;switch(zt=g,jt=j,Ft.tag){case 1:if(Kt=Ft.payload,typeof Kt=="function"){qt=Kt.call(jt,qt,zt);break e}qt=Kt;break e;case 3:Kt.flags=Kt.flags&-65537|128;case 0:if(Kt=Ft.payload,zt=typeof Kt=="function"?Kt.call(jt,qt,zt):Kt,zt==null)break e;qt=A({},qt,zt);break e;case 2:$g=!0}}_t.callback!==null&&_t.lane!==0&&(b.flags|=64,zt=nt.effects,zt===null?nt.effects=[_t]:zt.push(_t))}else jt={eventTime:jt,lane:zt,tag:_t.tag,payload:_t.payload,callback:_t.callback,next:null},Vt===null?(kt=Vt=jt,bt=qt):Vt=Vt.next=jt,ht|=zt;if(_t=_t.next,_t===null){if(_t=nt.shared.pending,_t===null)break;zt=_t,_t=zt.next,zt.next=null,nt.lastBaseUpdate=zt,nt.shared.pending=null}}while(1);if(Vt===null&&(bt=qt),nt.baseState=bt,nt.firstBaseUpdate=kt,nt.lastBaseUpdate=Vt,g=nt.shared.interleaved,g!==null){nt=g;do ht|=nt.lane,nt=nt.next;while(nt!==g)}else at===null&&(nt.shared.lanes=0);hh|=ht,b.lanes=ht,b.memoizedState=qt}}function ih(b,g,j){if(b=g.effects,g.effects=null,b!==null)for(g=0;g<b.length;g++){var d=b[g],nt=d.callback;if(nt!==null){if(d.callback=null,d=j,typeof nt!="function")throw Error(p(191,nt));nt.call(d)}}}var jh=new aa.Component().refs;function kh(b,g,j,d){g=b.memoizedState,j=j(d,g),j=j==null?g:A({},g,j),b.memoizedState=j,b.lanes===0&&(b.updateQueue.baseState=j)}var nh={isMounted:function(b){return(b=b._reactInternals)?Vb(b)===b:!1},enqueueSetState:function(b,g,j){b=b._reactInternals;var d=L(),nt=lh(b),at=ch(d,nt);at.payload=g,j!=null&&(at.callback=j),g=dh(b,at,nt),g!==null&&(mh(g,b,nt,d),eh(g,b,nt))},enqueueReplaceState:function(b,g,j){b=b._reactInternals;var d=L(),nt=lh(b),at=ch(d,nt);at.tag=1,at.payload=g,j!=null&&(at.callback=j),g=dh(b,at,nt),g!==null&&(mh(g,b,nt,d),eh(g,b,nt))},enqueueForceUpdate:function(b,g){b=b._reactInternals;var j=L(),d=lh(b),nt=ch(j,d);nt.tag=2,g!=null&&(nt.callback=g),g=dh(b,nt,d),g!==null&&(mh(g,b,d,j),eh(g,b,d))}};function oh(b,g,j,d,nt,at,ht){return b=b.stateNode,typeof b.shouldComponentUpdate=="function"?b.shouldComponentUpdate(d,at,ht):g.prototype&&g.prototype.isPureReactComponent?!Ie(j,d)||!Ie(nt,at):!0}function ph(b,g,j){var d=!1,nt=Vf,at=g.contextType;return typeof at=="object"&&at!==null?at=Vg(at):(nt=Zf(g)?Xf:H.current,d=g.contextTypes,at=(d=d!=null)?Yf(b,nt):Vf),g=new g(j,at),b.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=nh,b.stateNode=g,g._reactInternals=b,d&&(b=b.stateNode,b.__reactInternalMemoizedUnmaskedChildContext=nt,b.__reactInternalMemoizedMaskedChildContext=at),g}function qh(b,g,j,d){b=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(j,d),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(j,d),g.state!==b&&nh.enqueueReplaceState(g,g.state,null)}function rh(b,g,j,d){var nt=b.stateNode;nt.props=j,nt.state=b.memoizedState,nt.refs=jh,ah(b);var at=g.contextType;typeof at=="object"&&at!==null?nt.context=Vg(at):(at=Zf(g)?Xf:H.current,nt.context=Yf(b,at)),nt.state=b.memoizedState,at=g.getDerivedStateFromProps,typeof at=="function"&&(kh(b,g,at,j),nt.state=b.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof nt.getSnapshotBeforeUpdate=="function"||typeof nt.UNSAFE_componentWillMount!="function"&&typeof nt.componentWillMount!="function"||(g=nt.state,typeof nt.componentWillMount=="function"&&nt.componentWillMount(),typeof nt.UNSAFE_componentWillMount=="function"&&nt.UNSAFE_componentWillMount(),g!==nt.state&&nh.enqueueReplaceState(nt,nt.state,null),gh(b,j,nt,d),nt.state=b.memoizedState),typeof nt.componentDidMount=="function"&&(b.flags|=4194308)}function sh(b,g,j){if(b=j.ref,b!==null&&typeof b!="function"&&typeof b!="object"){if(j._owner){if(j=j._owner,j){if(j.tag!==1)throw Error(p(309));var d=j.stateNode}if(!d)throw Error(p(147,b));var nt=d,at=""+b;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===at?g.ref:(g=function(ht){var _t=nt.refs;_t===jh&&(_t=nt.refs={}),ht===null?delete _t[at]:_t[at]=ht},g._stringRef=at,g)}if(typeof b!="string")throw Error(p(284));if(!j._owner)throw Error(p(290,b))}return b}function th(b,g){throw b=Object.prototype.toString.call(g),Error(p(31,b==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":b))}function uh(b){var g=b._init;return g(b._payload)}function vh(b){function g(Lt,Nt){if(b){var Ht=Lt.deletions;Ht===null?(Lt.deletions=[Nt],Lt.flags|=16):Ht.push(Nt)}}function j(Lt,Nt){if(!b)return null;for(;Nt!==null;)g(Lt,Nt),Nt=Nt.sibling;return null}function d(Lt,Nt){for(Lt=new Map;Nt!==null;)Nt.key!==null?Lt.set(Nt.key,Nt):Lt.set(Nt.index,Nt),Nt=Nt.sibling;return Lt}function nt(Lt,Nt){return Lt=wh(Lt,Nt),Lt.index=0,Lt.sibling=null,Lt}function at(Lt,Nt,Ht){return Lt.index=Ht,b?(Ht=Lt.alternate,Ht!==null?(Ht=Ht.index,Ht<Nt?(Lt.flags|=2,Nt):Ht):(Lt.flags|=2,Nt)):(Lt.flags|=1048576,Nt)}function ht(Lt){return b&&Lt.alternate===null&&(Lt.flags|=2),Lt}function _t(Lt,Nt,Ht,on){return Nt===null||Nt.tag!==6?(Nt=xh(Ht,Lt.mode,on),Nt.return=Lt,Nt):(Nt=nt(Nt,Ht),Nt.return=Lt,Nt)}function bt(Lt,Nt,Ht,on){var en=Ht.type;return en===ya?Vt(Lt,Nt,Ht.props.children,on,Ht.key):Nt!==null&&(Nt.elementType===en||typeof en=="object"&&en!==null&&en.$$typeof===Ha&&uh(en)===Nt.type)?(on=nt(Nt,Ht.props),on.ref=sh(Lt,Nt,Ht),on.return=Lt,on):(on=yh(Ht.type,Ht.key,Ht.props,null,Lt.mode,on),on.ref=sh(Lt,Nt,Ht),on.return=Lt,on)}function kt(Lt,Nt,Ht,on){return Nt===null||Nt.tag!==4||Nt.stateNode.containerInfo!==Ht.containerInfo||Nt.stateNode.implementation!==Ht.implementation?(Nt=zh(Ht,Lt.mode,on),Nt.return=Lt,Nt):(Nt=nt(Nt,Ht.children||[]),Nt.return=Lt,Nt)}function Vt(Lt,Nt,Ht,on,en){return Nt===null||Nt.tag!==7?(Nt=Ah(Ht,Lt.mode,on,en),Nt.return=Lt,Nt):(Nt=nt(Nt,Ht),Nt.return=Lt,Nt)}function qt(Lt,Nt,Ht){if(typeof Nt=="string"&&Nt!==""||typeof Nt=="number")return Nt=xh(""+Nt,Lt.mode,Ht),Nt.return=Lt,Nt;if(typeof Nt=="object"&&Nt!==null){switch(Nt.$$typeof){case va:return Ht=yh(Nt.type,Nt.key,Nt.props,null,Lt.mode,Ht),Ht.ref=sh(Lt,null,Nt),Ht.return=Lt,Ht;case wa:return Nt=zh(Nt,Lt.mode,Ht),Nt.return=Lt,Nt;case Ha:var on=Nt._init;return qt(Lt,on(Nt._payload),Ht)}if(eb(Nt)||Ka(Nt))return Nt=Ah(Nt,Lt.mode,Ht,null),Nt.return=Lt,Nt;th(Lt,Nt)}return null}function zt(Lt,Nt,Ht,on){var en=Nt!==null?Nt.key:null;if(typeof Ht=="string"&&Ht!==""||typeof Ht=="number")return en!==null?null:_t(Lt,Nt,""+Ht,on);if(typeof Ht=="object"&&Ht!==null){switch(Ht.$$typeof){case va:return Ht.key===en?bt(Lt,Nt,Ht,on):null;case wa:return Ht.key===en?kt(Lt,Nt,Ht,on):null;case Ha:return en=Ht._init,zt(Lt,Nt,en(Ht._payload),on)}if(eb(Ht)||Ka(Ht))return en!==null?null:Vt(Lt,Nt,Ht,on,null);th(Lt,Ht)}return null}function jt(Lt,Nt,Ht,on,en){if(typeof on=="string"&&on!==""||typeof on=="number")return Lt=Lt.get(Ht)||null,_t(Nt,Lt,""+on,en);if(typeof on=="object"&&on!==null){switch(on.$$typeof){case va:return Lt=Lt.get(on.key===null?Ht:on.key)||null,bt(Nt,Lt,on,en);case wa:return Lt=Lt.get(on.key===null?Ht:on.key)||null,kt(Nt,Lt,on,en);case Ha:var cn=on._init;return jt(Lt,Nt,Ht,cn(on._payload),en)}if(eb(on)||Ka(on))return Lt=Lt.get(Ht)||null,Vt(Nt,Lt,on,en,null);th(Nt,on)}return null}function Kt(Lt,Nt,Ht,on){for(var en=null,cn=null,Ut=Nt,Gt=Nt=0,$t=null;Ut!==null&&Gt<Ht.length;Gt++){Ut.index>Gt?($t=Ut,Ut=null):$t=Ut.sibling;var un=zt(Lt,Ut,Ht[Gt],on);if(un===null){Ut===null&&(Ut=$t);break}b&&Ut&&un.alternate===null&&g(Lt,Ut),Nt=at(un,Nt,Gt),cn===null?en=un:cn.sibling=un,cn=un,Ut=$t}if(Gt===Ht.length)return j(Lt,Ut),I&&tg(Lt,Gt),en;if(Ut===null){for(;Gt<Ht.length;Gt++)Ut=qt(Lt,Ht[Gt],on),Ut!==null&&(Nt=at(Ut,Nt,Gt),cn===null?en=Ut:cn.sibling=Ut,cn=Ut);return I&&tg(Lt,Gt),en}for(Ut=d(Lt,Ut);Gt<Ht.length;Gt++)$t=jt(Ut,Lt,Gt,Ht[Gt],on),$t!==null&&(b&&$t.alternate!==null&&Ut.delete($t.key===null?Gt:$t.key),Nt=at($t,Nt,Gt),cn===null?en=$t:cn.sibling=$t,cn=$t);return b&&Ut.forEach(function(hn){return g(Lt,hn)}),I&&tg(Lt,Gt),en}function Ft(Lt,Nt,Ht,on){var en=Ka(Ht);if(typeof en!="function")throw Error(p(150));if(Ht=en.call(Ht),Ht==null)throw Error(p(151));for(var cn=en=null,Ut=Nt,Gt=Nt=0,$t=null,un=Ht.next();Ut!==null&&!un.done;Gt++,un=Ht.next()){Ut.index>Gt?($t=Ut,Ut=null):$t=Ut.sibling;var hn=zt(Lt,Ut,un.value,on);if(hn===null){Ut===null&&(Ut=$t);break}b&&Ut&&hn.alternate===null&&g(Lt,Ut),Nt=at(hn,Nt,Gt),cn===null?en=hn:cn.sibling=hn,cn=hn,Ut=$t}if(un.done)return j(Lt,Ut),I&&tg(Lt,Gt),en;if(Ut===null){for(;!un.done;Gt++,un=Ht.next())un=qt(Lt,un.value,on),un!==null&&(Nt=at(un,Nt,Gt),cn===null?en=un:cn.sibling=un,cn=un);return I&&tg(Lt,Gt),en}for(Ut=d(Lt,Ut);!un.done;Gt++,un=Ht.next())un=jt(Ut,Lt,Gt,un.value,on),un!==null&&(b&&un.alternate!==null&&Ut.delete(un.key===null?Gt:un.key),Nt=at(un,Nt,Gt),cn===null?en=un:cn.sibling=un,cn=un);return b&&Ut.forEach(function(Bn){return g(Lt,Bn)}),I&&tg(Lt,Gt),en}function nn(Lt,Nt,Ht,on){if(typeof Ht=="object"&&Ht!==null&&Ht.type===ya&&Ht.key===null&&(Ht=Ht.props.children),typeof Ht=="object"&&Ht!==null){switch(Ht.$$typeof){case va:e:{for(var en=Ht.key,cn=Nt;cn!==null;){if(cn.key===en){if(en=Ht.type,en===ya){if(cn.tag===7){j(Lt,cn.sibling),Nt=nt(cn,Ht.props.children),Nt.return=Lt,Lt=Nt;break e}}else if(cn.elementType===en||typeof en=="object"&&en!==null&&en.$$typeof===Ha&&uh(en)===cn.type){j(Lt,cn.sibling),Nt=nt(cn,Ht.props),Nt.ref=sh(Lt,cn,Ht),Nt.return=Lt,Lt=Nt;break e}j(Lt,cn);break}else g(Lt,cn);cn=cn.sibling}Ht.type===ya?(Nt=Ah(Ht.props.children,Lt.mode,on,Ht.key),Nt.return=Lt,Lt=Nt):(on=yh(Ht.type,Ht.key,Ht.props,null,Lt.mode,on),on.ref=sh(Lt,Nt,Ht),on.return=Lt,Lt=on)}return ht(Lt);case wa:e:{for(cn=Ht.key;Nt!==null;){if(Nt.key===cn)if(Nt.tag===4&&Nt.stateNode.containerInfo===Ht.containerInfo&&Nt.stateNode.implementation===Ht.implementation){j(Lt,Nt.sibling),Nt=nt(Nt,Ht.children||[]),Nt.return=Lt,Lt=Nt;break e}else{j(Lt,Nt);break}else g(Lt,Nt);Nt=Nt.sibling}Nt=zh(Ht,Lt.mode,on),Nt.return=Lt,Lt=Nt}return ht(Lt);case Ha:return cn=Ht._init,nn(Lt,Nt,cn(Ht._payload),on)}if(eb(Ht))return Kt(Lt,Nt,Ht,on);if(Ka(Ht))return Ft(Lt,Nt,Ht,on);th(Lt,Ht)}return typeof Ht=="string"&&Ht!==""||typeof Ht=="number"?(Ht=""+Ht,Nt!==null&&Nt.tag===6?(j(Lt,Nt.sibling),Nt=nt(Nt,Ht),Nt.return=Lt,Lt=Nt):(j(Lt,Nt),Nt=xh(Ht,Lt.mode,on),Nt.return=Lt,Lt=Nt),ht(Lt)):j(Lt,Nt)}return nn}var Bh=vh(!0),Ch=vh(!1),Dh={},Eh=Uf(Dh),Fh=Uf(Dh),Gh=Uf(Dh);function Hh(b){if(b===Dh)throw Error(p(174));return b}function Ih(b,g){switch(G(Gh,g),G(Fh,b),G(Eh,Dh),b=g.nodeType,b){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:lb(null,"");break;default:b=b===8?g.parentNode:g,g=b.namespaceURI||null,b=b.tagName,g=lb(g,b)}E(Eh),G(Eh,g)}function Jh(){E(Eh),E(Fh),E(Gh)}function Kh(b){Hh(Gh.current);var g=Hh(Eh.current),j=lb(g,b.type);g!==j&&(G(Fh,b),G(Eh,j))}function Lh(b){Fh.current===b&&(E(Eh),E(Fh))}var M=Uf(0);function Mh(b){for(var g=b;g!==null;){if(g.tag===13){var j=g.memoizedState;if(j!==null&&(j=j.dehydrated,j===null||j.data==="$?"||j.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if(g.flags&128)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===b)break;for(;g.sibling===null;){if(g.return===null||g.return===b)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var Nh=[];function Oh(){for(var b=0;b<Nh.length;b++)Nh[b]._workInProgressVersionPrimary=null;Nh.length=0}var Ph=ua.ReactCurrentDispatcher,Qh=ua.ReactCurrentBatchConfig,Rh=0,N=null,O=null,P=null,Sh=!1,Th=!1,Uh=0,Vh=0;function Q(){throw Error(p(321))}function Wh(b,g){if(g===null)return!1;for(var j=0;j<g.length&&j<b.length;j++)if(!He(b[j],g[j]))return!1;return!0}function Xh(b,g,j,d,nt,at){if(Rh=at,N=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,Ph.current=b===null||b.memoizedState===null?Yh:Zh,b=j(d,nt),Th){at=0;do{if(Th=!1,Uh=0,25<=at)throw Error(p(301));at+=1,P=O=null,g.updateQueue=null,Ph.current=$h,b=j(d,nt)}while(Th)}if(Ph.current=ai,g=O!==null&&O.next!==null,Rh=0,P=O=N=null,Sh=!1,g)throw Error(p(300));return b}function bi(){var b=Uh!==0;return Uh=0,b}function ci(){var b={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return P===null?N.memoizedState=P=b:P=P.next=b,P}function di(){if(O===null){var b=N.alternate;b=b!==null?b.memoizedState:null}else b=O.next;var g=P===null?N.memoizedState:P.next;if(g!==null)P=g,O=b;else{if(b===null)throw Error(p(310));O=b,b={memoizedState:O.memoizedState,baseState:O.baseState,baseQueue:O.baseQueue,queue:O.queue,next:null},P===null?N.memoizedState=P=b:P=P.next=b}return P}function ei(b,g){return typeof g=="function"?g(b):g}function fi(b){var g=di(),j=g.queue;if(j===null)throw Error(p(311));j.lastRenderedReducer=b;var d=O,nt=d.baseQueue,at=j.pending;if(at!==null){if(nt!==null){var ht=nt.next;nt.next=at.next,at.next=ht}d.baseQueue=nt=at,j.pending=null}if(nt!==null){at=nt.next,d=d.baseState;var _t=ht=null,bt=null,kt=at;do{var Vt=kt.lane;if((Rh&Vt)===Vt)bt!==null&&(bt=bt.next={lane:0,action:kt.action,hasEagerState:kt.hasEagerState,eagerState:kt.eagerState,next:null}),d=kt.hasEagerState?kt.eagerState:b(d,kt.action);else{var qt={lane:Vt,action:kt.action,hasEagerState:kt.hasEagerState,eagerState:kt.eagerState,next:null};bt===null?(_t=bt=qt,ht=d):bt=bt.next=qt,N.lanes|=Vt,hh|=Vt}kt=kt.next}while(kt!==null&&kt!==at);bt===null?ht=d:bt.next=_t,He(d,g.memoizedState)||(Ug=!0),g.memoizedState=d,g.baseState=ht,g.baseQueue=bt,j.lastRenderedState=d}if(b=j.interleaved,b!==null){nt=b;do at=nt.lane,N.lanes|=at,hh|=at,nt=nt.next;while(nt!==b)}else nt===null&&(j.lanes=0);return[g.memoizedState,j.dispatch]}function gi(b){var g=di(),j=g.queue;if(j===null)throw Error(p(311));j.lastRenderedReducer=b;var d=j.dispatch,nt=j.pending,at=g.memoizedState;if(nt!==null){j.pending=null;var ht=nt=nt.next;do at=b(at,ht.action),ht=ht.next;while(ht!==nt);He(at,g.memoizedState)||(Ug=!0),g.memoizedState=at,g.baseQueue===null&&(g.baseState=at),j.lastRenderedState=at}return[at,d]}function hi(){}function ii(b,g){var j=N,d=di(),nt=g(),at=!He(d.memoizedState,nt);if(at&&(d.memoizedState=nt,Ug=!0),d=d.queue,ji(ki.bind(null,j,d,b),[b]),d.getSnapshot!==g||at||P!==null&&P.memoizedState.tag&1){if(j.flags|=2048,li(9,mi.bind(null,j,d,nt,g),void 0,null),R===null)throw Error(p(349));Rh&30||ni(j,g,nt)}return nt}function ni(b,g,j){b.flags|=16384,b={getSnapshot:g,value:j},g=N.updateQueue,g===null?(g={lastEffect:null,stores:null},N.updateQueue=g,g.stores=[b]):(j=g.stores,j===null?g.stores=[b]:j.push(b))}function mi(b,g,j,d){g.value=j,g.getSnapshot=d,oi(g)&&pi(b)}function ki(b,g,j){return j(function(){oi(g)&&pi(b)})}function oi(b){var g=b.getSnapshot;b=b.value;try{var j=g();return!He(b,j)}catch{return!0}}function pi(b){var g=Zg(b,1);g!==null&&mh(g,b,1,-1)}function qi(b){var g=ci();return typeof b=="function"&&(b=b()),g.memoizedState=g.baseState=b,b={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ei,lastRenderedState:b},g.queue=b,b=b.dispatch=ri.bind(null,N,b),[g.memoizedState,b]}function li(b,g,j,d){return b={tag:b,create:g,destroy:j,deps:d,next:null},g=N.updateQueue,g===null?(g={lastEffect:null,stores:null},N.updateQueue=g,g.lastEffect=b.next=b):(j=g.lastEffect,j===null?g.lastEffect=b.next=b:(d=j.next,j.next=b,b.next=d,g.lastEffect=b)),b}function si(){return di().memoizedState}function ti(b,g,j,d){var nt=ci();N.flags|=b,nt.memoizedState=li(1|g,j,void 0,d===void 0?null:d)}function ui(b,g,j,d){var nt=di();d=d===void 0?null:d;var at=void 0;if(O!==null){var ht=O.memoizedState;if(at=ht.destroy,d!==null&&Wh(d,ht.deps)){nt.memoizedState=li(g,j,at,d);return}}N.flags|=b,nt.memoizedState=li(1|g,j,at,d)}function vi(b,g){return ti(8390656,8,b,g)}function ji(b,g){return ui(2048,8,b,g)}function wi(b,g){return ui(4,2,b,g)}function xi(b,g){return ui(4,4,b,g)}function yi(b,g){if(typeof g=="function")return b=b(),g(b),function(){g(null)};if(g!=null)return b=b(),g.current=b,function(){g.current=null}}function zi(b,g,j){return j=j!=null?j.concat([b]):null,ui(4,4,yi.bind(null,g,b),j)}function Ai(){}function Bi(b,g){var j=di();g=g===void 0?null:g;var d=j.memoizedState;return d!==null&&g!==null&&Wh(g,d[1])?d[0]:(j.memoizedState=[b,g],b)}function Ci(b,g){var j=di();g=g===void 0?null:g;var d=j.memoizedState;return d!==null&&g!==null&&Wh(g,d[1])?d[0]:(b=b(),j.memoizedState=[b,g],b)}function Di(b,g,j){return Rh&21?(He(j,g)||(j=yc(),N.lanes|=j,hh|=j,b.baseState=!0),g):(b.baseState&&(b.baseState=!1,Ug=!0),b.memoizedState=j)}function Ei(b,g){var j=C;C=j!==0&&4>j?j:4,b(!0);var d=Qh.transition;Qh.transition={};try{b(!1),g()}finally{C=j,Qh.transition=d}}function Fi(){return di().memoizedState}function Gi(b,g,j){var d=lh(b);if(j={lane:d,action:j,hasEagerState:!1,eagerState:null,next:null},Hi(b))Ii(g,j);else if(j=Yg(b,g,j,d),j!==null){var nt=L();mh(j,b,d,nt),Ji(j,g,d)}}function ri(b,g,j){var d=lh(b),nt={lane:d,action:j,hasEagerState:!1,eagerState:null,next:null};if(Hi(b))Ii(g,nt);else{var at=b.alternate;if(b.lanes===0&&(at===null||at.lanes===0)&&(at=g.lastRenderedReducer,at!==null))try{var ht=g.lastRenderedState,_t=at(ht,j);if(nt.hasEagerState=!0,nt.eagerState=_t,He(_t,ht)){var bt=g.interleaved;bt===null?(nt.next=nt,Xg(g)):(nt.next=bt.next,bt.next=nt),g.interleaved=nt;return}}catch{}finally{}j=Yg(b,g,nt,d),j!==null&&(nt=L(),mh(j,b,d,nt),Ji(j,g,d))}}function Hi(b){var g=b.alternate;return b===N||g!==null&&g===N}function Ii(b,g){Th=Sh=!0;var j=b.pending;j===null?g.next=g:(g.next=j.next,j.next=g),b.pending=g}function Ji(b,g,j){if(j&4194240){var d=g.lanes;d&=b.pendingLanes,j|=d,g.lanes=j,Cc(b,j)}}var ai={readContext:Vg,useCallback:Q,useContext:Q,useEffect:Q,useImperativeHandle:Q,useInsertionEffect:Q,useLayoutEffect:Q,useMemo:Q,useReducer:Q,useRef:Q,useState:Q,useDebugValue:Q,useDeferredValue:Q,useTransition:Q,useMutableSource:Q,useSyncExternalStore:Q,useId:Q,unstable_isNewReconciler:!1},Yh={readContext:Vg,useCallback:function(b,g){return ci().memoizedState=[b,g===void 0?null:g],b},useContext:Vg,useEffect:vi,useImperativeHandle:function(b,g,j){return j=j!=null?j.concat([b]):null,ti(4194308,4,yi.bind(null,g,b),j)},useLayoutEffect:function(b,g){return ti(4194308,4,b,g)},useInsertionEffect:function(b,g){return ti(4,2,b,g)},useMemo:function(b,g){var j=ci();return g=g===void 0?null:g,b=b(),j.memoizedState=[b,g],b},useReducer:function(b,g,j){var d=ci();return g=j!==void 0?j(g):g,d.memoizedState=d.baseState=g,b={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:b,lastRenderedState:g},d.queue=b,b=b.dispatch=Gi.bind(null,N,b),[d.memoizedState,b]},useRef:function(b){var g=ci();return b={current:b},g.memoizedState=b},useState:qi,useDebugValue:Ai,useDeferredValue:function(b){return ci().memoizedState=b},useTransition:function(){var b=qi(!1),g=b[0];return b=Ei.bind(null,b[1]),ci().memoizedState=b,[g,b]},useMutableSource:function(){},useSyncExternalStore:function(b,g,j){var d=N,nt=ci();if(I){if(j===void 0)throw Error(p(407));j=j()}else{if(j=g(),R===null)throw Error(p(349));Rh&30||ni(d,g,j)}nt.memoizedState=j;var at={value:j,getSnapshot:g};return nt.queue=at,vi(ki.bind(null,d,at,b),[b]),d.flags|=2048,li(9,mi.bind(null,d,at,j,g),void 0,null),j},useId:function(){var b=ci(),g=R.identifierPrefix;if(I){var j=sg,d=rg;j=(d&~(1<<32-oc(d)-1)).toString(32)+j,g=":"+g+"R"+j,j=Uh++,0<j&&(g+="H"+j.toString(32)),g+=":"}else j=Vh++,g=":"+g+"r"+j.toString(32)+":";return b.memoizedState=g},unstable_isNewReconciler:!1},Zh={readContext:Vg,useCallback:Bi,useContext:Vg,useEffect:ji,useImperativeHandle:zi,useInsertionEffect:wi,useLayoutEffect:xi,useMemo:Ci,useReducer:fi,useRef:si,useState:function(){return fi(ei)},useDebugValue:Ai,useDeferredValue:function(b){var g=di();return Di(g,O.memoizedState,b)},useTransition:function(){var b=fi(ei)[0],g=di().memoizedState;return[b,g]},useMutableSource:hi,useSyncExternalStore:ii,useId:Fi,unstable_isNewReconciler:!1},$h={readContext:Vg,useCallback:Bi,useContext:Vg,useEffect:ji,useImperativeHandle:zi,useInsertionEffect:wi,useLayoutEffect:xi,useMemo:Ci,useReducer:gi,useRef:si,useState:function(){return gi(ei)},useDebugValue:Ai,useDeferredValue:function(b){var g=di();return O===null?g.memoizedState=b:Di(g,O.memoizedState,b)},useTransition:function(){var b=gi(ei)[0],g=di().memoizedState;return[b,g]},useMutableSource:hi,useSyncExternalStore:ii,useId:Fi,unstable_isNewReconciler:!1};function Ki(b,g){try{var j="",d=g;do j+=Pa(d),d=d.return;while(d);var nt=j}catch(at){nt=`
Error generating stack: `+at.message+`
`+at.stack}return{value:b,source:g,stack:nt,digest:null}}function Li(b,g,j){return{value:b,source:null,stack:j??null,digest:g??null}}function Mi(b,g){try{console.error(g.value)}catch(j){setTimeout(function(){throw j})}}var Ni=typeof WeakMap=="function"?WeakMap:Map;function Oi(b,g,j){j=ch(-1,j),j.tag=3,j.payload={element:null};var d=g.value;return j.callback=function(){Pi||(Pi=!0,Qi=d),Mi(b,g)},j}function Ri(b,g,j){j=ch(-1,j),j.tag=3;var d=b.type.getDerivedStateFromError;if(typeof d=="function"){var nt=g.value;j.payload=function(){return d(nt)},j.callback=function(){Mi(b,g)}}var at=b.stateNode;return at!==null&&typeof at.componentDidCatch=="function"&&(j.callback=function(){Mi(b,g),typeof d!="function"&&(Si===null?Si=new Set([this]):Si.add(this));var ht=g.stack;this.componentDidCatch(g.value,{componentStack:ht!==null?ht:""})}),j}function Ti(b,g,j){var d=b.pingCache;if(d===null){d=b.pingCache=new Ni;var nt=new Set;d.set(g,nt)}else nt=d.get(g),nt===void 0&&(nt=new Set,d.set(g,nt));nt.has(j)||(nt.add(j),b=Ui.bind(null,b,g,j),g.then(b,b))}function Vi(b){do{var g;if((g=b.tag===13)&&(g=b.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return b;b=b.return}while(b!==null);return null}function Wi(b,g,j,d,nt){return b.mode&1?(b.flags|=65536,b.lanes=nt,b):(b===g?b.flags|=65536:(b.flags|=128,j.flags|=131072,j.flags&=-52805,j.tag===1&&(j.alternate===null?j.tag=17:(g=ch(-1,1),g.tag=2,dh(j,g,1))),j.lanes|=1),b)}var Xi=ua.ReactCurrentOwner,Ug=!1;function Yi(b,g,j,d){g.child=b===null?Ch(g,null,j,d):Bh(g,b.child,j,d)}function Zi(b,g,j,d,nt){j=j.render;var at=g.ref;return Tg(g,nt),d=Xh(b,g,j,d,at,nt),j=bi(),b!==null&&!Ug?(g.updateQueue=b.updateQueue,g.flags&=-2053,b.lanes&=~nt,$i(b,g,nt)):(I&&j&&vg(g),g.flags|=1,Yi(b,g,d,nt),g.child)}function aj(b,g,j,d,nt){if(b===null){var at=j.type;return typeof at=="function"&&!bj(at)&&at.defaultProps===void 0&&j.compare===null&&j.defaultProps===void 0?(g.tag=15,g.type=at,cj(b,g,at,d,nt)):(b=yh(j.type,null,d,g,g.mode,nt),b.ref=g.ref,b.return=g,g.child=b)}if(at=b.child,!(b.lanes&nt)){var ht=at.memoizedProps;if(j=j.compare,j=j!==null?j:Ie,j(ht,d)&&b.ref===g.ref)return $i(b,g,nt)}return g.flags|=1,b=wh(at,d),b.ref=g.ref,b.return=g,g.child=b}function cj(b,g,j,d,nt){if(b!==null){var at=b.memoizedProps;if(Ie(at,d)&&b.ref===g.ref)if(Ug=!1,g.pendingProps=d=at,(b.lanes&nt)!==0)b.flags&131072&&(Ug=!0);else return g.lanes=b.lanes,$i(b,g,nt)}return dj(b,g,j,d,nt)}function ej(b,g,j){var d=g.pendingProps,nt=d.children,at=b!==null?b.memoizedState:null;if(d.mode==="hidden")if(!(g.mode&1))g.memoizedState={baseLanes:0,cachePool:null,transitions:null},G(fj,gj),gj|=j;else{if(!(j&1073741824))return b=at!==null?at.baseLanes|j:j,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:b,cachePool:null,transitions:null},g.updateQueue=null,G(fj,gj),gj|=b,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},d=at!==null?at.baseLanes:j,G(fj,gj),gj|=d}else at!==null?(d=at.baseLanes|j,g.memoizedState=null):d=j,G(fj,gj),gj|=d;return Yi(b,g,nt,j),g.child}function hj(b,g){var j=g.ref;(b===null&&j!==null||b!==null&&b.ref!==j)&&(g.flags|=512,g.flags|=2097152)}function dj(b,g,j,d,nt){var at=Zf(j)?Xf:H.current;return at=Yf(g,at),Tg(g,nt),j=Xh(b,g,j,d,at,nt),d=bi(),b!==null&&!Ug?(g.updateQueue=b.updateQueue,g.flags&=-2053,b.lanes&=~nt,$i(b,g,nt)):(I&&d&&vg(g),g.flags|=1,Yi(b,g,j,nt),g.child)}function ij(b,g,j,d,nt){if(Zf(j)){var at=!0;cg(g)}else at=!1;if(Tg(g,nt),g.stateNode===null)jj(b,g),ph(g,j,d),rh(g,j,d,nt),d=!0;else if(b===null){var ht=g.stateNode,_t=g.memoizedProps;ht.props=_t;var bt=ht.context,kt=j.contextType;typeof kt=="object"&&kt!==null?kt=Vg(kt):(kt=Zf(j)?Xf:H.current,kt=Yf(g,kt));var Vt=j.getDerivedStateFromProps,qt=typeof Vt=="function"||typeof ht.getSnapshotBeforeUpdate=="function";qt||typeof ht.UNSAFE_componentWillReceiveProps!="function"&&typeof ht.componentWillReceiveProps!="function"||(_t!==d||bt!==kt)&&qh(g,ht,d,kt),$g=!1;var zt=g.memoizedState;ht.state=zt,gh(g,d,ht,nt),bt=g.memoizedState,_t!==d||zt!==bt||Wf.current||$g?(typeof Vt=="function"&&(kh(g,j,Vt,d),bt=g.memoizedState),(_t=$g||oh(g,j,_t,d,zt,bt,kt))?(qt||typeof ht.UNSAFE_componentWillMount!="function"&&typeof ht.componentWillMount!="function"||(typeof ht.componentWillMount=="function"&&ht.componentWillMount(),typeof ht.UNSAFE_componentWillMount=="function"&&ht.UNSAFE_componentWillMount()),typeof ht.componentDidMount=="function"&&(g.flags|=4194308)):(typeof ht.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=d,g.memoizedState=bt),ht.props=d,ht.state=bt,ht.context=kt,d=_t):(typeof ht.componentDidMount=="function"&&(g.flags|=4194308),d=!1)}else{ht=g.stateNode,bh(b,g),_t=g.memoizedProps,kt=g.type===g.elementType?_t:Lg(g.type,_t),ht.props=kt,qt=g.pendingProps,zt=ht.context,bt=j.contextType,typeof bt=="object"&&bt!==null?bt=Vg(bt):(bt=Zf(j)?Xf:H.current,bt=Yf(g,bt));var jt=j.getDerivedStateFromProps;(Vt=typeof jt=="function"||typeof ht.getSnapshotBeforeUpdate=="function")||typeof ht.UNSAFE_componentWillReceiveProps!="function"&&typeof ht.componentWillReceiveProps!="function"||(_t!==qt||zt!==bt)&&qh(g,ht,d,bt),$g=!1,zt=g.memoizedState,ht.state=zt,gh(g,d,ht,nt);var Kt=g.memoizedState;_t!==qt||zt!==Kt||Wf.current||$g?(typeof jt=="function"&&(kh(g,j,jt,d),Kt=g.memoizedState),(kt=$g||oh(g,j,kt,d,zt,Kt,bt)||!1)?(Vt||typeof ht.UNSAFE_componentWillUpdate!="function"&&typeof ht.componentWillUpdate!="function"||(typeof ht.componentWillUpdate=="function"&&ht.componentWillUpdate(d,Kt,bt),typeof ht.UNSAFE_componentWillUpdate=="function"&&ht.UNSAFE_componentWillUpdate(d,Kt,bt)),typeof ht.componentDidUpdate=="function"&&(g.flags|=4),typeof ht.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof ht.componentDidUpdate!="function"||_t===b.memoizedProps&&zt===b.memoizedState||(g.flags|=4),typeof ht.getSnapshotBeforeUpdate!="function"||_t===b.memoizedProps&&zt===b.memoizedState||(g.flags|=1024),g.memoizedProps=d,g.memoizedState=Kt),ht.props=d,ht.state=Kt,ht.context=bt,d=kt):(typeof ht.componentDidUpdate!="function"||_t===b.memoizedProps&&zt===b.memoizedState||(g.flags|=4),typeof ht.getSnapshotBeforeUpdate!="function"||_t===b.memoizedProps&&zt===b.memoizedState||(g.flags|=1024),d=!1)}return kj(b,g,j,d,at,nt)}function kj(b,g,j,d,nt,at){hj(b,g);var ht=(g.flags&128)!==0;if(!d&&!ht)return nt&&dg(g,j,!1),$i(b,g,at);d=g.stateNode,Xi.current=g;var _t=ht&&typeof j.getDerivedStateFromError!="function"?null:d.render();return g.flags|=1,b!==null&&ht?(g.child=Bh(g,b.child,null,at),g.child=Bh(g,null,_t,at)):Yi(b,g,_t,at),g.memoizedState=d.state,nt&&dg(g,j,!0),g.child}function lj(b){var g=b.stateNode;g.pendingContext?ag(b,g.pendingContext,g.pendingContext!==g.context):g.context&&ag(b,g.context,!1),Ih(b,g.containerInfo)}function mj(b,g,j,d,nt){return Ig(),Jg(nt),g.flags|=256,Yi(b,g,j,d),g.child}var nj={dehydrated:null,treeContext:null,retryLane:0};function oj(b){return{baseLanes:b,cachePool:null,transitions:null}}function pj(b,g,j){var d=g.pendingProps,nt=M.current,at=!1,ht=(g.flags&128)!==0,_t;if((_t=ht)||(_t=b!==null&&b.memoizedState===null?!1:(nt&2)!==0),_t?(at=!0,g.flags&=-129):(b===null||b.memoizedState!==null)&&(nt|=1),G(M,nt&1),b===null)return Eg(g),b=g.memoizedState,b!==null&&(b=b.dehydrated,b!==null)?(g.mode&1?b.data==="$!"?g.lanes=8:g.lanes=1073741824:g.lanes=1,null):(ht=d.children,b=d.fallback,at?(d=g.mode,at=g.child,ht={mode:"hidden",children:ht},!(d&1)&&at!==null?(at.childLanes=0,at.pendingProps=ht):at=qj(ht,d,0,null),b=Ah(b,d,j,null),at.return=g,b.return=g,at.sibling=b,g.child=at,g.child.memoizedState=oj(j),g.memoizedState=nj,b):rj(g,ht));if(nt=b.memoizedState,nt!==null&&(_t=nt.dehydrated,_t!==null))return sj(b,g,ht,d,_t,nt,j);if(at){at=d.fallback,ht=g.mode,nt=b.child,_t=nt.sibling;var bt={mode:"hidden",children:d.children};return!(ht&1)&&g.child!==nt?(d=g.child,d.childLanes=0,d.pendingProps=bt,g.deletions=null):(d=wh(nt,bt),d.subtreeFlags=nt.subtreeFlags&14680064),_t!==null?at=wh(_t,at):(at=Ah(at,ht,j,null),at.flags|=2),at.return=g,d.return=g,d.sibling=at,g.child=d,d=at,at=g.child,ht=b.child.memoizedState,ht=ht===null?oj(j):{baseLanes:ht.baseLanes|j,cachePool:null,transitions:ht.transitions},at.memoizedState=ht,at.childLanes=b.childLanes&~j,g.memoizedState=nj,d}return at=b.child,b=at.sibling,d=wh(at,{mode:"visible",children:d.children}),!(g.mode&1)&&(d.lanes=j),d.return=g,d.sibling=null,b!==null&&(j=g.deletions,j===null?(g.deletions=[b],g.flags|=16):j.push(b)),g.child=d,g.memoizedState=null,d}function rj(b,g){return g=qj({mode:"visible",children:g},b.mode,0,null),g.return=b,b.child=g}function tj(b,g,j,d){return d!==null&&Jg(d),Bh(g,b.child,null,j),b=rj(g,g.pendingProps.children),b.flags|=2,g.memoizedState=null,b}function sj(b,g,j,d,nt,at,ht){if(j)return g.flags&256?(g.flags&=-257,d=Li(Error(p(422))),tj(b,g,ht,d)):g.memoizedState!==null?(g.child=b.child,g.flags|=128,null):(at=d.fallback,nt=g.mode,d=qj({mode:"visible",children:d.children},nt,0,null),at=Ah(at,nt,ht,null),at.flags|=2,d.return=g,at.return=g,d.sibling=at,g.child=d,g.mode&1&&Bh(g,b.child,null,ht),g.child.memoizedState=oj(ht),g.memoizedState=nj,at);if(!(g.mode&1))return tj(b,g,ht,null);if(nt.data==="$!"){if(d=nt.nextSibling&&nt.nextSibling.dataset,d)var _t=d.dgst;return d=_t,at=Error(p(419)),d=Li(at,d,void 0),tj(b,g,ht,d)}if(_t=(ht&b.childLanes)!==0,Ug||_t){if(d=R,d!==null){switch(ht&-ht){case 4:nt=2;break;case 16:nt=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:nt=32;break;case 536870912:nt=268435456;break;default:nt=0}nt=nt&(d.suspendedLanes|ht)?0:nt,nt!==0&&nt!==at.retryLane&&(at.retryLane=nt,Zg(b,nt),mh(d,b,nt,-1))}return uj(),d=Li(Error(p(421))),tj(b,g,ht,d)}return nt.data==="$?"?(g.flags|=128,g.child=b.child,g=vj.bind(null,b),nt._reactRetry=g,null):(b=at.treeContext,yg=Lf(nt.nextSibling),xg=g,I=!0,zg=null,b!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=b.id,sg=b.overflow,qg=g),g=rj(g,d.children),g.flags|=4096,g)}function wj(b,g,j){b.lanes|=g;var d=b.alternate;d!==null&&(d.lanes|=g),Sg(b.return,g,j)}function xj(b,g,j,d,nt){var at=b.memoizedState;at===null?b.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:d,tail:j,tailMode:nt}:(at.isBackwards=g,at.rendering=null,at.renderingStartTime=0,at.last=d,at.tail=j,at.tailMode=nt)}function yj(b,g,j){var d=g.pendingProps,nt=d.revealOrder,at=d.tail;if(Yi(b,g,d.children,j),d=M.current,d&2)d=d&1|2,g.flags|=128;else{if(b!==null&&b.flags&128)e:for(b=g.child;b!==null;){if(b.tag===13)b.memoizedState!==null&&wj(b,j,g);else if(b.tag===19)wj(b,j,g);else if(b.child!==null){b.child.return=b,b=b.child;continue}if(b===g)break e;for(;b.sibling===null;){if(b.return===null||b.return===g)break e;b=b.return}b.sibling.return=b.return,b=b.sibling}d&=1}if(G(M,d),!(g.mode&1))g.memoizedState=null;else switch(nt){case"forwards":for(j=g.child,nt=null;j!==null;)b=j.alternate,b!==null&&Mh(b)===null&&(nt=j),j=j.sibling;j=nt,j===null?(nt=g.child,g.child=null):(nt=j.sibling,j.sibling=null),xj(g,!1,nt,j,at);break;case"backwards":for(j=null,nt=g.child,g.child=null;nt!==null;){if(b=nt.alternate,b!==null&&Mh(b)===null){g.child=nt;break}b=nt.sibling,nt.sibling=j,j=nt,nt=b}xj(g,!0,j,null,at);break;case"together":xj(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function jj(b,g){!(g.mode&1)&&b!==null&&(b.alternate=null,g.alternate=null,g.flags|=2)}function $i(b,g,j){if(b!==null&&(g.dependencies=b.dependencies),hh|=g.lanes,!(j&g.childLanes))return null;if(b!==null&&g.child!==b.child)throw Error(p(153));if(g.child!==null){for(b=g.child,j=wh(b,b.pendingProps),g.child=j,j.return=g;b.sibling!==null;)b=b.sibling,j=j.sibling=wh(b,b.pendingProps),j.return=g;j.sibling=null}return g.child}function zj(b,g,j){switch(g.tag){case 3:lj(g),Ig();break;case 5:Kh(g);break;case 1:Zf(g.type)&&cg(g);break;case 4:Ih(g,g.stateNode.containerInfo);break;case 10:var d=g.type._context,nt=g.memoizedProps.value;G(Mg,d._currentValue),d._currentValue=nt;break;case 13:if(d=g.memoizedState,d!==null)return d.dehydrated!==null?(G(M,M.current&1),g.flags|=128,null):j&g.child.childLanes?pj(b,g,j):(G(M,M.current&1),b=$i(b,g,j),b!==null?b.sibling:null);G(M,M.current&1);break;case 19:if(d=(j&g.childLanes)!==0,b.flags&128){if(d)return yj(b,g,j);g.flags|=128}if(nt=g.memoizedState,nt!==null&&(nt.rendering=null,nt.tail=null,nt.lastEffect=null),G(M,M.current),d)break;return null;case 22:case 23:return g.lanes=0,ej(b,g,j)}return $i(b,g,j)}var Aj,Bj,Cj,Dj;Aj=function(b,g){for(var j=g.child;j!==null;){if(j.tag===5||j.tag===6)b.appendChild(j.stateNode);else if(j.tag!==4&&j.child!==null){j.child.return=j,j=j.child;continue}if(j===g)break;for(;j.sibling===null;){if(j.return===null||j.return===g)return;j=j.return}j.sibling.return=j.return,j=j.sibling}};Bj=function(){};Cj=function(b,g,j,d){var nt=b.memoizedProps;if(nt!==d){b=g.stateNode,Hh(Eh.current);var at=null;switch(j){case"input":nt=Ya(b,nt),d=Ya(b,d),at=[];break;case"select":nt=A({},nt,{value:void 0}),d=A({},d,{value:void 0}),at=[];break;case"textarea":nt=gb(b,nt),d=gb(b,d),at=[];break;default:typeof nt.onClick!="function"&&typeof d.onClick=="function"&&(b.onclick=Bf)}ub(j,d);var ht;j=null;for(kt in nt)if(!d.hasOwnProperty(kt)&&nt.hasOwnProperty(kt)&&nt[kt]!=null)if(kt==="style"){var _t=nt[kt];for(ht in _t)_t.hasOwnProperty(ht)&&(j||(j={}),j[ht]="")}else kt!=="dangerouslySetInnerHTML"&&kt!=="children"&&kt!=="suppressContentEditableWarning"&&kt!=="suppressHydrationWarning"&&kt!=="autoFocus"&&(ea.hasOwnProperty(kt)?at||(at=[]):(at=at||[]).push(kt,null));for(kt in d){var bt=d[kt];if(_t=nt!=null?nt[kt]:void 0,d.hasOwnProperty(kt)&&bt!==_t&&(bt!=null||_t!=null))if(kt==="style")if(_t){for(ht in _t)!_t.hasOwnProperty(ht)||bt&&bt.hasOwnProperty(ht)||(j||(j={}),j[ht]="");for(ht in bt)bt.hasOwnProperty(ht)&&_t[ht]!==bt[ht]&&(j||(j={}),j[ht]=bt[ht])}else j||(at||(at=[]),at.push(kt,j)),j=bt;else kt==="dangerouslySetInnerHTML"?(bt=bt?bt.__html:void 0,_t=_t?_t.__html:void 0,bt!=null&&_t!==bt&&(at=at||[]).push(kt,bt)):kt==="children"?typeof bt!="string"&&typeof bt!="number"||(at=at||[]).push(kt,""+bt):kt!=="suppressContentEditableWarning"&&kt!=="suppressHydrationWarning"&&(ea.hasOwnProperty(kt)?(bt!=null&&kt==="onScroll"&&D("scroll",b),at||_t===bt||(at=[])):(at=at||[]).push(kt,bt))}j&&(at=at||[]).push("style",j);var kt=at;(g.updateQueue=kt)&&(g.flags|=4)}};Dj=function(b,g,j,d){j!==d&&(g.flags|=4)};function Ej(b,g){if(!I)switch(b.tailMode){case"hidden":g=b.tail;for(var j=null;g!==null;)g.alternate!==null&&(j=g),g=g.sibling;j===null?b.tail=null:j.sibling=null;break;case"collapsed":j=b.tail;for(var d=null;j!==null;)j.alternate!==null&&(d=j),j=j.sibling;d===null?g||b.tail===null?b.tail=null:b.tail.sibling=null:d.sibling=null}}function S(b){var g=b.alternate!==null&&b.alternate.child===b.child,j=0,d=0;if(g)for(var nt=b.child;nt!==null;)j|=nt.lanes|nt.childLanes,d|=nt.subtreeFlags&14680064,d|=nt.flags&14680064,nt.return=b,nt=nt.sibling;else for(nt=b.child;nt!==null;)j|=nt.lanes|nt.childLanes,d|=nt.subtreeFlags,d|=nt.flags,nt.return=b,nt=nt.sibling;return b.subtreeFlags|=d,b.childLanes=j,g}function Fj(b,g,j){var d=g.pendingProps;switch(wg(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S(g),null;case 1:return Zf(g.type)&&$f(),S(g),null;case 3:return d=g.stateNode,Jh(),E(Wf),E(H),Oh(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(b===null||b.child===null)&&(Gg(g)?g.flags|=4:b===null||b.memoizedState.isDehydrated&&!(g.flags&256)||(g.flags|=1024,zg!==null&&(Gj(zg),zg=null))),Bj(b,g),S(g),null;case 5:Lh(g);var nt=Hh(Gh.current);if(j=g.type,b!==null&&g.stateNode!=null)Cj(b,g,j,d,nt),b.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!d){if(g.stateNode===null)throw Error(p(166));return S(g),null}if(b=Hh(Eh.current),Gg(g)){d=g.stateNode,j=g.type;var at=g.memoizedProps;switch(d[Of]=g,d[Pf]=at,b=(g.mode&1)!==0,j){case"dialog":D("cancel",d),D("close",d);break;case"iframe":case"object":case"embed":D("load",d);break;case"video":case"audio":for(nt=0;nt<lf.length;nt++)D(lf[nt],d);break;case"source":D("error",d);break;case"img":case"image":case"link":D("error",d),D("load",d);break;case"details":D("toggle",d);break;case"input":Za(d,at),D("invalid",d);break;case"select":d._wrapperState={wasMultiple:!!at.multiple},D("invalid",d);break;case"textarea":hb(d,at),D("invalid",d)}ub(j,at),nt=null;for(var ht in at)if(at.hasOwnProperty(ht)){var _t=at[ht];ht==="children"?typeof _t=="string"?d.textContent!==_t&&(at.suppressHydrationWarning!==!0&&Af(d.textContent,_t,b),nt=["children",_t]):typeof _t=="number"&&d.textContent!==""+_t&&(at.suppressHydrationWarning!==!0&&Af(d.textContent,_t,b),nt=["children",""+_t]):ea.hasOwnProperty(ht)&&_t!=null&&ht==="onScroll"&&D("scroll",d)}switch(j){case"input":Va(d),db(d,at,!0);break;case"textarea":Va(d),jb(d);break;case"select":case"option":break;default:typeof at.onClick=="function"&&(d.onclick=Bf)}d=nt,g.updateQueue=d,d!==null&&(g.flags|=4)}else{ht=nt.nodeType===9?nt:nt.ownerDocument,b==="http://www.w3.org/1999/xhtml"&&(b=kb(j)),b==="http://www.w3.org/1999/xhtml"?j==="script"?(b=ht.createElement("div"),b.innerHTML="<script><\/script>",b=b.removeChild(b.firstChild)):typeof d.is=="string"?b=ht.createElement(j,{is:d.is}):(b=ht.createElement(j),j==="select"&&(ht=b,d.multiple?ht.multiple=!0:d.size&&(ht.size=d.size))):b=ht.createElementNS(b,j),b[Of]=g,b[Pf]=d,Aj(b,g,!1,!1),g.stateNode=b;e:{switch(ht=vb(j,d),j){case"dialog":D("cancel",b),D("close",b),nt=d;break;case"iframe":case"object":case"embed":D("load",b),nt=d;break;case"video":case"audio":for(nt=0;nt<lf.length;nt++)D(lf[nt],b);nt=d;break;case"source":D("error",b),nt=d;break;case"img":case"image":case"link":D("error",b),D("load",b),nt=d;break;case"details":D("toggle",b),nt=d;break;case"input":Za(b,d),nt=Ya(b,d),D("invalid",b);break;case"option":nt=d;break;case"select":b._wrapperState={wasMultiple:!!d.multiple},nt=A({},d,{value:void 0}),D("invalid",b);break;case"textarea":hb(b,d),nt=gb(b,d),D("invalid",b);break;default:nt=d}ub(j,nt),_t=nt;for(at in _t)if(_t.hasOwnProperty(at)){var bt=_t[at];at==="style"?sb(b,bt):at==="dangerouslySetInnerHTML"?(bt=bt?bt.__html:void 0,bt!=null&&nb(b,bt)):at==="children"?typeof bt=="string"?(j!=="textarea"||bt!=="")&&ob(b,bt):typeof bt=="number"&&ob(b,""+bt):at!=="suppressContentEditableWarning"&&at!=="suppressHydrationWarning"&&at!=="autoFocus"&&(ea.hasOwnProperty(at)?bt!=null&&at==="onScroll"&&D("scroll",b):bt!=null&&ta(b,at,bt,ht))}switch(j){case"input":Va(b),db(b,d,!1);break;case"textarea":Va(b),jb(b);break;case"option":d.value!=null&&b.setAttribute("value",""+Sa(d.value));break;case"select":b.multiple=!!d.multiple,at=d.value,at!=null?fb(b,!!d.multiple,at,!1):d.defaultValue!=null&&fb(b,!!d.multiple,d.defaultValue,!0);break;default:typeof nt.onClick=="function"&&(b.onclick=Bf)}switch(j){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}}d&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return S(g),null;case 6:if(b&&g.stateNode!=null)Dj(b,g,b.memoizedProps,d);else{if(typeof d!="string"&&g.stateNode===null)throw Error(p(166));if(j=Hh(Gh.current),Hh(Eh.current),Gg(g)){if(d=g.stateNode,j=g.memoizedProps,d[Of]=g,(at=d.nodeValue!==j)&&(b=xg,b!==null))switch(b.tag){case 3:Af(d.nodeValue,j,(b.mode&1)!==0);break;case 5:b.memoizedProps.suppressHydrationWarning!==!0&&Af(d.nodeValue,j,(b.mode&1)!==0)}at&&(g.flags|=4)}else d=(j.nodeType===9?j:j.ownerDocument).createTextNode(d),d[Of]=g,g.stateNode=d}return S(g),null;case 13:if(E(M),d=g.memoizedState,b===null||b.memoizedState!==null&&b.memoizedState.dehydrated!==null){if(I&&yg!==null&&g.mode&1&&!(g.flags&128))Hg(),Ig(),g.flags|=98560,at=!1;else if(at=Gg(g),d!==null&&d.dehydrated!==null){if(b===null){if(!at)throw Error(p(318));if(at=g.memoizedState,at=at!==null?at.dehydrated:null,!at)throw Error(p(317));at[Of]=g}else Ig(),!(g.flags&128)&&(g.memoizedState=null),g.flags|=4;S(g),at=!1}else zg!==null&&(Gj(zg),zg=null),at=!0;if(!at)return g.flags&65536?g:null}return g.flags&128?(g.lanes=j,g):(d=d!==null,d!==(b!==null&&b.memoizedState!==null)&&d&&(g.child.flags|=8192,g.mode&1&&(b===null||M.current&1?T===0&&(T=3):uj())),g.updateQueue!==null&&(g.flags|=4),S(g),null);case 4:return Jh(),Bj(b,g),b===null&&sf(g.stateNode.containerInfo),S(g),null;case 10:return Rg(g.type._context),S(g),null;case 17:return Zf(g.type)&&$f(),S(g),null;case 19:if(E(M),at=g.memoizedState,at===null)return S(g),null;if(d=(g.flags&128)!==0,ht=at.rendering,ht===null)if(d)Ej(at,!1);else{if(T!==0||b!==null&&b.flags&128)for(b=g.child;b!==null;){if(ht=Mh(b),ht!==null){for(g.flags|=128,Ej(at,!1),d=ht.updateQueue,d!==null&&(g.updateQueue=d,g.flags|=4),g.subtreeFlags=0,d=j,j=g.child;j!==null;)at=j,b=d,at.flags&=14680066,ht=at.alternate,ht===null?(at.childLanes=0,at.lanes=b,at.child=null,at.subtreeFlags=0,at.memoizedProps=null,at.memoizedState=null,at.updateQueue=null,at.dependencies=null,at.stateNode=null):(at.childLanes=ht.childLanes,at.lanes=ht.lanes,at.child=ht.child,at.subtreeFlags=0,at.deletions=null,at.memoizedProps=ht.memoizedProps,at.memoizedState=ht.memoizedState,at.updateQueue=ht.updateQueue,at.type=ht.type,b=ht.dependencies,at.dependencies=b===null?null:{lanes:b.lanes,firstContext:b.firstContext}),j=j.sibling;return G(M,M.current&1|2),g.child}b=b.sibling}at.tail!==null&&B()>Hj&&(g.flags|=128,d=!0,Ej(at,!1),g.lanes=4194304)}else{if(!d)if(b=Mh(ht),b!==null){if(g.flags|=128,d=!0,j=b.updateQueue,j!==null&&(g.updateQueue=j,g.flags|=4),Ej(at,!0),at.tail===null&&at.tailMode==="hidden"&&!ht.alternate&&!I)return S(g),null}else 2*B()-at.renderingStartTime>Hj&&j!==1073741824&&(g.flags|=128,d=!0,Ej(at,!1),g.lanes=4194304);at.isBackwards?(ht.sibling=g.child,g.child=ht):(j=at.last,j!==null?j.sibling=ht:g.child=ht,at.last=ht)}return at.tail!==null?(g=at.tail,at.rendering=g,at.tail=g.sibling,at.renderingStartTime=B(),g.sibling=null,j=M.current,G(M,d?j&1|2:j&1),g):(S(g),null);case 22:case 23:return Ij(),d=g.memoizedState!==null,b!==null&&b.memoizedState!==null!==d&&(g.flags|=8192),d&&g.mode&1?gj&1073741824&&(S(g),g.subtreeFlags&6&&(g.flags|=8192)):S(g),null;case 24:return null;case 25:return null}throw Error(p(156,g.tag))}function Jj(b,g){switch(wg(g),g.tag){case 1:return Zf(g.type)&&$f(),b=g.flags,b&65536?(g.flags=b&-65537|128,g):null;case 3:return Jh(),E(Wf),E(H),Oh(),b=g.flags,b&65536&&!(b&128)?(g.flags=b&-65537|128,g):null;case 5:return Lh(g),null;case 13:if(E(M),b=g.memoizedState,b!==null&&b.dehydrated!==null){if(g.alternate===null)throw Error(p(340));Ig()}return b=g.flags,b&65536?(g.flags=b&-65537|128,g):null;case 19:return E(M),null;case 4:return Jh(),null;case 10:return Rg(g.type._context),null;case 22:case 23:return Ij(),null;case 24:return null;default:return null}}var Kj=!1,U=!1,Lj=typeof WeakSet=="function"?WeakSet:Set,V=null;function Mj(b,g){var j=b.ref;if(j!==null)if(typeof j=="function")try{j(null)}catch(d){W(b,g,d)}else j.current=null}function Nj(b,g,j){try{j()}catch(d){W(b,g,d)}}var Oj=!1;function Pj(b,g){if(Cf=dd,b=Me(),Ne(b)){if("selectionStart"in b)var j={start:b.selectionStart,end:b.selectionEnd};else e:{j=(j=b.ownerDocument)&&j.defaultView||window;var d=j.getSelection&&j.getSelection();if(d&&d.rangeCount!==0){j=d.anchorNode;var nt=d.anchorOffset,at=d.focusNode;d=d.focusOffset;try{j.nodeType,at.nodeType}catch{j=null;break e}var ht=0,_t=-1,bt=-1,kt=0,Vt=0,qt=b,zt=null;t:for(;;){for(var jt;qt!==j||nt!==0&&qt.nodeType!==3||(_t=ht+nt),qt!==at||d!==0&&qt.nodeType!==3||(bt=ht+d),qt.nodeType===3&&(ht+=qt.nodeValue.length),(jt=qt.firstChild)!==null;)zt=qt,qt=jt;for(;;){if(qt===b)break t;if(zt===j&&++kt===nt&&(_t=ht),zt===at&&++Vt===d&&(bt=ht),(jt=qt.nextSibling)!==null)break;qt=zt,zt=qt.parentNode}qt=jt}j=_t===-1||bt===-1?null:{start:_t,end:bt}}else j=null}j=j||{start:0,end:0}}else j=null;for(Df={focusedElem:b,selectionRange:j},dd=!1,V=g;V!==null;)if(g=V,b=g.child,(g.subtreeFlags&1028)!==0&&b!==null)b.return=g,V=b;else for(;V!==null;){g=V;try{var Kt=g.alternate;if(g.flags&1024)switch(g.tag){case 0:case 11:case 15:break;case 1:if(Kt!==null){var Ft=Kt.memoizedProps,nn=Kt.memoizedState,Lt=g.stateNode,Nt=Lt.getSnapshotBeforeUpdate(g.elementType===g.type?Ft:Lg(g.type,Ft),nn);Lt.__reactInternalSnapshotBeforeUpdate=Nt}break;case 3:var Ht=g.stateNode.containerInfo;Ht.nodeType===1?Ht.textContent="":Ht.nodeType===9&&Ht.documentElement&&Ht.removeChild(Ht.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p(163))}}catch(on){W(g,g.return,on)}if(b=g.sibling,b!==null){b.return=g.return,V=b;break}V=g.return}return Kt=Oj,Oj=!1,Kt}function Qj(b,g,j){var d=g.updateQueue;if(d=d!==null?d.lastEffect:null,d!==null){var nt=d=d.next;do{if((nt.tag&b)===b){var at=nt.destroy;nt.destroy=void 0,at!==void 0&&Nj(g,j,at)}nt=nt.next}while(nt!==d)}}function Rj(b,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var j=g=g.next;do{if((j.tag&b)===b){var d=j.create;j.destroy=d()}j=j.next}while(j!==g)}}function Sj(b){var g=b.ref;if(g!==null){var j=b.stateNode;switch(b.tag){case 5:b=j;break;default:b=j}typeof g=="function"?g(b):g.current=b}}function Tj(b){var g=b.alternate;g!==null&&(b.alternate=null,Tj(g)),b.child=null,b.deletions=null,b.sibling=null,b.tag===5&&(g=b.stateNode,g!==null&&(delete g[Of],delete g[Pf],delete g[of],delete g[Qf],delete g[Rf])),b.stateNode=null,b.return=null,b.dependencies=null,b.memoizedProps=null,b.memoizedState=null,b.pendingProps=null,b.stateNode=null,b.updateQueue=null}function Uj(b){return b.tag===5||b.tag===3||b.tag===4}function Vj(b){e:for(;;){for(;b.sibling===null;){if(b.return===null||Uj(b.return))return null;b=b.return}for(b.sibling.return=b.return,b=b.sibling;b.tag!==5&&b.tag!==6&&b.tag!==18;){if(b.flags&2||b.child===null||b.tag===4)continue e;b.child.return=b,b=b.child}if(!(b.flags&2))return b.stateNode}}function Wj(b,g,j){var d=b.tag;if(d===5||d===6)b=b.stateNode,g?j.nodeType===8?j.parentNode.insertBefore(b,g):j.insertBefore(b,g):(j.nodeType===8?(g=j.parentNode,g.insertBefore(b,j)):(g=j,g.appendChild(b)),j=j._reactRootContainer,j!=null||g.onclick!==null||(g.onclick=Bf));else if(d!==4&&(b=b.child,b!==null))for(Wj(b,g,j),b=b.sibling;b!==null;)Wj(b,g,j),b=b.sibling}function Xj(b,g,j){var d=b.tag;if(d===5||d===6)b=b.stateNode,g?j.insertBefore(b,g):j.appendChild(b);else if(d!==4&&(b=b.child,b!==null))for(Xj(b,g,j),b=b.sibling;b!==null;)Xj(b,g,j),b=b.sibling}var X=null,Yj=!1;function Zj(b,g,j){for(j=j.child;j!==null;)ak(b,g,j),j=j.sibling}function ak(b,g,j){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,j)}catch{}switch(j.tag){case 5:U||Mj(j,g);case 6:var d=X,nt=Yj;X=null,Zj(b,g,j),X=d,Yj=nt,X!==null&&(Yj?(b=X,j=j.stateNode,b.nodeType===8?b.parentNode.removeChild(j):b.removeChild(j)):X.removeChild(j.stateNode));break;case 18:X!==null&&(Yj?(b=X,j=j.stateNode,b.nodeType===8?Kf(b.parentNode,j):b.nodeType===1&&Kf(b,j),bd(b)):Kf(X,j.stateNode));break;case 4:d=X,nt=Yj,X=j.stateNode.containerInfo,Yj=!0,Zj(b,g,j),X=d,Yj=nt;break;case 0:case 11:case 14:case 15:if(!U&&(d=j.updateQueue,d!==null&&(d=d.lastEffect,d!==null))){nt=d=d.next;do{var at=nt,ht=at.destroy;at=at.tag,ht!==void 0&&(at&2||at&4)&&Nj(j,g,ht),nt=nt.next}while(nt!==d)}Zj(b,g,j);break;case 1:if(!U&&(Mj(j,g),d=j.stateNode,typeof d.componentWillUnmount=="function"))try{d.props=j.memoizedProps,d.state=j.memoizedState,d.componentWillUnmount()}catch(_t){W(j,g,_t)}Zj(b,g,j);break;case 21:Zj(b,g,j);break;case 22:j.mode&1?(U=(d=U)||j.memoizedState!==null,Zj(b,g,j),U=d):Zj(b,g,j);break;default:Zj(b,g,j)}}function bk(b){var g=b.updateQueue;if(g!==null){b.updateQueue=null;var j=b.stateNode;j===null&&(j=b.stateNode=new Lj),g.forEach(function(d){var nt=ck.bind(null,b,d);j.has(d)||(j.add(d),d.then(nt,nt))})}}function dk(b,g){var j=g.deletions;if(j!==null)for(var d=0;d<j.length;d++){var nt=j[d];try{var at=b,ht=g,_t=ht;e:for(;_t!==null;){switch(_t.tag){case 5:X=_t.stateNode,Yj=!1;break e;case 3:X=_t.stateNode.containerInfo,Yj=!0;break e;case 4:X=_t.stateNode.containerInfo,Yj=!0;break e}_t=_t.return}if(X===null)throw Error(p(160));ak(at,ht,nt),X=null,Yj=!1;var bt=nt.alternate;bt!==null&&(bt.return=null),nt.return=null}catch(kt){W(nt,g,kt)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)ek(g,b),g=g.sibling}function ek(b,g){var j=b.alternate,d=b.flags;switch(b.tag){case 0:case 11:case 14:case 15:if(dk(g,b),fk(b),d&4){try{Qj(3,b,b.return),Rj(3,b)}catch(Ft){W(b,b.return,Ft)}try{Qj(5,b,b.return)}catch(Ft){W(b,b.return,Ft)}}break;case 1:dk(g,b),fk(b),d&512&&j!==null&&Mj(j,j.return);break;case 5:if(dk(g,b),fk(b),d&512&&j!==null&&Mj(j,j.return),b.flags&32){var nt=b.stateNode;try{ob(nt,"")}catch(Ft){W(b,b.return,Ft)}}if(d&4&&(nt=b.stateNode,nt!=null)){var at=b.memoizedProps,ht=j!==null?j.memoizedProps:at,_t=b.type,bt=b.updateQueue;if(b.updateQueue=null,bt!==null)try{_t==="input"&&at.type==="radio"&&at.name!=null&&ab(nt,at),vb(_t,ht);var kt=vb(_t,at);for(ht=0;ht<bt.length;ht+=2){var Vt=bt[ht],qt=bt[ht+1];Vt==="style"?sb(nt,qt):Vt==="dangerouslySetInnerHTML"?nb(nt,qt):Vt==="children"?ob(nt,qt):ta(nt,Vt,qt,kt)}switch(_t){case"input":bb(nt,at);break;case"textarea":ib(nt,at);break;case"select":var zt=nt._wrapperState.wasMultiple;nt._wrapperState.wasMultiple=!!at.multiple;var jt=at.value;jt!=null?fb(nt,!!at.multiple,jt,!1):zt!==!!at.multiple&&(at.defaultValue!=null?fb(nt,!!at.multiple,at.defaultValue,!0):fb(nt,!!at.multiple,at.multiple?[]:"",!1))}nt[Pf]=at}catch(Ft){W(b,b.return,Ft)}}break;case 6:if(dk(g,b),fk(b),d&4){if(b.stateNode===null)throw Error(p(162));nt=b.stateNode,at=b.memoizedProps;try{nt.nodeValue=at}catch(Ft){W(b,b.return,Ft)}}break;case 3:if(dk(g,b),fk(b),d&4&&j!==null&&j.memoizedState.isDehydrated)try{bd(g.containerInfo)}catch(Ft){W(b,b.return,Ft)}break;case 4:dk(g,b),fk(b);break;case 13:dk(g,b),fk(b),nt=b.child,nt.flags&8192&&(at=nt.memoizedState!==null,nt.stateNode.isHidden=at,!at||nt.alternate!==null&&nt.alternate.memoizedState!==null||(gk=B())),d&4&&bk(b);break;case 22:if(Vt=j!==null&&j.memoizedState!==null,b.mode&1?(U=(kt=U)||Vt,dk(g,b),U=kt):dk(g,b),fk(b),d&8192){if(kt=b.memoizedState!==null,(b.stateNode.isHidden=kt)&&!Vt&&b.mode&1)for(V=b,Vt=b.child;Vt!==null;){for(qt=V=Vt;V!==null;){switch(zt=V,jt=zt.child,zt.tag){case 0:case 11:case 14:case 15:Qj(4,zt,zt.return);break;case 1:Mj(zt,zt.return);var Kt=zt.stateNode;if(typeof Kt.componentWillUnmount=="function"){d=zt,j=zt.return;try{g=d,Kt.props=g.memoizedProps,Kt.state=g.memoizedState,Kt.componentWillUnmount()}catch(Ft){W(d,j,Ft)}}break;case 5:Mj(zt,zt.return);break;case 22:if(zt.memoizedState!==null){hk(qt);continue}}jt!==null?(jt.return=zt,V=jt):hk(qt)}Vt=Vt.sibling}e:for(Vt=null,qt=b;;){if(qt.tag===5){if(Vt===null){Vt=qt;try{nt=qt.stateNode,kt?(at=nt.style,typeof at.setProperty=="function"?at.setProperty("display","none","important"):at.display="none"):(_t=qt.stateNode,bt=qt.memoizedProps.style,ht=bt!=null&&bt.hasOwnProperty("display")?bt.display:null,_t.style.display=rb("display",ht))}catch(Ft){W(b,b.return,Ft)}}}else if(qt.tag===6){if(Vt===null)try{qt.stateNode.nodeValue=kt?"":qt.memoizedProps}catch(Ft){W(b,b.return,Ft)}}else if((qt.tag!==22&&qt.tag!==23||qt.memoizedState===null||qt===b)&&qt.child!==null){qt.child.return=qt,qt=qt.child;continue}if(qt===b)break e;for(;qt.sibling===null;){if(qt.return===null||qt.return===b)break e;Vt===qt&&(Vt=null),qt=qt.return}Vt===qt&&(Vt=null),qt.sibling.return=qt.return,qt=qt.sibling}}break;case 19:dk(g,b),fk(b),d&4&&bk(b);break;case 21:break;default:dk(g,b),fk(b)}}function fk(b){var g=b.flags;if(g&2){try{e:{for(var j=b.return;j!==null;){if(Uj(j)){var d=j;break e}j=j.return}throw Error(p(160))}switch(d.tag){case 5:var nt=d.stateNode;d.flags&32&&(ob(nt,""),d.flags&=-33);var at=Vj(b);Xj(b,at,nt);break;case 3:case 4:var ht=d.stateNode.containerInfo,_t=Vj(b);Wj(b,_t,ht);break;default:throw Error(p(161))}}catch(bt){W(b,b.return,bt)}b.flags&=-3}g&4096&&(b.flags&=-4097)}function ik(b,g,j){V=b,jk(b)}function jk(b,g,j){for(var d=(b.mode&1)!==0;V!==null;){var nt=V,at=nt.child;if(nt.tag===22&&d){var ht=nt.memoizedState!==null||Kj;if(!ht){var _t=nt.alternate,bt=_t!==null&&_t.memoizedState!==null||U;_t=Kj;var kt=U;if(Kj=ht,(U=bt)&&!kt)for(V=nt;V!==null;)ht=V,bt=ht.child,ht.tag===22&&ht.memoizedState!==null?kk(nt):bt!==null?(bt.return=ht,V=bt):kk(nt);for(;at!==null;)V=at,jk(at),at=at.sibling;V=nt,Kj=_t,U=kt}lk(b)}else nt.subtreeFlags&8772&&at!==null?(at.return=nt,V=at):lk(b)}}function lk(b){for(;V!==null;){var g=V;if(g.flags&8772){var j=g.alternate;try{if(g.flags&8772)switch(g.tag){case 0:case 11:case 15:U||Rj(5,g);break;case 1:var d=g.stateNode;if(g.flags&4&&!U)if(j===null)d.componentDidMount();else{var nt=g.elementType===g.type?j.memoizedProps:Lg(g.type,j.memoizedProps);d.componentDidUpdate(nt,j.memoizedState,d.__reactInternalSnapshotBeforeUpdate)}var at=g.updateQueue;at!==null&&ih(g,at,d);break;case 3:var ht=g.updateQueue;if(ht!==null){if(j=null,g.child!==null)switch(g.child.tag){case 5:j=g.child.stateNode;break;case 1:j=g.child.stateNode}ih(g,ht,j)}break;case 5:var _t=g.stateNode;if(j===null&&g.flags&4){j=_t;var bt=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":bt.autoFocus&&j.focus();break;case"img":bt.src&&(j.src=bt.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var kt=g.alternate;if(kt!==null){var Vt=kt.memoizedState;if(Vt!==null){var qt=Vt.dehydrated;qt!==null&&bd(qt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p(163))}U||g.flags&512&&Sj(g)}catch(zt){W(g,g.return,zt)}}if(g===b){V=null;break}if(j=g.sibling,j!==null){j.return=g.return,V=j;break}V=g.return}}function hk(b){for(;V!==null;){var g=V;if(g===b){V=null;break}var j=g.sibling;if(j!==null){j.return=g.return,V=j;break}V=g.return}}function kk(b){for(;V!==null;){var g=V;try{switch(g.tag){case 0:case 11:case 15:var j=g.return;try{Rj(4,g)}catch(bt){W(g,j,bt)}break;case 1:var d=g.stateNode;if(typeof d.componentDidMount=="function"){var nt=g.return;try{d.componentDidMount()}catch(bt){W(g,nt,bt)}}var at=g.return;try{Sj(g)}catch(bt){W(g,at,bt)}break;case 5:var ht=g.return;try{Sj(g)}catch(bt){W(g,ht,bt)}}}catch(bt){W(g,g.return,bt)}if(g===b){V=null;break}var _t=g.sibling;if(_t!==null){_t.return=g.return,V=_t;break}V=g.return}}var mk=Math.ceil,nk=ua.ReactCurrentDispatcher,ok=ua.ReactCurrentOwner,pk=ua.ReactCurrentBatchConfig,K=0,R=null,Y=null,Z=0,gj=0,fj=Uf(0),T=0,qk=null,hh=0,rk=0,sk=0,tk=null,uk=null,gk=0,Hj=1/0,vk=null,Pi=!1,Qi=null,Si=null,wk=!1,xk=null,yk=0,zk=0,Ak=null,Bk=-1,Ck=0;function L(){return K&6?B():Bk!==-1?Bk:Bk=B()}function lh(b){return b.mode&1?K&2&&Z!==0?Z&-Z:Kg.transition!==null?(Ck===0&&(Ck=yc()),Ck):(b=C,b!==0||(b=window.event,b=b===void 0?16:jd(b.type)),b):1}function mh(b,g,j,d){if(50<zk)throw zk=0,Ak=null,Error(p(185));Ac(b,j,d),(!(K&2)||b!==R)&&(b===R&&(!(K&2)&&(rk|=j),T===4&&Dk(b,Z)),Ek(b,d),j===1&&K===0&&!(g.mode&1)&&(Hj=B()+500,fg&&jg()))}function Ek(b,g){var j=b.callbackNode;wc(b,g);var d=uc(b,b===R?Z:0);if(d===0)j!==null&&bc(j),b.callbackNode=null,b.callbackPriority=0;else if(g=d&-d,b.callbackPriority!==g){if(j!=null&&bc(j),g===1)b.tag===0?ig(Fk.bind(null,b)):hg(Fk.bind(null,b)),Jf(function(){!(K&6)&&jg()}),j=null;else{switch(Dc(d)){case 1:j=fc;break;case 4:j=gc;break;case 16:j=hc;break;case 536870912:j=jc;break;default:j=hc}j=Gk(j,Hk.bind(null,b))}b.callbackPriority=g,b.callbackNode=j}}function Hk(b,g){if(Bk=-1,Ck=0,K&6)throw Error(p(327));var j=b.callbackNode;if(Ik()&&b.callbackNode!==j)return null;var d=uc(b,b===R?Z:0);if(d===0)return null;if(d&30||d&b.expiredLanes||g)g=Jk(b,d);else{g=d;var nt=K;K|=2;var at=Kk();(R!==b||Z!==g)&&(vk=null,Hj=B()+500,Lk(b,g));do try{Mk();break}catch(_t){Nk(b,_t)}while(1);Qg(),nk.current=at,K=nt,Y!==null?g=0:(R=null,Z=0,g=T)}if(g!==0){if(g===2&&(nt=xc(b),nt!==0&&(d=nt,g=Ok(b,nt))),g===1)throw j=qk,Lk(b,0),Dk(b,d),Ek(b,B()),j;if(g===6)Dk(b,d);else{if(nt=b.current.alternate,!(d&30)&&!Pk(nt)&&(g=Jk(b,d),g===2&&(at=xc(b),at!==0&&(d=at,g=Ok(b,at))),g===1))throw j=qk,Lk(b,0),Dk(b,d),Ek(b,B()),j;switch(b.finishedWork=nt,b.finishedLanes=d,g){case 0:case 1:throw Error(p(345));case 2:Qk(b,uk,vk);break;case 3:if(Dk(b,d),(d&130023424)===d&&(g=gk+500-B(),10<g)){if(uc(b,0)!==0)break;if(nt=b.suspendedLanes,(nt&d)!==d){L(),b.pingedLanes|=b.suspendedLanes&nt;break}b.timeoutHandle=Ff(Qk.bind(null,b,uk,vk),g);break}Qk(b,uk,vk);break;case 4:if(Dk(b,d),(d&4194240)===d)break;for(g=b.eventTimes,nt=-1;0<d;){var ht=31-oc(d);at=1<<ht,ht=g[ht],ht>nt&&(nt=ht),d&=~at}if(d=nt,d=B()-d,d=(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3e3>d?3e3:4320>d?4320:1960*mk(d/1960))-d,10<d){b.timeoutHandle=Ff(Qk.bind(null,b,uk,vk),d);break}Qk(b,uk,vk);break;case 5:Qk(b,uk,vk);break;default:throw Error(p(329))}}}return Ek(b,B()),b.callbackNode===j?Hk.bind(null,b):null}function Ok(b,g){var j=tk;return b.current.memoizedState.isDehydrated&&(Lk(b,g).flags|=256),b=Jk(b,g),b!==2&&(g=uk,uk=j,g!==null&&Gj(g)),b}function Gj(b){uk===null?uk=b:uk.push.apply(uk,b)}function Pk(b){for(var g=b;;){if(g.flags&16384){var j=g.updateQueue;if(j!==null&&(j=j.stores,j!==null))for(var d=0;d<j.length;d++){var nt=j[d],at=nt.getSnapshot;nt=nt.value;try{if(!He(at(),nt))return!1}catch{return!1}}}if(j=g.child,g.subtreeFlags&16384&&j!==null)j.return=g,g=j;else{if(g===b)break;for(;g.sibling===null;){if(g.return===null||g.return===b)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function Dk(b,g){for(g&=~sk,g&=~rk,b.suspendedLanes|=g,b.pingedLanes&=~g,b=b.expirationTimes;0<g;){var j=31-oc(g),d=1<<j;b[j]=-1,g&=~d}}function Fk(b){if(K&6)throw Error(p(327));Ik();var g=uc(b,0);if(!(g&1))return Ek(b,B()),null;var j=Jk(b,g);if(b.tag!==0&&j===2){var d=xc(b);d!==0&&(g=d,j=Ok(b,d))}if(j===1)throw j=qk,Lk(b,0),Dk(b,g),Ek(b,B()),j;if(j===6)throw Error(p(345));return b.finishedWork=b.current.alternate,b.finishedLanes=g,Qk(b,uk,vk),Ek(b,B()),null}function Rk(b,g){var j=K;K|=1;try{return b(g)}finally{K=j,K===0&&(Hj=B()+500,fg&&jg())}}function Sk(b){xk!==null&&xk.tag===0&&!(K&6)&&Ik();var g=K;K|=1;var j=pk.transition,d=C;try{if(pk.transition=null,C=1,b)return b()}finally{C=d,pk.transition=j,K=g,!(K&6)&&jg()}}function Ij(){gj=fj.current,E(fj)}function Lk(b,g){b.finishedWork=null,b.finishedLanes=0;var j=b.timeoutHandle;if(j!==-1&&(b.timeoutHandle=-1,Gf(j)),Y!==null)for(j=Y.return;j!==null;){var d=j;switch(wg(d),d.tag){case 1:d=d.type.childContextTypes,d!=null&&$f();break;case 3:Jh(),E(Wf),E(H),Oh();break;case 5:Lh(d);break;case 4:Jh();break;case 13:E(M);break;case 19:E(M);break;case 10:Rg(d.type._context);break;case 22:case 23:Ij()}j=j.return}if(R=b,Y=b=wh(b.current,null),Z=gj=g,T=0,qk=null,sk=rk=hh=0,uk=tk=null,Wg!==null){for(g=0;g<Wg.length;g++)if(j=Wg[g],d=j.interleaved,d!==null){j.interleaved=null;var nt=d.next,at=j.pending;if(at!==null){var ht=at.next;at.next=nt,d.next=ht}j.pending=d}Wg=null}return b}function Nk(b,g){do{var j=Y;try{if(Qg(),Ph.current=ai,Sh){for(var d=N.memoizedState;d!==null;){var nt=d.queue;nt!==null&&(nt.pending=null),d=d.next}Sh=!1}if(Rh=0,P=O=N=null,Th=!1,Uh=0,ok.current=null,j===null||j.return===null){T=1,qk=g,Y=null;break}e:{var at=b,ht=j.return,_t=j,bt=g;if(g=Z,_t.flags|=32768,bt!==null&&typeof bt=="object"&&typeof bt.then=="function"){var kt=bt,Vt=_t,qt=Vt.tag;if(!(Vt.mode&1)&&(qt===0||qt===11||qt===15)){var zt=Vt.alternate;zt?(Vt.updateQueue=zt.updateQueue,Vt.memoizedState=zt.memoizedState,Vt.lanes=zt.lanes):(Vt.updateQueue=null,Vt.memoizedState=null)}var jt=Vi(ht);if(jt!==null){jt.flags&=-257,Wi(jt,ht,_t,at,g),jt.mode&1&&Ti(at,kt,g),g=jt,bt=kt;var Kt=g.updateQueue;if(Kt===null){var Ft=new Set;Ft.add(bt),g.updateQueue=Ft}else Kt.add(bt);break e}else{if(!(g&1)){Ti(at,kt,g),uj();break e}bt=Error(p(426))}}else if(I&&_t.mode&1){var nn=Vi(ht);if(nn!==null){!(nn.flags&65536)&&(nn.flags|=256),Wi(nn,ht,_t,at,g),Jg(Ki(bt,_t));break e}}at=bt=Ki(bt,_t),T!==4&&(T=2),tk===null?tk=[at]:tk.push(at),at=ht;do{switch(at.tag){case 3:at.flags|=65536,g&=-g,at.lanes|=g;var Lt=Oi(at,bt,g);fh(at,Lt);break e;case 1:_t=bt;var Nt=at.type,Ht=at.stateNode;if(!(at.flags&128)&&(typeof Nt.getDerivedStateFromError=="function"||Ht!==null&&typeof Ht.componentDidCatch=="function"&&(Si===null||!Si.has(Ht)))){at.flags|=65536,g&=-g,at.lanes|=g;var on=Ri(at,_t,g);fh(at,on);break e}}at=at.return}while(at!==null)}Tk(j)}catch(en){g=en,Y===j&&j!==null&&(Y=j=j.return);continue}break}while(1)}function Kk(){var b=nk.current;return nk.current=ai,b===null?ai:b}function uj(){(T===0||T===3||T===2)&&(T=4),R===null||!(hh&268435455)&&!(rk&268435455)||Dk(R,Z)}function Jk(b,g){var j=K;K|=2;var d=Kk();(R!==b||Z!==g)&&(vk=null,Lk(b,g));do try{Uk();break}catch(nt){Nk(b,nt)}while(1);if(Qg(),K=j,nk.current=d,Y!==null)throw Error(p(261));return R=null,Z=0,T}function Uk(){for(;Y!==null;)Vk(Y)}function Mk(){for(;Y!==null&&!cc();)Vk(Y)}function Vk(b){var g=Wk(b.alternate,b,gj);b.memoizedProps=b.pendingProps,g===null?Tk(b):Y=g,ok.current=null}function Tk(b){var g=b;do{var j=g.alternate;if(b=g.return,g.flags&32768){if(j=Jj(j,g),j!==null){j.flags&=32767,Y=j;return}if(b!==null)b.flags|=32768,b.subtreeFlags=0,b.deletions=null;else{T=6,Y=null;return}}else if(j=Fj(j,g,gj),j!==null){Y=j;return}if(g=g.sibling,g!==null){Y=g;return}Y=g=b}while(g!==null);T===0&&(T=5)}function Qk(b,g,j){var d=C,nt=pk.transition;try{pk.transition=null,C=1,Xk(b,g,j,d)}finally{pk.transition=nt,C=d}return null}function Xk(b,g,j,d){do Ik();while(xk!==null);if(K&6)throw Error(p(327));j=b.finishedWork;var nt=b.finishedLanes;if(j===null)return null;if(b.finishedWork=null,b.finishedLanes=0,j===b.current)throw Error(p(177));b.callbackNode=null,b.callbackPriority=0;var at=j.lanes|j.childLanes;if(Bc(b,at),b===R&&(Y=R=null,Z=0),!(j.subtreeFlags&2064)&&!(j.flags&2064)||wk||(wk=!0,Gk(hc,function(){return Ik(),null})),at=(j.flags&15990)!==0,j.subtreeFlags&15990||at){at=pk.transition,pk.transition=null;var ht=C;C=1;var _t=K;K|=4,ok.current=null,Pj(b,j),ek(j,b),Oe(Df),dd=!!Cf,Df=Cf=null,b.current=j,ik(j),dc(),K=_t,C=ht,pk.transition=at}else b.current=j;if(wk&&(wk=!1,xk=b,yk=nt),at=b.pendingLanes,at===0&&(Si=null),mc(j.stateNode),Ek(b,B()),g!==null)for(d=b.onRecoverableError,j=0;j<g.length;j++)nt=g[j],d(nt.value,{componentStack:nt.stack,digest:nt.digest});if(Pi)throw Pi=!1,b=Qi,Qi=null,b;return yk&1&&b.tag!==0&&Ik(),at=b.pendingLanes,at&1?b===Ak?zk++:(zk=0,Ak=b):zk=0,jg(),null}function Ik(){if(xk!==null){var b=Dc(yk),g=pk.transition,j=C;try{if(pk.transition=null,C=16>b?16:b,xk===null)var d=!1;else{if(b=xk,xk=null,yk=0,K&6)throw Error(p(331));var nt=K;for(K|=4,V=b.current;V!==null;){var at=V,ht=at.child;if(V.flags&16){var _t=at.deletions;if(_t!==null){for(var bt=0;bt<_t.length;bt++){var kt=_t[bt];for(V=kt;V!==null;){var Vt=V;switch(Vt.tag){case 0:case 11:case 15:Qj(8,Vt,at)}var qt=Vt.child;if(qt!==null)qt.return=Vt,V=qt;else for(;V!==null;){Vt=V;var zt=Vt.sibling,jt=Vt.return;if(Tj(Vt),Vt===kt){V=null;break}if(zt!==null){zt.return=jt,V=zt;break}V=jt}}}var Kt=at.alternate;if(Kt!==null){var Ft=Kt.child;if(Ft!==null){Kt.child=null;do{var nn=Ft.sibling;Ft.sibling=null,Ft=nn}while(Ft!==null)}}V=at}}if(at.subtreeFlags&2064&&ht!==null)ht.return=at,V=ht;else e:for(;V!==null;){if(at=V,at.flags&2048)switch(at.tag){case 0:case 11:case 15:Qj(9,at,at.return)}var Lt=at.sibling;if(Lt!==null){Lt.return=at.return,V=Lt;break e}V=at.return}}var Nt=b.current;for(V=Nt;V!==null;){ht=V;var Ht=ht.child;if(ht.subtreeFlags&2064&&Ht!==null)Ht.return=ht,V=Ht;else e:for(ht=Nt;V!==null;){if(_t=V,_t.flags&2048)try{switch(_t.tag){case 0:case 11:case 15:Rj(9,_t)}}catch(en){W(_t,_t.return,en)}if(_t===ht){V=null;break e}var on=_t.sibling;if(on!==null){on.return=_t.return,V=on;break e}V=_t.return}}if(K=nt,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,b)}catch{}d=!0}return d}finally{C=j,pk.transition=g}}return!1}function Yk(b,g,j){g=Ki(j,g),g=Oi(b,g,1),b=dh(b,g,1),g=L(),b!==null&&(Ac(b,1,g),Ek(b,g))}function W(b,g,j){if(b.tag===3)Yk(b,b,j);else for(;g!==null;){if(g.tag===3){Yk(g,b,j);break}else if(g.tag===1){var d=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Si===null||!Si.has(d))){b=Ki(j,b),b=Ri(g,b,1),g=dh(g,b,1),b=L(),g!==null&&(Ac(g,1,b),Ek(g,b));break}}g=g.return}}function Ui(b,g,j){var d=b.pingCache;d!==null&&d.delete(g),g=L(),b.pingedLanes|=b.suspendedLanes&j,R===b&&(Z&j)===j&&(T===4||T===3&&(Z&130023424)===Z&&500>B()-gk?Lk(b,0):sk|=j),Ek(b,g)}function Zk(b,g){g===0&&(b.mode&1?(g=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):g=1);var j=L();b=Zg(b,g),b!==null&&(Ac(b,g,j),Ek(b,j))}function vj(b){var g=b.memoizedState,j=0;g!==null&&(j=g.retryLane),Zk(b,j)}function ck(b,g){var j=0;switch(b.tag){case 13:var d=b.stateNode,nt=b.memoizedState;nt!==null&&(j=nt.retryLane);break;case 19:d=b.stateNode;break;default:throw Error(p(314))}d!==null&&d.delete(g),Zk(b,j)}var Wk;Wk=function(b,g,j){if(b!==null)if(b.memoizedProps!==g.pendingProps||Wf.current)Ug=!0;else{if(!(b.lanes&j)&&!(g.flags&128))return Ug=!1,zj(b,g,j);Ug=!!(b.flags&131072)}else Ug=!1,I&&g.flags&1048576&&ug(g,ng,g.index);switch(g.lanes=0,g.tag){case 2:var d=g.type;jj(b,g),b=g.pendingProps;var nt=Yf(g,H.current);Tg(g,j),nt=Xh(null,g,d,b,nt,j);var at=bi();return g.flags|=1,typeof nt=="object"&&nt!==null&&typeof nt.render=="function"&&nt.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,Zf(d)?(at=!0,cg(g)):at=!1,g.memoizedState=nt.state!==null&&nt.state!==void 0?nt.state:null,ah(g),nt.updater=nh,g.stateNode=nt,nt._reactInternals=g,rh(g,d,b,j),g=kj(null,g,d,!0,at,j)):(g.tag=0,I&&at&&vg(g),Yi(null,g,nt,j),g=g.child),g;case 16:d=g.elementType;e:{switch(jj(b,g),b=g.pendingProps,nt=d._init,d=nt(d._payload),g.type=d,nt=g.tag=$k(d),b=Lg(d,b),nt){case 0:g=dj(null,g,d,b,j);break e;case 1:g=ij(null,g,d,b,j);break e;case 11:g=Zi(null,g,d,b,j);break e;case 14:g=aj(null,g,d,Lg(d.type,b),j);break e}throw Error(p(306,d,""))}return g;case 0:return d=g.type,nt=g.pendingProps,nt=g.elementType===d?nt:Lg(d,nt),dj(b,g,d,nt,j);case 1:return d=g.type,nt=g.pendingProps,nt=g.elementType===d?nt:Lg(d,nt),ij(b,g,d,nt,j);case 3:e:{if(lj(g),b===null)throw Error(p(387));d=g.pendingProps,at=g.memoizedState,nt=at.element,bh(b,g),gh(g,d,null,j);var ht=g.memoizedState;if(d=ht.element,at.isDehydrated)if(at={element:d,isDehydrated:!1,cache:ht.cache,pendingSuspenseBoundaries:ht.pendingSuspenseBoundaries,transitions:ht.transitions},g.updateQueue.baseState=at,g.memoizedState=at,g.flags&256){nt=Ki(Error(p(423)),g),g=mj(b,g,d,j,nt);break e}else if(d!==nt){nt=Ki(Error(p(424)),g),g=mj(b,g,d,j,nt);break e}else for(yg=Lf(g.stateNode.containerInfo.firstChild),xg=g,I=!0,zg=null,j=Ch(g,null,d,j),g.child=j;j;)j.flags=j.flags&-3|4096,j=j.sibling;else{if(Ig(),d===nt){g=$i(b,g,j);break e}Yi(b,g,d,j)}g=g.child}return g;case 5:return Kh(g),b===null&&Eg(g),d=g.type,nt=g.pendingProps,at=b!==null?b.memoizedProps:null,ht=nt.children,Ef(d,nt)?ht=null:at!==null&&Ef(d,at)&&(g.flags|=32),hj(b,g),Yi(b,g,ht,j),g.child;case 6:return b===null&&Eg(g),null;case 13:return pj(b,g,j);case 4:return Ih(g,g.stateNode.containerInfo),d=g.pendingProps,b===null?g.child=Bh(g,null,d,j):Yi(b,g,d,j),g.child;case 11:return d=g.type,nt=g.pendingProps,nt=g.elementType===d?nt:Lg(d,nt),Zi(b,g,d,nt,j);case 7:return Yi(b,g,g.pendingProps,j),g.child;case 8:return Yi(b,g,g.pendingProps.children,j),g.child;case 12:return Yi(b,g,g.pendingProps.children,j),g.child;case 10:e:{if(d=g.type._context,nt=g.pendingProps,at=g.memoizedProps,ht=nt.value,G(Mg,d._currentValue),d._currentValue=ht,at!==null)if(He(at.value,ht)){if(at.children===nt.children&&!Wf.current){g=$i(b,g,j);break e}}else for(at=g.child,at!==null&&(at.return=g);at!==null;){var _t=at.dependencies;if(_t!==null){ht=at.child;for(var bt=_t.firstContext;bt!==null;){if(bt.context===d){if(at.tag===1){bt=ch(-1,j&-j),bt.tag=2;var kt=at.updateQueue;if(kt!==null){kt=kt.shared;var Vt=kt.pending;Vt===null?bt.next=bt:(bt.next=Vt.next,Vt.next=bt),kt.pending=bt}}at.lanes|=j,bt=at.alternate,bt!==null&&(bt.lanes|=j),Sg(at.return,j,g),_t.lanes|=j;break}bt=bt.next}}else if(at.tag===10)ht=at.type===g.type?null:at.child;else if(at.tag===18){if(ht=at.return,ht===null)throw Error(p(341));ht.lanes|=j,_t=ht.alternate,_t!==null&&(_t.lanes|=j),Sg(ht,j,g),ht=at.sibling}else ht=at.child;if(ht!==null)ht.return=at;else for(ht=at;ht!==null;){if(ht===g){ht=null;break}if(at=ht.sibling,at!==null){at.return=ht.return,ht=at;break}ht=ht.return}at=ht}Yi(b,g,nt.children,j),g=g.child}return g;case 9:return nt=g.type,d=g.pendingProps.children,Tg(g,j),nt=Vg(nt),d=d(nt),g.flags|=1,Yi(b,g,d,j),g.child;case 14:return d=g.type,nt=Lg(d,g.pendingProps),nt=Lg(d.type,nt),aj(b,g,d,nt,j);case 15:return cj(b,g,g.type,g.pendingProps,j);case 17:return d=g.type,nt=g.pendingProps,nt=g.elementType===d?nt:Lg(d,nt),jj(b,g),g.tag=1,Zf(d)?(b=!0,cg(g)):b=!1,Tg(g,j),ph(g,d,nt),rh(g,d,nt,j),kj(null,g,d,!0,b,j);case 19:return yj(b,g,j);case 22:return ej(b,g,j)}throw Error(p(156,g.tag))};function Gk(b,g){return ac(b,g)}function al(b,g,j,d){this.tag=b,this.key=j,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(b,g,j,d){return new al(b,g,j,d)}function bj(b){return b=b.prototype,!(!b||!b.isReactComponent)}function $k(b){if(typeof b=="function")return bj(b)?1:0;if(b!=null){if(b=b.$$typeof,b===Da)return 11;if(b===Ga)return 14}return 2}function wh(b,g){var j=b.alternate;return j===null?(j=Bg(b.tag,g,b.key,b.mode),j.elementType=b.elementType,j.type=b.type,j.stateNode=b.stateNode,j.alternate=b,b.alternate=j):(j.pendingProps=g,j.type=b.type,j.flags=0,j.subtreeFlags=0,j.deletions=null),j.flags=b.flags&14680064,j.childLanes=b.childLanes,j.lanes=b.lanes,j.child=b.child,j.memoizedProps=b.memoizedProps,j.memoizedState=b.memoizedState,j.updateQueue=b.updateQueue,g=b.dependencies,j.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},j.sibling=b.sibling,j.index=b.index,j.ref=b.ref,j}function yh(b,g,j,d,nt,at){var ht=2;if(d=b,typeof b=="function")bj(b)&&(ht=1);else if(typeof b=="string")ht=5;else e:switch(b){case ya:return Ah(j.children,nt,at,g);case za:ht=8,nt|=8;break;case Aa:return b=Bg(12,j,g,nt|2),b.elementType=Aa,b.lanes=at,b;case Ea:return b=Bg(13,j,g,nt),b.elementType=Ea,b.lanes=at,b;case Fa:return b=Bg(19,j,g,nt),b.elementType=Fa,b.lanes=at,b;case Ia:return qj(j,nt,at,g);default:if(typeof b=="object"&&b!==null)switch(b.$$typeof){case Ba:ht=10;break e;case Ca:ht=9;break e;case Da:ht=11;break e;case Ga:ht=14;break e;case Ha:ht=16,d=null;break e}throw Error(p(130,b==null?b:typeof b,""))}return g=Bg(ht,j,g,nt),g.elementType=b,g.type=d,g.lanes=at,g}function Ah(b,g,j,d){return b=Bg(7,b,d,g),b.lanes=j,b}function qj(b,g,j,d){return b=Bg(22,b,d,g),b.elementType=Ia,b.lanes=j,b.stateNode={isHidden:!1},b}function xh(b,g,j){return b=Bg(6,b,null,g),b.lanes=j,b}function zh(b,g,j){return g=Bg(4,b.children!==null?b.children:[],b.key,g),g.lanes=j,g.stateNode={containerInfo:b.containerInfo,pendingChildren:null,implementation:b.implementation},g}function bl(b,g,j,d,nt){this.tag=g,this.containerInfo=b,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=d,this.onRecoverableError=nt,this.mutableSourceEagerHydrationData=null}function cl(b,g,j,d,nt,at,ht,_t,bt){return b=new bl(b,g,j,_t,bt),g===1?(g=1,at===!0&&(g|=8)):g=0,at=Bg(3,null,null,g),b.current=at,at.stateNode=b,at.memoizedState={element:d,isDehydrated:j,cache:null,transitions:null,pendingSuspenseBoundaries:null},ah(at),b}function dl(b,g,j){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:d==null?null:""+d,children:b,containerInfo:g,implementation:j}}function el(b){if(!b)return Vf;b=b._reactInternals;e:{if(Vb(b)!==b||b.tag!==1)throw Error(p(170));var g=b;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(Zf(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(p(171))}if(b.tag===1){var j=b.type;if(Zf(j))return bg(b,j,g)}return g}function fl(b,g,j,d,nt,at,ht,_t,bt){return b=cl(j,d,!0,b,nt,at,ht,_t,bt),b.context=el(null),j=b.current,d=L(),nt=lh(j),at=ch(d,nt),at.callback=g??null,dh(j,at,nt),b.current.lanes=nt,Ac(b,nt,d),Ek(b,d),b}function gl(b,g,j,d){var nt=g.current,at=L(),ht=lh(nt);return j=el(j),g.context===null?g.context=j:g.pendingContext=j,g=ch(at,ht),g.payload={element:b},d=d===void 0?null:d,d!==null&&(g.callback=d),b=dh(nt,g,ht),b!==null&&(mh(b,nt,ht,at),eh(b,nt,ht)),ht}function hl(b){if(b=b.current,!b.child)return null;switch(b.child.tag){case 5:return b.child.stateNode;default:return b.child.stateNode}}function il(b,g){if(b=b.memoizedState,b!==null&&b.dehydrated!==null){var j=b.retryLane;b.retryLane=j!==0&&j<g?j:g}}function jl(b,g){il(b,g),(b=b.alternate)&&il(b,g)}function kl(){return null}var ll=typeof reportError=="function"?reportError:function(b){console.error(b)};function ml(b){this._internalRoot=b}nl.prototype.render=ml.prototype.render=function(b){var g=this._internalRoot;if(g===null)throw Error(p(409));gl(b,g,null,null)};nl.prototype.unmount=ml.prototype.unmount=function(){var b=this._internalRoot;if(b!==null){this._internalRoot=null;var g=b.containerInfo;Sk(function(){gl(null,b,null,null)}),g[uf]=null}};function nl(b){this._internalRoot=b}nl.prototype.unstable_scheduleHydration=function(b){if(b){var g=Hc();b={blockedOn:null,target:b,priority:g};for(var j=0;j<Qc.length&&g!==0&&g<Qc[j].priority;j++);Qc.splice(j,0,b),j===0&&Vc(b)}};function ol(b){return!(!b||b.nodeType!==1&&b.nodeType!==9&&b.nodeType!==11)}function pl(b){return!(!b||b.nodeType!==1&&b.nodeType!==9&&b.nodeType!==11&&(b.nodeType!==8||b.nodeValue!==" react-mount-point-unstable "))}function ql(){}function rl(b,g,j,d,nt){if(nt){if(typeof d=="function"){var at=d;d=function(){var kt=hl(ht);at.call(kt)}}var ht=fl(g,d,b,0,null,!1,!1,"",ql);return b._reactRootContainer=ht,b[uf]=ht.current,sf(b.nodeType===8?b.parentNode:b),Sk(),ht}for(;nt=b.lastChild;)b.removeChild(nt);if(typeof d=="function"){var _t=d;d=function(){var kt=hl(bt);_t.call(kt)}}var bt=cl(b,0,!1,null,null,!1,!1,"",ql);return b._reactRootContainer=bt,b[uf]=bt.current,sf(b.nodeType===8?b.parentNode:b),Sk(function(){gl(g,bt,j,d)}),bt}function sl(b,g,j,d,nt){var at=j._reactRootContainer;if(at){var ht=at;if(typeof nt=="function"){var _t=nt;nt=function(){var bt=hl(ht);_t.call(bt)}}gl(g,ht,b,nt)}else ht=rl(j,g,b,nt,d);return hl(ht)}Ec=function(b){switch(b.tag){case 3:var g=b.stateNode;if(g.current.memoizedState.isDehydrated){var j=tc(g.pendingLanes);j!==0&&(Cc(g,j|1),Ek(g,B()),!(K&6)&&(Hj=B()+500,jg()))}break;case 13:Sk(function(){var d=Zg(b,1);if(d!==null){var nt=L();mh(d,b,1,nt)}}),jl(b,1)}};Fc=function(b){if(b.tag===13){var g=Zg(b,134217728);if(g!==null){var j=L();mh(g,b,134217728,j)}jl(b,134217728)}};Gc=function(b){if(b.tag===13){var g=lh(b),j=Zg(b,g);if(j!==null){var d=L();mh(j,b,g,d)}jl(b,g)}};Hc=function(){return C};Ic=function(b,g){var j=C;try{return C=b,g()}finally{C=j}};yb=function(b,g,j){switch(g){case"input":if(bb(b,j),g=j.name,j.type==="radio"&&g!=null){for(j=b;j.parentNode;)j=j.parentNode;for(j=j.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<j.length;g++){var d=j[g];if(d!==b&&d.form===b.form){var nt=Db(d);if(!nt)throw Error(p(90));Wa(d),bb(d,nt)}}}break;case"textarea":ib(b,j);break;case"select":g=j.value,g!=null&&fb(b,!!j.multiple,g,!1)}};Gb=Rk;Hb=Sk;var tl={usingClientEntryPoint:!1,Events:[Cb,ue,Db,Eb,Fb,Rk]},ul={findFiberByHostInstance:Wc,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},vl={bundleType:ul.bundleType,version:ul.version,rendererPackageName:ul.rendererPackageName,rendererConfig:ul.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(b){return b=Zb(b),b===null?null:b.stateNode},findFiberByHostInstance:ul.findFiberByHostInstance||kl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var wl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!wl.isDisabled&&wl.supportsFiber)try{kc=wl.inject(vl),lc=wl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tl;reactDom_production_min.createPortal=function(b,g){var j=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ol(g))throw Error(p(200));return dl(b,g,null,j)};reactDom_production_min.createRoot=function(b,g){if(!ol(b))throw Error(p(299));var j=!1,d="",nt=ll;return g!=null&&(g.unstable_strictMode===!0&&(j=!0),g.identifierPrefix!==void 0&&(d=g.identifierPrefix),g.onRecoverableError!==void 0&&(nt=g.onRecoverableError)),g=cl(b,1,!1,null,null,j,!1,d,nt),b[uf]=g.current,sf(b.nodeType===8?b.parentNode:b),new ml(g)};reactDom_production_min.findDOMNode=function(b){if(b==null)return null;if(b.nodeType===1)return b;var g=b._reactInternals;if(g===void 0)throw typeof b.render=="function"?Error(p(188)):(b=Object.keys(b).join(","),Error(p(268,b)));return b=Zb(g),b=b===null?null:b.stateNode,b};reactDom_production_min.flushSync=function(b){return Sk(b)};reactDom_production_min.hydrate=function(b,g,j){if(!pl(g))throw Error(p(200));return sl(null,b,g,!0,j)};reactDom_production_min.hydrateRoot=function(b,g,j){if(!ol(b))throw Error(p(405));var d=j!=null&&j.hydratedSources||null,nt=!1,at="",ht=ll;if(j!=null&&(j.unstable_strictMode===!0&&(nt=!0),j.identifierPrefix!==void 0&&(at=j.identifierPrefix),j.onRecoverableError!==void 0&&(ht=j.onRecoverableError)),g=fl(g,null,b,1,j??null,nt,!1,at,ht),b[uf]=g.current,sf(b),d)for(b=0;b<d.length;b++)j=d[b],nt=j._getVersion,nt=nt(j._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[j,nt]:g.mutableSourceEagerHydrationData.push(j,nt);return new nl(g)};reactDom_production_min.render=function(b,g,j){if(!pl(g))throw Error(p(200));return sl(null,b,g,!1,j)};reactDom_production_min.unmountComponentAtNode=function(b){if(!pl(b))throw Error(p(40));return b._reactRootContainer?(Sk(function(){sl(null,null,b,!1,function(){b._reactRootContainer=null,b[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Rk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(b,g,j,d){if(!pl(j))throw Error(p(200));if(b==null||b._reactInternals===void 0)throw Error(p(38));return sl(b,g,j,!1,d)};reactDom_production_min.version="18.2.0-next-9e3b772b8-20220608";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(b){console.error(b)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports,m=reactDomExports;client.createRoot=m.createRoot,client.hydrateRoot=m.hydrateRoot;const App$1="",animatedLogo="/assets/logo-animated-fcde50a7.gif",Loader=()=>React.createElement("div",{className:"loader"},React.createElement("img",{src:animatedLogo,className:"logo",alt:"apple-loader"}));/*! For license information please see bundle.m.js.LICENSE.txt */var __webpackgi_modules__={798:function(b,g,j){var d=j(352),nt=j.n(d)()(function(at){return at[1]});nt.push([b.id,"#assetManagerPopup{z-index:300;position:absolute;bottom:2rem;right:2rem;-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);color:#fff;background-blend-mode:luminosity;background-color:#28223CAA;padding:1.5rem;font-size:1rem;width:-webkit-max-content;width:-moz-max-content;width:max-content;max-width:80vw;max-height:80vh;overflow-y:scroll;border-radius:.5rem;height:-webkit-max-content;height:-moz-max-content;height:max-content}#assetManagerPopupClose{position:absolute;top:0;right:0;padding:.5rem;cursor:pointer}#assetManagerPopupContent{padding-top:.5rem}.processState{font-weight:bold}",""]),g.Z=nt},898:function(b,g,j){var d=j(352),nt=j.n(d)()(function(at){return at[1]});nt.push([b.id,':root{--tp-blade-unit-size: 24px;--tp-element-border-radius: 0.25rem;--tp-base-background-color: #28223C;--tp-base-shadow-color: hsla(0, 0%, 0%, 0.2);--tp-button-background-color: hsla(230, 10%, 80%, 1.00);--tp-button-background-color-active: hsla(230, 10%, 95%, 1.00);--tp-button-background-color-focus: hsla(230, 10%, 90%, 1.00);--tp-button-background-color-hover: hsla(230, 10%, 85%, 1.00);--tp-button-foreground-color: hsla(230, 20%, 11%, 1.00);--tp-container-background-color: hsla(230, 25%, 16%, 0.65);--tp-container-background-color-active: hsla(230, 25%, 31%, 0.65);--tp-container-background-color-focus: hsla(230, 25%, 26%, 0.65);--tp-container-background-color-hover: hsla(230, 25%, 21%, 0.65);--tp-container-foreground-color: hsl(240, 10%, 92%);--tp-groove-foreground-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color-active: hsla(230, 28%, 23%, 1.00);--tp-input-background-color-focus: hsla(230, 28%, 18%, 1.00);--tp-input-background-color-hover: hsla(230, 20%, 13%, 1.00);--tp-input-foreground-color: hsla(230, 10%, 80%, 1.00);--tp-monitor-background-color: hsla(230, 20%, 8%, 1.00);--tp-monitor-foreground-color: hsla(230, 12%, 48%, 1.00);--tp-label-foreground-color: #E4E2ED;--tp-font-family: "Inter"}.tp-fldv{margin-top:.25rem;margin-bottom:.25rem;background-blend-mode:luminosity;position:relative}.tp-fldv .tp-fldv{margin-top:.5rem;margin-bottom:.5rem}.tp-fldv .tp-brkv{background-color:rgba(32,32,50,.85)}.tp-fldv .tp-fldv .tp-brkv{background-color:rgba(32,32,50,.25) !important}.tp-fldv-expanded>.tp-fldv_b{background-color:rgba(32,32,50,.8) !important}.tp-fldv_b{height:calc(var(--bld-us)*1.5 + 4px) !important;font-size:.85rem !important}.tp-fldv_b+.tp-brkv .tp-fldv_b{height:calc(var(--bld-us)*1.1 + 4px) !important;font-size:.65rem !important}.tp-lblv_l{font-size:.7rem !important;font-weight:400 !important;flex-grow:1 !important;flex-basis:20% !important}.tp-lblv_v{flex-grow:1 !important;flex-basis:50% !important}.tp-txtv_i{font-size:.7rem !important;font-weight:400 !important}.tp-fldv_t{font-weight:400 !important;padding-left:1.5rem !important}.tp-fldv_m{right:auto !important;left:.75rem;opacity:1 !important}.pluginOptionsButton{position:absolute;right:0;top:.75rem;padding-left:.5rem;padding-right:.5rem;height:-webkit-min-content;height:-moz-min-content;height:min-content;background:transparent;color:#eee;border:none}',""]),g.Z=nt},513:function(b,g,j){var d=j(352),nt=j.n(d)()(function(at){return at[1]});nt.push([b.id,".wwise-perspective{perspective:1000px;position:fixed;left:0;top:0;width:100vw;height:100vh}.wwise-wrapper{position:fixed;width:0;height:0;font-weight:400}.wwise-wrapper.v-center{top:50%}.wwise-wrapper.h-center{left:50%}.wwise-wrapper.left{left:0}.wwise-wrapper.right{right:0}.wwise-wrapper.top{top:0}.wwise-wrapper.bottom{bottom:0}.wwise *.preset{color:#fafafa}.wwise *.preset.ok{background:rgba(45,193,80,.95)}.wwise *.preset.error{background:rgba(190,17,51,.95)}.wwise *.preset.info{background:rgba(40,34,60,.95)}.wwise *.preset.caution{background:rgba(239,128,0,.95)}.wwise-no-scroll{position:relative;overflow:hidden}.wwise-overlay{position:fixed;left:0;top:0;width:100vw;height:100vh;background:rgba(50,50,50,.5)}.wwise{position:absolute;left:0;top:0;display:flex;flex-direction:column;border-radius:5px;box-shadow:1px 1px 10px rgba(150,150,150,.5);box-sizing:border-box}.wwise.no-radius{border-radius:0}.wwise *{box-sizing:border-box}.wwise .clear{clear:both}.wwise>.content{padding:0;margin:0;flex-grow:1;border-radius:0 0 4px 4px;background:#fff;color:#333;box-shadow:0 1px 3px rgba(200,200,200,.5) inset}.wwise>.content.no-topbar{border-radius:4px;box-shadow:none}.wwise.no-radius>.content,.wwise.no-radius>.content.no-topbar{border-radius:0}.wwise .modal>.main{width:90vw;max-width:400px;border-radius:4px 4px 0 0;text-align:center;padding-bottom:10px;color:#fff}.wwise .modal>.main .icon{display:block;margin:0 auto;fill:#fff;width:100px}.wwise .modal>.main .title{font-size:30px}.wwise .modal>.main .text{margin:10px 0;font-weight:300;font-size:16px}.wwise .modal>.main.no-op{border-radius:4px}.wwise .modal>.main.ok{background:#2dc150}.wwise .modal>.main.error{background:#be1133}.wwise .modal>.main.info{background:#28223c}.wwise .modal>.main.caution{background:#ef8000}.wwise .modal>.operation .button-wrapper{text-align:center;margin:30px 0 20px 0}.wwise .modal>.operation .button{display:inline-block;line-height:18px;padding:8px 10px;margin:0 15px;line-height:18px;width:100px;border-radius:4px;border:1px solid #eee;box-shadow:1px 1px 3px rgba(220,220,220,.8);color:#555;transition:all ease .2s}.wwise .modal>.operation .button:hover{background:#f5f5f5;cursor:pointer}.wwise .modal>.operation .button.main{color:#fff}.wwise .modal>.operation.ok .main{background:#2dc150}.wwise .modal>.operation.ok .main:hover{background:#23983f}.wwise .modal>.operation.error .main{background:#be1133}.wwise .modal>.operation.error .main:hover{background:#8f0d26}.wwise .modal>.operation.info .main{background:#28223c}.wwise .modal>.operation.info .main:hover{background:#12101b}.wwise .modal>.operation.caution .main{background:#ef8000}.wwise .modal>.operation.caution .main:hover{background:#bc6500}.wwise .input-wrapper{margin:15px auto -15px auto}.wwise .input-wrapper .input{display:block;margin:0 auto;width:95%;max-width:300px;outline:none;border:none;background:#f3f3f3;padding:15px;font-size:16px;border-radius:5px}.wwise .input-wrapper .error{width:95%;text-align:center;margin-top:10px;color:red}div:has(>.wwise-wrapper){position:absolute !important}.wwise-wrapper{position:absolute !important}.wwise .modal>.main{padding-top:10px}",""]),g.Z=nt},476:function(b){var g;g=function(){return function(j){var d={};function nt(at){if(d[at])return d[at].exports;var ht=d[at]={i:at,l:!1,exports:{}};return j[at].call(ht.exports,ht,ht.exports,nt),ht.l=!0,ht.exports}return nt.m=j,nt.c=d,nt.i=function(at){return at},nt.d=function(at,ht,_t){nt.o(at,ht)||Object.defineProperty(at,ht,{configurable:!1,enumerable:!0,get:_t})},nt.n=function(at){var ht=at&&at.__esModule?function(){return at.default}:function(){return at};return nt.d(ht,"a",ht),ht},nt.o=function(at,ht){return Object.prototype.hasOwnProperty.call(at,ht)},nt.p="",nt(nt.s=5)}([function(j,d,nt){Object.defineProperty(d,"__esModule",{value:!0});var at={convertToObject:function(ht){var _t=ht.substring(ht.indexOf("{")+1).trim().slice(0,-1),bt={};return _t.split(";").map(function(kt){if(kt=kt.trim()){var Vt=kt.split(":");bt[Vt[0].trim()]=Vt[1].trim()}}),bt},getFromSheets:function(ht){var _t=document.styleSheets;for(var bt in _t){var kt=null;try{kt=_t[bt].rules||_t[bt].cssRules}catch{}if(kt){for(var Vt in kt)if(kt[Vt].selectorText&&kt[Vt].selectorText.split(",").indexOf(ht)!=-1)return kt[Vt].cssText?at.convertToObject(kt[Vt].cssText):at.convertToObject(kt[Vt].style.cssText)}}return{}},getPropertyDefault:function(ht){return ht=="timing-function"?"ease":ht=="iteration-count"?1:ht=="direction"?"normal":ht=="fill-mode"?"none":null}};d.default=at},function(j,d,nt){Object.defineProperty(d,"__esModule",{value:!0});var at={generateId:function(){for(var ht="",_t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",bt=0;bt<8;++bt)ht+=_t.charAt(Math.floor(Math.random()*_t.length));return ht},frameToString:function(ht){var _t="";for(var bt in ht)_t+=bt+":"+ht[bt]+";";return _t},convertTimeToMs:function(ht){if(!ht)return 0;if(typeof ht=="number")return ht;var _t=parseFloat(ht);return ht.indexOf("ms")!=-1?_t:1e3*_t},prefixes:["","-webkit-","-moz-","-o-"]};d.default=at},function(j,d,nt){Object.defineProperty(d,"__esModule",{value:!0});var at,ht=(at=nt(0))&&at.__esModule?at:{default:at};d.default=function _t(bt,kt){if(function(zt,jt){if(!(zt instanceof jt))throw new TypeError("Cannot call a class as a function")}(this,_t),this.styles=typeof bt=="string"?ht.default.getFromSheets(bt):bt,typeof kt=="string"){var Vt=ht.default.getFromSheets(kt);for(var qt in this.options={},Vt)this.options[qt.replace("animation-","")]=Vt[qt]}else this.options=typeof kt=="number"?{duration:kt}:kt}},function(j,d,nt){Object.defineProperty(d,"__esModule",{value:!0});var at=function(){function qt(zt,jt){for(var Kt=0;Kt<jt.length;Kt++){var Ft=jt[Kt];Ft.enumerable=Ft.enumerable||!1,Ft.configurable=!0,"value"in Ft&&(Ft.writable=!0),Object.defineProperty(zt,Ft.key,Ft)}}return function(zt,jt,Kt){return jt&&qt(zt.prototype,jt),Kt&&qt(zt,Kt),zt}}(),ht=kt(nt(4)),_t=kt(nt(1)),bt=kt(nt(0));function kt(qt){return qt&&qt.__esModule?qt:{default:qt}}var Vt=function(){function qt(zt,jt,Kt,Ft){if(function(Nt,Ht){if(!(Nt instanceof Ht))throw new TypeError("Cannot call a class as a function")}(this,qt),zt.constructor===Array?this.doms=zt:this.doms=[zt],jt.constructor===Array?this.frames=jt:this.frames=[jt],this.options={startFrom:0,pauseAt:[],prefix:!1,count:1,clear:!0,applyOnEnd:!1,instant:!1},Kt!=null&&Kt!=null)if(typeof Kt=="boolean")this.options.instant=Kt;else if(typeof Kt=="number")this.options.count=Kt,typeof Ft=="boolean"&&(this.options.instant=Ft);else for(var nn in Kt)nn=="pauseAt"&&Kt.pauseAt.constructor!==Array?this.options[nn]=[Kt[nn]]:this.options[nn]=Kt[nn];for(var Lt in this.promiseSupported=typeof Promise<"u"&&Promise.toString().indexOf("[native code]")!==-1,this.countRemainder=[],this.animations=[],this.styleDoms=[],this.superSets=[],this.eventHandler=[],this.options.prefix?this.prefixes=_t.default.prefixes:this.prefixes=[""],zt)this.countRemainder[Lt]=this.options.count-1;this.options.instant&&this.play()}return at(qt,[{key:"play",value:function(){var zt=this;for(var jt in this.clear(),this.promiseSupported&&(this.promise=new Promise(function(Ft){zt.promiseResolve=Ft})),this.doms){var Kt=this.makeAnimation(this.doms[jt]);this.animations[jt]=Kt.names,this.styleDoms[jt]=Kt.styleDom,this.superSets[jt]=this.makeSuperSet(this.doms[jt],this.animations[jt]),this.playAnimation(this.doms[jt],this.superSets[jt]),this.eventHandler[jt]=this.handleAnimationEnd.bind(this,jt),this.doms[jt].addEventListener("animationend",this.eventHandler[jt])}if(this.promiseSupported)return this.promise}},{key:"clear",value:function(zt){if(!zt){for(var jt in this.doms)this.clear(jt);return this.animationEnded=0,this.promise=void 0,void(this.promiseResolve=void 0)}var Kt=this.styleDoms[zt];for(var Ft in Kt&&Kt.parentNode&&Kt.parentNode.removeChild(Kt),this.superSets[zt])for(var nn in this.prefixes)this.doms[zt].style[this.prefixes[nn]+"animation-"+Ft]=null;for(var Lt in this.prefixes)this.doms[zt].style[this.prefixes[Lt]+"animation-play-state"]=null;this.doms[zt].removeEventListener("animationend",this.eventHandler[zt]),this.countRemainder[zt]=this.options.count-1}},{key:"replay",value:function(zt){var jt=this.doms[zt],Kt=jt.cloneNode(!0);jt.parentNode.replaceChild(Kt,jt),this.doms[zt].removeEventListener("animationend",this.eventHandler[zt]),this.doms[zt]=Kt,this.doms[zt].addEventListener("animationend",this.eventHandler[zt])}},{key:"pause",value:function(){for(var zt in this.doms)this.pauseDom(this.doms[zt])}},{key:"resume",value:function(){for(var zt in this.doms)this.resumeDom(this.doms[zt])}},{key:"getPromise",value:function(){return this.promise}},{key:"handleAnimationEnd",value:function(zt,jt){var Kt=jt.animationName,Ft=Kt.substring(Kt.lastIndexOf("-")+1);this.options.pauseAt.includes(parseInt(Ft))&&this.pauseDom(this.doms[zt]),Ft==this.frames.length&&(this.countRemainder[zt]==-1?this.replay(zt):this.countRemainder[zt]>0?(this.countRemainder[zt]--,this.replay(zt)):(this.options.applyOnEnd&&this.applyOnEnd(zt),this.animationEnded++,this.animationEnded==this.doms.length&&(this.promiseSupported&&this.promiseResolve(),this.options.clear&&this.clear())))}},{key:"pauseDom",value:function(zt){for(var jt in this.prefixes)zt.style[this.prefixes[jt]+"animation-play-state"]="paused"}},{key:"resumeDom",value:function(zt){for(var jt in this.prefixes)zt.style[this.prefixes[jt]+"animation-play-state"]="running"}},{key:"applyOnEnd",value:function(zt){var jt=this.newFrames[this.frames.length];for(var Kt in jt)this.doms[zt].style[Kt]=jt[Kt]}},{key:"makeAnimation",value:function(zt){var jt={},Kt=[],Ft={};for(var nn in this.frames)for(var Lt in Kt.push(this.frames[nn].styles),Kt[nn])Ft[Lt]=!0;var Nt=window.getComputedStyle(zt);for(var Ht in Ft)jt[Ht]=Nt[Ht];Kt.unshift(jt);for(var on=[Kt[0]],en=1;en<Kt.length;++en){var cn=JSON.parse(JSON.stringify(on[en-1]));for(var Ut in Kt[en])cn[Ut]=Kt[en][Ut];on.push(cn)}return this.newFrames=on,ht.default.make(on,this.prefixes)}},{key:"makeSuperSet",value:function(zt,jt){var Kt=0,Ft={};for(var nn in this.frames)for(var Lt in this.frames[nn].options)Ft[Lt]="";Ft.name="",Ft.duration="",Ft.delay="";for(var Nt=0;Nt<this.frames.length;++Nt){if(Nt)for(var Ht in Ft)Ft[Ht]+=",";var on=_t.default.convertTimeToMs(this.frames[Nt].options.duration),en=_t.default.convertTimeToMs(this.frames[Nt].options.delay);for(var cn in Nt<this.options.startFrom&&(on=0,en=0),Ft.name+=jt[Nt],Ft.duration+=on+"ms",Ft.delay+=Kt+en+"ms",Ft)cn!="name"&&cn!="duration"&&cn!="delay"&&(Ft[cn]+=this.frames[Nt].options[cn]?this.frames[Nt].options[cn]:bt.default.getPropertyDefault(cn));var Ut=this.frames[Nt].options["iteration-count"];Kt+=on*parseInt(Ut||1)+en}return Ft}},{key:"playAnimation",value:function(zt,jt){for(var Kt in jt)for(var Ft in this.prefixes)zt.style[this.prefixes[Ft]+"animation-"+Kt]=jt[Kt];this.options.pauseAt.includes(0)&&this.pauseDom(zt)}}]),qt}();d.default=Vt},function(j,d,nt){Object.defineProperty(d,"__esModule",{value:!0});var at,ht=(at=nt(1))&&at.__esModule?at:{default:at},_t={make:function(bt,kt){for(var Vt=[],qt="",zt="atr-"+ht.default.generateId(),jt=document.createElement("style"),Kt=0;Kt<bt.length-1;++Kt)Vt.push(zt+"-"+(Kt+1)),qt+=_t.makeFromTwoFrames(bt[Kt],bt[Kt+1],Vt[Kt],kt);return jt.innerHTML=qt,jt.class="foo",document.getElementsByTagName("head")[0].appendChild(jt),{names:Vt,styleDom:jt}},makeFromTwoFrames:function(bt,kt,Vt,qt){var zt="";for(var jt in qt)zt+="@"+qt[jt]+"keyframes "+Vt+" {",zt+="0%",zt+="{"+ht.default.frameToString(bt)+"}",zt+="100%",zt+="{"+ht.default.frameToString(kt)+"}",zt+="}";return zt}};d.default=_t},function(j,d,nt){Object.defineProperty(d,"__esModule",{value:!0}),d.Queue=d.Frame=void 0;var at=_t(nt(2)),ht=_t(nt(3));function _t(bt){return bt&&bt.__esModule?bt:{default:bt}}d.Frame=at.default,d.Queue=ht.default}])},b.exports=g()},352:function(b){b.exports=function(g){var j=[];return j.toString=function(){return this.map(function(d){var nt=g(d);return d[2]?"@media ".concat(d[2]," {").concat(nt,"}"):nt}).join("")},j.i=function(d,nt,at){typeof d=="string"&&(d=[[null,d,""]]);var ht={};if(at)for(var _t=0;_t<this.length;_t++){var bt=this[_t][0];bt!=null&&(ht[bt]=!0)}for(var kt=0;kt<d.length;kt++){var Vt=[].concat(d[kt]);at&&ht[Vt[0]]||(nt&&(Vt[2]?Vt[2]="".concat(nt," and ").concat(Vt[2]):Vt[2]=nt),j.push(Vt))}},j}},388:function(b){b.exports=function g(j,d,nt){function at(bt,kt){if(!d[bt]){if(!j[bt]){if(ht)return ht(bt,!0);throw new Error("Cannot find module '"+bt+"'")}var Vt=d[bt]={exports:{}};j[bt][0].call(Vt.exports,function(qt){return at(j[bt][1][qt]||qt)},Vt,Vt.exports,g,j,d,nt)}return d[bt].exports}for(var ht=void 0,_t=0;_t<nt.length;_t++)at(nt[_t]);return at}({1:[function(g,j,d){(function(nt,at,ht,_t,bt,kt,Vt,qt,zt){var jt=g("crypto");function Kt(en,cn){return function(Ut,Gt){var $t;if(($t=Gt.algorithm!=="passthrough"?jt.createHash(Gt.algorithm):new on).write===void 0&&($t.write=$t.update,$t.end=$t.update),Ht(Gt,$t).dispatch(Ut),$t.update||$t.end(""),$t.digest)return $t.digest(Gt.encoding==="buffer"?void 0:Gt.encoding);var un=$t.read();return Gt.encoding!=="buffer"?un.toString(Gt.encoding):un}(en,cn=Lt(en,cn))}(d=j.exports=Kt).sha1=function(en){return Kt(en)},d.keys=function(en){return Kt(en,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},d.MD5=function(en){return Kt(en,{algorithm:"md5",encoding:"hex"})},d.keysMD5=function(en){return Kt(en,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var Ft=jt.getHashes?jt.getHashes().slice():["sha1","md5"];Ft.push("passthrough");var nn=["buffer","hex","binary","base64"];function Lt(en,cn){cn=cn||{};var Ut={};if(Ut.algorithm=cn.algorithm||"sha1",Ut.encoding=cn.encoding||"hex",Ut.excludeValues=!!cn.excludeValues,Ut.algorithm=Ut.algorithm.toLowerCase(),Ut.encoding=Ut.encoding.toLowerCase(),Ut.ignoreUnknown=cn.ignoreUnknown===!0,Ut.respectType=cn.respectType!==!1,Ut.respectFunctionNames=cn.respectFunctionNames!==!1,Ut.respectFunctionProperties=cn.respectFunctionProperties!==!1,Ut.unorderedArrays=cn.unorderedArrays===!0,Ut.unorderedSets=cn.unorderedSets!==!1,Ut.unorderedObjects=cn.unorderedObjects!==!1,Ut.replacer=cn.replacer||void 0,Ut.excludeKeys=cn.excludeKeys||void 0,en===void 0)throw new Error("Object argument required.");for(var Gt=0;Gt<Ft.length;++Gt)Ft[Gt].toLowerCase()===Ut.algorithm.toLowerCase()&&(Ut.algorithm=Ft[Gt]);if(Ft.indexOf(Ut.algorithm)===-1)throw new Error('Algorithm "'+Ut.algorithm+'"  not supported. supported values: '+Ft.join(", "));if(nn.indexOf(Ut.encoding)===-1&&Ut.algorithm!=="passthrough")throw new Error('Encoding "'+Ut.encoding+'"  not supported. supported values: '+nn.join(", "));return Ut}function Nt(en){if(typeof en=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(en))!=null}function Ht(en,cn,Ut){function Gt($t){return cn.update?cn.update($t,"utf8"):cn.write($t,"utf8")}return Ut=Ut||[],{dispatch:function($t){return en.replacer&&($t=en.replacer($t)),this["_"+($t===null?"null":typeof $t)]($t)},_object:function($t){var un,hn=Object.prototype.toString.call($t),Bn=/\[object (.*)\]/i.exec(hn);if(Bn=(Bn=Bn?Bn[1]:"unknown:["+hn+"]").toLowerCase(),0<=(un=Ut.indexOf($t)))return this.dispatch("[CIRCULAR:"+un+"]");if(Ut.push($t),ht!==void 0&&ht.isBuffer&&ht.isBuffer($t))return Gt("buffer:"),Gt($t);if(Bn==="object"||Bn==="function"||Bn==="asyncfunction"){var ar=Object.keys($t);en.unorderedObjects&&(ar=ar.sort()),en.respectType===!1||Nt($t)||ar.splice(0,0,"prototype","__proto__","constructor"),en.excludeKeys&&(ar=ar.filter(function(ur){return!en.excludeKeys(ur)})),Gt("object:"+ar.length+":");var sr=this;return ar.forEach(function(ur){sr.dispatch(ur),Gt(":"),en.excludeValues||sr.dispatch($t[ur]),Gt(",")})}if(!this["_"+Bn]){if(en.ignoreUnknown)return Gt("["+Bn+"]");throw new Error('Unknown object type "'+Bn+'"')}this["_"+Bn]($t)},_array:function($t,un){un=un!==void 0?un:en.unorderedArrays!==!1;var hn=this;if(Gt("array:"+$t.length+":"),!un||$t.length<=1)return $t.forEach(function(sr){return hn.dispatch(sr)});var Bn=[],ar=$t.map(function(sr){var ur=new on,nr=Ut.slice();return Ht(en,ur,nr).dispatch(sr),Bn=Bn.concat(nr.slice(Ut.length)),ur.read().toString()});return Ut=Ut.concat(Bn),ar.sort(),this._array(ar,!1)},_date:function($t){return Gt("date:"+$t.toJSON())},_symbol:function($t){return Gt("symbol:"+$t.toString())},_error:function($t){return Gt("error:"+$t.toString())},_boolean:function($t){return Gt("bool:"+$t.toString())},_string:function($t){Gt("string:"+$t.length+":"),Gt($t.toString())},_function:function($t){Gt("fn:"),Nt($t)?this.dispatch("[native]"):this.dispatch($t.toString()),en.respectFunctionNames!==!1&&this.dispatch("function-name:"+String($t.name)),en.respectFunctionProperties&&this._object($t)},_number:function($t){return Gt("number:"+$t.toString())},_xml:function($t){return Gt("xml:"+$t.toString())},_null:function(){return Gt("Null")},_undefined:function(){return Gt("Undefined")},_regexp:function($t){return Gt("regex:"+$t.toString())},_uint8array:function($t){return Gt("uint8array:"),this.dispatch(Array.prototype.slice.call($t))},_uint8clampedarray:function($t){return Gt("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call($t))},_int8array:function($t){return Gt("uint8array:"),this.dispatch(Array.prototype.slice.call($t))},_uint16array:function($t){return Gt("uint16array:"),this.dispatch(Array.prototype.slice.call($t))},_int16array:function($t){return Gt("uint16array:"),this.dispatch(Array.prototype.slice.call($t))},_uint32array:function($t){return Gt("uint32array:"),this.dispatch(Array.prototype.slice.call($t))},_int32array:function($t){return Gt("uint32array:"),this.dispatch(Array.prototype.slice.call($t))},_float32array:function($t){return Gt("float32array:"),this.dispatch(Array.prototype.slice.call($t))},_float64array:function($t){return Gt("float64array:"),this.dispatch(Array.prototype.slice.call($t))},_arraybuffer:function($t){return Gt("arraybuffer:"),this.dispatch(new Uint8Array($t))},_url:function($t){return Gt("url:"+$t.toString())},_map:function($t){Gt("map:");var un=Array.from($t);return this._array(un,en.unorderedSets!==!1)},_set:function($t){Gt("set:");var un=Array.from($t);return this._array(un,en.unorderedSets!==!1)},_file:function($t){return Gt("file:"),this.dispatch([$t.name,$t.size,$t.type,$t.lastModfied])},_blob:function(){if(en.ignoreUnknown)return Gt("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return Gt("domwindow")},_bigint:function($t){return Gt("bigint:"+$t.toString())},_process:function(){return Gt("process")},_timer:function(){return Gt("timer")},_pipe:function(){return Gt("pipe")},_tcp:function(){return Gt("tcp")},_udp:function(){return Gt("udp")},_tty:function(){return Gt("tty")},_statwatcher:function(){return Gt("statwatcher")},_securecontext:function(){return Gt("securecontext")},_connection:function(){return Gt("connection")},_zlib:function(){return Gt("zlib")},_context:function(){return Gt("context")},_nodescript:function(){return Gt("nodescript")},_httpparser:function(){return Gt("httpparser")},_dataview:function(){return Gt("dataview")},_signal:function(){return Gt("signal")},_fsevent:function(){return Gt("fsevent")},_tlswrap:function(){return Gt("tlswrap")}}}function on(){return{buf:"",write:function(en){this.buf+=en},end:function(en){this.buf+=en},read:function(){return this.buf}}}d.writeToStream=function(en,cn,Ut){return Ut===void 0&&(Ut=cn,cn={}),Ht(cn=Lt(en,cn),Ut).dispatch(en)}}).call(this,g("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},g("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_7eac155c.js","/")},{buffer:3,crypto:5,lYpoI2:10}],2:[function(g,j,d){(function(nt,at,ht,_t,bt,kt,Vt,qt,zt){(function(jt){var Kt=typeof Uint8Array<"u"?Uint8Array:Array,Ft="+".charCodeAt(0),nn="/".charCodeAt(0),Lt="0".charCodeAt(0),Nt="a".charCodeAt(0),Ht="A".charCodeAt(0),on="-".charCodeAt(0),en="_".charCodeAt(0);function cn(Ut){var Gt=Ut.charCodeAt(0);return Gt===Ft||Gt===on?62:Gt===nn||Gt===en?63:Gt<Lt?-1:Gt<Lt+10?Gt-Lt+26+26:Gt<Ht+26?Gt-Ht:Gt<Nt+26?Gt-Nt+26:void 0}jt.toByteArray=function(Ut){var Gt,$t;if(0<Ut.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var un=Ut.length,hn=Ut.charAt(un-2)==="="?2:Ut.charAt(un-1)==="="?1:0,Bn=new Kt(3*Ut.length/4-hn),ar=0<hn?Ut.length-4:Ut.length,sr=0;function ur(nr){Bn[sr++]=nr}for(Gt=0;Gt<ar;Gt+=4,0)ur((16711680&($t=cn(Ut.charAt(Gt))<<18|cn(Ut.charAt(Gt+1))<<12|cn(Ut.charAt(Gt+2))<<6|cn(Ut.charAt(Gt+3))))>>16),ur((65280&$t)>>8),ur(255&$t);return hn==2?ur(255&($t=cn(Ut.charAt(Gt))<<2|cn(Ut.charAt(Gt+1))>>4)):hn==1&&(ur(($t=cn(Ut.charAt(Gt))<<10|cn(Ut.charAt(Gt+1))<<4|cn(Ut.charAt(Gt+2))>>2)>>8&255),ur(255&$t)),Bn},jt.fromByteArray=function(Ut){var Gt,$t,un,hn,Bn=Ut.length%3,ar="";function sr(ur){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(ur)}for(Gt=0,un=Ut.length-Bn;Gt<un;Gt+=3)ar+=sr((hn=$t=(Ut[Gt]<<16)+(Ut[Gt+1]<<8)+Ut[Gt+2])>>18&63)+sr(hn>>12&63)+sr(hn>>6&63)+sr(63&hn);switch(Bn){case 1:ar+=sr(($t=Ut[Ut.length-1])>>2),ar+=sr($t<<4&63),ar+="==";break;case 2:ar+=sr(($t=(Ut[Ut.length-2]<<8)+Ut[Ut.length-1])>>10),ar+=sr($t>>4&63),ar+=sr($t<<2&63),ar+="="}return ar}})(d===void 0?this.base64js={}:d)}).call(this,g("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},g("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:10}],3:[function(g,j,d){(function(nt,at,Ft,_t,bt,kt,Vt,qt,zt){var jt=g("base64-js"),Kt=g("ieee754");function Ft(rn,dn,kn){if(!(this instanceof Ft))return new Ft(rn,dn,kn);var Cr,Ar,Lr,ls,Rs,us=typeof rn;if(dn==="base64"&&us=="string")for(rn=(Cr=rn).trim?Cr.trim():Cr.replace(/^\s+|\s+$/g,"");rn.length%4!=0;)rn+="=";if(us=="number")Ar=sr(rn);else if(us=="string")Ar=Ft.byteLength(rn,dn);else{if(us!="object")throw new Error("First argument needs to be a number, array or string.");Ar=sr(rn.length)}if(Ft._useTypedArrays?Lr=Ft._augment(new Uint8Array(Ar)):((Lr=this).length=Ar,Lr._isBuffer=!0),Ft._useTypedArrays&&typeof rn.byteLength=="number")Lr._set(rn);else if(ur(Rs=rn)||Ft.isBuffer(Rs)||Rs&&typeof Rs=="object"&&typeof Rs.length=="number")for(ls=0;ls<Ar;ls++)Ft.isBuffer(rn)?Lr[ls]=rn.readUInt8(ls):Lr[ls]=rn[ls];else if(us=="string")Lr.write(rn,0,dn);else if(us=="number"&&!Ft._useTypedArrays&&!kn)for(ls=0;ls<Ar;ls++)Lr[ls]=0;return Lr}function nn(rn,dn,kn,Cr){Cr||(Gn(typeof kn=="boolean","missing or invalid endian"),Gn(dn!=null,"missing offset"),Gn(dn+1<rn.length,"Trying to read beyond buffer length"));var Ar,Lr=rn.length;if(!(Lr<=dn))return kn?(Ar=rn[dn],dn+1<Lr&&(Ar|=rn[dn+1]<<8)):(Ar=rn[dn]<<8,dn+1<Lr&&(Ar|=rn[dn+1])),Ar}function Lt(rn,dn,kn,Cr){Cr||(Gn(typeof kn=="boolean","missing or invalid endian"),Gn(dn!=null,"missing offset"),Gn(dn+3<rn.length,"Trying to read beyond buffer length"));var Ar,Lr=rn.length;if(!(Lr<=dn))return kn?(dn+2<Lr&&(Ar=rn[dn+2]<<16),dn+1<Lr&&(Ar|=rn[dn+1]<<8),Ar|=rn[dn],dn+3<Lr&&(Ar+=rn[dn+3]<<24>>>0)):(dn+1<Lr&&(Ar=rn[dn+1]<<16),dn+2<Lr&&(Ar|=rn[dn+2]<<8),dn+3<Lr&&(Ar|=rn[dn+3]),Ar+=rn[dn]<<24>>>0),Ar}function Nt(rn,dn,kn,Cr){if(Cr||(Gn(typeof kn=="boolean","missing or invalid endian"),Gn(dn!=null,"missing offset"),Gn(dn+1<rn.length,"Trying to read beyond buffer length")),!(rn.length<=dn)){var Ar=nn(rn,dn,kn,!0);return 32768&Ar?-1*(65535-Ar+1):Ar}}function Ht(rn,dn,kn,Cr){if(Cr||(Gn(typeof kn=="boolean","missing or invalid endian"),Gn(dn!=null,"missing offset"),Gn(dn+3<rn.length,"Trying to read beyond buffer length")),!(rn.length<=dn)){var Ar=Lt(rn,dn,kn,!0);return 2147483648&Ar?-1*(4294967295-Ar+1):Ar}}function on(rn,dn,kn,Cr){return Cr||(Gn(typeof kn=="boolean","missing or invalid endian"),Gn(dn+3<rn.length,"Trying to read beyond buffer length")),Kt.read(rn,dn,kn,23,4)}function en(rn,dn,kn,Cr){return Cr||(Gn(typeof kn=="boolean","missing or invalid endian"),Gn(dn+7<rn.length,"Trying to read beyond buffer length")),Kt.read(rn,dn,kn,52,8)}function cn(rn,dn,kn,Cr,Ar){Ar||(Gn(dn!=null,"missing value"),Gn(typeof Cr=="boolean","missing or invalid endian"),Gn(kn!=null,"missing offset"),Gn(kn+1<rn.length,"trying to write beyond buffer length"),qn(dn,65535));var Lr=rn.length;if(!(Lr<=kn))for(var ls=0,Rs=Math.min(Lr-kn,2);ls<Rs;ls++)rn[kn+ls]=(dn&255<<8*(Cr?ls:1-ls))>>>8*(Cr?ls:1-ls)}function Ut(rn,dn,kn,Cr,Ar){Ar||(Gn(dn!=null,"missing value"),Gn(typeof Cr=="boolean","missing or invalid endian"),Gn(kn!=null,"missing offset"),Gn(kn+3<rn.length,"trying to write beyond buffer length"),qn(dn,4294967295));var Lr=rn.length;if(!(Lr<=kn))for(var ls=0,Rs=Math.min(Lr-kn,4);ls<Rs;ls++)rn[kn+ls]=dn>>>8*(Cr?ls:3-ls)&255}function Gt(rn,dn,kn,Cr,Ar){Ar||(Gn(dn!=null,"missing value"),Gn(typeof Cr=="boolean","missing or invalid endian"),Gn(kn!=null,"missing offset"),Gn(kn+1<rn.length,"Trying to write beyond buffer length"),Kn(dn,32767,-32768)),rn.length<=kn||cn(rn,0<=dn?dn:65535+dn+1,kn,Cr,Ar)}function $t(rn,dn,kn,Cr,Ar){Ar||(Gn(dn!=null,"missing value"),Gn(typeof Cr=="boolean","missing or invalid endian"),Gn(kn!=null,"missing offset"),Gn(kn+3<rn.length,"Trying to write beyond buffer length"),Kn(dn,2147483647,-2147483648)),rn.length<=kn||Ut(rn,0<=dn?dn:4294967295+dn+1,kn,Cr,Ar)}function un(rn,dn,kn,Cr,Ar){Ar||(Gn(dn!=null,"missing value"),Gn(typeof Cr=="boolean","missing or invalid endian"),Gn(kn!=null,"missing offset"),Gn(kn+3<rn.length,"Trying to write beyond buffer length"),wr(dn,34028234663852886e22,-34028234663852886e22)),rn.length<=kn||Kt.write(rn,dn,kn,Cr,23,4)}function hn(rn,dn,kn,Cr,Ar){Ar||(Gn(dn!=null,"missing value"),Gn(typeof Cr=="boolean","missing or invalid endian"),Gn(kn!=null,"missing offset"),Gn(kn+7<rn.length,"Trying to write beyond buffer length"),wr(dn,17976931348623157e292,-17976931348623157e292)),rn.length<=kn||Kt.write(rn,dn,kn,Cr,52,8)}d.Buffer=Ft,d.SlowBuffer=Ft,d.INSPECT_MAX_BYTES=50,Ft.poolSize=8192,Ft._useTypedArrays=function(){try{var rn=new ArrayBuffer(0),dn=new Uint8Array(rn);return dn.foo=function(){return 42},dn.foo()===42&&typeof dn.subarray=="function"}catch{return!1}}(),Ft.isEncoding=function(rn){switch(String(rn).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Ft.isBuffer=function(rn){return!(rn==null||!rn._isBuffer)},Ft.byteLength=function(rn,dn){var kn;switch(rn+="",dn||"utf8"){case"hex":kn=rn.length/2;break;case"utf8":case"utf-8":kn=hr(rn).length;break;case"ascii":case"binary":case"raw":kn=rn.length;break;case"base64":kn=zn(rn).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":kn=2*rn.length;break;default:throw new Error("Unknown encoding")}return kn},Ft.concat=function(rn,dn){if(Gn(ur(rn),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),rn.length===0)return new Ft(0);if(rn.length===1)return rn[0];if(typeof dn!="number")for(Ar=dn=0;Ar<rn.length;Ar++)dn+=rn[Ar].length;for(var kn=new Ft(dn),Cr=0,Ar=0;Ar<rn.length;Ar++){var Lr=rn[Ar];Lr.copy(kn,Cr),Cr+=Lr.length}return kn},Ft.prototype.write=function(rn,dn,kn,Cr){var Ar;isFinite(dn)?isFinite(kn)||(Cr=kn,kn=void 0):(Ar=Cr,Cr=dn,dn=kn,kn=Ar),dn=Number(dn)||0;var Lr,ls,Rs,us,ws,io,ks,er=this.length-dn;switch((!kn||er<(kn=Number(kn)))&&(kn=er),Cr=String(Cr||"utf8").toLowerCase()){case"hex":Lr=function(Vs,Ll,Nl,Qs){Nl=Number(Nl)||0;var So=Vs.length-Nl;(!Qs||So<(Qs=Number(Qs)))&&(Qs=So);var _l=Ll.length;Gn(_l%2==0,"Invalid hex string"),_l/2<Qs&&(Qs=_l/2);for(var Mo=0;Mo<Qs;Mo++){var Bo=parseInt(Ll.substr(2*Mo,2),16);Gn(!isNaN(Bo),"Invalid hex string"),Vs[Nl+Mo]=Bo}return Ft._charsWritten=2*Mo,Mo}(this,rn,dn,kn);break;case"utf8":case"utf-8":ws=rn,io=dn,ks=kn,Lr=Ft._charsWritten=Yn(hr(ws),this,io,ks);break;case"ascii":case"binary":Lr=function(Vs,Ll,Nl,Qs){return Ft._charsWritten=Yn(function(So){for(var _l=[],Mo=0;Mo<So.length;Mo++)_l.push(255&So.charCodeAt(Mo));return _l}(Ll),Vs,Nl,Qs)}(this,rn,dn,kn);break;case"base64":ls=rn,Rs=dn,us=kn,Lr=Ft._charsWritten=Yn(zn(ls),this,Rs,us);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Lr=function(Vs,Ll,Nl,Qs){return Ft._charsWritten=Yn(function(So){for(var _l,Mo,Bo,_o=[],fo=0;fo<So.length;fo++)Mo=(_l=So.charCodeAt(fo))>>8,Bo=_l%256,_o.push(Bo),_o.push(Mo);return _o}(Ll),Vs,Nl,Qs)}(this,rn,dn,kn);break;default:throw new Error("Unknown encoding")}return Lr},Ft.prototype.toString=function(rn,dn,kn){var Cr,Ar,Lr,ls,Rs=this;if(rn=String(rn||"utf8").toLowerCase(),dn=Number(dn)||0,(kn=kn!==void 0?Number(kn):kn=Rs.length)===dn)return"";switch(rn){case"hex":Cr=function(us,ws,io){var ks=us.length;(!ws||ws<0)&&(ws=0),(!io||io<0||ks<io)&&(io=ks);for(var er="",Vs=ws;Vs<io;Vs++)er+=nr(us[Vs]);return er}(Rs,dn,kn);break;case"utf8":case"utf-8":Cr=function(us,ws,io){var ks="",er="";io=Math.min(us.length,io);for(var Vs=ws;Vs<io;Vs++)us[Vs]<=127?(ks+=sn(er)+String.fromCharCode(us[Vs]),er=""):er+="%"+us[Vs].toString(16);return ks+sn(er)}(Rs,dn,kn);break;case"ascii":case"binary":Cr=function(us,ws,io){var ks="";io=Math.min(us.length,io);for(var er=ws;er<io;er++)ks+=String.fromCharCode(us[er]);return ks}(Rs,dn,kn);break;case"base64":Ar=Rs,ls=kn,Cr=(Lr=dn)===0&&ls===Ar.length?jt.fromByteArray(Ar):jt.fromByteArray(Ar.slice(Lr,ls));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Cr=function(us,ws,io){for(var ks=us.slice(ws,io),er="",Vs=0;Vs<ks.length;Vs+=2)er+=String.fromCharCode(ks[Vs]+256*ks[Vs+1]);return er}(Rs,dn,kn);break;default:throw new Error("Unknown encoding")}return Cr},Ft.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},Ft.prototype.copy=function(rn,dn,kn,Cr){if(kn=kn||0,Cr||Cr===0||(Cr=this.length),dn=dn||0,Cr!==kn&&rn.length!==0&&this.length!==0){Gn(kn<=Cr,"sourceEnd < sourceStart"),Gn(0<=dn&&dn<rn.length,"targetStart out of bounds"),Gn(0<=kn&&kn<this.length,"sourceStart out of bounds"),Gn(0<=Cr&&Cr<=this.length,"sourceEnd out of bounds"),Cr>this.length&&(Cr=this.length),rn.length-dn<Cr-kn&&(Cr=rn.length-dn+kn);var Ar=Cr-kn;if(Ar<100||!Ft._useTypedArrays)for(var Lr=0;Lr<Ar;Lr++)rn[Lr+dn]=this[Lr+kn];else rn._set(this.subarray(kn,kn+Ar),dn)}},Ft.prototype.slice=function(rn,dn){var kn=this.length;if(rn=ar(rn,kn,0),dn=ar(dn,kn,kn),Ft._useTypedArrays)return Ft._augment(this.subarray(rn,dn));for(var Cr=dn-rn,Ar=new Ft(Cr,void 0,!0),Lr=0;Lr<Cr;Lr++)Ar[Lr]=this[Lr+rn];return Ar},Ft.prototype.get=function(rn){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(rn)},Ft.prototype.set=function(rn,dn){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(rn,dn)},Ft.prototype.readUInt8=function(rn,dn){if(dn||(Gn(rn!=null,"missing offset"),Gn(rn<this.length,"Trying to read beyond buffer length")),!(rn>=this.length))return this[rn]},Ft.prototype.readUInt16LE=function(rn,dn){return nn(this,rn,!0,dn)},Ft.prototype.readUInt16BE=function(rn,dn){return nn(this,rn,!1,dn)},Ft.prototype.readUInt32LE=function(rn,dn){return Lt(this,rn,!0,dn)},Ft.prototype.readUInt32BE=function(rn,dn){return Lt(this,rn,!1,dn)},Ft.prototype.readInt8=function(rn,dn){if(dn||(Gn(rn!=null,"missing offset"),Gn(rn<this.length,"Trying to read beyond buffer length")),!(rn>=this.length))return 128&this[rn]?-1*(255-this[rn]+1):this[rn]},Ft.prototype.readInt16LE=function(rn,dn){return Nt(this,rn,!0,dn)},Ft.prototype.readInt16BE=function(rn,dn){return Nt(this,rn,!1,dn)},Ft.prototype.readInt32LE=function(rn,dn){return Ht(this,rn,!0,dn)},Ft.prototype.readInt32BE=function(rn,dn){return Ht(this,rn,!1,dn)},Ft.prototype.readFloatLE=function(rn,dn){return on(this,rn,!0,dn)},Ft.prototype.readFloatBE=function(rn,dn){return on(this,rn,!1,dn)},Ft.prototype.readDoubleLE=function(rn,dn){return en(this,rn,!0,dn)},Ft.prototype.readDoubleBE=function(rn,dn){return en(this,rn,!1,dn)},Ft.prototype.writeUInt8=function(rn,dn,kn){kn||(Gn(rn!=null,"missing value"),Gn(dn!=null,"missing offset"),Gn(dn<this.length,"trying to write beyond buffer length"),qn(rn,255)),dn>=this.length||(this[dn]=rn)},Ft.prototype.writeUInt16LE=function(rn,dn,kn){cn(this,rn,dn,!0,kn)},Ft.prototype.writeUInt16BE=function(rn,dn,kn){cn(this,rn,dn,!1,kn)},Ft.prototype.writeUInt32LE=function(rn,dn,kn){Ut(this,rn,dn,!0,kn)},Ft.prototype.writeUInt32BE=function(rn,dn,kn){Ut(this,rn,dn,!1,kn)},Ft.prototype.writeInt8=function(rn,dn,kn){kn||(Gn(rn!=null,"missing value"),Gn(dn!=null,"missing offset"),Gn(dn<this.length,"Trying to write beyond buffer length"),Kn(rn,127,-128)),dn>=this.length||(0<=rn?this.writeUInt8(rn,dn,kn):this.writeUInt8(255+rn+1,dn,kn))},Ft.prototype.writeInt16LE=function(rn,dn,kn){Gt(this,rn,dn,!0,kn)},Ft.prototype.writeInt16BE=function(rn,dn,kn){Gt(this,rn,dn,!1,kn)},Ft.prototype.writeInt32LE=function(rn,dn,kn){$t(this,rn,dn,!0,kn)},Ft.prototype.writeInt32BE=function(rn,dn,kn){$t(this,rn,dn,!1,kn)},Ft.prototype.writeFloatLE=function(rn,dn,kn){un(this,rn,dn,!0,kn)},Ft.prototype.writeFloatBE=function(rn,dn,kn){un(this,rn,dn,!1,kn)},Ft.prototype.writeDoubleLE=function(rn,dn,kn){hn(this,rn,dn,!0,kn)},Ft.prototype.writeDoubleBE=function(rn,dn,kn){hn(this,rn,dn,!1,kn)},Ft.prototype.fill=function(rn,dn,kn){if(rn=rn||0,dn=dn||0,kn=kn||this.length,typeof rn=="string"&&(rn=rn.charCodeAt(0)),Gn(typeof rn=="number"&&!isNaN(rn),"value is not a number"),Gn(dn<=kn,"end < start"),kn!==dn&&this.length!==0){Gn(0<=dn&&dn<this.length,"start out of bounds"),Gn(0<=kn&&kn<=this.length,"end out of bounds");for(var Cr=dn;Cr<kn;Cr++)this[Cr]=rn}},Ft.prototype.inspect=function(){for(var rn=[],dn=this.length,kn=0;kn<dn;kn++)if(rn[kn]=nr(this[kn]),kn===d.INSPECT_MAX_BYTES){rn[kn+1]="...";break}return"<Buffer "+rn.join(" ")+">"},Ft.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(Ft._useTypedArrays)return new Ft(this).buffer;for(var rn=new Uint8Array(this.length),dn=0,kn=rn.length;dn<kn;dn+=1)rn[dn]=this[dn];return rn.buffer};var Bn=Ft.prototype;function ar(rn,dn,kn){return typeof rn!="number"?kn:dn<=(rn=~~rn)?dn:0<=rn||0<=(rn+=dn)?rn:0}function sr(rn){return(rn=~~Math.ceil(+rn))<0?0:rn}function ur(rn){return(Array.isArray||function(dn){return Object.prototype.toString.call(dn)==="[object Array]"})(rn)}function nr(rn){return rn<16?"0"+rn.toString(16):rn.toString(16)}function hr(rn){for(var dn=[],kn=0;kn<rn.length;kn++){var Cr=rn.charCodeAt(kn);if(Cr<=127)dn.push(rn.charCodeAt(kn));else{var Ar=kn;55296<=Cr&&Cr<=57343&&kn++;for(var Lr=encodeURIComponent(rn.slice(Ar,kn+1)).substr(1).split("%"),ls=0;ls<Lr.length;ls++)dn.push(parseInt(Lr[ls],16))}}return dn}function zn(rn){return jt.toByteArray(rn)}function Yn(rn,dn,kn,Cr){for(var Ar=0;Ar<Cr&&!(Ar+kn>=dn.length||Ar>=rn.length);Ar++)dn[Ar+kn]=rn[Ar];return Ar}function sn(rn){try{return decodeURIComponent(rn)}catch{return String.fromCharCode(65533)}}function qn(rn,dn){Gn(typeof rn=="number","cannot write a non-number as a number"),Gn(0<=rn,"specified a negative value for writing an unsigned value"),Gn(rn<=dn,"value is larger than maximum value for type"),Gn(Math.floor(rn)===rn,"value has a fractional component")}function Kn(rn,dn,kn){Gn(typeof rn=="number","cannot write a non-number as a number"),Gn(rn<=dn,"value larger than maximum allowed value"),Gn(kn<=rn,"value smaller than minimum allowed value"),Gn(Math.floor(rn)===rn,"value has a fractional component")}function wr(rn,dn,kn){Gn(typeof rn=="number","cannot write a non-number as a number"),Gn(rn<=dn,"value larger than maximum allowed value"),Gn(kn<=rn,"value smaller than minimum allowed value")}function Gn(rn,dn){if(!rn)throw new Error(dn||"Failed assertion")}Ft._augment=function(rn){return rn._isBuffer=!0,rn._get=rn.get,rn._set=rn.set,rn.get=Bn.get,rn.set=Bn.set,rn.write=Bn.write,rn.toString=Bn.toString,rn.toLocaleString=Bn.toString,rn.toJSON=Bn.toJSON,rn.copy=Bn.copy,rn.slice=Bn.slice,rn.readUInt8=Bn.readUInt8,rn.readUInt16LE=Bn.readUInt16LE,rn.readUInt16BE=Bn.readUInt16BE,rn.readUInt32LE=Bn.readUInt32LE,rn.readUInt32BE=Bn.readUInt32BE,rn.readInt8=Bn.readInt8,rn.readInt16LE=Bn.readInt16LE,rn.readInt16BE=Bn.readInt16BE,rn.readInt32LE=Bn.readInt32LE,rn.readInt32BE=Bn.readInt32BE,rn.readFloatLE=Bn.readFloatLE,rn.readFloatBE=Bn.readFloatBE,rn.readDoubleLE=Bn.readDoubleLE,rn.readDoubleBE=Bn.readDoubleBE,rn.writeUInt8=Bn.writeUInt8,rn.writeUInt16LE=Bn.writeUInt16LE,rn.writeUInt16BE=Bn.writeUInt16BE,rn.writeUInt32LE=Bn.writeUInt32LE,rn.writeUInt32BE=Bn.writeUInt32BE,rn.writeInt8=Bn.writeInt8,rn.writeInt16LE=Bn.writeInt16LE,rn.writeInt16BE=Bn.writeInt16BE,rn.writeInt32LE=Bn.writeInt32LE,rn.writeInt32BE=Bn.writeInt32BE,rn.writeFloatLE=Bn.writeFloatLE,rn.writeFloatBE=Bn.writeFloatBE,rn.writeDoubleLE=Bn.writeDoubleLE,rn.writeDoubleBE=Bn.writeDoubleBE,rn.fill=Bn.fill,rn.inspect=Bn.inspect,rn.toArrayBuffer=Bn.toArrayBuffer,rn}}).call(this,g("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},g("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:11,lYpoI2:10}],4:[function(g,j,d){(function(nt,at,ht,_t,bt,kt,Vt,qt,zt){ht=g("buffer").Buffer;var jt=new ht(4);jt.fill(0),j.exports={hash:function(Kt,Ft,nn,Lt){return ht.isBuffer(Kt)||(Kt=new ht(Kt)),function(Nt,Ht,on){for(var en=new ht(Ht),cn=on?en.writeInt32BE:en.writeInt32LE,Ut=0;Ut<Nt.length;Ut++)cn.call(en,Nt[Ut],4*Ut,!0);return en}(Ft(function(Nt,Ht){var on;Nt.length%4!=0&&(on=Nt.length+(4-Nt.length%4),Nt=ht.concat([Nt,jt],on));for(var en=[],cn=Ht?Nt.readInt32BE:Nt.readInt32LE,Ut=0;Ut<Nt.length;Ut+=4)en.push(cn.call(Nt,Ut));return en}(Kt,Lt),8*Kt.length),nn,Lt)}}}).call(this,g("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},g("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],5:[function(g,j,d){(function(nt,at,ht,_t,bt,kt,Vt,qt,zt){ht=g("buffer").Buffer;var jt=g("./sha"),Kt=g("./sha256"),Ft=g("./rng"),nn={sha1:jt,sha256:Kt,md5:g("./md5")},Lt=64,Nt=new ht(Lt);function Ht(en,cn){var Ut=nn[en=en||"sha1"],Gt=[];return Ut||on("algorithm:",en,"is not yet supported"),{update:function($t){return ht.isBuffer($t)||($t=new ht($t)),Gt.push($t),$t.length,this},digest:function($t){var un=ht.concat(Gt),hn=cn?function(Bn,ar,sr){ht.isBuffer(ar)||(ar=new ht(ar)),ht.isBuffer(sr)||(sr=new ht(sr)),ar.length>Lt?ar=Bn(ar):ar.length<Lt&&(ar=ht.concat([ar,Nt],Lt));for(var ur=new ht(Lt),nr=new ht(Lt),hr=0;hr<Lt;hr++)ur[hr]=54^ar[hr],nr[hr]=92^ar[hr];var zn=Bn(ht.concat([ur,sr]));return Bn(ht.concat([nr,zn]))}(Ut,cn,un):Ut(un);return Gt=null,$t?hn.toString($t):hn}}}function on(){var en=[].slice.call(arguments).join(" ");throw new Error([en,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}Nt.fill(0),d.createHash=function(en){return Ht(en)},d.createHmac=Ht,d.randomBytes=function(en,cn){if(!cn||!cn.call)return new ht(Ft(en));try{cn.call(this,void 0,new ht(Ft(en)))}catch(Ut){cn(Ut)}},function(en,cn){for(var Ut in en)cn(en[Ut])}(["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],function(en){d[en]=function(){on("sorry,",en,"is not implemented yet")}})}).call(this,g("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},g("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:10}],6:[function(g,j,d){(function(nt,at,ht,_t,bt,kt,Vt,qt,zt){var jt=g("./helpers");function Kt(en,cn){en[cn>>5]|=128<<cn%32,en[14+(cn+64>>>9<<4)]=cn;for(var Ut=1732584193,Gt=-271733879,$t=-1732584194,un=271733878,hn=0;hn<en.length;hn+=16){var Bn=Ut,ar=Gt,sr=$t,ur=un;Ut=nn(Ut,Gt,$t,un,en[hn+0],7,-680876936),un=nn(un,Ut,Gt,$t,en[hn+1],12,-389564586),$t=nn($t,un,Ut,Gt,en[hn+2],17,606105819),Gt=nn(Gt,$t,un,Ut,en[hn+3],22,-1044525330),Ut=nn(Ut,Gt,$t,un,en[hn+4],7,-176418897),un=nn(un,Ut,Gt,$t,en[hn+5],12,1200080426),$t=nn($t,un,Ut,Gt,en[hn+6],17,-1473231341),Gt=nn(Gt,$t,un,Ut,en[hn+7],22,-45705983),Ut=nn(Ut,Gt,$t,un,en[hn+8],7,1770035416),un=nn(un,Ut,Gt,$t,en[hn+9],12,-1958414417),$t=nn($t,un,Ut,Gt,en[hn+10],17,-42063),Gt=nn(Gt,$t,un,Ut,en[hn+11],22,-1990404162),Ut=nn(Ut,Gt,$t,un,en[hn+12],7,1804603682),un=nn(un,Ut,Gt,$t,en[hn+13],12,-40341101),$t=nn($t,un,Ut,Gt,en[hn+14],17,-1502002290),Ut=Lt(Ut,Gt=nn(Gt,$t,un,Ut,en[hn+15],22,1236535329),$t,un,en[hn+1],5,-165796510),un=Lt(un,Ut,Gt,$t,en[hn+6],9,-1069501632),$t=Lt($t,un,Ut,Gt,en[hn+11],14,643717713),Gt=Lt(Gt,$t,un,Ut,en[hn+0],20,-373897302),Ut=Lt(Ut,Gt,$t,un,en[hn+5],5,-701558691),un=Lt(un,Ut,Gt,$t,en[hn+10],9,38016083),$t=Lt($t,un,Ut,Gt,en[hn+15],14,-660478335),Gt=Lt(Gt,$t,un,Ut,en[hn+4],20,-405537848),Ut=Lt(Ut,Gt,$t,un,en[hn+9],5,568446438),un=Lt(un,Ut,Gt,$t,en[hn+14],9,-1019803690),$t=Lt($t,un,Ut,Gt,en[hn+3],14,-187363961),Gt=Lt(Gt,$t,un,Ut,en[hn+8],20,1163531501),Ut=Lt(Ut,Gt,$t,un,en[hn+13],5,-1444681467),un=Lt(un,Ut,Gt,$t,en[hn+2],9,-51403784),$t=Lt($t,un,Ut,Gt,en[hn+7],14,1735328473),Ut=Nt(Ut,Gt=Lt(Gt,$t,un,Ut,en[hn+12],20,-1926607734),$t,un,en[hn+5],4,-378558),un=Nt(un,Ut,Gt,$t,en[hn+8],11,-2022574463),$t=Nt($t,un,Ut,Gt,en[hn+11],16,1839030562),Gt=Nt(Gt,$t,un,Ut,en[hn+14],23,-35309556),Ut=Nt(Ut,Gt,$t,un,en[hn+1],4,-1530992060),un=Nt(un,Ut,Gt,$t,en[hn+4],11,1272893353),$t=Nt($t,un,Ut,Gt,en[hn+7],16,-155497632),Gt=Nt(Gt,$t,un,Ut,en[hn+10],23,-1094730640),Ut=Nt(Ut,Gt,$t,un,en[hn+13],4,681279174),un=Nt(un,Ut,Gt,$t,en[hn+0],11,-358537222),$t=Nt($t,un,Ut,Gt,en[hn+3],16,-722521979),Gt=Nt(Gt,$t,un,Ut,en[hn+6],23,76029189),Ut=Nt(Ut,Gt,$t,un,en[hn+9],4,-640364487),un=Nt(un,Ut,Gt,$t,en[hn+12],11,-421815835),$t=Nt($t,un,Ut,Gt,en[hn+15],16,530742520),Ut=Ht(Ut,Gt=Nt(Gt,$t,un,Ut,en[hn+2],23,-995338651),$t,un,en[hn+0],6,-198630844),un=Ht(un,Ut,Gt,$t,en[hn+7],10,1126891415),$t=Ht($t,un,Ut,Gt,en[hn+14],15,-1416354905),Gt=Ht(Gt,$t,un,Ut,en[hn+5],21,-57434055),Ut=Ht(Ut,Gt,$t,un,en[hn+12],6,1700485571),un=Ht(un,Ut,Gt,$t,en[hn+3],10,-1894986606),$t=Ht($t,un,Ut,Gt,en[hn+10],15,-1051523),Gt=Ht(Gt,$t,un,Ut,en[hn+1],21,-2054922799),Ut=Ht(Ut,Gt,$t,un,en[hn+8],6,1873313359),un=Ht(un,Ut,Gt,$t,en[hn+15],10,-30611744),$t=Ht($t,un,Ut,Gt,en[hn+6],15,-1560198380),Gt=Ht(Gt,$t,un,Ut,en[hn+13],21,1309151649),Ut=Ht(Ut,Gt,$t,un,en[hn+4],6,-145523070),un=Ht(un,Ut,Gt,$t,en[hn+11],10,-1120210379),$t=Ht($t,un,Ut,Gt,en[hn+2],15,718787259),Gt=Ht(Gt,$t,un,Ut,en[hn+9],21,-343485551),Ut=on(Ut,Bn),Gt=on(Gt,ar),$t=on($t,sr),un=on(un,ur)}return Array(Ut,Gt,$t,un)}function Ft(en,cn,Ut,Gt,$t,un){return on((hn=on(on(cn,en),on(Gt,un)))<<(Bn=$t)|hn>>>32-Bn,Ut);var hn,Bn}function nn(en,cn,Ut,Gt,$t,un,hn){return Ft(cn&Ut|~cn&Gt,en,cn,$t,un,hn)}function Lt(en,cn,Ut,Gt,$t,un,hn){return Ft(cn&Gt|Ut&~Gt,en,cn,$t,un,hn)}function Nt(en,cn,Ut,Gt,$t,un,hn){return Ft(cn^Ut^Gt,en,cn,$t,un,hn)}function Ht(en,cn,Ut,Gt,$t,un,hn){return Ft(Ut^(cn|~Gt),en,cn,$t,un,hn)}function on(en,cn){var Ut=(65535&en)+(65535&cn);return(en>>16)+(cn>>16)+(Ut>>16)<<16|65535&Ut}j.exports=function(en){return jt.hash(en,Kt,16)}}).call(this,g("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},g("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],7:[function(g,j,d){(function(nt,at,ht,_t,bt,kt,Vt,qt,zt){var jt;jt=function(Kt){for(var Ft,nn=new Array(Kt),Lt=0;Lt<Kt;Lt++)!(3&Lt)&&(Ft=4294967296*Math.random()),nn[Lt]=Ft>>>((3&Lt)<<3)&255;return nn},j.exports=jt}).call(this,g("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},g("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],8:[function(g,j,d){(function(nt,at,ht,_t,bt,kt,Vt,qt,zt){var jt=g("./helpers");function Kt(Lt,Nt){Lt[Nt>>5]|=128<<24-Nt%32,Lt[15+(Nt+64>>9<<4)]=Nt;for(var Ht,on,en,cn,Ut,Gt=Array(80),$t=1732584193,un=-271733879,hn=-1732584194,Bn=271733878,ar=-1009589776,sr=0;sr<Lt.length;sr+=16){for(var ur=$t,nr=un,hr=hn,zn=Bn,Yn=ar,sn=0;sn<80;sn++){Gt[sn]=sn<16?Lt[sr+sn]:nn(Gt[sn-3]^Gt[sn-8]^Gt[sn-14]^Gt[sn-16],1);var qn=Ft(Ft(nn($t,5),(en=un,cn=hn,Ut=Bn,(on=sn)<20?en&cn|~en&Ut:!(on<40)&&on<60?en&cn|en&Ut|cn&Ut:en^cn^Ut)),Ft(Ft(ar,Gt[sn]),(Ht=sn)<20?1518500249:Ht<40?1859775393:Ht<60?-1894007588:-899497514));ar=Bn,Bn=hn,hn=nn(un,30),un=$t,$t=qn}$t=Ft($t,ur),un=Ft(un,nr),hn=Ft(hn,hr),Bn=Ft(Bn,zn),ar=Ft(ar,Yn)}return Array($t,un,hn,Bn,ar)}function Ft(Lt,Nt){var Ht=(65535&Lt)+(65535&Nt);return(Lt>>16)+(Nt>>16)+(Ht>>16)<<16|65535&Ht}function nn(Lt,Nt){return Lt<<Nt|Lt>>>32-Nt}j.exports=function(Lt){return jt.hash(Lt,Kt,20,!0)}}).call(this,g("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},g("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],9:[function(g,j,d){(function(nt,at,ht,_t,bt,kt,Vt,qt,zt){function jt(Lt,Nt){var Ht=(65535&Lt)+(65535&Nt);return(Lt>>16)+(Nt>>16)+(Ht>>16)<<16|65535&Ht}function Kt(Lt,Nt){return Lt>>>Nt|Lt<<32-Nt}function Ft(Lt,Nt){var Ht,on,en,cn,Ut,Gt,$t,un,hn,Bn,ar=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),sr=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),ur=new Array(64);Lt[Nt>>5]|=128<<24-Nt%32,Lt[15+(Nt+64>>9<<4)]=Nt;for(var nr,hr,zn,Yn,sn,qn,Kn,wr,Gn=0;Gn<Lt.length;Gn+=16){Ht=sr[0],on=sr[1],en=sr[2],cn=sr[3],Ut=sr[4],Gt=sr[5],$t=sr[6],un=sr[7];for(var rn=0;rn<64;rn++)ur[rn]=rn<16?Lt[rn+Gn]:jt(jt(jt(Kt(wr=ur[rn-2],17)^Kt(wr,19)^wr>>>10,ur[rn-7]),Kt(Kn=ur[rn-15],7)^Kt(Kn,18)^Kn>>>3),ur[rn-16]),hn=jt(jt(jt(jt(un,Kt(qn=Ut,6)^Kt(qn,11)^Kt(qn,25)),(sn=Ut)&Gt^~sn&$t),ar[rn]),ur[rn]),Bn=jt(Kt(Yn=Ht,2)^Kt(Yn,13)^Kt(Yn,22),(nr=Ht)&(hr=on)^nr&(zn=en)^hr&zn),un=$t,$t=Gt,Gt=Ut,Ut=jt(cn,hn),cn=en,en=on,on=Ht,Ht=jt(hn,Bn);sr[0]=jt(Ht,sr[0]),sr[1]=jt(on,sr[1]),sr[2]=jt(en,sr[2]),sr[3]=jt(cn,sr[3]),sr[4]=jt(Ut,sr[4]),sr[5]=jt(Gt,sr[5]),sr[6]=jt($t,sr[6]),sr[7]=jt(un,sr[7])}return sr}var nn=g("./helpers");j.exports=function(Lt){return nn.hash(Lt,Ft,32,!0)}}).call(this,g("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},g("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],10:[function(g,j,d){(function(nt,at,ht,_t,bt,kt,Vt,qt,zt){function jt(){}(nt=j.exports={}).nextTick=function(){var Kt=typeof window<"u"&&window.setImmediate,Ft=typeof window<"u"&&window.postMessage&&window.addEventListener;if(Kt)return function(Lt){return window.setImmediate(Lt)};if(Ft){var nn=[];return window.addEventListener("message",function(Lt){var Nt=Lt.source;Nt!==window&&Nt!==null||Lt.data!=="process-tick"||(Lt.stopPropagation(),0<nn.length&&nn.shift()())},!0),function(Lt){nn.push(Lt),window.postMessage("process-tick","*")}}return function(Lt){setTimeout(Lt,0)}}(),nt.title="browser",nt.browser=!0,nt.env={},nt.argv=[],nt.on=jt,nt.addListener=jt,nt.once=jt,nt.off=jt,nt.removeListener=jt,nt.removeAllListeners=jt,nt.emit=jt,nt.binding=function(Kt){throw new Error("process.binding is not supported")},nt.cwd=function(){return"/"},nt.chdir=function(Kt){throw new Error("process.chdir is not supported")}}).call(this,g("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},g("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:10}],11:[function(g,j,d){(function(nt,at,ht,_t,bt,kt,Vt,qt,zt){d.read=function(jt,Kt,Ft,nn,Lt){var Nt,Ht,on=8*Lt-nn-1,en=(1<<on)-1,cn=en>>1,Ut=-7,Gt=Ft?Lt-1:0,$t=Ft?-1:1,un=jt[Kt+Gt];for(Gt+=$t,Nt=un&(1<<-Ut)-1,un>>=-Ut,Ut+=on;0<Ut;Nt=256*Nt+jt[Kt+Gt],Gt+=$t,Ut-=8);for(Ht=Nt&(1<<-Ut)-1,Nt>>=-Ut,Ut+=nn;0<Ut;Ht=256*Ht+jt[Kt+Gt],Gt+=$t,Ut-=8);if(Nt===0)Nt=1-cn;else{if(Nt===en)return Ht?NaN:1/0*(un?-1:1);Ht+=Math.pow(2,nn),Nt-=cn}return(un?-1:1)*Ht*Math.pow(2,Nt-nn)},d.write=function(jt,Kt,Ft,nn,Lt,Nt){var Ht,on,en,cn=8*Nt-Lt-1,Ut=(1<<cn)-1,Gt=Ut>>1,$t=Lt===23?Math.pow(2,-24)-Math.pow(2,-77):0,un=nn?0:Nt-1,hn=nn?1:-1,Bn=Kt<0||Kt===0&&1/Kt<0?1:0;for(Kt=Math.abs(Kt),isNaN(Kt)||Kt===1/0?(on=isNaN(Kt)?1:0,Ht=Ut):(Ht=Math.floor(Math.log(Kt)/Math.LN2),Kt*(en=Math.pow(2,-Ht))<1&&(Ht--,en*=2),2<=(Kt+=1<=Ht+Gt?$t/en:$t*Math.pow(2,1-Gt))*en&&(Ht++,en/=2),Ut<=Ht+Gt?(on=0,Ht=Ut):1<=Ht+Gt?(on=(Kt*en-1)*Math.pow(2,Lt),Ht+=Gt):(on=Kt*Math.pow(2,Gt-1)*Math.pow(2,Lt),Ht=0));8<=Lt;jt[Ft+un]=255&on,un+=hn,on/=256,Lt-=8);for(Ht=Ht<<Lt|on,cn+=Lt;0<cn;jt[Ft+un]=255&Ht,un+=hn,Ht/=256,cn-=8);jt[Ft+un-hn]|=128*Bn}}).call(this,g("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},g("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/ieee754/index.js","/node_modules/ieee754")},{buffer:3,lYpoI2:10}]},{},[1])(1)},654:function(b){var g=function(){function j(Ft){return Vt(Ft,qt(kt(zt(Ft.length),Ft),1/Ft.length))}function d(Ft){return kt(jt(Ft),Ft)}function nt(Ft,nn){return qt(Ft,nn?1/(Ft.length-1):1/Ft.length)}function at(Ft){var nn=function(Nt){var Ht,on=Math.pow(2,-52),en=1e-64/on,cn=0,Ut=0,Gt=0,$t=0,un=0,hn=Kt(Nt),Bn=hn.length,ar=hn[0].length;if(Bn<ar)throw"Need more rows than columns";var sr=new Array(ar),ur=new Array(ar);for(Ut=0;Ut<ar;Ut++)sr[Ut]=ur[Ut]=0;var nr=function Cr(Ar,Lr,ls){ls===void 0&&(ls=0);var Rs,us=Ar[ls],ws=Array(us);if(ls===Ar.length-1){for(Rs=us-2;Rs>=0;Rs-=2)ws[Rs+1]=Lr,ws[Rs]=Lr;return Rs===-1&&(ws[0]=Lr),ws}for(Rs=us-1;Rs>=0;Rs--)ws[Rs]=Cr(Ar,Lr,ls+1);return ws}([ar,ar],0);function hr(Cr,Ar){return(Cr=Math.abs(Cr))>(Ar=Math.abs(Ar))?Cr*Math.sqrt(1+Ar*Ar/Cr/Cr):Ar==0?Cr:Ar*Math.sqrt(1+Cr*Cr/Ar/Ar)}var zn=0,Yn=0,sn=0,qn=0,Kn=0,wr=0,Gn=0;for(Ut=0;Ut<ar;Ut++){for(sr[Ut]=Yn,Gn=0,un=Ut+1,Gt=Ut;Gt<Bn;Gt++)Gn+=hn[Gt][Ut]*hn[Gt][Ut];if(Gn<=en)Yn=0;else for(zn=hn[Ut][Ut],Yn=Math.sqrt(Gn),zn>=0&&(Yn=-Yn),sn=zn*Yn-Gn,hn[Ut][Ut]=zn-Yn,Gt=un;Gt<ar;Gt++){for(Gn=0,$t=Ut;$t<Bn;$t++)Gn+=hn[$t][Ut]*hn[$t][Gt];for(zn=Gn/sn,$t=Ut;$t<Bn;$t++)hn[$t][Gt]+=zn*hn[$t][Ut]}for(ur[Ut]=Yn,Gn=0,Gt=un;Gt<ar;Gt++)Gn+=hn[Ut][Gt]*hn[Ut][Gt];if(Gn<=en)Yn=0;else{for(zn=hn[Ut][Ut+1],Yn=Math.sqrt(Gn),zn>=0&&(Yn=-Yn),sn=zn*Yn-Gn,hn[Ut][Ut+1]=zn-Yn,Gt=un;Gt<ar;Gt++)sr[Gt]=hn[Ut][Gt]/sn;for(Gt=un;Gt<Bn;Gt++){for(Gn=0,$t=un;$t<ar;$t++)Gn+=hn[Gt][$t]*hn[Ut][$t];for($t=un;$t<ar;$t++)hn[Gt][$t]+=Gn*sr[$t]}}(Kn=Math.abs(ur[Ut])+Math.abs(sr[Ut]))>qn&&(qn=Kn)}for(Ut=ar-1;Ut!=-1;Ut+=-1){if(Yn!=0){for(sn=Yn*hn[Ut][Ut+1],Gt=un;Gt<ar;Gt++)nr[Gt][Ut]=hn[Ut][Gt]/sn;for(Gt=un;Gt<ar;Gt++){for(Gn=0,$t=un;$t<ar;$t++)Gn+=hn[Ut][$t]*nr[$t][Gt];for($t=un;$t<ar;$t++)nr[$t][Gt]+=Gn*nr[$t][Ut]}}for(Gt=un;Gt<ar;Gt++)nr[Ut][Gt]=0,nr[Gt][Ut]=0;nr[Ut][Ut]=1,Yn=sr[Ut],un=Ut}for(Ut=ar-1;Ut!=-1;Ut+=-1){for(un=Ut+1,Yn=ur[Ut],Gt=un;Gt<ar;Gt++)hn[Ut][Gt]=0;if(Yn!=0){for(sn=hn[Ut][Ut]*Yn,Gt=un;Gt<ar;Gt++){for(Gn=0,$t=un;$t<Bn;$t++)Gn+=hn[$t][Ut]*hn[$t][Gt];for(zn=Gn/sn,$t=Ut;$t<Bn;$t++)hn[$t][Gt]+=zn*hn[$t][Ut]}for(Gt=Ut;Gt<Bn;Gt++)hn[Gt][Ut]=hn[Gt][Ut]/Yn}else for(Gt=Ut;Gt<Bn;Gt++)hn[Gt][Ut]=0;hn[Ut][Ut]+=1}for(on*=qn,$t=ar-1;$t!=-1;$t+=-1)for(var rn=0;rn<50;rn++){var dn=!1;for(un=$t;un!=-1;un+=-1){if(Math.abs(sr[un])<=on){dn=!0;break}if(Math.abs(ur[un-1])<=on)break}if(!dn){cn=0,Gn=1;var kn=un-1;for(Ut=un;Ut<$t+1&&(zn=Gn*sr[Ut],sr[Ut]=cn*sr[Ut],!(Math.abs(zn)<=on));Ut++)for(sn=hr(zn,Yn=ur[Ut]),ur[Ut]=sn,cn=Yn/sn,Gn=-zn/sn,Gt=0;Gt<Bn;Gt++)Kn=hn[Gt][kn],wr=hn[Gt][Ut],hn[Gt][kn]=Kn*cn+wr*Gn,hn[Gt][Ut]=-Kn*Gn+wr*cn}if(wr=ur[$t],un==$t){if(wr<0)for(ur[$t]=-wr,Gt=0;Gt<ar;Gt++)nr[Gt][$t]=-nr[Gt][$t];break}if(rn>=49)throw"Error: no convergence.";for(qn=ur[un],Yn=hr(zn=(((Kn=ur[$t-1])-wr)*(Kn+wr)+((Yn=sr[$t-1])-(sn=sr[$t]))*(Yn+sn))/(2*sn*Kn),1),zn=zn<0?((qn-wr)*(qn+wr)+sn*(Kn/(zn-Yn)-sn))/qn:((qn-wr)*(qn+wr)+sn*(Kn/(zn+Yn)-sn))/qn,cn=1,Gn=1,Ut=un+1;Ut<$t+1;Ut++){for(Yn=sr[Ut],Kn=ur[Ut],sn=Gn*Yn,Yn*=cn,wr=hr(zn,sn),sr[Ut-1]=wr,zn=qn*(cn=zn/wr)+Yn*(Gn=sn/wr),Yn=-qn*Gn+Yn*cn,sn=Kn*Gn,Kn*=cn,Gt=0;Gt<ar;Gt++)qn=nr[Gt][Ut-1],wr=nr[Gt][Ut],nr[Gt][Ut-1]=qn*cn+wr*Gn,nr[Gt][Ut]=-qn*Gn+wr*cn;for(wr=hr(zn,sn),ur[Ut-1]=wr,zn=(cn=zn/wr)*Yn+(Gn=sn/wr)*Kn,qn=-Gn*Yn+cn*Kn,Gt=0;Gt<Bn;Gt++)Kn=hn[Gt][Ut-1],wr=hn[Gt][Ut],hn[Gt][Ut-1]=Kn*cn+wr*Gn,hn[Gt][Ut]=-Kn*Gn+wr*cn}sr[un]=0,sr[$t]=zn,ur[$t]=qn}for(Ut=0;Ut<ur.length;Ut++)ur[Ut]<on&&(ur[Ut]=0);for(Ut=0;Ut<ar;Ut++)for(Gt=Ut-1;Gt>=0;Gt--)if(ur[Gt]<ur[Ut]){for(cn=ur[Gt],ur[Gt]=ur[Ut],ur[Ut]=cn,$t=0;$t<hn.length;$t++)Ht=hn[$t][Ut],hn[$t][Ut]=hn[$t][Gt],hn[$t][Gt]=Ht;for($t=0;$t<nr.length;$t++)Ht=nr[$t][Ut],nr[$t][Ut]=nr[$t][Gt],nr[$t][Gt]=Ht;Ut=Gt}return{U:hn,S:ur,V:nr}}(Ft);console.log(nn);var Lt=nn.U;return nn.S.map(function(Nt,Ht){var on={};return on.eigenvalue=Nt,on.vector=Lt.map(function(en,cn){return-1*en[Ht]}),on})}function ht(Ft,...nn){var Lt=nn.map(function(on){return on.vector}),Nt=kt(Lt,jt(j(Ft))),Ht=qt(kt(zt(Ft.length),Ft),-1/Ft.length);return{adjustedData:Nt,formattedAdjustedData:bt(Nt,2),avgData:Ht,selectedVectors:Lt}}function _t(Ft){return at(nt(d(j(Ft)),!1))}function bt(Ft,nn){var Lt=Math.pow(10,nn||2);return Ft.map(function(Nt,Ht){return Nt.map(function(on){return Math.round(on*Lt)/Lt})})}function kt(Ft,nn){if(!(Ft[0]&&nn[0]&&Ft.length&&nn.length))throw new Error("Both A and B should be matrices");if(nn.length!==Ft[0].length)throw new Error("Columns in A should be the same as the number of rows in B");for(var Lt=[],Nt=0;Nt<Ft.length;Nt++){Lt[Nt]=[];for(var Ht=0;Ht<nn[0].length;Ht++)for(var on=0;on<Ft[0].length;on++)Lt[Nt][Ht]=Lt[Nt][Ht]?Lt[Nt][Ht]+Ft[Nt][on]*nn[on][Ht]:Ft[Nt][on]*nn[on][Ht]}return Lt}function Vt(Ft,nn){if(Ft.length!==nn.length||Ft[0].length!==nn[0].length)throw new Error("Both A and B should have the same dimensions");for(var Lt=[],Nt=0;Nt<Ft.length;Nt++){Lt[Nt]=[];for(var Ht=0;Ht<nn[0].length;Ht++)Lt[Nt][Ht]=Ft[Nt][Ht]-nn[Nt][Ht]}return Lt}function qt(Ft,nn){for(var Lt=[],Nt=0;Nt<Ft.length;Nt++){Lt[Nt]=[];for(var Ht=0;Ht<Ft[0].length;Ht++)Lt[Nt][Ht]=Ft[Nt][Ht]*nn}return Lt}function zt(Ft){for(var nn=[],Lt=0;Lt<Ft;Lt++){nn[Lt]=[];for(var Nt=0;Nt<Ft;Nt++)nn[Lt][Nt]=1}return nn}function jt(Ft){return Kt(Ft)[0].map(function(nn,Lt){return Ft.map(function(Nt){return Nt[Lt]})})}function Kt(Ft){var nn=JSON.stringify(Ft);return JSON.parse(nn)}return{computeDeviationScores:d,computeDeviationMatrix:j,computeSVD:at,computePercentageExplained:function(Ft,...nn){var Lt=Ft.map(function(Nt){return Nt.eigenvalue}).reduce(function(Nt,Ht){return Nt+Ht});return nn.map(function(Nt){return Nt.eigenvalue}).reduce(function(Nt,Ht){return Nt+Ht})/Lt},computeOriginalData:function(Ft,nn,Lt){var Nt=Vt(jt(kt(jt(nn),Ft)),Lt);return{originalData:Nt,formattedOriginalData:bt(Nt,2)}},computeVarianceCovariance:nt,computeAdjustedData:ht,getEigenVectors:_t,analyseTopResult:function(Ft){var nn=_t(Ft).sort(function(Lt,Nt){return Nt.eigenvalue-Lt.eigenvalue});return console.log("Sorted Vectors",nn),ht(Ft,nn[0].vector)},transpose:jt,multiply:kt,clone:Kt,scale:qt}}();b.exports=g},701:function(b){var g=[];function j(at){for(var ht=-1,_t=0;_t<g.length;_t++)if(g[_t].identifier===at){ht=_t;break}return ht}function d(at,ht){for(var _t={},bt=[],kt=0;kt<at.length;kt++){var Vt=at[kt],qt=ht.base?Vt[0]+ht.base:Vt[0],zt=_t[qt]||0,jt="".concat(qt," ").concat(zt);_t[qt]=zt+1;var Kt=j(jt),Ft={css:Vt[1],media:Vt[2],sourceMap:Vt[3],supports:Vt[4],layer:Vt[5]};if(Kt!==-1)g[Kt].references++,g[Kt].updater(Ft);else{var nn=nt(Ft,ht);ht.byIndex=kt,g.splice(kt,0,{identifier:jt,updater:nn,references:1})}bt.push(jt)}return bt}function nt(at,ht){var _t=ht.domAPI(ht);return _t.update(at),function(bt){if(bt){if(bt.css===at.css&&bt.media===at.media&&bt.sourceMap===at.sourceMap&&bt.supports===at.supports&&bt.layer===at.layer)return;_t.update(at=bt)}else _t.remove()}}b.exports=function(at,ht){var _t=d(at=at||[],ht=ht||{});return function(bt){bt=bt||[];for(var kt=0;kt<_t.length;kt++){var Vt=j(_t[kt]);g[Vt].references--}for(var qt=d(bt,ht),zt=0;zt<_t.length;zt++){var jt=j(_t[zt]);g[jt].references===0&&(g[jt].updater(),g.splice(jt,1))}_t=qt}}},182:function(b){b.exports=function(g){var j=document.createElement("style");return g.setAttributes(j,g.attributes),g.insert(j,g.options),j}},850:function(b,g,j){b.exports=function(d){var nt=j.nc;nt&&d.setAttribute("nonce",nt)}},236:function(b){b.exports=function(g){var j=g.insertStyleElement(g);return{update:function(d){(function(nt,at,ht){var _t="";ht.supports&&(_t+="@supports (".concat(ht.supports,") {")),ht.media&&(_t+="@media ".concat(ht.media," {"));var bt=ht.layer!==void 0;bt&&(_t+="@layer".concat(ht.layer.length>0?" ".concat(ht.layer):""," {")),_t+=ht.css,bt&&(_t+="}"),ht.media&&(_t+="}"),ht.supports&&(_t+="}");var kt=ht.sourceMap;kt&&typeof btoa<"u"&&(_t+=`
/`,_t+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(kt))))," *"),_t+="/"),at.styleTagTransform(_t,nt,at.options)})(j,g,d)},remove:function(){(function(d){if(d.parentNode===null)return!1;d.parentNode.removeChild(d)})(j)}}}},213:function(b){b.exports=function(g,j){if(j.styleSheet)j.styleSheet.cssText=g;else{for(;j.firstChild;)j.removeChild(j.firstChild);j.appendChild(document.createTextNode(g))}}},1:function(b){b.exports=function(){var g={820:function(at,ht,_t){var bt=_t(537),kt=_t.n(bt),Vt=_t(645),qt=_t.n(Vt)()(kt());qt.push([at.id,`.treejs {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.treejs *:after,
.treejs *:before {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.treejs > .treejs-node {
  padding-left: 0;
}
.treejs .treejs-nodes {
  list-style: none;
  padding-left: 18px;
  margin: 0;
  overflow: hidden;
  -webkit-transition: height 150ms ease-out, opacity 150ms ease-out;
  -o-transition: height 150ms ease-out, opacity 150ms ease-out;
  transition: height 150ms ease-out, opacity 150ms ease-out;
}
.treejs .treejs-node {
  cursor: pointer;
  overflow: hidden;
}
.treejs .treejs-node.treejs-placeholder {
  padding-left: 18px;
}
.treejs .treejs-switcher {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
  -webkit-transition: -webkit-transform 150ms ease-out;
  transition: -webkit-transform 150ms ease-out;
  -o-transition: transform 150ms ease-out;
  transition: transform 150ms ease-out;
  transition: transform 150ms ease-out, -webkit-transform 150ms ease-out;
}
.treejs .treejs-switcher:before {
  position: absolute;
  top: 8px;
  left: 6px;
  display: block;
  content: ' ';
  border: 4px solid transparent;
  border-top: 4px solid rgba(245, 245, 245, 0.7);
  -webkit-transition: border-color 150ms;
  -o-transition: border-color 150ms;
  transition: border-color 150ms;
}
.treejs .treejs-switcher:hover:before {
  border-top: 4px solid rgba(245, 245, 245, 0.96);
}
.treejs .treejs-node__close > .treejs-switcher {
  -webkit-transform: rotate(-90deg);
      -ms-transform: rotate(-90deg);
          transform: rotate(-90deg);
}
.treejs .treejs-node__close > .treejs-nodes {
  height: 0;
}
.treejs .treejs-checkbox {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
}
.treejs .treejs-checkbox:before {
  -webkit-transition: all 0.3s;
  -o-transition: all 0.3s;
  transition: all 0.3s;
  cursor: pointer;
  position: absolute;
  top: 2px;
  content: ' ';
  display: block;
  width: 16px;
  height: 16px;
  border: 1px solid #d9d9d9;
  border-radius: 2px;
}
.treejs .treejs-checkbox:hover:before {
  -webkit-box-shadow: 0 0 2px 1px #1890ff;
          box-shadow: 0 0 2px 1px #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 4px;
  left: 5px;
  width: 5px;
  height: 9px;
  border: 2px solid #fff;
  border-top: none;
  border-left: none;
  -webkit-transform: rotate(45deg);
      -ms-transform: rotate(45deg);
          transform: rotate(45deg);
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 9px;
  left: 3px;
  width: 10px;
  height: 2px;
  background-color: #fff;
}
.treejs .treejs-node__disabled {
  cursor: not-allowed;
  color: rgba(255, 255, 255, 0.25);
}
.treejs .treejs-node__disabled .treejs-checkbox {
  cursor: not-allowed;
}
.treejs .treejs-node__disabled .treejs-checkbox:before {
  cursor: not-allowed;
  border-color: #d9d9d9 !important;
  background-color: #f5f5f5 !important;
}
.treejs .treejs-node__disabled .treejs-checkbox:hover:before {
  -webkit-box-shadow: none !important;
          box-shadow: none !important;
}
.treejs .treejs-node__disabled .treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled .treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-label {
  vertical-align: middle;
}
`,"",{version:3,sources:["webpack://./src/index.less"],names:[],mappings:"AAKA;EACE,8BAAA;UAAA,sBAAA;EACA,eAAA;EACA,kBAAA;EACA,yBAAA;KAAA,sBAAA;MAAA,qBAAA;UAAA,iBAAA;AAJF;AAAA;;EAQI,8BAAA;UAAA,sBAAA;AAJJ;AAOE;EACE,eAAA;AALJ;AAPA;EAgBI,gBAAA;EACA,kBAAA;EACA,SAAA;EACA,gBAAA;EACA,iEAAA;EAAA,4DAAA;EAAA,yDAAA;AANJ;AAdA;EAwBI,eAAA;EACA,gBAAA;AAPJ;AASI;EACE,kBAAA;AAPN;AArBA;EAiCI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;EACA,oDAAA;EAAA,4CAAA;EAAA,uCAAA;EAAA,oCAAA;EAAA,sEAAA;AATJ;AAWI;EACE,kBAAA;EACA,QAAA;EACA,SAAA;EACA,cAAA;EACA,YAAA;EACA,6BAAA;EACA,8CAAA;EACA,sCAAA;EAAA,iCAAA;EAAA,8BAAA;AATN;AAWI;EACE,+CAAA;AATN;AA3CA;EAwDI,iCAAA;MAAA,6BAAA;UAAA,yBAAA;AAVJ;AA9CA;EA2DI,SAAA;AAVJ;AAjDA;EA+DI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;AAXJ;AAaI;EACE,4BAAA;EAAA,uBAAA;EAAA,oBAAA;EACA,eAAA;EACA,kBAAA;EACA,QAAA;EACA,YAAA;EACA,cAAA;EACA,WAAA;EACA,YAAA;EACA,yBAAA;EACA,kBAAA;AAXN;AAaI;EACE,uCAAA;UAAA,+BAAA;AAXN;AAgBM;EACE,yBAAA;EACA,qBAAA;AAdR;AAgBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,UAAA;EACA,WAAA;EACA,sBAAA;EACA,gBAAA;EACA,iBAAA;EACA,gCAAA;MAAA,4BAAA;UAAA,wBAAA;AAdR;AAoBM;EACE,yBAAA;EACA,qBAAA;AAlBR;AAoBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,WAAA;EACA,WAAA;EACA,sBAAA;AAlBR;AAvGA;EA+HI,mBAAA;EACA,gCAAA;AArBJ;AA3GA;EAkIM,mBAAA;AApBN;AAqBM;EACE,mBAAA;EACA,gCAAA;EACA,oCAAA;AAnBR;AAqBM;EACE,mCAAA;UAAA,2BAAA;AAnBR;AAwBQ;EACE,qBAAA;AAtBV;AA4BQ;EACE,yBAAA;AA1BV;AAiCM;EACE,qBAAA;AA/BR;AAqCM;EACE,yBAAA;AAnCR;AAlIA;EA2KI,sBAAA;AAtCJ",sourcesContent:[`@color-disable: #d4d4d4;
@bgcolor-disable: #f5f5f5;
@greyborder: #d9d9d9;
@bluebg: #1890ff;

.treejs {
  box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  user-select: none;

  *:after,
  *:before {
    box-sizing: border-box;
  }

  & > .treejs-node {
    padding-left: 0;
  }

  .treejs-nodes {
    list-style: none;
    padding-left: 18px;
    margin: 0; //  for default ul...
    overflow: hidden;
    transition: height 150ms ease-out, opacity 150ms ease-out;
  }

  .treejs-node {
    cursor: pointer;
    overflow: hidden;

    &.treejs-placeholder {
      padding-left: 18px;
    }
  }

  .treejs-switcher {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;
    transition: transform 150ms ease-out;

    &:before {
      position: absolute;
      top: 8px;
      left: 6px;
      display: block;
      content: ' ';
      border: 4px solid transparent;
      border-top: 4px solid rgba(245, 245, 245, 0.7);
      transition: border-color 150ms;
    }
    &:hover:before {
      border-top: 4px solid rgba(245, 245, 245, 0.96);
    }
  }
  .treejs-node__close > .treejs-switcher {
    transform: rotate(-90deg);
  }
  .treejs-node__close > .treejs-nodes {
    height: 0;
  }

  .treejs-checkbox {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;

    &:before {
      transition: all 0.3s;
      cursor: pointer;
      position: absolute;
      top: 2px;
      content: ' ';
      display: block;
      width: 16px;
      height: 16px;
      border: 1px solid @greyborder;
      border-radius: 2px;
    }
    &:hover:before {
      box-shadow: 0 0 2px 1px @bluebg;
    }
  }
  .treejs-node__checked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 4px;
        left: 5px;
        width: 5px;
        height: 9px;
        border: 2px solid #fff;
        border-top: none;
        border-left: none;
        transform: rotate(45deg);
      }
    }
  }
  .treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 9px;
        left: 3px;
        width: 10px;
        height: 2px;
        background-color: #fff;
      }
    }
  }

  .treejs-node__disabled {
    cursor: not-allowed;
    color: rgba(255, 255, 255, 0.25);
    .treejs-checkbox {
      cursor: not-allowed;
      &:before {
        cursor: not-allowed;
        border-color: @greyborder !important;
        background-color: @bgcolor-disable !important;
      }
      &:hover:before {
        box-shadow: none !important;
      }
    }
    .treejs-node__checked {
      & > .treejs-checkbox {
        &:after {
          border-color: @greyborder;
        }
      }
    }
    .treejs-node__halfchecked {
      & > .treejs-checkbox {
        &:after {
          background-color: @greyborder;
        }
      }
    }
  }
  .treejs-node__disabled.treejs-node__checked {
    & > .treejs-checkbox {
      &:after {
        border-color: @greyborder;
      }
    }
  }
  .treejs-node__disabled.treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:after {
        background-color: @greyborder;
      }
    }
  }

  .treejs-label {
    vertical-align: middle;
  }
}
`],sourceRoot:""}]),ht.Z=qt},645:function(at){at.exports=function(ht){var _t=[];return _t.toString=function(){return this.map(function(bt){var kt="",Vt=bt[5]!==void 0;return bt[4]&&(kt+="@supports (".concat(bt[4],") {")),bt[2]&&(kt+="@media ".concat(bt[2]," {")),Vt&&(kt+="@layer".concat(bt[5].length>0?" ".concat(bt[5]):""," {")),kt+=ht(bt),Vt&&(kt+="}"),bt[2]&&(kt+="}"),bt[4]&&(kt+="}"),kt}).join("")},_t.i=function(bt,kt,Vt,qt,zt){typeof bt=="string"&&(bt=[[null,bt,void 0]]);var jt={};if(Vt)for(var Kt=0;Kt<this.length;Kt++){var Ft=this[Kt][0];Ft!=null&&(jt[Ft]=!0)}for(var nn=0;nn<bt.length;nn++){var Lt=[].concat(bt[nn]);Vt&&jt[Lt[0]]||(zt!==void 0&&(Lt[5]===void 0||(Lt[1]="@layer".concat(Lt[5].length>0?" ".concat(Lt[5]):""," {").concat(Lt[1],"}")),Lt[5]=zt),kt&&(Lt[2]&&(Lt[1]="@media ".concat(Lt[2]," {").concat(Lt[1],"}")),Lt[2]=kt),qt&&(Lt[4]?(Lt[1]="@supports (".concat(Lt[4],") {").concat(Lt[1],"}"),Lt[4]=qt):Lt[4]="".concat(qt)),_t.push(Lt))}},_t}},537:function(at){at.exports=function(ht){var _t=ht[1],bt=ht[3];if(!bt)return _t;if(typeof btoa=="function"){var kt=btoa(unescape(encodeURIComponent(JSON.stringify(bt)))),Vt="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(kt),qt="/*# ".concat(Vt," */"),zt=bt.sources.map(function(jt){return"/*# sourceURL=".concat(bt.sourceRoot||"").concat(jt," */")});return[_t].concat(zt).concat([qt]).join(`
`)}return[_t].join(`
`)}},379:function(at){var ht=[];function _t(Vt){for(var qt=-1,zt=0;zt<ht.length;zt++)if(ht[zt].identifier===Vt){qt=zt;break}return qt}function bt(Vt,qt){for(var zt={},jt=[],Kt=0;Kt<Vt.length;Kt++){var Ft=Vt[Kt],nn=qt.base?Ft[0]+qt.base:Ft[0],Lt=zt[nn]||0,Nt="".concat(nn," ").concat(Lt);zt[nn]=Lt+1;var Ht=_t(Nt),on={css:Ft[1],media:Ft[2],sourceMap:Ft[3],supports:Ft[4],layer:Ft[5]};if(Ht!==-1)ht[Ht].references++,ht[Ht].updater(on);else{var en=kt(on,qt);qt.byIndex=Kt,ht.splice(Kt,0,{identifier:Nt,updater:en,references:1})}jt.push(Nt)}return jt}function kt(Vt,qt){var zt=qt.domAPI(qt);return zt.update(Vt),function(jt){if(jt){if(jt.css===Vt.css&&jt.media===Vt.media&&jt.sourceMap===Vt.sourceMap&&jt.supports===Vt.supports&&jt.layer===Vt.layer)return;zt.update(Vt=jt)}else zt.remove()}}at.exports=function(Vt,qt){var zt=bt(Vt=Vt||[],qt=qt||{});return function(jt){jt=jt||[];for(var Kt=0;Kt<zt.length;Kt++){var Ft=_t(zt[Kt]);ht[Ft].references--}for(var nn=bt(jt,qt),Lt=0;Lt<zt.length;Lt++){var Nt=_t(zt[Lt]);ht[Nt].references===0&&(ht[Nt].updater(),ht.splice(Nt,1))}zt=nn}}},216:function(at){at.exports=function(ht){var _t=document.createElement("style");return ht.setAttributes(_t,ht.attributes),ht.insert(_t,ht.options),_t}},636:function(at,ht,_t){at.exports=function(bt){var kt=_t.nc;kt&&bt.setAttribute("nonce",kt)}},795:function(at){at.exports=function(ht){var _t=ht.insertStyleElement(ht);return{update:function(bt){(function(kt,Vt,qt){var zt="";qt.supports&&(zt+="@supports (".concat(qt.supports,") {")),qt.media&&(zt+="@media ".concat(qt.media," {"));var jt=qt.layer!==void 0;jt&&(zt+="@layer".concat(qt.layer.length>0?" ".concat(qt.layer):""," {")),zt+=qt.css,jt&&(zt+="}"),qt.media&&(zt+="}"),qt.supports&&(zt+="}");var Kt=qt.sourceMap;Kt&&typeof btoa<"u"&&(zt+=`
/`,zt+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(Kt))))," *"),zt+="/"),Vt.styleTagTransform(zt,kt,Vt.options)})(_t,ht,bt)},remove:function(){(function(bt){if(bt.parentNode===null)return!1;bt.parentNode.removeChild(bt)})(_t)}}}},589:function(at){at.exports=function(ht,_t){if(_t.styleSheet)_t.styleSheet.cssText=ht;else{for(;_t.firstChild;)_t.removeChild(_t.firstChild);_t.appendChild(document.createTextNode(ht))}}}},j={};function d(at){var ht=j[at];if(ht!==void 0)return ht.exports;var _t=j[at]={id:at,exports:{}};return g[at](_t,_t.exports,d),_t.exports}d.n=function(at){var ht=at&&at.__esModule?function(){return at.default}:function(){return at};return d.d(ht,{a:ht}),ht},d.d=function(at,ht){for(var _t in ht)d.o(ht,_t)&&!d.o(at,_t)&&Object.defineProperty(at,_t,{enumerable:!0,get:ht[_t]})},d.o=function(at,ht){return Object.prototype.hasOwnProperty.call(at,ht)},d.nc=void 0;var nt={};return function(){d.d(nt,{default:function(){return ur}});var at=d(379),ht=d.n(at),_t=d(795),bt=d.n(_t),kt=d(636),Vt=d.n(kt),qt=d(216),zt=d.n(qt),jt=d(589),Kt=d.n(jt),Ft=d(820),nn={};Ft.Z&&Ft.Z.locals&&(nn.locals=Ft.Z.locals);var Lt,Nt=0,Ht={};Ht.styleTagTransform=Kt(),Ht.setAttributes=Vt(),Ht.insert=function(nr,hr){(hr.target||document.head).appendChild(nr)},Ht.domAPI=bt(),Ht.insertStyleElement=zt(),nn.use=function(nr){return Ht.options=nr||{},Nt++||(Lt=ht()(Ft.Z,Ht)),nn},nn.unuse=function(){Nt>0&&!--Nt&&(Lt(),Lt=null)};var on=nn;function en(nr,hr){return function(zn){if(Array.isArray(zn))return zn}(nr)||function(zn,Yn){var sn=zn==null?null:typeof Symbol<"u"&&zn[Symbol.iterator]||zn["@@iterator"];if(sn!=null){var qn,Kn,wr=[],Gn=!0,rn=!1;try{for(sn=sn.call(zn);!(Gn=(qn=sn.next()).done)&&(wr.push(qn.value),!Yn||wr.length!==Yn);Gn=!0);}catch(dn){rn=!0,Kn=dn}finally{try{Gn||sn.return==null||sn.return()}finally{if(rn)throw Kn}}return wr}}(nr,hr)||function(zn,Yn){if(zn){if(typeof zn=="string")return cn(zn,Yn);var sn=Object.prototype.toString.call(zn).slice(8,-1);return sn==="Object"&&zn.constructor&&(sn=zn.constructor.name),sn==="Map"||sn==="Set"?Array.from(zn):sn==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(sn)?cn(zn,Yn):void 0}}(nr,hr)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function cn(nr,hr){(hr==null||hr>nr.length)&&(hr=nr.length);for(var zn=0,Yn=new Array(hr);zn<hr;zn++)Yn[zn]=nr[zn];return Yn}function Ut(nr,hr){var zn=Object.keys(nr);if(Object.getOwnPropertySymbols){var Yn=Object.getOwnPropertySymbols(nr);hr&&(Yn=Yn.filter(function(sn){return Object.getOwnPropertyDescriptor(nr,sn).enumerable})),zn.push.apply(zn,Yn)}return zn}function Gt(nr){for(var hr=1;hr<arguments.length;hr++){var zn=arguments[hr]!=null?arguments[hr]:{};hr%2?Ut(Object(zn),!0).forEach(function(Yn){$t(nr,Yn,zn[Yn])}):Object.getOwnPropertyDescriptors?Object.defineProperties(nr,Object.getOwnPropertyDescriptors(zn)):Ut(Object(zn)).forEach(function(Yn){Object.defineProperty(nr,Yn,Object.getOwnPropertyDescriptor(zn,Yn))})}return nr}function $t(nr,hr,zn){return hr in nr?Object.defineProperty(nr,hr,{value:zn,enumerable:!0,configurable:!0,writable:!0}):nr[hr]=zn,nr}function un(nr,hr){for(var zn=0;zn<hr.length;zn++){var Yn=hr[zn];Yn.enumerable=Yn.enumerable||!1,Yn.configurable=!0,"value"in Yn&&(Yn.writable=!0),Object.defineProperty(nr,Yn.key,Yn)}}function hn(nr){var hr={};return nr.reduce(function(zn,Yn){return hr[Yn]||(hr[Yn]=!0,zn.push(Yn)),zn},[])}function Bn(nr,hr){requestAnimationFrame(function(){hr.enter(),requestAnimationFrame(function(){hr.active(),setTimeout(function(){hr.leave()},nr)})})}function ar(nr,hr){try{var zn=nr.liElementsById[hr.parent.id];zn.classList.contains("treejs-node__close")||zn.getElementsByClassName("treejs-switcher")[0].click()}catch{return}Object.prototype.hasOwnProperty.call(hr,"parent")&&ar(nr,hr.parent)}function sr(nr,hr){var zn=nr.liElementsById[hr.id];zn.classList.contains("treejs-node__close")&&zn.getElementsByClassName("treejs-switcher")[0].click(),Object.prototype.hasOwnProperty.call(hr,"children")&&hr.children.forEach(function(Yn){return sr(nr,Yn)})}var ur=function(){function nr(sn,qn){(function(Kn,wr){if(!(Kn instanceof wr))throw new TypeError("Cannot call a class as a function")})(this,nr),on.use({target:typeof this.container=="string"?document.querySelector(this.container):this.container}),this.treeNodes=[],this.nodesById={},this.leafNodesById={},this.liElementsById={},this.willUpdateNodesById={},this.container=sn,this.options=Object.assign({values:[],disables:[],loaded:null,closeDepth:null},qn),Object.defineProperties(this,{values:{get:function(){return this.getValues()},set:function(Kn){this.setValues(hn(Kn))}},disables:{get:function(){return this.getDisables()},set:function(Kn){this.setDisables(hn(Kn))}},selectedNodes:{get:function(){var Kn=[],wr=this.nodesById;return Object.keys(wr).forEach(function(Gn){if(Object.prototype.hasOwnProperty.call(wr,Gn)&&(wr[Gn].status===1||wr[Gn].status===2)){var rn=Gt({},wr[Gn]);delete rn.parent,delete rn.children,Kn.push(rn)}}),Kn}},disabledNodes:{get:function(){var Kn=[],wr=this.nodesById;return Object.keys(wr).forEach(function(Gn){if(Object.prototype.hasOwnProperty.call(wr,Gn)&&wr[Gn].disabled){var rn=Gt({},wr[Gn]);delete rn.parent,Kn.push(rn)}}),Kn}}}),this.init(this.options.data)}var hr,zn,Yn;return hr=nr,Yn=[{key:"onSwitcherClick",value:function(sn){var qn=sn.parentNode,Kn=qn.lastChild,wr=Kn.scrollHeight;qn.classList.contains("treejs-node__close")?Bn(150,{enter:function(){Kn.style.height=0,Kn.style.opacity=0},active:function(){Kn.style.height="".concat(wr,"px"),Kn.style.opacity=1},leave:function(){Kn.style.height="",Kn.style.opacity="",qn.classList.remove("treejs-node__close")}}):Bn(150,{enter:function(){Kn.style.height="".concat(wr,"px"),Kn.style.opacity=1},active:function(){Kn.style.height=0,Kn.style.opacity=0},leave:function(){Kn.style.height="",Kn.style.opacity="",qn.classList.add("treejs-node__close")}})}},{key:"parseTreeData",value:function(sn){var qn,Kn=(qn=sn,JSON.parse(JSON.stringify(qn))),wr={},Gn={},rn=[],dn=[];return function kn(Cr,Ar){Cr.forEach(function(Lr){wr[Lr.id]=Lr,Lr.checked&&rn.push(Lr.id),Lr.disabled&&dn.push(Lr.id),Ar&&(Lr.parent=Ar),Lr.children&&Lr.children.length?kn(Lr.children,Lr):Gn[Lr.id]=Lr})}(Kn),{treeNodes:Kn,nodesById:wr,leafNodesById:Gn,defaultValues:rn,defaultDisables:dn}}},{key:"createRootEle",value:function(){var sn=document.createElement("div");return sn.classList.add("treejs"),sn}},{key:"createUlEle",value:function(){var sn=document.createElement("ul");return sn.classList.add("treejs-nodes"),sn}},{key:"createLiEle",value:function(sn,qn){var Kn=document.createElement("li");if(Kn.classList.add("treejs-node"),qn&&Kn.classList.add("treejs-node__close"),sn.children&&sn.children.length){var wr=document.createElement("span");wr.classList.add("treejs-switcher"),Kn.appendChild(wr)}else Kn.classList.add("treejs-placeholder");var Gn=document.createElement("span");Gn.classList.add("treejs-checkbox"),Kn.appendChild(Gn);var rn=document.createElement("span");rn.classList.add("treejs-label");var dn=document.createTextNode(sn.text);return rn.appendChild(dn),Kn.appendChild(rn),Kn.nodeId=sn.id,Kn}}],(zn=[{key:"init",value:function(sn){var qn=nr.parseTreeData(sn),Kn=qn.treeNodes,wr=qn.nodesById,Gn=qn.leafNodesById,rn=qn.defaultValues,dn=qn.defaultDisables;this.treeNodes=Kn,this.nodesById=wr,this.leafNodesById=Gn,this.render(this.treeNodes);var kn=this.options,Cr=kn.values,Ar=kn.disables,Lr=kn.loaded;Cr&&Cr.length?this.setValues(Cr):rn&&rn.length&&this.setValues(rn),Ar&&Ar.length?this.setDisables(Ar):dn&&dn.length&&this.setDisables(dn),typeof Lr=="function"&&Lr.call(this)}},{key:"render",value:function(sn){var qn=nr.createRootEle();qn.appendChild(this.buildTree(sn,0)),this.bindEvent(qn);var Kn=typeof this.container=="string"?document.querySelector(this.container):this.container;(function(wr){for(;wr.firstChild;)wr.removeChild(wr.firstChild)})(Kn),Kn.appendChild(qn)}},{key:"buildTree",value:function(sn,qn){var Kn=this,wr=nr.createUlEle();return sn&&sn.length&&sn.forEach(function(Gn){var rn=nr.createLiEle(Gn,qn===Kn.options.closeDepth-1);Kn.liElementsById[Gn.id]=rn;var dn=null;Gn.children&&Gn.children.length&&(dn=Kn.buildTree(Gn.children,qn+1)),dn&&rn.appendChild(dn),wr.appendChild(rn)}),wr}},{key:"bindEvent",value:function(sn){var qn=this;sn.addEventListener("click",function(Kn){var wr=Kn.target;wr.nodeName==="SPAN"&&wr.classList.contains("treejs-checkbox")?qn.onItemClick(wr.parentNode.nodeId):wr.nodeName==="SPAN"&&wr.classList.contains("treejs-label")?qn.onItemLabelClick(wr.parentNode.nodeId):wr.nodeName==="LI"&&wr.classList.contains("treejs-node")?qn.onItemClick(wr.nodeId):wr.nodeName==="SPAN"&&wr.classList.contains("treejs-switcher")&&nr.onSwitcherClick(wr)},!1)}},{key:"onItemClick",value:function(sn){var qn=this.nodesById[sn],Kn=this.options.onChange;qn.disabled||(this.setValue(sn),this.updateLiElements()),Kn&&Kn.call(this)}},{key:"onItemLabelClick",value:function(sn){var qn=this.options.onItemLabelClick;qn&&qn.call(this,sn)}},{key:"setValue",value:function(sn){var qn=this.nodesById[sn];if(qn){var Kn=qn.status,wr=Kn===1||Kn===2?0:2;qn.status=wr,this.markWillUpdateNode(qn),this.walkUp(qn,"status"),this.walkDown(qn,"status")}}},{key:"getValues",value:function(){var sn=this,qn=[];return Object.keys(this.leafNodesById).forEach(function(Kn){Object.prototype.hasOwnProperty.call(sn.leafNodesById,Kn)&&(sn.leafNodesById[Kn].status!==1&&sn.leafNodesById[Kn].status!==2||qn.push(Kn))}),qn}},{key:"setValues",value:function(sn){var qn=this;this.emptyNodesCheckStatus(),sn.forEach(function(wr){qn.setValue(wr)}),this.updateLiElements();var Kn=this.options.onChange;Kn&&Kn.call(this)}},{key:"setDisable",value:function(sn){var qn=this.nodesById[sn];qn&&(qn.disabled||(qn.disabled=!0,this.markWillUpdateNode(qn),this.walkUp(qn,"disabled"),this.walkDown(qn,"disabled")))}},{key:"getDisables",value:function(){var sn=this,qn=[];return Object.keys(this.leafNodesById).forEach(function(Kn){Object.prototype.hasOwnProperty.call(sn.leafNodesById,Kn)&&sn.leafNodesById[Kn].disabled&&qn.push(Kn)}),qn}},{key:"setDisables",value:function(sn){var qn=this;this.emptyNodesDisable(),sn.forEach(function(Kn){qn.setDisable(Kn)}),this.updateLiElements()}},{key:"emptyNodesCheckStatus",value:function(){this.willUpdateNodesById=this.getSelectedNodesById(),Object.values(this.willUpdateNodesById).forEach(function(sn){sn.disabled||(sn.status=0)})}},{key:"emptyNodesDisable",value:function(){this.willUpdateNodesById=this.getDisabledNodesById(),Object.values(this.willUpdateNodesById).forEach(function(sn){sn.disabled=!1})}},{key:"getSelectedNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(sn,qn){var Kn=en(qn,2),wr=Kn[0],Gn=Kn[1];return Gn.status!==1&&Gn.status!==2||(sn[wr]=Gn),sn},{})}},{key:"getDisabledNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(sn,qn){var Kn=en(qn,2),wr=Kn[0],Gn=Kn[1];return Gn.disabled&&(sn[wr]=Gn),sn},{})}},{key:"updateLiElements",value:function(){var sn=this;Object.values(this.willUpdateNodesById).forEach(function(qn){sn.updateLiElement(qn)}),this.willUpdateNodesById={}}},{key:"markWillUpdateNode",value:function(sn){this.willUpdateNodesById[sn.id]=sn}},{key:"walkUp",value:function(sn,qn){var Kn=sn.parent;if(Kn){if(qn==="status"){var wr,Gn=Kn.children.reduce(function(dn,kn){return Number.isNaN(kn.status)?dn:dn+kn.status},0);if(wr=Gn?Gn===2*Kn.children.length?2:1:0,Kn.status===wr)return;Kn.status=wr}else{var rn=Kn.children.reduce(function(dn,kn){return dn&&kn.disabled},!0);if(Kn.disabled===rn)return;Kn.disabled=rn}this.markWillUpdateNode(Kn),this.walkUp(Kn,qn)}}},{key:"walkDown",value:function(sn,qn){var Kn=this;sn.children&&sn.children.length&&sn.children.forEach(function(wr){qn==="status"&&wr.disabled||(wr[qn]=sn[qn],Kn.markWillUpdateNode(wr),Kn.walkDown(wr,qn))})}},{key:"updateLiElement",value:function(sn){var qn=this.liElementsById[sn.id].classList;switch(sn.status){case 0:qn.remove("treejs-node__halfchecked","treejs-node__checked");break;case 1:qn.remove("treejs-node__checked"),qn.add("treejs-node__halfchecked");break;case 2:qn.remove("treejs-node__halfchecked"),qn.add("treejs-node__checked")}switch(sn.disabled){case!0:qn.contains("treejs-node__disabled")||qn.add("treejs-node__disabled");break;case!1:qn.contains("treejs-node__disabled")&&qn.remove("treejs-node__disabled")}}},{key:"collapseAll",value:function(){var sn=this;Object.keys(this.leafNodesById).forEach(function(qn){var Kn=sn.leafNodesById[qn];ar(sn,Kn)})}},{key:"expandAll",value:function(){sr(this,this.treeNodes[0])}}])&&un(hr.prototype,zn),Yn&&un(hr,Yn),Object.defineProperty(hr,"prototype",{writable:!1}),nr}()}(),nt.default}()},819:function(b,g){(function(j){const d="tp";function nt(nn){return Lt=>Nt=>{if(!Lt&&Nt===void 0)return{succeeded:!1,value:void 0};if(Lt&&Nt===void 0)return{succeeded:!0,value:void 0};const Ht=nn(Nt);return Ht!==void 0?{succeeded:!0,value:Ht}:{succeeded:!1,value:void 0}}}function at(nn){return{custom:Lt=>nt(Lt)(nn),boolean:nt(Lt=>typeof Lt=="boolean"?Lt:void 0)(nn),number:nt(Lt=>typeof Lt=="number"?Lt:void 0)(nn),string:nt(Lt=>typeof Lt=="string"?Lt:void 0)(nn),function:nt(Lt=>typeof Lt=="function"?Lt:void 0)(nn),constant:Lt=>nt(Nt=>Nt===Lt?Lt:void 0)(nn),raw:nt(Lt=>Lt)(nn),object:Lt=>nt(Nt=>{if((Ht=Nt)!==null&&typeof Ht=="object")return function(on,en){return Object.keys(en).reduce((cn,Ut)=>{if(cn===void 0)return;const Gt=(0,en[Ut])(on[Ut]);return Gt.succeeded?Object.assign(Object.assign({},cn),{[Ut]:Gt.value}):void 0},{})}(Nt,Lt);var Ht})(nn),array:Lt=>nt(Nt=>{if(Array.isArray(Nt))return Ht=Lt,Nt.reduce((on,en)=>{if(on===void 0)return;const cn=Ht(en);return cn.succeeded&&cn.value!==void 0?[...on,cn.value]:void 0},[]);var Ht})(nn)}}const ht={optional:at(!0),required:at(!1)};function _t(nn,Lt,Nt,Ht){return new(Nt||(Nt=Promise))(function(on,en){function cn($t){try{Gt(Ht.next($t))}catch(un){en(un)}}function Ut($t){try{Gt(Ht.throw($t))}catch(un){en(un)}}function Gt($t){var un;$t.done?on($t.value):(un=$t.value,un instanceof Nt?un:new Nt(function(hn){hn(un)})).then(cn,Ut)}Gt((Ht=Ht.apply(nn,Lt||[])).next())})}function bt(nn){return _t(this,void 0,void 0,function*(){const Lt=new Image;return Lt.crossOrigin="anonymous",new Promise((Nt,Ht)=>{Lt.src=nn,Lt.onload=()=>{Nt(Lt)},Lt.onerror=Ht})})}const kt=(Vt="img",(nn,Lt)=>[d,"-",Vt,"v",nn?`_${nn}`:"",Lt?`-${Lt}`:""].join(""));var Vt;class qt{constructor(Lt,Nt){this.element=Lt.createElement("div"),this.element.classList.add(kt()),Nt.viewProps.bindClassModifiers(this.element),this.input=Lt.createElement("input"),this.input.classList.add(kt("input")),this.input.setAttribute("type","file"),this.input.setAttribute("accept",Nt.extensions.join(",")),this.image_=Lt.createElement("img"),this.image_.classList.add(kt("image")),this.image_.classList.add(kt(`image_${Nt.imageFit}`)),this.image_.crossOrigin="anonymous",this.image_.onclick=Ht=>{Nt.clickCallback?Nt.clickCallback(Ht,this.input):this.input.click()},this.element.classList.add(kt("area_root")),this.element.appendChild(this.image_),this.element.appendChild(this.input)}changeImage(Lt){this.image_.src=Lt}changeDraggingState(Lt){const Nt=this.element;Lt?Nt==null||Nt.classList.add(kt("area_dragging")):Nt==null||Nt.classList.remove(kt("area_dragging"))}}let zt=null;class jt{constructor(Lt,Nt){this.value=Nt.value,this.viewProps=Nt.viewProps,this.view=new qt(Lt,{viewProps:this.viewProps,extensions:Nt.extensions,imageFit:Nt.imageFit,clickCallback:Nt.clickCallback}),this.onFile=this.onFile.bind(this),this.onDrop=this.onDrop.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.view.input.addEventListener("change",this.onFile),this.view.element.addEventListener("drop",this.onDrop),this.view.element.addEventListener("dragover",this.onDragOver),this.view.element.addEventListener("dragleave",this.onDragLeave),this.viewProps.handleDispose(()=>{this.view.input.removeEventListener("change",this.onFile),this.view.input.removeEventListener("drop",this.onDrop),this.view.input.removeEventListener("dragover",this.onDragOver),this.view.input.removeEventListener("dragleave",this.onDragLeave)}),this.value.emitter.on("change",this.handleValueChange.bind(this)),this.handleValueChange()}onFile(Lt){const Nt=(Lt==null?void 0:Lt.target).files;if(!Nt||!Nt.length)return;const Ht=Nt[0];this.setValue(Ht)}onDrop(Lt){return _t(this,void 0,void 0,function*(){Lt.preventDefault();try{const{dataTransfer:Nt}=Lt,Ht=Nt==null?void 0:Nt.files[0];if(Ht)this.setValue(Ht);else{const on=Nt==null?void 0:Nt.getData("url");if(!on)throw new Error("No url");this.setValue(on)}}catch(Nt){console.error("Could not parse the dropped image",Nt)}finally{this.view.changeDraggingState(!1)}})}onDragOver(Lt){Lt.preventDefault(),this.view.changeDraggingState(!0)}onDragLeave(){this.view.changeDraggingState(!1)}handleImage(Lt){return _t(this,void 0,void 0,function*(){Lt instanceof HTMLImageElement?this.updateImage(Lt.src):typeof Lt!="string"&&Lt?yield this.setValue(Lt):(Lt!=="placeholder"&&Lt||(Lt=(yield this.handlePlaceholderImage()).src),this.updateImage(Lt))})}updateImage(Lt){this.view.changeImage(Lt)}setValue(Lt){return _t(this,void 0,void 0,function*(){if(Lt instanceof HTMLImageElement)this.value.setRawValue(Lt);else if(Lt instanceof File){const Nt=URL.createObjectURL(Lt)+"#"+Lt.name;Lt.src=Nt;const Ht=yield bt(Nt).catch(()=>{});this.value.setRawValue(Ht||Lt)}else Lt?this.value.setRawValue(yield bt(Lt)):this.value.setRawValue(yield this.handlePlaceholderImage())})}handleValueChange(){this.handleImage(this.value.rawValue)}handlePlaceholderImage(){return _t(this,void 0,void 0,function*(){return zt||(zt=yield function(){const Lt=document.createElement("canvas");Lt.width=320,Lt.height=50;const Nt=Lt.getContext("2d");return Nt.fillStyle="#00000004",Nt.fillRect(0,0,Lt.width,Lt.height),Nt.fillStyle="#eee",Nt.font='1.25rem "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace',Nt.textAlign="center",Nt.textBaseline="middle",Nt.fillText("No image",.5*Lt.width,.5*Lt.height),new Promise(Ht=>{Lt.toBlob(on=>{const en=new Image;en.src=URL.createObjectURL(on),en.isPlaceholder=!0,en.onload=()=>{Ht(en)}})})}()),zt})}}const Kt=[".jpg",".png",".gif"],Ft={id:"input-image",type:"input",css:".tp-imgv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-imgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-imgv:hover{background-color:var(--in-bg-h)}.tp-imgv:focus{background-color:var(--in-bg-f)}.tp-imgv:active{background-color:var(--in-bg-a)}.tp-imgv:disabled{opacity:0.5}:root{--tp-plugin-image-dragging-color: hsla(230, 100%, 66%, 1.00)}.tp-imgv{cursor:pointer;display:inline-flex;height:auto !important;max-height:calc(var(--bld-us) * 3);border-radius:4px;position:relative}.tp-imgv.tp-v-disabled{opacity:0.5}.tp-imgv_input{width:0;height:0;pointer-events:none;visibility:hidden}.tp-imgv_image{width:100%;height:-webkit-max-content;height:-moz-max-content;height:max-content;max-height:calc(var(--bld-us) * 3);border:0}.tp-imgv_image_contain{-o-object-fit:contain;object-fit:contain}.tp-imgv_image_cover{-o-object-fit:cover;object-fit:cover}.tp-imgv_area_root{transition:opacity 0.16s ease-in-out}.tp-imgv_area_dragging{border:2px dashed var(--tp-plugin-image-dragging-color);border-radius:4px;opacity:0.6}",accept(nn,Lt){if(!(nn instanceof HTMLImageElement||typeof nn=="string"))return null;const Nt=ht,Ht=function(on,en){const cn=ht.required.object(en)(on);return cn.succeeded?cn.value:void 0}(Lt,{view:Nt.required.constant("input-image"),acceptUrl:Nt.optional.boolean,clickCallback:Nt.optional.function,imageFit:Nt.optional.custom(on=>on==="contain"||on==="cover"?on:void 0),extensions:Nt.optional.array(Nt.required.string)});return Ht?{initialValue:nn,params:Ht}:null},binding:{reader:nn=>Lt=>Lt.src!==void 0?Lt.src===""?"placeholder":Lt.src:Lt,writer:nn=>(Lt,Nt)=>{Lt.write(Nt)}},controller(nn){var Lt,Nt;return new jt(nn.document,{value:nn.value,imageFit:(Lt=nn.params.imageFit)!==null&&Lt!==void 0?Lt:"cover",clickCallback:nn.params.clickCallback,viewProps:nn.viewProps,extensions:(Nt=nn.params.extensions)!==null&&Nt!==void 0?Nt:Kt})}};j.plugin=Ft,Object.defineProperty(j,"__esModule",{value:!0})})(g)},665:function(b,g){(function(j){class d{constructor(st){this.controller_=st}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(st){this.controller_.viewProps.set("disabled",st)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(st){this.controller_.viewProps.set("hidden",st)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class nt{constructor(st){this.target=st}}class at extends nt{constructor(st,dt,It,Zt){super(st),this.value=dt,this.presetKey=It,this.last=Zt==null||Zt}}class ht extends nt{constructor(st,dt,It){super(st),this.value=dt,this.presetKey=It}}class _t extends nt{constructor(st,dt){super(st),this.expanded=dt}}function bt(wt){return wt==null}function kt(wt,st){if(wt.length!==st.length)return!1;for(let dt=0;dt<wt.length;dt++)if(wt[dt]!==st[dt])return!1;return!0}const Vt={alreadydisposed:()=>"View has been already disposed",invalidparams:wt=>`Invalid parameters for '${wt.name}'`,nomatchingcontroller:wt=>`No matching controller for '${wt.key}'`,nomatchingview:wt=>`No matching view for '${JSON.stringify(wt.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:wt=>`Property '${wt.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class qt{constructor(st){var dt;this.message=(dt=Vt[st.type](st.context))!==null&&dt!==void 0?dt:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=st.type}static alreadyDisposed(){return new qt({type:"alreadydisposed"})}static notBindable(){return new qt({type:"notbindable"})}static propertyNotFound(st){return new qt({type:"propertynotfound",context:{name:st}})}static shouldNeverHappen(){return new qt({type:"shouldneverhappen"})}}class zt{constructor(st,dt,It){this.obj_=st,this.key_=dt,this.presetKey_=It??dt}static isBindable(st){return st!==null&&typeof st=="object"}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(st){this.obj_[this.key_]=st}writeProperty(st,dt){const It=this.read();if(!zt.isBindable(It))throw qt.notBindable();if(!(st in It))throw qt.propertyNotFound(st);It[st]=dt}}class jt extends d{get label(){return this.controller_.props.get("label")}set label(st){this.controller_.props.set("label",st)}get title(){var st;return(st=this.controller_.valueController.props.get("title"))!==null&&st!==void 0?st:""}set title(st){this.controller_.valueController.props.set("title",st)}on(st,dt){const It=dt.bind(this);return this.controller_.valueController.emitter.on(st,()=>{It(new nt(this))}),this}}class Kt{constructor(){this.observers_={}}on(st,dt){let It=this.observers_[st];return It||(It=this.observers_[st]=[]),It.push({handler:dt}),this}off(st,dt){const It=this.observers_[st];return It&&(this.observers_[st]=It.filter(Zt=>Zt.handler!==dt)),this}emit(st,dt){const It=this.observers_[st];It&&It.forEach(Zt=>{Zt.handler(dt)})}}const Ft="tp";function nn(wt){return(st,dt)=>[Ft,"-",wt,"v",st?`_${st}`:"",dt?`-${dt}`:""].join("")}function Lt(wt){return wt.rawValue}function Nt(wt,st){var dt,It;wt.emitter.on("change",(dt=Lt,It=st,Zt=>It(dt(Zt)))),st(wt.rawValue)}function Ht(wt,st,dt){Nt(wt.value(st),dt)}function on(wt,st){return dt=>{(function(It,Zt,bn){bn?It.classList.add(Zt):It.classList.remove(Zt)})(wt,st,dt)}}function en(wt,st){Nt(wt,dt=>{st.textContent=dt??""})}const cn=nn("btn");class Ut{constructor(st,dt){this.element=st.createElement("div"),this.element.classList.add(cn()),dt.viewProps.bindClassModifiers(this.element);const It=st.createElement("button");It.classList.add(cn("b")),dt.viewProps.bindDisabled(It),this.element.appendChild(It),this.buttonElement=It;const Zt=st.createElement("div");Zt.classList.add(cn("t")),en(dt.props.value("title"),Zt),this.buttonElement.appendChild(Zt)}}class Gt{constructor(st,dt){this.emitter=new Kt,this.onClick_=this.onClick_.bind(this),this.props=dt.props,this.viewProps=dt.viewProps,this.view=new Ut(st,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class $t{constructor(st,dt){var It;this.constraint_=dt==null?void 0:dt.constraint,this.equals_=(It=dt==null?void 0:dt.equals)!==null&&It!==void 0?It:(Zt,bn)=>Zt===bn,this.emitter=new Kt,this.rawValue_=st}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(st){this.setRawValue(st,{forceEmit:!1,last:!0})}setRawValue(st,dt){const It=dt??{forceEmit:!1,last:!0},Zt=this.constraint_?this.constraint_.constrain(st):st;(!this.equals_(this.rawValue_,Zt)||It.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=Zt,this.emitter.emit("change",{options:It,rawValue:Zt,sender:this}))}}class un{constructor(st){this.emitter=new Kt,this.value_=st}get rawValue(){return this.value_}set rawValue(st){this.setRawValue(st,{forceEmit:!1,last:!0})}setRawValue(st,dt){const It=dt??{forceEmit:!1,last:!0};(this.value_!==st||It.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=st,this.emitter.emit("change",{options:It,rawValue:this.value_,sender:this}))}}function hn(wt,st){const dt=st==null?void 0:st.constraint,It=st==null?void 0:st.equals;return dt||It?new $t(wt,st):new un(wt)}class Bn{constructor(st){this.emitter=new Kt,this.valMap_=st;for(const dt in this.valMap_)this.valMap_[dt].emitter.on("change",()=>{this.emitter.emit("change",{key:dt,sender:this})})}static createCore(st){return Object.keys(st).reduce((dt,It)=>Object.assign(dt,{[It]:hn(st[It])}),{})}static fromObject(st){const dt=this.createCore(st);return new Bn(dt)}get(st){return this.valMap_[st].rawValue}set(st,dt){this.valMap_[st].rawValue=dt}value(st){return this.valMap_[st]}}function ar(wt){return st=>dt=>{if(!st&&dt===void 0)return{succeeded:!1,value:void 0};if(st&&dt===void 0)return{succeeded:!0,value:void 0};const It=wt(dt);return It!==void 0?{succeeded:!0,value:It}:{succeeded:!1,value:void 0}}}function sr(wt){return{custom:st=>ar(st)(wt),boolean:ar(st=>typeof st=="boolean"?st:void 0)(wt),number:ar(st=>typeof st=="number"?st:void 0)(wt),string:ar(st=>typeof st=="string"?st:void 0)(wt),function:ar(st=>typeof st=="function"?st:void 0)(wt),constant:st=>ar(dt=>dt===st?st:void 0)(wt),raw:ar(st=>st)(wt),object:st=>ar(dt=>{if((It=dt)!==null&&typeof It=="object")return function(Zt,bn){return Object.keys(bn).reduce((Rn,dr)=>{if(Rn===void 0)return;const Dr=(0,bn[dr])(Zt[dr]);return Dr.succeeded?Object.assign(Object.assign({},Rn),{[dr]:Dr.value}):void 0},{})}(dt,st);var It})(wt),array:st=>ar(dt=>{if(Array.isArray(dt))return It=st,dt.reduce((Zt,bn)=>{if(Zt===void 0)return;const Rn=It(bn);return Rn.succeeded&&Rn.value!==void 0?[...Zt,Rn.value]:void 0},[]);var It})(wt)}}const ur={optional:sr(!0),required:sr(!1)};function nr(wt,st){const dt=ur.required.object(st)(wt);return dt.succeeded?dt.value:void 0}const hr=nn(""),zn={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class Yn{constructor(st){this.parent_=null,this.blade=st.blade,this.view=st.view,this.viewProps=st.viewProps;const dt=this.view.element;this.blade.value("positions").emitter.on("change",()=>{["veryfirst","first","last","verylast"].forEach(It=>{dt.classList.remove(hr(void 0,zn[It]))}),this.blade.get("positions").forEach(It=>{dt.classList.add(hr(void 0,zn[It]))})}),this.viewProps.handleDispose(()=>{(function(It){It&&It.parentElement&&It.parentElement.removeChild(It)})(dt)})}get parent(){return this.parent_}}const sn="http://www.w3.org/2000/svg";function qn(wt){wt.offsetHeight}function Kn(wt){return wt.ontouchstart!==void 0}function wr(){return new Function("return this")().document}const Gn={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function rn(wt,st){const dt=wt.createElementNS(sn,"svg");return dt.innerHTML=Gn[st],dt}function dn(wt,st,dt){wt.insertBefore(st,wt.children[dt])}function kn(wt){wt.parentElement&&wt.parentElement.removeChild(wt)}function Cr(wt){for(;wt.children.length>0;)wt.removeChild(wt.children[0])}function Ar(wt){return wt.relatedTarget?wt.relatedTarget:"explicitOriginalTarget"in wt?wt.explicitOriginalTarget:null}const Lr=nn("lbl");class ls{constructor(st,dt){this.element=st.createElement("div"),this.element.classList.add(Lr()),dt.viewProps.bindClassModifiers(this.element);const It=st.createElement("div");It.classList.add(Lr("l")),Ht(dt.props,"label",bn=>{bt(bn)?this.element.classList.add(Lr(void 0,"nol")):(this.element.classList.remove(Lr(void 0,"nol")),function(Rn){for(;Rn.childNodes.length>0;)Rn.removeChild(Rn.childNodes[0])}(It),It.appendChild(function(Rn,dr){const Dr=Rn.createDocumentFragment();return dr.split(`
`).map(ys=>Rn.createTextNode(ys)).forEach((ys,Ts)=>{Ts>0&&Dr.appendChild(Rn.createElement("br")),Dr.appendChild(ys)}),Dr}(st,bn)))}),this.element.appendChild(It),this.labelElement=It;const Zt=st.createElement("div");Zt.classList.add(Lr("v")),this.element.appendChild(Zt),this.valueElement=Zt}}class Rs extends Yn{constructor(st,dt){const It=dt.valueController.viewProps;super(Object.assign(Object.assign({},dt),{view:new ls(st,{props:dt.props,viewProps:It}),viewProps:It})),this.props=dt.props,this.valueController=dt.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const us={id:"button",type:"blade",accept(wt){const st=ur,dt=nr(wt,{title:st.required.string,view:st.required.constant("button"),label:st.optional.string});return dt?{params:dt}:null},controller:wt=>new Rs(wt.document,{blade:wt.blade,props:Bn.fromObject({label:wt.params.label}),valueController:new Gt(wt.document,{props:Bn.fromObject({title:wt.params.title}),viewProps:wt.viewProps})}),api:wt=>wt.controller instanceof Rs&&wt.controller.valueController instanceof Gt?new jt(wt.controller):null};class ws extends Yn{constructor(st){super(st),this.value=st.value}}function io(){return new Bn({positions:hn([],{equals:kt})})}class ks extends Bn{constructor(st){super(st)}static create(st){const dt={completed:!0,expanded:st,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},It=Bn.createCore(dt);return new ks(It)}get styleExpanded(){var st;return(st=this.get("temporaryExpanded"))!==null&&st!==void 0?st:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const st=this.get("expandedHeight");return this.get("shouldFixHeight")&&!bt(st)?`${st}px`:"auto"}bindExpandedClass(st,dt){const It=()=>{this.styleExpanded?st.classList.add(dt):st.classList.remove(dt)};Ht(this,"expanded",It),Ht(this,"temporaryExpanded",It)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function er(wt,st){st.style.height=wt.styleHeight}function Vs(wt,st){wt.value("expanded").emitter.on("beforechange",()=>{wt.set("completed",!1),bt(wt.get("expandedHeight"))&&wt.set("expandedHeight",function(dt,It){let Zt=0;return function(bn,Rn){const dr=bn.style.transition;bn.style.transition="none",Rn(),bn.style.transition=dr}(It,()=>{dt.set("expandedHeight",null),dt.set("temporaryExpanded",!0),qn(It),Zt=It.clientHeight,dt.set("temporaryExpanded",null),qn(It)}),Zt}(wt,st)),wt.set("shouldFixHeight",!0),qn(st)}),wt.emitter.on("change",()=>{er(wt,st)}),er(wt,st),st.addEventListener("transitionend",dt=>{dt.propertyName==="height"&&wt.cleanUpTransition()})}class Ll extends d{constructor(st,dt){super(st),this.rackApi_=dt}}class Nl{constructor(st){this.emitter=new Kt,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=st}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(st){for(const dt of this.allItems())if(st(dt))return dt;return null}includes(st){return this.cache_.has(st)}add(st,dt){if(this.includes(st))throw qt.shouldNeverHappen();const It=dt!==void 0?dt:this.items_.length;this.items_.splice(It,0,st),this.cache_.add(st);const Zt=this.extract_(st);Zt&&(Zt.emitter.on("add",this.onSubListAdd_),Zt.emitter.on("remove",this.onSubListRemove_),Zt.allItems().forEach(bn=>{this.cache_.add(bn)})),this.emitter.emit("add",{index:It,item:st,root:this,target:this})}remove(st){const dt=this.items_.indexOf(st);if(dt<0)return;this.items_.splice(dt,1),this.cache_.delete(st);const It=this.extract_(st);It&&(It.emitter.off("add",this.onSubListAdd_),It.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:dt,item:st,root:this,target:this})}onSubListAdd_(st){this.cache_.add(st.item),this.emitter.emit("add",{index:st.index,item:st.item,root:this,target:st.target})}onSubListRemove_(st){this.cache_.delete(st.item),this.emitter.emit("remove",{index:st.index,item:st.item,root:this,target:st.target})}}class Qs extends d{constructor(st){super(st),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new Kt,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(st){this.controller_.props.set("label",st)}on(st,dt){const It=dt.bind(this);return this.emitter_.on(st,Zt=>{It(Zt.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(st){const dt=st.sender.target.read();this.emitter_.emit("change",{event:new at(this,dt,this.controller_.binding.target.presetKey,st.options.last)})}}class So extends Rs{constructor(st,dt){super(st,dt),this.binding=dt.binding}}class _l extends d{constructor(st){super(st),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new Kt,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(st){this.controller_.props.set("label",st)}on(st,dt){const It=dt.bind(this);return this.emitter_.on(st,Zt=>{It(Zt.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(st){const dt=st.sender.target.read();this.emitter_.emit("update",{event:new ht(this,dt,this.controller_.binding.target.presetKey)})}}class Mo extends Rs{constructor(st,dt){super(st,dt),this.binding=dt.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function Bo(wt){return wt instanceof Wl?wt.apiSet_:wt instanceof Ll?wt.rackApi_.apiSet_:null}function _o(wt,st){const dt=wt.find(It=>It.controller_===st);if(!dt)throw qt.shouldNeverHappen();return dt}function fo(wt,st,dt){if(!zt.isBindable(wt))throw qt.notBindable();return new zt(wt,st,dt)}class Wl extends d{constructor(st,dt){super(st),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new Kt,this.apiSet_=new Nl(Bo),this.pool_=dt;const It=this.controller_.rack;It.emitter.on("add",this.onRackAdd_),It.emitter.on("remove",this.onRackRemove_),It.emitter.on("inputchange",this.onRackInputChange_),It.emitter.on("monitorupdate",this.onRackMonitorUpdate_),It.children.forEach(Zt=>{this.setUpApi_(Zt)})}get children(){return this.controller_.rack.children.map(st=>_o(this.apiSet_,st))}addInput(st,dt,It){const Zt=It||{},bn=this.controller_.view.element.ownerDocument,Rn=this.pool_.createInput(bn,fo(st,dt,Zt.presetKey),Zt),dr=new Qs(Rn);return this.add(dr,Zt.index)}addMonitor(st,dt,It){const Zt=It||{},bn=this.controller_.view.element.ownerDocument,Rn=this.pool_.createMonitor(bn,fo(st,dt),Zt),dr=new _l(Rn);return this.add(dr,Zt.index)}addFolder(st){return function(dt,It){return dt.addBlade(Object.assign(Object.assign({},It),{view:"folder"}))}(this,st)}addButton(st){return function(dt,It){return dt.addBlade(Object.assign(Object.assign({},It),{view:"button"}))}(this,st)}addSeparator(st){return function(dt,It){const Zt=It||{};return dt.addBlade(Object.assign(Object.assign({},Zt),{view:"separator"}))}(this,st)}addTab(st){return function(dt,It){return dt.addBlade(Object.assign(Object.assign({},It),{view:"tab"}))}(this,st)}add(st,dt){this.controller_.rack.add(st.controller_,dt);const It=this.apiSet_.find(Zt=>Zt.controller_===st.controller_);return It&&this.apiSet_.remove(It),this.apiSet_.add(st),st}remove(st){this.controller_.rack.remove(st.controller_)}addBlade(st){const dt=this.controller_.view.element.ownerDocument,It=this.pool_.createBlade(dt,st),Zt=this.pool_.createBladeApi(It);return this.add(Zt,st.index)}on(st,dt){const It=dt.bind(this);return this.emitter_.on(st,Zt=>{It(Zt.event)}),this}setUpApi_(st){this.apiSet_.find(dt=>dt.controller_===st)||this.apiSet_.add(this.pool_.createBladeApi(st))}onRackAdd_(st){this.setUpApi_(st.bladeController)}onRackRemove_(st){if(st.isRoot){const dt=_o(this.apiSet_,st.bladeController);this.apiSet_.remove(dt)}}onRackInputChange_(st){const dt=st.bladeController;if(dt instanceof So){const It=_o(this.apiSet_,dt),Zt=dt.binding;this.emitter_.emit("change",{event:new at(It,Zt.target.read(),Zt.target.presetKey,st.options.last)})}else if(dt instanceof ws){const It=_o(this.apiSet_,dt);this.emitter_.emit("change",{event:new at(It,dt.value.rawValue,void 0,st.options.last)})}}onRackMonitorUpdate_(st){if(!(st.bladeController instanceof Mo))throw qt.shouldNeverHappen();const dt=_o(this.apiSet_,st.bladeController),It=st.bladeController.binding;this.emitter_.emit("update",{event:new ht(dt,It.target.read(),It.target.presetKey)})}}class Oo extends Ll{constructor(st,dt){super(st,new Wl(st.rackController,dt)),this.emitter_=new Kt,this.controller_.foldable.value("expanded").emitter.on("change",It=>{this.emitter_.emit("fold",{event:new _t(this,It.sender.rawValue)})}),this.rackApi_.on("change",It=>{this.emitter_.emit("change",{event:It})}),this.rackApi_.on("update",It=>{this.emitter_.emit("update",{event:It})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(st){this.controller_.foldable.set("expanded",st)}get title(){return this.controller_.props.get("title")}set title(st){this.controller_.props.set("title",st)}get children(){return this.rackApi_.children}addInput(st,dt,It){return this.rackApi_.addInput(st,dt,It)}addMonitor(st,dt,It){return this.rackApi_.addMonitor(st,dt,It)}addFolder(st){return this.rackApi_.addFolder(st)}addButton(st){return this.rackApi_.addButton(st)}addSeparator(st){return this.rackApi_.addSeparator(st)}addTab(st){return this.rackApi_.addTab(st)}add(st,dt){return this.rackApi_.add(st,dt)}remove(st){this.rackApi_.remove(st)}addBlade(st){return this.rackApi_.addBlade(st)}on(st,dt){const It=dt.bind(this);return this.emitter_.on(st,Zt=>{It(Zt.event)}),this}}class yl extends Yn{constructor(st){super({blade:st.blade,view:st.view,viewProps:st.rackController.viewProps}),this.rackController=st.rackController}}class Dp{constructor(st,dt){const It=nn(dt.viewName);this.element=st.createElement("div"),this.element.classList.add(It()),dt.viewProps.bindClassModifiers(this.element)}}function co(wt){return wt instanceof Yu?wt.rack:wt instanceof yl?wt.rackController.rack:null}function gu(wt){const st=co(wt);return st?st.bcSet_:null}class zo{constructor(st){var dt;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new Kt,this.blade_=st??null,(dt=this.blade_)===null||dt===void 0||dt.value("positions").emitter.on("change",this.onBladePositionsChange_),this.bcSet_=new Nl(gu),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(st,dt){st.parent&&st.parent.remove(st),st.parent_=this,this.bcSet_.add(st,dt)}remove(st){st.parent_=null,this.bcSet_.remove(st)}find(st){return this.bcSet_.allItems().filter(dt=>dt instanceof st)}onSetAdd_(st){this.updatePositions_();const dt=st.target===st.root;if(this.emitter.emit("add",{bladeController:st.item,index:st.index,isRoot:dt,sender:this}),!dt)return;const It=st.item;if(It.viewProps.emitter.on("change",this.onChildViewPropsChange_),It.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),It.viewProps.handleDispose(this.onChildDispose_),It instanceof So)It.binding.emitter.on("change",this.onChildInputChange_);else if(It instanceof Mo)It.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(It instanceof ws)It.value.emitter.on("change",this.onChildValueChange_);else{const Zt=co(It);if(Zt){const bn=Zt.emitter;bn.on("layout",this.onDescendantLayout_),bn.on("inputchange",this.onDescendantInputChange_),bn.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(st){this.updatePositions_();const dt=st.target===st.root;if(this.emitter.emit("remove",{bladeController:st.item,isRoot:dt,sender:this}),!dt)return;const It=st.item;if(It instanceof So)It.binding.emitter.off("change",this.onChildInputChange_);else if(It instanceof Mo)It.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(It instanceof ws)It.value.emitter.off("change",this.onChildValueChange_);else{const Zt=co(It);if(Zt){const bn=Zt.emitter;bn.off("layout",this.onDescendantLayout_),bn.off("inputchange",this.onDescendantInputChange_),bn.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const st=this.bcSet_.items.filter(Zt=>!Zt.viewProps.get("hidden")),dt=st[0],It=st[st.length-1];this.bcSet_.items.forEach(Zt=>{const bn=[];Zt===dt&&(bn.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||bn.push("veryfirst")),Zt===It&&(bn.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||bn.push("verylast")),Zt.blade.set("positions",bn)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(st){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(st=>st.viewProps.get("disposed")).forEach(st=>{this.bcSet_.remove(st)})}onChildInputChange_(st){const dt=function(It,Zt){for(let bn=0;bn<It.length;bn++){const Rn=It[bn];if(Rn instanceof So&&Rn.binding===Zt)return Rn}return null}(this.find(So),st.sender);if(!dt)throw qt.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:dt,options:st.options,sender:this})}onChildMonitorUpdate_(st){const dt=function(It,Zt){for(let bn=0;bn<It.length;bn++){const Rn=It[bn];if(Rn instanceof Mo&&Rn.binding===Zt)return Rn}return null}(this.find(Mo),st.sender);if(!dt)throw qt.shouldNeverHappen();this.emitter.emit("monitorupdate",{bladeController:dt,sender:this})}onChildValueChange_(st){const dt=function(It,Zt){for(let bn=0;bn<It.length;bn++){const Rn=It[bn];if(Rn instanceof ws&&Rn.value===Zt)return Rn}return null}(this.find(ws),st.sender);if(!dt)throw qt.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:dt,options:st.options,sender:this})}onDescendantLayout_(st){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(st){this.emitter.emit("inputchange",{bladeController:st.bladeController,options:st.options,sender:this})}onDescendantMonitorUpdate_(st){this.emitter.emit("monitorupdate",{bladeController:st.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class Yu extends Yn{constructor(st,dt){super(Object.assign(Object.assign({},dt),{view:new Dp(st,{viewName:"brk",viewProps:dt.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const It=new zo(dt.root?void 0:dt.blade);It.emitter.on("add",this.onRackAdd_),It.emitter.on("remove",this.onRackRemove_),this.rack=It,this.viewProps.handleDispose(()=>{for(let Zt=this.rack.children.length-1;Zt>=0;Zt--)this.rack.children[Zt].viewProps.set("disposed",!0)})}onRackAdd_(st){st.isRoot&&dn(this.view.element,st.bladeController.view.element,st.index)}onRackRemove_(st){st.isRoot&&kn(st.bladeController.view.element)}}const Rp=nn("cnt");class oo{constructor(st,dt){this.className_=nn(dt.viewName||"fld"),this.element=st.createElement("div"),this.element.classList.add(this.className_(),Rp()),dt.viewProps.bindClassModifiers(this.element),this.foldable_=dt.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),Ht(this.foldable_,"completed",on(this.element,this.className_(void 0,"cpl")));const It=st.createElement("button");It.classList.add(this.className_("b")),Ht(dt.props,"title",dr=>{bt(dr)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),dt.viewProps.bindDisabled(It),this.element.appendChild(It),this.buttonElement=It;const Zt=st.createElement("div");Zt.classList.add(this.className_("t")),en(dt.props.value("title"),Zt),this.buttonElement.appendChild(Zt),this.titleElement=Zt;const bn=st.createElement("div");bn.classList.add(this.className_("m")),this.buttonElement.appendChild(bn);const Rn=dt.containerElement;Rn.classList.add(this.className_("c")),this.element.appendChild(Rn),this.containerElement=Rn}}class To extends yl{constructor(st,dt){var It;const Zt=ks.create((It=dt.expanded)===null||It===void 0||It),bn=new Yu(st,{blade:dt.blade,root:dt.root,viewProps:dt.viewProps});super(Object.assign(Object.assign({},dt),{rackController:bn,view:new oo(st,{containerElement:bn.view.element,foldable:Zt,props:dt.props,viewName:dt.root?"rot":void 0,viewProps:dt.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=dt.props,this.foldable=Zt,Vs(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const Gs={id:"folder",type:"blade",accept(wt){const st=ur,dt=nr(wt,{title:st.required.string,view:st.required.constant("folder"),expanded:st.optional.boolean});return dt?{params:dt}:null},controller:wt=>new To(wt.document,{blade:wt.blade,expanded:wt.params.expanded,props:Bn.fromObject({title:wt.params.title}),viewProps:wt.viewProps}),api:wt=>wt.controller instanceof To?new Oo(wt.controller,wt.pool):null};class Jl extends ws{constructor(st,dt){const It=dt.valueController.viewProps;super(Object.assign(Object.assign({},dt),{value:dt.valueController.value,view:new ls(st,{props:dt.props,viewProps:It}),viewProps:It})),this.props=dt.props,this.valueController=dt.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class Xu extends d{}const Pu=nn("spr");class xu{constructor(st,dt){this.element=st.createElement("div"),this.element.classList.add(Pu()),dt.viewProps.bindClassModifiers(this.element);const It=st.createElement("hr");It.classList.add(Pu("r")),this.element.appendChild(It)}}class jn extends Yn{constructor(st,dt){super(Object.assign(Object.assign({},dt),{view:new xu(st,{viewProps:dt.viewProps})}))}}const Pl={id:"separator",type:"blade",accept(wt){const st=nr(wt,{view:ur.required.constant("separator")});return st?{params:st}:null},controller:wt=>new jn(wt.document,{blade:wt.blade,viewProps:wt.viewProps}),api:wt=>wt.controller instanceof jn?new Xu(wt.controller):null},pu=nn("");function Ds(wt,st){return on(wt,pu(void 0,st))}class Wr extends Bn{constructor(st){super(st)}static create(st){var dt,It;const Zt=st??{},bn={disabled:(dt=Zt.disabled)!==null&&dt!==void 0&&dt,disposed:!1,hidden:(It=Zt.hidden)!==null&&It!==void 0&&It},Rn=Bn.createCore(bn);return new Wr(Rn)}bindClassModifiers(st){Ht(this,"disabled",Ds(st,"disabled")),Ht(this,"hidden",Ds(st,"hidden"))}bindDisabled(st){Ht(this,"disabled",dt=>{st.disabled=dt})}bindTabIndex(st){Ht(this,"disabled",dt=>{st.tabIndex=dt?-1:0})}handleDispose(st){this.value("disposed").emitter.on("change",dt=>{dt&&st()})}}const os=nn("tbi");class Al{constructor(st,dt){this.element=st.createElement("div"),this.element.classList.add(os()),dt.viewProps.bindClassModifiers(this.element),Ht(dt.props,"selected",bn=>{bn?this.element.classList.add(os(void 0,"sel")):this.element.classList.remove(os(void 0,"sel"))});const It=st.createElement("button");It.classList.add(os("b")),dt.viewProps.bindDisabled(It),this.element.appendChild(It),this.buttonElement=It;const Zt=st.createElement("div");Zt.classList.add(os("t")),en(dt.props.value("title"),Zt),this.buttonElement.appendChild(Zt),this.titleElement=Zt}}class ss{constructor(st,dt){this.emitter=new Kt,this.onClick_=this.onClick_.bind(this),this.props=dt.props,this.viewProps=dt.viewProps,this.view=new Al(st,{props:dt.props,viewProps:dt.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Ls{constructor(st,dt){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new ss(st,{props:dt.itemProps,viewProps:Wr.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new Yu(st,{blade:io(),viewProps:Wr.create()}),this.props=dt.props,Ht(this.props,"selected",It=>{this.itemController.props.set("selected",It),this.contentController.viewProps.set("hidden",!It)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class vs{constructor(st,dt){this.controller_=st,this.rackApi_=dt}get title(){var st;return(st=this.controller_.itemController.props.get("title"))!==null&&st!==void 0?st:""}set title(st){this.controller_.itemController.props.set("title",st)}get selected(){return this.controller_.props.get("selected")}set selected(st){this.controller_.props.set("selected",st)}get children(){return this.rackApi_.children}addButton(st){return this.rackApi_.addButton(st)}addFolder(st){return this.rackApi_.addFolder(st)}addSeparator(st){return this.rackApi_.addSeparator(st)}addTab(st){return this.rackApi_.addTab(st)}add(st,dt){this.rackApi_.add(st,dt)}remove(st){this.rackApi_.remove(st)}addInput(st,dt,It){return this.rackApi_.addInput(st,dt,It)}addMonitor(st,dt,It){return this.rackApi_.addMonitor(st,dt,It)}addBlade(st){return this.rackApi_.addBlade(st)}}class eo extends Ll{constructor(st,dt){super(st,new Wl(st.rackController,dt)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.emitter_=new Kt,this.pageApiMap_=new Map,this.rackApi_.on("change",It=>{this.emitter_.emit("change",{event:It})}),this.rackApi_.on("update",It=>{this.emitter_.emit("update",{event:It})}),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(It=>{this.setUpPageApi_(It)})}get pages(){return this.controller_.pageSet.items.map(st=>{const dt=this.pageApiMap_.get(st);if(!dt)throw qt.shouldNeverHappen();return dt})}addPage(st){const dt=this.controller_.view.element.ownerDocument,It=new Ls(dt,{itemProps:Bn.fromObject({selected:!1,title:st.title}),props:Bn.fromObject({selected:!1})});this.controller_.add(It,st.index);const Zt=this.pageApiMap_.get(It);if(!Zt)throw qt.shouldNeverHappen();return Zt}removePage(st){this.controller_.remove(st)}on(st,dt){const It=dt.bind(this);return this.emitter_.on(st,Zt=>{It(Zt.event)}),this}setUpPageApi_(st){const dt=this.rackApi_.apiSet_.find(Zt=>Zt.controller_===st.contentController);if(!dt)throw qt.shouldNeverHappen();const It=new vs(st,dt);this.pageApiMap_.set(st,It)}onPageAdd_(st){this.setUpPageApi_(st.item)}onPageRemove_(st){if(!this.pageApiMap_.get(st.item))throw qt.shouldNeverHappen();this.pageApiMap_.delete(st.item)}}const Vo=nn("tab");class to{constructor(st,dt){this.element=st.createElement("div"),this.element.classList.add(Vo(),Rp()),dt.viewProps.bindClassModifiers(this.element),Nt(dt.empty,on(this.element,Vo(void 0,"nop")));const It=st.createElement("div");It.classList.add(Vo("i")),this.element.appendChild(It),this.itemsElement=It;const Zt=dt.contentsElement;Zt.classList.add(Vo("c")),this.element.appendChild(Zt),this.contentsElement=Zt}}class xa extends yl{constructor(st,dt){const It=new Yu(st,{blade:dt.blade,viewProps:dt.viewProps}),Zt=hn(!0);super({blade:dt.blade,rackController:It,view:new to(st,{contentsElement:It.view.element,empty:Zt,viewProps:dt.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onPageSelectedChange_=this.onPageSelectedChange_.bind(this),this.pageSet_=new Nl(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.empty_=Zt,this.applyPages_()}get pageSet(){return this.pageSet_}add(st,dt){this.pageSet_.add(st,dt??this.pageSet_.items.length)}remove(st){this.pageSet_.remove(this.pageSet_.items[st])}applyPages_(){this.keepSelection_(),this.empty_.rawValue=this.pageSet_.items.length===0}onPageAdd_(st){const dt=st.item;dn(this.view.itemsElement,dt.itemController.view.element,st.index),this.rackController.rack.add(dt.contentController,st.index),dt.props.value("selected").emitter.on("change",this.onPageSelectedChange_),this.applyPages_()}onPageRemove_(st){const dt=st.item;kn(dt.itemController.view.element),this.rackController.rack.remove(dt.contentController),dt.props.value("selected").emitter.off("change",this.onPageSelectedChange_),this.applyPages_()}keepSelection_(){if(this.pageSet_.items.length===0)return;const st=this.pageSet_.items.findIndex(dt=>dt.props.get("selected"));st<0?this.pageSet_.items.forEach((dt,It)=>{dt.props.set("selected",It===0)}):this.pageSet_.items.forEach((dt,It)=>{dt.props.set("selected",It===st)})}onPageSelectedChange_(st){if(st.rawValue){const dt=this.pageSet_.items.findIndex(It=>It.props.value("selected")===st.sender);this.pageSet_.items.forEach((It,Zt)=>{It.props.set("selected",Zt===dt)})}else this.keepSelection_()}}const Ko={id:"tab",type:"blade",accept(wt){const st=ur,dt=nr(wt,{pages:st.required.array(st.required.object({title:st.required.string})),view:st.required.constant("tab")});return dt&&dt.pages.length!==0?{params:dt}:null},controller(wt){const st=new xa(wt.document,{blade:wt.blade,viewProps:wt.viewProps});return wt.params.pages.forEach(dt=>{const It=new Ls(wt.document,{itemProps:Bn.fromObject({selected:!1,title:dt.title}),props:Bn.fromObject({selected:!1})});st.add(It)}),st},api:wt=>wt.controller instanceof xa?new eo(wt.controller,wt.pool):null};class Zl{constructor(){this.disabled=!1,this.emitter=new Kt}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class xl{constructor(st,dt){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=st,this.emitter=new Kt,this.interval_=dt,this.setTimer_()}get disabled(){return this.disabled_}set disabled(st){this.disabled_=st,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const st=this.doc_.defaultView;st&&st.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const st=this.doc_.defaultView;st&&(this.timerId_=st.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class yo{constructor(st){this.constraints=st}constrain(st){return this.constraints.reduce((dt,It)=>It.constrain(dt),st)}}function Dl(wt,st){if(wt instanceof st)return wt;if(wt instanceof yo){const dt=wt.constraints.reduce((It,Zt)=>It||(Zt instanceof st?Zt:null),null);if(dt)return dt}return null}class Lo{constructor(st){this.options=st}constrain(st){const dt=this.options;return dt.length===0||dt.filter(It=>It.value===st).length>0?st:dt[0].value}}class Hs{constructor(st){this.maxValue=st.max,this.minValue=st.min}constrain(st){let dt=st;return bt(this.minValue)||(dt=Math.max(dt,this.minValue)),bt(this.maxValue)||(dt=Math.min(dt,this.maxValue)),dt}}class Yl{constructor(st){this.step=st}constrain(st){return(st<0?-Math.round(-st/this.step):Math.round(st/this.step))*this.step}}const Ho=nn("lst");class Fl{constructor(st,dt){this.onValueChange_=this.onValueChange_.bind(this),this.props_=dt.props,this.element=st.createElement("div"),this.element.classList.add(Ho()),dt.viewProps.bindClassModifiers(this.element);const It=st.createElement("select");It.classList.add(Ho("s")),Ht(this.props_,"options",bn=>{Cr(It),bn.forEach((Rn,dr)=>{const Dr=st.createElement("option");Dr.dataset.index=String(dr),Dr.textContent=Rn.text,Dr.value=String(Rn.value),It.appendChild(Dr)})}),dt.viewProps.bindDisabled(It),this.element.appendChild(It),this.selectElement=It;const Zt=st.createElement("div");Zt.classList.add(Ho("m")),Zt.appendChild(rn(st,"dropdown")),this.element.appendChild(Zt),dt.value.emitter.on("change",this.onValueChange_),this.value_=dt.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class Io{constructor(st,dt){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=dt.props,this.value=dt.value,this.viewProps=dt.viewProps,this.view=new Fl(st,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(st){const dt=st.currentTarget.selectedOptions.item(0);if(!dt)return;const It=Number(dt.dataset.index);this.value.rawValue=this.props.get("options")[It].value}}const Jr=nn("pop");class qp{constructor(st,dt){this.element=st.createElement("div"),this.element.classList.add(Jr()),dt.viewProps.bindClassModifiers(this.element),Nt(dt.shows,on(this.element,Jr(void 0,"v")))}}class Xr{constructor(st,dt){this.shows=hn(!1),this.viewProps=dt.viewProps,this.view=new qp(st,{shows:this.shows,viewProps:this.viewProps})}}const Qo=nn("txt");class vu{constructor(st,dt){this.onChange_=this.onChange_.bind(this),this.element=st.createElement("div"),this.element.classList.add(Qo()),dt.viewProps.bindClassModifiers(this.element),this.props_=dt.props,this.props_.emitter.on("change",this.onChange_);const It=st.createElement("input");It.classList.add(Qo("i")),It.type="text",dt.viewProps.bindDisabled(It),this.element.appendChild(It),this.inputElement=It,dt.value.emitter.on("change",this.onChange_),this.value_=dt.value,this.refresh()}refresh(){const st=this.props_.get("formatter");this.inputElement.value=st(this.value_.rawValue)}onChange_(){this.refresh()}}class Ao{constructor(st,dt){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=dt.parser,this.props=dt.props,this.value=dt.value,this.viewProps=dt.viewProps,this.view=new vu(st,{props:dt.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(st){const dt=st.currentTarget.value,It=this.parser_(dt);bt(It)||(this.value.rawValue=It),this.view.refresh()}}function so(wt){return wt!=="false"&&!!wt}function op(wt){return function(st){return String(st)}(wt)}class Ku{constructor(st){this.text=st}evaluate(){return Number(this.text)}toString(){return this.text}}const Ap={"**":(wt,st)=>Math.pow(wt,st),"*":(wt,st)=>wt*st,"/":(wt,st)=>wt/st,"%":(wt,st)=>wt%st,"+":(wt,st)=>wt+st,"-":(wt,st)=>wt-st,"<<":(wt,st)=>wt<<st,">>":(wt,st)=>wt>>st,">>>":(wt,st)=>wt>>>st,"&":(wt,st)=>wt&st,"^":(wt,st)=>wt^st,"|":(wt,st)=>wt|st};class Yp{constructor(st,dt,It){this.left=dt,this.operator=st,this.right=It}evaluate(){const st=Ap[this.operator];if(!st)throw new Error(`unexpected binary operator: '${this.operator}`);return st(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Ws={"+":wt=>wt,"-":wt=>-wt,"~":wt=>~wt};class fA{constructor(st,dt){this.operator=st,this.expression=dt}evaluate(){const st=Ws[this.operator];if(!st)throw new Error(`unexpected unary operator: '${this.operator}`);return st(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function w_(wt){return(st,dt)=>{for(let It=0;It<wt.length;It++){const Zt=wt[It](st,dt);if(Zt!=="")return Zt}return""}}function Vv(wt,st){var dt;const It=wt.substr(st).match(/^\s+/);return(dt=It&&It[0])!==null&&dt!==void 0?dt:""}function Qv(wt,st){var dt;const It=wt.substr(st).match(/^[0-9]+/);return(dt=It&&It[0])!==null&&dt!==void 0?dt:""}function Wo(wt,st){const dt=wt.substr(st,1);if(st+=1,dt.toLowerCase()!=="e")return"";const It=function(Zt,bn){const Rn=Qv(Zt,bn);if(Rn!=="")return Rn;const dr=Zt.substr(bn,1);if(dr!=="-"&&dr!=="+")return"";const Dr=Qv(Zt,bn+=1);return Dr===""?"":dr+Dr}(wt,st);return It===""?"":dt+It}function No(wt,st){const dt=wt.substr(st,1);if(dt==="0")return dt;const It=function(Zt,bn){const Rn=Zt.substr(bn,1);return Rn.match(/^[1-9]$/)?Rn:""}(wt,st);return st+=It.length,It===""?"":It+Qv(wt,st)}const hv=w_([function(wt,st){const dt=No(wt,st);if(st+=dt.length,dt==="")return"";const It=wt.substr(st,1);if(st+=It.length,It!==".")return"";const Zt=Qv(wt,st);return dt+It+Zt+Wo(wt,st+=Zt.length)},function(wt,st){const dt=wt.substr(st,1);if(st+=dt.length,dt!==".")return"";const It=Qv(wt,st);return st+=It.length,It===""?"":dt+It+Wo(wt,st)},function(wt,st){const dt=No(wt,st);return st+=dt.length,dt===""?"":dt+Wo(wt,st)}]),wp=w_([function(wt,st){const dt=wt.substr(st,2);if(st+=dt.length,dt.toLowerCase()!=="0b")return"";const It=function(Zt,bn){var Rn;const dr=Zt.substr(bn).match(/^[01]+/);return(Rn=dr&&dr[0])!==null&&Rn!==void 0?Rn:""}(wt,st);return It===""?"":dt+It},function(wt,st){const dt=wt.substr(st,2);if(st+=dt.length,dt.toLowerCase()!=="0o")return"";const It=function(Zt,bn){var Rn;const dr=Zt.substr(bn).match(/^[0-7]+/);return(Rn=dr&&dr[0])!==null&&Rn!==void 0?Rn:""}(wt,st);return It===""?"":dt+It},function(wt,st){const dt=wt.substr(st,2);if(st+=dt.length,dt.toLowerCase()!=="0x")return"";const It=function(Zt,bn){var Rn;const dr=Zt.substr(bn).match(/^[0-9a-f]+/i);return(Rn=dr&&dr[0])!==null&&Rn!==void 0?Rn:""}(wt,st);return It===""?"":dt+It}]),mA=w_([wp,hv]);function x_(wt,st){return function(dt,It){const Zt=mA(dt,It);return It+=Zt.length,Zt===""?null:{evaluable:new Ku(Zt),cursor:It}}(wt,st)||function(dt,It){const Zt=dt.substr(It,1);if(It+=Zt.length,Zt!=="(")return null;const bn=Du(dt,It);if(!bn)return null;It=bn.cursor,It+=Vv(dt,It).length;const Rn=dt.substr(It,1);return It+=Rn.length,Rn!==")"?null:{evaluable:bn.evaluable,cursor:It}}(wt,st)}function b_(wt,st,dt){dt+=Vv(st,dt).length;const It=wt.filter(Zt=>st.startsWith(Zt,dt))[0];return It?(dt+=It.length,{cursor:dt+=Vv(st,dt).length,operator:It}):null}const w0=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((wt,st)=>function(dt,It){return(Zt,bn)=>{const Rn=dt(Zt,bn);if(!Rn)return null;bn=Rn.cursor;let dr=Rn.evaluable;for(;;){const Dr=b_(It,Zt,bn);if(!Dr)break;bn=Dr.cursor;const ys=dt(Zt,bn);if(!ys)return null;bn=ys.cursor,dr=new Yp(Dr.operator,dr,ys.evaluable)}return dr?{cursor:bn,evaluable:dr}:null}}(wt,st),function wt(st,dt){const It=x_(st,dt);if(It)return It;const Zt=st.substr(dt,1);if(dt+=Zt.length,Zt!=="+"&&Zt!=="-"&&Zt!=="~")return null;const bn=wt(st,dt);return bn?{cursor:dt=bn.cursor,evaluable:new fA(Zt,bn.evaluable)}:null});function Du(wt,st){return st+=Vv(wt,st).length,w0(wt,st)}function _u(wt){var st;const dt=function(It){const Zt=Du(It,0);return Zt?Zt.cursor+Vv(It,Zt.cursor).length!==It.length?null:Zt.evaluable:null}(wt);return(st=dt==null?void 0:dt.evaluate())!==null&&st!==void 0?st:null}function Xp(wt){if(typeof wt=="number")return wt;if(typeof wt=="string"){const st=_u(wt);if(!bt(st))return st}return 0}function E_(wt){return String(wt)}function El(wt){return st=>st.toFixed(Math.max(Math.min(wt,20),0))}const gA=El(0);function Gv(wt){return gA(wt)+"%"}function v1(wt){return String(wt)}function S_(wt){return wt}function Am(wt,st){for(;wt.length<st;)wt.push(void 0)}function mo(wt){const st=[];return Am(st,wt),hn(st)}function Tw(wt){const st=wt.indexOf(void 0);return st<0?wt:wt.slice(0,st)}function C_({primary:wt,secondary:st,forward:dt,backward:It}){let Zt=!1;function bn(Rn){Zt||(Zt=!0,Rn(),Zt=!1)}wt.emitter.on("change",Rn=>{bn(()=>{st.setRawValue(dt(wt,st),Rn.options)})}),st.emitter.on("change",Rn=>{bn(()=>{wt.setRawValue(It(wt,st),Rn.options)}),bn(()=>{st.setRawValue(dt(wt,st),Rn.options)})}),bn(()=>{st.setRawValue(dt(wt,st),{forceEmit:!1,last:!0})})}function ap(wt,st){const dt=wt*(st.altKey?.1:1)*(st.shiftKey?10:1);return st.upKey?+dt:st.downKey?-dt:0}function x0(wt){return{altKey:wt.altKey,downKey:wt.key==="ArrowDown",shiftKey:wt.shiftKey,upKey:wt.key==="ArrowUp"}}function Ru(wt){return{altKey:wt.altKey,downKey:wt.key==="ArrowLeft",shiftKey:wt.shiftKey,upKey:wt.key==="ArrowRight"}}function ku(wt){return function(st){return st==="ArrowUp"||st==="ArrowDown"}(wt)||wt==="ArrowLeft"||wt==="ArrowRight"}function M_(wt,st){const dt=st.ownerDocument.defaultView,It=st.getBoundingClientRect();return{x:wt.pageX-((dt&&dt.scrollX||0)+It.left),y:wt.pageY-((dt&&dt.scrollY||0)+It.top)}}class Bu{constructor(st){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=st,this.emitter=new Kt,st.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),st.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),st.addEventListener("touchend",this.onTouchEnd_),st.addEventListener("mousedown",this.onMouseDown_)}computePosition_(st){const dt=this.elem_.getBoundingClientRect();return{bounds:{width:dt.width,height:dt.height},point:st?{x:st.x,y:st.y}:null}}onMouseDown_(st){var dt;st.preventDefault(),(dt=st.currentTarget)===null||dt===void 0||dt.focus();const It=this.elem_.ownerDocument;It.addEventListener("mousemove",this.onDocumentMouseMove_),It.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:st.altKey,data:this.computePosition_(M_(st,this.elem_)),sender:this,shiftKey:st.shiftKey})}onDocumentMouseMove_(st){this.emitter.emit("move",{altKey:st.altKey,data:this.computePosition_(M_(st,this.elem_)),sender:this,shiftKey:st.shiftKey})}onDocumentMouseUp_(st){const dt=this.elem_.ownerDocument;dt.removeEventListener("mousemove",this.onDocumentMouseMove_),dt.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:st.altKey,data:this.computePosition_(M_(st,this.elem_)),sender:this,shiftKey:st.shiftKey})}onTouchStart_(st){st.preventDefault();const dt=st.targetTouches.item(0),It=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:st.altKey,data:this.computePosition_(dt?{x:dt.clientX-It.left,y:dt.clientY-It.top}:void 0),sender:this,shiftKey:st.shiftKey}),this.lastTouch_=dt}onTouchMove_(st){const dt=st.targetTouches.item(0),It=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:st.altKey,data:this.computePosition_(dt?{x:dt.clientX-It.left,y:dt.clientY-It.top}:void 0),sender:this,shiftKey:st.shiftKey}),this.lastTouch_=dt}onTouchEnd_(st){var dt;const It=(dt=st.targetTouches.item(0))!==null&&dt!==void 0?dt:this.lastTouch_,Zt=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:st.altKey,data:this.computePosition_(It?{x:It.clientX-Zt.left,y:It.clientY-Zt.top}:void 0),sender:this,shiftKey:st.shiftKey})}}function wo(wt,st,dt,It,Zt){return It+(wt-st)/(dt-st)*(Zt-It)}function bu(wt){return String(wt.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Go(wt,st,dt){return Math.min(Math.max(wt,st),dt)}function vA(wt,st){return(wt%st+st)%st}const Kp=nn("txt");class Hv{constructor(st,dt){this.onChange_=this.onChange_.bind(this),this.props_=dt.props,this.props_.emitter.on("change",this.onChange_),this.element=st.createElement("div"),this.element.classList.add(Kp(),Kp(void 0,"num")),dt.arrayPosition&&this.element.classList.add(Kp(void 0,dt.arrayPosition)),dt.viewProps.bindClassModifiers(this.element);const It=st.createElement("input");It.classList.add(Kp("i")),It.type="text",dt.viewProps.bindDisabled(It),this.element.appendChild(It),this.inputElement=It,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=dt.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Kp()),this.inputElement.classList.add(Kp("i"));const Zt=st.createElement("div");Zt.classList.add(Kp("k")),this.element.appendChild(Zt),this.knobElement=Zt;const bn=st.createElementNS(sn,"svg");bn.classList.add(Kp("g")),this.knobElement.appendChild(bn);const Rn=st.createElementNS(sn,"path");Rn.classList.add(Kp("gb")),bn.appendChild(Rn),this.guideBodyElem_=Rn;const dr=st.createElementNS(sn,"path");dr.classList.add(Kp("gh")),bn.appendChild(dr),this.guideHeadElem_=dr;const Dr=st.createElement("div");Dr.classList.add(nn("tt")()),this.knobElement.appendChild(Dr),this.tooltipElem_=Dr,dt.value.emitter.on("change",this.onChange_),this.value=dt.value,this.refresh()}onDraggingChange_(st){if(st.rawValue===null)return void this.element.classList.remove(Kp(void 0,"drg"));this.element.classList.add(Kp(void 0,"drg"));const dt=st.rawValue/this.props_.get("draggingScale"),It=dt+(dt>0?-1:dt<0?1:0),Zt=Go(-It,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${It+Zt},0 L${It},4 L${It+Zt},8`,`M ${dt},-1 L${dt},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${dt},4`);const bn=this.props_.get("formatter");this.tooltipElem_.textContent=bn(this.value.rawValue),this.tooltipElem_.style.left=`${dt}px`}refresh(){const st=this.props_.get("formatter");this.inputElement.value=st(this.value.rawValue)}onChange_(){this.refresh()}}class T_{constructor(st,dt){this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=dt.baseStep,this.parser_=dt.parser,this.props=dt.props,this.value=dt.value,this.viewProps=dt.viewProps,this.dragging_=hn(null),this.view=new Hv(st,{arrayPosition:dt.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const It=new Bu(this.view.knobElement);It.emitter.on("down",this.onPointerDown_),It.emitter.on("move",this.onPointerMove_),It.emitter.on("up",this.onPointerUp_)}onInputChange_(st){const dt=st.currentTarget.value,It=this.parser_(dt);bt(It)||(this.value.rawValue=It),this.view.refresh()}onInputKeyDown_(st){const dt=ap(this.baseStep_,x0(st));dt!==0&&this.value.setRawValue(this.value.rawValue+dt,{forceEmit:!1,last:!1})}onInputKeyUp_(st){ap(this.baseStep_,x0(st))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(st){if(!st.point)return null;const dt=st.point.x-st.bounds.width/2;return this.originRawValue_+dt*this.props.get("draggingScale")}onPointerMove_(st){const dt=this.computeDraggingValue_(st.data);dt!==null&&(this.value.setRawValue(dt,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(st){const dt=this.computeDraggingValue_(st.data);dt!==null&&(this.value.setRawValue(dt,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const Ul=nn("sld");class Iw{constructor(st,dt){this.onChange_=this.onChange_.bind(this),this.props_=dt.props,this.props_.emitter.on("change",this.onChange_),this.element=st.createElement("div"),this.element.classList.add(Ul()),dt.viewProps.bindClassModifiers(this.element);const It=st.createElement("div");It.classList.add(Ul("t")),dt.viewProps.bindTabIndex(It),this.element.appendChild(It),this.trackElement=It;const Zt=st.createElement("div");Zt.classList.add(Ul("k")),this.trackElement.appendChild(Zt),this.knobElement=Zt,dt.value.emitter.on("change",this.onChange_),this.value=dt.value,this.update_()}update_(){const st=Go(wo(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${st}%`}onChange_(){this.update_()}}class Pw{constructor(st,dt){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=dt.baseStep,this.value=dt.value,this.viewProps=dt.viewProps,this.props=dt.props,this.view=new Iw(st,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Bu(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(st,dt){st.point&&this.value.setRawValue(wo(Go(st.point.x,0,st.bounds.width),0,st.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),dt)}onPointerDownOrMove_(st){this.handlePointerEvent_(st.data,{forceEmit:!1,last:!1})}onPointerUp_(st){this.handlePointerEvent_(st.data,{forceEmit:!0,last:!0})}onKeyDown_(st){const dt=ap(this.baseStep_,Ru(st));dt!==0&&this.value.setRawValue(this.value.rawValue+dt,{forceEmit:!1,last:!1})}onKeyUp_(st){ap(this.baseStep_,Ru(st))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const $u=nn("sldtxt");class Dw{constructor(st,dt){this.element=st.createElement("div"),this.element.classList.add($u());const It=st.createElement("div");It.classList.add($u("s")),this.sliderView_=dt.sliderView,It.appendChild(this.sliderView_.element),this.element.appendChild(It);const Zt=st.createElement("div");Zt.classList.add($u("t")),this.textView_=dt.textView,Zt.appendChild(this.textView_.element),this.element.appendChild(Zt)}}class $p{constructor(st,dt){this.value=dt.value,this.viewProps=dt.viewProps,this.sliderC_=new Pw(st,{baseStep:dt.baseStep,props:dt.sliderProps,value:dt.value,viewProps:this.viewProps}),this.textC_=new T_(st,{baseStep:dt.baseStep,parser:dt.parser,props:dt.textProps,value:dt.value,viewProps:dt.viewProps}),this.view=new Dw(st,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function Wv(wt,st){wt.write(st)}function b0(wt){const st=ur;return Array.isArray(wt)?st.required.array(st.required.object({text:st.required.string,value:st.required.raw}))(wt).value:typeof wt=="object"?st.required.raw(wt).value:void 0}function _1(wt){if(wt==="inline"||wt==="popup")return wt}function zm(wt){const st=ur;return st.required.object({max:st.optional.number,min:st.optional.number,step:st.optional.number})(wt).value}function I_(wt){if(Array.isArray(wt))return wt;const st=[];return Object.keys(wt).forEach(dt=>{st.push({text:dt,value:wt[dt]})}),st}function zl(wt){return bt(wt)?null:new Lo(I_(wt))}function _A(wt){const st=wt?Dl(wt,Lo):null;return st?st.options:null}function yA(wt,st){const dt=wt&&Dl(wt,Yl);return dt?bu(dt.step):Math.max(bu(st),2)}function dv(wt){const st=function(dt){const It=dt?Dl(dt,Yl):null;return It?It.step:null}(wt);return st??1}function P_(wt,st){var dt;const It=wt&&Dl(wt,Yl),Zt=Math.abs((dt=It==null?void 0:It.step)!==null&&dt!==void 0?dt:st);return Zt===0?.1:Math.pow(10,Math.floor(Math.log10(Zt))-1)}const E0=nn("ckb");class AA{constructor(st,dt){this.onValueChange_=this.onValueChange_.bind(this),this.element=st.createElement("div"),this.element.classList.add(E0()),dt.viewProps.bindClassModifiers(this.element);const It=st.createElement("label");It.classList.add(E0("l")),this.element.appendChild(It);const Zt=st.createElement("input");Zt.classList.add(E0("i")),Zt.type="checkbox",It.appendChild(Zt),this.inputElement=Zt,dt.viewProps.bindDisabled(this.inputElement);const bn=st.createElement("div");bn.classList.add(E0("w")),It.appendChild(bn);const Rn=rn(st,"check");bn.appendChild(Rn),dt.value.emitter.on("change",this.onValueChange_),this.value=dt.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class IS{constructor(st,dt){this.onInputChange_=this.onInputChange_.bind(this),this.value=dt.value,this.viewProps=dt.viewProps,this.view=new AA(st,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(st){const dt=st.currentTarget;this.value.rawValue=dt.checked}}const y1={id:"input-bool",type:"input",accept:(wt,st)=>{if(typeof wt!="boolean")return null;const dt=nr(st,{options:ur.optional.custom(b0)});return dt?{initialValue:wt,params:dt}:null},binding:{reader:wt=>so,constraint:wt=>function(st){const dt=[],It=zl(st.options);return It&&dt.push(It),new yo(dt)}(wt.params),writer:wt=>Wv},controller:wt=>{var st;const dt=wt.document,It=wt.value,Zt=wt.constraint;return Zt&&Dl(Zt,Lo)?new Io(dt,{props:Bn.fromObject({options:(st=_A(Zt))!==null&&st!==void 0?st:[]}),value:It,viewProps:wt.viewProps}):new IS(dt,{value:It,viewProps:wt.viewProps})}},pv=nn("col");class wA{constructor(st,dt){this.element=st.createElement("div"),this.element.classList.add(pv()),dt.foldable.bindExpandedClass(this.element,pv(void 0,"expanded")),Ht(dt.foldable,"completed",on(this.element,pv(void 0,"cpl")));const It=st.createElement("div");It.classList.add(pv("h")),this.element.appendChild(It);const Zt=st.createElement("div");Zt.classList.add(pv("s")),It.appendChild(Zt),this.swatchElement=Zt;const bn=st.createElement("div");if(bn.classList.add(pv("t")),It.appendChild(bn),this.textElement=bn,dt.pickerLayout==="inline"){const Rn=st.createElement("div");Rn.classList.add(pv("p")),this.element.appendChild(Rn),this.pickerElement=Rn}else this.pickerElement=null}}function Fs(wt,st,dt){const It=vA(wt,360),Zt=Go(st/100,0,1),bn=Go(dt/100,0,1),Rn=bn*Zt,dr=Rn*(1-Math.abs(It/60%2-1)),Dr=bn-Rn;let ys,Ts,ps;return[ys,Ts,ps]=It>=0&&It<60?[Rn,dr,0]:It>=60&&It<120?[dr,Rn,0]:It>=120&&It<180?[0,Rn,dr]:It>=180&&It<240?[0,dr,Rn]:It>=240&&It<300?[dr,0,Rn]:[Rn,0,dr],[255*(ys+Dr),255*(Ts+Dr),255*(ps+Dr)]}function ru(wt){return[wt[0],wt[1],wt[2]]}function Rw(wt,st){return[wt[0],wt[1],wt[2],st]}const D_={hsl:{hsl:(wt,st,dt)=>[wt,st,dt],hsv:function(wt,st,dt){const It=dt+st*(100-Math.abs(2*dt-100))/200;return[wt,It!==0?st*(100-Math.abs(2*dt-100))/It:0,dt+st*(100-Math.abs(2*dt-100))/200]},rgb:function(wt,st,dt){const It=(wt%360+360)%360,Zt=Go(st/100,0,1),bn=Go(dt/100,0,1),Rn=(1-Math.abs(2*bn-1))*Zt,dr=Rn*(1-Math.abs(It/60%2-1)),Dr=bn-Rn/2;let ys,Ts,ps;return[ys,Ts,ps]=It>=0&&It<60?[Rn,dr,0]:It>=60&&It<120?[dr,Rn,0]:It>=120&&It<180?[0,Rn,dr]:It>=180&&It<240?[0,dr,Rn]:It>=240&&It<300?[dr,0,Rn]:[Rn,0,dr],[255*(ys+Dr),255*(Ts+Dr),255*(ps+Dr)]}},hsv:{hsl:function(wt,st,dt){const It=100-Math.abs(dt*(200-st)/100-100);return[wt,It!==0?st*dt/It:0,dt*(200-st)/200]},hsv:(wt,st,dt)=>[wt,st,dt],rgb:Fs},rgb:{hsl:function(wt,st,dt){const It=Go(wt/255,0,1),Zt=Go(st/255,0,1),bn=Go(dt/255,0,1),Rn=Math.max(It,Zt,bn),dr=Math.min(It,Zt,bn),Dr=Rn-dr;let ys=0,Ts=0;const ps=(dr+Rn)/2;return Dr!==0&&(Ts=Dr/(1-Math.abs(Rn+dr-1)),ys=It===Rn?(Zt-bn)/Dr:Zt===Rn?2+(bn-It)/Dr:4+(It-Zt)/Dr,ys=ys/6+(ys<0?1:0)),[360*ys,100*Ts,100*ps]},hsv:function(wt,st,dt){const It=Go(wt/255,0,1),Zt=Go(st/255,0,1),bn=Go(dt/255,0,1),Rn=Math.max(It,Zt,bn),dr=Rn-Math.min(It,Zt,bn);let Dr;return Dr=dr===0?0:Rn===It?((Zt-bn)/dr%6+6)%6*60:Rn===Zt?60*((bn-It)/dr+2):60*((It-Zt)/dr+4),[Dr,100*(Rn===0?0:dr/Rn),100*Rn]},rgb:(wt,st,dt)=>[wt,st,dt]}},Ey={hsl:wt=>{var st;return[vA(wt[0],360),Go(wt[1],0,100),Go(wt[2],0,100),Go((st=wt[3])!==null&&st!==void 0?st:1,0,1)]},hsv:wt=>{var st;return[vA(wt[0],360),Go(wt[1],0,100),Go(wt[2],0,100),Go((st=wt[3])!==null&&st!==void 0?st:1,0,1)]},rgb:wt=>{var st;return[Go(wt[0],0,255),Go(wt[1],0,255),Go(wt[2],0,255),Go((st=wt[3])!==null&&st!==void 0?st:1,0,1)]}};function Ju(wt,st){return typeof wt=="object"&&!bt(wt)&&st in wt&&typeof wt[st]=="number"}class Ms{constructor(st,dt){this.mode_=dt,this.comps_=Ey[dt](st)}static black(){return new Ms([0,0,0],"rgb")}static fromObject(st){const dt="a"in st?[st.r,st.g,st.b,st.a]:[st.r,st.g,st.b];return new Ms(dt,"rgb")}static toRgbaObject(st){return st.toRgbaObject()}static isRgbColorObject(st){return Ju(st,"r")&&Ju(st,"g")&&Ju(st,"b")}static isRgbaColorObject(st){return this.isRgbColorObject(st)&&Ju(st,"a")}static isColorObject(st){return this.isRgbColorObject(st)}static equals(st,dt){if(st.mode_!==dt.mode_)return!1;const It=st.comps_,Zt=dt.comps_;for(let bn=0;bn<It.length;bn++)if(It[bn]!==Zt[bn])return!1;return!0}get mode(){return this.mode_}getComponents(st){return Rw((dt=ru(this.comps_),It=this.mode_,Zt=st||this.mode_,D_[It][Zt](...dt)),this.comps_[3]);var dt,It,Zt}toRgbaObject(){const st=this.getComponents("rgb");return{r:st[0],g:st[1],b:st[2],a:st[3]}}}const Vm=nn("colp");class Sy{constructor(st,dt){this.alphaViews_=null,this.element=st.createElement("div"),this.element.classList.add(Vm());const It=st.createElement("div");It.classList.add(Vm("hsv"));const Zt=st.createElement("div");Zt.classList.add(Vm("sv")),this.svPaletteView_=dt.svPaletteView,Zt.appendChild(this.svPaletteView_.element),It.appendChild(Zt);const bn=st.createElement("div");bn.classList.add(Vm("h")),this.hPaletteView_=dt.hPaletteView,bn.appendChild(this.hPaletteView_.element),It.appendChild(bn),this.element.appendChild(It);const Rn=st.createElement("div");if(Rn.classList.add(Vm("rgb")),this.textView_=dt.textView,Rn.appendChild(this.textView_.element),this.element.appendChild(Rn),dt.alphaViews){this.alphaViews_={palette:dt.alphaViews.palette,text:dt.alphaViews.text};const dr=st.createElement("div");dr.classList.add(Vm("a"));const Dr=st.createElement("div");Dr.classList.add(Vm("ap")),Dr.appendChild(this.alphaViews_.palette.element),dr.appendChild(Dr);const ys=st.createElement("div");ys.classList.add(Vm("at")),ys.appendChild(this.alphaViews_.text.element),dr.appendChild(ys),this.element.appendChild(dr)}}get allFocusableElements(){const st=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(dt=>dt.inputElement)];return this.alphaViews_&&st.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),st}}function Cy(wt){const st=ur;return nr(wt,{alpha:st.optional.boolean,expanded:st.optional.boolean,picker:st.optional.custom(_1)})}function qv(wt){return wt?.1:1}function lp(wt,st){const dt=wt.match(/^(.+)%$/);return Math.min(dt?.01*parseFloat(dt[1])*st:parseFloat(wt),st)}const fv={deg:wt=>wt,grad:wt=>360*wt/400,rad:wt=>360*wt/(2*Math.PI),turn:wt=>360*wt};function Zo(wt){const st=wt.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!st)return parseFloat(wt);const dt=parseFloat(st[1]),It=st[2];return fv[It](dt)}const xA={"func.rgb":wt=>{const st=wt.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!st)return null;const dt=[lp(st[1],255),lp(st[2],255),lp(st[3],255)];return isNaN(dt[0])||isNaN(dt[1])||isNaN(dt[2])?null:new Ms(dt,"rgb")},"func.rgba":wt=>{const st=wt.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!st)return null;const dt=[lp(st[1],255),lp(st[2],255),lp(st[3],255),lp(st[4],1)];return isNaN(dt[0])||isNaN(dt[1])||isNaN(dt[2])||isNaN(dt[3])?null:new Ms(dt,"rgb")},"func.hsl":wt=>{const st=wt.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!st)return null;const dt=[Zo(st[1]),lp(st[2],100),lp(st[3],100)];return isNaN(dt[0])||isNaN(dt[1])||isNaN(dt[2])?null:new Ms(dt,"hsl")},"func.hsla":wt=>{const st=wt.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!st)return null;const dt=[Zo(st[1]),lp(st[2],100),lp(st[3],100),lp(st[4],1)];return isNaN(dt[0])||isNaN(dt[1])||isNaN(dt[2])||isNaN(dt[3])?null:new Ms(dt,"hsl")},"hex.rgb":wt=>{const st=wt.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(st)return new Ms([parseInt(st[1]+st[1],16),parseInt(st[2]+st[2],16),parseInt(st[3]+st[3],16)],"rgb");const dt=wt.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return dt?new Ms([parseInt(dt[1],16),parseInt(dt[2],16),parseInt(dt[3],16)],"rgb"):null},"hex.rgba":wt=>{const st=wt.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(st)return new Ms([parseInt(st[1]+st[1],16),parseInt(st[2]+st[2],16),parseInt(st[3]+st[3],16),wo(parseInt(st[4]+st[4],16),0,255,0,1)],"rgb");const dt=wt.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return dt?new Ms([parseInt(dt[1],16),parseInt(dt[2],16),parseInt(dt[3],16),wo(parseInt(dt[4],16),0,255,0,1)],"rgb"):null}};function Rr(wt){return Object.keys(xA).reduce((st,dt)=>st||((0,xA[dt])(wt)?dt:null),null)}const Ou=wt=>{const st=Rr(wt);return st?xA[st](wt):null};function A1(wt){return wt==="func.hsla"||wt==="func.rgba"||wt==="hex.rgba"}function kw(wt){if(typeof wt=="string"){const st=Ou(wt);if(st)return st}return Ms.black()}function R_(wt){const st=Go(Math.floor(wt),0,255).toString(16);return st.length===1?`0${st}`:st}function k_(wt,st="#"){return`${st}${ru(wt.getComponents("rgb")).map(R_).join("")}`}function wm(wt,st="#"){const dt=wt.getComponents("rgb");return`${st}${[dt[0],dt[1],dt[2],255*dt[3]].map(R_).join("")}`}function My(wt){const st=El(0);return`rgb(${ru(wt.getComponents("rgb")).map(dt=>st(dt)).join(", ")})`}function S0(wt){const st=El(2),dt=El(0);return`rgba(${wt.getComponents("rgb").map((It,Zt)=>(Zt===3?st:dt)(It)).join(", ")})`}const Zu={"func.hsl":function(wt){const st=[El(0),Gv,Gv];return`hsl(${ru(wt.getComponents("hsl")).map((dt,It)=>st[It](dt)).join(", ")})`},"func.hsla":function(wt){const st=[El(0),Gv,Gv,El(2)];return`hsla(${wt.getComponents("hsl").map((dt,It)=>st[It](dt)).join(", ")})`},"func.rgb":My,"func.rgba":S0,"hex.rgb":k_,"hex.rgba":wm};function bA(wt){return Zu[wt]}const Vl=nn("apl");class Jp{constructor(st,dt){this.onValueChange_=this.onValueChange_.bind(this),this.value=dt.value,this.value.emitter.on("change",this.onValueChange_),this.element=st.createElement("div"),this.element.classList.add(Vl()),dt.viewProps.bindTabIndex(this.element);const It=st.createElement("div");It.classList.add(Vl("b")),this.element.appendChild(It);const Zt=st.createElement("div");Zt.classList.add(Vl("c")),It.appendChild(Zt),this.colorElem_=Zt;const bn=st.createElement("div");bn.classList.add(Vl("m")),this.element.appendChild(bn),this.markerElem_=bn;const Rn=st.createElement("div");Rn.classList.add(Vl("p")),this.markerElem_.appendChild(Rn),this.previewElem_=Rn,this.update_()}update_(){const st=this.value.rawValue,dt=st.getComponents("rgb"),It=new Ms([dt[0],dt[1],dt[2],0],"rgb"),Zt=new Ms([dt[0],dt[1],dt[2],255],"rgb"),bn=["to right",S0(It),S0(Zt)];this.colorElem_.style.background=`linear-gradient(${bn.join(",")})`,this.previewElem_.style.backgroundColor=S0(st);const Rn=wo(dt[3],0,1,0,100);this.markerElem_.style.left=`${Rn}%`}onValueChange_(){this.update_()}}class C0{constructor(st,dt){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=dt.value,this.viewProps=dt.viewProps,this.view=new Jp(st,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Bu(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(st,dt){if(!st.point)return;const It=st.point.x/st.bounds.width,Zt=this.value.rawValue,[bn,Rn,dr]=Zt.getComponents("hsv");this.value.setRawValue(new Ms([bn,Rn,dr,It],"hsv"),dt)}onPointerDown_(st){this.handlePointerEvent_(st.data,{forceEmit:!1,last:!1})}onPointerMove_(st){this.handlePointerEvent_(st.data,{forceEmit:!1,last:!1})}onPointerUp_(st){this.handlePointerEvent_(st.data,{forceEmit:!0,last:!0})}onKeyDown_(st){const dt=ap(qv(!0),Ru(st));if(dt===0)return;const It=this.value.rawValue,[Zt,bn,Rn,dr]=It.getComponents("hsv");this.value.setRawValue(new Ms([Zt,bn,Rn,dr+dt],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(st){ap(qv(!0),Ru(st))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const kp=nn("coltxt");class EA{constructor(st,dt){this.element=st.createElement("div"),this.element.classList.add(kp());const It=st.createElement("div");It.classList.add(kp("m")),this.modeElem_=function(Rn){const dr=Rn.createElement("select");return dr.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}].reduce((Dr,ys)=>{const Ts=Rn.createElement("option");return Ts.textContent=ys.text,Ts.value=ys.value,Dr.appendChild(Ts),Dr},Rn.createDocumentFragment())),dr}(st),this.modeElem_.classList.add(kp("ms")),It.appendChild(this.modeSelectElement);const Zt=st.createElement("div");Zt.classList.add(kp("mm")),Zt.appendChild(rn(st,"dropdown")),It.appendChild(Zt),this.element.appendChild(It);const bn=st.createElement("div");bn.classList.add(kp("w")),this.element.appendChild(bn),this.textsElem_=bn,this.textViews_=dt.textViews,this.applyTextViews_(),Nt(dt.colorMode,Rn=>{this.modeElem_.value=Rn})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(st){this.textViews_=st,this.applyTextViews_()}applyTextViews_(){Cr(this.textsElem_);const st=this.element.ownerDocument;this.textViews_.forEach(dt=>{const It=st.createElement("div");It.classList.add(kp("c")),It.appendChild(dt.element),this.textsElem_.appendChild(It)})}}const is=El(0),Zp={rgb:()=>new Hs({min:0,max:255}),hsl:wt=>new Hs(wt===0?{min:0,max:360}:{min:0,max:100}),hsv:wt=>new Hs(wt===0?{min:0,max:360}:{min:0,max:100})};function Ty(wt,st,dt){return new T_(wt,{arrayPosition:dt===0?"fst":dt===2?"lst":"mid",baseStep:qv(!1),parser:st.parser,props:Bn.fromObject({draggingScale:1,formatter:is}),value:hn(0,{constraint:Zp[st.colorMode](dt)}),viewProps:st.viewProps})}class B_{constructor(st,dt){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.parser_=dt.parser,this.value=dt.value,this.viewProps=dt.viewProps,this.colorMode=hn(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(st),this.view=new EA(st,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(st){const dt={colorMode:this.colorMode.rawValue,parser:this.parser_,viewProps:this.viewProps},It=[Ty(st,dt,0),Ty(st,dt,1),Ty(st,dt,2)];return It.forEach((Zt,bn)=>{C_({primary:this.value,secondary:Zt.value,forward:Rn=>Rn.rawValue.getComponents(this.colorMode.rawValue)[bn],backward:(Rn,dr)=>{const Dr=this.colorMode.rawValue,ys=Rn.rawValue.getComponents(Dr);return ys[bn]=dr.rawValue,new Ms(Rw(ru(ys),ys[3]),Dr)}})}),It}onModeSelectChange_(st){const dt=st.currentTarget;this.colorMode.rawValue=dt.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const M0=nn("hpl");class Bw{constructor(st,dt){this.onValueChange_=this.onValueChange_.bind(this),this.value=dt.value,this.value.emitter.on("change",this.onValueChange_),this.element=st.createElement("div"),this.element.classList.add(M0()),dt.viewProps.bindTabIndex(this.element);const It=st.createElement("div");It.classList.add(M0("c")),this.element.appendChild(It);const Zt=st.createElement("div");Zt.classList.add(M0("m")),this.element.appendChild(Zt),this.markerElem_=Zt,this.update_()}update_(){const st=this.value.rawValue,[dt]=st.getComponents("hsv");this.markerElem_.style.backgroundColor=My(new Ms([dt,100,100],"hsv"));const It=wo(dt,0,360,0,100);this.markerElem_.style.left=`${It}%`}onValueChange_(){this.update_()}}class yu{constructor(st,dt){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=dt.value,this.viewProps=dt.viewProps,this.view=new Bw(st,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Bu(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(st,dt){if(!st.point)return;const It=wo(Go(st.point.x,0,st.bounds.width),0,st.bounds.width,0,359),Zt=this.value.rawValue,[,bn,Rn,dr]=Zt.getComponents("hsv");this.value.setRawValue(new Ms([It,bn,Rn,dr],"hsv"),dt)}onPointerDown_(st){this.handlePointerEvent_(st.data,{forceEmit:!1,last:!1})}onPointerMove_(st){this.handlePointerEvent_(st.data,{forceEmit:!1,last:!1})}onPointerUp_(st){this.handlePointerEvent_(st.data,{forceEmit:!0,last:!0})}onKeyDown_(st){const dt=ap(qv(!1),Ru(st));if(dt===0)return;const It=this.value.rawValue,[Zt,bn,Rn,dr]=It.getComponents("hsv");this.value.setRawValue(new Ms([Zt+dt,bn,Rn,dr],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(st){ap(qv(!1),Ru(st))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Fo=nn("svp");class xp{constructor(st,dt){this.onValueChange_=this.onValueChange_.bind(this),this.value=dt.value,this.value.emitter.on("change",this.onValueChange_),this.element=st.createElement("div"),this.element.classList.add(Fo()),dt.viewProps.bindTabIndex(this.element);const It=st.createElement("canvas");It.height=64,It.width=64,It.classList.add(Fo("c")),this.element.appendChild(It),this.canvasElement=It;const Zt=st.createElement("div");Zt.classList.add(Fo("m")),this.element.appendChild(Zt),this.markerElem_=Zt,this.update_()}update_(){const st=function(ys){const Ts=ys.ownerDocument.defaultView;return Ts&&"document"in Ts?ys.getContext("2d"):null}(this.canvasElement);if(!st)return;const dt=this.value.rawValue.getComponents("hsv"),It=this.canvasElement.width,Zt=this.canvasElement.height,bn=st.getImageData(0,0,It,Zt),Rn=bn.data;for(let ys=0;ys<Zt;ys++)for(let Ts=0;Ts<It;Ts++){const ps=wo(Ts,0,It,0,100),Cl=wo(ys,0,Zt,100,0),iu=Fs(dt[0],ps,Cl),cm=4*(ys*It+Ts);Rn[cm]=iu[0],Rn[cm+1]=iu[1],Rn[cm+2]=iu[2],Rn[cm+3]=255}st.putImageData(bn,0,0);const dr=wo(dt[1],0,100,0,100);this.markerElem_.style.left=`${dr}%`;const Dr=wo(dt[2],0,100,100,0);this.markerElem_.style.top=`${Dr}%`}onValueChange_(){this.update_()}}class T0{constructor(st,dt){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=dt.value,this.viewProps=dt.viewProps,this.view=new xp(st,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Bu(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(st,dt){if(!st.point)return;const It=wo(st.point.x,0,st.bounds.width,0,100),Zt=wo(st.point.y,0,st.bounds.height,100,0),[bn,,,Rn]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new Ms([bn,It,Zt,Rn],"hsv"),dt)}onPointerDown_(st){this.handlePointerEvent_(st.data,{forceEmit:!1,last:!1})}onPointerMove_(st){this.handlePointerEvent_(st.data,{forceEmit:!1,last:!1})}onPointerUp_(st){this.handlePointerEvent_(st.data,{forceEmit:!0,last:!0})}onKeyDown_(st){ku(st.key)&&st.preventDefault();const[dt,It,Zt,bn]=this.value.rawValue.getComponents("hsv"),Rn=qv(!1),dr=ap(Rn,Ru(st)),Dr=ap(Rn,x0(st));dr===0&&Dr===0||this.value.setRawValue(new Ms([dt,It+dr,Zt+Dr,bn],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(st){const dt=qv(!1),It=ap(dt,Ru(st)),Zt=ap(dt,x0(st));It===0&&Zt===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class w1{constructor(st,dt){this.value=dt.value,this.viewProps=dt.viewProps,this.hPaletteC_=new yu(st,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new T0(st,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=dt.supportsAlpha?{palette:new C0(st,{value:this.value,viewProps:this.viewProps}),text:new T_(st,{parser:_u,baseStep:.1,props:Bn.fromObject({draggingScale:.01,formatter:El(2)}),value:hn(0,{constraint:new Hs({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&C_({primary:this.value,secondary:this.alphaIcs_.text.value,forward:It=>It.rawValue.getComponents()[3],backward:(It,Zt)=>{const bn=It.rawValue.getComponents();return bn[3]=Zt.rawValue,new Ms(bn,It.rawValue.mode)}}),this.textC_=new B_(st,{parser:_u,value:this.value,viewProps:this.viewProps}),this.view=new Sy(st,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:dt.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}const O_=nn("colsw");class SA{constructor(st,dt){this.onValueChange_=this.onValueChange_.bind(this),dt.value.emitter.on("change",this.onValueChange_),this.value=dt.value,this.element=st.createElement("div"),this.element.classList.add(O_()),dt.viewProps.bindClassModifiers(this.element);const It=st.createElement("div");It.classList.add(O_("sw")),this.element.appendChild(It),this.swatchElem_=It;const Zt=st.createElement("button");Zt.classList.add(O_("b")),dt.viewProps.bindDisabled(Zt),this.element.appendChild(Zt),this.buttonElement=Zt,this.update_()}update_(){const st=this.value.rawValue;this.swatchElem_.style.backgroundColor=wm(st)}onValueChange_(){this.update_()}}class _f{constructor(st,dt){this.value=dt.value,this.viewProps=dt.viewProps,this.view=new SA(st,{value:this.value,viewProps:this.viewProps})}}class Lu{constructor(st,dt){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=dt.value,this.viewProps=dt.viewProps,this.foldable_=ks.create(dt.expanded),this.swatchC_=new _f(st,{value:this.value,viewProps:this.viewProps});const It=this.swatchC_.view.buttonElement;It.addEventListener("blur",this.onButtonBlur_),It.addEventListener("click",this.onButtonClick_),this.textC_=new Ao(st,{parser:dt.parser,props:Bn.fromObject({formatter:dt.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new wA(st,{foldable:this.foldable_,pickerLayout:dt.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=dt.pickerLayout==="popup"?new Xr(st,{viewProps:this.viewProps}):null;const Zt=new w1(st,{supportsAlpha:dt.supportsAlpha,value:this.value,viewProps:this.viewProps});Zt.view.allFocusableElements.forEach(bn=>{bn.addEventListener("blur",this.onPopupChildBlur_),bn.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=Zt,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(Zt.view.element),C_({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:bn=>bn.rawValue,backward:(bn,Rn)=>Rn.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Vs(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(st){if(!this.popC_)return;const dt=this.view.element,It=st.relatedTarget;It&&dt.contains(It)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(st){if(!this.popC_)return;const dt=this.popC_.view.element,It=Ar(st);It&&dt.contains(It)||It&&It===this.swatchC_.view.buttonElement&&!Kn(dt.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(st){this.popC_?st.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&st.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function An(wt){return Ms.isColorObject(wt)?Ms.fromObject(wt):Ms.black()}function mv(wt){return ru(wt.getComponents("rgb")).reduce((st,dt)=>st<<8|255&Math.floor(dt),0)}function em(wt){return wt.getComponents("rgb").reduce((st,dt,It)=>st<<8|255&Math.floor(It===3?255*dt:dt),0)>>>0}function L_(wt){return typeof wt!="number"?Ms.black():new Ms([(st=wt)>>16&255,st>>8&255,255&st],"rgb");var st}function gv(wt){return typeof wt!="number"?Ms.black():new Ms([(st=wt)>>24&255,st>>16&255,st>>8&255,wo(255&st,0,255,0,1)],"rgb");var st}function N_(wt,st){const dt=st.toRgbaObject();wt.writeProperty("r",dt.r),wt.writeProperty("g",dt.g),wt.writeProperty("b",dt.b),wt.writeProperty("a",dt.a)}function CA(wt,st){const dt=st.toRgbaObject();wt.writeProperty("r",dt.r),wt.writeProperty("g",dt.g),wt.writeProperty("b",dt.b)}function xm(wt){return"alpha"in wt&&wt.alpha===!0}function Yv(wt){return wt?st=>wm(st,"0x"):st=>k_(st,"0x")}const vv={id:"input-color-number",type:"input",accept:(wt,st)=>{if(typeof wt!="number"||!("view"in st)||st.view!=="color")return null;const dt=Cy(st);return dt?{initialValue:wt,params:dt}:null},binding:{reader:wt=>xm(wt.params)?gv:L_,equals:Ms.equals,writer:wt=>function(st){const dt=st?em:mv;return(It,Zt)=>{Wv(It,dt(Zt))}}(xm(wt.params))},controller:wt=>{const st=xm(wt.params),dt="expanded"in wt.params?wt.params.expanded:void 0,It="picker"in wt.params?wt.params.picker:void 0;return new Lu(wt.document,{expanded:dt!=null&&dt,formatter:Yv(st),parser:Ou,pickerLayout:It??"popup",supportsAlpha:st,value:wt.value,viewProps:wt.viewProps})}},bm={id:"input-color-object",type:"input",accept:(wt,st)=>{if(!Ms.isColorObject(wt))return null;const dt=Cy(st);return dt?{initialValue:wt,params:dt}:null},binding:{reader:wt=>An,equals:Ms.equals,writer:wt=>{return st=wt.initialValue,Ms.isRgbaColorObject(st)?N_:CA;var st}},controller:wt=>{const st=Ms.isRgbaColorObject(wt.initialValue),dt="expanded"in wt.params?wt.params.expanded:void 0,It="picker"in wt.params?wt.params.picker:void 0,Zt=st?wm:k_;return new Lu(wt.document,{expanded:dt!=null&&dt,formatter:Zt,parser:Ou,pickerLayout:It??"popup",supportsAlpha:st,value:wt.value,viewProps:wt.viewProps})}},Xv={id:"input-color-string",type:"input",accept:(wt,st)=>{if(typeof wt!="string"||"view"in st&&st.view==="text"||!Rr(wt))return null;const dt=Cy(st);return dt?{initialValue:wt,params:dt}:null},binding:{reader:wt=>kw,equals:Ms.equals,writer:wt=>{const st=Rr(wt.initialValue);if(!st)throw qt.shouldNeverHappen();return function(dt){const It=bA(dt);return(Zt,bn)=>{Wv(Zt,It(bn))}}(st)}},controller:wt=>{const st=Rr(wt.initialValue);if(!st)throw qt.shouldNeverHappen();const dt=bA(st),It="expanded"in wt.params?wt.params.expanded:void 0,Zt="picker"in wt.params?wt.params.picker:void 0;return new Lu(wt.document,{expanded:It!=null&&It,formatter:dt,parser:Ou,pickerLayout:Zt??"popup",supportsAlpha:A1(st),value:wt.value,viewProps:wt.viewProps})}};class bp{constructor(st){this.components=st.components,this.asm_=st.assembly}constrain(st){const dt=this.asm_.toComponents(st).map((It,Zt)=>{var bn,Rn;return(Rn=(bn=this.components[Zt])===null||bn===void 0?void 0:bn.constrain(It))!==null&&Rn!==void 0?Rn:It});return this.asm_.fromComponents(dt)}}const I0=nn("pndtxt");class MA{constructor(st,dt){this.textViews=dt.textViews,this.element=st.createElement("div"),this.element.classList.add(I0()),this.textViews.forEach(It=>{const Zt=st.createElement("div");Zt.classList.add(I0("a")),Zt.appendChild(It.element),this.element.appendChild(Zt)})}}class F_{constructor(st,dt){this.value=dt.value,this.viewProps=dt.viewProps,this.acs_=dt.axes.map((It,Zt)=>function(bn,Rn,dr){return new T_(bn,{arrayPosition:dr===0?"fst":dr===Rn.axes.length-1?"lst":"mid",baseStep:Rn.axes[dr].baseStep,parser:Rn.parser,props:Rn.axes[dr].textProps,value:hn(0,{constraint:Rn.axes[dr].constraint}),viewProps:Rn.viewProps})}(st,dt,Zt)),this.acs_.forEach((It,Zt)=>{C_({primary:this.value,secondary:It.value,forward:bn=>dt.assembly.toComponents(bn.rawValue)[Zt],backward:(bn,Rn)=>{const dr=dt.assembly.toComponents(bn.rawValue);return dr[Zt]=Rn.rawValue,dt.assembly.fromComponents(dr)}})}),this.view=new MA(st,{textViews:this.acs_.map(It=>It.view)})}}function Kv(wt){const st=[],dt=function(bn){return"step"in bn&&!bt(bn.step)?new Yl(bn.step):null}(wt);dt&&st.push(dt);const It=function(bn){return"max"in bn&&!bt(bn.max)||"min"in bn&&!bt(bn.min)?new Hs({max:bn.max,min:bn.min}):null}(wt);It&&st.push(It);const Zt=zl(wt.options);return Zt&&st.push(Zt),new yo(st)}function TA(wt){const[st,dt]=function(It){const Zt=It?Dl(It,Hs):null;return Zt?[Zt.minValue,Zt.maxValue]:[void 0,void 0]}(wt);return[st??0,dt??100]}const xo={id:"input-number",type:"input",accept:(wt,st)=>{if(typeof wt!="number")return null;const dt=ur,It=nr(st,{format:dt.optional.function,max:dt.optional.number,min:dt.optional.number,options:dt.optional.custom(b0),step:dt.optional.number});return It?{initialValue:wt,params:It}:null},binding:{reader:wt=>Xp,constraint:wt=>Kv(wt.params),writer:wt=>Wv},controller:wt=>{var st,dt;const It=wt.value,Zt=wt.constraint;if(Zt&&Dl(Zt,Lo))return new Io(wt.document,{props:Bn.fromObject({options:(st=_A(Zt))!==null&&st!==void 0?st:[]}),value:It,viewProps:wt.viewProps});const bn=(dt="format"in wt.params?wt.params.format:void 0)!==null&&dt!==void 0?dt:El(yA(Zt,It.rawValue));if(Zt&&Dl(Zt,Hs)){const[Rn,dr]=TA(Zt);return new $p(wt.document,{baseStep:dv(Zt),parser:_u,sliderProps:Bn.fromObject({maxValue:dr,minValue:Rn}),textProps:Bn.fromObject({draggingScale:P_(Zt,It.rawValue),formatter:bn}),value:It,viewProps:wt.viewProps})}return new T_(wt.document,{baseStep:dv(Zt),parser:_u,props:Bn.fromObject({draggingScale:P_(Zt,It.rawValue),formatter:bn}),value:It,viewProps:wt.viewProps})}};class Sl{constructor(st=0,dt=0){this.x=st,this.y=dt}getComponents(){return[this.x,this.y]}static isObject(st){if(bt(st))return!1;const dt=st.x,It=st.y;return typeof dt=="number"&&typeof It=="number"}static equals(st,dt){return st.x===dt.x&&st.y===dt.y}toObject(){return{x:this.x,y:this.y}}}const tm={toComponents:wt=>wt.getComponents(),fromComponents:wt=>new Sl(...wt)},Bp=nn("p2d");class nm{constructor(st,dt){this.element=st.createElement("div"),this.element.classList.add(Bp()),dt.viewProps.bindClassModifiers(this.element),Nt(dt.expanded,on(this.element,Bp(void 0,"expanded")));const It=st.createElement("div");It.classList.add(Bp("h")),this.element.appendChild(It);const Zt=st.createElement("button");Zt.classList.add(Bp("b")),Zt.appendChild(rn(st,"p2dpad")),dt.viewProps.bindDisabled(Zt),It.appendChild(Zt),this.buttonElement=Zt;const bn=st.createElement("div");if(bn.classList.add(Bp("t")),It.appendChild(bn),this.textElement=bn,dt.pickerLayout==="inline"){const Rn=st.createElement("div");Rn.classList.add(Bp("p")),this.element.appendChild(Rn),this.pickerElement=Rn}else this.pickerElement=null}}const fu=nn("p2dp");class IA{constructor(st,dt){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=dt.invertsY,this.maxValue_=dt.maxValue,this.element=st.createElement("div"),this.element.classList.add(fu()),dt.layout==="popup"&&this.element.classList.add(fu(void 0,"p"));const It=st.createElement("div");It.classList.add(fu("p")),dt.viewProps.bindTabIndex(It),this.element.appendChild(It),this.padElement=It;const Zt=st.createElementNS(sn,"svg");Zt.classList.add(fu("g")),this.padElement.appendChild(Zt),this.svgElem_=Zt;const bn=st.createElementNS(sn,"line");bn.classList.add(fu("ax")),bn.setAttributeNS(null,"x1","0"),bn.setAttributeNS(null,"y1","50%"),bn.setAttributeNS(null,"x2","100%"),bn.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(bn);const Rn=st.createElementNS(sn,"line");Rn.classList.add(fu("ax")),Rn.setAttributeNS(null,"x1","50%"),Rn.setAttributeNS(null,"y1","0"),Rn.setAttributeNS(null,"x2","50%"),Rn.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(Rn);const dr=st.createElementNS(sn,"line");dr.classList.add(fu("l")),dr.setAttributeNS(null,"x1","50%"),dr.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(dr),this.lineElem_=dr;const Dr=st.createElement("div");Dr.classList.add(fu("m")),this.padElement.appendChild(Dr),this.markerElem_=Dr,dt.value.emitter.on("change",this.onValueChange_),this.value=dt.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[st,dt]=this.value.rawValue.getComponents(),It=this.maxValue_,Zt=wo(st,-It,+It,0,100),bn=wo(dt,-It,+It,0,100),Rn=this.invertsY_?100-bn:bn;this.lineElem_.setAttributeNS(null,"x2",`${Zt}%`),this.lineElem_.setAttributeNS(null,"y2",`${Rn}%`),this.markerElem_.style.left=`${Zt}%`,this.markerElem_.style.top=`${Rn}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function P0(wt,st,dt){return[ap(st[0],Ru(wt)),ap(st[1],x0(wt))*(dt?1:-1)]}class Qm{constructor(st,dt){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=dt.value,this.viewProps=dt.viewProps,this.baseSteps_=dt.baseSteps,this.maxValue_=dt.maxValue,this.invertsY_=dt.invertsY,this.view=new IA(st,{invertsY:this.invertsY_,layout:dt.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Bu(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(st,dt){if(!st.point)return;const It=this.maxValue_,Zt=wo(st.point.x,0,st.bounds.width,-It,+It),bn=wo(this.invertsY_?st.bounds.height-st.point.y:st.point.y,0,st.bounds.height,-It,+It);this.value.setRawValue(new Sl(Zt,bn),dt)}onPointerDown_(st){this.handlePointerEvent_(st.data,{forceEmit:!1,last:!1})}onPointerMove_(st){this.handlePointerEvent_(st.data,{forceEmit:!1,last:!1})}onPointerUp_(st){this.handlePointerEvent_(st.data,{forceEmit:!0,last:!0})}onPadKeyDown_(st){ku(st.key)&&st.preventDefault();const[dt,It]=P0(st,this.baseSteps_,this.invertsY_);dt===0&&It===0||this.value.setRawValue(new Sl(this.value.rawValue.x+dt,this.value.rawValue.y+It),{forceEmit:!1,last:!1})}onPadKeyUp_(st){const[dt,It]=P0(st,this.baseSteps_,this.invertsY_);dt===0&&It===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class D0{constructor(st,dt){var It,Zt;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=dt.value,this.viewProps=dt.viewProps,this.foldable_=ks.create(dt.expanded),this.popC_=dt.pickerLayout==="popup"?new Xr(st,{viewProps:this.viewProps}):null;const bn=new Qm(st,{baseSteps:[dt.axes[0].baseStep,dt.axes[1].baseStep],invertsY:dt.invertsY,layout:dt.pickerLayout,maxValue:dt.maxValue,value:this.value,viewProps:this.viewProps});bn.view.allFocusableElements.forEach(Rn=>{Rn.addEventListener("blur",this.onPopupChildBlur_),Rn.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=bn,this.textC_=new F_(st,{assembly:tm,axes:dt.axes,parser:dt.parser,value:this.value,viewProps:this.viewProps}),this.view=new nm(st,{expanded:this.foldable_.value("expanded"),pickerLayout:dt.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(It=this.view.buttonElement)===null||It===void 0||It.addEventListener("blur",this.onPadButtonBlur_),(Zt=this.view.buttonElement)===null||Zt===void 0||Zt.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),C_({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:Rn=>Rn.rawValue,backward:(Rn,dr)=>dr.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Vs(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(st){if(!this.popC_)return;const dt=this.view.element,It=st.relatedTarget;It&&dt.contains(It)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(st){if(!this.popC_)return;const dt=this.popC_.view.element,It=Ar(st);It&&dt.contains(It)||It&&It===this.view.buttonElement&&!Kn(dt.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(st){this.popC_?st.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&st.key==="Escape"&&this.view.buttonElement.focus()}}function Iy(wt){return Sl.isObject(wt)?new Sl(wt.x,wt.y):new Sl}function PA(wt,st){wt.writeProperty("x",st.x),wt.writeProperty("y",st.y)}function $v(wt){if(!wt)return;const st=[];return bt(wt.step)||st.push(new Yl(wt.step)),bt(wt.max)&&bt(wt.min)||st.push(new Hs({max:wt.max,min:wt.min})),new yo(st)}function Us(wt,st){const dt=wt&&Dl(wt,Hs);if(dt)return Math.max(Math.abs(dt.minValue||0),Math.abs(dt.maxValue||0));const It=dv(wt);return Math.max(10*Math.abs(It),10*Math.abs(st))}function qo(wt,st){const dt=st instanceof bp?st.components[0]:void 0,It=st instanceof bp?st.components[1]:void 0,Zt=Us(dt,wt.x),bn=Us(It,wt.y);return Math.max(Zt,bn)}function Eu(wt,st){return{baseStep:dv(st),constraint:st,textProps:Bn.fromObject({draggingScale:P_(st,wt),formatter:El(yA(st,wt))})}}function rm(wt){if(!("y"in wt))return!1;const st=wt.y;return!!st&&"inverted"in st&&!!st.inverted}const _v={id:"input-point2d",type:"input",accept:(wt,st)=>{if(!Sl.isObject(wt))return null;const dt=ur,It=nr(st,{expanded:dt.optional.boolean,picker:dt.optional.custom(_1),x:dt.optional.custom(zm),y:dt.optional.object({inverted:dt.optional.boolean,max:dt.optional.number,min:dt.optional.number,step:dt.optional.number})});return It?{initialValue:wt,params:It}:null},binding:{reader:wt=>Iy,constraint:wt=>{return st=wt.params,new bp({assembly:tm,components:[$v("x"in st?st.x:void 0),$v("y"in st?st.y:void 0)]});var st},equals:Sl.equals,writer:wt=>PA},controller:wt=>{const st=wt.document,dt=wt.value,It=wt.constraint;if(!(It instanceof bp))throw qt.shouldNeverHappen();const Zt="expanded"in wt.params?wt.params.expanded:void 0,bn="picker"in wt.params?wt.params.picker:void 0;return new D0(st,{axes:[Eu(dt.rawValue.x,It.components[0]),Eu(dt.rawValue.y,It.components[1])],expanded:Zt!=null&&Zt,invertsY:rm(wt.params),maxValue:qo(dt.rawValue,It),parser:_u,pickerLayout:bn??"popup",value:dt,viewProps:wt.viewProps})}};class Su{constructor(st=0,dt=0,It=0){this.x=st,this.y=dt,this.z=It}getComponents(){return[this.x,this.y,this.z]}static isObject(st){if(bt(st))return!1;const dt=st.x,It=st.y,Zt=st.z;return typeof dt=="number"&&typeof It=="number"&&typeof Zt=="number"}static equals(st,dt){return st.x===dt.x&&st.y===dt.y&&st.z===dt.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const R0={toComponents:wt=>wt.getComponents(),fromComponents:wt=>new Su(...wt)};function Ep(wt){return Su.isObject(wt)?new Su(wt.x,wt.y,wt.z):new Su}function Ow(wt,st){wt.writeProperty("x",st.x),wt.writeProperty("y",st.y),wt.writeProperty("z",st.z)}function Py(wt){if(!wt)return;const st=[];return bt(wt.step)||st.push(new Yl(wt.step)),bt(wt.max)&&bt(wt.min)||st.push(new Hs({max:wt.max,min:wt.min})),new yo(st)}function Em(wt,st){return{baseStep:dv(st),constraint:st,textProps:Bn.fromObject({draggingScale:P_(st,wt),formatter:El(yA(st,wt))})}}const cp={id:"input-point3d",type:"input",accept:(wt,st)=>{if(!Su.isObject(wt))return null;const dt=ur,It=nr(st,{x:dt.optional.custom(zm),y:dt.optional.custom(zm),z:dt.optional.custom(zm)});return It?{initialValue:wt,params:It}:null},binding:{reader:wt=>Ep,constraint:wt=>{return st=wt.params,new bp({assembly:R0,components:[Py("x"in st?st.x:void 0),Py("y"in st?st.y:void 0),Py("z"in st?st.z:void 0)]});var st},equals:Su.equals,writer:wt=>Ow},controller:wt=>{const st=wt.value,dt=wt.constraint;if(!(dt instanceof bp))throw qt.shouldNeverHappen();return new F_(wt.document,{assembly:R0,axes:[Em(st.rawValue.x,dt.components[0]),Em(st.rawValue.y,dt.components[1]),Em(st.rawValue.z,dt.components[2])],parser:_u,value:st,viewProps:wt.viewProps})}};class yv{constructor(st=0,dt=0,It=0,Zt=0){this.x=st,this.y=dt,this.z=It,this.w=Zt}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(st){if(bt(st))return!1;const dt=st.x,It=st.y,Zt=st.z,bn=st.w;return typeof dt=="number"&&typeof It=="number"&&typeof Zt=="number"&&typeof bn=="number"}static equals(st,dt){return st.x===dt.x&&st.y===dt.y&&st.z===dt.z&&st.w===dt.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const U_={toComponents:wt=>wt.getComponents(),fromComponents:wt=>new yv(...wt)};function Nu(wt){return yv.isObject(wt)?new yv(wt.x,wt.y,wt.z,wt.w):new yv}function Op(wt,st){wt.writeProperty("x",st.x),wt.writeProperty("y",st.y),wt.writeProperty("z",st.z),wt.writeProperty("w",st.w)}function _h(wt){if(!wt)return;const st=[];return bt(wt.step)||st.push(new Yl(wt.step)),bt(wt.max)&&bt(wt.min)||st.push(new Hs({max:wt.max,min:wt.min})),new yo(st)}const Gm={id:"input-point4d",type:"input",accept:(wt,st)=>{if(!yv.isObject(wt))return null;const dt=ur,It=nr(st,{x:dt.optional.custom(zm),y:dt.optional.custom(zm),z:dt.optional.custom(zm),w:dt.optional.custom(zm)});return It?{initialValue:wt,params:It}:null},binding:{reader:wt=>Nu,constraint:wt=>{return st=wt.params,new bp({assembly:U_,components:[_h("x"in st?st.x:void 0),_h("y"in st?st.y:void 0),_h("z"in st?st.z:void 0),_h("w"in st?st.w:void 0)]});var st},equals:yv.equals,writer:wt=>Op},controller:wt=>{const st=wt.value,dt=wt.constraint;if(!(dt instanceof bp))throw qt.shouldNeverHappen();return new F_(wt.document,{assembly:U_,axes:st.rawValue.getComponents().map((It,Zt)=>{return bn=It,{baseStep:dv(Rn=dt.components[Zt]),constraint:Rn,textProps:Bn.fromObject({draggingScale:P_(Rn,bn),formatter:El(yA(Rn,bn))})};var bn,Rn}),parser:_u,value:st,viewProps:wt.viewProps})}},DA={id:"input-string",type:"input",accept:(wt,st)=>{if(typeof wt!="string")return null;const dt=nr(st,{options:ur.optional.custom(b0)});return dt?{initialValue:wt,params:dt}:null},binding:{reader:wt=>v1,constraint:wt=>function(st){const dt=[],It=zl(st.options);return It&&dt.push(It),new yo(dt)}(wt.params),writer:wt=>Wv},controller:wt=>{var st;const dt=wt.document,It=wt.value,Zt=wt.constraint;return Zt&&Dl(Zt,Lo)?new Io(dt,{props:Bn.fromObject({options:(st=_A(Zt))!==null&&st!==void 0?st:[]}),value:It,viewProps:wt.viewProps}):new Ao(dt,{parser:bn=>bn,props:Bn.fromObject({formatter:S_}),value:It,viewProps:wt.viewProps})}},Jv={defaultInterval:200,defaultLineCount:3},Dy=nn("mll");class j_{constructor(st,dt){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=dt.formatter,this.element=st.createElement("div"),this.element.classList.add(Dy()),dt.viewProps.bindClassModifiers(this.element);const It=st.createElement("textarea");It.classList.add(Dy("i")),It.style.height=`calc(var(--bld-us) * ${dt.lineCount})`,It.readOnly=!0,dt.viewProps.bindDisabled(It),this.element.appendChild(It),this.textareaElem_=It,dt.value.emitter.on("change",this.onValueUpdate_),this.value=dt.value,this.update_()}update_(){const st=this.textareaElem_,dt=st.scrollTop===st.scrollHeight-st.clientHeight,It=[];this.value.rawValue.forEach(Zt=>{Zt!==void 0&&It.push(this.formatter_(Zt))}),st.textContent=It.join(`
`),dt&&(st.scrollTop=st.scrollHeight)}onValueUpdate_(){this.update_()}}class Zv{constructor(st,dt){this.value=dt.value,this.viewProps=dt.viewProps,this.view=new j_(st,{formatter:dt.formatter,lineCount:dt.lineCount,value:this.value,viewProps:this.viewProps})}}const RA=nn("sgl");class Lw{constructor(st,dt){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=dt.formatter,this.element=st.createElement("div"),this.element.classList.add(RA()),dt.viewProps.bindClassModifiers(this.element);const It=st.createElement("input");It.classList.add(RA("i")),It.readOnly=!0,It.type="text",dt.viewProps.bindDisabled(It),this.element.appendChild(It),this.inputElement=It,dt.value.emitter.on("change",this.onValueUpdate_),this.value=dt.value,this.update_()}update_(){const st=this.value.rawValue,dt=st[st.length-1];this.inputElement.value=dt!==void 0?this.formatter_(dt):""}onValueUpdate_(){this.update_()}}class no{constructor(st,dt){this.value=dt.value,this.viewProps=dt.viewProps,this.view=new Lw(st,{formatter:dt.formatter,value:this.value,viewProps:this.viewProps})}}const im={id:"monitor-bool",type:"monitor",accept:(wt,st)=>{if(typeof wt!="boolean")return null;const dt=nr(st,{lineCount:ur.optional.number});return dt?{initialValue:wt,params:dt}:null},binding:{reader:wt=>so},controller:wt=>{var st;return wt.value.rawValue.length===1?new no(wt.document,{formatter:op,value:wt.value,viewProps:wt.viewProps}):new Zv(wt.document,{formatter:op,lineCount:(st=wt.params.lineCount)!==null&&st!==void 0?st:Jv.defaultLineCount,value:wt.value,viewProps:wt.viewProps})}};class Hm{constructor(){this.emitter=new Kt,this.index_=-1}get index(){return this.index_}set index(st){this.index_!==st&&(this.index_=st,this.emitter.emit("change",{index:st,sender:this}))}}const up=nn("grl");class Sm{constructor(st,dt){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=st.createElement("div"),this.element.classList.add(up()),dt.viewProps.bindClassModifiers(this.element),this.formatter_=dt.formatter,this.minValue_=dt.minValue,this.maxValue_=dt.maxValue,this.cursor_=dt.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const It=st.createElementNS(sn,"svg");It.classList.add(up("g")),It.style.height=`calc(var(--bld-us) * ${dt.lineCount})`,this.element.appendChild(It),this.svgElem_=It;const Zt=st.createElementNS(sn,"polyline");this.svgElem_.appendChild(Zt),this.lineElem_=Zt;const bn=st.createElement("div");bn.classList.add(up("t"),nn("tt")()),this.element.appendChild(bn),this.tooltipElem_=bn,dt.value.emitter.on("change",this.onValueUpdate_),this.value=dt.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const st=this.svgElem_.getBoundingClientRect(),dt=this.value.rawValue.length-1,It=this.minValue_,Zt=this.maxValue_,bn=[];this.value.rawValue.forEach((Ts,ps)=>{if(Ts===void 0)return;const Cl=wo(ps,0,dt,0,st.width),iu=wo(Ts,It,Zt,st.height,0);bn.push([Cl,iu].join(","))}),this.lineElem_.setAttributeNS(null,"points",bn.join(" "));const Rn=this.tooltipElem_,dr=this.value.rawValue[this.cursor_.index];if(dr===void 0)return void Rn.classList.remove(up("t","a"));const Dr=wo(this.cursor_.index,0,dt,0,st.width),ys=wo(dr,It,Zt,st.height,0);Rn.style.left=`${Dr}px`,Rn.style.top=`${ys}px`,Rn.textContent=`${this.formatter_(dr)}`,Rn.classList.contains(up("t","a"))||(Rn.classList.add(up("t","a"),up("t","in")),qn(Rn),Rn.classList.remove(up("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class sm{constructor(st,dt){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.value=dt.value,this.viewProps=dt.viewProps,this.cursor_=new Hm,this.view=new Sm(st,{cursor:this.cursor_,formatter:dt.formatter,lineCount:dt.lineCount,maxValue:dt.maxValue,minValue:dt.minValue,value:this.value,viewProps:this.viewProps}),Kn(st)){const It=new Bu(this.view.element);It.emitter.on("down",this.onGraphPointerDown_),It.emitter.on("move",this.onGraphPointerMove_),It.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}onGraphMouseLeave_(){this.cursor_.index=-1}onGraphMouseMove_(st){const dt=this.view.element.getBoundingClientRect();this.cursor_.index=Math.floor(wo(st.offsetX,0,dt.width,0,this.value.rawValue.length))}onGraphPointerDown_(st){this.onGraphPointerMove_(st)}onGraphPointerMove_(st){st.data.point?this.cursor_.index=Math.floor(wo(st.data.point.x,0,st.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.index=-1}onGraphPointerUp_(){this.cursor_.index=-1}}function om(wt){return"format"in wt&&!bt(wt.format)?wt.format:El(2)}function kA(wt){return"view"in wt&&wt.view==="graph"}const k0={id:"monitor-number",type:"monitor",accept:(wt,st)=>{if(typeof wt!="number")return null;const dt=ur,It=nr(st,{format:dt.optional.function,lineCount:dt.optional.number,max:dt.optional.number,min:dt.optional.number,view:dt.optional.string});return It?{initialValue:wt,params:It}:null},binding:{defaultBufferSize:wt=>kA(wt)?64:1,reader:wt=>Xp},controller:wt=>kA(wt.params)?function(st){var dt,It,Zt;return new sm(st.document,{formatter:om(st.params),lineCount:(dt=st.params.lineCount)!==null&&dt!==void 0?dt:Jv.defaultLineCount,maxValue:(It="max"in st.params?st.params.max:null)!==null&&It!==void 0?It:100,minValue:(Zt="min"in st.params?st.params.min:null)!==null&&Zt!==void 0?Zt:0,value:st.value,viewProps:st.viewProps})}(wt):function(st){var dt;return st.value.rawValue.length===1?new no(st.document,{formatter:om(st.params),value:st.value,viewProps:st.viewProps}):new Zv(st.document,{formatter:om(st.params),lineCount:(dt=st.params.lineCount)!==null&&dt!==void 0?dt:Jv.defaultLineCount,value:st.value,viewProps:st.viewProps})}(wt)},BA={id:"monitor-string",type:"monitor",accept:(wt,st)=>{if(typeof wt!="string")return null;const dt=ur,It=nr(st,{lineCount:dt.optional.number,multiline:dt.optional.boolean});return It?{initialValue:wt,params:It}:null},binding:{reader:wt=>v1},controller:wt=>{var st;const dt=wt.value;return dt.rawValue.length>1||"multiline"in wt.params&&wt.params.multiline?new Zv(wt.document,{formatter:S_,lineCount:(st=wt.params.lineCount)!==null&&st!==void 0?st:Jv.defaultLineCount,value:dt,viewProps:wt.viewProps}):new no(wt.document,{formatter:S_,value:dt,viewProps:wt.viewProps})}};class e_{constructor(st){this.onValueChange_=this.onValueChange_.bind(this),this.reader=st.reader,this.writer=st.writer,this.emitter=new Kt,this.value=st.value,this.value.emitter.on("change",this.onValueChange_),this.target=st.target,this.read()}read(){const st=this.target.read();st!==void 0&&(this.value.rawValue=this.reader(st))}write_(st){this.writer(this.target,st)}onValueChange_(st){this.write_(st.rawValue),this.emitter.emit("change",{options:st.options,rawValue:st.rawValue,sender:this})}}class Fu{constructor(st){this.onTick_=this.onTick_.bind(this),this.reader_=st.reader,this.target=st.target,this.emitter=new Kt,this.value=st.value,this.ticker=st.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const st=this.target.read();if(st===void 0)return;const dt=this.value.rawValue,It=this.reader_(st);this.value.rawValue=function(Zt,bn){const Rn=[...Tw(Zt),bn];return Rn.length>Zt.length?Rn.splice(0,Rn.length-Zt.length):Am(Rn,Zt.length),Rn}(dt,It),this.emitter.emit("update",{rawValue:It,sender:this})}onTick_(st){this.read()}}function x1(wt,st){return st===0?new Zl:new xl(wt,st??Jv.defaultInterval)}class Uu{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(st){st.type==="blade"?this.pluginsMap_.blades.unshift(st):st.type==="input"?this.pluginsMap_.inputs.unshift(st):st.type==="monitor"&&this.pluginsMap_.monitors.unshift(st)}createInput(st,dt,It){if(bt(dt.read()))throw new qt({context:{key:dt.key},type:"nomatchingcontroller"});const Zt=this.pluginsMap_.inputs.reduce((bn,Rn)=>bn||function(dr,Dr){const ys=dr.accept(Dr.target.read(),Dr.params);if(bt(ys))return null;const Ts=ur,ps={target:Dr.target,initialValue:ys.initialValue,params:ys.params},Cl=dr.binding.reader(ps),iu=dr.binding.constraint?dr.binding.constraint(ps):void 0,cm=hn(Cl(ys.initialValue),{constraint:iu,equals:dr.binding.equals}),_d=new e_({reader:Cl,target:Dr.target,value:cm,writer:dr.binding.writer(ps)}),Lp=Ts.optional.boolean(Dr.params.disabled).value,Cm=Ts.optional.boolean(Dr.params.hidden).value,z_=dr.controller({constraint:iu,document:Dr.document,initialValue:ys.initialValue,params:ys.params,value:_d.value,viewProps:Wr.create({disabled:Lp,hidden:Cm})}),t_=Ts.optional.string(Dr.params.label).value;return new So(Dr.document,{binding:_d,blade:io(),props:Bn.fromObject({label:t_||Dr.target.key}),valueController:z_})}(Rn,{document:st,target:dt,params:It}),null);if(Zt)return Zt;throw new qt({context:{key:dt.key},type:"nomatchingcontroller"})}createMonitor(st,dt,It){const Zt=this.pluginsMap_.monitors.reduce((bn,Rn)=>bn||function(dr,Dr){var ys,Ts,ps;const Cl=ur,iu=dr.accept(Dr.target.read(),Dr.params);if(bt(iu))return null;const cm={target:Dr.target,initialValue:iu.initialValue,params:iu.params},_d=dr.binding.reader(cm),Lp=(Ts=(ys=Cl.optional.number(Dr.params.bufferSize).value)!==null&&ys!==void 0?ys:dr.binding.defaultBufferSize&&dr.binding.defaultBufferSize(iu.params))!==null&&Ts!==void 0?Ts:1,Cm=Cl.optional.number(Dr.params.interval).value,z_=new Fu({reader:_d,target:Dr.target,ticker:x1(Dr.document,Cm),value:mo(Lp)}),t_=Cl.optional.boolean(Dr.params.disabled).value,L0=Cl.optional.boolean(Dr.params.hidden).value,Ry=dr.controller({document:Dr.document,params:iu.params,value:z_.value,viewProps:Wr.create({disabled:t_,hidden:L0})}),ky=(ps=Cl.optional.string(Dr.params.label).value)!==null&&ps!==void 0?ps:Dr.target.key;return new Mo(Dr.document,{binding:z_,blade:io(),props:Bn.fromObject({label:ky}),valueController:Ry})}(Rn,{document:st,params:It,target:dt}),null);if(Zt)return Zt;throw new qt({context:{key:dt.key},type:"nomatchingcontroller"})}createBlade(st,dt){const It=this.pluginsMap_.blades.reduce((Zt,bn)=>Zt||function(Rn,dr){const Dr=Rn.accept(dr.params);if(!Dr)return null;const ys=ur.optional.boolean(dr.params.disabled).value,Ts=ur.optional.boolean(dr.params.hidden).value;return Rn.controller({blade:io(),document:dr.document,params:Object.assign(Object.assign({},Dr.params),{disabled:ys,hidden:Ts}),viewProps:Wr.create({disabled:ys,hidden:Ts})})}(bn,{document:st,params:dt}),null);if(!It)throw new qt({type:"nomatchingview",context:{params:dt}});return It}createBladeApi(st){if(st instanceof So)return new Qs(st);if(st instanceof Mo)return new _l(st);if(st instanceof Yu)return new Wl(st,this);const dt=this.pluginsMap_.blades.reduce((It,Zt)=>It||Zt.api({controller:st,pool:this}),null);if(!dt)throw qt.shouldNeverHappen();return dt}}class Wm extends d{constructor(st){super(st),this.emitter_=new Kt,this.controller_.valueController.value.emitter.on("change",dt=>{this.emitter_.emit("change",{event:new at(this,dt.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(st){this.controller_.props.set("label",st)}get options(){return this.controller_.valueController.props.get("options")}set options(st){this.controller_.valueController.props.set("options",st)}get value(){return this.controller_.valueController.value.rawValue}set value(st){this.controller_.valueController.value.rawValue=st}on(st,dt){const It=dt.bind(this);return this.emitter_.on(st,Zt=>{It(Zt.event)}),this}}class _c extends d{constructor(st){super(st),this.emitter_=new Kt,this.controller_.valueController.value.emitter.on("change",dt=>{this.emitter_.emit("change",{event:new at(this,dt.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(st){this.controller_.props.set("label",st)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(st){this.controller_.valueController.sliderController.props.set("maxValue",st)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(st){this.controller_.valueController.sliderController.props.set("minValue",st)}get value(){return this.controller_.valueController.value.rawValue}set value(st){this.controller_.valueController.value.rawValue=st}on(st,dt){const It=dt.bind(this);return this.emitter_.on(st,Zt=>{It(Zt.event)}),this}}class am extends d{constructor(st){super(st),this.emitter_=new Kt,this.controller_.valueController.value.emitter.on("change",dt=>{this.emitter_.emit("change",{event:new at(this,dt.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(st){this.controller_.props.set("label",st)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(st){this.controller_.valueController.props.set("formatter",st)}get value(){return this.controller_.valueController.value.rawValue}set value(st){this.controller_.valueController.value.rawValue=st}on(st,dt){const It=dt.bind(this);return this.emitter_.on(st,Zt=>{It(Zt.event)}),this}}const $o={id:"list",type:"blade",accept(wt){const st=ur,dt=nr(wt,{options:st.required.custom(b0),value:st.required.raw,view:st.required.constant("list"),label:st.optional.string});return dt?{params:dt}:null},controller(wt){const st=new Io(wt.document,{props:Bn.fromObject({options:I_(wt.params.options)}),value:hn(wt.params.value),viewProps:wt.viewProps});return new Jl(wt.document,{blade:wt.blade,props:Bn.fromObject({label:wt.params.label}),valueController:st})},api:wt=>wt.controller instanceof Jl&&wt.controller.valueController instanceof Io?new Wm(wt.controller):null};class B0 extends Oo{constructor(st,dt){super(st,dt)}get element(){return this.controller_.view.element}importPreset(st){(function(dt,It){dt.forEach(Zt=>{const bn=It[Zt.presetKey];bn!==void 0&&Zt.write(bn)})})(this.controller_.rackController.rack.find(So).map(dt=>dt.binding.target),st),this.refresh()}exportPreset(){return this.controller_.rackController.rack.find(So).map(st=>st.binding.target).reduce((st,dt)=>Object.assign(st,{[dt.presetKey]:dt.read()}),{})}refresh(){this.controller_.rackController.rack.find(So).forEach(st=>{st.binding.read()}),this.controller_.rackController.rack.find(Mo).forEach(st=>{st.binding.read()})}}class lm extends To{constructor(st,dt){super(st,{expanded:dt.expanded,blade:dt.blade,props:dt.props,root:!0,viewProps:dt.viewProps})}}const O0={id:"slider",type:"blade",accept(wt){const st=ur,dt=nr(wt,{max:st.required.number,min:st.required.number,view:st.required.constant("slider"),format:st.optional.function,label:st.optional.string,value:st.optional.number});return dt?{params:dt}:null},controller(wt){var st,dt;const It=(st=wt.params.value)!==null&&st!==void 0?st:0,Zt=new $p(wt.document,{baseStep:1,parser:_u,sliderProps:Bn.fromObject({maxValue:wt.params.max,minValue:wt.params.min}),textProps:Bn.fromObject({draggingScale:P_(void 0,It),formatter:(dt=wt.params.format)!==null&&dt!==void 0?dt:E_}),value:hn(It),viewProps:wt.viewProps});return new Jl(wt.document,{blade:wt.blade,props:Bn.fromObject({label:wt.params.label}),valueController:Zt})},api:wt=>wt.controller instanceof Jl&&wt.controller.valueController instanceof $p?new _c(wt.controller):null},hp={id:"text",type:"blade",accept(wt){const st=ur,dt=nr(wt,{parse:st.required.function,value:st.required.raw,view:st.required.constant("text"),format:st.optional.function,label:st.optional.string});return dt?{params:dt}:null},controller(wt){var st;const dt=new Ao(wt.document,{parser:wt.params.parse,props:Bn.fromObject({formatter:(st=wt.params.format)!==null&&st!==void 0?st:It=>String(It)}),value:hn(wt.params.value),viewProps:wt.viewProps});return new Jl(wt.document,{blade:wt.blade,props:Bn.fromObject({label:wt.params.label}),valueController:dt})},api:wt=>wt.controller instanceof Jl&&wt.controller.valueController instanceof Ao?new am(wt.controller):null};function Ql(wt,st,dt){if(wt.querySelector(`style[data-tp-style=${st}]`))return;const It=wt.createElement("style");It.dataset.tpStyle=st,It.textContent=dt,wt.head.appendChild(It)}const Nw=new class{constructor(wt){const[st,dt]=wt.split("-"),It=st.split(".");this.major=parseInt(It[0],10),this.minor=parseInt(It[1],10),this.patch=parseInt(It[2],10),this.prerelease=dt??null}toString(){const wt=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[wt,this.prerelease].join("-"):wt}}("3.0.8");j.BladeApi=d,j.ButtonApi=jt,j.FolderApi=Oo,j.InputBindingApi=Qs,j.ListApi=Wm,j.MonitorBindingApi=_l,j.Pane=class extends B0{constructor(wt){var st;const dt=wt||{},It=(st=dt.document)!==null&&st!==void 0?st:wr(),Zt=function(){const bn=new Uu;return[_v,cp,Gm,DA,xo,Xv,bm,vv,y1,im,BA,k0,us,Gs,Pl,Ko].forEach(Rn=>{bn.register(Rn)}),bn}();super(new lm(It,{expanded:dt.expanded,blade:io(),props:Bn.fromObject({title:dt.title}),viewProps:Wr.create()}),Zt),this.pool_=Zt,this.containerElem_=dt.container||function(bn){const Rn=bn.createElement("div");return Rn.classList.add(nn("dfw")()),bn.body&&bn.body.appendChild(Rn),Rn}(It),this.containerElem_.appendChild(this.element),this.doc_=It,this.usesDefaultWrapper_=!dt.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw qt.alreadyDisposed();return this.doc_}dispose(){const wt=this.containerElem_;if(!wt)throw qt.alreadyDisposed();if(this.usesDefaultWrapper_){const st=wt.parentElement;st&&st.removeChild(wt)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(wt){("plugin"in wt?[wt.plugin]:"plugins"in wt?wt.plugins:[]).forEach(st=>{this.pool_.register(st),this.embedPluginStyle_(st)})}embedPluginStyle_(wt){wt.css&&Ql(this.document,`plugin-${wt.id}`,wt.css)}setUpDefaultPlugins_(){Ql(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor transparent;scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:transparent}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:transparent solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #28292e);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #28292e);--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i,.tp-fldv_c>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(wt=>{this.embedPluginStyle_(wt)}),this.registerPlugin({plugins:[O0,$o,Ko,hp]})}},j.SeparatorApi=Xu,j.SliderApi=_c,j.TabApi=eo,j.TabPageApi=vs,j.TextApi=am,j.TpChangeEvent=at,j.VERSION=Nw,Object.defineProperty(j,"__esModule",{value:!0})})(g)},23:function(__unused_webpack_module,__webpackgi_exports__,__webpackgi_require__){__webpackgi_require__.d(__webpackgi_exports__,{Q:function(){return DRACOLoader2}});var three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__=__webpackgi_require__(553),three__WEBPACK_IMPORTED_MODULE_1__=__webpackgi_require__(988);class DRACOLoader2 extends three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__._{constructor(b){super(b),this.encoderPending=null,this.encoderConfig={type:"js"},this.setDecoderPath("https://cdn.jsdelivr.net/gh/google/draco@1.4.1/javascript/"),this.setDecoderConfig({type:"js"})}async loadAsync(b,g){const j=await super.loadAsync(b,g);return j?new three__WEBPACK_IMPORTED_MODULE_1__.Kj0(j,new three__WEBPACK_IMPORTED_MODULE_1__.Wid):void 0}preload(b=!0,g=!1){return b&&super.preload(),g&&this.initEncoder(),this}async initEncoder(){if(this.encoderPending)return this.encoderPending;const useJS=typeof WebAssembly!="object"||this.encoderConfig.type==="js",librariesPending=[],libLoader=this._loadLibrary.bind(this);return useJS?librariesPending.push(libLoader("draco_encoder.js","text")):(librariesPending.push(libLoader("draco_wasm_wrapper.js","text")),librariesPending.push(libLoader("draco_encoder.wasm","arraybuffer"))),this.encoderPending=Promise.all(librariesPending).then(libraries=>{var _a;const jsContent=libraries[0];return useJS||(this.encoderConfig.wasmBinary=libraries[1]),(_a=eval(jsContent+`
DracoEncoderModule;`))===null||_a===void 0?void 0:_a()}),this.encoderPending}async initDecoder(){var _a;await this._initDecoder();const jsContent=await fetch(this.workerSourceURL).then(async b=>b.text()).then(b=>{const g=b.indexOf("/* worker */");if(g<1)throw new Error("unable to load decoder module");return b.substring(0,g-1)});return(_a=eval(jsContent+`
DracoDecoderModule;`))===null||_a===void 0?void 0:_a()}}},87:function(){},263:function(){},988:function(b,g,j){j.d(g,{$TI:function(){return RE},$V:function(){return yP},$Vf:function(){return iI},$YQ:function(){return tC},A5E:function(){return uw},AHu:function(){return jx},AXT:function(){return ax},Aip:function(){return cI},B02:function(){return kt},BFQ:function(){return Lo},BG$:function(){return Ap},BKK:function(){return pw},BVF:function(){return wr},BVQ:function(){return cx},BbS:function(){return a0},Bf4:function(){return Mo},BtG:function(){return NA},CJI:function(){return Fu},CN8:function(){return tI},CP7:function(){return ou},CaW:function(){return Jr},CdI:function(){return ks},Cne:function(){return GC},CtA:function(){return xl},CtF:function(){return e0},D1R:function(){return oo},D9w:function(){return Ko},DT1:function(){return zx},Djp:function(){return Ku},DqL:function(){return Up},DvJ:function(){return qm},E2K:function(){return yo},EB7:function(){return ox},EJi:function(){return xC},EoG:function(){return io},F5T:function(){return Uu},FDw:function(){return To},FE5:function(){return np},FIo:function(){return LT},FM8:function(){return Rr},FT0:function(){return EC},FUD:function(){return Qv},FvO:function(){return rp},GG6:function(){return w_},GQ:function(){return Zm},GUF:function(){return wo},GVz:function(){return w1},GZb:function(){return sI},Gih:function(){return Vv},Gql:function(){return RC},H$k:function(){return qy},HTd:function(){return Dp},HW6:function(){return lI},HgB:function(){return E0},HkE:function(){return eC},Hmr:function(){return Px},Hw6:function(){return B_},Hy8:function(){return Yn},Hyl:function(){return Mv},IEO:function(){return WA},IFH:function(){return El},IKL:function(){return NT},ILR:function(){return Yl},IOt:function(){return Ru},Ilk:function(){return is},Inb:function(){return C_},Ir4:function(){return P_},JOQ:function(){return V_},JQ4:function(){return jn},JUT:function(){return O_},JWc:function(){return yA},KI_:function(){return Bu},Kgo:function(){return ux},KhW:function(){return sr},Kj0:function(){return ju},Kz5:function(){return xu},L5g:function(){return ry},L5s:function(){return _m},LBq:function(){return XT},LSk:function(){return pv},LY2:function(){return Vs},L_r:function(){return wA},Lcc:function(){return ev},LgE:function(){return Tw},LgZ:function(){return hr},LsT:function(){return Pu},Ltg:function(){return Fo},Lun:function(){return VA},M5h:function(){return en},M6v:function(){return Lr},M8C:function(){return xA},Mig:function(){return VT},MyG:function(){return Pw},N$j:function(){return iC},N4l:function(){return on},NDo:function(){return us},NMF:function(){return w0},NYV:function(){return Yp},Ns1:function(){return ls},NwF:function(){return Jm},Ny0:function(){return sE},O7d:function(){return gx},OAl:function(){return Wv},OM3:function(){return It},OTo:function(){return Al},OdW:function(){return ex},OoA:function(){return Wl},Ox3:function(){return zT},PA7:function(){return ku},PMe:function(){return PC},Pa4:function(){return An},PeU:function(){return ht},Pnf:function(){return _u},PpQ:function(){return Ty},QM0:function(){return dv},QRU:function(){return kC},QZ1:function(){return _A},QmN:function(){return at},Qpg:function(){return ZT},R2R:function(){return J_},REq:function(){return dw},RNb:function(){return B0},ROQ:function(){return dC},RSm:function(){return Ax},Rki:function(){return eI},RlZ:function(){return Kn},RsA:function(){return nt},RvT:function(){return b0},S2y:function(){return bt},S3k:function(){return nw},S9g:function(){return cp},SJI:function(){return qT},SPe:function(){return J1},SUY:function(){return CE},Se2:function(){return Gn},Sm8:function(){return hn},So8:function(){return BC},SvJ:function(){return No},Syv:function(){return b_},T95:function(){return Jl},TOt:function(){return hE},TUj:function(){return AP},TUv:function(){return rC},T_1:function(){return FE},T_J:function(){return Ul},T__:function(){return IT},T_f:function(){return QT},TlE:function(){return $o},Tme:function(){return no},Tn7:function(){return mE},TyD:function(){return Oo},U7:function(){return mC},UCm:function(){return ss},USm:function(){return Em},UY4:function(){return tE},UZH:function(){return d},Uk6:function(){return OT},UlW:function(){return v1},Uol:function(){return K_},V1s:function(){return LA},V4E:function(){return aI},VLJ:function(){return jC},VYz:function(){return YT},Vdb:function(){return sn},Vj0:function(){return um},Vkp:function(){return Ou},VzW:function(){return Pl},W2J:function(){return I_},WMw:function(){return Ht},WTc:function(){return lm},WXh:function(){return _x},Wbm:function(){return Gt},WdD:function(){return ao},Wid:function(){return wC},Wjw:function(){return UE},Wl3:function(){return Kt},Wpd:function(){return qn},Wqd:function(){return vC},WwZ:function(){return Gv},Wzm:function(){return sx},XZw:function(){return fw},Xaj:function(){return cn},Xcj:function(){return OC},XvJ:function(){return K0},Y8D:function(){return vs},YBo:function(){return bC},YGz:function(){return er},YKA:function(){return mA},YLQ:function(){return yl},YN5:function(){return rI},YT8:function(){return PT},Ywn:function(){return SA},Z6B:function(){return IS},ZAu:function(){return H_},ZQ6:function(){return X_},ZRs:function(){return Kp},ZZA:function(){return xx},Zp0:function(){return c_},Zr5:function(){return rn},ZzF:function(){return L_},Zzh:function(){return $T},_12:function(){return j0},_3:function(){return QC},_AM:function(){return Ho},_C8:function(){return Yy},_Li:function(){return Ft},_MY:function(){return Vt},_YM:function(){return $_},_YX:function(){return Lx},_am:function(){return PS},_fP:function(){return Lu},_iA:function(){return qt},_kC:function(){return a_},_lf:function(){return Xp},_sL:function(){return E_},a$l:function(){return dt},aCh:function(){return M_},aH4:function(){return co},aLr:function(){return nm},aNw:function(){return Vu},aVm:function(){return hp},ad5:function(){return bu},anP:function(){return I1},aq0:function(){return Fx},av9:function(){return Zl},b5g:function(){return nC},bGH:function(){return Ut},b_z:function(){return Rl},bdR:function(){return Nt},blk:function(){return qA},bnF:function(){return Gy},brP:function(){return to},bsb:function(){return hv},c8b:function(){return Bn},cBI:function(){return c0},cBK:function(){return MC},cJO:function(){return ZA},cLu:function(){return pu},cPb:function(){return ep},cRx:function(){return eo},cU9:function(){return CC},ce8:function(){return vA},cek:function(){return jT},cum:function(){return zm},dSO:function(){return _l},dUE:function(){return Z_},dYG:function(){return gE},dZ3:function(){return Ll},dd2:function(){return xp},dj0:function(){return zl},dpR:function(){return TC},dwk:function(){return jt},e62:function(){return st},eD:function(){return kn},eMJ:function(){return Iw},eaV:function(){return Io},ehD:function(){return nn},ejS:function(){return o_},ekQ:function(){return Qo},epp:function(){return Zu},fHI:function(){return zu},fO1:function(){return hC},fQA:function(){return LE},fQK:function(){return G1},fSK:function(){return zn},fY$:function(){return Qs},fto:function(){return qp},g8_:function(){return Bo},gH0:function(){return Ox},gSk:function(){return gA},g_z:function(){return lx},ghN:function(){return ar},gi4:function(){return op},gti:function(){return gC},hEm:function(){return xa},hH6:function(){return n0},iAb:function(){return Xu},iDF:function(){return Pv},iKG:function(){return S1},iLg:function(){return vm},iMs:function(){return kE},iUV:function(){return Po},iWC:function(){return ur},iWj:function(){return zw},i_9:function(){return EE},iiP:function(){return Wo},irR:function(){return Wr},j4z:function(){return _1},j87:function(){return Nw},jAl:function(){return wp},jFi:function(){return Lt},jZA:function(){return Ao},jfJ:function(){return Hv},jwo:function(){return Dw},jyi:function(){return K1},jyz:function(){return Av},k0A:function(){return Ds},k74:function(){return nr},kB5:function(){return r_},kFz:function(){return _f},kaV:function(){return wx},knz:function(){return mo},kqm:function(){return ey},ksN:function(){return Cr},l0P:function(){return Xr},l8J:function(){return AA},lCJ:function(){return wt},lDi:function(){return Ix},lLk:function(){return t0},lRF:function(){return $w},lRj:function(){return Rp},lb7:function(){return Vy},lfu:function(){return SC},lk7:function(){return wE},m7l:function(){return Ex},mSO:function(){return x0},mTL:function(){return vP},mXe:function(){return uE},m_w:function(){return Zy},mzJ:function(){return $y},nls:function(){return Np},ntZ:function(){return zt},nvb:function(){return nI},o8S:function(){return Wy},oAp:function(){return BM},oa8:function(){return vx},oqc:function(){return T_},p3g:function(){return T0},p7A:function(){return VC},p7y:function(){return Xl},pBf:function(){return Fs},pIN:function(){return Du},pKu:function(){return fA},pQR:function(){return pp},ptH:function(){return vu},qhX:function(){return Rs},qkB:function(){return Vo},qlB:function(){return Ql},qyh:function(){return Yu},rAo:function(){return O0},rBU:function(){return Zr},rDY:function(){return kM},rOj:function(){return $t},r_:function(){return un},rnI:function(){return Am},rpg:function(){return _o},s4_:function(){return GT},sYA:function(){return Sx},tEQ:function(){return Xy},tGC:function(){return h_},tJx:function(){return NE},tUh:function(){return Dv},tf:function(){return Rx},tm_:function(){return _t},trn:function(){return hw},u37:function(){return Ky},u7G:function(){return i0},u9r:function(){return ps},uEv:function(){return x_},uL9:function(){return ws},uWy:function(){return fo},uXU:function(){return $u},ujx:function(){return oI},v3W:function(){return Hs},v9Y:function(){return y1},vBJ:function(){return Wm},vCF:function(){return dn},vCx:function(){return Fl},vZf:function(){return gu},vmT:function(){return UT},vpT:function(){return W1},vxC:function(){return So},w$m:function(){return Ar},wJv:function(){return os},wem:function(){return zo},wk1:function(){return Ls},woe:function(){return iE},wuA:function(){return Dl},x12:function(){return s_},x5V:function(){return Go},xEZ:function(){return yu},xG9:function(){return JT},xJs:function(){return Ws},xWb:function(){return ty},xeV:function(){return q1},xfE:function(){return Nl},xo$:function(){return ew},xoR:function(){return yx},xsS:function(){return yT},y$t:function(){return KA},y2t:function(){return so},y8_:function(){return cw},yC1:function(){return tw},yGw:function(){return Us},ybr:function(){return QA},yj7:function(){return fC},ylh:function(){return ow},yo9:function(){return Q0},yt0:function(){return $p},ywz:function(){return Gs},yxD:function(){return r0},z$h:function(){return S_},z81:function(){return ap},z8B:function(){return HA},zHn:function(){return $v},zbs:function(){return bx},zf8:function(){return Tm},zob:function(){return h0}});const d="144dev",nt={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},at={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},ht=0,_t=1,bt=2,kt=3,Vt=0,qt=1,zt=2,jt=3,Kt=0,Ft=1,nn=2,Lt=0,Nt=1,Ht=2,on=3,en=4,cn=5,Ut=100,Gt=101,$t=102,un=103,hn=104,Bn=200,ar=201,sr=202,ur=203,nr=204,hr=205,zn=206,Yn=207,sn=208,qn=209,Kn=210,wr=0,Gn=1,rn=2,dn=3,kn=4,Cr=5,Ar=6,Lr=7,ls=0,Rs=1,us=2,ws=0,io=1,ks=2,er=3,Vs=4,Ll=5,Nl=300,Qs=301,So=302,_l=303,Mo=304,Bo=306,_o=1e3,fo=1001,Wl=1002,Oo=1003,yl=1004,Dp=1004,co=1005,gu=1005,zo=1006,Yu=1007,Rp=1007,oo=1008,To=1008,Gs=1009,Jl=1010,Xu=1011,Pu=1012,xu=1013,jn=1014,Pl=1015,pu=1016,Ds=1017,Wr=1018,os=1020,Al=1021,ss=1022,Ls=1023,vs=1024,eo=1025,Vo=1026,to=1027,xa=1028,Ko=1029,Zl=1030,xl=1031,yo=1033,Dl=33776,Lo=33777,Hs=33778,Yl=33779,Ho=35840,Fl=35841,Io=35842,Jr=35843,qp=36196,Xr=37492,Qo=37496,vu=37808,Ao=37809,so=37810,op=37811,Ku=37812,Ap=37813,Yp=37814,Ws=37815,fA=37816,w_=37817,Vv=37818,Qv=37819,Wo=37820,No=37821,hv=36492,wp=2200,mA=2201,x_=2202,b_=2300,w0=2301,Du=2302,_u=2400,Xp=2401,E_=2402,El=2500,gA=2501,Gv=0,v1=1,S_=2,Am=3e3,mo=3001,Tw=3004,C_=3005,ap=3200,x0=3201,Ru=0,ku=1,M_="",Bu="srgb",wo="srgb-linear",bu=0,Go=7680,vA=7681,Kp=7682,Hv=7683,T_=34055,Ul=34056,Iw=5386,Pw=512,$u=513,Dw=514,$p=515,Wv=516,b0=517,_1=518,zm=519,I_=35044,zl=35048,_A=35040,yA=35045,dv=35049,P_=35041,E0=35046,AA=35050,IS=35042,y1="100",pv="300 es",wA=1035;class Fs{addEventListener(o,_){this._listeners===void 0&&(this._listeners={});const $=this._listeners;$[o]===void 0&&($[o]=[]),$[o].indexOf(_)===-1&&$[o].push(_)}hasEventListener(o,_){if(this._listeners===void 0)return!1;const $=this._listeners;return $[o]!==void 0&&$[o].indexOf(_)!==-1}removeEventListener(o,_){if(this._listeners===void 0)return;const $=this._listeners[o];if($!==void 0){const _e=$.indexOf(_);_e!==-1&&$.splice(_e,1)}}dispatchEvent(o){if(this._listeners===void 0)return;const _=this._listeners[o.type];if(_!==void 0){o.target=this;const $=_.slice(0);for(let _e=0,it=$.length;_e<it;_e++)$[_e].call(this,o);o.target=null}}}const ru=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Rw=1234567;const D_=Math.PI/180,Ey=180/Math.PI;function Ju(){const ut=4294967295*Math.random()|0,o=4294967295*Math.random()|0,_=4294967295*Math.random()|0,$=4294967295*Math.random()|0;return(ru[255&ut]+ru[ut>>8&255]+ru[ut>>16&255]+ru[ut>>24&255]+"-"+ru[255&o]+ru[o>>8&255]+"-"+ru[o>>16&15|64]+ru[o>>24&255]+"-"+ru[63&_|128]+ru[_>>8&255]+"-"+ru[_>>16&255]+ru[_>>24&255]+ru[255&$]+ru[$>>8&255]+ru[$>>16&255]+ru[$>>24&255]).toLowerCase()}function Ms(ut,o,_){return Math.max(o,Math.min(_,ut))}function Vm(ut,o){return(ut%o+o)%o}function Sy(ut,o,_){return(1-_)*ut+_*o}function Cy(ut){return(ut&ut-1)==0&&ut!==0}function qv(ut){return Math.pow(2,Math.ceil(Math.log(ut)/Math.LN2))}function lp(ut){return Math.pow(2,Math.floor(Math.log(ut)/Math.LN2))}function fv(ut,o){switch(o.constructor){case Float32Array:return ut;case Uint16Array:return ut/65535;case Uint8Array:return ut/255;case Int16Array:return Math.max(ut/32767,-1);case Int8Array:return Math.max(ut/127,-1);default:throw new Error("Invalid component type.")}}function Zo(ut,o){switch(o.constructor){case Float32Array:return ut;case Uint16Array:return Math.round(65535*ut);case Uint8Array:return Math.round(255*ut);case Int16Array:return Math.round(32767*ut);case Int8Array:return Math.round(127*ut);default:throw new Error("Invalid component type.")}}var xA=Object.freeze({__proto__:null,DEG2RAD:D_,RAD2DEG:Ey,generateUUID:Ju,clamp:Ms,euclideanModulo:Vm,mapLinear:function(ut,o,_,$,_e){return $+(ut-o)*(_e-$)/(_-o)},inverseLerp:function(ut,o,_){return ut!==o?(_-ut)/(o-ut):0},lerp:Sy,damp:function(ut,o,_,$){return Sy(ut,o,1-Math.exp(-_*$))},pingpong:function(ut,o=1){return o-Math.abs(Vm(ut,2*o)-o)},smoothstep:function(ut,o,_){return ut<=o?0:ut>=_?1:(ut=(ut-o)/(_-o))*ut*(3-2*ut)},smootherstep:function(ut,o,_){return ut<=o?0:ut>=_?1:(ut=(ut-o)/(_-o))*ut*ut*(ut*(6*ut-15)+10)},randInt:function(ut,o){return ut+Math.floor(Math.random()*(o-ut+1))},randFloat:function(ut,o){return ut+Math.random()*(o-ut)},randFloatSpread:function(ut){return ut*(.5-Math.random())},seededRandom:function(ut){ut!==void 0&&(Rw=ut);let o=Rw+=1831565813;return o=Math.imul(o^o>>>15,1|o),o^=o+Math.imul(o^o>>>7,61|o),((o^o>>>14)>>>0)/4294967296},degToRad:function(ut){return ut*D_},radToDeg:function(ut){return ut*Ey},isPowerOfTwo:Cy,ceilPowerOfTwo:qv,floorPowerOfTwo:lp,setQuaternionFromProperEuler:function(ut,o,_,$,_e){const it=Math.cos,ot=Math.sin,ct=it(_/2),mt=ot(_/2),gt=it((o+$)/2),St=ot((o+$)/2),Tt=it((o-$)/2),Ct=ot((o-$)/2),Pt=it(($-o)/2),Ot=ot(($-o)/2);switch(_e){case"XYX":ut.set(ct*St,mt*Tt,mt*Ct,ct*gt);break;case"YZY":ut.set(mt*Ct,ct*St,mt*Tt,ct*gt);break;case"ZXZ":ut.set(mt*Tt,mt*Ct,ct*St,ct*gt);break;case"XZX":ut.set(ct*St,mt*Ot,mt*Pt,ct*gt);break;case"YXY":ut.set(mt*Pt,ct*St,mt*Ot,ct*gt);break;case"ZYZ":ut.set(mt*Ot,mt*Pt,ct*St,ct*gt);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+_e)}},normalize:Zo,denormalize:fv});class Rr{constructor(o=0,_=0){Rr.prototype.isVector2=!0,this.x=o,this.y=_}get width(){return this.x}set width(o){this.x=o}get height(){return this.y}set height(o){this.y=o}set(o,_){return this.x=o,this.y=_,this}setScalar(o){return this.x=o,this.y=o,this}setX(o){return this.x=o,this}setY(o){return this.y=o,this}setComponent(o,_){switch(o){case 0:this.x=_;break;case 1:this.y=_;break;default:throw new Error("index is out of range: "+o)}return this}getComponent(o){switch(o){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+o)}}clone(){return new this.constructor(this.x,this.y)}copy(o){return this.x=o.x,this.y=o.y,this}add(o){return this.x+=o.x,this.y+=o.y,this}addScalar(o){return this.x+=o,this.y+=o,this}addVectors(o,_){return this.x=o.x+_.x,this.y=o.y+_.y,this}addScaledVector(o,_){return this.x+=o.x*_,this.y+=o.y*_,this}sub(o){return this.x-=o.x,this.y-=o.y,this}subScalar(o){return this.x-=o,this.y-=o,this}subVectors(o,_){return this.x=o.x-_.x,this.y=o.y-_.y,this}multiply(o){return this.x*=o.x,this.y*=o.y,this}multiplyScalar(o){return this.x*=o,this.y*=o,this}divide(o){return this.x/=o.x,this.y/=o.y,this}divideScalar(o){return this.multiplyScalar(1/o)}applyMatrix3(o){const _=this.x,$=this.y,_e=o.elements;return this.x=_e[0]*_+_e[3]*$+_e[6],this.y=_e[1]*_+_e[4]*$+_e[7],this}min(o){return this.x=Math.min(this.x,o.x),this.y=Math.min(this.y,o.y),this}max(o){return this.x=Math.max(this.x,o.x),this.y=Math.max(this.y,o.y),this}clamp(o,_){return this.x=Math.max(o.x,Math.min(_.x,this.x)),this.y=Math.max(o.y,Math.min(_.y,this.y)),this}clampScalar(o,_){return this.x=Math.max(o,Math.min(_,this.x)),this.y=Math.max(o,Math.min(_,this.y)),this}clampLength(o,_){const $=this.length();return this.divideScalar($||1).multiplyScalar(Math.max(o,Math.min(_,$)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(o){return this.x*o.x+this.y*o.y}cross(o){return this.x*o.y-this.y*o.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(o){return Math.sqrt(this.distanceToSquared(o))}distanceToSquared(o){const _=this.x-o.x,$=this.y-o.y;return _*_+$*$}manhattanDistanceTo(o){return Math.abs(this.x-o.x)+Math.abs(this.y-o.y)}setLength(o){return this.normalize().multiplyScalar(o)}lerp(o,_){return this.x+=(o.x-this.x)*_,this.y+=(o.y-this.y)*_,this}lerpVectors(o,_,$){return this.x=o.x+(_.x-o.x)*$,this.y=o.y+(_.y-o.y)*$,this}equals(o){return o.x===this.x&&o.y===this.y}fromArray(o,_=0){return this.x=o[_],this.y=o[_+1],this}toArray(o=[],_=0){return o[_]=this.x,o[_+1]=this.y,o}fromBufferAttribute(o,_){return this.x=o.getX(_),this.y=o.getY(_),this}rotateAround(o,_){const $=Math.cos(_),_e=Math.sin(_),it=this.x-o.x,ot=this.y-o.y;return this.x=it*$-ot*_e+o.x,this.y=it*_e+ot*$+o.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ou{constructor(){Ou.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(o,_,$,_e,it,ot,ct,mt,gt){const St=this.elements;return St[0]=o,St[1]=_e,St[2]=ct,St[3]=_,St[4]=it,St[5]=mt,St[6]=$,St[7]=ot,St[8]=gt,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(o){const _=this.elements,$=o.elements;return _[0]=$[0],_[1]=$[1],_[2]=$[2],_[3]=$[3],_[4]=$[4],_[5]=$[5],_[6]=$[6],_[7]=$[7],_[8]=$[8],this}extractBasis(o,_,$){return o.setFromMatrix3Column(this,0),_.setFromMatrix3Column(this,1),$.setFromMatrix3Column(this,2),this}setFromMatrix4(o){const _=o.elements;return this.set(_[0],_[4],_[8],_[1],_[5],_[9],_[2],_[6],_[10]),this}multiply(o){return this.multiplyMatrices(this,o)}premultiply(o){return this.multiplyMatrices(o,this)}multiplyMatrices(o,_){const $=o.elements,_e=_.elements,it=this.elements,ot=$[0],ct=$[3],mt=$[6],gt=$[1],St=$[4],Tt=$[7],Ct=$[2],Pt=$[5],Ot=$[8],Dt=_e[0],Yt=_e[3],Xt=_e[6],Jt=_e[1],an=_e[4],fn=_e[7],gn=_e[2],_n=_e[5],On=_e[8];return it[0]=ot*Dt+ct*Jt+mt*gn,it[3]=ot*Yt+ct*an+mt*_n,it[6]=ot*Xt+ct*fn+mt*On,it[1]=gt*Dt+St*Jt+Tt*gn,it[4]=gt*Yt+St*an+Tt*_n,it[7]=gt*Xt+St*fn+Tt*On,it[2]=Ct*Dt+Pt*Jt+Ot*gn,it[5]=Ct*Yt+Pt*an+Ot*_n,it[8]=Ct*Xt+Pt*fn+Ot*On,this}multiplyScalar(o){const _=this.elements;return _[0]*=o,_[3]*=o,_[6]*=o,_[1]*=o,_[4]*=o,_[7]*=o,_[2]*=o,_[5]*=o,_[8]*=o,this}determinant(){const o=this.elements,_=o[0],$=o[1],_e=o[2],it=o[3],ot=o[4],ct=o[5],mt=o[6],gt=o[7],St=o[8];return _*ot*St-_*ct*gt-$*it*St+$*ct*mt+_e*it*gt-_e*ot*mt}invert(){const o=this.elements,_=o[0],$=o[1],_e=o[2],it=o[3],ot=o[4],ct=o[5],mt=o[6],gt=o[7],St=o[8],Tt=St*ot-ct*gt,Ct=ct*mt-St*it,Pt=gt*it-ot*mt,Ot=_*Tt+$*Ct+_e*Pt;if(Ot===0)return this.set(0,0,0,0,0,0,0,0,0);const Dt=1/Ot;return o[0]=Tt*Dt,o[1]=(_e*gt-St*$)*Dt,o[2]=(ct*$-_e*ot)*Dt,o[3]=Ct*Dt,o[4]=(St*_-_e*mt)*Dt,o[5]=(_e*it-ct*_)*Dt,o[6]=Pt*Dt,o[7]=($*mt-gt*_)*Dt,o[8]=(ot*_-$*it)*Dt,this}transpose(){let o;const _=this.elements;return o=_[1],_[1]=_[3],_[3]=o,o=_[2],_[2]=_[6],_[6]=o,o=_[5],_[5]=_[7],_[7]=o,this}getNormalMatrix(o){return this.setFromMatrix4(o).invert().transpose()}transposeIntoArray(o){const _=this.elements;return o[0]=_[0],o[1]=_[3],o[2]=_[6],o[3]=_[1],o[4]=_[4],o[5]=_[7],o[6]=_[2],o[7]=_[5],o[8]=_[8],this}setUvTransform(o,_,$,_e,it,ot,ct){const mt=Math.cos(it),gt=Math.sin(it);return this.set($*mt,$*gt,-$*(mt*ot+gt*ct)+ot+o,-_e*gt,_e*mt,-_e*(-gt*ot+mt*ct)+ct+_,0,0,1),this}scale(o,_){const $=this.elements;return $[0]*=o,$[3]*=o,$[6]*=o,$[1]*=_,$[4]*=_,$[7]*=_,this}rotate(o){const _=Math.cos(o),$=Math.sin(o),_e=this.elements,it=_e[0],ot=_e[3],ct=_e[6],mt=_e[1],gt=_e[4],St=_e[7];return _e[0]=_*it+$*mt,_e[3]=_*ot+$*gt,_e[6]=_*ct+$*St,_e[1]=-$*it+_*mt,_e[4]=-$*ot+_*gt,_e[7]=-$*ct+_*St,this}translate(o,_){const $=this.elements;return $[0]+=o*$[2],$[3]+=o*$[5],$[6]+=o*$[8],$[1]+=_*$[2],$[4]+=_*$[5],$[7]+=_*$[8],this}equals(o){const _=this.elements,$=o.elements;for(let _e=0;_e<9;_e++)if(_[_e]!==$[_e])return!1;return!0}fromArray(o,_=0){for(let $=0;$<9;$++)this.elements[$]=o[$+_];return this}toArray(o=[],_=0){const $=this.elements;return o[_]=$[0],o[_+1]=$[1],o[_+2]=$[2],o[_+3]=$[3],o[_+4]=$[4],o[_+5]=$[5],o[_+6]=$[6],o[_+7]=$[7],o[_+8]=$[8],o}clone(){return new this.constructor().fromArray(this.elements)}}function A1(ut){for(let o=ut.length-1;o>=0;--o)if(ut[o]>65535)return!0;return!1}const kw={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function R_(ut,o){return new kw[ut](o)}function k_(ut){return document.createElementNS("http://www.w3.org/1999/xhtml",ut)}function wm(ut){return ut<.04045?.0773993808*ut:Math.pow(.9478672986*ut+.0521327014,2.4)}function My(ut){return ut<.0031308?12.92*ut:1.055*Math.pow(ut,.41666)-.055}const S0={[Bu]:{[wo]:wm},[wo]:{[Bu]:My}},Zu={legacyMode:!0,get workingColorSpace(){return wo},set workingColorSpace(ut){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(ut,o,_){if(this.legacyMode||o===_||!o||!_)return ut;if(S0[o]&&S0[o][_]!==void 0){const $=S0[o][_];return ut.r=$(ut.r),ut.g=$(ut.g),ut.b=$(ut.b),ut}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(ut,o){return this.convert(ut,this.workingColorSpace,o)},toWorkingColorSpace:function(ut,o){return this.convert(ut,o,this.workingColorSpace)}},bA={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Vl={r:0,g:0,b:0},Jp={h:0,s:0,l:0},C0={h:0,s:0,l:0};function kp(ut,o,_){return _<0&&(_+=1),_>1&&(_-=1),_<1/6?ut+6*(o-ut)*_:_<.5?o:_<2/3?ut+6*(o-ut)*(2/3-_):ut}function EA(ut,o){return o.r=ut.r,o.g=ut.g,o.b=ut.b,o}class is{constructor(o,_,$){return this.isColor=!0,this.r=1,this.g=1,this.b=1,_===void 0&&$===void 0?this.set(o):this.setRGB(o,_,$)}set(o){return o&&o.isColor?this.copy(o):typeof o=="number"?this.setHex(o):typeof o=="string"&&this.setStyle(o),this}setScalar(o){return this.r=o,this.g=o,this.b=o,this}setHex(o,_=Bu){return o=Math.floor(o),this.r=(o>>16&255)/255,this.g=(o>>8&255)/255,this.b=(255&o)/255,Zu.toWorkingColorSpace(this,_),this}setRGB(o,_,$,_e=wo){return this.r=o,this.g=_,this.b=$,Zu.toWorkingColorSpace(this,_e),this}setHSL(o,_,$,_e=wo){if(o=Vm(o,1),_=Ms(_,0,1),$=Ms($,0,1),_===0)this.r=this.g=this.b=$;else{const it=$<=.5?$*(1+_):$+_-$*_,ot=2*$-it;this.r=kp(ot,it,o+1/3),this.g=kp(ot,it,o),this.b=kp(ot,it,o-1/3)}return Zu.toWorkingColorSpace(this,_e),this}setStyle(o,_=Bu){function $(it){it!==void 0&&parseFloat(it)<1&&console.warn("THREE.Color: Alpha component of "+o+" will be ignored.")}let _e;if(_e=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(o)){let it;const ot=_e[1],ct=_e[2];switch(ot){case"rgb":case"rgba":if(it=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(ct))return this.r=Math.min(255,parseInt(it[1],10))/255,this.g=Math.min(255,parseInt(it[2],10))/255,this.b=Math.min(255,parseInt(it[3],10))/255,Zu.toWorkingColorSpace(this,_),$(it[4]),this;if(it=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(ct))return this.r=Math.min(100,parseInt(it[1],10))/100,this.g=Math.min(100,parseInt(it[2],10))/100,this.b=Math.min(100,parseInt(it[3],10))/100,Zu.toWorkingColorSpace(this,_),$(it[4]),this;break;case"hsl":case"hsla":if(it=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(ct)){const mt=parseFloat(it[1])/360,gt=parseFloat(it[2])/100,St=parseFloat(it[3])/100;return $(it[4]),this.setHSL(mt,gt,St,_)}}}else if(_e=/^\#([A-Fa-f\d]+)$/.exec(o)){const it=_e[1],ot=it.length;if(ot===3)return this.r=parseInt(it.charAt(0)+it.charAt(0),16)/255,this.g=parseInt(it.charAt(1)+it.charAt(1),16)/255,this.b=parseInt(it.charAt(2)+it.charAt(2),16)/255,Zu.toWorkingColorSpace(this,_),this;if(ot===6)return this.r=parseInt(it.charAt(0)+it.charAt(1),16)/255,this.g=parseInt(it.charAt(2)+it.charAt(3),16)/255,this.b=parseInt(it.charAt(4)+it.charAt(5),16)/255,Zu.toWorkingColorSpace(this,_),this}return o&&o.length>0?this.setColorName(o,_):this}setColorName(o,_=Bu){const $=bA[o.toLowerCase()];return $!==void 0?this.setHex($,_):console.warn("THREE.Color: Unknown color "+o),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(o){return this.r=o.r,this.g=o.g,this.b=o.b,this}copySRGBToLinear(o){return this.r=wm(o.r),this.g=wm(o.g),this.b=wm(o.b),this}copyLinearToSRGB(o){return this.r=My(o.r),this.g=My(o.g),this.b=My(o.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(o=Bu){return Zu.fromWorkingColorSpace(EA(this,Vl),o),Ms(255*Vl.r,0,255)<<16^Ms(255*Vl.g,0,255)<<8^Ms(255*Vl.b,0,255)<<0}getHexString(o=Bu){return("000000"+this.getHex(o).toString(16)).slice(-6)}getHSL(o,_=wo){Zu.fromWorkingColorSpace(EA(this,Vl),_);const $=Vl.r,_e=Vl.g,it=Vl.b,ot=Math.max($,_e,it),ct=Math.min($,_e,it);let mt,gt;const St=(ct+ot)/2;if(ct===ot)mt=0,gt=0;else{const Tt=ot-ct;switch(gt=St<=.5?Tt/(ot+ct):Tt/(2-ot-ct),ot){case $:mt=(_e-it)/Tt+(_e<it?6:0);break;case _e:mt=(it-$)/Tt+2;break;case it:mt=($-_e)/Tt+4}mt/=6}return o.h=mt,o.s=gt,o.l=St,o}getRGB(o,_=wo){return Zu.fromWorkingColorSpace(EA(this,Vl),_),o.r=Vl.r,o.g=Vl.g,o.b=Vl.b,o}getStyle(o=Bu){return Zu.fromWorkingColorSpace(EA(this,Vl),o),o!==Bu?`color(${o} ${Vl.r} ${Vl.g} ${Vl.b})`:`rgb(${255*Vl.r|0},${255*Vl.g|0},${255*Vl.b|0})`}offsetHSL(o,_,$){return this.getHSL(Jp),Jp.h+=o,Jp.s+=_,Jp.l+=$,this.setHSL(Jp.h,Jp.s,Jp.l),this}add(o){return this.r+=o.r,this.g+=o.g,this.b+=o.b,this}addColors(o,_){return this.r=o.r+_.r,this.g=o.g+_.g,this.b=o.b+_.b,this}addScalar(o){return this.r+=o,this.g+=o,this.b+=o,this}sub(o){return this.r=Math.max(0,this.r-o.r),this.g=Math.max(0,this.g-o.g),this.b=Math.max(0,this.b-o.b),this}multiply(o){return this.r*=o.r,this.g*=o.g,this.b*=o.b,this}multiplyScalar(o){return this.r*=o,this.g*=o,this.b*=o,this}lerp(o,_){return this.r+=(o.r-this.r)*_,this.g+=(o.g-this.g)*_,this.b+=(o.b-this.b)*_,this}lerpColors(o,_,$){return this.r=o.r+(_.r-o.r)*$,this.g=o.g+(_.g-o.g)*$,this.b=o.b+(_.b-o.b)*$,this}lerpHSL(o,_){this.getHSL(Jp),o.getHSL(C0);const $=Sy(Jp.h,C0.h,_),_e=Sy(Jp.s,C0.s,_),it=Sy(Jp.l,C0.l,_);return this.setHSL($,_e,it),this}equals(o){return o.r===this.r&&o.g===this.g&&o.b===this.b}fromArray(o,_=0){return this.r=o[_],this.g=o[_+1],this.b=o[_+2],this}toArray(o=[],_=0){return o[_]=this.r,o[_+1]=this.g,o[_+2]=this.b,o}fromBufferAttribute(o,_){return this.r=o.getX(_),this.g=o.getY(_),this.b=o.getZ(_),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let Zp;is.NAMES=bA;class Ty{static getDataURL(o,_=!1){if(/^data:/i.test(o.src)||typeof HTMLCanvasElement>"u")return o.src;let $;if(o instanceof HTMLCanvasElement)$=o;else{Zp===void 0&&(Zp=k_("canvas")),Zp.width=o.width,Zp.height=o.height;const _e=Zp.getContext("2d");o instanceof ImageData?_e.putImageData(o,0,0):_e.drawImage(o,0,0,o.width,o.height),$=Zp}return!_&&($.width>2048||$.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",o),$.toDataURL("image/jpeg",.6)):$.toDataURL("image/png")}static sRGBToLinear(o){if(typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&o instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&o instanceof ImageBitmap){const _=k_("canvas");_.width=o.width,_.height=o.height;const $=_.getContext("2d");$.drawImage(o,0,0,o.width,o.height);const _e=$.getImageData(0,0,o.width,o.height),it=_e.data;for(let ot=0;ot<it.length;ot++)it[ot]=255*wm(it[ot]/255);return $.putImageData(_e,0,0),_}if(o.data){const _=o.data.slice(0);for(let $=0;$<_.length;$++)_ instanceof Uint8Array||_ instanceof Uint8ClampedArray?_[$]=Math.floor(255*wm(_[$]/255)):_[$]=wm(_[$]);return{data:_,width:o.width,height:o.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),o}}class B_{constructor(o=null){this.isSource=!0,this.uuid=Ju(),this.data=o,this.version=0}set needsUpdate(o){o===!0&&this.version++}toJSON(o){const _=o===void 0||typeof o=="string";if(!_&&o.images[this.uuid]!==void 0)return o.images[this.uuid];const $={uuid:this.uuid,url:""},_e=this.data;if(_e!==null){let it;if(Array.isArray(_e)){it=[];for(let ot=0,ct=_e.length;ot<ct;ot++)_e[ot].isDataTexture?it.push(M0(_e[ot].image)):it.push(M0(_e[ot]))}else it=M0(_e);$.url=it}return _||(o.images[this.uuid]=$),$}}function M0(ut){if(typeof HTMLImageElement<"u"&&ut instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ut instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&ut instanceof ImageBitmap)return Ty.getDataURL(ut);if(ut.data){let o=[];try{o=Array.from(ut.data)}catch(_){_.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(_),o=ut.data}return{data:o,width:ut.width,height:ut.height,type:ut.data.constructor.name}}return console.warn("THREE.Texture: Unable to serialize Texture."),{}}let Bw=0;class yu extends Fs{constructor(o=yu.DEFAULT_IMAGE,_=yu.DEFAULT_MAPPING,$=fo,_e=fo,it=zo,ot=oo,ct=Ls,mt=Gs,gt=1,St=Am){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Bw++}),this.uuid=Ju(),this.name="",this.source=new B_(o),this.mipmaps=[],this.mapping=_,this.wrapS=$,this.wrapT=_e,this.magFilter=it,this.minFilter=ot,this.anisotropy=gt,this.format=ct,this.internalFormat=null,this.type=mt,this.offset=new Rr(0,0),this.repeat=new Rr(1,1),this.center=new Rr(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ou,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=St,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(o){this.source.data=o}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(o){return this.name=o.name,this.source=o.source,this.mipmaps=o.mipmaps.slice(0),this.mapping=o.mapping,this.wrapS=o.wrapS,this.wrapT=o.wrapT,this.magFilter=o.magFilter,this.minFilter=o.minFilter,this.anisotropy=o.anisotropy,this.format=o.format,this.internalFormat=o.internalFormat,this.type=o.type,this.offset.copy(o.offset),this.repeat.copy(o.repeat),this.center.copy(o.center),this.rotation=o.rotation,this.matrixAutoUpdate=o.matrixAutoUpdate,this.matrix.copy(o.matrix),this.generateMipmaps=o.generateMipmaps,this.premultiplyAlpha=o.premultiplyAlpha,this.flipY=o.flipY,this.unpackAlignment=o.unpackAlignment,this.encoding=o.encoding,this.userData=JSON.parse(JSON.stringify(o.userData)),this.needsUpdate=!0,this}toJSON(o){const _=o===void 0||typeof o=="string";if(!_&&o.textures[this.uuid]!==void 0)return o.textures[this.uuid];const $={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(o).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&($.userData=this.userData),_||(o.textures[this.uuid]=$),$}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(o){if(this.mapping!==Nl)return o;if(o.applyMatrix3(this.matrix),o.x<0||o.x>1)switch(this.wrapS){case _o:o.x=o.x-Math.floor(o.x);break;case fo:o.x=o.x<0?0:1;break;case Wl:Math.abs(Math.floor(o.x)%2)===1?o.x=Math.ceil(o.x)-o.x:o.x=o.x-Math.floor(o.x)}if(o.y<0||o.y>1)switch(this.wrapT){case _o:o.y=o.y-Math.floor(o.y);break;case fo:o.y=o.y<0?0:1;break;case Wl:Math.abs(Math.floor(o.y)%2)===1?o.y=Math.ceil(o.y)-o.y:o.y=o.y-Math.floor(o.y)}return this.flipY&&(o.y=1-o.y),o}set needsUpdate(o){o===!0&&(this.version++,this.source.needsUpdate=!0)}}yu.DEFAULT_IMAGE=null,yu.DEFAULT_MAPPING=Nl;class Fo{constructor(o=0,_=0,$=0,_e=1){Fo.prototype.isVector4=!0,this.x=o,this.y=_,this.z=$,this.w=_e}get width(){return this.z}set width(o){this.z=o}get height(){return this.w}set height(o){this.w=o}set(o,_,$,_e){return this.x=o,this.y=_,this.z=$,this.w=_e,this}setScalar(o){return this.x=o,this.y=o,this.z=o,this.w=o,this}setX(o){return this.x=o,this}setY(o){return this.y=o,this}setZ(o){return this.z=o,this}setW(o){return this.w=o,this}setComponent(o,_){switch(o){case 0:this.x=_;break;case 1:this.y=_;break;case 2:this.z=_;break;case 3:this.w=_;break;default:throw new Error("index is out of range: "+o)}return this}getComponent(o){switch(o){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+o)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(o){return this.x=o.x,this.y=o.y,this.z=o.z,this.w=o.w!==void 0?o.w:1,this}add(o){return this.x+=o.x,this.y+=o.y,this.z+=o.z,this.w+=o.w,this}addScalar(o){return this.x+=o,this.y+=o,this.z+=o,this.w+=o,this}addVectors(o,_){return this.x=o.x+_.x,this.y=o.y+_.y,this.z=o.z+_.z,this.w=o.w+_.w,this}addScaledVector(o,_){return this.x+=o.x*_,this.y+=o.y*_,this.z+=o.z*_,this.w+=o.w*_,this}sub(o){return this.x-=o.x,this.y-=o.y,this.z-=o.z,this.w-=o.w,this}subScalar(o){return this.x-=o,this.y-=o,this.z-=o,this.w-=o,this}subVectors(o,_){return this.x=o.x-_.x,this.y=o.y-_.y,this.z=o.z-_.z,this.w=o.w-_.w,this}multiply(o){return this.x*=o.x,this.y*=o.y,this.z*=o.z,this.w*=o.w,this}multiplyScalar(o){return this.x*=o,this.y*=o,this.z*=o,this.w*=o,this}applyMatrix4(o){const _=this.x,$=this.y,_e=this.z,it=this.w,ot=o.elements;return this.x=ot[0]*_+ot[4]*$+ot[8]*_e+ot[12]*it,this.y=ot[1]*_+ot[5]*$+ot[9]*_e+ot[13]*it,this.z=ot[2]*_+ot[6]*$+ot[10]*_e+ot[14]*it,this.w=ot[3]*_+ot[7]*$+ot[11]*_e+ot[15]*it,this}divideScalar(o){return this.multiplyScalar(1/o)}setAxisAngleFromQuaternion(o){this.w=2*Math.acos(o.w);const _=Math.sqrt(1-o.w*o.w);return _<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=o.x/_,this.y=o.y/_,this.z=o.z/_),this}setAxisAngleFromRotationMatrix(o){let _,$,_e,it;const mt=o.elements,gt=mt[0],St=mt[4],Tt=mt[8],Ct=mt[1],Pt=mt[5],Ot=mt[9],Dt=mt[2],Yt=mt[6],Xt=mt[10];if(Math.abs(St-Ct)<.01&&Math.abs(Tt-Dt)<.01&&Math.abs(Ot-Yt)<.01){if(Math.abs(St+Ct)<.1&&Math.abs(Tt+Dt)<.1&&Math.abs(Ot+Yt)<.1&&Math.abs(gt+Pt+Xt-3)<.1)return this.set(1,0,0,0),this;_=Math.PI;const an=(gt+1)/2,fn=(Pt+1)/2,gn=(Xt+1)/2,_n=(St+Ct)/4,On=(Tt+Dt)/4,Ln=(Ot+Yt)/4;return an>fn&&an>gn?an<.01?($=0,_e=.707106781,it=.707106781):($=Math.sqrt(an),_e=_n/$,it=On/$):fn>gn?fn<.01?($=.707106781,_e=0,it=.707106781):(_e=Math.sqrt(fn),$=_n/_e,it=Ln/_e):gn<.01?($=.707106781,_e=.707106781,it=0):(it=Math.sqrt(gn),$=On/it,_e=Ln/it),this.set($,_e,it,_),this}let Jt=Math.sqrt((Yt-Ot)*(Yt-Ot)+(Tt-Dt)*(Tt-Dt)+(Ct-St)*(Ct-St));return Math.abs(Jt)<.001&&(Jt=1),this.x=(Yt-Ot)/Jt,this.y=(Tt-Dt)/Jt,this.z=(Ct-St)/Jt,this.w=Math.acos((gt+Pt+Xt-1)/2),this}min(o){return this.x=Math.min(this.x,o.x),this.y=Math.min(this.y,o.y),this.z=Math.min(this.z,o.z),this.w=Math.min(this.w,o.w),this}max(o){return this.x=Math.max(this.x,o.x),this.y=Math.max(this.y,o.y),this.z=Math.max(this.z,o.z),this.w=Math.max(this.w,o.w),this}clamp(o,_){return this.x=Math.max(o.x,Math.min(_.x,this.x)),this.y=Math.max(o.y,Math.min(_.y,this.y)),this.z=Math.max(o.z,Math.min(_.z,this.z)),this.w=Math.max(o.w,Math.min(_.w,this.w)),this}clampScalar(o,_){return this.x=Math.max(o,Math.min(_,this.x)),this.y=Math.max(o,Math.min(_,this.y)),this.z=Math.max(o,Math.min(_,this.z)),this.w=Math.max(o,Math.min(_,this.w)),this}clampLength(o,_){const $=this.length();return this.divideScalar($||1).multiplyScalar(Math.max(o,Math.min(_,$)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(o){return this.x*o.x+this.y*o.y+this.z*o.z+this.w*o.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(o){return this.normalize().multiplyScalar(o)}lerp(o,_){return this.x+=(o.x-this.x)*_,this.y+=(o.y-this.y)*_,this.z+=(o.z-this.z)*_,this.w+=(o.w-this.w)*_,this}lerpVectors(o,_,$){return this.x=o.x+(_.x-o.x)*$,this.y=o.y+(_.y-o.y)*$,this.z=o.z+(_.z-o.z)*$,this.w=o.w+(_.w-o.w)*$,this}equals(o){return o.x===this.x&&o.y===this.y&&o.z===this.z&&o.w===this.w}fromArray(o,_=0){return this.x=o[_],this.y=o[_+1],this.z=o[_+2],this.w=o[_+3],this}toArray(o=[],_=0){return o[_]=this.x,o[_+1]=this.y,o[_+2]=this.z,o[_+3]=this.w,o}fromBufferAttribute(o,_){return this.x=o.getX(_),this.y=o.getY(_),this.z=o.getZ(_),this.w=o.getW(_),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class xp extends Fs{constructor(o,_,$={}){super(),this.isWebGLRenderTarget=!0,this.width=o,this.height=_,this.depth=1,this.scissor=new Fo(0,0,o,_),this.scissorTest=!1,this.viewport=new Fo(0,0,o,_);const _e={width:o,height:_,depth:1};this.texture=new yu(_e,$.mapping,$.wrapS,$.wrapT,$.magFilter,$.minFilter,$.format,$.type,$.anisotropy,$.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=$.generateMipmaps!==void 0&&$.generateMipmaps,this.texture.internalFormat=$.internalFormat!==void 0?$.internalFormat:null,this.texture.minFilter=$.minFilter!==void 0?$.minFilter:zo,this.depthBuffer=$.depthBuffer===void 0||$.depthBuffer,this.stencilBuffer=$.stencilBuffer!==void 0&&$.stencilBuffer,this.depthTexture=$.depthTexture!==void 0?$.depthTexture:null,this.samples=$.samples!==void 0?$.samples:0}setSize(o,_,$=1){this.width===o&&this.height===_&&this.depth===$||(this.width=o,this.height=_,this.depth=$,this.texture.image.width=o,this.texture.image.height=_,this.texture.image.depth=$,this.dispose()),this.viewport.set(0,0,o,_),this.scissor.set(0,0,o,_)}clone(){return new this.constructor().copy(this)}copy(o){this.width=o.width,this.height=o.height,this.depth=o.depth,this.viewport.copy(o.viewport),this.texture=o.texture.clone(),this.texture.isRenderTargetTexture=!0;const _=Object.assign({},o.texture.image);return this.texture.source=new B_(_),this.depthBuffer=o.depthBuffer,this.stencilBuffer=o.stencilBuffer,o.depthTexture!==null&&(this.depthTexture=o.depthTexture.clone()),this.samples=o.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class T0 extends yu{constructor(o=null,_=1,$=1,_e=1){super(null),this.isDataArrayTexture=!0,this.image={data:o,width:_,height:$,depth:_e},this.magFilter=Oo,this.minFilter=Oo,this.wrapR=fo,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class w1 extends xp{constructor(o,_,$){super(o,_),this.isWebGLArrayRenderTarget=!0,this.depth=$,this.texture=new T0(null,o,_,$),this.texture.isRenderTargetTexture=!0}}class O_ extends yu{constructor(o=null,_=1,$=1,_e=1){super(null),this.isData3DTexture=!0,this.image={data:o,width:_,height:$,depth:_e},this.magFilter=Oo,this.minFilter=Oo,this.wrapR=fo,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class SA extends xp{constructor(o,_,$){super(o,_),this.isWebGL3DRenderTarget=!0,this.depth=$,this.texture=new O_(null,o,_,$),this.texture.isRenderTargetTexture=!0}}class _f extends xp{constructor(o,_,$,_e={}){super(o,_,_e),this.isWebGLMultipleRenderTargets=!0;const it=this.texture;this.texture=[];for(let ot=0;ot<$;ot++)this.texture[ot]=it.clone(),this.texture[ot].isRenderTargetTexture=!0}setSize(o,_,$=1){if(this.width!==o||this.height!==_||this.depth!==$){this.width=o,this.height=_,this.depth=$;for(let _e=0,it=this.texture.length;_e<it;_e++)this.texture[_e].image.width=o,this.texture[_e].image.height=_,this.texture[_e].image.depth=$;this.dispose()}return this.viewport.set(0,0,o,_),this.scissor.set(0,0,o,_),this}copy(o){this.dispose(),this.width=o.width,this.height=o.height,this.depth=o.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=o.depthBuffer,this.stencilBuffer=o.stencilBuffer,o.depthTexture!==null&&(this.depthTexture=o.depthTexture.clone()),this.texture.length=0;for(let _=0,$=o.texture.length;_<$;_++)this.texture[_]=o.texture[_].clone(),this.texture[_].isRenderTargetTexture=!0;return this}}class Lu{constructor(o=0,_=0,$=0,_e=1){this.isQuaternion=!0,this._x=o,this._y=_,this._z=$,this._w=_e}static slerpFlat(o,_,$,_e,it,ot,ct){let mt=$[_e+0],gt=$[_e+1],St=$[_e+2],Tt=$[_e+3];const Ct=it[ot+0],Pt=it[ot+1],Ot=it[ot+2],Dt=it[ot+3];if(ct===0)return o[_+0]=mt,o[_+1]=gt,o[_+2]=St,void(o[_+3]=Tt);if(ct===1)return o[_+0]=Ct,o[_+1]=Pt,o[_+2]=Ot,void(o[_+3]=Dt);if(Tt!==Dt||mt!==Ct||gt!==Pt||St!==Ot){let Yt=1-ct;const Xt=mt*Ct+gt*Pt+St*Ot+Tt*Dt,Jt=Xt>=0?1:-1,an=1-Xt*Xt;if(an>Number.EPSILON){const gn=Math.sqrt(an),_n=Math.atan2(gn,Xt*Jt);Yt=Math.sin(Yt*_n)/gn,ct=Math.sin(ct*_n)/gn}const fn=ct*Jt;if(mt=mt*Yt+Ct*fn,gt=gt*Yt+Pt*fn,St=St*Yt+Ot*fn,Tt=Tt*Yt+Dt*fn,Yt===1-ct){const gn=1/Math.sqrt(mt*mt+gt*gt+St*St+Tt*Tt);mt*=gn,gt*=gn,St*=gn,Tt*=gn}}o[_]=mt,o[_+1]=gt,o[_+2]=St,o[_+3]=Tt}static multiplyQuaternionsFlat(o,_,$,_e,it,ot){const ct=$[_e],mt=$[_e+1],gt=$[_e+2],St=$[_e+3],Tt=it[ot],Ct=it[ot+1],Pt=it[ot+2],Ot=it[ot+3];return o[_]=ct*Ot+St*Tt+mt*Pt-gt*Ct,o[_+1]=mt*Ot+St*Ct+gt*Tt-ct*Pt,o[_+2]=gt*Ot+St*Pt+ct*Ct-mt*Tt,o[_+3]=St*Ot-ct*Tt-mt*Ct-gt*Pt,o}get x(){return this._x}set x(o){this._x=o,this._onChangeCallback()}get y(){return this._y}set y(o){this._y=o,this._onChangeCallback()}get z(){return this._z}set z(o){this._z=o,this._onChangeCallback()}get w(){return this._w}set w(o){this._w=o,this._onChangeCallback()}set(o,_,$,_e){return this._x=o,this._y=_,this._z=$,this._w=_e,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(o){return this._x=o.x,this._y=o.y,this._z=o.z,this._w=o.w,this._onChangeCallback(),this}setFromEuler(o,_){const $=o._x,_e=o._y,it=o._z,ot=o._order,ct=Math.cos,mt=Math.sin,gt=ct($/2),St=ct(_e/2),Tt=ct(it/2),Ct=mt($/2),Pt=mt(_e/2),Ot=mt(it/2);switch(ot){case"XYZ":this._x=Ct*St*Tt+gt*Pt*Ot,this._y=gt*Pt*Tt-Ct*St*Ot,this._z=gt*St*Ot+Ct*Pt*Tt,this._w=gt*St*Tt-Ct*Pt*Ot;break;case"YXZ":this._x=Ct*St*Tt+gt*Pt*Ot,this._y=gt*Pt*Tt-Ct*St*Ot,this._z=gt*St*Ot-Ct*Pt*Tt,this._w=gt*St*Tt+Ct*Pt*Ot;break;case"ZXY":this._x=Ct*St*Tt-gt*Pt*Ot,this._y=gt*Pt*Tt+Ct*St*Ot,this._z=gt*St*Ot+Ct*Pt*Tt,this._w=gt*St*Tt-Ct*Pt*Ot;break;case"ZYX":this._x=Ct*St*Tt-gt*Pt*Ot,this._y=gt*Pt*Tt+Ct*St*Ot,this._z=gt*St*Ot-Ct*Pt*Tt,this._w=gt*St*Tt+Ct*Pt*Ot;break;case"YZX":this._x=Ct*St*Tt+gt*Pt*Ot,this._y=gt*Pt*Tt+Ct*St*Ot,this._z=gt*St*Ot-Ct*Pt*Tt,this._w=gt*St*Tt-Ct*Pt*Ot;break;case"XZY":this._x=Ct*St*Tt-gt*Pt*Ot,this._y=gt*Pt*Tt-Ct*St*Ot,this._z=gt*St*Ot+Ct*Pt*Tt,this._w=gt*St*Tt+Ct*Pt*Ot;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+ot)}return _!==!1&&this._onChangeCallback(),this}setFromAxisAngle(o,_){const $=_/2,_e=Math.sin($);return this._x=o.x*_e,this._y=o.y*_e,this._z=o.z*_e,this._w=Math.cos($),this._onChangeCallback(),this}setFromRotationMatrix(o){const _=o.elements,$=_[0],_e=_[4],it=_[8],ot=_[1],ct=_[5],mt=_[9],gt=_[2],St=_[6],Tt=_[10],Ct=$+ct+Tt;if(Ct>0){const Pt=.5/Math.sqrt(Ct+1);this._w=.25/Pt,this._x=(St-mt)*Pt,this._y=(it-gt)*Pt,this._z=(ot-_e)*Pt}else if($>ct&&$>Tt){const Pt=2*Math.sqrt(1+$-ct-Tt);this._w=(St-mt)/Pt,this._x=.25*Pt,this._y=(_e+ot)/Pt,this._z=(it+gt)/Pt}else if(ct>Tt){const Pt=2*Math.sqrt(1+ct-$-Tt);this._w=(it-gt)/Pt,this._x=(_e+ot)/Pt,this._y=.25*Pt,this._z=(mt+St)/Pt}else{const Pt=2*Math.sqrt(1+Tt-$-ct);this._w=(ot-_e)/Pt,this._x=(it+gt)/Pt,this._y=(mt+St)/Pt,this._z=.25*Pt}return this._onChangeCallback(),this}setFromUnitVectors(o,_){let $=o.dot(_)+1;return $<Number.EPSILON?($=0,Math.abs(o.x)>Math.abs(o.z)?(this._x=-o.y,this._y=o.x,this._z=0,this._w=$):(this._x=0,this._y=-o.z,this._z=o.y,this._w=$)):(this._x=o.y*_.z-o.z*_.y,this._y=o.z*_.x-o.x*_.z,this._z=o.x*_.y-o.y*_.x,this._w=$),this.normalize()}angleTo(o){return 2*Math.acos(Math.abs(Ms(this.dot(o),-1,1)))}rotateTowards(o,_){const $=this.angleTo(o);if($===0)return this;const _e=Math.min(1,_/$);return this.slerp(o,_e),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(o){return this._x*o._x+this._y*o._y+this._z*o._z+this._w*o._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let o=this.length();return o===0?(this._x=0,this._y=0,this._z=0,this._w=1):(o=1/o,this._x=this._x*o,this._y=this._y*o,this._z=this._z*o,this._w=this._w*o),this._onChangeCallback(),this}multiply(o){return this.multiplyQuaternions(this,o)}premultiply(o){return this.multiplyQuaternions(o,this)}multiplyQuaternions(o,_){const $=o._x,_e=o._y,it=o._z,ot=o._w,ct=_._x,mt=_._y,gt=_._z,St=_._w;return this._x=$*St+ot*ct+_e*gt-it*mt,this._y=_e*St+ot*mt+it*ct-$*gt,this._z=it*St+ot*gt+$*mt-_e*ct,this._w=ot*St-$*ct-_e*mt-it*gt,this._onChangeCallback(),this}slerp(o,_){if(_===0)return this;if(_===1)return this.copy(o);const $=this._x,_e=this._y,it=this._z,ot=this._w;let ct=ot*o._w+$*o._x+_e*o._y+it*o._z;if(ct<0?(this._w=-o._w,this._x=-o._x,this._y=-o._y,this._z=-o._z,ct=-ct):this.copy(o),ct>=1)return this._w=ot,this._x=$,this._y=_e,this._z=it,this;const mt=1-ct*ct;if(mt<=Number.EPSILON){const Pt=1-_;return this._w=Pt*ot+_*this._w,this._x=Pt*$+_*this._x,this._y=Pt*_e+_*this._y,this._z=Pt*it+_*this._z,this.normalize(),this._onChangeCallback(),this}const gt=Math.sqrt(mt),St=Math.atan2(gt,ct),Tt=Math.sin((1-_)*St)/gt,Ct=Math.sin(_*St)/gt;return this._w=ot*Tt+this._w*Ct,this._x=$*Tt+this._x*Ct,this._y=_e*Tt+this._y*Ct,this._z=it*Tt+this._z*Ct,this._onChangeCallback(),this}slerpQuaternions(o,_,$){return this.copy(o).slerp(_,$)}random(){const o=Math.random(),_=Math.sqrt(1-o),$=Math.sqrt(o),_e=2*Math.PI*Math.random(),it=2*Math.PI*Math.random();return this.set(_*Math.cos(_e),$*Math.sin(it),$*Math.cos(it),_*Math.sin(_e))}equals(o){return o._x===this._x&&o._y===this._y&&o._z===this._z&&o._w===this._w}fromArray(o,_=0){return this._x=o[_],this._y=o[_+1],this._z=o[_+2],this._w=o[_+3],this._onChangeCallback(),this}toArray(o=[],_=0){return o[_]=this._x,o[_+1]=this._y,o[_+2]=this._z,o[_+3]=this._w,o}fromBufferAttribute(o,_){return this._x=o.getX(_),this._y=o.getY(_),this._z=o.getZ(_),this._w=o.getW(_),this}_onChange(o){return this._onChangeCallback=o,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class An{constructor(o=0,_=0,$=0){An.prototype.isVector3=!0,this.x=o,this.y=_,this.z=$}set(o,_,$){return $===void 0&&($=this.z),this.x=o,this.y=_,this.z=$,this}setScalar(o){return this.x=o,this.y=o,this.z=o,this}setX(o){return this.x=o,this}setY(o){return this.y=o,this}setZ(o){return this.z=o,this}setComponent(o,_){switch(o){case 0:this.x=_;break;case 1:this.y=_;break;case 2:this.z=_;break;default:throw new Error("index is out of range: "+o)}return this}getComponent(o){switch(o){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+o)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(o){return this.x=o.x,this.y=o.y,this.z=o.z,this}add(o){return this.x+=o.x,this.y+=o.y,this.z+=o.z,this}addScalar(o){return this.x+=o,this.y+=o,this.z+=o,this}addVectors(o,_){return this.x=o.x+_.x,this.y=o.y+_.y,this.z=o.z+_.z,this}addScaledVector(o,_){return this.x+=o.x*_,this.y+=o.y*_,this.z+=o.z*_,this}sub(o){return this.x-=o.x,this.y-=o.y,this.z-=o.z,this}subScalar(o){return this.x-=o,this.y-=o,this.z-=o,this}subVectors(o,_){return this.x=o.x-_.x,this.y=o.y-_.y,this.z=o.z-_.z,this}multiply(o){return this.x*=o.x,this.y*=o.y,this.z*=o.z,this}multiplyScalar(o){return this.x*=o,this.y*=o,this.z*=o,this}multiplyVectors(o,_){return this.x=o.x*_.x,this.y=o.y*_.y,this.z=o.z*_.z,this}applyEuler(o){return this.applyQuaternion(em.setFromEuler(o))}applyAxisAngle(o,_){return this.applyQuaternion(em.setFromAxisAngle(o,_))}applyMatrix3(o){const _=this.x,$=this.y,_e=this.z,it=o.elements;return this.x=it[0]*_+it[3]*$+it[6]*_e,this.y=it[1]*_+it[4]*$+it[7]*_e,this.z=it[2]*_+it[5]*$+it[8]*_e,this}applyNormalMatrix(o){return this.applyMatrix3(o).normalize()}applyMatrix4(o){const _=this.x,$=this.y,_e=this.z,it=o.elements,ot=1/(it[3]*_+it[7]*$+it[11]*_e+it[15]);return this.x=(it[0]*_+it[4]*$+it[8]*_e+it[12])*ot,this.y=(it[1]*_+it[5]*$+it[9]*_e+it[13])*ot,this.z=(it[2]*_+it[6]*$+it[10]*_e+it[14])*ot,this}applyQuaternion(o){const _=this.x,$=this.y,_e=this.z,it=o.x,ot=o.y,ct=o.z,mt=o.w,gt=mt*_+ot*_e-ct*$,St=mt*$+ct*_-it*_e,Tt=mt*_e+it*$-ot*_,Ct=-it*_-ot*$-ct*_e;return this.x=gt*mt+Ct*-it+St*-ct-Tt*-ot,this.y=St*mt+Ct*-ot+Tt*-it-gt*-ct,this.z=Tt*mt+Ct*-ct+gt*-ot-St*-it,this}project(o){return this.applyMatrix4(o.matrixWorldInverse).applyMatrix4(o.projectionMatrix)}unproject(o){return this.applyMatrix4(o.projectionMatrixInverse).applyMatrix4(o.matrixWorld)}transformDirection(o){const _=this.x,$=this.y,_e=this.z,it=o.elements;return this.x=it[0]*_+it[4]*$+it[8]*_e,this.y=it[1]*_+it[5]*$+it[9]*_e,this.z=it[2]*_+it[6]*$+it[10]*_e,this.normalize()}divide(o){return this.x/=o.x,this.y/=o.y,this.z/=o.z,this}divideScalar(o){return this.multiplyScalar(1/o)}min(o){return this.x=Math.min(this.x,o.x),this.y=Math.min(this.y,o.y),this.z=Math.min(this.z,o.z),this}max(o){return this.x=Math.max(this.x,o.x),this.y=Math.max(this.y,o.y),this.z=Math.max(this.z,o.z),this}clamp(o,_){return this.x=Math.max(o.x,Math.min(_.x,this.x)),this.y=Math.max(o.y,Math.min(_.y,this.y)),this.z=Math.max(o.z,Math.min(_.z,this.z)),this}clampScalar(o,_){return this.x=Math.max(o,Math.min(_,this.x)),this.y=Math.max(o,Math.min(_,this.y)),this.z=Math.max(o,Math.min(_,this.z)),this}clampLength(o,_){const $=this.length();return this.divideScalar($||1).multiplyScalar(Math.max(o,Math.min(_,$)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(o){return this.x*o.x+this.y*o.y+this.z*o.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(o){return this.normalize().multiplyScalar(o)}lerp(o,_){return this.x+=(o.x-this.x)*_,this.y+=(o.y-this.y)*_,this.z+=(o.z-this.z)*_,this}lerpVectors(o,_,$){return this.x=o.x+(_.x-o.x)*$,this.y=o.y+(_.y-o.y)*$,this.z=o.z+(_.z-o.z)*$,this}cross(o){return this.crossVectors(this,o)}crossVectors(o,_){const $=o.x,_e=o.y,it=o.z,ot=_.x,ct=_.y,mt=_.z;return this.x=_e*mt-it*ct,this.y=it*ot-$*mt,this.z=$*ct-_e*ot,this}projectOnVector(o){const _=o.lengthSq();if(_===0)return this.set(0,0,0);const $=o.dot(this)/_;return this.copy(o).multiplyScalar($)}projectOnPlane(o){return mv.copy(this).projectOnVector(o),this.sub(mv)}reflect(o){return this.sub(mv.copy(o).multiplyScalar(2*this.dot(o)))}angleTo(o){const _=Math.sqrt(this.lengthSq()*o.lengthSq());if(_===0)return Math.PI/2;const $=this.dot(o)/_;return Math.acos(Ms($,-1,1))}distanceTo(o){return Math.sqrt(this.distanceToSquared(o))}distanceToSquared(o){const _=this.x-o.x,$=this.y-o.y,_e=this.z-o.z;return _*_+$*$+_e*_e}manhattanDistanceTo(o){return Math.abs(this.x-o.x)+Math.abs(this.y-o.y)+Math.abs(this.z-o.z)}setFromSpherical(o){return this.setFromSphericalCoords(o.radius,o.phi,o.theta)}setFromSphericalCoords(o,_,$){const _e=Math.sin(_)*o;return this.x=_e*Math.sin($),this.y=Math.cos(_)*o,this.z=_e*Math.cos($),this}setFromCylindrical(o){return this.setFromCylindricalCoords(o.radius,o.theta,o.y)}setFromCylindricalCoords(o,_,$){return this.x=o*Math.sin(_),this.y=$,this.z=o*Math.cos(_),this}setFromMatrixPosition(o){const _=o.elements;return this.x=_[12],this.y=_[13],this.z=_[14],this}setFromMatrixScale(o){const _=this.setFromMatrixColumn(o,0).length(),$=this.setFromMatrixColumn(o,1).length(),_e=this.setFromMatrixColumn(o,2).length();return this.x=_,this.y=$,this.z=_e,this}setFromMatrixColumn(o,_){return this.fromArray(o.elements,4*_)}setFromMatrix3Column(o,_){return this.fromArray(o.elements,3*_)}setFromEuler(o){return this.x=o._x,this.y=o._y,this.z=o._z,this}equals(o){return o.x===this.x&&o.y===this.y&&o.z===this.z}fromArray(o,_=0){return this.x=o[_],this.y=o[_+1],this.z=o[_+2],this}toArray(o=[],_=0){return o[_]=this.x,o[_+1]=this.y,o[_+2]=this.z,o}fromBufferAttribute(o,_){return this.x=o.getX(_),this.y=o.getY(_),this.z=o.getZ(_),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const o=2*(Math.random()-.5),_=Math.random()*Math.PI*2,$=Math.sqrt(1-o**2);return this.x=$*Math.cos(_),this.y=$*Math.sin(_),this.z=o,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const mv=new An,em=new Lu;class L_{constructor(o=new An(1/0,1/0,1/0),_=new An(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=o,this.max=_}set(o,_){return this.min.copy(o),this.max.copy(_),this}setFromArray(o){let _=1/0,$=1/0,_e=1/0,it=-1/0,ot=-1/0,ct=-1/0;for(let mt=0,gt=o.length;mt<gt;mt+=3){const St=o[mt],Tt=o[mt+1],Ct=o[mt+2];St<_&&(_=St),Tt<$&&($=Tt),Ct<_e&&(_e=Ct),St>it&&(it=St),Tt>ot&&(ot=Tt),Ct>ct&&(ct=Ct)}return this.min.set(_,$,_e),this.max.set(it,ot,ct),this}setFromBufferAttribute(o){let _=1/0,$=1/0,_e=1/0,it=-1/0,ot=-1/0,ct=-1/0;for(let mt=0,gt=o.count;mt<gt;mt++){const St=o.getX(mt),Tt=o.getY(mt),Ct=o.getZ(mt);St<_&&(_=St),Tt<$&&($=Tt),Ct<_e&&(_e=Ct),St>it&&(it=St),Tt>ot&&(ot=Tt),Ct>ct&&(ct=Ct)}return this.min.set(_,$,_e),this.max.set(it,ot,ct),this}setFromPoints(o){this.makeEmpty();for(let _=0,$=o.length;_<$;_++)this.expandByPoint(o[_]);return this}setFromCenterAndSize(o,_){const $=N_.copy(_).multiplyScalar(.5);return this.min.copy(o).sub($),this.max.copy(o).add($),this}setFromObject(o,_=!1){return this.makeEmpty(),this.expandByObject(o,_)}clone(){return new this.constructor().copy(this)}copy(o){return this.min.copy(o.min),this.max.copy(o.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(o){return this.isEmpty()?o.set(0,0,0):o.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(o){return this.isEmpty()?o.set(0,0,0):o.subVectors(this.max,this.min)}expandByPoint(o){return this.min.min(o),this.max.max(o),this}expandByVector(o){return this.min.sub(o),this.max.add(o),this}expandByScalar(o){return this.min.addScalar(-o),this.max.addScalar(o),this}expandByObject(o,_=!1){o.updateWorldMatrix(!1,!1);const $=o.geometry;if($!==void 0)if(_&&$.attributes!=null&&$.attributes.position!==void 0){const it=$.attributes.position;for(let ot=0,ct=it.count;ot<ct;ot++)N_.fromBufferAttribute(it,ot).applyMatrix4(o.matrixWorld),this.expandByPoint(N_)}else $.boundingBox===null&&$.computeBoundingBox(),CA.copy($.boundingBox),CA.applyMatrix4(o.matrixWorld),this.union(CA);const _e=o.children;for(let it=0,ot=_e.length;it<ot;it++)this.expandByObject(_e[it],_);return this}containsPoint(o){return!(o.x<this.min.x||o.x>this.max.x||o.y<this.min.y||o.y>this.max.y||o.z<this.min.z||o.z>this.max.z)}containsBox(o){return this.min.x<=o.min.x&&o.max.x<=this.max.x&&this.min.y<=o.min.y&&o.max.y<=this.max.y&&this.min.z<=o.min.z&&o.max.z<=this.max.z}getParameter(o,_){return _.set((o.x-this.min.x)/(this.max.x-this.min.x),(o.y-this.min.y)/(this.max.y-this.min.y),(o.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(o){return!(o.max.x<this.min.x||o.min.x>this.max.x||o.max.y<this.min.y||o.min.y>this.max.y||o.max.z<this.min.z||o.min.z>this.max.z)}intersectsSphere(o){return this.clampPoint(o.center,N_),N_.distanceToSquared(o.center)<=o.radius*o.radius}intersectsPlane(o){let _,$;return o.normal.x>0?(_=o.normal.x*this.min.x,$=o.normal.x*this.max.x):(_=o.normal.x*this.max.x,$=o.normal.x*this.min.x),o.normal.y>0?(_+=o.normal.y*this.min.y,$+=o.normal.y*this.max.y):(_+=o.normal.y*this.max.y,$+=o.normal.y*this.min.y),o.normal.z>0?(_+=o.normal.z*this.min.z,$+=o.normal.z*this.max.z):(_+=o.normal.z*this.max.z,$+=o.normal.z*this.min.z),_<=-o.constant&&$>=-o.constant}intersectsTriangle(o){if(this.isEmpty())return!1;this.getCenter(I0),MA.subVectors(this.max,I0),xm.subVectors(o.a,I0),Yv.subVectors(o.b,I0),vv.subVectors(o.c,I0),bm.subVectors(Yv,xm),Xv.subVectors(vv,Yv),bp.subVectors(xm,vv);let _=[0,-bm.z,bm.y,0,-Xv.z,Xv.y,0,-bp.z,bp.y,bm.z,0,-bm.x,Xv.z,0,-Xv.x,bp.z,0,-bp.x,-bm.y,bm.x,0,-Xv.y,Xv.x,0,-bp.y,bp.x,0];return!!TA(_,xm,Yv,vv,MA)&&(_=[1,0,0,0,1,0,0,0,1],!!TA(_,xm,Yv,vv,MA)&&(F_.crossVectors(bm,Xv),_=[F_.x,F_.y,F_.z],TA(_,xm,Yv,vv,MA)))}clampPoint(o,_){return _.copy(o).clamp(this.min,this.max)}distanceToPoint(o){return N_.copy(o).clamp(this.min,this.max).sub(o).length()}getBoundingSphere(o){return this.getCenter(o.center),o.radius=.5*this.getSize(N_).length(),o}intersect(o){return this.min.max(o.min),this.max.min(o.max),this.isEmpty()&&this.makeEmpty(),this}union(o){return this.min.min(o.min),this.max.max(o.max),this}applyMatrix4(o){return this.isEmpty()||(gv[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(o),gv[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(o),gv[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(o),gv[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(o),gv[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(o),gv[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(o),gv[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(o),gv[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(o),this.setFromPoints(gv)),this}translate(o){return this.min.add(o),this.max.add(o),this}equals(o){return o.min.equals(this.min)&&o.max.equals(this.max)}}const gv=[new An,new An,new An,new An,new An,new An,new An,new An],N_=new An,CA=new L_,xm=new An,Yv=new An,vv=new An,bm=new An,Xv=new An,bp=new An,I0=new An,MA=new An,F_=new An,Kv=new An;function TA(ut,o,_,$,_e){for(let it=0,ot=ut.length-3;it<=ot;it+=3){Kv.fromArray(ut,it);const ct=_e.x*Math.abs(Kv.x)+_e.y*Math.abs(Kv.y)+_e.z*Math.abs(Kv.z),mt=o.dot(Kv),gt=_.dot(Kv),St=$.dot(Kv);if(Math.max(-Math.max(mt,gt,St),Math.min(mt,gt,St))>ct)return!1}return!0}const xo=new L_,Sl=new An,tm=new An,Bp=new An;class nm{constructor(o=new An,_=-1){this.center=o,this.radius=_}set(o,_){return this.center.copy(o),this.radius=_,this}setFromPoints(o,_){const $=this.center;_!==void 0?$.copy(_):xo.setFromPoints(o).getCenter($);let _e=0;for(let it=0,ot=o.length;it<ot;it++)_e=Math.max(_e,$.distanceToSquared(o[it]));return this.radius=Math.sqrt(_e),this}copy(o){return this.center.copy(o.center),this.radius=o.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(o){return o.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(o){return o.distanceTo(this.center)-this.radius}intersectsSphere(o){const _=this.radius+o.radius;return o.center.distanceToSquared(this.center)<=_*_}intersectsBox(o){return o.intersectsSphere(this)}intersectsPlane(o){return Math.abs(o.distanceToPoint(this.center))<=this.radius}clampPoint(o,_){const $=this.center.distanceToSquared(o);return _.copy(o),$>this.radius*this.radius&&(_.sub(this.center).normalize(),_.multiplyScalar(this.radius).add(this.center)),_}getBoundingBox(o){return this.isEmpty()?(o.makeEmpty(),o):(o.set(this.center,this.center),o.expandByScalar(this.radius),o)}applyMatrix4(o){return this.center.applyMatrix4(o),this.radius=this.radius*o.getMaxScaleOnAxis(),this}translate(o){return this.center.add(o),this}expandByPoint(o){Bp.subVectors(o,this.center);const _=Bp.lengthSq();if(_>this.radius*this.radius){const $=Math.sqrt(_),_e=.5*($-this.radius);this.center.add(Bp.multiplyScalar(_e/$)),this.radius+=_e}return this}union(o){return this.center.equals(o.center)===!0?tm.set(0,0,1).multiplyScalar(o.radius):tm.subVectors(o.center,this.center).normalize().multiplyScalar(o.radius),this.expandByPoint(Sl.copy(o.center).add(tm)),this.expandByPoint(Sl.copy(o.center).sub(tm)),this}equals(o){return o.center.equals(this.center)&&o.radius===this.radius}clone(){return new this.constructor().copy(this)}}const fu=new An,IA=new An,P0=new An,Qm=new An,D0=new An,Iy=new An,PA=new An;class $v{constructor(o=new An,_=new An(0,0,-1)){this.origin=o,this.direction=_}set(o,_){return this.origin.copy(o),this.direction.copy(_),this}copy(o){return this.origin.copy(o.origin),this.direction.copy(o.direction),this}at(o,_){return _.copy(this.direction).multiplyScalar(o).add(this.origin)}lookAt(o){return this.direction.copy(o).sub(this.origin).normalize(),this}recast(o){return this.origin.copy(this.at(o,fu)),this}closestPointToPoint(o,_){_.subVectors(o,this.origin);const $=_.dot(this.direction);return $<0?_.copy(this.origin):_.copy(this.direction).multiplyScalar($).add(this.origin)}distanceToPoint(o){return Math.sqrt(this.distanceSqToPoint(o))}distanceSqToPoint(o){const _=fu.subVectors(o,this.origin).dot(this.direction);return _<0?this.origin.distanceToSquared(o):(fu.copy(this.direction).multiplyScalar(_).add(this.origin),fu.distanceToSquared(o))}distanceSqToSegment(o,_,$,_e){IA.copy(o).add(_).multiplyScalar(.5),P0.copy(_).sub(o).normalize(),Qm.copy(this.origin).sub(IA);const it=.5*o.distanceTo(_),ot=-this.direction.dot(P0),ct=Qm.dot(this.direction),mt=-Qm.dot(P0),gt=Qm.lengthSq(),St=Math.abs(1-ot*ot);let Tt,Ct,Pt,Ot;if(St>0)if(Tt=ot*mt-ct,Ct=ot*ct-mt,Ot=it*St,Tt>=0)if(Ct>=-Ot)if(Ct<=Ot){const Dt=1/St;Tt*=Dt,Ct*=Dt,Pt=Tt*(Tt+ot*Ct+2*ct)+Ct*(ot*Tt+Ct+2*mt)+gt}else Ct=it,Tt=Math.max(0,-(ot*Ct+ct)),Pt=-Tt*Tt+Ct*(Ct+2*mt)+gt;else Ct=-it,Tt=Math.max(0,-(ot*Ct+ct)),Pt=-Tt*Tt+Ct*(Ct+2*mt)+gt;else Ct<=-Ot?(Tt=Math.max(0,-(-ot*it+ct)),Ct=Tt>0?-it:Math.min(Math.max(-it,-mt),it),Pt=-Tt*Tt+Ct*(Ct+2*mt)+gt):Ct<=Ot?(Tt=0,Ct=Math.min(Math.max(-it,-mt),it),Pt=Ct*(Ct+2*mt)+gt):(Tt=Math.max(0,-(ot*it+ct)),Ct=Tt>0?it:Math.min(Math.max(-it,-mt),it),Pt=-Tt*Tt+Ct*(Ct+2*mt)+gt);else Ct=ot>0?-it:it,Tt=Math.max(0,-(ot*Ct+ct)),Pt=-Tt*Tt+Ct*(Ct+2*mt)+gt;return $&&$.copy(this.direction).multiplyScalar(Tt).add(this.origin),_e&&_e.copy(P0).multiplyScalar(Ct).add(IA),Pt}intersectSphere(o,_){fu.subVectors(o.center,this.origin);const $=fu.dot(this.direction),_e=fu.dot(fu)-$*$,it=o.radius*o.radius;if(_e>it)return null;const ot=Math.sqrt(it-_e),ct=$-ot,mt=$+ot;return ct<0&&mt<0?null:ct<0?this.at(mt,_):this.at(ct,_)}intersectsSphere(o){return this.distanceSqToPoint(o.center)<=o.radius*o.radius}distanceToPlane(o){const _=o.normal.dot(this.direction);if(_===0)return o.distanceToPoint(this.origin)===0?0:null;const $=-(this.origin.dot(o.normal)+o.constant)/_;return $>=0?$:null}intersectPlane(o,_){const $=this.distanceToPlane(o);return $===null?null:this.at($,_)}intersectsPlane(o){const _=o.distanceToPoint(this.origin);return _===0||o.normal.dot(this.direction)*_<0}intersectBox(o,_){let $,_e,it,ot,ct,mt;const gt=1/this.direction.x,St=1/this.direction.y,Tt=1/this.direction.z,Ct=this.origin;return gt>=0?($=(o.min.x-Ct.x)*gt,_e=(o.max.x-Ct.x)*gt):($=(o.max.x-Ct.x)*gt,_e=(o.min.x-Ct.x)*gt),St>=0?(it=(o.min.y-Ct.y)*St,ot=(o.max.y-Ct.y)*St):(it=(o.max.y-Ct.y)*St,ot=(o.min.y-Ct.y)*St),$>ot||it>_e?null:((it>$||$!=$)&&($=it),(ot<_e||_e!=_e)&&(_e=ot),Tt>=0?(ct=(o.min.z-Ct.z)*Tt,mt=(o.max.z-Ct.z)*Tt):(ct=(o.max.z-Ct.z)*Tt,mt=(o.min.z-Ct.z)*Tt),$>mt||ct>_e?null:((ct>$||$!=$)&&($=ct),(mt<_e||_e!=_e)&&(_e=mt),_e<0?null:this.at($>=0?$:_e,_)))}intersectsBox(o){return this.intersectBox(o,fu)!==null}intersectTriangle(o,_,$,_e,it){D0.subVectors(_,o),Iy.subVectors($,o),PA.crossVectors(D0,Iy);let ot,ct=this.direction.dot(PA);if(ct>0){if(_e)return null;ot=1}else{if(!(ct<0))return null;ot=-1,ct=-ct}Qm.subVectors(this.origin,o);const mt=ot*this.direction.dot(Iy.crossVectors(Qm,Iy));if(mt<0)return null;const gt=ot*this.direction.dot(D0.cross(Qm));if(gt<0||mt+gt>ct)return null;const St=-ot*Qm.dot(PA);return St<0?null:this.at(St/ct,it)}applyMatrix4(o){return this.origin.applyMatrix4(o),this.direction.transformDirection(o),this}equals(o){return o.origin.equals(this.origin)&&o.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Us{constructor(){Us.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(o,_,$,_e,it,ot,ct,mt,gt,St,Tt,Ct,Pt,Ot,Dt,Yt){const Xt=this.elements;return Xt[0]=o,Xt[4]=_,Xt[8]=$,Xt[12]=_e,Xt[1]=it,Xt[5]=ot,Xt[9]=ct,Xt[13]=mt,Xt[2]=gt,Xt[6]=St,Xt[10]=Tt,Xt[14]=Ct,Xt[3]=Pt,Xt[7]=Ot,Xt[11]=Dt,Xt[15]=Yt,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Us().fromArray(this.elements)}copy(o){const _=this.elements,$=o.elements;return _[0]=$[0],_[1]=$[1],_[2]=$[2],_[3]=$[3],_[4]=$[4],_[5]=$[5],_[6]=$[6],_[7]=$[7],_[8]=$[8],_[9]=$[9],_[10]=$[10],_[11]=$[11],_[12]=$[12],_[13]=$[13],_[14]=$[14],_[15]=$[15],this}copyPosition(o){const _=this.elements,$=o.elements;return _[12]=$[12],_[13]=$[13],_[14]=$[14],this}setFromMatrix3(o){const _=o.elements;return this.set(_[0],_[3],_[6],0,_[1],_[4],_[7],0,_[2],_[5],_[8],0,0,0,0,1),this}extractBasis(o,_,$){return o.setFromMatrixColumn(this,0),_.setFromMatrixColumn(this,1),$.setFromMatrixColumn(this,2),this}makeBasis(o,_,$){return this.set(o.x,_.x,$.x,0,o.y,_.y,$.y,0,o.z,_.z,$.z,0,0,0,0,1),this}extractRotation(o){const _=this.elements,$=o.elements,_e=1/qo.setFromMatrixColumn(o,0).length(),it=1/qo.setFromMatrixColumn(o,1).length(),ot=1/qo.setFromMatrixColumn(o,2).length();return _[0]=$[0]*_e,_[1]=$[1]*_e,_[2]=$[2]*_e,_[3]=0,_[4]=$[4]*it,_[5]=$[5]*it,_[6]=$[6]*it,_[7]=0,_[8]=$[8]*ot,_[9]=$[9]*ot,_[10]=$[10]*ot,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,this}makeRotationFromEuler(o){const _=this.elements,$=o.x,_e=o.y,it=o.z,ot=Math.cos($),ct=Math.sin($),mt=Math.cos(_e),gt=Math.sin(_e),St=Math.cos(it),Tt=Math.sin(it);if(o.order==="XYZ"){const Ct=ot*St,Pt=ot*Tt,Ot=ct*St,Dt=ct*Tt;_[0]=mt*St,_[4]=-mt*Tt,_[8]=gt,_[1]=Pt+Ot*gt,_[5]=Ct-Dt*gt,_[9]=-ct*mt,_[2]=Dt-Ct*gt,_[6]=Ot+Pt*gt,_[10]=ot*mt}else if(o.order==="YXZ"){const Ct=mt*St,Pt=mt*Tt,Ot=gt*St,Dt=gt*Tt;_[0]=Ct+Dt*ct,_[4]=Ot*ct-Pt,_[8]=ot*gt,_[1]=ot*Tt,_[5]=ot*St,_[9]=-ct,_[2]=Pt*ct-Ot,_[6]=Dt+Ct*ct,_[10]=ot*mt}else if(o.order==="ZXY"){const Ct=mt*St,Pt=mt*Tt,Ot=gt*St,Dt=gt*Tt;_[0]=Ct-Dt*ct,_[4]=-ot*Tt,_[8]=Ot+Pt*ct,_[1]=Pt+Ot*ct,_[5]=ot*St,_[9]=Dt-Ct*ct,_[2]=-ot*gt,_[6]=ct,_[10]=ot*mt}else if(o.order==="ZYX"){const Ct=ot*St,Pt=ot*Tt,Ot=ct*St,Dt=ct*Tt;_[0]=mt*St,_[4]=Ot*gt-Pt,_[8]=Ct*gt+Dt,_[1]=mt*Tt,_[5]=Dt*gt+Ct,_[9]=Pt*gt-Ot,_[2]=-gt,_[6]=ct*mt,_[10]=ot*mt}else if(o.order==="YZX"){const Ct=ot*mt,Pt=ot*gt,Ot=ct*mt,Dt=ct*gt;_[0]=mt*St,_[4]=Dt-Ct*Tt,_[8]=Ot*Tt+Pt,_[1]=Tt,_[5]=ot*St,_[9]=-ct*St,_[2]=-gt*St,_[6]=Pt*Tt+Ot,_[10]=Ct-Dt*Tt}else if(o.order==="XZY"){const Ct=ot*mt,Pt=ot*gt,Ot=ct*mt,Dt=ct*gt;_[0]=mt*St,_[4]=-Tt,_[8]=gt*St,_[1]=Ct*Tt+Dt,_[5]=ot*St,_[9]=Pt*Tt-Ot,_[2]=Ot*Tt-Pt,_[6]=ct*St,_[10]=Dt*Tt+Ct}return _[3]=0,_[7]=0,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,this}makeRotationFromQuaternion(o){return this.compose(rm,o,_v)}lookAt(o,_,$){const _e=this.elements;return Ep.subVectors(o,_),Ep.lengthSq()===0&&(Ep.z=1),Ep.normalize(),Su.crossVectors($,Ep),Su.lengthSq()===0&&(Math.abs($.z)===1?Ep.x+=1e-4:Ep.z+=1e-4,Ep.normalize(),Su.crossVectors($,Ep)),Su.normalize(),R0.crossVectors(Ep,Su),_e[0]=Su.x,_e[4]=R0.x,_e[8]=Ep.x,_e[1]=Su.y,_e[5]=R0.y,_e[9]=Ep.y,_e[2]=Su.z,_e[6]=R0.z,_e[10]=Ep.z,this}multiply(o){return this.multiplyMatrices(this,o)}premultiply(o){return this.multiplyMatrices(o,this)}multiplyMatrices(o,_){const $=o.elements,_e=_.elements,it=this.elements,ot=$[0],ct=$[4],mt=$[8],gt=$[12],St=$[1],Tt=$[5],Ct=$[9],Pt=$[13],Ot=$[2],Dt=$[6],Yt=$[10],Xt=$[14],Jt=$[3],an=$[7],fn=$[11],gn=$[15],_n=_e[0],On=_e[4],Ln=_e[8],$n=_e[12],Jn=_e[1],Un=_e[5],Er=_e[9],Or=_e[13],xr=_e[2],Gr=_e[6],Hr=_e[10],pr=_e[14],vr=_e[3],jr=_e[7],Sr=_e[11],Qr=_e[15];return it[0]=ot*_n+ct*Jn+mt*xr+gt*vr,it[4]=ot*On+ct*Un+mt*Gr+gt*jr,it[8]=ot*Ln+ct*Er+mt*Hr+gt*Sr,it[12]=ot*$n+ct*Or+mt*pr+gt*Qr,it[1]=St*_n+Tt*Jn+Ct*xr+Pt*vr,it[5]=St*On+Tt*Un+Ct*Gr+Pt*jr,it[9]=St*Ln+Tt*Er+Ct*Hr+Pt*Sr,it[13]=St*$n+Tt*Or+Ct*pr+Pt*Qr,it[2]=Ot*_n+Dt*Jn+Yt*xr+Xt*vr,it[6]=Ot*On+Dt*Un+Yt*Gr+Xt*jr,it[10]=Ot*Ln+Dt*Er+Yt*Hr+Xt*Sr,it[14]=Ot*$n+Dt*Or+Yt*pr+Xt*Qr,it[3]=Jt*_n+an*Jn+fn*xr+gn*vr,it[7]=Jt*On+an*Un+fn*Gr+gn*jr,it[11]=Jt*Ln+an*Er+fn*Hr+gn*Sr,it[15]=Jt*$n+an*Or+fn*pr+gn*Qr,this}multiplyScalar(o){const _=this.elements;return _[0]*=o,_[4]*=o,_[8]*=o,_[12]*=o,_[1]*=o,_[5]*=o,_[9]*=o,_[13]*=o,_[2]*=o,_[6]*=o,_[10]*=o,_[14]*=o,_[3]*=o,_[7]*=o,_[11]*=o,_[15]*=o,this}determinant(){const o=this.elements,_=o[0],$=o[4],_e=o[8],it=o[12],ot=o[1],ct=o[5],mt=o[9],gt=o[13],St=o[2],Tt=o[6],Ct=o[10],Pt=o[14];return o[3]*(+it*mt*Tt-_e*gt*Tt-it*ct*Ct+$*gt*Ct+_e*ct*Pt-$*mt*Pt)+o[7]*(+_*mt*Pt-_*gt*Ct+it*ot*Ct-_e*ot*Pt+_e*gt*St-it*mt*St)+o[11]*(+_*gt*Tt-_*ct*Pt-it*ot*Tt+$*ot*Pt+it*ct*St-$*gt*St)+o[15]*(-_e*ct*St-_*mt*Tt+_*ct*Ct+_e*ot*Tt-$*ot*Ct+$*mt*St)}transpose(){const o=this.elements;let _;return _=o[1],o[1]=o[4],o[4]=_,_=o[2],o[2]=o[8],o[8]=_,_=o[6],o[6]=o[9],o[9]=_,_=o[3],o[3]=o[12],o[12]=_,_=o[7],o[7]=o[13],o[13]=_,_=o[11],o[11]=o[14],o[14]=_,this}setPosition(o,_,$){const _e=this.elements;return o.isVector3?(_e[12]=o.x,_e[13]=o.y,_e[14]=o.z):(_e[12]=o,_e[13]=_,_e[14]=$),this}invert(){const o=this.elements,_=o[0],$=o[1],_e=o[2],it=o[3],ot=o[4],ct=o[5],mt=o[6],gt=o[7],St=o[8],Tt=o[9],Ct=o[10],Pt=o[11],Ot=o[12],Dt=o[13],Yt=o[14],Xt=o[15],Jt=Tt*Yt*gt-Dt*Ct*gt+Dt*mt*Pt-ct*Yt*Pt-Tt*mt*Xt+ct*Ct*Xt,an=Ot*Ct*gt-St*Yt*gt-Ot*mt*Pt+ot*Yt*Pt+St*mt*Xt-ot*Ct*Xt,fn=St*Dt*gt-Ot*Tt*gt+Ot*ct*Pt-ot*Dt*Pt-St*ct*Xt+ot*Tt*Xt,gn=Ot*Tt*mt-St*Dt*mt-Ot*ct*Ct+ot*Dt*Ct+St*ct*Yt-ot*Tt*Yt,_n=_*Jt+$*an+_e*fn+it*gn;if(_n===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const On=1/_n;return o[0]=Jt*On,o[1]=(Dt*Ct*it-Tt*Yt*it-Dt*_e*Pt+$*Yt*Pt+Tt*_e*Xt-$*Ct*Xt)*On,o[2]=(ct*Yt*it-Dt*mt*it+Dt*_e*gt-$*Yt*gt-ct*_e*Xt+$*mt*Xt)*On,o[3]=(Tt*mt*it-ct*Ct*it-Tt*_e*gt+$*Ct*gt+ct*_e*Pt-$*mt*Pt)*On,o[4]=an*On,o[5]=(St*Yt*it-Ot*Ct*it+Ot*_e*Pt-_*Yt*Pt-St*_e*Xt+_*Ct*Xt)*On,o[6]=(Ot*mt*it-ot*Yt*it-Ot*_e*gt+_*Yt*gt+ot*_e*Xt-_*mt*Xt)*On,o[7]=(ot*Ct*it-St*mt*it+St*_e*gt-_*Ct*gt-ot*_e*Pt+_*mt*Pt)*On,o[8]=fn*On,o[9]=(Ot*Tt*it-St*Dt*it-Ot*$*Pt+_*Dt*Pt+St*$*Xt-_*Tt*Xt)*On,o[10]=(ot*Dt*it-Ot*ct*it+Ot*$*gt-_*Dt*gt-ot*$*Xt+_*ct*Xt)*On,o[11]=(St*ct*it-ot*Tt*it-St*$*gt+_*Tt*gt+ot*$*Pt-_*ct*Pt)*On,o[12]=gn*On,o[13]=(St*Dt*_e-Ot*Tt*_e+Ot*$*Ct-_*Dt*Ct-St*$*Yt+_*Tt*Yt)*On,o[14]=(Ot*ct*_e-ot*Dt*_e-Ot*$*mt+_*Dt*mt+ot*$*Yt-_*ct*Yt)*On,o[15]=(ot*Tt*_e-St*ct*_e+St*$*mt-_*Tt*mt-ot*$*Ct+_*ct*Ct)*On,this}scale(o){const _=this.elements,$=o.x,_e=o.y,it=o.z;return _[0]*=$,_[4]*=_e,_[8]*=it,_[1]*=$,_[5]*=_e,_[9]*=it,_[2]*=$,_[6]*=_e,_[10]*=it,_[3]*=$,_[7]*=_e,_[11]*=it,this}getMaxScaleOnAxis(){const o=this.elements,_=o[0]*o[0]+o[1]*o[1]+o[2]*o[2],$=o[4]*o[4]+o[5]*o[5]+o[6]*o[6],_e=o[8]*o[8]+o[9]*o[9]+o[10]*o[10];return Math.sqrt(Math.max(_,$,_e))}makeTranslation(o,_,$){return this.set(1,0,0,o,0,1,0,_,0,0,1,$,0,0,0,1),this}makeRotationX(o){const _=Math.cos(o),$=Math.sin(o);return this.set(1,0,0,0,0,_,-$,0,0,$,_,0,0,0,0,1),this}makeRotationY(o){const _=Math.cos(o),$=Math.sin(o);return this.set(_,0,$,0,0,1,0,0,-$,0,_,0,0,0,0,1),this}makeRotationZ(o){const _=Math.cos(o),$=Math.sin(o);return this.set(_,-$,0,0,$,_,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(o,_){const $=Math.cos(_),_e=Math.sin(_),it=1-$,ot=o.x,ct=o.y,mt=o.z,gt=it*ot,St=it*ct;return this.set(gt*ot+$,gt*ct-_e*mt,gt*mt+_e*ct,0,gt*ct+_e*mt,St*ct+$,St*mt-_e*ot,0,gt*mt-_e*ct,St*mt+_e*ot,it*mt*mt+$,0,0,0,0,1),this}makeScale(o,_,$){return this.set(o,0,0,0,0,_,0,0,0,0,$,0,0,0,0,1),this}makeShear(o,_,$,_e,it,ot){return this.set(1,$,it,0,o,1,ot,0,_,_e,1,0,0,0,0,1),this}compose(o,_,$){const _e=this.elements,it=_._x,ot=_._y,ct=_._z,mt=_._w,gt=it+it,St=ot+ot,Tt=ct+ct,Ct=it*gt,Pt=it*St,Ot=it*Tt,Dt=ot*St,Yt=ot*Tt,Xt=ct*Tt,Jt=mt*gt,an=mt*St,fn=mt*Tt,gn=$.x,_n=$.y,On=$.z;return _e[0]=(1-(Dt+Xt))*gn,_e[1]=(Pt+fn)*gn,_e[2]=(Ot-an)*gn,_e[3]=0,_e[4]=(Pt-fn)*_n,_e[5]=(1-(Ct+Xt))*_n,_e[6]=(Yt+Jt)*_n,_e[7]=0,_e[8]=(Ot+an)*On,_e[9]=(Yt-Jt)*On,_e[10]=(1-(Ct+Dt))*On,_e[11]=0,_e[12]=o.x,_e[13]=o.y,_e[14]=o.z,_e[15]=1,this}decompose(o,_,$){const _e=this.elements;let it=qo.set(_e[0],_e[1],_e[2]).length();const ot=qo.set(_e[4],_e[5],_e[6]).length(),ct=qo.set(_e[8],_e[9],_e[10]).length();this.determinant()<0&&(it=-it),o.x=_e[12],o.y=_e[13],o.z=_e[14],Eu.copy(this);const mt=1/it,gt=1/ot,St=1/ct;return Eu.elements[0]*=mt,Eu.elements[1]*=mt,Eu.elements[2]*=mt,Eu.elements[4]*=gt,Eu.elements[5]*=gt,Eu.elements[6]*=gt,Eu.elements[8]*=St,Eu.elements[9]*=St,Eu.elements[10]*=St,_.setFromRotationMatrix(Eu),$.x=it,$.y=ot,$.z=ct,this}makePerspective(o,_,$,_e,it,ot){const ct=this.elements,mt=2*it/(_-o),gt=2*it/($-_e),St=(_+o)/(_-o),Tt=($+_e)/($-_e),Ct=-(ot+it)/(ot-it),Pt=-2*ot*it/(ot-it);return ct[0]=mt,ct[4]=0,ct[8]=St,ct[12]=0,ct[1]=0,ct[5]=gt,ct[9]=Tt,ct[13]=0,ct[2]=0,ct[6]=0,ct[10]=Ct,ct[14]=Pt,ct[3]=0,ct[7]=0,ct[11]=-1,ct[15]=0,this}makeOrthographic(o,_,$,_e,it,ot){const ct=this.elements,mt=1/(_-o),gt=1/($-_e),St=1/(ot-it),Tt=(_+o)*mt,Ct=($+_e)*gt,Pt=(ot+it)*St;return ct[0]=2*mt,ct[4]=0,ct[8]=0,ct[12]=-Tt,ct[1]=0,ct[5]=2*gt,ct[9]=0,ct[13]=-Ct,ct[2]=0,ct[6]=0,ct[10]=-2*St,ct[14]=-Pt,ct[3]=0,ct[7]=0,ct[11]=0,ct[15]=1,this}equals(o){const _=this.elements,$=o.elements;for(let _e=0;_e<16;_e++)if(_[_e]!==$[_e])return!1;return!0}fromArray(o,_=0){for(let $=0;$<16;$++)this.elements[$]=o[$+_];return this}toArray(o=[],_=0){const $=this.elements;return o[_]=$[0],o[_+1]=$[1],o[_+2]=$[2],o[_+3]=$[3],o[_+4]=$[4],o[_+5]=$[5],o[_+6]=$[6],o[_+7]=$[7],o[_+8]=$[8],o[_+9]=$[9],o[_+10]=$[10],o[_+11]=$[11],o[_+12]=$[12],o[_+13]=$[13],o[_+14]=$[14],o[_+15]=$[15],o}}const qo=new An,Eu=new Us,rm=new An(0,0,0),_v=new An(1,1,1),Su=new An,R0=new An,Ep=new An,Ow=new Us,Py=new Lu;class Em{constructor(o=0,_=0,$=0,_e=Em.DefaultOrder){this.isEuler=!0,this._x=o,this._y=_,this._z=$,this._order=_e}get x(){return this._x}set x(o){this._x=o,this._onChangeCallback()}get y(){return this._y}set y(o){this._y=o,this._onChangeCallback()}get z(){return this._z}set z(o){this._z=o,this._onChangeCallback()}get order(){return this._order}set order(o){this._order=o,this._onChangeCallback()}set(o,_,$,_e=this._order){return this._x=o,this._y=_,this._z=$,this._order=_e,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(o){return this._x=o._x,this._y=o._y,this._z=o._z,this._order=o._order,this._onChangeCallback(),this}setFromRotationMatrix(o,_=this._order,$=!0){const _e=o.elements,it=_e[0],ot=_e[4],ct=_e[8],mt=_e[1],gt=_e[5],St=_e[9],Tt=_e[2],Ct=_e[6],Pt=_e[10];switch(_){case"XYZ":this._y=Math.asin(Ms(ct,-1,1)),Math.abs(ct)<.9999999?(this._x=Math.atan2(-St,Pt),this._z=Math.atan2(-ot,it)):(this._x=Math.atan2(Ct,gt),this._z=0);break;case"YXZ":this._x=Math.asin(-Ms(St,-1,1)),Math.abs(St)<.9999999?(this._y=Math.atan2(ct,Pt),this._z=Math.atan2(mt,gt)):(this._y=Math.atan2(-Tt,it),this._z=0);break;case"ZXY":this._x=Math.asin(Ms(Ct,-1,1)),Math.abs(Ct)<.9999999?(this._y=Math.atan2(-Tt,Pt),this._z=Math.atan2(-ot,gt)):(this._y=0,this._z=Math.atan2(mt,it));break;case"ZYX":this._y=Math.asin(-Ms(Tt,-1,1)),Math.abs(Tt)<.9999999?(this._x=Math.atan2(Ct,Pt),this._z=Math.atan2(mt,it)):(this._x=0,this._z=Math.atan2(-ot,gt));break;case"YZX":this._z=Math.asin(Ms(mt,-1,1)),Math.abs(mt)<.9999999?(this._x=Math.atan2(-St,gt),this._y=Math.atan2(-Tt,it)):(this._x=0,this._y=Math.atan2(ct,Pt));break;case"XZY":this._z=Math.asin(-Ms(ot,-1,1)),Math.abs(ot)<.9999999?(this._x=Math.atan2(Ct,gt),this._y=Math.atan2(ct,it)):(this._x=Math.atan2(-St,Pt),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+_)}return this._order=_,$===!0&&this._onChangeCallback(),this}setFromQuaternion(o,_,$){return Ow.makeRotationFromQuaternion(o),this.setFromRotationMatrix(Ow,_,$)}setFromVector3(o,_=this._order){return this.set(o.x,o.y,o.z,_)}reorder(o){return Py.setFromEuler(this),this.setFromQuaternion(Py,o)}equals(o){return o._x===this._x&&o._y===this._y&&o._z===this._z&&o._order===this._order}fromArray(o){return this._x=o[0],this._y=o[1],this._z=o[2],o[3]!==void 0&&(this._order=o[3]),this._onChangeCallback(),this}toArray(o=[],_=0){return o[_]=this._x,o[_+1]=this._y,o[_+2]=this._z,o[_+3]=this._order,o}_onChange(o){return this._onChangeCallback=o,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}Em.DefaultOrder="XYZ",Em.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class cp{constructor(){this.mask=1}set(o){this.mask=(1<<o|0)>>>0}enable(o){this.mask|=1<<o|0}enableAll(){this.mask=-1}toggle(o){this.mask^=1<<o|0}disable(o){this.mask&=~(1<<o|0)}disableAll(){this.mask=0}test(o){return(this.mask&o.mask)!=0}isEnabled(o){return(this.mask&(1<<o|0))!=0}}let yv=0;const U_=new An,Nu=new Lu,Op=new Us,_h=new An,Gm=new An,DA=new An,Jv=new Lu,Dy=new An(1,0,0),j_=new An(0,1,0),Zv=new An(0,0,1),RA={type:"added"},Lw={type:"removed"};class no extends Fs{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:yv++}),this.uuid=Ju(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=no.DefaultUp.clone();const o=new An,_=new Em,$=new Lu,_e=new An(1,1,1);_._onChange(function(){$.setFromEuler(_,!1)}),$._onChange(function(){_.setFromQuaternion($,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:o},rotation:{configurable:!0,enumerable:!0,value:_},quaternion:{configurable:!0,enumerable:!0,value:$},scale:{configurable:!0,enumerable:!0,value:_e},modelViewMatrix:{value:new Us},normalMatrix:{value:new Ou}}),this.matrix=new Us,this.matrixWorld=new Us,this.matrixAutoUpdate=no.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=no.DefaultMatrixWorldAutoUpdate,this.layers=new cp,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(o,_,$,_e,it,ot){this.dispatchEvent({type:"beforeRender",renderer:o,scene:_,camera:$,geometry:_e,material:it,group:ot})}onAfterRender(){}applyMatrix4(o){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(o),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(o){return this.quaternion.premultiply(o),this}setRotationFromAxisAngle(o,_){this.quaternion.setFromAxisAngle(o,_)}setRotationFromEuler(o){this.quaternion.setFromEuler(o,!0)}setRotationFromMatrix(o){this.quaternion.setFromRotationMatrix(o)}setRotationFromQuaternion(o){this.quaternion.copy(o)}rotateOnAxis(o,_){return Nu.setFromAxisAngle(o,_),this.quaternion.multiply(Nu),this}rotateOnWorldAxis(o,_){return Nu.setFromAxisAngle(o,_),this.quaternion.premultiply(Nu),this}rotateX(o){return this.rotateOnAxis(Dy,o)}rotateY(o){return this.rotateOnAxis(j_,o)}rotateZ(o){return this.rotateOnAxis(Zv,o)}translateOnAxis(o,_){return U_.copy(o).applyQuaternion(this.quaternion),this.position.add(U_.multiplyScalar(_)),this}translateX(o){return this.translateOnAxis(Dy,o)}translateY(o){return this.translateOnAxis(j_,o)}translateZ(o){return this.translateOnAxis(Zv,o)}localToWorld(o){return o.applyMatrix4(this.matrixWorld)}worldToLocal(o){return o.applyMatrix4(Op.copy(this.matrixWorld).invert())}lookAt(o,_,$){o.isVector3?_h.copy(o):_h.set(o,_,$);const _e=this.parent;this.updateWorldMatrix(!0,!1),Gm.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Op.lookAt(Gm,_h,this.up):Op.lookAt(_h,Gm,this.up),this.quaternion.setFromRotationMatrix(Op),_e&&(Op.extractRotation(_e.matrixWorld),Nu.setFromRotationMatrix(Op),this.quaternion.premultiply(Nu.invert()))}add(o){if(arguments.length>1){for(let _=0;_<arguments.length;_++)this.add(arguments[_]);return this}return o===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",o),this):(o&&o.isObject3D?(o.parent!==null&&o.parent.remove(o),o.parent=this,this.children.push(o),o.dispatchEvent(RA)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",o),this)}remove(o){if(arguments.length>1){for(let $=0;$<arguments.length;$++)this.remove(arguments[$]);return this}const _=this.children.indexOf(o);return _!==-1&&(o.parent=null,this.children.splice(_,1),o.dispatchEvent(Lw)),this}removeFromParent(){const o=this.parent;return o!==null&&o.remove(this),this}clear(){for(let o=0;o<this.children.length;o++){const _=this.children[o];_.parent=null,_.dispatchEvent(Lw)}return this.children.length=0,this}attach(o){return this.updateWorldMatrix(!0,!1),Op.copy(this.matrixWorld).invert(),o.parent!==null&&(o.parent.updateWorldMatrix(!0,!1),Op.multiply(o.parent.matrixWorld)),o.applyMatrix4(Op),this.add(o),o.updateWorldMatrix(!1,!0),this}getObjectById(o){return this.getObjectByProperty("id",o)}getObjectByName(o){return this.getObjectByProperty("name",o)}getObjectByProperty(o,_){if(this[o]===_)return this;for(let $=0,_e=this.children.length;$<_e;$++){const it=this.children[$].getObjectByProperty(o,_);if(it!==void 0)return it}}getWorldPosition(o){return this.updateWorldMatrix(!0,!1),o.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(o){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Gm,o,DA),o}getWorldScale(o){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Gm,Jv,o),o}getWorldDirection(o){this.updateWorldMatrix(!0,!1);const _=this.matrixWorld.elements;return o.set(_[8],_[9],_[10]).normalize()}raycast(){}traverse(o){o(this);const _=this.children;for(let $=0,_e=_.length;$<_e;$++)_[$].traverse(o)}traverseVisible(o){if(this.visible===!1)return;o(this);const _=this.children;for(let $=0,_e=_.length;$<_e;$++)_[$].traverseVisible(o)}traverseAncestors(o){const _=this.parent;_!==null&&(o(_),_.traverseAncestors(o))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(o){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||o)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,o=!0);const _=this.children;for(let $=0,_e=_.length;$<_e;$++){const it=_[$];it.matrixWorldAutoUpdate!==!0&&o!==!0||it.updateMatrixWorld(o)}}updateWorldMatrix(o,_){const $=this.parent;if(o===!0&&$!==null&&$.matrixWorldAutoUpdate===!0&&$.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),_===!0){const _e=this.children;for(let it=0,ot=_e.length;it<ot;it++){const ct=_e[it];ct.matrixWorldAutoUpdate===!0&&ct.updateWorldMatrix(!1,!0)}}}toJSON(o){const _=o===void 0||typeof o=="string",$={};_&&(o={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},$.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const _e={};function it(ct,mt){return ct[mt.uuid]===void 0&&(ct[mt.uuid]=mt.toJSON(o)),mt.uuid}if(_e.uuid=this.uuid,_e.type=this.type,this.name!==""&&(_e.name=this.name),this.castShadow===!0&&(_e.castShadow=!0),this.receiveShadow===!0&&(_e.receiveShadow=!0),this.visible===!1&&(_e.visible=!1),this.frustumCulled===!1&&(_e.frustumCulled=!1),this.renderOrder!==0&&(_e.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(_e.userData=this.userData),_e.layers=this.layers.mask,_e.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(_e.matrixAutoUpdate=!1),this.isInstancedMesh&&(_e.type="InstancedMesh",_e.count=this.count,_e.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(_e.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?_e.background=this.background.toJSON():this.background.isTexture&&(_e.background=this.background.toJSON(o).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(_e.environment=this.environment.toJSON(o).uuid);else if(this.isMesh||this.isLine||this.isPoints){_e.geometry=it(o.geometries,this.geometry);const ct=this.geometry.parameters;if(ct!==void 0&&ct.shapes!==void 0){const mt=ct.shapes;if(Array.isArray(mt))for(let gt=0,St=mt.length;gt<St;gt++){const Tt=mt[gt];it(o.shapes,Tt)}else it(o.shapes,mt)}}if(this.isSkinnedMesh&&(_e.bindMode=this.bindMode,_e.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(it(o.skeletons,this.skeleton),_e.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const ct=[];for(let mt=0,gt=this.material.length;mt<gt;mt++)ct.push(it(o.materials,this.material[mt]));_e.material=ct}else _e.material=it(o.materials,this.material);if(this.children.length>0){_e.children=[];for(let ct=0;ct<this.children.length;ct++)_e.children.push(this.children[ct].toJSON(o).object)}if(this.animations.length>0){_e.animations=[];for(let ct=0;ct<this.animations.length;ct++){const mt=this.animations[ct];_e.animations.push(it(o.animations,mt))}}if(_){const ct=ot(o.geometries),mt=ot(o.materials),gt=ot(o.textures),St=ot(o.images),Tt=ot(o.shapes),Ct=ot(o.skeletons),Pt=ot(o.animations),Ot=ot(o.nodes);ct.length>0&&($.geometries=ct),mt.length>0&&($.materials=mt),gt.length>0&&($.textures=gt),St.length>0&&($.images=St),Tt.length>0&&($.shapes=Tt),Ct.length>0&&($.skeletons=Ct),Pt.length>0&&($.animations=Pt),Ot.length>0&&($.nodes=Ot)}return $.object=_e,$;function ot(ct){const mt=[];for(const gt in ct){const St=ct[gt];delete St.metadata,mt.push(St)}return mt}}clone(o){return new this.constructor().copy(this,o)}copy(o,_=!0){this.name=o.name,this.up.copy(o.up),this.position.copy(o.position),this.rotation.order=o.rotation.order,this.quaternion.copy(o.quaternion),this.scale.copy(o.scale),this.matrix.copy(o.matrix),this.matrixWorld.copy(o.matrixWorld),this.matrixAutoUpdate=o.matrixAutoUpdate,this.matrixWorldNeedsUpdate=o.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=o.matrixWorldAutoUpdate,this.layers.mask=o.layers.mask,this.visible=o.visible,this.castShadow=o.castShadow,this.receiveShadow=o.receiveShadow,this.frustumCulled=o.frustumCulled,this.renderOrder=o.renderOrder,this.userData={};for(const[$,_e]of Object.entries(o.userData))this.userData[$]=!_e||_e&&(_e.isTexture||_e.isObject3D)?_e:JSON.parse(JSON.stringify(_e));if(_===!0)for(let $=0;$<o.children.length;$++){const _e=o.children[$];this.add(_e.clone())}return this}}no.DefaultUp=new An(0,1,0),no.DefaultMatrixAutoUpdate=!0,no.DefaultMatrixWorldAutoUpdate=!0;const im=new An,Hm=new An,up=new An,Sm=new An,sm=new An,om=new An,kA=new An,k0=new An,BA=new An,e_=new An;class Fu{constructor(o=new An,_=new An,$=new An){this.a=o,this.b=_,this.c=$}static getNormal(o,_,$,_e){_e.subVectors($,_),im.subVectors(o,_),_e.cross(im);const it=_e.lengthSq();return it>0?_e.multiplyScalar(1/Math.sqrt(it)):_e.set(0,0,0)}static getBarycoord(o,_,$,_e,it){im.subVectors(_e,_),Hm.subVectors($,_),up.subVectors(o,_);const ot=im.dot(im),ct=im.dot(Hm),mt=im.dot(up),gt=Hm.dot(Hm),St=Hm.dot(up),Tt=ot*gt-ct*ct;if(Tt===0)return it.set(-2,-1,-1);const Ct=1/Tt,Pt=(gt*mt-ct*St)*Ct,Ot=(ot*St-ct*mt)*Ct;return it.set(1-Pt-Ot,Ot,Pt)}static containsPoint(o,_,$,_e){return this.getBarycoord(o,_,$,_e,Sm),Sm.x>=0&&Sm.y>=0&&Sm.x+Sm.y<=1}static getUV(o,_,$,_e,it,ot,ct,mt){return this.getBarycoord(o,_,$,_e,Sm),mt.set(0,0),mt.addScaledVector(it,Sm.x),mt.addScaledVector(ot,Sm.y),mt.addScaledVector(ct,Sm.z),mt}static isFrontFacing(o,_,$,_e){return im.subVectors($,_),Hm.subVectors(o,_),im.cross(Hm).dot(_e)<0}set(o,_,$){return this.a.copy(o),this.b.copy(_),this.c.copy($),this}setFromPointsAndIndices(o,_,$,_e){return this.a.copy(o[_]),this.b.copy(o[$]),this.c.copy(o[_e]),this}setFromAttributeAndIndices(o,_,$,_e){return this.a.fromBufferAttribute(o,_),this.b.fromBufferAttribute(o,$),this.c.fromBufferAttribute(o,_e),this}clone(){return new this.constructor().copy(this)}copy(o){return this.a.copy(o.a),this.b.copy(o.b),this.c.copy(o.c),this}getArea(){return im.subVectors(this.c,this.b),Hm.subVectors(this.a,this.b),.5*im.cross(Hm).length()}getMidpoint(o){return o.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(o){return Fu.getNormal(this.a,this.b,this.c,o)}getPlane(o){return o.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(o,_){return Fu.getBarycoord(o,this.a,this.b,this.c,_)}getUV(o,_,$,_e,it){return Fu.getUV(o,this.a,this.b,this.c,_,$,_e,it)}containsPoint(o){return Fu.containsPoint(o,this.a,this.b,this.c)}isFrontFacing(o){return Fu.isFrontFacing(this.a,this.b,this.c,o)}intersectsBox(o){return o.intersectsTriangle(this)}closestPointToPoint(o,_){const $=this.a,_e=this.b,it=this.c;let ot,ct;sm.subVectors(_e,$),om.subVectors(it,$),k0.subVectors(o,$);const mt=sm.dot(k0),gt=om.dot(k0);if(mt<=0&&gt<=0)return _.copy($);BA.subVectors(o,_e);const St=sm.dot(BA),Tt=om.dot(BA);if(St>=0&&Tt<=St)return _.copy(_e);const Ct=mt*Tt-St*gt;if(Ct<=0&&mt>=0&&St<=0)return ot=mt/(mt-St),_.copy($).addScaledVector(sm,ot);e_.subVectors(o,it);const Pt=sm.dot(e_),Ot=om.dot(e_);if(Ot>=0&&Pt<=Ot)return _.copy(it);const Dt=Pt*gt-mt*Ot;if(Dt<=0&&gt>=0&&Ot<=0)return ct=gt/(gt-Ot),_.copy($).addScaledVector(om,ct);const Yt=St*Ot-Pt*Tt;if(Yt<=0&&Tt-St>=0&&Pt-Ot>=0)return kA.subVectors(it,_e),ct=(Tt-St)/(Tt-St+(Pt-Ot)),_.copy(_e).addScaledVector(kA,ct);const Xt=1/(Yt+Dt+Ct);return ot=Dt*Xt,ct=Ct*Xt,_.copy($).addScaledVector(sm,ot).addScaledVector(om,ct)}equals(o){return o.a.equals(this.a)&&o.b.equals(this.b)&&o.c.equals(this.c)}}let x1=0;class Uu extends Fs{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:x1++}),this.uuid=Ju(),this.name="",this.type="Material",this.blending=Nt,this.side=Kt,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=nr,this.blendDst=hr,this.blendEquation=Ut,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=dn,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=zm,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Go,this.stencilZFail=Go,this.stencilZPass=Go,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(o){this._alphaTest>0!=o>0&&this.version++,this._alphaTest=o}onBuild(){}onBeforeRender(){}onAfterRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(o){if(o!==void 0)for(const _ in o){const $=o[_];if($===void 0){console.warn("THREE.Material: '"+_+"' parameter is undefined.");continue}const _e=this[_];_e!==void 0&&(_e&&_e.isColor?_e.set($):_e&&_e.isVector3&&$&&$.isVector3?_e.copy($):this[_]=$)}}toJSON(o){const _=o===void 0||typeof o=="string";_&&(o={textures:{},images:{}});const $={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function _e(it){const ot=[];for(const ct in it){const mt=it[ct];delete mt.metadata,ot.push(mt)}return ot}if($.uuid=this.uuid,$.type=this.type,this.name!==""&&($.name=this.name),this.color&&this.color.isColor&&($.color=this.color.getHex()),this.roughness!==void 0&&($.roughness=this.roughness),this.metalness!==void 0&&($.metalness=this.metalness),this.sheen!==void 0&&($.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&($.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&($.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&($.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&($.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&($.specular=this.specular.getHex()),this.specularIntensity!==void 0&&($.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&($.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&($.shininess=this.shininess),this.clearcoat!==void 0&&($.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&($.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&($.clearcoatMap=this.clearcoatMap.toJSON(o).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&($.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(o).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&($.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(o).uuid,$.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&($.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&($.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&($.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&($.iridescenceMap=this.iridescenceMap.toJSON(o).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&($.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(o).uuid),this.map&&this.map.isTexture&&($.map=this.map.toJSON(o).uuid),this.matcap&&this.matcap.isTexture&&($.matcap=this.matcap.toJSON(o).uuid),this.alphaMap&&this.alphaMap.isTexture&&($.alphaMap=this.alphaMap.toJSON(o).uuid),this.lightMap&&this.lightMap.isTexture&&($.lightMap=this.lightMap.toJSON(o).uuid,$.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&($.aoMap=this.aoMap.toJSON(o).uuid,$.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&($.bumpMap=this.bumpMap.toJSON(o).uuid,$.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&($.normalMap=this.normalMap.toJSON(o).uuid,$.normalMapType=this.normalMapType,$.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&($.displacementMap=this.displacementMap.toJSON(o).uuid,$.displacementScale=this.displacementScale,$.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&($.roughnessMap=this.roughnessMap.toJSON(o).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&($.metalnessMap=this.metalnessMap.toJSON(o).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&($.emissiveMap=this.emissiveMap.toJSON(o).uuid),this.specularMap&&this.specularMap.isTexture&&($.specularMap=this.specularMap.toJSON(o).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&($.specularIntensityMap=this.specularIntensityMap.toJSON(o).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&($.specularColorMap=this.specularColorMap.toJSON(o).uuid),this.envMap&&this.envMap.isTexture&&($.envMap=this.envMap.toJSON(o).uuid,this.combine!==void 0&&($.combine=this.combine)),this.envMapIntensity!==void 0&&($.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&($.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&($.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&($.gradientMap=this.gradientMap.toJSON(o).uuid),this.transmission!==void 0&&($.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&($.transmissionMap=this.transmissionMap.toJSON(o).uuid),this.thickness!==void 0&&($.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&($.thicknessMap=this.thicknessMap.toJSON(o).uuid),this.attenuationDistance!==void 0&&($.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&($.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&($.size=this.size),this.shadowSide!==null&&($.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&($.sizeAttenuation=this.sizeAttenuation),this.blending!==Nt&&($.blending=this.blending),this.side!==Kt&&($.side=this.side),this.vertexColors&&($.vertexColors=!0),this.opacity<1&&($.opacity=this.opacity),this.transparent===!0&&($.transparent=this.transparent),$.depthFunc=this.depthFunc,$.depthTest=this.depthTest,$.depthWrite=this.depthWrite,$.colorWrite=this.colorWrite,$.stencilWrite=this.stencilWrite,$.stencilWriteMask=this.stencilWriteMask,$.stencilFunc=this.stencilFunc,$.stencilRef=this.stencilRef,$.stencilFuncMask=this.stencilFuncMask,$.stencilFail=this.stencilFail,$.stencilZFail=this.stencilZFail,$.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&($.rotation=this.rotation),this.polygonOffset===!0&&($.polygonOffset=!0),this.polygonOffsetFactor!==0&&($.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&($.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&($.linewidth=this.linewidth),this.dashSize!==void 0&&($.dashSize=this.dashSize),this.gapSize!==void 0&&($.gapSize=this.gapSize),this.scale!==void 0&&($.scale=this.scale),this.dithering===!0&&($.dithering=!0),this.alphaTest>0&&($.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&($.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&($.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&($.wireframe=this.wireframe),this.wireframeLinewidth>1&&($.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&($.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&($.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&($.flatShading=this.flatShading),this.visible===!1&&($.visible=!1),this.toneMapped===!1&&($.toneMapped=!1),this.fog===!1&&($.fog=!1),JSON.stringify(this.userData)!=="{}"&&($.userData=this.userData),_){const it=_e(o.textures),ot=_e(o.images);it.length>0&&($.textures=it),ot.length>0&&($.images=ot)}return $}clone(){return new this.constructor().copy(this)}copy(o){this.name=o.name,this.blending=o.blending,this.side=o.side,this.vertexColors=o.vertexColors,this.opacity=o.opacity,this.transparent=o.transparent,this.blendSrc=o.blendSrc,this.blendDst=o.blendDst,this.blendEquation=o.blendEquation,this.blendSrcAlpha=o.blendSrcAlpha,this.blendDstAlpha=o.blendDstAlpha,this.blendEquationAlpha=o.blendEquationAlpha,this.depthFunc=o.depthFunc,this.depthTest=o.depthTest,this.depthWrite=o.depthWrite,this.stencilWriteMask=o.stencilWriteMask,this.stencilFunc=o.stencilFunc,this.stencilRef=o.stencilRef,this.stencilFuncMask=o.stencilFuncMask,this.stencilFail=o.stencilFail,this.stencilZFail=o.stencilZFail,this.stencilZPass=o.stencilZPass,this.stencilWrite=o.stencilWrite;const _=o.clippingPlanes;let $=null;if(_!==null){const _e=_.length;$=new Array(_e);for(let it=0;it!==_e;++it)$[it]=_[it].clone()}this.clippingPlanes=$,this.clipIntersection=o.clipIntersection,this.clipShadows=o.clipShadows,this.shadowSide=o.shadowSide,this.colorWrite=o.colorWrite,this.precision=o.precision,this.polygonOffset=o.polygonOffset,this.polygonOffsetFactor=o.polygonOffsetFactor,this.polygonOffsetUnits=o.polygonOffsetUnits,this.dithering=o.dithering,this.alphaTest=o.alphaTest,this.alphaToCoverage=o.alphaToCoverage,this.premultipliedAlpha=o.premultipliedAlpha,this.visible=o.visible,this.toneMapped=o.toneMapped,this.userData={};for(const[_e,it]of Object.entries(o.userData))this.userData[_e]=!it||it&&(it.isTexture||it.isObject3D)?it:JSON.parse(JSON.stringify(it));return this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(o){o===!0&&this.version++}}class Wm extends Uu{constructor(o){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new is(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ls,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.specularMap=o.specularMap,this.alphaMap=o.alphaMap,this.envMap=o.envMap,this.combine=o.combine,this.reflectivity=o.reflectivity,this.refractionRatio=o.refractionRatio,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.fog=o.fog,this}}const _c=new An,am=new Rr;class $o{constructor(o,_,$){if(Array.isArray(o))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=o,this.itemSize=_,this.count=o!==void 0?o.length/_:0,this.normalized=$===!0,this.usage=I_,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(o){o===!0&&this.version++}setUsage(o){return this.usage=o,this}copy(o){return this.name=o.name,this.array=new o.array.constructor(o.array),this.itemSize=o.itemSize,this.count=o.count,this.normalized=o.normalized,this.usage=o.usage,this}copyAt(o,_,$){o*=this.itemSize,$*=_.itemSize;for(let _e=0,it=this.itemSize;_e<it;_e++)this.array[o+_e]=_.array[$+_e];return this}copyArray(o){return this.array.set(o),this}applyMatrix3(o){if(this.itemSize===2)for(let _=0,$=this.count;_<$;_++)am.fromBufferAttribute(this,_),am.applyMatrix3(o),this.setXY(_,am.x,am.y);else if(this.itemSize===3)for(let _=0,$=this.count;_<$;_++)_c.fromBufferAttribute(this,_),_c.applyMatrix3(o),this.setXYZ(_,_c.x,_c.y,_c.z);return this}applyMatrix4(o){for(let _=0,$=this.count;_<$;_++)_c.fromBufferAttribute(this,_),_c.applyMatrix4(o),this.setXYZ(_,_c.x,_c.y,_c.z);return this}applyNormalMatrix(o){for(let _=0,$=this.count;_<$;_++)_c.fromBufferAttribute(this,_),_c.applyNormalMatrix(o),this.setXYZ(_,_c.x,_c.y,_c.z);return this}transformDirection(o){for(let _=0,$=this.count;_<$;_++)_c.fromBufferAttribute(this,_),_c.transformDirection(o),this.setXYZ(_,_c.x,_c.y,_c.z);return this}set(o,_=0){return this.array.set(o,_),this}getX(o){let _=this.array[o*this.itemSize];return this.normalized&&(_=fv(_,this.array)),_}setX(o,_){return this.normalized&&(_=Zo(_,this.array)),this.array[o*this.itemSize]=_,this}getY(o){let _=this.array[o*this.itemSize+1];return this.normalized&&(_=fv(_,this.array)),_}setY(o,_){return this.normalized&&(_=Zo(_,this.array)),this.array[o*this.itemSize+1]=_,this}getZ(o){let _=this.array[o*this.itemSize+2];return this.normalized&&(_=fv(_,this.array)),_}setZ(o,_){return this.normalized&&(_=Zo(_,this.array)),this.array[o*this.itemSize+2]=_,this}getW(o){let _=this.array[o*this.itemSize+3];return this.normalized&&(_=fv(_,this.array)),_}setW(o,_){return this.normalized&&(_=Zo(_,this.array)),this.array[o*this.itemSize+3]=_,this}setXY(o,_,$){return o*=this.itemSize,this.normalized&&(_=Zo(_,this.array),$=Zo($,this.array)),this.array[o+0]=_,this.array[o+1]=$,this}setXYZ(o,_,$,_e){return o*=this.itemSize,this.normalized&&(_=Zo(_,this.array),$=Zo($,this.array),_e=Zo(_e,this.array)),this.array[o+0]=_,this.array[o+1]=$,this.array[o+2]=_e,this}setXYZW(o,_,$,_e,it){return o*=this.itemSize,this.normalized&&(_=Zo(_,this.array),$=Zo($,this.array),_e=Zo(_e,this.array),it=Zo(it,this.array)),this.array[o+0]=_,this.array[o+1]=$,this.array[o+2]=_e,this.array[o+3]=it,this}onUpload(o){return this.onUploadCallback=o,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const o={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(o.name=this.name),this.usage!==I_&&(o.usage=this.usage),this.updateRange.offset===0&&this.updateRange.count===-1||(o.updateRange=this.updateRange),o}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class B0 extends $o{constructor(o,_,$){super(new Int8Array(o),_,$)}}class lm extends $o{constructor(o,_,$){super(new Uint8Array(o),_,$)}}class O0 extends $o{constructor(o,_,$){super(new Uint8ClampedArray(o),_,$)}}class hp extends $o{constructor(o,_,$){super(new Int16Array(o),_,$)}}class Ql extends $o{constructor(o,_,$){super(new Uint16Array(o),_,$)}}class Nw extends $o{constructor(o,_,$){super(new Int32Array(o),_,$)}}class wt extends $o{constructor(o,_,$){super(new Uint32Array(o),_,$)}}class st extends $o{constructor(o,_,$){super(new Uint16Array(o),_,$),this.isFloat16BufferAttribute=!0}}class dt extends $o{constructor(o,_,$){super(new Float32Array(o),_,$)}}class It extends $o{constructor(o,_,$){super(new Float64Array(o),_,$)}}let Zt=0;const bn=new Us,Rn=new no,dr=new An,Dr=new L_,ys=new L_,Ts=new An;class ps extends Fs{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Zt++}),this.uuid=Ju(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(o){return Array.isArray(o)?this.index=new(A1(o)?wt:Ql)(o,1):this.index=o,this}getAttribute(o){return this.attributes[o]}setAttribute(o,_){return this.attributes[o]=_,this}deleteAttribute(o){return delete this.attributes[o],this}hasAttribute(o){return this.attributes[o]!==void 0}addGroup(o,_,$=0){this.groups.push({start:o,count:_,materialIndex:$})}clearGroups(){this.groups=[]}setDrawRange(o,_){this.drawRange.start=o,this.drawRange.count=_}applyMatrix4(o){const _=this.attributes.position;_!==void 0&&(_.applyMatrix4(o),_.needsUpdate=!0);const $=this.attributes.normal;if($!==void 0){const it=new Ou().getNormalMatrix(o);$.applyNormalMatrix(it),$.needsUpdate=!0}const _e=this.attributes.tangent;return _e!==void 0&&(_e.transformDirection(o),_e.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(o){return bn.makeRotationFromQuaternion(o),this.applyMatrix4(bn),this}rotateX(o){return bn.makeRotationX(o),this.applyMatrix4(bn),this}rotateY(o){return bn.makeRotationY(o),this.applyMatrix4(bn),this}rotateZ(o){return bn.makeRotationZ(o),this.applyMatrix4(bn),this}translate(o,_,$){return bn.makeTranslation(o,_,$),this.applyMatrix4(bn),this}scale(o,_,$){return bn.makeScale(o,_,$),this.applyMatrix4(bn),this}lookAt(o){return Rn.lookAt(o),Rn.updateMatrix(),this.applyMatrix4(Rn.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(dr).negate(),this.translate(dr.x,dr.y,dr.z),this}setFromPoints(o){const _=[];for(let $=0,_e=o.length;$<_e;$++){const it=o[$];_.push(it.x,it.y,it.z||0)}return this.setAttribute("position",new dt(_,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new L_);const o=this.attributes.position,_=this.morphAttributes.position;if(o&&o.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new An(-1/0,-1/0,-1/0),new An(1/0,1/0,1/0));if(o!==void 0){if(this.boundingBox.setFromBufferAttribute(o),_)for(let $=0,_e=_.length;$<_e;$++){const it=_[$];Dr.setFromBufferAttribute(it),this.morphTargetsRelative?(Ts.addVectors(this.boundingBox.min,Dr.min),this.boundingBox.expandByPoint(Ts),Ts.addVectors(this.boundingBox.max,Dr.max),this.boundingBox.expandByPoint(Ts)):(this.boundingBox.expandByPoint(Dr.min),this.boundingBox.expandByPoint(Dr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new nm);const o=this.attributes.position,_=this.morphAttributes.position;if(o&&o.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new An,1/0);if(o){const $=this.boundingSphere.center;if(Dr.setFromBufferAttribute(o),_)for(let it=0,ot=_.length;it<ot;it++){const ct=_[it];ys.setFromBufferAttribute(ct),this.morphTargetsRelative?(Ts.addVectors(Dr.min,ys.min),Dr.expandByPoint(Ts),Ts.addVectors(Dr.max,ys.max),Dr.expandByPoint(Ts)):(Dr.expandByPoint(ys.min),Dr.expandByPoint(ys.max))}Dr.getCenter($);let _e=0;for(let it=0,ot=o.count;it<ot;it++)Ts.fromBufferAttribute(o,it),_e=Math.max(_e,$.distanceToSquared(Ts));if(_)for(let it=0,ot=_.length;it<ot;it++){const ct=_[it],mt=this.morphTargetsRelative;for(let gt=0,St=ct.count;gt<St;gt++)Ts.fromBufferAttribute(ct,gt),mt&&(dr.fromBufferAttribute(o,gt),Ts.add(dr)),_e=Math.max(_e,$.distanceToSquared(Ts))}this.boundingSphere.radius=Math.sqrt(_e),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const o=this.index,_=this.attributes;if(o===null||_.position===void 0||_.normal===void 0||_.uv===void 0)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const $=o.array,_e=_.position.array,it=_.normal.array,ot=_.uv.array,ct=_e.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new $o(new Float32Array(4*ct),4));const mt=this.getAttribute("tangent").array,gt=[],St=[];for(let Jn=0;Jn<ct;Jn++)gt[Jn]=new An,St[Jn]=new An;const Tt=new An,Ct=new An,Pt=new An,Ot=new Rr,Dt=new Rr,Yt=new Rr,Xt=new An,Jt=new An;function an(Jn,Un,Er){Tt.fromArray(_e,3*Jn),Ct.fromArray(_e,3*Un),Pt.fromArray(_e,3*Er),Ot.fromArray(ot,2*Jn),Dt.fromArray(ot,2*Un),Yt.fromArray(ot,2*Er),Ct.sub(Tt),Pt.sub(Tt),Dt.sub(Ot),Yt.sub(Ot);const Or=1/(Dt.x*Yt.y-Yt.x*Dt.y);isFinite(Or)&&(Xt.copy(Ct).multiplyScalar(Yt.y).addScaledVector(Pt,-Dt.y).multiplyScalar(Or),Jt.copy(Pt).multiplyScalar(Dt.x).addScaledVector(Ct,-Yt.x).multiplyScalar(Or),gt[Jn].add(Xt),gt[Un].add(Xt),gt[Er].add(Xt),St[Jn].add(Jt),St[Un].add(Jt),St[Er].add(Jt))}let fn=this.groups;fn.length===0&&(fn=[{start:0,count:$.length}]);for(let Jn=0,Un=fn.length;Jn<Un;++Jn){const Er=fn[Jn],Or=Er.start;for(let xr=Or,Gr=Or+Er.count;xr<Gr;xr+=3)an($[xr+0],$[xr+1],$[xr+2])}const gn=new An,_n=new An,On=new An,Ln=new An;function $n(Jn){On.fromArray(it,3*Jn),Ln.copy(On);const Un=gt[Jn];gn.copy(Un),gn.sub(On.multiplyScalar(On.dot(Un))).normalize(),_n.crossVectors(Ln,Un);const Er=_n.dot(St[Jn])<0?-1:1;mt[4*Jn]=gn.x,mt[4*Jn+1]=gn.y,mt[4*Jn+2]=gn.z,mt[4*Jn+3]=Er}for(let Jn=0,Un=fn.length;Jn<Un;++Jn){const Er=fn[Jn],Or=Er.start;for(let xr=Or,Gr=Or+Er.count;xr<Gr;xr+=3)$n($[xr+0]),$n($[xr+1]),$n($[xr+2])}}computeVertexNormals(){const o=this.index,_=this.getAttribute("position");if(_!==void 0){let $=this.getAttribute("normal");if($===void 0)$=new $o(new Float32Array(3*_.count),3),this.setAttribute("normal",$);else for(let Ct=0,Pt=$.count;Ct<Pt;Ct++)$.setXYZ(Ct,0,0,0);const _e=new An,it=new An,ot=new An,ct=new An,mt=new An,gt=new An,St=new An,Tt=new An;if(o)for(let Ct=0,Pt=o.count;Ct<Pt;Ct+=3){const Ot=o.getX(Ct+0),Dt=o.getX(Ct+1),Yt=o.getX(Ct+2);_e.fromBufferAttribute(_,Ot),it.fromBufferAttribute(_,Dt),ot.fromBufferAttribute(_,Yt),St.subVectors(ot,it),Tt.subVectors(_e,it),St.cross(Tt),ct.fromBufferAttribute($,Ot),mt.fromBufferAttribute($,Dt),gt.fromBufferAttribute($,Yt),ct.add(St),mt.add(St),gt.add(St),$.setXYZ(Ot,ct.x,ct.y,ct.z),$.setXYZ(Dt,mt.x,mt.y,mt.z),$.setXYZ(Yt,gt.x,gt.y,gt.z)}else for(let Ct=0,Pt=_.count;Ct<Pt;Ct+=3)_e.fromBufferAttribute(_,Ct+0),it.fromBufferAttribute(_,Ct+1),ot.fromBufferAttribute(_,Ct+2),St.subVectors(ot,it),Tt.subVectors(_e,it),St.cross(Tt),$.setXYZ(Ct+0,St.x,St.y,St.z),$.setXYZ(Ct+1,St.x,St.y,St.z),$.setXYZ(Ct+2,St.x,St.y,St.z);this.normalizeNormals(),$.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const o=this.attributes.normal;for(let _=0,$=o.count;_<$;_++)Ts.fromBufferAttribute(o,_),Ts.normalize(),o.setXYZ(_,Ts.x,Ts.y,Ts.z)}toNonIndexed(){function o(ct,mt){const gt=ct.array,St=ct.itemSize,Tt=ct.normalized,Ct=new gt.constructor(mt.length*St);let Pt=0,Ot=0;for(let Dt=0,Yt=mt.length;Dt<Yt;Dt++){Pt=ct.isInterleavedBufferAttribute?mt[Dt]*ct.data.stride+ct.offset:mt[Dt]*St;for(let Xt=0;Xt<St;Xt++)Ct[Ot++]=gt[Pt++]}return new $o(Ct,St,Tt)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const _=new ps,$=this.index.array,_e=this.attributes;for(const ct in _e){const mt=o(_e[ct],$);_.setAttribute(ct,mt)}const it=this.morphAttributes;for(const ct in it){const mt=[],gt=it[ct];for(let St=0,Tt=gt.length;St<Tt;St++){const Ct=o(gt[St],$);mt.push(Ct)}_.morphAttributes[ct]=mt}_.morphTargetsRelative=this.morphTargetsRelative;const ot=this.groups;for(let ct=0,mt=ot.length;ct<mt;ct++){const gt=ot[ct];_.addGroup(gt.start,gt.count,gt.materialIndex)}return _}toJSON(){const o={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(o.uuid=this.uuid,o.type=this.type,this.name!==""&&(o.name=this.name),Object.keys(this.userData).length>0&&(o.userData=this.userData),this.parameters!==void 0){const mt=this.parameters;for(const gt in mt)mt[gt]!==void 0&&(o[gt]=mt[gt]);return o}o.data={attributes:{}};const _=this.index;_!==null&&(o.data.index={type:_.array.constructor.name,array:Array.prototype.slice.call(_.array)});const $=this.attributes;for(const mt in $){const gt=$[mt];o.data.attributes[mt]=gt.toJSON(o.data)}const _e={};let it=!1;for(const mt in this.morphAttributes){const gt=this.morphAttributes[mt],St=[];for(let Tt=0,Ct=gt.length;Tt<Ct;Tt++){const Pt=gt[Tt];St.push(Pt.toJSON(o.data))}St.length>0&&(_e[mt]=St,it=!0)}it&&(o.data.morphAttributes=_e,o.data.morphTargetsRelative=this.morphTargetsRelative);const ot=this.groups;ot.length>0&&(o.data.groups=JSON.parse(JSON.stringify(ot)));const ct=this.boundingSphere;return ct!==null&&(o.data.boundingSphere={center:ct.center.toArray(),radius:ct.radius}),o}clone(){return new this.constructor().copy(this)}copy(o){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const _={};this.name=o.name;const $=o.index;$!==null&&this.setIndex($.clone(_));const _e=o.attributes;for(const gt in _e){const St=_e[gt];this.setAttribute(gt,St.clone(_))}const it=o.morphAttributes;for(const gt in it){const St=[],Tt=it[gt];for(let Ct=0,Pt=Tt.length;Ct<Pt;Ct++)St.push(Tt[Ct].clone(_));this.morphAttributes[gt]=St}this.morphTargetsRelative=o.morphTargetsRelative;const ot=o.groups;for(let gt=0,St=ot.length;gt<St;gt++){const Tt=ot[gt];this.addGroup(Tt.start,Tt.count,Tt.materialIndex)}const ct=o.boundingBox;ct!==null&&(this.boundingBox=ct.clone());const mt=o.boundingSphere;return mt!==null&&(this.boundingSphere=mt.clone()),this.drawRange.start=o.drawRange.start,this.drawRange.count=o.drawRange.count,this.userData=o.userData,o.parameters!==void 0&&(this.parameters=Object.assign({},o.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const Cl=new Us,iu=new $v,cm=new nm,_d=new An,Lp=new An,Cm=new An,z_=new An,t_=new An,L0=new An,Ry=new An,ky=new An,By=new An,OA=new Rr,b1=new Rr,E1=new Rr,Fw=new An,Oy=new An;class ju extends no{constructor(o=new ps,_=new Wm){super(),this.isMesh=!0,this.type="Mesh",this.geometry=o,this.material=_,this.updateMorphTargets()}copy(o,_){return super.copy(o,_),o.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=o.morphTargetInfluences.slice()),o.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},o.morphTargetDictionary)),this.material=o.material,this.geometry=o.geometry,this}updateMorphTargets(){const o=this.geometry.morphAttributes,_=Object.keys(o);if(_.length>0){const $=o[_[0]];if($!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let _e=0,it=$.length;_e<it;_e++){const ot=$[_e].name||String(_e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[ot]=_e}}}}raycast(o,_){const $=this.geometry,_e=this.material,it=this.matrixWorld;if(_e===void 0||($.boundingSphere===null&&$.computeBoundingSphere(),cm.copy($.boundingSphere),cm.applyMatrix4(it),o.ray.intersectsSphere(cm)===!1)||(Cl.copy(it).invert(),iu.copy(o.ray).applyMatrix4(Cl),$.boundingBox!==null&&iu.intersectsBox($.boundingBox)===!1))return;let ot;const ct=$.index,mt=$.attributes.position,gt=$.morphAttributes.position,St=$.morphTargetsRelative,Tt=$.attributes.uv,Ct=$.attributes.uv2,Pt=$.groups,Ot=$.drawRange;if(ct!==null)if(Array.isArray(_e))for(let Dt=0,Yt=Pt.length;Dt<Yt;Dt++){const Xt=Pt[Dt],Jt=_e[Xt.materialIndex];for(let an=Math.max(Xt.start,Ot.start),fn=Math.min(ct.count,Math.min(Xt.start+Xt.count,Ot.start+Ot.count));an<fn;an+=3){const gn=ct.getX(an),_n=ct.getX(an+1),On=ct.getX(an+2);ot=Uw(this,Jt,o,iu,mt,gt,St,Tt,Ct,gn,_n,On),ot&&(ot.faceIndex=Math.floor(an/3),ot.face.materialIndex=Xt.materialIndex,_.push(ot))}}else for(let Dt=Math.max(0,Ot.start),Yt=Math.min(ct.count,Ot.start+Ot.count);Dt<Yt;Dt+=3){const Xt=ct.getX(Dt),Jt=ct.getX(Dt+1),an=ct.getX(Dt+2);ot=Uw(this,_e,o,iu,mt,gt,St,Tt,Ct,Xt,Jt,an),ot&&(ot.faceIndex=Math.floor(Dt/3),_.push(ot))}else if(mt!==void 0)if(Array.isArray(_e))for(let Dt=0,Yt=Pt.length;Dt<Yt;Dt++){const Xt=Pt[Dt],Jt=_e[Xt.materialIndex];for(let an=Math.max(Xt.start,Ot.start),fn=Math.min(mt.count,Math.min(Xt.start+Xt.count,Ot.start+Ot.count));an<fn;an+=3)ot=Uw(this,Jt,o,iu,mt,gt,St,Tt,Ct,an,an+1,an+2),ot&&(ot.faceIndex=Math.floor(an/3),ot.face.materialIndex=Xt.materialIndex,_.push(ot))}else for(let Dt=Math.max(0,Ot.start),Yt=Math.min(mt.count,Ot.start+Ot.count);Dt<Yt;Dt+=3)ot=Uw(this,_e,o,iu,mt,gt,St,Tt,Ct,Dt,Dt+1,Dt+2),ot&&(ot.faceIndex=Math.floor(Dt/3),_.push(ot))}}function Uw(ut,o,_,$,_e,it,ot,ct,mt,gt,St,Tt){_d.fromBufferAttribute(_e,gt),Lp.fromBufferAttribute(_e,St),Cm.fromBufferAttribute(_e,Tt);const Ct=ut.morphTargetInfluences;if(it&&Ct){Ry.set(0,0,0),ky.set(0,0,0),By.set(0,0,0);for(let Ot=0,Dt=it.length;Ot<Dt;Ot++){const Yt=Ct[Ot],Xt=it[Ot];Yt!==0&&(z_.fromBufferAttribute(Xt,gt),t_.fromBufferAttribute(Xt,St),L0.fromBufferAttribute(Xt,Tt),ot?(Ry.addScaledVector(z_,Yt),ky.addScaledVector(t_,Yt),By.addScaledVector(L0,Yt)):(Ry.addScaledVector(z_.sub(_d),Yt),ky.addScaledVector(t_.sub(Lp),Yt),By.addScaledVector(L0.sub(Cm),Yt)))}_d.add(Ry),Lp.add(ky),Cm.add(By)}ut.isSkinnedMesh&&(ut.boneTransform(gt,_d),ut.boneTransform(St,Lp),ut.boneTransform(Tt,Cm));const Pt=function(Ot,Dt,Yt,Xt,Jt,an,fn,gn){let _n;if(_n=Dt.side===Ft?Xt.intersectTriangle(fn,an,Jt,!0,gn):Xt.intersectTriangle(Jt,an,fn,Dt.side!==nn,gn),_n===null)return null;Oy.copy(gn),Oy.applyMatrix4(Ot.matrixWorld);const On=Yt.ray.origin.distanceTo(Oy);return On<Yt.near||On>Yt.far?null:{distance:On,point:Oy.clone(),object:Ot}}(ut,o,_,$,_d,Lp,Cm,Fw);if(Pt){ct&&(OA.fromBufferAttribute(ct,gt),b1.fromBufferAttribute(ct,St),E1.fromBufferAttribute(ct,Tt),Pt.uv=Fu.getUV(Fw,_d,Lp,Cm,OA,b1,E1,new Rr)),mt&&(OA.fromBufferAttribute(mt,gt),b1.fromBufferAttribute(mt,St),E1.fromBufferAttribute(mt,Tt),Pt.uv2=Fu.getUV(Fw,_d,Lp,Cm,OA,b1,E1,new Rr));const Ot={a:gt,b:St,c:Tt,normal:new An,materialIndex:0};Fu.getNormal(_d,Lp,Cm,Ot.normal),Pt.face=Ot}return Pt}class qm extends ps{constructor(o=1,_=1,$=1,_e=1,it=1,ot=1){super(),this.type="BoxGeometry",this.parameters={width:o,height:_,depth:$,widthSegments:_e,heightSegments:it,depthSegments:ot};const ct=this;_e=Math.floor(_e),it=Math.floor(it),ot=Math.floor(ot);const mt=[],gt=[],St=[],Tt=[];let Ct=0,Pt=0;function Ot(Dt,Yt,Xt,Jt,an,fn,gn,_n,On,Ln,$n){const Jn=fn/On,Un=gn/Ln,Er=fn/2,Or=gn/2,xr=_n/2,Gr=On+1,Hr=Ln+1;let pr=0,vr=0;const jr=new An;for(let Sr=0;Sr<Hr;Sr++){const Qr=Sr*Un-Or;for(let As=0;As<Gr;As++){const go=As*Jn-Er;jr[Dt]=go*Jt,jr[Yt]=Qr*an,jr[Xt]=xr,gt.push(jr.x,jr.y,jr.z),jr[Dt]=0,jr[Yt]=0,jr[Xt]=_n>0?1:-1,St.push(jr.x,jr.y,jr.z),Tt.push(As/On),Tt.push(1-Sr/Ln),pr+=1}}for(let Sr=0;Sr<Ln;Sr++)for(let Qr=0;Qr<On;Qr++){const As=Ct+Qr+Gr*Sr,go=Ct+Qr+Gr*(Sr+1),bs=Ct+(Qr+1)+Gr*(Sr+1),lo=Ct+(Qr+1)+Gr*Sr;mt.push(As,go,lo),mt.push(go,bs,lo),vr+=6}ct.addGroup(Pt,vr,$n),Pt+=vr,Ct+=pr}Ot("z","y","x",-1,-1,$,_,o,ot,it,0),Ot("z","y","x",1,-1,$,_,-o,ot,it,1),Ot("x","z","y",1,1,o,$,_,_e,ot,2),Ot("x","z","y",1,-1,o,$,-_,_e,ot,3),Ot("x","y","z",1,-1,o,_,$,_e,it,4),Ot("x","y","z",-1,-1,o,_,-$,_e,it,5),this.setIndex(mt),this.setAttribute("position",new dt(gt,3)),this.setAttribute("normal",new dt(St,3)),this.setAttribute("uv",new dt(Tt,2))}static fromJSON(o){return new qm(o.width,o.height,o.depth,o.widthSegments,o.heightSegments,o.depthSegments)}}function N0(ut){const o={};for(const _ in ut){o[_]={};for(const $ in ut[_]){const _e=ut[_][$];_e&&(_e.isColor||_e.isMatrix3||_e.isMatrix4||_e.isVector2||_e.isVector3||_e.isVector4||_e.isTexture||_e.isQuaternion)?o[_][$]=_e.clone():Array.isArray(_e)?o[_][$]=_e.slice():o[_][$]=_e}}return o}function Sp(ut){const o={};for(let _=0;_<ut.length;_++){const $=N0(ut[_]);for(const _e in $)o[_e]=$[_e]}return o}const kM={clone:N0,merge:Sp};class Av extends Uu{constructor(o){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,o!==void 0&&this.setValues(o)}copy(o){return super.copy(o),this.fragmentShader=o.fragmentShader,this.vertexShader=o.vertexShader,this.uniforms=N0(o.uniforms),this.uniformsGroups=function(_){const $=[];for(let _e=0;_e<_.length;_e++)$.push(_[_e].clone());return $}(o.uniformsGroups),this.defines=Object.assign({},o.defines),this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.fog=o.fog,this.lights=o.lights,this.clipping=o.clipping,this.extensions=Object.assign({},o.extensions),this.glslVersion=o.glslVersion,this}toJSON(o){const _=super.toJSON(o);_.glslVersion=this.glslVersion,_.uniforms={};for(const _e in this.uniforms){const it=this.uniforms[_e].value;it&&it.isTexture?_.uniforms[_e]={type:"t",value:it.toJSON(o).uuid}:it&&it.isColor?_.uniforms[_e]={type:"c",value:it.getHex()}:it&&it.isVector2?_.uniforms[_e]={type:"v2",value:it.toArray()}:it&&it.isVector3?_.uniforms[_e]={type:"v3",value:it.toArray()}:it&&it.isVector4?_.uniforms[_e]={type:"v4",value:it.toArray()}:it&&it.isMatrix3?_.uniforms[_e]={type:"m3",value:it.toArray()}:it&&it.isMatrix4?_.uniforms[_e]={type:"m4",value:it.toArray()}:_.uniforms[_e]={value:it}}Object.keys(this.defines).length>0&&(_.defines=this.defines),_.vertexShader=this.vertexShader,_.fragmentShader=this.fragmentShader;const $={};for(const _e in this.extensions)this.extensions[_e]===!0&&($[_e]=!0);return Object.keys($).length>0&&(_.extensions=$),_}}class LA extends no{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Us,this.projectionMatrix=new Us,this.projectionMatrixInverse=new Us}copy(o,_){return super.copy(o,_),this.matrixWorldInverse.copy(o.matrixWorldInverse),this.projectionMatrix.copy(o.projectionMatrix),this.projectionMatrixInverse.copy(o.projectionMatrixInverse),this}getWorldDirection(o){this.updateWorldMatrix(!0,!1);const _=this.matrixWorld.elements;return o.set(-_[8],-_[9],-_[10]).normalize()}updateMatrixWorld(o){super.updateMatrixWorld(o),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(o,_){super.updateWorldMatrix(o,_),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class ep extends LA{constructor(o=50,_=1,$=.1,_e=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=o,this.zoom=1,this.near=$,this.far=_e,this.focus=10,this.aspect=_,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(o,_){return super.copy(o,_),this.fov=o.fov,this.zoom=o.zoom,this.near=o.near,this.far=o.far,this.focus=o.focus,this.aspect=o.aspect,this.view=o.view===null?null:Object.assign({},o.view),this.filmGauge=o.filmGauge,this.filmOffset=o.filmOffset,this}setFocalLength(o){const _=.5*this.getFilmHeight()/o;this.fov=2*Ey*Math.atan(_),this.updateProjectionMatrix()}getFocalLength(){const o=Math.tan(.5*D_*this.fov);return .5*this.getFilmHeight()/o}getEffectiveFOV(){return 2*Ey*Math.atan(Math.tan(.5*D_*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(o,_,$,_e,it,ot){this.aspect=o/_,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=o,this.view.fullHeight=_,this.view.offsetX=$,this.view.offsetY=_e,this.view.width=it,this.view.height=ot,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const o=this.near;let _=o*Math.tan(.5*D_*this.fov)/this.zoom,$=2*_,_e=this.aspect*$,it=-.5*_e;const ot=this.view;if(this.view!==null&&this.view.enabled){const mt=ot.fullWidth,gt=ot.fullHeight;it+=ot.offsetX*_e/mt,_-=ot.offsetY*$/gt,_e*=ot.width/mt,$*=ot.height/gt}const ct=this.filmOffset;ct!==0&&(it+=o*ct/this.getFilmWidth()),this.projectionMatrix.makePerspective(it,it+_e,_,_-$,o,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(o){const _=super.toJSON(o);return _.object.fov=this.fov,_.object.zoom=this.zoom,_.object.near=this.near,_.object.far=this.far,_.object.focus=this.focus,_.object.aspect=this.aspect,this.view!==null&&(_.object.view=Object.assign({},this.view)),_.object.filmGauge=this.filmGauge,_.object.filmOffset=this.filmOffset,_}}const F0=90;class PS extends no{constructor(o,_,$){super(),this.type="CubeCamera",this.renderTarget=$;const _e=new ep(F0,1,o,_);_e.layers=this.layers,_e.up.set(0,-1,0),_e.lookAt(new An(1,0,0)),this.add(_e);const it=new ep(F0,1,o,_);it.layers=this.layers,it.up.set(0,-1,0),it.lookAt(new An(-1,0,0)),this.add(it);const ot=new ep(F0,1,o,_);ot.layers=this.layers,ot.up.set(0,0,1),ot.lookAt(new An(0,1,0)),this.add(ot);const ct=new ep(F0,1,o,_);ct.layers=this.layers,ct.up.set(0,0,-1),ct.lookAt(new An(0,-1,0)),this.add(ct);const mt=new ep(F0,1,o,_);mt.layers=this.layers,mt.up.set(0,-1,0),mt.lookAt(new An(0,0,1)),this.add(mt);const gt=new ep(F0,1,o,_);gt.layers=this.layers,gt.up.set(0,-1,0),gt.lookAt(new An(0,0,-1)),this.add(gt)}update(o,_){this.parent===null&&this.updateMatrixWorld();const $=this.renderTarget,[_e,it,ot,ct,mt,gt]=this.children,St=o.getRenderTarget(),Tt=o.toneMapping,Ct=o.xr.enabled;o.toneMapping=ws,o.xr.enabled=!1;const Pt=$.texture.generateMipmaps;$.texture.generateMipmaps=!1,o.setRenderTarget($,0),o.render(_,_e),o.setRenderTarget($,1),o.render(_,it),o.setRenderTarget($,2),o.render(_,ot),o.setRenderTarget($,3),o.render(_,ct),o.setRenderTarget($,4),o.render(_,mt),$.texture.generateMipmaps=Pt,o.setRenderTarget($,5),o.render(_,gt),o.setRenderTarget(St),o.toneMapping=Tt,o.xr.enabled=Ct,$.texture.needsPMREMUpdate=!0}}class NA extends yu{constructor(o,_,$,_e,it,ot,ct,mt,gt,St){super(o=o!==void 0?o:[],_=_!==void 0?_:Qs,$,_e,it,ot,ct,mt,gt,St),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(o){this.image=o}}class BM extends xp{constructor(o,_={}){super(o,o,_),this.isWebGLCubeRenderTarget=!0;const $={width:o,height:o,depth:1},_e=[$,$,$,$,$,$];this.texture=new NA(_e,_.mapping,_.wrapS,_.wrapT,_.magFilter,_.minFilter,_.format,_.type,_.anisotropy,_.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=_.generateMipmaps!==void 0&&_.generateMipmaps,this.texture.minFilter=_.minFilter!==void 0?_.minFilter:zo}fromEquirectangularTexture(o,_){this.texture.type=_.type,this.texture.encoding=_.encoding,this.texture.generateMipmaps=_.generateMipmaps,this.texture.minFilter=_.minFilter,this.texture.magFilter=_.magFilter;const $={tEquirect:{value:null}},_e=`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,it=`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`,ot=new qm(5,5,5),ct=new Av({name:"CubemapFromEquirect",uniforms:N0($),vertexShader:_e,fragmentShader:it,side:Ft,blending:Lt});ct.uniforms.tEquirect.value=_;const mt=new ju(ot,ct),gt=_.minFilter;return _.minFilter===oo&&(_.minFilter=zo),new PS(1,10,this).update(o,mt),_.minFilter=gt,mt.geometry.dispose(),mt.material.dispose(),this}clear(o,_,$,_e){const it=o.getRenderTarget();for(let ot=0;ot<6;ot++)o.setRenderTarget(this,ot),o.clear(_,$,_e);o.setRenderTarget(it)}}const DS=new An,U0=new An,RS=new Ou;class V_{constructor(o=new An(1,0,0),_=0){this.isPlane=!0,this.normal=o,this.constant=_}set(o,_){return this.normal.copy(o),this.constant=_,this}setComponents(o,_,$,_e){return this.normal.set(o,_,$),this.constant=_e,this}setFromNormalAndCoplanarPoint(o,_){return this.normal.copy(o),this.constant=-_.dot(this.normal),this}setFromCoplanarPoints(o,_,$){const _e=DS.subVectors($,_).cross(U0.subVectors(o,_)).normalize();return this.setFromNormalAndCoplanarPoint(_e,o),this}copy(o){return this.normal.copy(o.normal),this.constant=o.constant,this}normalize(){const o=1/this.normal.length();return this.normal.multiplyScalar(o),this.constant*=o,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(o){return this.normal.dot(o)+this.constant}distanceToSphere(o){return this.distanceToPoint(o.center)-o.radius}projectPoint(o,_){return _.copy(this.normal).multiplyScalar(-this.distanceToPoint(o)).add(o)}intersectLine(o,_){const $=o.delta(DS),_e=this.normal.dot($);if(_e===0)return this.distanceToPoint(o.start)===0?_.copy(o.start):null;const it=-(o.start.dot(this.normal)+this.constant)/_e;return it<0||it>1?null:_.copy($).multiplyScalar(it).add(o.start)}intersectsLine(o){const _=this.distanceToPoint(o.start),$=this.distanceToPoint(o.end);return _<0&&$>0||$<0&&_>0}intersectsBox(o){return o.intersectsPlane(this)}intersectsSphere(o){return o.intersectsPlane(this)}coplanarPoint(o){return o.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(o,_){const $=_||RS.getNormalMatrix(o),_e=this.coplanarPoint(DS).applyMatrix4(o),it=this.normal.applyMatrix3($).normalize();return this.constant=-_e.dot(it),this}translate(o){return this.constant-=o.dot(this.normal),this}equals(o){return o.normal.equals(this.normal)&&o.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Ly=new nm,jw=new An;class zw{constructor(o=new V_,_=new V_,$=new V_,_e=new V_,it=new V_,ot=new V_){this.planes=[o,_,$,_e,it,ot]}set(o,_,$,_e,it,ot){const ct=this.planes;return ct[0].copy(o),ct[1].copy(_),ct[2].copy($),ct[3].copy(_e),ct[4].copy(it),ct[5].copy(ot),this}copy(o){const _=this.planes;for(let $=0;$<6;$++)_[$].copy(o.planes[$]);return this}setFromProjectionMatrix(o){const _=this.planes,$=o.elements,_e=$[0],it=$[1],ot=$[2],ct=$[3],mt=$[4],gt=$[5],St=$[6],Tt=$[7],Ct=$[8],Pt=$[9],Ot=$[10],Dt=$[11],Yt=$[12],Xt=$[13],Jt=$[14],an=$[15];return _[0].setComponents(ct-_e,Tt-mt,Dt-Ct,an-Yt).normalize(),_[1].setComponents(ct+_e,Tt+mt,Dt+Ct,an+Yt).normalize(),_[2].setComponents(ct+it,Tt+gt,Dt+Pt,an+Xt).normalize(),_[3].setComponents(ct-it,Tt-gt,Dt-Pt,an-Xt).normalize(),_[4].setComponents(ct-ot,Tt-St,Dt-Ot,an-Jt).normalize(),_[5].setComponents(ct+ot,Tt+St,Dt+Ot,an+Jt).normalize(),this}intersectsObject(o){const _=o.geometry;return _.boundingSphere===null&&_.computeBoundingSphere(),Ly.copy(_.boundingSphere).applyMatrix4(o.matrixWorld),this.intersectsSphere(Ly)}intersectsSprite(o){return Ly.center.set(0,0,0),Ly.radius=.7071067811865476,Ly.applyMatrix4(o.matrixWorld),this.intersectsSphere(Ly)}intersectsSphere(o){const _=this.planes,$=o.center,_e=-o.radius;for(let it=0;it<6;it++)if(_[it].distanceToPoint($)<_e)return!1;return!0}intersectsBox(o){const _=this.planes;for(let $=0;$<6;$++){const _e=_[$];if(jw.x=_e.normal.x>0?o.max.x:o.min.x,jw.y=_e.normal.y>0?o.max.y:o.min.y,jw.z=_e.normal.z>0?o.max.z:o.min.z,_e.distanceToPoint(jw)<0)return!1}return!0}containsPoint(o){const _=this.planes;for(let $=0;$<6;$++)if(_[$].distanceToPoint(o)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function Q_(){let ut=null,o=!1,_=null,$=null;function _e(it,ot){_(it,ot),$=ut.requestAnimationFrame(_e)}return{start:function(){o!==!0&&_!==null&&($=ut.requestAnimationFrame(_e),o=!0)},stop:function(){ut.cancelAnimationFrame($),o=!1},setAnimationLoop:function(it){_=it},setContext:function(it){ut=it}}}function FA(ut,o){const _=o.isWebGL2,$=new WeakMap;return{get:function(_e){return _e.isInterleavedBufferAttribute&&(_e=_e.data),$.get(_e)},remove:function(_e){_e.isInterleavedBufferAttribute&&(_e=_e.data);const it=$.get(_e);it&&(ut.deleteBuffer(it.buffer),$.delete(_e))},update:function(_e,it){if(_e.isGLBufferAttribute){const ct=$.get(_e);return void((!ct||ct.version<_e.version)&&$.set(_e,{buffer:_e.buffer,type:_e.type,bytesPerElement:_e.elementSize,version:_e.version}))}_e.isInterleavedBufferAttribute&&(_e=_e.data);const ot=$.get(_e);ot===void 0?$.set(_e,function(ct,mt){const gt=ct.array,St=ct.usage,Tt=ut.createBuffer();let Ct;if(ut.bindBuffer(mt,Tt),ut.bufferData(mt,gt,St),ct.onUploadCallback(),gt instanceof Float32Array)Ct=5126;else if(gt instanceof Uint16Array)if(ct.isFloat16BufferAttribute){if(!_)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");Ct=5131}else Ct=5123;else if(gt instanceof Int16Array)Ct=5122;else if(gt instanceof Uint32Array)Ct=5125;else if(gt instanceof Int32Array)Ct=5124;else if(gt instanceof Int8Array)Ct=5120;else if(gt instanceof Uint8Array)Ct=5121;else{if(!(gt instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+gt);Ct=5121}return{buffer:Tt,type:Ct,bytesPerElement:gt.BYTES_PER_ELEMENT,version:ct.version}}(_e,it)):ot.version<_e.version&&(function(ct,mt,gt){const St=mt.array,Tt=mt.updateRange;ut.bindBuffer(gt,ct),Tt.count===-1?ut.bufferSubData(gt,0,St):(_?ut.bufferSubData(gt,Tt.offset*St.BYTES_PER_ELEMENT,St,Tt.offset,Tt.count):ut.bufferSubData(gt,Tt.offset*St.BYTES_PER_ELEMENT,St.subarray(Tt.offset,Tt.offset+Tt.count)),Tt.count=-1)}(ot.buffer,_e,it),ot.version=_e.version)}}}class j0 extends ps{constructor(o=1,_=1,$=1,_e=1){super(),this.type="PlaneGeometry",this.parameters={width:o,height:_,widthSegments:$,heightSegments:_e};const it=o/2,ot=_/2,ct=Math.floor($),mt=Math.floor(_e),gt=ct+1,St=mt+1,Tt=o/ct,Ct=_/mt,Pt=[],Ot=[],Dt=[],Yt=[];for(let Xt=0;Xt<St;Xt++){const Jt=Xt*Ct-ot;for(let an=0;an<gt;an++){const fn=an*Tt-it;Ot.push(fn,-Jt,0),Dt.push(0,0,1),Yt.push(an/ct),Yt.push(1-Xt/mt)}}for(let Xt=0;Xt<mt;Xt++)for(let Jt=0;Jt<ct;Jt++){const an=Jt+gt*Xt,fn=Jt+gt*(Xt+1),gn=Jt+1+gt*(Xt+1),_n=Jt+1+gt*Xt;Pt.push(an,fn,_n),Pt.push(fn,gn,_n)}this.setIndex(Pt),this.setAttribute("position",new dt(Ot,3)),this.setAttribute("normal",new dt(Dt,3)),this.setAttribute("uv",new dt(Yt,2))}static fromJSON(o){return new j0(o.width,o.height,o.widthSegments,o.heightSegments)}}const ao={alphamap_fragment:`#ifdef USE_ALPHAMAP
	#if defined(INVERSE_ALPHAMAP) && INVERSE_ALPHAMAP >= 1
	diffuseColor.a *= 1.0-texture2D( alphaMap, vUv ).g;
	#else
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
	#endif
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,alphatest_pars_fragment:`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,iridescence_fragment:`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment:`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex:`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common:`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	reflectVec = transformDirection1(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	vec3 transformDirection1( in vec3 dir, in mat4 matrix ) {
		return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
	}
	mat4 rotationMatrix(vec3 axis, float angle) {
		axis = normalize(axis);
		float s = sin(angle);
		float c = cos(angle);
		float oc = 1.0 - c;
		return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,
					oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,
					oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,
					0.0,                                0.0,                                0.0,                                1.0);
	}
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform float envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			worldNormal = transformDirection1(worldNormal, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			reflectVec = transformDirection1(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_fragment:`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment:`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment:`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert
#define Material_LightProbeLOD( material )	(0)`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment:`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphcolor_vertex:`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,normal_fragment_begin:`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps:`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex:`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,clearcoat_pars_fragment:`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,iridescence_pars_fragment:`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,output_fragment:`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
diffuseColor.a = min(max(diffuseColor.a, 0.), 1.);
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex:`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment:`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,transmission_pars_fragment:`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return transmissionSamplerMapTexelToLinear ( texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod ) );
		#else
			return transmissionSamplerMapTexelToLinear ( texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod ) );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,uv_pars_fragment:`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,uv_pars_vertex:`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,uv_vertex:`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,uv2_pars_fragment:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,uv2_pars_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,uv2_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
uniform bool flipX;
uniform bool flipY;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
    vUv = flipX ? vec2( 1.0 - vUv.x, vUv.y ) : vUv;
    vUv = flipY ? vec2( vUv.x, 1.0 - vUv.y ) : vUv;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );
	#endif
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`},Zr={common:{diffuse:{value:new is(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Ou},uv2Transform:{value:new Ou},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},envMapRotation:{value:0},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Rr(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new is(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new is(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ou}},sprite:{diffuse:{value:new is(16777215)},opacity:{value:1},center:{value:new Rr(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ou}}},um={basic:{uniforms:Sp([Zr.common,Zr.specularmap,Zr.envmap,Zr.aomap,Zr.lightmap,Zr.fog]),vertexShader:ao.meshbasic_vert,fragmentShader:ao.meshbasic_frag},lambert:{uniforms:Sp([Zr.common,Zr.specularmap,Zr.envmap,Zr.aomap,Zr.lightmap,Zr.emissivemap,Zr.bumpmap,Zr.normalmap,Zr.displacementmap,Zr.fog,Zr.lights,{emissive:{value:new is(0)}}]),vertexShader:ao.meshlambert_vert,fragmentShader:ao.meshlambert_frag},phong:{uniforms:Sp([Zr.common,Zr.specularmap,Zr.envmap,Zr.aomap,Zr.lightmap,Zr.emissivemap,Zr.bumpmap,Zr.normalmap,Zr.displacementmap,Zr.fog,Zr.lights,{emissive:{value:new is(0)},specular:{value:new is(1118481)},shininess:{value:30}}]),vertexShader:ao.meshphong_vert,fragmentShader:ao.meshphong_frag},standard:{uniforms:Sp([Zr.common,Zr.envmap,Zr.aomap,Zr.lightmap,Zr.emissivemap,Zr.bumpmap,Zr.normalmap,Zr.displacementmap,Zr.roughnessmap,Zr.metalnessmap,Zr.fog,Zr.lights,{emissive:{value:new is(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ao.meshphysical_vert,fragmentShader:ao.meshphysical_frag},toon:{uniforms:Sp([Zr.common,Zr.aomap,Zr.lightmap,Zr.emissivemap,Zr.bumpmap,Zr.normalmap,Zr.displacementmap,Zr.gradientmap,Zr.fog,Zr.lights,{emissive:{value:new is(0)}}]),vertexShader:ao.meshtoon_vert,fragmentShader:ao.meshtoon_frag},matcap:{uniforms:Sp([Zr.common,Zr.bumpmap,Zr.normalmap,Zr.displacementmap,Zr.fog,{matcap:{value:null}}]),vertexShader:ao.meshmatcap_vert,fragmentShader:ao.meshmatcap_frag},points:{uniforms:Sp([Zr.points,Zr.fog]),vertexShader:ao.points_vert,fragmentShader:ao.points_frag},dashed:{uniforms:Sp([Zr.common,Zr.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ao.linedashed_vert,fragmentShader:ao.linedashed_frag},depth:{uniforms:Sp([Zr.common,Zr.displacementmap]),vertexShader:ao.depth_vert,fragmentShader:ao.depth_frag},normal:{uniforms:Sp([Zr.common,Zr.bumpmap,Zr.normalmap,Zr.displacementmap,{opacity:{value:1}}]),vertexShader:ao.meshnormal_vert,fragmentShader:ao.meshnormal_frag},sprite:{uniforms:Sp([Zr.sprite,Zr.fog]),vertexShader:ao.sprite_vert,fragmentShader:ao.sprite_frag},background:{uniforms:{uvTransform:{value:new Ou},t2D:{value:null},flipX:{value:!1},flipY:{value:!1}},vertexShader:ao.background_vert,fragmentShader:ao.background_frag},cube:{uniforms:Sp([Zr.envmap,{opacity:{value:1}}]),vertexShader:ao.cube_vert,fragmentShader:ao.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ao.equirect_vert,fragmentShader:ao.equirect_frag},distanceRGBA:{uniforms:Sp([Zr.common,Zr.displacementmap,{referencePosition:{value:new An},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ao.distanceRGBA_vert,fragmentShader:ao.distanceRGBA_frag},shadow:{uniforms:Sp([Zr.lights,Zr.fog,{color:{value:new is(0)},opacity:{value:1}}]),vertexShader:ao.shadow_vert,fragmentShader:ao.shadow_frag}};function sP(ut,o,_,$,_e,it){const ot=new is(0);let ct,mt,gt=_e===!0?0:1,St=null,Tt=0,Ct=null;function Pt(Ot,Dt){_.buffers.color.setClear(Ot.r,Ot.g,Ot.b,Dt,it)}return{getClearColor:function(){return ot},setClearColor:function(Ot,Dt=1){ot.set(Ot),gt=Dt,Pt(ot,gt)},getClearAlpha:function(){return gt},setClearAlpha:function(Ot){gt=Ot,Pt(ot,gt)},getPlaneMesh:function(){return ct},getBoxMesh:function(){return mt},getBoxMesh2:function(){return mt===void 0&&(mt=new ju(new qm(1,1,1),new Av({name:"BackgroundCubeMaterial",uniforms:N0(um.cube.uniforms),vertexShader:um.cube.vertexShader,fragmentShader:um.cube.fragmentShader,side:Ft,depthTest:!1,depthWrite:!1,fog:!1})),mt.geometry.deleteAttribute("normal"),mt.geometry.deleteAttribute("uv"),mt.onBeforeRender=function(Ot,Dt,Yt){this.matrixWorld.copyPosition(Yt.matrixWorld)},Object.defineProperty(mt.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),$.update(mt)),mt},render:function(Ot,Dt){let Yt=!1,Xt=Dt.isScene===!0?Dt.background:null;Xt&&Xt.isTexture&&(Xt=o.get(Xt));const Jt=ut.xr,an=Jt.getSession&&Jt.getSession();an&&an.environmentBlendMode==="additive"&&(Xt=null),Xt===null?Pt(ot,gt):Xt&&Xt.isColor&&(Pt(Xt,1),Yt=!0),(ut.autoClear||Yt)&&ut.clear(ut.autoClearColor,ut.autoClearDepth,ut.autoClearStencil),Xt&&(Xt.isCubeTexture||Xt.mapping===Bo)?(mt===void 0&&(mt=new ju(new qm(1,1,1),new Av({name:"BackgroundCubeMaterial",uniforms:N0(um.cube.uniforms),vertexShader:um.cube.vertexShader,fragmentShader:um.cube.fragmentShader,side:Ft,depthTest:!1,depthWrite:!1,fog:!1})),mt.geometry.deleteAttribute("normal"),mt.geometry.deleteAttribute("uv"),mt.onBeforeRender=function(fn,gn,_n){this.matrixWorld.copyPosition(_n.matrixWorld)},Object.defineProperty(mt.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),$.update(mt)),mt.material.uniforms.envMap.value=Xt,mt.material.uniforms.envMapRotation.value=Xt.rotation||0,mt.material.uniforms.flipEnvMap.value=Xt.isCubeTexture&&Xt.isRenderTargetTexture===!1?-1:1,St===Xt&&Tt===Xt.version&&Ct===ut.toneMapping||(mt.material.needsUpdate=!0,St=Xt,Tt=Xt.version,Ct=ut.toneMapping),mt.layers.enableAll(),Ot.unshift(mt,mt.geometry,mt.material,0,0,null)):Xt&&Xt.isTexture&&(ct===void 0&&(ct=new ju(new j0(2,2),new Av({name:"BackgroundMaterial",uniforms:N0(um.background.uniforms),vertexShader:um.background.vertexShader,fragmentShader:um.background.fragmentShader,side:Kt,depthTest:!1,depthWrite:!1,fog:!1})),ct.geometry.deleteAttribute("normal"),Object.defineProperty(ct.material,"map",{get:function(){return this.uniforms.t2D.value}}),$.update(ct)),ct.material.uniforms.t2D.value=Xt,ct.material.uniforms.flipX.value=Xt.userData.flipX||!1,ct.material.uniforms.flipY.value=Xt.userData.flipY||!1,Xt.matrixAutoUpdate===!0&&Xt.updateMatrix(),ct.material.uniforms.uvTransform.value.copy(Xt.matrix),St===Xt&&Tt===Xt.version&&Ct===ut.toneMapping||(ct.material.needsUpdate=!0,St=Xt,Tt=Xt.version,Ct=ut.toneMapping),ct.layers.enableAll(),Ot.unshift(ct,ct.geometry,ct.material,0,0,null))}}}function oP(ut,o,_,$){const _e=ut.getParameter(34921),it=$.isWebGL2?null:o.get("OES_vertex_array_object"),ot=$.isWebGL2||it!==null,ct={},mt=Pt(null);let gt=mt,St=!1;function Tt(gn){return $.isWebGL2?ut.bindVertexArray(gn):it.bindVertexArrayOES(gn)}function Ct(gn){return $.isWebGL2?ut.deleteVertexArray(gn):it.deleteVertexArrayOES(gn)}function Pt(gn){const _n=[],On=[],Ln=[];for(let $n=0;$n<_e;$n++)_n[$n]=0,On[$n]=0,Ln[$n]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:_n,enabledAttributes:On,attributeDivisors:Ln,object:gn,attributes:{},index:null}}function Ot(){const gn=gt.newAttributes;for(let _n=0,On=gn.length;_n<On;_n++)gn[_n]=0}function Dt(gn){Yt(gn,0)}function Yt(gn,_n){const On=gt.newAttributes,Ln=gt.enabledAttributes,$n=gt.attributeDivisors;On[gn]=1,Ln[gn]===0&&(ut.enableVertexAttribArray(gn),Ln[gn]=1),$n[gn]!==_n&&(($.isWebGL2?ut:o.get("ANGLE_instanced_arrays"))[$.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](gn,_n),$n[gn]=_n)}function Xt(){const gn=gt.newAttributes,_n=gt.enabledAttributes;for(let On=0,Ln=_n.length;On<Ln;On++)_n[On]!==gn[On]&&(ut.disableVertexAttribArray(On),_n[On]=0)}function Jt(gn,_n,On,Ln,$n,Jn){$.isWebGL2!==!0||On!==5124&&On!==5125?ut.vertexAttribPointer(gn,_n,On,Ln,$n,Jn):ut.vertexAttribIPointer(gn,_n,On,$n,Jn)}function an(){fn(),St=!0,gt!==mt&&(gt=mt,Tt(gt.object))}function fn(){mt.geometry=null,mt.program=null,mt.wireframe=!1}return{setup:function(gn,_n,On,Ln,$n){let Jn=!1;if(ot){const Un=function(Er,Or,xr){const Gr=xr.wireframe===!0;let Hr=ct[Er.id];Hr===void 0&&(Hr={},ct[Er.id]=Hr);let pr=Hr[Or.id];pr===void 0&&(pr={},Hr[Or.id]=pr);let vr=pr[Gr];return vr===void 0&&(vr=Pt($.isWebGL2?ut.createVertexArray():it.createVertexArrayOES()),pr[Gr]=vr),vr}(Ln,On,_n);gt!==Un&&(gt=Un,Tt(gt.object)),Jn=function(Er,Or,xr,Gr){const Hr=gt.attributes,pr=Or.attributes;let vr=0;const jr=xr.getAttributes();for(const Sr in jr)if(jr[Sr].location>=0){const Qr=Hr[Sr];let As=pr[Sr];if(As===void 0&&(Sr==="instanceMatrix"&&Er.instanceMatrix&&(As=Er.instanceMatrix),Sr==="instanceColor"&&Er.instanceColor&&(As=Er.instanceColor)),Qr===void 0||Qr.attribute!==As||As&&Qr.data!==As.data)return!0;vr++}return gt.attributesNum!==vr||gt.index!==Gr}(gn,Ln,On,$n),Jn&&function(Er,Or,xr,Gr){const Hr={},pr=Or.attributes;let vr=0;const jr=xr.getAttributes();for(const Sr in jr)if(jr[Sr].location>=0){let Qr=pr[Sr];Qr===void 0&&(Sr==="instanceMatrix"&&Er.instanceMatrix&&(Qr=Er.instanceMatrix),Sr==="instanceColor"&&Er.instanceColor&&(Qr=Er.instanceColor));const As={};As.attribute=Qr,Qr&&Qr.data&&(As.data=Qr.data),Hr[Sr]=As,vr++}gt.attributes=Hr,gt.attributesNum=vr,gt.index=Gr}(gn,Ln,On,$n)}else{const Un=_n.wireframe===!0;gt.geometry===Ln.id&&gt.program===On.id&&gt.wireframe===Un||(gt.geometry=Ln.id,gt.program=On.id,gt.wireframe=Un,Jn=!0)}$n!==null&&_.update($n,34963),(Jn||St)&&(St=!1,function(Un,Er,Or,xr){if($.isWebGL2===!1&&(Un.isInstancedMesh||xr.isInstancedBufferGeometry)&&o.get("ANGLE_instanced_arrays")===null)return;Ot();const Gr=xr.attributes,Hr=Or.getAttributes(),pr=Er.defaultAttributeValues;for(const vr in Hr){const jr=Hr[vr];if(jr.location>=0){let Sr=Gr[vr];if(Sr===void 0&&(vr==="instanceMatrix"&&Un.instanceMatrix&&(Sr=Un.instanceMatrix),vr==="instanceColor"&&Un.instanceColor&&(Sr=Un.instanceColor)),Sr!==void 0){const Qr=Sr.normalized,As=Sr.itemSize,go=_.get(Sr);if(go===void 0)continue;const bs=go.buffer,lo=go.type,Pn=go.bytesPerElement;if(Sr.isInterleavedBufferAttribute){const Sn=Sr.data,ir=Sn.stride,Xn=Sr.offset;if(Sn.isInstancedInterleavedBuffer){for(let Dn=0;Dn<jr.locationSize;Dn++)Yt(jr.location+Dn,Sn.meshPerAttribute);Un.isInstancedMesh!==!0&&xr._maxInstanceCount===void 0&&(xr._maxInstanceCount=Sn.meshPerAttribute*Sn.count)}else for(let Dn=0;Dn<jr.locationSize;Dn++)Dt(jr.location+Dn);ut.bindBuffer(34962,bs);for(let Dn=0;Dn<jr.locationSize;Dn++)Jt(jr.location+Dn,As/jr.locationSize,lo,Qr,ir*Pn,(Xn+As/jr.locationSize*Dn)*Pn)}else{if(Sr.isInstancedBufferAttribute){for(let Sn=0;Sn<jr.locationSize;Sn++)Yt(jr.location+Sn,Sr.meshPerAttribute);Un.isInstancedMesh!==!0&&xr._maxInstanceCount===void 0&&(xr._maxInstanceCount=Sr.meshPerAttribute*Sr.count)}else for(let Sn=0;Sn<jr.locationSize;Sn++)Dt(jr.location+Sn);ut.bindBuffer(34962,bs);for(let Sn=0;Sn<jr.locationSize;Sn++)Jt(jr.location+Sn,As/jr.locationSize,lo,Qr,As*Pn,As/jr.locationSize*Sn*Pn)}}else if(pr!==void 0){const Qr=pr[vr];if(Qr!==void 0)switch(Qr.length){case 2:ut.vertexAttrib2fv(jr.location,Qr);break;case 3:ut.vertexAttrib3fv(jr.location,Qr);break;case 4:ut.vertexAttrib4fv(jr.location,Qr);break;default:ut.vertexAttrib1fv(jr.location,Qr)}}}}Xt()}(gn,_n,On,Ln),$n!==null&&ut.bindBuffer(34963,_.get($n).buffer))},reset:an,resetDefaultState:fn,dispose:function(){an();for(const gn in ct){const _n=ct[gn];for(const On in _n){const Ln=_n[On];for(const $n in Ln)Ct(Ln[$n].object),delete Ln[$n];delete _n[On]}delete ct[gn]}},releaseStatesOfGeometry:function(gn){if(ct[gn.id]===void 0)return;const _n=ct[gn.id];for(const On in _n){const Ln=_n[On];for(const $n in Ln)Ct(Ln[$n].object),delete Ln[$n];delete _n[On]}delete ct[gn.id]},releaseStatesOfProgram:function(gn){for(const _n in ct){const On=ct[_n];if(On[gn.id]===void 0)continue;const Ln=On[gn.id];for(const $n in Ln)Ct(Ln[$n].object),delete Ln[$n];delete On[gn.id]}},initAttributes:Ot,enableAttribute:Dt,disableUnusedAttributes:Xt}}function OM(ut,o,_,$){const _e=$.isWebGL2;let it;this.setMode=function(ot){it=ot},this.render=function(ot,ct){ut.drawArrays(it,ot,ct),_.update(ct,it,1)},this.renderInstances=function(ot,ct,mt){if(mt===0)return;let gt,St;if(_e)gt=ut,St="drawArraysInstanced";else if(gt=o.get("ANGLE_instanced_arrays"),St="drawArraysInstancedANGLE",gt===null)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");gt[St](it,ot,ct,mt),_.update(ct,it,mt)}}function LM(ut,o,_){let $;function _e(fn){if(fn==="highp"){if(ut.getShaderPrecisionFormat(35633,36338).precision>0&&ut.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";fn="mediump"}return fn==="mediump"&&ut.getShaderPrecisionFormat(35633,36337).precision>0&&ut.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const it=typeof WebGL2RenderingContext<"u"&&ut instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&ut instanceof WebGL2ComputeRenderingContext;let ot=_.precision!==void 0?_.precision:"highp";const ct=_e(ot);ct!==ot&&(console.warn("THREE.WebGLRenderer:",ot,"not supported, using",ct,"instead."),ot=ct);const mt=it||o.has("WEBGL_draw_buffers"),gt=_.logarithmicDepthBuffer===!0,St=ut.getParameter(34930),Tt=ut.getParameter(35660),Ct=ut.getParameter(3379),Pt=ut.getParameter(34076),Ot=ut.getParameter(34921),Dt=ut.getParameter(36347),Yt=ut.getParameter(36348),Xt=ut.getParameter(36349),Jt=Tt>0,an=it||o.has("OES_texture_float");return{isWebGL2:it,drawBuffers:mt,getMaxAnisotropy:function(){if($!==void 0)return $;if(o.has("EXT_texture_filter_anisotropic")===!0){const fn=o.get("EXT_texture_filter_anisotropic");$=ut.getParameter(fn.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else $=0;return $},getMaxPrecision:_e,precision:ot,logarithmicDepthBuffer:gt,maxTextures:St,maxVertexTextures:Tt,maxTextureSize:Ct,maxCubemapSize:Pt,maxAttributes:Ot,maxVertexUniforms:Dt,maxVaryings:Yt,maxFragmentUniforms:Xt,vertexTextures:Jt,floatFragmentTextures:an,floatVertexTextures:Jt&&an,maxSamples:it?ut.getParameter(36183):0}}function aP(ut){const o=this;let _=null,$=0,_e=!1,it=!1;const ot=new V_,ct=new Ou,mt={value:null,needsUpdate:!1};function gt(){mt.value!==_&&(mt.value=_,mt.needsUpdate=$>0),o.numPlanes=$,o.numIntersection=0}function St(Tt,Ct,Pt,Ot){const Dt=Tt!==null?Tt.length:0;let Yt=null;if(Dt!==0){if(Yt=mt.value,Ot!==!0||Yt===null){const Xt=Pt+4*Dt,Jt=Ct.matrixWorldInverse;ct.getNormalMatrix(Jt),(Yt===null||Yt.length<Xt)&&(Yt=new Float32Array(Xt));for(let an=0,fn=Pt;an!==Dt;++an,fn+=4)ot.copy(Tt[an]).applyMatrix4(Jt,ct),ot.normal.toArray(Yt,fn),Yt[fn+3]=ot.constant}mt.value=Yt,mt.needsUpdate=!0}return o.numPlanes=Dt,o.numIntersection=0,Yt}this.uniform=mt,this.numPlanes=0,this.numIntersection=0,this.init=function(Tt,Ct,Pt){const Ot=Tt.length!==0||Ct||$!==0||_e;return _e=Ct,_=St(Tt,Pt,0),$=Tt.length,Ot},this.beginShadows=function(){it=!0,St(null)},this.endShadows=function(){it=!1,gt()},this.setState=function(Tt,Ct,Pt){const Ot=Tt.clippingPlanes,Dt=Tt.clipIntersection,Yt=Tt.clipShadows,Xt=ut.get(Tt);if(!_e||Ot===null||Ot.length===0||it&&!Yt)it?St(null):gt();else{const Jt=it?0:$,an=4*Jt;let fn=Xt.clippingState||null;mt.value=fn,fn=St(Ot,Ct,an,Pt);for(let gn=0;gn!==an;++gn)fn[gn]=_[gn];Xt.clippingState=fn,this.numIntersection=Dt?this.numPlanes:0,this.numPlanes+=Jt}}}function lP(ut){let o=new WeakMap;function _(_e,it){return it===_l?_e.mapping=Qs:it===Mo&&(_e.mapping=So),_e}function $(_e){const it=_e.target;it.removeEventListener("dispose",$);const ot=o.get(it);ot!==void 0&&(o.delete(it),ot.dispose())}return{get:function(_e){if(_e&&_e.isTexture&&_e.isRenderTargetTexture===!1){const it=_e.mapping;if(it===_l||it===Mo){if(o.has(_e)){const ot=o.get(_e).texture;return ot.rotation=_e.rotation,_(ot,_e.mapping)}{const ot=_e.image;if(ot&&ot.height>0){const ct=new BM(ot.height/2);return ct.fromEquirectangularTexture(ut,_e),ct.texture.rotation=_e.rotation,o.set(_e,ct),_e.addEventListener("dispose",$),_(ct.texture,_e.mapping)}return null}}}return _e},dispose:function(){o=new WeakMap}}}um.physical={uniforms:Sp([um.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Rr(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new is(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Rr},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new is(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new is(1,1,1)},specularColorMap:{value:null}}]),vertexShader:ao.meshphysical_vert,fragmentShader:ao.meshphysical_frag};class S1 extends LA{constructor(o=-1,_=1,$=1,_e=-1,it=.1,ot=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=o,this.right=_,this.top=$,this.bottom=_e,this.near=it,this.far=ot,this.updateProjectionMatrix()}copy(o,_){return super.copy(o,_),this.left=o.left,this.right=o.right,this.top=o.top,this.bottom=o.bottom,this.near=o.near,this.far=o.far,this.zoom=o.zoom,this.view=o.view===null?null:Object.assign({},o.view),this}setViewOffset(o,_,$,_e,it,ot){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=o,this.view.fullHeight=_,this.view.offsetX=$,this.view.offsetY=_e,this.view.width=it,this.view.height=ot,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const o=(this.right-this.left)/(2*this.zoom),_=(this.top-this.bottom)/(2*this.zoom),$=(this.right+this.left)/2,_e=(this.top+this.bottom)/2;let it=$-o,ot=$+o,ct=_e+_,mt=_e-_;if(this.view!==null&&this.view.enabled){const gt=(this.right-this.left)/this.view.fullWidth/this.zoom,St=(this.top-this.bottom)/this.view.fullHeight/this.zoom;it+=gt*this.view.offsetX,ot=it+gt*this.view.width,ct-=St*this.view.offsetY,mt=ct-St*this.view.height}this.projectionMatrix.makeOrthographic(it,ot,ct,mt,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(o){const _=super.toJSON(o);return _.object.zoom=this.zoom,_.object.left=this.left,_.object.right=this.right,_.object.top=this.top,_.object.bottom=this.bottom,_.object.near=this.near,_.object.far=this.far,this.view!==null&&(_.object.view=Object.assign({},this.view)),_}}const NM=[.125,.215,.35,.446,.526,.582],C1=new S1,M1=new is;let T1=null;const n_=(1+Math.sqrt(5))/2,Ny=1/n_,kS=[new An(1,1,1),new An(-1,1,1),new An(1,1,-1),new An(-1,1,-1),new An(0,n_,Ny),new An(0,n_,-Ny),new An(Ny,0,n_),new An(-Ny,0,n_),new An(n_,Ny,0),new An(-n_,Ny,0)];class I1{constructor(o){this._renderer=o,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(o,_=0,$=.1,_e=100){T1=this._renderer.getRenderTarget(),this._setSize(256);const it=this._allocateTargets();return it.depthBuffer=!0,this._sceneToCubeUV(o,$,_e,it),_>0&&this._blur(it,0,0,_),this._applyPMREM(it),this._cleanup(it),it}fromEquirectangular(o,_=null){return this._fromTexture(o,_)}fromCubemap(o,_=null){return this._fromTexture(o,_)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=BS(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=P1(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(o){this._lodMax=Math.floor(Math.log2(o)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let o=0;o<this._lodPlanes.length;o++)this._lodPlanes[o].dispose()}_cleanup(o){this._renderer.setRenderTarget(T1),o.scissorTest=!1,uo(o,0,0,o.width,o.height)}_fromTexture(o,_){o.mapping===Qs||o.mapping===So?this._setSize(o.image.length===0?16:o.image[0].width||o.image[0].image.width):this._setSize(o.image.width/4),T1=this._renderer.getRenderTarget();const $=_||this._allocateTargets();return this._textureToCubeUV(o,$),this._applyPMREM($),this._cleanup($),$}_allocateTargets(){const o=3*Math.max(this._cubeSize,112),_=4*this._cubeSize,$={magFilter:zo,minFilter:zo,generateMipmaps:!1,type:pu,format:Ls,encoding:Am,depthBuffer:!1},_e=FM(o,_,$);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==o){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=FM(o,_,$);const{_lodMax:it}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(ot){const ct=[],mt=[],gt=[];let St=ot;const Tt=ot-4+1+NM.length;for(let Ct=0;Ct<Tt;Ct++){const Pt=Math.pow(2,St);mt.push(Pt);let Ot=1/Pt;Ct>ot-4?Ot=NM[Ct-ot+4-1]:Ct===0&&(Ot=0),gt.push(Ot);const Dt=1/(Pt-2),Yt=-Dt,Xt=1+Dt,Jt=[Yt,Yt,Xt,Yt,Xt,Xt,Yt,Yt,Xt,Xt,Yt,Xt],an=6,fn=6,gn=3,_n=2,On=1,Ln=new Float32Array(gn*fn*an),$n=new Float32Array(_n*fn*an),Jn=new Float32Array(On*fn*an);for(let Er=0;Er<an;Er++){const Or=Er%3*2/3-1,xr=Er>2?0:-1,Gr=[Or,xr,0,Or+2/3,xr,0,Or+2/3,xr+1,0,Or,xr,0,Or+2/3,xr+1,0,Or,xr+1,0];Ln.set(Gr,gn*fn*Er),$n.set(Jt,_n*fn*Er);const Hr=[Er,Er,Er,Er,Er,Er];Jn.set(Hr,On*fn*Er)}const Un=new ps;Un.setAttribute("position",new $o(Ln,gn)),Un.setAttribute("uv",new $o($n,_n)),Un.setAttribute("faceIndex",new $o(Jn,On)),ct.push(Un),St>4&&St--}return{lodPlanes:ct,sizeLods:mt,sigmas:gt}}(it)),this._blurMaterial=function(ot,ct,mt){const gt=new Float32Array(20),St=new An(0,1,0);return new Av({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/ct,CUBEUV_TEXEL_HEIGHT:1/mt,CUBEUV_MAX_MIP:`${ot}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:gt},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:St}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Lt,depthTest:!1,depthWrite:!1})}(it,o,_)}return _e}_compileMaterial(o){const _=new ju(this._lodPlanes[0],o);this._renderer.compile(_,C1)}_sceneToCubeUV(o,_,$,_e){const it=new ep(90,1,_,$),ot=[1,-1,1,1,1,1],ct=[1,1,1,-1,-1,-1],mt=this._renderer,gt=mt.autoClear,St=mt.toneMapping;mt.getClearColor(M1),mt.toneMapping=ws,mt.autoClear=!1;const Tt=new Wm({name:"PMREM.Background",side:Ft,depthWrite:!1,depthTest:!1}),Ct=new ju(new qm,Tt);let Pt=!1;const Ot=o.background;Ot?Ot.isColor&&(Tt.color.copy(Ot),o.background=null,Pt=!0):(Tt.color.copy(M1),Pt=!0);for(let Dt=0;Dt<6;Dt++){const Yt=Dt%3;Yt===0?(it.up.set(0,ot[Dt],0),it.lookAt(ct[Dt],0,0)):Yt===1?(it.up.set(0,0,ot[Dt]),it.lookAt(0,ct[Dt],0)):(it.up.set(0,ot[Dt],0),it.lookAt(0,0,ct[Dt]));const Xt=this._cubeSize;uo(_e,Yt*Xt,Dt>2?Xt:0,Xt,Xt),mt.setRenderTarget(_e),Pt&&mt.render(Ct,it),mt.render(o,it)}Ct.geometry.dispose(),Ct.material.dispose(),mt.toneMapping=St,mt.autoClear=gt,o.background=Ot}_textureToCubeUV(o,_){const $=this._renderer,_e=o.mapping===Qs||o.mapping===So;_e?(this._cubemapMaterial===null&&(this._cubemapMaterial=BS()),this._cubemapMaterial.uniforms.flipEnvMap.value=o.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=P1());const it=_e?this._cubemapMaterial:this._equirectMaterial,ot=new ju(this._lodPlanes[0],it);it.uniforms.envMap.value=o;const ct=this._cubeSize;uo(_,0,0,3*ct,2*ct),$.setRenderTarget(_),$.render(ot,C1)}_applyPMREM(o){const _=this._renderer,$=_.autoClear;_.autoClear=!1;for(let _e=1;_e<this._lodPlanes.length;_e++){const it=Math.sqrt(this._sigmas[_e]*this._sigmas[_e]-this._sigmas[_e-1]*this._sigmas[_e-1]),ot=kS[(_e-1)%kS.length];this._blur(o,_e-1,_e,it,ot)}_.autoClear=$}_blur(o,_,$,_e,it){const ot=this._pingPongRenderTarget;this._halfBlur(o,ot,_,$,_e,"latitudinal",it),this._halfBlur(ot,o,$,$,_e,"longitudinal",it)}_halfBlur(o,_,$,_e,it,ot,ct){const mt=this._renderer,gt=this._blurMaterial;ot!=="latitudinal"&&ot!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const St=new ju(this._lodPlanes[_e],gt),Tt=gt.uniforms,Ct=this._sizeLods[$]-1,Pt=isFinite(it)?Math.PI/(2*Ct):2*Math.PI/39,Ot=it/Pt,Dt=isFinite(it)?1+Math.floor(3*Ot):20;Dt>20&&console.warn(`sigmaRadians, ${it}, is too large and will clip, as it requested ${Dt} samples when the maximum is set to 20`);const Yt=[];let Xt=0;for(let fn=0;fn<20;++fn){const gn=fn/Ot,_n=Math.exp(-gn*gn/2);Yt.push(_n),fn===0?Xt+=_n:fn<Dt&&(Xt+=2*_n)}for(let fn=0;fn<Yt.length;fn++)Yt[fn]=Yt[fn]/Xt;Tt.envMap.value=o.texture,Tt.samples.value=Dt,Tt.weights.value=Yt,Tt.latitudinal.value=ot==="latitudinal",ct&&(Tt.poleAxis.value=ct);const{_lodMax:Jt}=this;Tt.dTheta.value=Pt,Tt.mipInt.value=Jt-$;const an=this._sizeLods[_e];uo(_,3*an*(_e>Jt-4?_e-Jt+4:0),4*(this._cubeSize-an),3*an,2*an),mt.setRenderTarget(_),mt.render(St,C1)}}function FM(ut,o,_){const $=new xp(ut,o,_);return $.texture.mapping=Bo,$.texture.name="PMREM.cubeUv",$.scissorTest=!0,$}function uo(ut,o,_,$,_e){ut.viewport.set(o,_,$,_e),ut.scissor.set(o,_,$,_e)}function P1(){return new Av({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Lt,depthTest:!1,depthWrite:!1})}function BS(){return new Av({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Lt,depthTest:!1,depthWrite:!1})}function UM(ut){let o=new WeakMap,_=null;function $(_e){const it=_e.target;it.removeEventListener("dispose",$);const ot=o.get(it);ot!==void 0&&(o.delete(it),ot.dispose())}return{get:function(_e){if(_e&&_e.isTexture){const it=_e.mapping,ot=it===_l||it===Mo,ct=it===Qs||it===So;if(ot||ct){if(_e.isRenderTargetTexture&&_e.needsPMREMUpdate===!0){_e.needsPMREMUpdate=!1;let mt=o.get(_e);return _===null&&(_=new I1(ut)),mt=ot?_.fromEquirectangular(_e,mt):_.fromCubemap(_e,mt),o.set(_e,mt),mt.texture}if(o.has(_e))return o.get(_e).texture;{const mt=_e.image;if(ot&&mt&&mt.height>0||ct&&mt&&function(gt){let St=0;for(let Tt=0;Tt<6;Tt++)gt[Tt]!==void 0&&St++;return St===6}(mt)){_===null&&(_=new I1(ut));const gt=ot?_.fromEquirectangular(_e):_.fromCubemap(_e);return o.set(_e,gt),_e.addEventListener("dispose",$),gt.texture}return null}}}return _e},dispose:function(){o=new WeakMap,_!==null&&(_.dispose(),_=null)}}}function Kr(ut){const o={};function _($){if(o[$]!==void 0)return o[$];let _e;switch($){case"WEBGL_depth_texture":_e=ut.getExtension("WEBGL_depth_texture")||ut.getExtension("MOZ_WEBGL_depth_texture")||ut.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":_e=ut.getExtension("EXT_texture_filter_anisotropic")||ut.getExtension("MOZ_EXT_texture_filter_anisotropic")||ut.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":_e=ut.getExtension("WEBGL_compressed_texture_s3tc")||ut.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||ut.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":_e=ut.getExtension("WEBGL_compressed_texture_pvrtc")||ut.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:_e=ut.getExtension($)}return o[$]=_e,_e}return{has:function($){return _($)!==null},init:function($){$.isWebGL2?_("EXT_color_buffer_float"):(_("WEBGL_depth_texture"),_("OES_texture_float"),_("OES_texture_half_float"),_("OES_texture_half_float_linear"),_("OES_standard_derivatives"),_("OES_element_index_uint"),_("OES_vertex_array_object"),_("ANGLE_instanced_arrays")),_("OES_texture_float_linear"),_("EXT_color_buffer_half_float"),_("WEBGL_multisampled_render_to_texture")},get:function($){const _e=_($);return _e===null&&console.warn("THREE.WebGLRenderer: "+$+" extension not supported."),_e}}}function Js(ut,o,_,$){const _e={},it=new WeakMap;function ot(mt){const gt=mt.target;gt.index!==null&&o.remove(gt.index);for(const Tt in gt.attributes)o.remove(gt.attributes[Tt]);gt.removeEventListener("dispose",ot),delete _e[gt.id];const St=it.get(gt);St&&(o.remove(St),it.delete(gt)),$.releaseStatesOfGeometry(gt),gt.isInstancedBufferGeometry===!0&&delete gt._maxInstanceCount,_.memory.geometries--}function ct(mt){const gt=[],St=mt.index,Tt=mt.attributes.position;let Ct=0;if(St!==null){const Dt=St.array;Ct=St.version;for(let Yt=0,Xt=Dt.length;Yt<Xt;Yt+=3){const Jt=Dt[Yt+0],an=Dt[Yt+1],fn=Dt[Yt+2];gt.push(Jt,an,an,fn,fn,Jt)}}else{const Dt=Tt.array;Ct=Tt.version;for(let Yt=0,Xt=Dt.length/3-1;Yt<Xt;Yt+=3){const Jt=Yt+0,an=Yt+1,fn=Yt+2;gt.push(Jt,an,an,fn,fn,Jt)}}const Pt=new(A1(gt)?wt:Ql)(gt,1);Pt.version=Ct;const Ot=it.get(mt);Ot&&o.remove(Ot),it.set(mt,Pt)}return{get:function(mt,gt){return _e[gt.id]===!0||(gt.addEventListener("dispose",ot),_e[gt.id]=!0,_.memory.geometries++),gt},update:function(mt){const gt=mt.attributes;for(const Tt in gt)o.update(gt[Tt],34962);const St=mt.morphAttributes;for(const Tt in St){const Ct=St[Tt];for(let Pt=0,Ot=Ct.length;Pt<Ot;Pt++)o.update(Ct[Pt],34962)}},getWireframeAttribute:function(mt){const gt=it.get(mt);if(gt){const St=mt.index;St!==null&&gt.version<St.version&&ct(mt)}else ct(mt);return it.get(mt)}}}function UA(ut,o,_,$){const _e=$.isWebGL2;let it,ot,ct;this.setMode=function(mt){it=mt},this.setIndex=function(mt){ot=mt.type,ct=mt.bytesPerElement},this.render=function(mt,gt){ut.drawElements(it,gt,ot,mt*ct),_.update(gt,it,1)},this.renderInstances=function(mt,gt,St){if(St===0)return;let Tt,Ct;if(_e)Tt=ut,Ct="drawElementsInstanced";else if(Tt=o.get("ANGLE_instanced_arrays"),Ct="drawElementsInstancedANGLE",Tt===null)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");Tt[Ct](it,gt,ot,mt*ct,St),_.update(gt,it,St)}}function wv(ut){const o={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:o,programs:null,autoReset:!0,reset:function(){o.frame++,o.calls=0,o.triangles=0,o.points=0,o.lines=0},update:function(_,$,_e){switch(o.calls++,$){case 4:o.triangles+=_e*(_/3);break;case 1:o.lines+=_e*(_/2);break;case 3:o.lines+=_e*(_-1);break;case 2:o.lines+=_e*_;break;case 0:o.points+=_e*_;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",$)}}}}function OS(ut,o){return ut[0]-o[0]}function LS(ut,o){return Math.abs(o[1])-Math.abs(ut[1])}function jM(ut,o,_){const $={},_e=new Float32Array(8),it=new WeakMap,ot=new Fo,ct=[];for(let mt=0;mt<8;mt++)ct[mt]=[mt,0];return{update:function(mt,gt,St,Tt){const Ct=mt.morphTargetInfluences;if(o.isWebGL2===!0){const Pt=gt.morphAttributes.position||gt.morphAttributes.normal||gt.morphAttributes.color,Ot=Pt!==void 0?Pt.length:0;let Dt=it.get(gt);if(Dt===void 0||Dt.count!==Ot){Dt!==void 0&&Dt.texture.dispose();const Jt=gt.morphAttributes.position!==void 0,an=gt.morphAttributes.normal!==void 0,fn=gt.morphAttributes.color!==void 0,gn=gt.morphAttributes.position||[],_n=gt.morphAttributes.normal||[],On=gt.morphAttributes.color||[];let Ln=0;Jt===!0&&(Ln=1),an===!0&&(Ln=2),fn===!0&&(Ln=3);let $n=gt.attributes.position.count*Ln,Jn=1;$n>o.maxTextureSize&&(Jn=Math.ceil($n/o.maxTextureSize),$n=o.maxTextureSize);const Un=new Float32Array($n*Jn*4*Ot),Er=new T0(Un,$n,Jn,Ot);Er.type=Pl,Er.needsUpdate=!0;const Or=4*Ln;for(let xr=0;xr<Ot;xr++){const Gr=gn[xr],Hr=_n[xr],pr=On[xr],vr=$n*Jn*4*xr;for(let jr=0;jr<Gr.count;jr++){const Sr=jr*Or;Jt===!0&&(ot.fromBufferAttribute(Gr,jr),Un[vr+Sr+0]=ot.x,Un[vr+Sr+1]=ot.y,Un[vr+Sr+2]=ot.z,Un[vr+Sr+3]=0),an===!0&&(ot.fromBufferAttribute(Hr,jr),Un[vr+Sr+4]=ot.x,Un[vr+Sr+5]=ot.y,Un[vr+Sr+6]=ot.z,Un[vr+Sr+7]=0),fn===!0&&(ot.fromBufferAttribute(pr,jr),Un[vr+Sr+8]=ot.x,Un[vr+Sr+9]=ot.y,Un[vr+Sr+10]=ot.z,Un[vr+Sr+11]=pr.itemSize===4?ot.w:1)}}Dt={count:Ot,texture:Er,size:new Rr($n,Jn)},it.set(gt,Dt),gt.addEventListener("dispose",function xr(){Er.dispose(),it.delete(gt),gt.removeEventListener("dispose",xr)})}let Yt=0;for(let Jt=0;Jt<Ct.length;Jt++)Yt+=Ct[Jt];const Xt=gt.morphTargetsRelative?1:1-Yt;Tt.getUniforms().setValue(ut,"morphTargetBaseInfluence",Xt),Tt.getUniforms().setValue(ut,"morphTargetInfluences",Ct),Tt.getUniforms().setValue(ut,"morphTargetsTexture",Dt.texture,_),Tt.getUniforms().setValue(ut,"morphTargetsTextureSize",Dt.size)}else{const Pt=Ct===void 0?0:Ct.length;let Ot=$[gt.id];if(Ot===void 0||Ot.length!==Pt){Ot=[];for(let an=0;an<Pt;an++)Ot[an]=[an,0];$[gt.id]=Ot}for(let an=0;an<Pt;an++){const fn=Ot[an];fn[0]=an,fn[1]=Ct[an]}Ot.sort(LS);for(let an=0;an<8;an++)an<Pt&&Ot[an][1]?(ct[an][0]=Ot[an][0],ct[an][1]=Ot[an][1]):(ct[an][0]=Number.MAX_SAFE_INTEGER,ct[an][1]=0);ct.sort(OS);const Dt=gt.morphAttributes.position,Yt=gt.morphAttributes.normal;let Xt=0;for(let an=0;an<8;an++){const fn=ct[an],gn=fn[0],_n=fn[1];gn!==Number.MAX_SAFE_INTEGER&&_n?(Dt&&gt.getAttribute("morphTarget"+an)!==Dt[gn]&&gt.setAttribute("morphTarget"+an,Dt[gn]),Yt&&gt.getAttribute("morphNormal"+an)!==Yt[gn]&&gt.setAttribute("morphNormal"+an,Yt[gn]),_e[an]=_n,Xt+=_n):(Dt&&gt.hasAttribute("morphTarget"+an)===!0&&gt.deleteAttribute("morphTarget"+an),Yt&&gt.hasAttribute("morphNormal"+an)===!0&&gt.deleteAttribute("morphNormal"+an),_e[an]=0)}const Jt=gt.morphTargetsRelative?1:1-Xt;Tt.getUniforms().setValue(ut,"morphTargetBaseInfluence",Jt),Tt.getUniforms().setValue(ut,"morphTargetInfluences",_e)}}}}function ba(ut,o,_,$){let _e=new WeakMap;function it(ot){const ct=ot.target;ct.removeEventListener("dispose",it),_.remove(ct.instanceMatrix),ct.instanceColor!==null&&_.remove(ct.instanceColor)}return{update:function(ot){const ct=$.render.frame,mt=ot.geometry,gt=o.get(ot,mt);return _e.get(gt)!==ct&&(o.update(gt),_e.set(gt,ct)),ot.isInstancedMesh&&(ot.hasEventListener("dispose",it)===!1&&ot.addEventListener("dispose",it),_.update(ot.instanceMatrix,34962),ot.instanceColor!==null&&_.update(ot.instanceColor,34962)),gt},dispose:function(){_e=new WeakMap}}}const zM=new yu,NS=new T0,FS=new O_,US=new NA,VM=[],D1=[],jS=new Float32Array(16),Ym=new Float32Array(9),xv=new Float32Array(4);function jA(ut,o,_){const $=ut[0];if($<=0||$>0)return ut;const _e=o*_;let it=VM[_e];if(it===void 0&&(it=new Float32Array(_e),VM[_e]=it),o!==0){$.toArray(it,0);for(let ot=1,ct=0;ot!==o;++ot)ct+=_,ut[ot].toArray(it,ct)}return it}function tp(ut,o){if(ut.length!==o.length)return!1;for(let _=0,$=ut.length;_<$;_++)if(ut[_]!==o[_])return!1;return!0}function su(ut,o){for(let _=0,$=o.length;_<$;_++)ut[_]=o[_]}function Vw(ut,o){let _=D1[o];_===void 0&&(_=new Int32Array(o),D1[o]=_);for(let $=0;$!==o;++$)_[$]=ut.allocateTextureUnit();return _}function Qw(ut,o){const _=this.cache;_[0]!==o&&(ut.uniform1f(this.addr,o),_[0]=o)}function zS(ut,o){const _=this.cache;if(o.x!==void 0)_[0]===o.x&&_[1]===o.y||(ut.uniform2f(this.addr,o.x,o.y),_[0]=o.x,_[1]=o.y);else{if(tp(_,o))return;ut.uniform2fv(this.addr,o),su(_,o)}}function Gw(ut,o){const _=this.cache;if(o.x!==void 0)_[0]===o.x&&_[1]===o.y&&_[2]===o.z||(ut.uniform3f(this.addr,o.x,o.y,o.z),_[0]=o.x,_[1]=o.y,_[2]=o.z);else if(o.r!==void 0)_[0]===o.r&&_[1]===o.g&&_[2]===o.b||(ut.uniform3f(this.addr,o.r,o.g,o.b),_[0]=o.r,_[1]=o.g,_[2]=o.b);else{if(tp(_,o))return;ut.uniform3fv(this.addr,o),su(_,o)}}function QM(ut,o){const _=this.cache;if(o.x!==void 0)_[0]===o.x&&_[1]===o.y&&_[2]===o.z&&_[3]===o.w||(ut.uniform4f(this.addr,o.x,o.y,o.z,o.w),_[0]=o.x,_[1]=o.y,_[2]=o.z,_[3]=o.w);else{if(tp(_,o))return;ut.uniform4fv(this.addr,o),su(_,o)}}function VS(ut,o){const _=this.cache,$=o.elements;if($===void 0){if(tp(_,o))return;ut.uniformMatrix2fv(this.addr,!1,o),su(_,o)}else{if(tp(_,$))return;xv.set($),ut.uniformMatrix2fv(this.addr,!1,xv),su(_,$)}}function dp(ut,o){const _=this.cache,$=o.elements;if($===void 0){if(tp(_,o))return;ut.uniformMatrix3fv(this.addr,!1,o),su(_,o)}else{if(tp(_,$))return;Ym.set($),ut.uniformMatrix3fv(this.addr,!1,Ym),su(_,$)}}function bv(ut,o){const _=this.cache,$=o.elements;if($===void 0){if(tp(_,o))return;ut.uniformMatrix4fv(this.addr,!1,o),su(_,o)}else{if(tp(_,$))return;jS.set($),ut.uniformMatrix4fv(this.addr,!1,jS),su(_,$)}}function Hw(ut,o){const _=this.cache;_[0]!==o&&(ut.uniform1i(this.addr,o),_[0]=o)}function R1(ut,o){const _=this.cache;tp(_,o)||(ut.uniform2iv(this.addr,o),su(_,o))}function Ev(ut,o){const _=this.cache;tp(_,o)||(ut.uniform3iv(this.addr,o),su(_,o))}function QS(ut,o){const _=this.cache;tp(_,o)||(ut.uniform4iv(this.addr,o),su(_,o))}function k1(ut,o){const _=this.cache;_[0]!==o&&(ut.uniform1ui(this.addr,o),_[0]=o)}function GM(ut,o){const _=this.cache;tp(_,o)||(ut.uniform2uiv(this.addr,o),su(_,o))}function B1(ut,o){const _=this.cache;tp(_,o)||(ut.uniform3uiv(this.addr,o),su(_,o))}function Sv(ut,o){const _=this.cache;tp(_,o)||(ut.uniform4uiv(this.addr,o),su(_,o))}function Mm(ut,o,_){const $=this.cache,_e=_.allocateTextureUnit();$[0]!==_e&&(ut.uniform1i(this.addr,_e),$[0]=_e),_.setTexture2D(o||zM,_e)}function O1(ut,o,_){const $=this.cache,_e=_.allocateTextureUnit();$[0]!==_e&&(ut.uniform1i(this.addr,_e),$[0]=_e),_.setTexture3D(o||FS,_e)}function HM(ut,o,_){const $=this.cache,_e=_.allocateTextureUnit();$[0]!==_e&&(ut.uniform1i(this.addr,_e),$[0]=_e),_.setTextureCube(o||US,_e)}function L1(ut,o,_){const $=this.cache,_e=_.allocateTextureUnit();$[0]!==_e&&(ut.uniform1i(this.addr,_e),$[0]=_e),_.setTexture2DArray(o||NS,_e)}function WM(ut,o){ut.uniform1fv(this.addr,o)}function GS(ut,o){const _=jA(o,this.size,2);ut.uniform2fv(this.addr,_)}function N1(ut,o){const _=jA(o,this.size,3);ut.uniform3fv(this.addr,_)}function qM(ut,o){const _=jA(o,this.size,4);ut.uniform4fv(this.addr,_)}function YM(ut,o){const _=jA(o,this.size,4);ut.uniformMatrix2fv(this.addr,!1,_)}function cP(ut,o){const _=jA(o,this.size,9);ut.uniformMatrix3fv(this.addr,!1,_)}function XM(ut,o){const _=jA(o,this.size,16);ut.uniformMatrix4fv(this.addr,!1,_)}function KM(ut,o){ut.uniform1iv(this.addr,o)}function $M(ut,o){ut.uniform2iv(this.addr,o)}function hm(ut,o){ut.uniform3iv(this.addr,o)}function Ml(ut,o){ut.uniform4iv(this.addr,o)}function JM(ut,o){ut.uniform1uiv(this.addr,o)}function Fy(ut,o){ut.uniform2uiv(this.addr,o)}function dm(ut,o){ut.uniform3uiv(this.addr,o)}function z0(ut,o){ut.uniform4uiv(this.addr,o)}function eu(ut,o,_){const $=o.length,_e=Vw(_,$);ut.uniform1iv(this.addr,_e);for(let it=0;it!==$;++it)_.setTexture2D(o[it]||zM,_e[it])}function ZM(ut,o,_){const $=o.length,_e=Vw(_,$);ut.uniform1iv(this.addr,_e);for(let it=0;it!==$;++it)_.setTexture3D(o[it]||FS,_e[it])}function HS(ut,o,_){const $=o.length,_e=Vw(_,$);ut.uniform1iv(this.addr,_e);for(let it=0;it!==$;++it)_.setTextureCube(o[it]||US,_e[it])}function eT(ut,o,_){const $=o.length,_e=Vw(_,$);ut.uniform1iv(this.addr,_e);for(let it=0;it!==$;++it)_.setTexture2DArray(o[it]||NS,_e[it])}class tT{constructor(o,_,$){this.id=o,this.addr=$,this.cache=[],this.setValue=function(_e){switch(_e){case 5126:return Qw;case 35664:return zS;case 35665:return Gw;case 35666:return QM;case 35674:return VS;case 35675:return dp;case 35676:return bv;case 5124:case 35670:return Hw;case 35667:case 35671:return R1;case 35668:case 35672:return Ev;case 35669:case 35673:return QS;case 5125:return k1;case 36294:return GM;case 36295:return B1;case 36296:return Sv;case 35678:case 36198:case 36298:case 36306:case 35682:return Mm;case 35679:case 36299:case 36307:return O1;case 35680:case 36300:case 36308:case 36293:return HM;case 36289:case 36303:case 36311:case 36292:return L1}}(_.type)}}class nT{constructor(o,_,$){this.id=o,this.addr=$,this.cache=[],this.size=_.size,this.setValue=function(_e){switch(_e){case 5126:return WM;case 35664:return GS;case 35665:return N1;case 35666:return qM;case 35674:return YM;case 35675:return cP;case 35676:return XM;case 5124:case 35670:return KM;case 35667:case 35671:return $M;case 35668:case 35672:return hm;case 35669:case 35673:return Ml;case 5125:return JM;case 36294:return Fy;case 36295:return dm;case 36296:return z0;case 35678:case 36198:case 36298:case 36306:case 35682:return eu;case 35679:case 36299:case 36307:return ZM;case 35680:case 36300:case 36308:case 36293:return HS;case 36289:case 36303:case 36311:case 36292:return eT}}(_.type)}}class uP{constructor(o){this.id=o,this.seq=[],this.map={}}setValue(o,_,$){const _e=this.seq;for(let it=0,ot=_e.length;it!==ot;++it){const ct=_e[it];ct.setValue(o,_[ct.id],$)}}}const WS=/(\w+)(\])?(\[|\.)?/g;function rT(ut,o){ut.seq.push(o),ut.map[o.id]=o}function hP(ut,o,_){const $=ut.name,_e=$.length;for(WS.lastIndex=0;;){const it=WS.exec($),ot=WS.lastIndex;let ct=it[1];const mt=it[2]==="]",gt=it[3];if(mt&&(ct|=0),gt===void 0||gt==="["&&ot+2===_e){rT(_,gt===void 0?new tT(ct,ut,o):new nT(ct,ut,o));break}{let St=_.map[ct];St===void 0&&(St=new uP(ct),rT(_,St)),_=St}}}class F1{constructor(o,_){this.seq=[],this.map={};const $=o.getProgramParameter(_,35718);for(let _e=0;_e<$;++_e){const it=o.getActiveUniform(_,_e);hP(it,o.getUniformLocation(_,it.name),this)}}setValue(o,_,$,_e){const it=this.map[_];it!==void 0&&it.setValue(o,$,_e)}setOptional(o,_,$){const _e=_[$];_e!==void 0&&this.setValue(o,$,_e)}static upload(o,_,$,_e){for(let it=0,ot=_.length;it!==ot;++it){const ct=_[it],mt=$[ct.id];mt.needsUpdate!==!1&&ct.setValue(o,mt.value,_e)}}static seqWithValue(o,_){const $=[];for(let _e=0,it=o.length;_e!==it;++_e){const ot=o[_e];ot.id in _&&$.push(ot)}return $}}function iT(ut,o,_){const $=ut.createShader(o);return ut.shaderSource($,_),ut.compileShader($),$}let qS=0;function Ww(ut){switch(ut){case Am:return["Linear","( value )"];case mo:return["sRGB","( value )"];case C_:return["RGBM","( value, 16.0 )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",ut),["Linear","( value )"]}}function Tl(ut,o,_){const $=ut.getShaderParameter(o,35713),_e=ut.getShaderInfoLog(o).trim();if($&&_e==="")return"";const it=/ERROR: 0:(\d+)/.exec(_e);if(it){const ot=parseInt(it[1]);return _.toUpperCase()+`

`+_e+`

`+function(ct,mt){const gt=ct.split(`
`),St=[],Tt=Math.max(mt-6,0),Ct=Math.min(mt+6,gt.length);for(let Pt=Tt;Pt<Ct;Pt++){const Ot=Pt+1;St.push(`${Ot===mt?">":" "} ${Ot}: ${gt[Pt]}`)}return St.join(`
`)}(ut.getShaderSource(o),ot)}return _e}function sT(ut,o){const _=Ww(o);return"vec4 "+ut+"( vec4 value ) { return "+_[0]+"ToLinear"+_[1]+"; }"}function oT(ut,o){const _=Ww(o);return"vec4 "+ut+"( vec4 value ) { return LinearTo"+_[0]+_[1]+"; }"}function U1(ut,o){let _;switch(o){case io:_="Linear";break;case ks:_="Reinhard";break;case er:_="OptimizedCineon";break;case Vs:_="ACESFilmic";break;case Ll:_="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",o),_="Linear"}return"vec3 "+ut+"( vec3 color ) { return "+_+"ToneMapping( color ); }"}function V0(ut){return ut!==""}function Cv(ut,o){const _=o.numSpotLightShadows+o.numSpotLightMaps-o.numSpotLightShadowsWithMaps;return ut.replace(/NUM_DIR_LIGHTS/g,o.numDirLights).replace(/NUM_SPOT_LIGHTS/g,o.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,o.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,_).replace(/NUM_RECT_AREA_LIGHTS/g,o.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,o.numPointLights).replace(/NUM_HEMI_LIGHTS/g,o.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,o.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,o.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,o.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,o.numPointLightShadows)}function YS(ut,o){return ut.replace(/NUM_CLIPPING_PLANES/g,o.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,o.numClippingPlanes-o.numClipIntersection)}const qw=/^[ \t]*#include +<([\w\d./]+)>/gm;function G_(ut){return ut.replace(qw,Yw)}function Yw(ut,o){const _=ao[o];if(_===void 0)throw new Error("Can not resolve #include <"+o+">");return G_(_)}const j1=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function zA(ut){return ut.replace(j1,Xw)}function Xw(ut,o,_,$){let _e="";for(let it=parseInt(o);it<parseInt(_);it++)_e+=$.replace(/\[\s*i\s*\]/g,"[ "+it+" ]").replace(/UNROLLED_LOOP_INDEX/g,it);return _e}function aT(ut){let o="precision "+ut.precision+` float;
precision `+ut.precision+" int;";return ut.precision==="highp"?o+=`
#define HIGH_PRECISION`:ut.precision==="mediump"?o+=`
#define MEDIUM_PRECISION`:ut.precision==="lowp"&&(o+=`
#define LOW_PRECISION`),o}function dP(ut,o,_,$){const _e=ut.getContext(),it=_.defines;let ot=_.vertexShader,ct=_.fragmentShader;const mt=function(Ln){let $n="SHADOWMAP_TYPE_BASIC";return Ln.shadowMapType===qt?$n="SHADOWMAP_TYPE_PCF":Ln.shadowMapType===zt?$n="SHADOWMAP_TYPE_PCF_SOFT":Ln.shadowMapType===jt&&($n="SHADOWMAP_TYPE_VSM"),$n}(_),gt=function(Ln){let $n="ENVMAP_TYPE_CUBE";if(Ln.envMap)switch(Ln.envMapMode){case Qs:case So:$n="ENVMAP_TYPE_CUBE";break;case Bo:$n="ENVMAP_TYPE_CUBE_UV"}return $n}(_),St=function(Ln){let $n="ENVMAP_MODE_REFLECTION";return Ln.envMap&&Ln.envMapMode===So&&($n="ENVMAP_MODE_REFRACTION"),$n}(_),Tt=function(Ln){let $n="ENVMAP_BLENDING_NONE";if(Ln.envMap)switch(Ln.combine){case ls:$n="ENVMAP_BLENDING_MULTIPLY";break;case Rs:$n="ENVMAP_BLENDING_MIX";break;case us:$n="ENVMAP_BLENDING_ADD"}return $n}(_),Ct=function(Ln){const $n=Ln.envMapCubeUVHeight;if($n===null)return null;const Jn=Math.log2($n)-2,Un=1/$n;return{texelWidth:1/(3*Math.max(Math.pow(2,Jn),112)),texelHeight:Un,maxMip:Jn}}(_),Pt=_.isWebGL2?"":function(Ln){return[Ln.extensionDerivatives||Ln.envMapCubeUVHeight||Ln.bumpMap||Ln.tangentSpaceNormalMap||Ln.clearcoatNormalMap||Ln.flatShading||Ln.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(Ln.extensionFragDepth||Ln.logarithmicDepthBuffer)&&Ln.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",Ln.extensionDrawBuffers&&Ln.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(Ln.extensionShaderTextureLOD||Ln.envMap||Ln.transmission)&&Ln.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(V0).join(`
`)}(_),Ot=function(Ln){const $n=[];for(const Jn in Ln){const Un=Ln[Jn];Un!==!1&&$n.push("#define "+Jn+" "+Un)}return $n.join(`
`)}(it),Dt=_e.createProgram();let Yt,Xt,Jt=_.glslVersion?"#version "+_.glslVersion+`
`:"";_.isRawShaderMaterial?(Yt=[Ot].filter(V0).join(`
`),Yt.length>0&&(Yt+=`
`),Xt=[Pt,Ot].filter(V0).join(`
`),Xt.length>0&&(Xt+=`
`)):(Yt=[aT(_),"#define SHADER_NAME "+_.shaderName,Ot,_.instancing?"#define USE_INSTANCING":"",_.instancingColor?"#define USE_INSTANCING_COLOR":"",_.supportsVertexTextures?"#define VERTEX_TEXTURES":"",_.useFog&&_.fog?"#define USE_FOG":"",_.useFog&&_.fogExp2?"#define FOG_EXP2":"",_.map?"#define USE_MAP":"",_.envMap?"#define USE_ENVMAP":"",_.envMap?"#define "+St:"",_.lightMap?"#define USE_LIGHTMAP":"",_.aoMap?"#define USE_AOMAP":"",_.emissiveMap?"#define USE_EMISSIVEMAP":"",_.bumpMap?"#define USE_BUMPMAP":"",_.normalMap?"#define USE_NORMALMAP":"",_.normalMap&&_.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",_.normalMap&&_.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",_.clearcoatMap?"#define USE_CLEARCOATMAP":"",_.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",_.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",_.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",_.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",_.displacementMap&&_.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",_.specularMap?"#define USE_SPECULARMAP":"",_.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",_.specularColorMap?"#define USE_SPECULARCOLORMAP":"",_.roughnessMap?"#define USE_ROUGHNESSMAP":"",_.metalnessMap?"#define USE_METALNESSMAP":"",_.alphaMap?"#define USE_ALPHAMAP":"",_.transmission?"#define USE_TRANSMISSION":"",_.transmissionMap?"#define USE_TRANSMISSIONMAP":"",_.thicknessMap?"#define USE_THICKNESSMAP":"",_.sheenColorMap?"#define USE_SHEENCOLORMAP":"",_.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",_.vertexTangents?"#define USE_TANGENT":"",_.vertexColors?"#define USE_COLOR":"",_.vertexAlphas?"#define USE_COLOR_ALPHA":"",_.vertexUvs?"#define USE_UV":"",_.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",_.flatShading?"#define FLAT_SHADED":"",_.skinning?"#define USE_SKINNING":"",_.morphTargets?"#define USE_MORPHTARGETS":"",_.morphNormals&&_.flatShading===!1?"#define USE_MORPHNORMALS":"",_.morphColors&&_.isWebGL2?"#define USE_MORPHCOLORS":"",_.morphTargetsCount>0&&_.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",_.morphTargetsCount>0&&_.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+_.morphTextureStride:"",_.morphTargetsCount>0&&_.isWebGL2?"#define MORPHTARGETS_COUNT "+_.morphTargetsCount:"",_.doubleSided?"#define DOUBLE_SIDED":"",_.flipSided?"#define FLIP_SIDED":"",_.shadowMapEnabled?"#define USE_SHADOWMAP":"",_.shadowMapEnabled?"#define "+mt:"",_.sizeAttenuation?"#define USE_SIZEATTENUATION":"",_.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",_.logarithmicDepthBuffer&&_.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(V0).join(`
`),Xt=[Pt,aT(_),"#define SHADER_NAME "+_.shaderName,Ot,_.useFog&&_.fog?"#define USE_FOG":"",_.useFog&&_.fogExp2?"#define FOG_EXP2":"",_.map?"#define USE_MAP":"",_.matcap?"#define USE_MATCAP":"",_.envMap?"#define USE_ENVMAP":"",_.envMap?"#define "+gt:"",_.envMap?"#define "+St:"",_.envMap?"#define "+Tt:"",Ct?"#define CUBEUV_TEXEL_WIDTH "+Ct.texelWidth:"",Ct?"#define CUBEUV_TEXEL_HEIGHT "+Ct.texelHeight:"",Ct?"#define CUBEUV_MAX_MIP "+Ct.maxMip+".0":"",_.lightMap?"#define USE_LIGHTMAP":"",_.aoMap?"#define USE_AOMAP":"",_.emissiveMap?"#define USE_EMISSIVEMAP":"",_.bumpMap?"#define USE_BUMPMAP":"",_.normalMap?"#define USE_NORMALMAP":"",_.normalMap&&_.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",_.normalMap&&_.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",_.clearcoat?"#define USE_CLEARCOAT":"",_.clearcoatMap?"#define USE_CLEARCOATMAP":"",_.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",_.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",_.iridescence?"#define USE_IRIDESCENCE":"",_.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",_.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",_.specularMap?"#define USE_SPECULARMAP":"",_.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",_.specularColorMap?"#define USE_SPECULARCOLORMAP":"",_.roughnessMap?"#define USE_ROUGHNESSMAP":"",_.metalnessMap?"#define USE_METALNESSMAP":"",_.alphaMap?"#define USE_ALPHAMAP":"",_.alphaTest?"#define USE_ALPHATEST":"",_.sheen?"#define USE_SHEEN":"",_.sheenColorMap?"#define USE_SHEENCOLORMAP":"",_.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",_.transmission?"#define USE_TRANSMISSION":"",_.transmissionMap?"#define USE_TRANSMISSIONMAP":"",_.thicknessMap?"#define USE_THICKNESSMAP":"",_.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",_.vertexTangents?"#define USE_TANGENT":"",_.vertexColors||_.instancingColor?"#define USE_COLOR":"",_.vertexAlphas?"#define USE_COLOR_ALPHA":"",_.vertexUvs?"#define USE_UV":"",_.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",_.gradientMap?"#define USE_GRADIENTMAP":"",_.flatShading?"#define FLAT_SHADED":"",_.doubleSided?"#define DOUBLE_SIDED":"",_.flipSided?"#define FLIP_SIDED":"",_.shadowMapEnabled?"#define USE_SHADOWMAP":"",_.shadowMapEnabled?"#define "+mt:"",_.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",_.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",_.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",_.logarithmicDepthBuffer&&_.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",_.toneMapping!==ws?"#define TONE_MAPPING":"",_.toneMapping!==ws?ao.tonemapping_pars_fragment:"",_.toneMapping!==ws?U1("toneMapping",_.toneMapping):"",_.dithering?"#define DITHERING":"",_.opaque?"#define OPAQUE":"",ao.encodings_pars_fragment,oT("linearToOutputTexel",_.outputEncoding),_.transmissionSamplerMapEncoding?sT("transmissionSamplerMapTexelToLinear",_.transmissionSamplerMapEncoding):"",_.useDepthPacking?"#define DEPTH_PACKING "+_.depthPacking:"",`
`].filter(V0).join(`
`)),ot=G_(ot),ot=Cv(ot,_),ot=YS(ot,_),ct=G_(ct),ct=Cv(ct,_),ct=YS(ct,_),ot=zA(ot),ct=zA(ct),_.isWebGL2&&_.isRawShaderMaterial!==!0&&(Jt=`#version 300 es
`,Yt=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+Yt,Xt=["#define varying in",_.glslVersion===pv?"":"layout(location = 0) out highp vec4 pc_fragColor;",_.glslVersion===pv?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+Xt);const an=Jt+Xt+ct,fn=iT(_e,35633,Jt+Yt+ot),gn=iT(_e,35632,an);if(_e.attachShader(Dt,fn),_e.attachShader(Dt,gn),_.index0AttributeName!==void 0?_e.bindAttribLocation(Dt,0,_.index0AttributeName):_.morphTargets===!0&&_e.bindAttribLocation(Dt,0,"position"),_e.linkProgram(Dt),ut.debug.checkShaderErrors){const Ln=_e.getProgramInfoLog(Dt).trim(),$n=_e.getShaderInfoLog(fn).trim(),Jn=_e.getShaderInfoLog(gn).trim();let Un=!0,Er=!0;if(_e.getProgramParameter(Dt,35714)===!1){Un=!1;const Or=Tl(_e,fn,"vertex"),xr=Tl(_e,gn,"fragment");console.error("THREE.WebGLProgram: Shader Error "+_e.getError()+" - VALIDATE_STATUS "+_e.getProgramParameter(Dt,35715)+`

Program Info Log: `+Ln+`
`+Or+`
`+xr)}else Ln!==""?console.warn("THREE.WebGLProgram: Program Info Log:",Ln):$n!==""&&Jn!==""||(Er=!1);Er&&(this.diagnostics={runnable:Un,programLog:Ln,vertexShader:{log:$n,prefix:Yt},fragmentShader:{log:Jn,prefix:Xt}})}let _n,On;return _e.deleteShader(fn),_e.deleteShader(gn),this.getUniforms=function(){return _n===void 0&&(_n=new F1(_e,Dt)),_n},this.getAttributes=function(){return On===void 0&&(On=function(Ln,$n){const Jn={},Un=Ln.getProgramParameter($n,35721);for(let Er=0;Er<Un;Er++){const Or=Ln.getActiveAttrib($n,Er),xr=Or.name;let Gr=1;Or.type===35674&&(Gr=2),Or.type===35675&&(Gr=3),Or.type===35676&&(Gr=4),Jn[xr]={type:Or.type,location:Ln.getAttribLocation($n,xr),locationSize:Gr}}return Jn}(_e,Dt)),On},this.destroy=function(){$.releaseStatesOfProgram(this),_e.deleteProgram(Dt),this.program=void 0},this.name=_.shaderName,this.id=qS++,this.cacheKey=o,this.usedTimes=1,this.program=Dt,this.vertexShader=fn,this.fragmentShader=gn,this}let lT=0;class z1{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(o){const _=o.vertexShader,$=o.fragmentShader,_e=this._getShaderStage(_),it=this._getShaderStage($),ot=this._getShaderCacheForMaterial(o);return ot.has(_e)===!1&&(ot.add(_e),_e.usedTimes++),ot.has(it)===!1&&(ot.add(it),it.usedTimes++),this}remove(o){const _=this.materialCache.get(o);for(const $ of _)$.usedTimes--,$.usedTimes===0&&this.shaderCache.delete($.code);return this.materialCache.delete(o),this}getVertexShaderID(o){return this._getShaderStage(o.vertexShader).id}getFragmentShaderID(o){return this._getShaderStage(o.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(o){const _=this.materialCache;let $=_.get(o);return $===void 0&&($=new Set,_.set(o,$)),$}_getShaderStage(o){const _=this.shaderCache;let $=_.get(o);return $===void 0&&($=new cT(o),_.set(o,$)),$}}class cT{constructor(o){this.id=lT++,this.code=o,this.usedTimes=0}}function pP(ut,o,_,$,_e,it,ot){const ct=new cp,mt=new z1,gt=[],St=_e.isWebGL2,Tt=_e.logarithmicDepthBuffer,Ct=_e.vertexTextures;let Pt=_e.precision;const Ot={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(Dt,Yt,Xt,Jt,an){const fn=Jt.fog,gn=an.geometry,_n=Dt.isMeshStandardMaterial?Jt.environment:null,On=(Dt.isMeshStandardMaterial?_:o).get(Dt.envMap||_n),Ln=On&&On.mapping===Bo?On.image.height:null,$n=Ot[Dt.type];Dt.precision!==null&&(Pt=_e.getMaxPrecision(Dt.precision),Pt!==Dt.precision&&console.warn("THREE.WebGLProgram.getParameters:",Dt.precision,"not supported, using",Pt,"instead."));const Jn=gn.morphAttributes.position||gn.morphAttributes.normal||gn.morphAttributes.color,Un=Jn!==void 0?Jn.length:0;let Er,Or,xr,Gr,Hr=0;if(gn.morphAttributes.position!==void 0&&(Hr=1),gn.morphAttributes.normal!==void 0&&(Hr=2),gn.morphAttributes.color!==void 0&&(Hr=3),$n){const As=um[$n];Er=As.vertexShader,Or=As.fragmentShader}else Er=Dt.vertexShader,Or=Dt.fragmentShader,mt.update(Dt),xr=mt.getVertexShaderID(Dt),Gr=mt.getFragmentShaderID(Dt);const pr=ut.getRenderTarget(),vr=ut.userData&&ut.userData.transmissionRenderTarget,jr=Dt.alphaTest>0,Sr=Dt.clearcoat>0,Qr=Dt.iridescence>0;return{isWebGL2:St,shaderID:$n,shaderName:Dt.type,vertexShader:Er,fragmentShader:Or,defines:Dt.defines,customVertexShaderID:xr,customFragmentShaderID:Gr,isRawShaderMaterial:Dt.isRawShaderMaterial===!0,glslVersion:Dt.glslVersion,precision:Pt,instancing:an.isInstancedMesh===!0,instancingColor:an.isInstancedMesh===!0&&an.instanceColor!==null,supportsVertexTextures:Ct,outputEncoding:pr===null?ut.outputEncoding:pr.isXRRenderTarget===!0||pr.texture.encoding!==mo?pr.texture.encoding:Am,map:!!Dt.map,matcap:!!Dt.matcap,envMap:!!On,envMapMode:On&&On.mapping,envMapCubeUVHeight:Ln,lightMap:!!Dt.lightMap,aoMap:!!Dt.aoMap,emissiveMap:!!Dt.emissiveMap,bumpMap:!!Dt.bumpMap,normalMap:!!Dt.normalMap,objectSpaceNormalMap:Dt.normalMapType===ku,tangentSpaceNormalMap:Dt.normalMapType===Ru,decodeVideoTexture:!!Dt.map&&Dt.map.isVideoTexture===!0&&Dt.map.encoding===mo,clearcoat:Sr,clearcoatMap:Sr&&!!Dt.clearcoatMap,clearcoatRoughnessMap:Sr&&!!Dt.clearcoatRoughnessMap,clearcoatNormalMap:Sr&&!!Dt.clearcoatNormalMap,iridescence:Qr,iridescenceMap:Qr&&!!Dt.iridescenceMap,iridescenceThicknessMap:Qr&&!!Dt.iridescenceThicknessMap,displacementMap:!!Dt.displacementMap,roughnessMap:!!Dt.roughnessMap,metalnessMap:!!Dt.metalnessMap,specularMap:!!Dt.specularMap,specularIntensityMap:!!Dt.specularIntensityMap,specularColorMap:!!Dt.specularColorMap,opaque:Dt.transparent===!1&&Dt.blending===Nt&&!(Dt.transmission>0),alphaMap:!!Dt.alphaMap,alphaTest:jr,gradientMap:!!Dt.gradientMap,sheen:Dt.sheen>0,sheenColorMap:!!Dt.sheenColorMap,sheenRoughnessMap:!!Dt.sheenRoughnessMap,transmission:Dt.transmission>0,transmissionMap:!!Dt.transmissionMap,transmissionSamplerMapEncoding:vr?vr.texture.encoding:Am,thicknessMap:!!Dt.thicknessMap,combine:Dt.combine,vertexTangents:!!Dt.normalMap&&!!gn.attributes.tangent,vertexColors:Dt.vertexColors,vertexAlphas:Dt.vertexColors===!0&&!!gn.attributes.color&&gn.attributes.color.itemSize===4,vertexUvs:!!(Dt.map||Dt.bumpMap||Dt.normalMap||Dt.specularMap||Dt.alphaMap||Dt.emissiveMap||Dt.roughnessMap||Dt.metalnessMap||Dt.clearcoatMap||Dt.clearcoatRoughnessMap||Dt.clearcoatNormalMap||Dt.iridescenceMap||Dt.iridescenceThicknessMap||Dt.displacementMap||Dt.transmissionMap||Dt.thicknessMap||Dt.specularIntensityMap||Dt.specularColorMap||Dt.sheenColorMap||Dt.sheenRoughnessMap),uvsVertexOnly:!(Dt.map||Dt.bumpMap||Dt.normalMap||Dt.specularMap||Dt.alphaMap||Dt.emissiveMap||Dt.roughnessMap||Dt.metalnessMap||Dt.clearcoatNormalMap||Dt.iridescenceMap||Dt.iridescenceThicknessMap||Dt.transmission>0||Dt.transmissionMap||Dt.thicknessMap||Dt.specularIntensityMap||Dt.specularColorMap||Dt.sheen>0||Dt.sheenColorMap||Dt.sheenRoughnessMap||!Dt.displacementMap),fog:!!fn,useFog:Dt.fog===!0,fogExp2:fn&&fn.isFogExp2,flatShading:!!Dt.flatShading,sizeAttenuation:Dt.sizeAttenuation,logarithmicDepthBuffer:Tt,skinning:an.isSkinnedMesh===!0,morphTargets:gn.morphAttributes.position!==void 0,morphNormals:gn.morphAttributes.normal!==void 0,morphColors:gn.morphAttributes.color!==void 0,morphTargetsCount:Un,morphTextureStride:Hr,numDirLights:Yt.directional.length,numPointLights:Yt.point.length,numSpotLights:Yt.spot.length,numSpotLightMaps:Yt.spotLightMap.length,numRectAreaLights:Yt.rectArea.length,numHemiLights:Yt.hemi.length,numDirLightShadows:Yt.directionalShadowMap.length,numPointLightShadows:Yt.pointShadowMap.length,numSpotLightShadows:Yt.spotShadowMap.length,numSpotLightShadowsWithMaps:Yt.numSpotLightShadowsWithMaps,numClippingPlanes:ot.numPlanes,numClipIntersection:ot.numIntersection,dithering:Dt.dithering,shadowMapEnabled:ut.shadowMap.enabled&&Xt.length>0,shadowMapType:ut.shadowMap.type,toneMapping:Dt.toneMapped?ut.toneMapping:ws,physicallyCorrectLights:ut.physicallyCorrectLights,premultipliedAlpha:Dt.premultipliedAlpha,doubleSided:Dt.side===nn,flipSided:Dt.side===Ft,useDepthPacking:!!Dt.depthPacking,depthPacking:Dt.depthPacking||0,index0AttributeName:Dt.index0AttributeName,extensionDerivatives:Dt.extensions&&Dt.extensions.derivatives,extensionFragDepth:Dt.extensions&&Dt.extensions.fragDepth,extensionDrawBuffers:Dt.extensions&&Dt.extensions.drawBuffers,extensionShaderTextureLOD:Dt.extensions&&Dt.extensions.shaderTextureLOD,rendererExtensionFragDepth:St||$.has("EXT_frag_depth"),rendererExtensionDrawBuffers:St||$.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:St||$.has("EXT_shader_texture_lod"),customProgramCacheKey:Dt.customProgramCacheKey()}},getProgramCacheKey:function(Dt){const Yt=[];if(Dt.shaderID?Yt.push(Dt.shaderID):(Yt.push(Dt.customVertexShaderID),Yt.push(Dt.customFragmentShaderID)),Dt.defines!==void 0)for(const Xt in Dt.defines)Yt.push(Xt),Yt.push(Dt.defines[Xt]);return Dt.isRawShaderMaterial===!1&&(function(Xt,Jt){Xt.push(Jt.precision),Xt.push(Jt.outputEncoding),Xt.push(Jt.envMapMode),Xt.push(Jt.envMapCubeUVHeight),Xt.push(Jt.combine),Xt.push(Jt.vertexUvs),Xt.push(Jt.fogExp2),Xt.push(Jt.sizeAttenuation),Xt.push(Jt.morphTargetsCount),Xt.push(Jt.morphAttributeCount),Xt.push(Jt.numDirLights),Xt.push(Jt.numPointLights),Xt.push(Jt.numSpotLights),Xt.push(Jt.numSpotLightMaps),Xt.push(Jt.numHemiLights),Xt.push(Jt.numRectAreaLights),Xt.push(Jt.numDirLightShadows),Xt.push(Jt.numPointLightShadows),Xt.push(Jt.numSpotLightShadows),Xt.push(Jt.numSpotLightShadowsWithMaps),Xt.push(Jt.shadowMapType),Xt.push(Jt.toneMapping),Xt.push(Jt.numClippingPlanes),Xt.push(Jt.numClipIntersection),Xt.push(Jt.depthPacking)}(Yt,Dt),function(Xt,Jt){ct.disableAll(),Jt.isWebGL2&&ct.enable(0),Jt.supportsVertexTextures&&ct.enable(1),Jt.instancing&&ct.enable(2),Jt.instancingColor&&ct.enable(3),Jt.map&&ct.enable(4),Jt.matcap&&ct.enable(5),Jt.envMap&&ct.enable(6),Jt.lightMap&&ct.enable(7),Jt.aoMap&&ct.enable(8),Jt.emissiveMap&&ct.enable(9),Jt.bumpMap&&ct.enable(10),Jt.normalMap&&ct.enable(11),Jt.objectSpaceNormalMap&&ct.enable(12),Jt.tangentSpaceNormalMap&&ct.enable(13),Jt.clearcoat&&ct.enable(14),Jt.clearcoatMap&&ct.enable(15),Jt.clearcoatRoughnessMap&&ct.enable(16),Jt.clearcoatNormalMap&&ct.enable(17),Jt.iridescence&&ct.enable(18),Jt.iridescenceMap&&ct.enable(19),Jt.iridescenceThicknessMap&&ct.enable(20),Jt.displacementMap&&ct.enable(21),Jt.specularMap&&ct.enable(22),Jt.roughnessMap&&ct.enable(23),Jt.metalnessMap&&ct.enable(24),Jt.gradientMap&&ct.enable(25),Jt.alphaMap&&ct.enable(26),Jt.alphaTest&&ct.enable(27),Jt.vertexColors&&ct.enable(28),Jt.vertexAlphas&&ct.enable(29),Jt.vertexUvs&&ct.enable(30),Jt.vertexTangents&&ct.enable(31),Jt.uvsVertexOnly&&ct.enable(32),Xt.push(ct.mask),ct.disableAll(),Jt.fog&&ct.enable(0),Jt.useFog&&ct.enable(1),Jt.flatShading&&ct.enable(2),Jt.logarithmicDepthBuffer&&ct.enable(3),Jt.skinning&&ct.enable(4),Jt.morphTargets&&ct.enable(5),Jt.morphNormals&&ct.enable(6),Jt.morphColors&&ct.enable(7),Jt.premultipliedAlpha&&ct.enable(8),Jt.shadowMapEnabled&&ct.enable(9),Jt.physicallyCorrectLights&&ct.enable(10),Jt.doubleSided&&ct.enable(11),Jt.flipSided&&ct.enable(12),Jt.useDepthPacking&&ct.enable(13),Jt.dithering&&ct.enable(14),Jt.specularIntensityMap&&ct.enable(15),Jt.specularColorMap&&ct.enable(16),Jt.transmission&&ct.enable(17),Jt.transmissionMap&&ct.enable(18),Jt.thicknessMap&&ct.enable(19),Jt.sheen&&ct.enable(20),Jt.sheenColorMap&&ct.enable(21),Jt.sheenRoughnessMap&&ct.enable(22),Jt.decodeVideoTexture&&ct.enable(23),Jt.opaque&&ct.enable(24),Xt.push(ct.mask)}(Yt,Dt),Yt.push(ut.outputEncoding)),Yt.push(Dt.customProgramCacheKey),Yt.join()},getUniforms:function(Dt){const Yt=Ot[Dt.type];let Xt;if(Yt){const Jt=um[Yt];Xt=kM.clone(Jt.uniforms)}else Xt=Dt.uniforms;return Xt},acquireProgram:function(Dt,Yt){let Xt;for(let Jt=0,an=gt.length;Jt<an;Jt++){const fn=gt[Jt];if(fn.cacheKey===Yt){Xt=fn,++Xt.usedTimes;break}}return Xt===void 0&&(Xt=new dP(ut,Yt,Dt,it),gt.push(Xt)),Xt},releaseProgram:function(Dt){if(--Dt.usedTimes==0){const Yt=gt.indexOf(Dt);gt[Yt]=gt[gt.length-1],gt.pop(),Dt.destroy()}},releaseShaderCache:function(Dt){mt.remove(Dt)},programs:gt,dispose:function(){mt.dispose()}}}function uT(){let ut=new WeakMap;return{get:function(o){let _=ut.get(o);return _===void 0&&(_={},ut.set(o,_)),_},remove:function(o){ut.delete(o)},update:function(o,_,$){ut.get(o)[_]=$},dispose:function(){ut=new WeakMap}}}function hT(ut,o){return ut.groupOrder!==o.groupOrder?ut.groupOrder-o.groupOrder:ut.renderOrder!==o.renderOrder?ut.renderOrder-o.renderOrder:ut.material.id!==o.material.id?ut.material.id-o.material.id:ut.z!==o.z?ut.z-o.z:ut.id-o.id}function XS(ut,o){return ut.groupOrder!==o.groupOrder?ut.groupOrder-o.groupOrder:ut.renderOrder!==o.renderOrder?ut.renderOrder-o.renderOrder:ut.z!==o.z?o.z-ut.z:ut.id-o.id}function dT(){const ut=[];let o=0;const _=[],$=[],_e=[];function it(ot,ct,mt,gt,St,Tt){let Ct=ut[o];return Ct===void 0?(Ct={id:ot.id,object:ot,geometry:ct,material:mt,groupOrder:gt,renderOrder:ot.renderOrder,z:St,group:Tt},ut[o]=Ct):(Ct.id=ot.id,Ct.object=ot,Ct.geometry=ct,Ct.material=mt,Ct.groupOrder=gt,Ct.renderOrder=ot.renderOrder,Ct.z=St,Ct.group=Tt),o++,Ct}return{opaque:_,transmissive:$,transparent:_e,init:function(){o=0,_.length=0,$.length=0,_e.length=0},push:function(ot,ct,mt,gt,St,Tt){const Ct=it(ot,ct,mt,gt,St,Tt);mt.transmission>0?$.push(Ct):mt.transparent===!0?_e.push(Ct):_.push(Ct)},unshift:function(ot,ct,mt,gt,St,Tt){const Ct=it(ot,ct,mt,gt,St,Tt);mt.transmission>0?$.unshift(Ct):mt.transparent===!0?_e.unshift(Ct):_.unshift(Ct)},finish:function(){for(let ot=o,ct=ut.length;ot<ct;ot++){const mt=ut[ot];if(mt.id===null)break;mt.id=null,mt.object=null,mt.geometry=null,mt.material=null,mt.group=null}},sort:function(ot,ct){_.length>1&&_.sort(ot||hT),$.length>1&&$.sort(ct||XS),_e.length>1&&_e.sort(ct||XS)}}}function KS(){let ut=new WeakMap;return{get:function(o,_){const $=ut.get(o);let _e;return $===void 0?(_e=new dT,ut.set(o,[_e])):_>=$.length?(_e=new dT,$.push(_e)):_e=$[_],_e},dispose:function(){ut=new WeakMap}}}function $S(){const ut={};return{get:function(o){if(ut[o.id]!==void 0)return ut[o.id];let _;switch(o.type){case"DirectionalLight":_={direction:new An,color:new is};break;case"SpotLight":_={position:new An,direction:new An,color:new is,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":_={position:new An,color:new is,distance:0,decay:0};break;case"HemisphereLight":_={direction:new An,skyColor:new is,groundColor:new is};break;case"RectAreaLight":_={color:new is,position:new An,halfWidth:new An,halfHeight:new An}}return ut[o.id]=_,_}}}let Kw=0;function V1(ut,o){return(o.castShadow?2:0)-(ut.castShadow?2:0)+(o.map?1:0)-(ut.map?1:0)}function pT(ut,o){const _=new $S,$=function(){const mt={};return{get:function(gt){if(mt[gt.id]!==void 0)return mt[gt.id];let St;switch(gt.type){case"DirectionalLight":case"SpotLight":St={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Rr};break;case"PointLight":St={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Rr,shadowCameraNear:1,shadowCameraFar:1e3}}return mt[gt.id]=St,St}}}(),_e={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let mt=0;mt<9;mt++)_e.probe.push(new An);const it=new An,ot=new Us,ct=new Us;return{setup:function(mt,gt){let St=0,Tt=0,Ct=0;for(let $n=0;$n<9;$n++)_e.probe[$n].set(0,0,0);let Pt=0,Ot=0,Dt=0,Yt=0,Xt=0,Jt=0,an=0,fn=0,gn=0,_n=0;mt.sort(V1);const On=gt!==!0?Math.PI:1;for(let $n=0,Jn=mt.length;$n<Jn;$n++){const Un=mt[$n],Er=Un.color,Or=Un.intensity,xr=Un.distance,Gr=Un.shadow&&Un.shadow.map?Un.shadow.map.texture:null;if(Un.isAmbientLight)St+=Er.r*Or*On,Tt+=Er.g*Or*On,Ct+=Er.b*Or*On;else if(Un.isLightProbe)for(let Hr=0;Hr<9;Hr++)_e.probe[Hr].addScaledVector(Un.sh.coefficients[Hr],Or);else if(Un.isDirectionalLight){const Hr=_.get(Un);if(Hr.color.copy(Un.color).multiplyScalar(Un.intensity*On),Un.castShadow){const pr=Un.shadow,vr=$.get(Un);vr.shadowBias=pr.bias,vr.shadowNormalBias=pr.normalBias,vr.shadowRadius=pr.radius,vr.shadowMapSize=pr.mapSize,_e.directionalShadow[Pt]=vr,_e.directionalShadowMap[Pt]=Gr,_e.directionalShadowMatrix[Pt]=Un.shadow.matrix,Jt++}_e.directional[Pt]=Hr,Pt++}else if(Un.isSpotLight){const Hr=_.get(Un);Hr.position.setFromMatrixPosition(Un.matrixWorld),Hr.color.copy(Er).multiplyScalar(Or*On),Hr.distance=xr,Hr.coneCos=Math.cos(Un.angle),Hr.penumbraCos=Math.cos(Un.angle*(1-Un.penumbra)),Hr.decay=Un.decay,_e.spot[Dt]=Hr;const pr=Un.shadow;if(Un.map&&(_e.spotLightMap[gn]=Un.map,gn++,pr.updateMatrices(Un),Un.castShadow&&_n++),_e.spotLightMatrix[Dt]=pr.matrix,Un.castShadow){const vr=$.get(Un);vr.shadowBias=pr.bias,vr.shadowNormalBias=pr.normalBias,vr.shadowRadius=pr.radius,vr.shadowMapSize=pr.mapSize,_e.spotShadow[Dt]=vr,_e.spotShadowMap[Dt]=Gr,fn++}Dt++}else if(Un.isRectAreaLight){const Hr=_.get(Un);Hr.color.copy(Er).multiplyScalar(Or),Hr.halfWidth.set(.5*Un.width,0,0),Hr.halfHeight.set(0,.5*Un.height,0),_e.rectArea[Yt]=Hr,Yt++}else if(Un.isPointLight){const Hr=_.get(Un);if(Hr.color.copy(Un.color).multiplyScalar(Un.intensity*On),Hr.distance=Un.distance,Hr.decay=Un.decay,Un.castShadow){const pr=Un.shadow,vr=$.get(Un);vr.shadowBias=pr.bias,vr.shadowNormalBias=pr.normalBias,vr.shadowRadius=pr.radius,vr.shadowMapSize=pr.mapSize,vr.shadowCameraNear=pr.camera.near,vr.shadowCameraFar=pr.camera.far,_e.pointShadow[Ot]=vr,_e.pointShadowMap[Ot]=Gr,_e.pointShadowMatrix[Ot]=Un.shadow.matrix,an++}_e.point[Ot]=Hr,Ot++}else if(Un.isHemisphereLight){const Hr=_.get(Un);Hr.skyColor.copy(Un.color).multiplyScalar(Or*On),Hr.groundColor.copy(Un.groundColor).multiplyScalar(Or*On),_e.hemi[Xt]=Hr,Xt++}}Yt>0&&(o.isWebGL2||ut.has("OES_texture_float_linear")===!0?(_e.rectAreaLTC1=Zr.LTC_FLOAT_1,_e.rectAreaLTC2=Zr.LTC_FLOAT_2):ut.has("OES_texture_half_float_linear")===!0?(_e.rectAreaLTC1=Zr.LTC_HALF_1,_e.rectAreaLTC2=Zr.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),_e.ambient[0]=St,_e.ambient[1]=Tt,_e.ambient[2]=Ct;const Ln=_e.hash;Ln.directionalLength===Pt&&Ln.pointLength===Ot&&Ln.spotLength===Dt&&Ln.rectAreaLength===Yt&&Ln.hemiLength===Xt&&Ln.numDirectionalShadows===Jt&&Ln.numPointShadows===an&&Ln.numSpotShadows===fn&&Ln.numSpotMaps===gn||(_e.directional.length=Pt,_e.spot.length=Dt,_e.rectArea.length=Yt,_e.point.length=Ot,_e.hemi.length=Xt,_e.directionalShadow.length=Jt,_e.directionalShadowMap.length=Jt,_e.pointShadow.length=an,_e.pointShadowMap.length=an,_e.spotShadow.length=fn,_e.spotShadowMap.length=fn,_e.directionalShadowMatrix.length=Jt,_e.pointShadowMatrix.length=an,_e.spotLightMatrix.length=fn+gn-_n,_e.spotLightMap.length=gn,_e.numSpotLightShadowsWithMaps=_n,Ln.directionalLength=Pt,Ln.pointLength=Ot,Ln.spotLength=Dt,Ln.rectAreaLength=Yt,Ln.hemiLength=Xt,Ln.numDirectionalShadows=Jt,Ln.numPointShadows=an,Ln.numSpotShadows=fn,Ln.numSpotMaps=gn,_e.version=Kw++)},setupView:function(mt,gt){let St=0,Tt=0,Ct=0,Pt=0,Ot=0;const Dt=gt.matrixWorldInverse;for(let Yt=0,Xt=mt.length;Yt<Xt;Yt++){const Jt=mt[Yt];if(Jt.isDirectionalLight){const an=_e.directional[St];an.direction.setFromMatrixPosition(Jt.matrixWorld),it.setFromMatrixPosition(Jt.target.matrixWorld),an.direction.sub(it),an.direction.transformDirection(Dt),St++}else if(Jt.isSpotLight){const an=_e.spot[Ct];an.position.setFromMatrixPosition(Jt.matrixWorld),an.position.applyMatrix4(Dt),an.direction.setFromMatrixPosition(Jt.matrixWorld),it.setFromMatrixPosition(Jt.target.matrixWorld),an.direction.sub(it),an.direction.transformDirection(Dt),Ct++}else if(Jt.isRectAreaLight){const an=_e.rectArea[Pt];an.position.setFromMatrixPosition(Jt.matrixWorld),an.position.applyMatrix4(Dt),ct.identity(),ot.copy(Jt.matrixWorld),ot.premultiply(Dt),ct.extractRotation(ot),an.halfWidth.set(.5*Jt.width,0,0),an.halfHeight.set(0,.5*Jt.height,0),an.halfWidth.applyMatrix4(ct),an.halfHeight.applyMatrix4(ct),Pt++}else if(Jt.isPointLight){const an=_e.point[Tt];an.position.setFromMatrixPosition(Jt.matrixWorld),an.position.applyMatrix4(Dt),Tt++}else if(Jt.isHemisphereLight){const an=_e.hemi[Ot];an.direction.setFromMatrixPosition(Jt.matrixWorld),an.direction.transformDirection(Dt),Ot++}}},state:_e}}function Q1(ut,o){const _=new pT(ut,o),$=[],_e=[];return{init:function(){$.length=0,_e.length=0},state:{lightsArray:$,shadowsArray:_e,lights:_},setupLights:function(it){_.setup($,it)},setupLightsView:function(it){_.setupView($,it)},pushLight:function(it){$.push(it)},pushShadow:function(it){_e.push(it)}}}function fT(ut,o){let _=new WeakMap;return{get:function($,_e=0){const it=_.get($);let ot;return it===void 0?(ot=new Q1(ut,o),_.set($,[ot])):_e>=it.length?(ot=new Q1(ut,o),it.push(ot)):ot=it[_e],ot},dispose:function(){_=new WeakMap}}}class $w extends Uu{constructor(o){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=ap,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(o)}copy(o){return super.copy(o),this.depthPacking=o.depthPacking,this.map=o.map,this.alphaMap=o.alphaMap,this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this}}class VA extends Uu{constructor(o){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new An,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(o)}copy(o){return super.copy(o),this.referencePosition.copy(o.referencePosition),this.nearDistance=o.nearDistance,this.farDistance=o.farDistance,this.map=o.map,this.alphaMap=o.alphaMap,this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this}}function mT(ut,o,_){let $=new zw;const _e=new Rr,it=new Rr,ot=new Fo,ct=new $w({depthPacking:x0}),mt=new VA,gt={},St=_.maxTextureSize,Tt={0:Ft,1:Kt,2:nn},Ct=new Av({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Rr},radius:{value:4}},vertexShader:`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragmentShader:`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`}),Pt=Ct.clone();Pt.defines.HORIZONTAL_PASS=1;const Ot=new ps;Ot.setAttribute("position",new $o(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const Dt=new ju(Ot,Ct),Yt=this;function Xt(fn,gn){const _n=o.update(Dt);Ct.defines.VSM_SAMPLES!==fn.blurSamples&&(Ct.defines.VSM_SAMPLES=fn.blurSamples,Pt.defines.VSM_SAMPLES=fn.blurSamples,Ct.needsUpdate=!0,Pt.needsUpdate=!0),fn.mapPass===null&&(fn.mapPass=new xp(_e.x,_e.y)),Ct.uniforms.shadow_pass.value=fn.map.texture,Ct.uniforms.resolution.value=fn.mapSize,Ct.uniforms.radius.value=fn.radius,ut.setRenderTarget(fn.mapPass),ut.clear(),ut.renderBufferDirect(gn,null,_n,Ct,Dt,null),Pt.uniforms.shadow_pass.value=fn.mapPass.texture,Pt.uniforms.resolution.value=fn.mapSize,Pt.uniforms.radius.value=fn.radius,ut.setRenderTarget(fn.map),ut.clear(),ut.renderBufferDirect(gn,null,_n,Pt,Dt,null)}function Jt(fn,gn,_n,On,Ln,$n){let Jn=null;const Un=_n.isPointLight===!0?fn.customDistanceMaterial:fn.customDepthMaterial;if(Jn=Un!==void 0?Un:_n.isPointLight===!0?mt:ct,ut.localClippingEnabled&&gn.clipShadows===!0&&Array.isArray(gn.clippingPlanes)&&gn.clippingPlanes.length!==0||gn.displacementMap&&gn.displacementScale!==0||gn.alphaMap&&gn.alphaTest>0){const Er=Jn.uuid,Or=gn.uuid;let xr=gt[Er];xr===void 0&&(xr={},gt[Er]=xr);let Gr=xr[Or];Gr===void 0&&(Gr=Jn.clone(),xr[Or]=Gr),Jn=Gr}return Jn.visible=gn.visible,Jn.wireframe=gn.wireframe,Jn.side=$n===jt?gn.shadowSide!==null?gn.shadowSide:gn.side:gn.shadowSide!==null?gn.shadowSide:Tt[gn.side],Jn.alphaMap=gn.alphaMap,Jn.alphaTest=gn.alphaTest,Jn.clipShadows=gn.clipShadows,Jn.clippingPlanes=gn.clippingPlanes,Jn.clipIntersection=gn.clipIntersection,Jn.displacementMap=gn.displacementMap,Jn.displacementScale=gn.displacementScale,Jn.displacementBias=gn.displacementBias,Jn.wireframeLinewidth=gn.wireframeLinewidth,Jn.linewidth=gn.linewidth,_n.isPointLight===!0&&Jn.isMeshDistanceMaterial===!0&&(Jn.referencePosition.setFromMatrixPosition(_n.matrixWorld),Jn.nearDistance=On,Jn.farDistance=Ln),Jn}function an(fn,gn,_n,On,Ln){if(fn.visible===!1)return;if(fn.layers.test(gn.layers)&&(fn.isMesh||fn.isLine||fn.isPoints)&&(fn.castShadow||fn.receiveShadow&&Ln===jt)&&(!fn.frustumCulled||$.intersectsObject(fn))){fn.modelViewMatrix.multiplyMatrices(_n.matrixWorldInverse,fn.matrixWorld);const Jn=o.update(fn),Un=fn.material;if(Array.isArray(Un)){const Er=Jn.groups;for(let Or=0,xr=Er.length;Or<xr;Or++){const Gr=Er[Or],Hr=Un[Gr.materialIndex];if(Hr&&Hr.visible){const pr=Jt(fn,Hr,On,_n.near,_n.far,Ln);ut.renderBufferDirect(_n,null,Jn,pr,fn,Gr)}}}else if(Un.visible){const Er=Jt(fn,Un,On,_n.near,_n.far,Ln);ut.renderBufferDirect(_n,null,Jn,Er,fn,null)}}const $n=fn.children;for(let Jn=0,Un=$n.length;Jn<Un;Jn++)an($n[Jn],gn,_n,On,Ln)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=qt,this.render=function(fn,gn,_n){if(Yt.enabled===!1||Yt.autoUpdate===!1&&Yt.needsUpdate===!1||fn.length===0)return;const On=ut.getRenderTarget(),Ln=ut.getActiveCubeFace(),$n=ut.getActiveMipmapLevel(),Jn=ut.state;Jn.setBlending(Lt),Jn.buffers.color.setClear(1,1,1,1),Jn.buffers.depth.setTest(!0),Jn.setScissorTest(!1);for(let Un=0,Er=fn.length;Un<Er;Un++){const Or=fn[Un],xr=Or.shadow;if(xr===void 0){console.warn("THREE.WebGLShadowMap:",Or,"has no shadow.");continue}if(xr.autoUpdate===!1&&xr.needsUpdate===!1)continue;_e.copy(xr.mapSize);const Gr=xr.getFrameExtents();if(_e.multiply(Gr),it.copy(xr.mapSize),(_e.x>St||_e.y>St)&&(_e.x>St&&(it.x=Math.floor(St/Gr.x),_e.x=it.x*Gr.x,xr.mapSize.x=it.x),_e.y>St&&(it.y=Math.floor(St/Gr.y),_e.y=it.y*Gr.y,xr.mapSize.y=it.y)),xr.map===null){const pr=this.type!==jt?{minFilter:Oo,magFilter:Oo}:{};xr.map=new xp(_e.x,_e.y,pr),xr.map.texture.name=Or.name+".shadowMap",xr.camera.updateProjectionMatrix()}ut.setRenderTarget(xr.map),ut.clear();const Hr=xr.getViewportCount();for(let pr=0;pr<Hr;pr++){const vr=xr.getViewport(pr);ot.set(it.x*vr.x,it.y*vr.y,it.x*vr.z,it.y*vr.w),Jn.viewport(ot),xr.updateMatrices(Or,pr),$=xr.getFrustum(),an(gn,_n,xr.camera,Or,this.type)}xr.isPointLightShadow!==!0&&this.type===jt&&Xt(xr,_n),xr.needsUpdate=!1}Yt.needsUpdate=!1,ut.setRenderTarget(On,Ln,$n)}}function JS(ut,o,_){const $=_.isWebGL2,_e=new function(){let ln=!1;const gr=new Fo;let tr=null;const br=new Fo(0,0,0,0);return{setMask:function(Tr){tr===Tr||ln||(ut.colorMask(Tr,Tr,Tr,Tr),tr=Tr)},setLocked:function(Tr){ln=Tr},setClear:function(Tr,$r,Es,Os,ro){ro===!0&&(Tr*=Os,$r*=Os,Es*=Os),gr.set(Tr,$r,Es,Os),br.equals(gr)===!1&&(ut.clearColor(Tr,$r,Es,Os),br.copy(gr))},reset:function(){ln=!1,tr=null,br.set(-1,0,0,0)}}},it=new function(){let ln=!1,gr=null,tr=null,br=null;return{setTest:function(Tr){Tr?bs(2929):lo(2929)},setMask:function(Tr){gr===Tr||ln||(ut.depthMask(Tr),gr=Tr)},setFunc:function(Tr){if(tr!==Tr){if(Tr)switch(Tr){case wr:ut.depthFunc(512);break;case Gn:ut.depthFunc(519);break;case rn:ut.depthFunc(513);break;case dn:ut.depthFunc(515);break;case kn:ut.depthFunc(514);break;case Cr:ut.depthFunc(518);break;case Ar:ut.depthFunc(516);break;case Lr:ut.depthFunc(517);break;default:ut.depthFunc(515)}else ut.depthFunc(515);tr=Tr}},setLocked:function(Tr){ln=Tr},setClear:function(Tr){br!==Tr&&(ut.clearDepth(Tr),br=Tr)},reset:function(){ln=!1,gr=null,tr=null,br=null}}},ot=new function(){let ln=!1,gr=null,tr=null,br=null,Tr=null,$r=null,Es=null,Os=null,ro=null;return{setTest:function(Ps){ln||(Ps?bs(2960):lo(2960))},setMask:function(Ps){gr===Ps||ln||(ut.stencilMask(Ps),gr=Ps)},setFunc:function(Ps,Ns,Yo){tr===Ps&&br===Ns&&Tr===Yo||(ut.stencilFunc(Ps,Ns,Yo),tr=Ps,br=Ns,Tr=Yo)},setOp:function(Ps,Ns,Yo){$r===Ps&&Es===Ns&&Os===Yo||(ut.stencilOp(Ps,Ns,Yo),$r=Ps,Es=Ns,Os=Yo)},setLocked:function(Ps){ln=Ps},setClear:function(Ps){ro!==Ps&&(ut.clearStencil(Ps),ro=Ps)},reset:function(){ln=!1,gr=null,tr=null,br=null,Tr=null,$r=null,Es=null,Os=null,ro=null}}},ct=new WeakMap,mt=new WeakMap;let gt={},St={},Tt=new WeakMap,Ct=[],Pt=null,Ot=!1,Dt=null,Yt=null,Xt=null,Jt=null,an=null,fn=null,gn=null,_n=!1,On=null,Ln=null,$n=null,Jn=null,Un=null;const Er=ut.getParameter(35661);let Or=!1,xr=0;const Gr=ut.getParameter(7938);Gr.indexOf("WebGL")!==-1?(xr=parseFloat(/^WebGL (\d)/.exec(Gr)[1]),Or=xr>=1):Gr.indexOf("OpenGL ES")!==-1&&(xr=parseFloat(/^OpenGL ES (\d)/.exec(Gr)[1]),Or=xr>=2);let Hr=null,pr={};const vr=ut.getParameter(3088),jr=ut.getParameter(2978),Sr=new Fo().fromArray(vr),Qr=new Fo().fromArray(jr);function As(ln,gr,tr){const br=new Uint8Array(4),Tr=ut.createTexture();ut.bindTexture(ln,Tr),ut.texParameteri(ln,10241,9728),ut.texParameteri(ln,10240,9728);for(let $r=0;$r<tr;$r++)ut.texImage2D(gr+$r,0,6408,1,1,0,6408,5121,br);return Tr}const go={};function bs(ln){gt[ln]!==!0&&(ut.enable(ln),gt[ln]=!0)}function lo(ln){gt[ln]!==!1&&(ut.disable(ln),gt[ln]=!1)}go[3553]=As(3553,3553,1),go[34067]=As(34067,34069,6),_e.setClear(0,0,0,1),it.setClear(1),ot.setClear(0),bs(2929),it.setFunc(dn),Xn(!1),Dn(_t),bs(2884),ir(Lt);const Pn={[Ut]:32774,[Gt]:32778,[$t]:32779};if($)Pn[un]=32775,Pn[hn]=32776;else{const ln=o.get("EXT_blend_minmax");ln!==null&&(Pn[un]=ln.MIN_EXT,Pn[hn]=ln.MAX_EXT)}const Sn={[Bn]:0,[ar]:1,[sr]:768,[nr]:770,[Kn]:776,[sn]:774,[zn]:772,[ur]:769,[hr]:771,[qn]:775,[Yn]:773};function ir(ln,gr,tr,br,Tr,$r,Es,Os){if(ln!==Lt){if(Ot===!1&&(bs(3042),Ot=!0),ln===cn)Tr=Tr||gr,$r=$r||tr,Es=Es||br,gr===Yt&&Tr===an||(ut.blendEquationSeparate(Pn[gr],Pn[Tr]),Yt=gr,an=Tr),tr===Xt&&br===Jt&&$r===fn&&Es===gn||(ut.blendFuncSeparate(Sn[tr],Sn[br],Sn[$r],Sn[Es]),Xt=tr,Jt=br,fn=$r,gn=Es),Dt=ln,_n=null;else if(ln!==Dt||Os!==_n){if(Yt===Ut&&an===Ut||(ut.blendEquation(32774),Yt=Ut,an=Ut),Os)switch(ln){case Nt:ut.blendFuncSeparate(1,771,1,771);break;case Ht:ut.blendFunc(1,1);break;case on:ut.blendFuncSeparate(0,769,0,1);break;case en:ut.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",ln)}else switch(ln){case Nt:ut.blendFuncSeparate(770,771,1,771);break;case Ht:ut.blendFunc(770,1);break;case on:ut.blendFuncSeparate(0,769,0,1);break;case en:ut.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",ln)}Xt=null,Jt=null,fn=null,gn=null,Dt=ln,_n=Os}}else Ot===!0&&(lo(3042),Ot=!1)}function Xn(ln){On!==ln&&(ln?ut.frontFace(2304):ut.frontFace(2305),On=ln)}function Dn(ln){ln!==ht?(bs(2884),ln!==Ln&&(ln===_t?ut.cullFace(1029):ln===bt?ut.cullFace(1028):ut.cullFace(1032))):lo(2884),Ln=ln}function Hn(ln,gr,tr){ln?(bs(32823),Jn===gr&&Un===tr||(ut.polygonOffset(gr,tr),Jn=gr,Un=tr)):lo(32823)}function mr(ln){ln===void 0&&(ln=33984+Er-1),Hr!==ln&&(ut.activeTexture(ln),Hr=ln)}return{buffers:{color:_e,depth:it,stencil:ot},enable:bs,disable:lo,bindFramebuffer:function(ln,gr){return St[ln]!==gr&&(ut.bindFramebuffer(ln,gr),St[ln]=gr,$&&(ln===36009&&(St[36160]=gr),ln===36160&&(St[36009]=gr)),!0)},drawBuffers:function(ln,gr){let tr=Ct,br=!1;if(ln)if(tr=Tt.get(gr),tr===void 0&&(tr=[],Tt.set(gr,tr)),ln.isWebGLMultipleRenderTargets){const Tr=ln.texture;if(tr.length!==Tr.length||tr[0]!==36064){for(let $r=0,Es=Tr.length;$r<Es;$r++)tr[$r]=36064+$r;tr.length=Tr.length,br=!0}}else tr[0]!==36064&&(tr[0]=36064,br=!0);else tr[0]!==1029&&(tr[0]=1029,br=!0);br&&(_.isWebGL2?ut.drawBuffers(tr):o.get("WEBGL_draw_buffers").drawBuffersWEBGL(tr))},useProgram:function(ln){return Pt!==ln&&(ut.useProgram(ln),Pt=ln,!0)},setBlending:ir,setMaterial:function(ln,gr){ln.side===nn?lo(2884):bs(2884);let tr=ln.side===Ft;gr&&(tr=!tr),Xn(tr),ln.blending===Nt&&ln.transparent===!1?ir(Lt):ir(ln.blending,ln.blendEquation,ln.blendSrc,ln.blendDst,ln.blendEquationAlpha,ln.blendSrcAlpha,ln.blendDstAlpha,ln.premultipliedAlpha),it.setFunc(ln.depthFunc),it.setTest(ln.depthTest),it.setMask(ln.depthWrite),_e.setMask(ln.colorWrite);const br=ln.stencilWrite;ot.setTest(br),br&&(ot.setMask(ln.stencilWriteMask),ot.setFunc(ln.stencilFunc,ln.stencilRef,ln.stencilFuncMask),ot.setOp(ln.stencilFail,ln.stencilZFail,ln.stencilZPass)),Hn(ln.polygonOffset,ln.polygonOffsetFactor,ln.polygonOffsetUnits),ln.alphaToCoverage===!0?bs(32926):lo(32926)},setFlipSided:Xn,setCullFace:Dn,setLineWidth:function(ln){ln!==$n&&(Or&&ut.lineWidth(ln),$n=ln)},setPolygonOffset:Hn,setScissorTest:function(ln){ln?bs(3089):lo(3089)},activeTexture:mr,bindTexture:function(ln,gr){Hr===null&&mr();let tr=pr[Hr];tr===void 0&&(tr={type:void 0,texture:void 0},pr[Hr]=tr),tr.type===ln&&tr.texture===gr||(ut.bindTexture(ln,gr||go[ln]),tr.type=ln,tr.texture=gr)},unbindTexture:function(){const ln=pr[Hr];ln!==void 0&&ln.type!==void 0&&(ut.bindTexture(ln.type,null),ln.type=void 0,ln.texture=void 0)},compressedTexImage2D:function(){try{ut.compressedTexImage2D.apply(ut,arguments)}catch(ln){console.error("THREE.WebGLState:",ln)}},texImage2D:function(){try{ut.texImage2D.apply(ut,arguments)}catch(ln){console.error("THREE.WebGLState:",ln)}},texImage3D:function(){try{ut.texImage3D.apply(ut,arguments)}catch(ln){console.error("THREE.WebGLState:",ln)}},updateUBOMapping:function(ln,gr){let tr=mt.get(gr);tr===void 0&&(tr=new WeakMap,mt.set(gr,tr));let br=tr.get(ln);br===void 0&&(br=ut.getUniformBlockIndex(gr,ln.name),tr.set(ln,br))},uniformBlockBinding:function(ln,gr){const tr=mt.get(gr).get(ln);ct.get(ln)!==tr&&(ut.uniformBlockBinding(gr,tr,ln.__bindingPointIndex),ct.set(ln,tr))},texStorage2D:function(){try{ut.texStorage2D.apply(ut,arguments)}catch(ln){console.error("THREE.WebGLState:",ln)}},texStorage3D:function(){try{ut.texStorage3D.apply(ut,arguments)}catch(ln){console.error("THREE.WebGLState:",ln)}},texSubImage2D:function(){try{ut.texSubImage2D.apply(ut,arguments)}catch(ln){console.error("THREE.WebGLState:",ln)}},texSubImage3D:function(){try{ut.texSubImage3D.apply(ut,arguments)}catch(ln){console.error("THREE.WebGLState:",ln)}},compressedTexSubImage2D:function(){try{ut.compressedTexSubImage2D.apply(ut,arguments)}catch(ln){console.error("THREE.WebGLState:",ln)}},scissor:function(ln){Sr.equals(ln)===!1&&(ut.scissor(ln.x,ln.y,ln.z,ln.w),Sr.copy(ln))},viewport:function(ln){Qr.equals(ln)===!1&&(ut.viewport(ln.x,ln.y,ln.z,ln.w),Qr.copy(ln))},reset:function(){ut.disable(3042),ut.disable(2884),ut.disable(2929),ut.disable(32823),ut.disable(3089),ut.disable(2960),ut.disable(32926),ut.blendEquation(32774),ut.blendFunc(1,0),ut.blendFuncSeparate(1,0,1,0),ut.colorMask(!0,!0,!0,!0),ut.clearColor(0,0,0,0),ut.depthMask(!0),ut.depthFunc(513),ut.clearDepth(1),ut.stencilMask(4294967295),ut.stencilFunc(519,0,4294967295),ut.stencilOp(7680,7680,7680),ut.clearStencil(0),ut.cullFace(1029),ut.frontFace(2305),ut.polygonOffset(0,0),ut.activeTexture(33984),ut.bindFramebuffer(36160,null),$===!0&&(ut.bindFramebuffer(36009,null),ut.bindFramebuffer(36008,null)),ut.useProgram(null),ut.lineWidth(1),ut.scissor(0,0,ut.canvas.width,ut.canvas.height),ut.viewport(0,0,ut.canvas.width,ut.canvas.height),gt={},Hr=null,pr={},St={},Tt=new WeakMap,Ct=[],Pt=null,Ot=!1,Dt=null,Yt=null,Xt=null,Jt=null,an=null,fn=null,gn=null,_n=!1,On=null,Ln=null,$n=null,Jn=null,Un=null,Sr.set(0,0,ut.canvas.width,ut.canvas.height),Qr.set(0,0,ut.canvas.width,ut.canvas.height),_e.reset(),it.reset(),ot.reset()}}}function ZS(ut,o,_,$,_e,it,ot){const ct=_e.isWebGL2,mt=_e.maxTextures,gt=_e.maxCubemapSize,St=_e.maxTextureSize,Tt=_e.maxSamples,Ct=o.has("WEBGL_multisampled_render_to_texture")?o.get("WEBGL_multisampled_render_to_texture"):null,Pt=/OculusBrowser/g.test(navigator.userAgent),Ot=new WeakMap;let Dt;const Yt=new WeakMap;let Xt=!1;try{Xt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function Jt(Pn,Sn){return Xt?new OffscreenCanvas(Pn,Sn):k_("canvas")}function an(Pn,Sn,ir,Xn){let Dn=1;if((Pn.width>Xn||Pn.height>Xn)&&(Dn=Xn/Math.max(Pn.width,Pn.height)),Dn<1||Sn===!0){if(typeof HTMLImageElement<"u"&&Pn instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Pn instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Pn instanceof ImageBitmap){const Hn=Sn?lp:Math.floor,mr=Hn(Dn*Pn.width),ln=Hn(Dn*Pn.height);Dt===void 0&&(Dt=Jt(mr,ln));const gr=ir?Jt(mr,ln):Dt;return gr.width=mr,gr.height=ln,gr.getContext("2d").drawImage(Pn,0,0,mr,ln),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Pn.width+"x"+Pn.height+") to ("+mr+"x"+ln+")."),gr}return"data"in Pn&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Pn.width+"x"+Pn.height+")."),Pn}return Pn}function fn(Pn){return Cy(Pn.width)&&Cy(Pn.height)}function gn(Pn,Sn){return Pn.generateMipmaps&&Sn&&Pn.minFilter!==Oo&&Pn.minFilter!==zo}function _n(Pn){ut.generateMipmap(Pn)}function On(Pn,Sn,ir,Xn,Dn=!1){if(ct===!1)return Sn;if(Pn!==null){if(ut[Pn]!==void 0)return ut[Pn];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Pn+"'")}let Hn=Sn;return Sn===6403&&(ir===5126&&(Hn=33326),ir===5131&&(Hn=33325),ir===5121&&(Hn=33321)),Sn===33319&&(ir===5126&&(Hn=33328),ir===5131&&(Hn=33327),ir===5121&&(Hn=33323)),Sn===6408&&(ir===5126&&(Hn=34836),ir===5131&&(Hn=34842),ir===5121&&(Hn=Xn===mo&&Dn===!1?35907:32856),ir===32819&&(Hn=32854),ir===32820&&(Hn=32855)),Hn!==33325&&Hn!==33326&&Hn!==33327&&Hn!==33328&&Hn!==34842&&Hn!==34836||o.get("EXT_color_buffer_float"),Hn}function Ln(Pn,Sn,ir){return gn(Pn,ir)===!0||Pn.isFramebufferTexture&&Pn.minFilter!==Oo&&Pn.minFilter!==zo?Math.log2(Math.max(Sn.width,Sn.height))+1:Pn.mipmaps!==void 0&&Pn.mipmaps.length>0?Pn.mipmaps.length:Pn.isCompressedTexture&&Array.isArray(Pn.image)?Sn.mipmaps.length:1}function $n(Pn){return Pn===Oo||Pn===yl||Pn===co?9728:9729}function Jn(Pn){const Sn=Pn.target;Sn.removeEventListener("dispose",Jn),function(ir){const Xn=$.get(ir);if(Xn.__webglInit===void 0)return;const Dn=ir.source,Hn=Yt.get(Dn);if(Hn){const mr=Hn[Xn.__cacheKey];mr.usedTimes--,mr.usedTimes===0&&Er(ir),Object.keys(Hn).length===0&&Yt.delete(Dn)}$.remove(ir)}(Sn),Sn.isVideoTexture&&Ot.delete(Sn)}function Un(Pn){const Sn=Pn.target;Sn.removeEventListener("dispose",Un),function(ir){const Xn=ir.texture,Dn=$.get(ir),Hn=$.get(Xn);if(Hn.__webglTexture!==void 0&&(ut.deleteTexture(Hn.__webglTexture),ot.memory.textures--),ir.depthTexture&&ir.depthTexture.dispose(),ir.isWebGLCubeRenderTarget)for(let mr=0;mr<6;mr++)ut.deleteFramebuffer(Dn.__webglFramebuffer[mr]),Dn.__webglDepthbuffer&&ut.deleteRenderbuffer(Dn.__webglDepthbuffer[mr]);else{if(ut.deleteFramebuffer(Dn.__webglFramebuffer),Dn.__webglDepthbuffer&&ut.deleteRenderbuffer(Dn.__webglDepthbuffer),Dn.__webglMultisampledFramebuffer&&ut.deleteFramebuffer(Dn.__webglMultisampledFramebuffer),Dn.__webglColorRenderbuffer)for(let mr=0;mr<Dn.__webglColorRenderbuffer.length;mr++)Dn.__webglColorRenderbuffer[mr]&&ut.deleteRenderbuffer(Dn.__webglColorRenderbuffer[mr]);Dn.__webglDepthRenderbuffer&&ut.deleteRenderbuffer(Dn.__webglDepthRenderbuffer)}if(ir.isWebGLMultipleRenderTargets)for(let mr=0,ln=Xn.length;mr<ln;mr++){const gr=$.get(Xn[mr]);gr.__webglTexture&&(ut.deleteTexture(gr.__webglTexture),ot.memory.textures--),$.remove(Xn[mr])}$.remove(Xn),$.remove(ir)}(Sn)}function Er(Pn){const Sn=$.get(Pn);ut.deleteTexture(Sn.__webglTexture);const ir=Pn.source;delete Yt.get(ir)[Sn.__cacheKey],ot.memory.textures--}let Or=0;function xr(Pn,Sn){const ir=$.get(Pn);if(Pn.isVideoTexture&&function(Xn){const Dn=ot.render.frame;Ot.get(Xn)!==Dn&&(Ot.set(Xn,Dn),Xn.update())}(Pn),Pn.isRenderTargetTexture===!1&&Pn.version>0&&ir.__version!==Pn.version){const Xn=Pn.image;if(Xn===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(Xn.complete!==!1)return void jr(ir,Pn,Sn);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}_.activeTexture(33984+Sn),_.bindTexture(3553,ir.__webglTexture)}const Gr={[_o]:10497,[fo]:33071,[Wl]:33648},Hr={[Oo]:9728,[yl]:9984,[co]:9986,[zo]:9729,[Yu]:9985,[oo]:9987};function pr(Pn,Sn,ir){if(ir?(ut.texParameteri(Pn,10242,Gr[Sn.wrapS]),ut.texParameteri(Pn,10243,Gr[Sn.wrapT]),Pn!==32879&&Pn!==35866||ut.texParameteri(Pn,32882,Gr[Sn.wrapR]),ut.texParameteri(Pn,10240,Hr[Sn.magFilter]),ut.texParameteri(Pn,10241,Hr[Sn.minFilter])):(ut.texParameteri(Pn,10242,33071),ut.texParameteri(Pn,10243,33071),Pn!==32879&&Pn!==35866||ut.texParameteri(Pn,32882,33071),Sn.wrapS===fo&&Sn.wrapT===fo||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),ut.texParameteri(Pn,10240,$n(Sn.magFilter)),ut.texParameteri(Pn,10241,$n(Sn.minFilter)),Sn.minFilter!==Oo&&Sn.minFilter!==zo&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),o.has("EXT_texture_filter_anisotropic")===!0){const Xn=o.get("EXT_texture_filter_anisotropic");if(Sn.type===Pl&&o.has("OES_texture_float_linear")===!1||ct===!1&&Sn.type===pu&&o.has("OES_texture_half_float_linear")===!1)return;(Sn.anisotropy>1||$.get(Sn).__currentAnisotropy)&&(ut.texParameterf(Pn,Xn.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Sn.anisotropy,_e.getMaxAnisotropy())),$.get(Sn).__currentAnisotropy=Sn.anisotropy)}}function vr(Pn,Sn){let ir=!1;Pn.__webglInit===void 0&&(Pn.__webglInit=!0,Sn.addEventListener("dispose",Jn));const Xn=Sn.source;let Dn=Yt.get(Xn);Dn===void 0&&(Dn={},Yt.set(Xn,Dn));const Hn=function(mr){const ln=[];return ln.push(mr.wrapS),ln.push(mr.wrapT),ln.push(mr.magFilter),ln.push(mr.minFilter),ln.push(mr.anisotropy),ln.push(mr.internalFormat),ln.push(mr.format),ln.push(mr.type),ln.push(mr.generateMipmaps),ln.push(mr.premultiplyAlpha),ln.push(mr.flipY),ln.push(mr.unpackAlignment),ln.push(mr.encoding),ln.join()}(Sn);if(Hn!==Pn.__cacheKey){Dn[Hn]===void 0&&(Dn[Hn]={texture:ut.createTexture(),usedTimes:0},ot.memory.textures++,ir=!0),Dn[Hn].usedTimes++;const mr=Dn[Pn.__cacheKey];mr!==void 0&&(Dn[Pn.__cacheKey].usedTimes--,mr.usedTimes===0&&Er(Sn)),Pn.__cacheKey=Hn,Pn.__webglTexture=Dn[Hn].texture}return ir}function jr(Pn,Sn,ir){let Xn=3553;Sn.isDataArrayTexture&&(Xn=35866),Sn.isData3DTexture&&(Xn=32879);const Dn=vr(Pn,Sn),Hn=Sn.source;if(_.activeTexture(33984+ir),_.bindTexture(Xn,Pn.__webglTexture),Hn.version!==Hn.__currentVersion||Dn===!0){ut.pixelStorei(37440,Sn.flipY),ut.pixelStorei(37441,Sn.premultiplyAlpha),ut.pixelStorei(3317,Sn.unpackAlignment),ut.pixelStorei(37443,0);const mr=function(Ns){return!ct&&(Ns.wrapS!==fo||Ns.wrapT!==fo||Ns.minFilter!==Oo&&Ns.minFilter!==zo)}(Sn)&&fn(Sn.image)===!1;let ln=an(Sn.image,mr,!1,St);ln=lo(Sn,ln);const gr=fn(ln)||ct,tr=it.convert(Sn.format,Sn.encoding);let br,Tr=it.convert(Sn.type),$r=On(Sn.internalFormat,tr,Tr,Sn.encoding,Sn.isVideoTexture);pr(Xn,Sn,gr);const Es=Sn.mipmaps,Os=ct&&Sn.isVideoTexture!==!0,ro=Hn.__currentVersion===void 0||Dn===!0,Ps=Ln(Sn,ln,gr);if(Sn.isDepthTexture)$r=6402,ct?$r=Sn.type===Pl?36012:Sn.type===jn?33190:Sn.type===os?35056:33189:Sn.type===Pl&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Sn.format===Vo&&$r===6402&&Sn.type!==Pu&&Sn.type!==jn&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Sn.type=jn,Tr=it.convert(Sn.type)),Sn.format===to&&$r===6402&&($r=34041,Sn.type!==os&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Sn.type=os,Tr=it.convert(Sn.type))),ro&&(Os?_.texStorage2D(3553,1,$r,ln.width,ln.height):_.texImage2D(3553,0,$r,ln.width,ln.height,0,tr,Tr,null));else if(Sn.isDataTexture)if(Es.length>0&&gr){Os&&ro&&_.texStorage2D(3553,Ps,$r,Es[0].width,Es[0].height);for(let Ns=0,Yo=Es.length;Ns<Yo;Ns++)br=Es[Ns],Os?_.texSubImage2D(3553,Ns,0,0,br.width,br.height,tr,Tr,br.data):_.texImage2D(3553,Ns,$r,br.width,br.height,0,tr,Tr,br.data);Sn.generateMipmaps=!1}else Os?(ro&&_.texStorage2D(3553,Ps,$r,ln.width,ln.height),_.texSubImage2D(3553,0,0,0,ln.width,ln.height,tr,Tr,ln.data)):_.texImage2D(3553,0,$r,ln.width,ln.height,0,tr,Tr,ln.data);else if(Sn.isCompressedTexture){Os&&ro&&_.texStorage2D(3553,Ps,$r,Es[0].width,Es[0].height);for(let Ns=0,Yo=Es.length;Ns<Yo;Ns++)br=Es[Ns],Sn.format!==Ls?tr!==null?Os?_.compressedTexSubImage2D(3553,Ns,0,0,br.width,br.height,tr,br.data):_.compressedTexImage2D(3553,Ns,$r,br.width,br.height,0,br.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Os?_.texSubImage2D(3553,Ns,0,0,br.width,br.height,tr,Tr,br.data):_.texImage2D(3553,Ns,$r,br.width,br.height,0,tr,Tr,br.data)}else if(Sn.isDataArrayTexture)Os?(ro&&_.texStorage3D(35866,Ps,$r,ln.width,ln.height,ln.depth),_.texSubImage3D(35866,0,0,0,0,ln.width,ln.height,ln.depth,tr,Tr,ln.data)):_.texImage3D(35866,0,$r,ln.width,ln.height,ln.depth,0,tr,Tr,ln.data);else if(Sn.isData3DTexture)Os?(ro&&_.texStorage3D(32879,Ps,$r,ln.width,ln.height,ln.depth),_.texSubImage3D(32879,0,0,0,0,ln.width,ln.height,ln.depth,tr,Tr,ln.data)):_.texImage3D(32879,0,$r,ln.width,ln.height,ln.depth,0,tr,Tr,ln.data);else if(Sn.isFramebufferTexture){if(ro)if(Os)_.texStorage2D(3553,Ps,$r,ln.width,ln.height);else{let Ns=ln.width,Yo=ln.height;for(let Rm=0;Rm<Ps;Rm++)_.texImage2D(3553,Rm,$r,Ns,Yo,0,tr,Tr,null),Ns>>=1,Yo>>=1}}else if(Es.length>0&&gr){Os&&ro&&_.texStorage2D(3553,Ps,$r,Es[0].width,Es[0].height);for(let Ns=0,Yo=Es.length;Ns<Yo;Ns++)br=Es[Ns],Os?_.texSubImage2D(3553,Ns,0,0,tr,Tr,br):_.texImage2D(3553,Ns,$r,tr,Tr,br);Sn.generateMipmaps=!1}else Os?(ro&&_.texStorage2D(3553,Ps,$r,ln.width,ln.height),_.texSubImage2D(3553,0,0,0,tr,Tr,ln)):_.texImage2D(3553,0,$r,tr,Tr,ln);gn(Sn,gr)&&_n(Xn),Hn.__currentVersion=Hn.version,Sn.onUpdate&&Sn.onUpdate(Sn)}Pn.__version=Sn.version}function Sr(Pn,Sn,ir,Xn,Dn){const Hn=it.convert(ir.format,ir.encoding),mr=it.convert(ir.type),ln=On(ir.internalFormat,Hn,mr,ir.encoding);$.get(Sn).__hasExternalTextures||(Dn===32879||Dn===35866?_.texImage3D(Dn,0,ln,Sn.width,Sn.height,Sn.depth,0,Hn,mr,null):_.texImage2D(Dn,0,ln,Sn.width,Sn.height,0,Hn,mr,null)),_.bindFramebuffer(36160,Pn),bs(Sn)?Ct.framebufferTexture2DMultisampleEXT(36160,Xn,Dn,$.get(ir).__webglTexture,0,go(Sn)):ut.framebufferTexture2D(36160,Xn,Dn,$.get(ir).__webglTexture,0),_.bindFramebuffer(36160,null)}function Qr(Pn,Sn,ir){if(ut.bindRenderbuffer(36161,Pn),Sn.depthBuffer&&!Sn.stencilBuffer){let Xn=33189;if(ir||bs(Sn)){const Dn=Sn.depthTexture;Dn&&Dn.isDepthTexture&&(Dn.type===Pl?Xn=36012:Dn.type===jn&&(Xn=33190));const Hn=go(Sn);bs(Sn)?Ct.renderbufferStorageMultisampleEXT(36161,Hn,Xn,Sn.width,Sn.height):ut.renderbufferStorageMultisample(36161,Hn,Xn,Sn.width,Sn.height)}else ut.renderbufferStorage(36161,Xn,Sn.width,Sn.height);ut.framebufferRenderbuffer(36160,36096,36161,Pn)}else if(Sn.depthBuffer&&Sn.stencilBuffer){const Xn=go(Sn);ir&&bs(Sn)===!1?ut.renderbufferStorageMultisample(36161,Xn,35056,Sn.width,Sn.height):bs(Sn)?Ct.renderbufferStorageMultisampleEXT(36161,Xn,35056,Sn.width,Sn.height):ut.renderbufferStorage(36161,34041,Sn.width,Sn.height),ut.framebufferRenderbuffer(36160,33306,36161,Pn)}else{const Xn=Sn.isWebGLMultipleRenderTargets===!0?Sn.texture:[Sn.texture];for(let Dn=0;Dn<Xn.length;Dn++){const Hn=Xn[Dn],mr=it.convert(Hn.format,Hn.encoding),ln=it.convert(Hn.type),gr=On(Hn.internalFormat,mr,ln,Hn.encoding),tr=go(Sn);ir&&bs(Sn)===!1?ut.renderbufferStorageMultisample(36161,tr,gr,Sn.width,Sn.height):bs(Sn)?Ct.renderbufferStorageMultisampleEXT(36161,tr,gr,Sn.width,Sn.height):ut.renderbufferStorage(36161,gr,Sn.width,Sn.height)}}ut.bindRenderbuffer(36161,null)}function As(Pn){const Sn=$.get(Pn),ir=Pn.isWebGLCubeRenderTarget===!0;if(Pn.depthTexture&&!Sn.__autoAllocateDepthBuffer){if(ir)throw new Error("target.depthTexture not supported in Cube render targets");(function(Xn,Dn){if(Dn&&Dn.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(_.bindFramebuffer(36160,Xn),!Dn.depthTexture||!Dn.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");$.get(Dn.depthTexture).__webglTexture&&Dn.depthTexture.image.width===Dn.width&&Dn.depthTexture.image.height===Dn.height||(Dn.depthTexture.image.width=Dn.width,Dn.depthTexture.image.height=Dn.height,Dn.depthTexture.needsUpdate=!0),xr(Dn.depthTexture,0);const Hn=$.get(Dn.depthTexture).__webglTexture,mr=go(Dn);if(Dn.depthTexture.format===Vo)bs(Dn)?Ct.framebufferTexture2DMultisampleEXT(36160,36096,3553,Hn,0,mr):ut.framebufferTexture2D(36160,36096,3553,Hn,0);else{if(Dn.depthTexture.format!==to)throw new Error("Unknown depthTexture format");bs(Dn)?Ct.framebufferTexture2DMultisampleEXT(36160,33306,3553,Hn,0,mr):ut.framebufferTexture2D(36160,33306,3553,Hn,0)}})(Sn.__webglFramebuffer,Pn)}else if(ir){Sn.__webglDepthbuffer=[];for(let Xn=0;Xn<6;Xn++)_.bindFramebuffer(36160,Sn.__webglFramebuffer[Xn]),Sn.__webglDepthbuffer[Xn]=ut.createRenderbuffer(),Qr(Sn.__webglDepthbuffer[Xn],Pn,!1)}else _.bindFramebuffer(36160,Sn.__webglFramebuffer),Sn.__webglDepthbuffer=ut.createRenderbuffer(),Qr(Sn.__webglDepthbuffer,Pn,!1);_.bindFramebuffer(36160,null)}function go(Pn){return Math.min(Tt,Pn.samples)}function bs(Pn){const Sn=$.get(Pn);return ct&&Pn.samples>0&&o.has("WEBGL_multisampled_render_to_texture")===!0&&Sn.__useRenderToTexture!==!1}function lo(Pn,Sn){const ir=Pn.encoding,Xn=Pn.format,Dn=Pn.type;return Pn.isCompressedTexture===!0||Pn.isVideoTexture===!0||Pn.format===wA||ir!==Am&&(ir===mo?ct===!1?o.has("EXT_sRGB")===!0&&Xn===Ls?(Pn.format=wA,Pn.minFilter=zo,Pn.generateMipmaps=!1):Sn=Ty.sRGBToLinear(Sn):Xn===Ls&&Dn===Gs||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):ir===RGBM16Encoding||console.error("THREE.WebGLTextures: Unsupported texture encoding:",ir)),Sn}this.allocateTextureUnit=function(){const Pn=Or;return Pn>=mt&&console.warn("THREE.WebGLTextures: Trying to use "+Pn+" texture units while this GPU supports only "+mt),Or+=1,Pn},this.resetTextureUnits=function(){Or=0},this.setTexture2D=xr,this.setTexture2DArray=function(Pn,Sn){const ir=$.get(Pn);Pn.version>0&&ir.__version!==Pn.version?jr(ir,Pn,Sn):(_.activeTexture(33984+Sn),_.bindTexture(35866,ir.__webglTexture))},this.setTexture3D=function(Pn,Sn){const ir=$.get(Pn);Pn.version>0&&ir.__version!==Pn.version?jr(ir,Pn,Sn):(_.activeTexture(33984+Sn),_.bindTexture(32879,ir.__webglTexture))},this.setTextureCube=function(Pn,Sn){const ir=$.get(Pn);Pn.version>0&&ir.__version!==Pn.version?function(Xn,Dn,Hn){if(Dn.image.length!==6)return;const mr=vr(Xn,Dn),ln=Dn.source;if(_.activeTexture(33984+Hn),_.bindTexture(34067,Xn.__webglTexture),ln.version!==ln.__currentVersion||mr===!0){ut.pixelStorei(37440,Dn.flipY),ut.pixelStorei(37441,Dn.premultiplyAlpha),ut.pixelStorei(3317,Dn.unpackAlignment),ut.pixelStorei(37443,0);const gr=Dn.isCompressedTexture||Dn.image[0].isCompressedTexture,tr=Dn.image[0]&&Dn.image[0].isDataTexture,br=[];for(let Zs=0;Zs<6;Zs++)br[Zs]=gr||tr?tr?Dn.image[Zs].image:Dn.image[Zs]:an(Dn.image[Zs],!1,!0,gt),br[Zs]=lo(Dn,br[Zs]);const Tr=br[0],$r=fn(Tr)||ct,Es=it.convert(Dn.format,Dn.encoding),Os=it.convert(Dn.type),ro=On(Dn.internalFormat,Es,Os,Dn.encoding),Ps=ct&&Dn.isVideoTexture!==!0,Ns=ln.__currentVersion===void 0||mr===!0;let Yo,Rm=Ln(Dn,Tr,$r);if(pr(34067,Dn,$r),gr){Ps&&Ns&&_.texStorage2D(34067,Rm,ro,Tr.width,Tr.height);for(let Zs=0;Zs<6;Zs++){Yo=br[Zs].mipmaps;for(let na=0;na<Yo.length;na++){const ga=Yo[na];Dn.format!==Ls?Es!==null?Ps?_.compressedTexSubImage2D(34069+Zs,na,0,0,ga.width,ga.height,Es,ga.data):_.compressedTexImage2D(34069+Zs,na,ro,ga.width,ga.height,0,ga.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ps?_.texSubImage2D(34069+Zs,na,0,0,ga.width,ga.height,Es,Os,ga.data):_.texImage2D(34069+Zs,na,ro,ga.width,ga.height,0,Es,Os,ga.data)}}}else{Yo=Dn.mipmaps,Ps&&Ns&&(Yo.length>0&&Rm++,_.texStorage2D(34067,Rm,ro,br[0].width,br[0].height));for(let Zs=0;Zs<6;Zs++)if(tr){Ps?_.texSubImage2D(34069+Zs,0,0,0,br[Zs].width,br[Zs].height,Es,Os,br[Zs].data):_.texImage2D(34069+Zs,0,ro,br[Zs].width,br[Zs].height,0,Es,Os,br[Zs].data);for(let na=0;na<Yo.length;na++){const ga=Yo[na].image[Zs].image;Ps?_.texSubImage2D(34069+Zs,na+1,0,0,ga.width,ga.height,Es,Os,ga.data):_.texImage2D(34069+Zs,na+1,ro,ga.width,ga.height,0,Es,Os,ga.data)}}else{Ps?_.texSubImage2D(34069+Zs,0,0,0,Es,Os,br[Zs]):_.texImage2D(34069+Zs,0,ro,Es,Os,br[Zs]);for(let na=0;na<Yo.length;na++){const ga=Yo[na];Ps?_.texSubImage2D(34069+Zs,na+1,0,0,Es,Os,ga.image[Zs]):_.texImage2D(34069+Zs,na+1,ro,Es,Os,ga.image[Zs])}}}gn(Dn,$r)&&_n(34067),ln.__currentVersion=ln.version,Dn.onUpdate&&Dn.onUpdate(Dn)}Xn.__version=Dn.version}(ir,Pn,Sn):(_.activeTexture(33984+Sn),_.bindTexture(34067,ir.__webglTexture))},this.rebindTextures=function(Pn,Sn,ir){const Xn=$.get(Pn);Sn!==void 0&&Sr(Xn.__webglFramebuffer,Pn,Pn.texture,36064,3553),ir!==void 0&&As(Pn)},this.setupRenderTarget=function(Pn){const Sn=Pn.texture,ir=$.get(Pn),Xn=$.get(Sn);Pn.addEventListener("dispose",Un),Pn.isWebGLMultipleRenderTargets!==!0&&(Xn.__webglTexture===void 0&&(Xn.__webglTexture=ut.createTexture()),Xn.__version=Sn.version,ot.memory.textures++);const Dn=Pn.isWebGLCubeRenderTarget===!0,Hn=Pn.isWebGLMultipleRenderTargets===!0,mr=fn(Pn)||ct;if(Dn){ir.__webglFramebuffer=[];for(let ln=0;ln<6;ln++)ir.__webglFramebuffer[ln]=ut.createFramebuffer()}else{if(ir.__webglFramebuffer=ut.createFramebuffer(),Hn)if(_e.drawBuffers){const ln=Pn.texture;for(let gr=0,tr=ln.length;gr<tr;gr++){const br=$.get(ln[gr]);br.__webglTexture===void 0&&(br.__webglTexture=ut.createTexture(),ot.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(ct&&Pn.samples>0&&bs(Pn)===!1){const ln=Hn?Sn:[Sn];ir.__webglMultisampledFramebuffer=ut.createFramebuffer(),ir.__webglColorRenderbuffer=[],_.bindFramebuffer(36160,ir.__webglMultisampledFramebuffer);for(let gr=0;gr<ln.length;gr++){const tr=ln[gr];ir.__webglColorRenderbuffer[gr]=ut.createRenderbuffer(),ut.bindRenderbuffer(36161,ir.__webglColorRenderbuffer[gr]);const br=it.convert(tr.format,tr.encoding),Tr=it.convert(tr.type),$r=On(tr.internalFormat,br,Tr,tr.encoding),Es=go(Pn);ut.renderbufferStorageMultisample(36161,Es,$r,Pn.width,Pn.height),ut.framebufferRenderbuffer(36160,36064+gr,36161,ir.__webglColorRenderbuffer[gr])}ut.bindRenderbuffer(36161,null),Pn.depthBuffer&&(ir.__webglDepthRenderbuffer=ut.createRenderbuffer(),Qr(ir.__webglDepthRenderbuffer,Pn,!0)),_.bindFramebuffer(36160,null)}}if(Dn){_.bindTexture(34067,Xn.__webglTexture),pr(34067,Sn,mr);for(let ln=0;ln<6;ln++)Sr(ir.__webglFramebuffer[ln],Pn,Sn,36064,34069+ln);gn(Sn,mr)&&_n(34067),_.unbindTexture()}else if(Hn){const ln=Pn.texture;for(let gr=0,tr=ln.length;gr<tr;gr++){const br=ln[gr],Tr=$.get(br);_.bindTexture(3553,Tr.__webglTexture),pr(3553,br,mr),Sr(ir.__webglFramebuffer,Pn,br,36064+gr,3553),gn(br,mr)&&_n(3553)}_.unbindTexture()}else{let ln=3553;(Pn.isWebGL3DRenderTarget||Pn.isWebGLArrayRenderTarget)&&(ct?ln=Pn.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),_.bindTexture(ln,Xn.__webglTexture),pr(ln,Sn,mr),Sr(ir.__webglFramebuffer,Pn,Sn,36064,ln),gn(Sn,mr)&&_n(ln),_.unbindTexture()}Pn.depthBuffer&&As(Pn)},this.updateRenderTargetMipmap=function(Pn){const Sn=fn(Pn)||ct,ir=Pn.isWebGLMultipleRenderTargets===!0?Pn.texture:[Pn.texture],Xn=Pn.isWebGLCubeRenderTarget?34067:3553;for(let Dn=0,Hn=ir.length;Dn<Hn;Dn++){const mr=ir[Dn],ln=$.get(mr),gr=ln.__webglTexture;ln.__version!==mr.version&&(_.bindTexture(Xn,gr),pr(Xn,mr,Sn),_.unbindTexture(),ln.__version=mr.version),gn(mr,Sn)&&(_.bindTexture(Xn,gr),_n(Xn),_.unbindTexture())}},this.updateMultisampleRenderTarget=function(Pn){if(ct&&Pn.samples>0&&bs(Pn)===!1){const Sn=Pn.isWebGLMultipleRenderTargets?Pn.texture:[Pn.texture],ir=Pn.width,Xn=Pn.height;let Dn=16384;const Hn=[],mr=Pn.stencilBuffer?33306:36096,ln=$.get(Pn),gr=Pn.isWebGLMultipleRenderTargets===!0;if(gr)for(let tr=0;tr<Sn.length;tr++)_.bindFramebuffer(36160,ln.__webglMultisampledFramebuffer),ut.framebufferRenderbuffer(36160,36064+tr,36161,null),_.bindFramebuffer(36160,ln.__webglFramebuffer),ut.framebufferTexture2D(36009,36064+tr,3553,null,0);_.bindFramebuffer(36008,ln.__webglMultisampledFramebuffer),_.bindFramebuffer(36009,ln.__webglFramebuffer);for(let tr=0;tr<Sn.length;tr++){Hn.push(36064+tr),Pn.depthBuffer&&Hn.push(mr);const br=ln.__ignoreDepthValues!==void 0&&ln.__ignoreDepthValues;if(br===!1&&(Pn.depthBuffer&&(Dn|=256),Pn.stencilBuffer&&(Dn|=1024)),gr&&ut.framebufferRenderbuffer(36008,36064,36161,ln.__webglColorRenderbuffer[tr]),br===!0&&(ut.invalidateFramebuffer(36008,[mr]),ut.invalidateFramebuffer(36009,[mr])),gr){const Tr=$.get(Sn[tr]).__webglTexture;ut.framebufferTexture2D(36009,36064,3553,Tr,0)}ut.blitFramebuffer(0,0,ir,Xn,0,0,ir,Xn,Dn,9728),Pt&&ut.invalidateFramebuffer(36008,Hn)}if(_.bindFramebuffer(36008,null),_.bindFramebuffer(36009,null),gr)for(let tr=0;tr<Sn.length;tr++){_.bindFramebuffer(36160,ln.__webglMultisampledFramebuffer),ut.framebufferRenderbuffer(36160,36064+tr,36161,ln.__webglColorRenderbuffer[tr]);const br=$.get(Sn[tr]).__webglTexture;_.bindFramebuffer(36160,ln.__webglFramebuffer),ut.framebufferTexture2D(36009,36064+tr,3553,br,0)}_.bindFramebuffer(36009,ln.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=As,this.setupFrameBufferTexture=Sr,this.useMultisampledRTT=bs}function G1(ut,o,_){const $=_.isWebGL2;return{convert:function(_e,it=null){let ot;if(_e===Gs)return 5121;if(_e===Ds)return 32819;if(_e===Wr)return 32820;if(_e===Jl)return 5120;if(_e===Xu)return 5122;if(_e===Pu)return 5123;if(_e===xu)return 5124;if(_e===jn)return 5125;if(_e===Pl)return 5126;if(_e===pu)return $?5131:(ot=o.get("OES_texture_half_float"),ot!==null?ot.HALF_FLOAT_OES:null);if(_e===Al)return 6406;if(_e===Ls)return 6408;if(_e===vs)return 6409;if(_e===eo)return 6410;if(_e===Vo)return 6402;if(_e===to)return 34041;if(_e===xa)return 6403;if(_e===ss)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(_e===wA)return ot=o.get("EXT_sRGB"),ot!==null?ot.SRGB_ALPHA_EXT:null;if(_e===Ko)return 36244;if(_e===Zl)return 33319;if(_e===xl)return 33320;if(_e===yo)return 36249;if(_e===Dl||_e===Lo||_e===Hs||_e===Yl)if(it===mo){if(ot=o.get("WEBGL_compressed_texture_s3tc_srgb"),ot===null)return null;if(_e===Dl)return ot.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(_e===Lo)return ot.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(_e===Hs)return ot.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(_e===Yl)return ot.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(ot=o.get("WEBGL_compressed_texture_s3tc"),ot===null)return null;if(_e===Dl)return ot.COMPRESSED_RGB_S3TC_DXT1_EXT;if(_e===Lo)return ot.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(_e===Hs)return ot.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(_e===Yl)return ot.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(_e===Ho||_e===Fl||_e===Io||_e===Jr){if(ot=o.get("WEBGL_compressed_texture_pvrtc"),ot===null)return null;if(_e===Ho)return ot.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(_e===Fl)return ot.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(_e===Io)return ot.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(_e===Jr)return ot.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(_e===qp)return ot=o.get("WEBGL_compressed_texture_etc1"),ot!==null?ot.COMPRESSED_RGB_ETC1_WEBGL:null;if(_e===Xr||_e===Qo){if(ot=o.get("WEBGL_compressed_texture_etc"),ot===null)return null;if(_e===Xr)return it===mo?ot.COMPRESSED_SRGB8_ETC2:ot.COMPRESSED_RGB8_ETC2;if(_e===Qo)return it===mo?ot.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:ot.COMPRESSED_RGBA8_ETC2_EAC}if(_e===vu||_e===Ao||_e===so||_e===op||_e===Ku||_e===Ap||_e===Yp||_e===Ws||_e===fA||_e===w_||_e===Vv||_e===Qv||_e===Wo||_e===No){if(ot=o.get("WEBGL_compressed_texture_astc"),ot===null)return null;if(_e===vu)return it===mo?ot.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:ot.COMPRESSED_RGBA_ASTC_4x4_KHR;if(_e===Ao)return it===mo?ot.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:ot.COMPRESSED_RGBA_ASTC_5x4_KHR;if(_e===so)return it===mo?ot.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:ot.COMPRESSED_RGBA_ASTC_5x5_KHR;if(_e===op)return it===mo?ot.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:ot.COMPRESSED_RGBA_ASTC_6x5_KHR;if(_e===Ku)return it===mo?ot.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:ot.COMPRESSED_RGBA_ASTC_6x6_KHR;if(_e===Ap)return it===mo?ot.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:ot.COMPRESSED_RGBA_ASTC_8x5_KHR;if(_e===Yp)return it===mo?ot.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:ot.COMPRESSED_RGBA_ASTC_8x6_KHR;if(_e===Ws)return it===mo?ot.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:ot.COMPRESSED_RGBA_ASTC_8x8_KHR;if(_e===fA)return it===mo?ot.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:ot.COMPRESSED_RGBA_ASTC_10x5_KHR;if(_e===w_)return it===mo?ot.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:ot.COMPRESSED_RGBA_ASTC_10x6_KHR;if(_e===Vv)return it===mo?ot.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:ot.COMPRESSED_RGBA_ASTC_10x8_KHR;if(_e===Qv)return it===mo?ot.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:ot.COMPRESSED_RGBA_ASTC_10x10_KHR;if(_e===Wo)return it===mo?ot.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:ot.COMPRESSED_RGBA_ASTC_12x10_KHR;if(_e===No)return it===mo?ot.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:ot.COMPRESSED_RGBA_ASTC_12x12_KHR}if(_e===hv){if(ot=o.get("EXT_texture_compression_bptc"),ot===null)return null;if(_e===hv)return it===mo?ot.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:ot.COMPRESSED_RGBA_BPTC_UNORM_EXT}return _e===os?$?34042:(ot=o.get("WEBGL_depth_texture"),ot!==null?ot.UNSIGNED_INT_24_8_WEBGL:null):ut[_e]!==void 0?ut[_e]:null}}}class eC extends ep{constructor(o=[]){super(),this.isArrayCamera=!0,this.cameras=o}}class H_ extends no{constructor(){super(),this.isGroup=!0,this.type="Group"}}const gT={type:"move"};class H1{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new H_,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new H_,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new An,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new An),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new H_,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new An,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new An),this._grip}dispatchEvent(o){return this._targetRay!==null&&this._targetRay.dispatchEvent(o),this._grip!==null&&this._grip.dispatchEvent(o),this._hand!==null&&this._hand.dispatchEvent(o),this}disconnect(o){return this.dispatchEvent({type:"disconnected",data:o}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(o,_,$){let _e=null,it=null,ot=null;const ct=this._targetRay,mt=this._grip,gt=this._hand;if(o&&_.session.visibilityState!=="visible-blurred"){if(gt&&o.hand){ot=!0;for(const Dt of o.hand.values()){const Yt=_.getJointPose(Dt,$);if(gt.joints[Dt.jointName]===void 0){const Jt=new H_;Jt.matrixAutoUpdate=!1,Jt.visible=!1,gt.joints[Dt.jointName]=Jt,gt.add(Jt)}const Xt=gt.joints[Dt.jointName];Yt!==null&&(Xt.matrix.fromArray(Yt.transform.matrix),Xt.matrix.decompose(Xt.position,Xt.rotation,Xt.scale),Xt.jointRadius=Yt.radius),Xt.visible=Yt!==null}const St=gt.joints["index-finger-tip"],Tt=gt.joints["thumb-tip"],Ct=St.position.distanceTo(Tt.position),Pt=.02,Ot=.005;gt.inputState.pinching&&Ct>Pt+Ot?(gt.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:o.handedness,target:this})):!gt.inputState.pinching&&Ct<=Pt-Ot&&(gt.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:o.handedness,target:this}))}else mt!==null&&o.gripSpace&&(it=_.getPose(o.gripSpace,$),it!==null&&(mt.matrix.fromArray(it.transform.matrix),mt.matrix.decompose(mt.position,mt.rotation,mt.scale),it.linearVelocity?(mt.hasLinearVelocity=!0,mt.linearVelocity.copy(it.linearVelocity)):mt.hasLinearVelocity=!1,it.angularVelocity?(mt.hasAngularVelocity=!0,mt.angularVelocity.copy(it.angularVelocity)):mt.hasAngularVelocity=!1));ct!==null&&(_e=_.getPose(o.targetRaySpace,$),_e===null&&it!==null&&(_e=it),_e!==null&&(ct.matrix.fromArray(_e.transform.matrix),ct.matrix.decompose(ct.position,ct.rotation,ct.scale),_e.linearVelocity?(ct.hasLinearVelocity=!0,ct.linearVelocity.copy(_e.linearVelocity)):ct.hasLinearVelocity=!1,_e.angularVelocity?(ct.hasAngularVelocity=!0,ct.angularVelocity.copy(_e.angularVelocity)):ct.hasAngularVelocity=!1,this.dispatchEvent(gT)))}return ct!==null&&(ct.visible=_e!==null),mt!==null&&(mt.visible=it!==null),gt!==null&&(gt.visible=ot!==null),this}}class tC extends yu{constructor(o,_,$,_e,it,ot,ct,mt,gt,St){if((St=St!==void 0?St:Vo)!==Vo&&St!==to)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");$===void 0&&St===Vo&&($=jn),$===void 0&&St===to&&($=os),super(null,_e,it,ot,ct,mt,St,$,gt),this.isDepthTexture=!0,this.image={width:o,height:_},this.magFilter=ct!==void 0?ct:Oo,this.minFilter=mt!==void 0?mt:Oo,this.flipY=!1,this.generateMipmaps=!1}}class Jw extends Fs{constructor(o,_){super();const $=this;let _e=null,it=1,ot=null,ct="local-floor",mt=null,gt=null,St=null,Tt=null,Ct=null,Pt=null;const Ot=_.getContextAttributes();let Dt=null,Yt=null;const Xt=[],Jt=[],an=new ep;an.layers.enable(1),an.viewport=new Fo;const fn=new ep;fn.layers.enable(2),fn.viewport=new Fo;const gn=[an,fn],_n=new eC;_n.layers.enable(1),_n.layers.enable(2);let On=null,Ln=null;function $n(pr){const vr=Jt.indexOf(pr.inputSource);if(vr===-1)return;const jr=Xt[vr];jr!==void 0&&jr.dispatchEvent({type:pr.type,data:pr.inputSource})}function Jn(){_e.removeEventListener("select",$n),_e.removeEventListener("selectstart",$n),_e.removeEventListener("selectend",$n),_e.removeEventListener("squeeze",$n),_e.removeEventListener("squeezestart",$n),_e.removeEventListener("squeezeend",$n),_e.removeEventListener("end",Jn),_e.removeEventListener("inputsourceschange",Un);for(let pr=0;pr<Xt.length;pr++){const vr=Jt[pr];vr!==null&&(Jt[pr]=null,Xt[pr].disconnect(vr))}On=null,Ln=null,o.setRenderTarget(Dt),Ct=null,Tt=null,St=null,_e=null,Yt=null,Hr.stop(),$.isPresenting=!1,$.dispatchEvent({type:"sessionend"})}function Un(pr){for(let vr=0;vr<pr.removed.length;vr++){const jr=pr.removed[vr],Sr=Jt.indexOf(jr);Sr>=0&&(Jt[Sr]=null,Xt[Sr].dispatchEvent({type:"disconnected",data:jr}))}for(let vr=0;vr<pr.added.length;vr++){const jr=pr.added[vr];let Sr=Jt.indexOf(jr);if(Sr===-1){for(let As=0;As<Xt.length;As++){if(As>=Jt.length){Jt.push(jr),Sr=As;break}if(Jt[As]===null){Jt[As]=jr,Sr=As;break}}if(Sr===-1)break}const Qr=Xt[Sr];Qr&&Qr.dispatchEvent({type:"connected",data:jr})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(pr){let vr=Xt[pr];return vr===void 0&&(vr=new H1,Xt[pr]=vr),vr.getTargetRaySpace()},this.getControllerGrip=function(pr){let vr=Xt[pr];return vr===void 0&&(vr=new H1,Xt[pr]=vr),vr.getGripSpace()},this.getHand=function(pr){let vr=Xt[pr];return vr===void 0&&(vr=new H1,Xt[pr]=vr),vr.getHandSpace()},this.setFramebufferScaleFactor=function(pr){it=pr,$.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(pr){ct=pr,$.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return mt||ot},this.setReferenceSpace=function(pr){mt=pr},this.getBaseLayer=function(){return Tt!==null?Tt:Ct},this.getBinding=function(){return St},this.getFrame=function(){return Pt},this.getSession=function(){return _e},this.setSession=async function(pr){if(_e=pr,_e!==null){if(Dt=o.getRenderTarget(),_e.addEventListener("select",$n),_e.addEventListener("selectstart",$n),_e.addEventListener("selectend",$n),_e.addEventListener("squeeze",$n),_e.addEventListener("squeezestart",$n),_e.addEventListener("squeezeend",$n),_e.addEventListener("end",Jn),_e.addEventListener("inputsourceschange",Un),Ot.xrCompatible!==!0&&await _.makeXRCompatible(),_e.renderState.layers===void 0||o.capabilities.isWebGL2===!1){const vr={antialias:_e.renderState.layers!==void 0||Ot.antialias,alpha:Ot.alpha,depth:Ot.depth,stencil:Ot.stencil,framebufferScaleFactor:it};Ct=new XRWebGLLayer(_e,_,vr),_e.updateRenderState({baseLayer:Ct}),Yt=new xp(Ct.framebufferWidth,Ct.framebufferHeight,{format:Ls,type:Gs,encoding:o.outputEncoding,stencilBuffer:Ot.stencil})}else{let vr=null,jr=null,Sr=null;Ot.depth&&(Sr=Ot.stencil?35056:33190,vr=Ot.stencil?to:Vo,jr=Ot.stencil?os:jn);const Qr={colorFormat:32856,depthFormat:Sr,scaleFactor:it};St=new XRWebGLBinding(_e,_),Tt=St.createProjectionLayer(Qr),_e.updateRenderState({layers:[Tt]}),Yt=new xp(Tt.textureWidth,Tt.textureHeight,{format:Ls,type:Gs,depthTexture:new tC(Tt.textureWidth,Tt.textureHeight,jr,void 0,void 0,void 0,void 0,void 0,void 0,vr),stencilBuffer:Ot.stencil,encoding:o.outputEncoding,samples:Ot.antialias?4:0}),o.properties.get(Yt).__ignoreDepthValues=Tt.ignoreDepthValues}Yt.isXRRenderTarget=!0,this.setFoveation(1),mt=null,ot=await _e.requestReferenceSpace(ct),Hr.setContext(_e),Hr.start(),$.isPresenting=!0,$.dispatchEvent({type:"sessionstart"})}};const Er=new An,Or=new An;function xr(pr,vr){vr===null?pr.matrixWorld.copy(pr.matrix):pr.matrixWorld.multiplyMatrices(vr.matrixWorld,pr.matrix),pr.matrixWorldInverse.copy(pr.matrixWorld).invert()}this.updateCamera=function(pr){if(_e===null)return;_n.near=fn.near=an.near=pr.near,_n.far=fn.far=an.far=pr.far,On===_n.near&&Ln===_n.far||(_e.updateRenderState({depthNear:_n.near,depthFar:_n.far}),On=_n.near,Ln=_n.far);const vr=pr.parent,jr=_n.cameras;xr(_n,vr);for(let Qr=0;Qr<jr.length;Qr++)xr(jr[Qr],vr);_n.matrixWorld.decompose(_n.position,_n.quaternion,_n.scale),pr.matrix.copy(_n.matrix),pr.matrix.decompose(pr.position,pr.quaternion,pr.scale);const Sr=pr.children;for(let Qr=0,As=Sr.length;Qr<As;Qr++)Sr[Qr].updateMatrixWorld(!0);jr.length===2?function(Qr,As,go){Er.setFromMatrixPosition(As.matrixWorld),Or.setFromMatrixPosition(go.matrixWorld);const bs=Er.distanceTo(Or),lo=As.projectionMatrix.elements,Pn=go.projectionMatrix.elements,Sn=lo[14]/(lo[10]-1),ir=lo[14]/(lo[10]+1),Xn=(lo[9]+1)/lo[5],Dn=(lo[9]-1)/lo[5],Hn=(lo[8]-1)/lo[0],mr=(Pn[8]+1)/Pn[0],ln=Sn*Hn,gr=Sn*mr,tr=bs/(-Hn+mr),br=tr*-Hn;As.matrixWorld.decompose(Qr.position,Qr.quaternion,Qr.scale),Qr.translateX(br),Qr.translateZ(tr),Qr.matrixWorld.compose(Qr.position,Qr.quaternion,Qr.scale),Qr.matrixWorldInverse.copy(Qr.matrixWorld).invert();const Tr=Sn+tr,$r=ir+tr,Es=ln-br,Os=gr+(bs-br),ro=Xn*ir/$r*Tr,Ps=Dn*ir/$r*Tr;Qr.projectionMatrix.makePerspective(Es,Os,ro,Ps,Tr,$r)}(_n,an,fn):_n.projectionMatrix.copy(an.projectionMatrix)},this.getCamera=function(){return _n},this.getFoveation=function(){return Tt!==null?Tt.fixedFoveation:Ct!==null?Ct.fixedFoveation:void 0},this.setFoveation=function(pr){Tt!==null&&(Tt.fixedFoveation=pr),Ct!==null&&Ct.fixedFoveation!==void 0&&(Ct.fixedFoveation=pr)};let Gr=null;this.onPreAnimationFrameCallback=null;const Hr=new Q_;Hr.setAnimationLoop(function(pr,vr){if($.onPreAnimationFrameCallback&&$.onPreAnimationFrameCallback(pr,vr),gt=vr.getViewerPose(mt||ot),Pt=vr,gt!==null){const jr=gt.views;Ct!==null&&(o.setRenderTargetFramebuffer(Yt,Ct.framebuffer),o.setRenderTarget(Yt));let Sr=!1;jr.length!==_n.cameras.length&&(_n.cameras.length=0,Sr=!0);for(let Qr=0;Qr<jr.length;Qr++){const As=jr[Qr];let go=null;if(Ct!==null)go=Ct.getViewport(As);else{const lo=St.getViewSubImage(Tt,As);go=lo.viewport,Qr===0&&(o.setRenderTargetTextures(Yt,lo.colorTexture,Tt.ignoreDepthValues?void 0:lo.depthStencilTexture),o.setRenderTarget(Yt))}let bs=gn[Qr];bs===void 0&&(bs=new ep,bs.layers.enable(Qr),bs.viewport=new Fo,gn[Qr]=bs),bs.matrix.fromArray(As.transform.matrix),bs.projectionMatrix.fromArray(As.projectionMatrix),bs.viewport.set(go.x,go.y,go.width,go.height),Qr===0&&_n.matrix.copy(bs.matrix),Sr===!0&&_n.cameras.push(bs)}}for(let jr=0;jr<Xt.length;jr++){const Sr=Jt[jr],Qr=Xt[jr];Sr!==null&&Qr!==void 0&&Qr.update(Sr,vr,mt||ot)}Gr&&Gr(pr,vr),Pt=null}),this.setAnimationLoop=function(pr){Gr=pr},this.dispose=function(){}}}function vT(ut,o){function _($,_e){$.opacity.value=_e.opacity,_e.color&&$.diffuse.value.copy(_e.color),_e.emissive&&$.emissive.value.copy(_e.emissive).multiplyScalar(_e.emissiveIntensity),_e.map&&($.map.value=_e.map),_e.alphaMap&&($.alphaMap.value=_e.alphaMap),_e.bumpMap&&($.bumpMap.value=_e.bumpMap,$.bumpScale.value=_e.bumpScale,_e.side===Ft&&($.bumpScale.value*=-1)),_e.displacementMap&&($.displacementMap.value=_e.displacementMap,$.displacementScale.value=_e.displacementScale,$.displacementBias.value=_e.displacementBias),_e.emissiveMap&&($.emissiveMap.value=_e.emissiveMap),_e.normalMap&&($.normalMap.value=_e.normalMap,$.normalScale.value.copy(_e.normalScale),_e.side===Ft&&$.normalScale.value.negate()),_e.specularMap&&($.specularMap.value=_e.specularMap),_e.alphaTest>0&&($.alphaTest.value=_e.alphaTest);const it=o.get(_e).envMap;if(it){$.envMap.value=it;const mt=o.get(_e).environment||it;$.envMapRotation.value=mt?mt.rotation:0,$.flipEnvMap.value=it.isCubeTexture&&it.isRenderTargetTexture===!1?-1:1,$.reflectivity.value=_e.reflectivity,$.ior.value=_e.ior,$.refractionRatio.value=_e.refractionRatio}if(_e.lightMap){$.lightMap.value=_e.lightMap;const mt=ut.physicallyCorrectLights!==!0?Math.PI:1;$.lightMapIntensity.value=_e.lightMapIntensity*mt}let ot,ct;_e.aoMap&&($.aoMap.value=_e.aoMap,$.aoMapIntensity.value=_e.aoMapIntensity),_e.map?ot=_e.map:_e.specularMap?ot=_e.specularMap:_e.displacementMap?ot=_e.displacementMap:_e.normalMap?ot=_e.normalMap:_e.bumpMap?ot=_e.bumpMap:_e.roughnessMap?ot=_e.roughnessMap:_e.metalnessMap?ot=_e.metalnessMap:_e.alphaMap?ot=_e.alphaMap:_e.emissiveMap?ot=_e.emissiveMap:_e.clearcoatMap?ot=_e.clearcoatMap:_e.clearcoatNormalMap?ot=_e.clearcoatNormalMap:_e.clearcoatRoughnessMap?ot=_e.clearcoatRoughnessMap:_e.iridescenceMap?ot=_e.iridescenceMap:_e.iridescenceThicknessMap?ot=_e.iridescenceThicknessMap:_e.specularIntensityMap?ot=_e.specularIntensityMap:_e.specularColorMap?ot=_e.specularColorMap:_e.transmissionMap?ot=_e.transmissionMap:_e.thicknessMap?ot=_e.thicknessMap:_e.sheenColorMap?ot=_e.sheenColorMap:_e.sheenRoughnessMap&&(ot=_e.sheenRoughnessMap),ot!==void 0&&(ot.isWebGLRenderTarget&&(ot=ot.texture),ot.matrixAutoUpdate===!0&&ot.updateMatrix(),$.uvTransform.value.copy(ot.matrix)),_e.aoMap?ct=_e.aoMap:_e.lightMap&&(ct=_e.lightMap),ct!==void 0&&(ct.isWebGLRenderTarget&&(ct=ct.texture),ct.matrixAutoUpdate===!0&&ct.updateMatrix(),$.uv2Transform.value.copy(ct.matrix))}return{refreshFogUniforms:function($,_e){$.fogColor.value.copy(_e.color),_e.isFog?($.fogNear.value=_e.near,$.fogFar.value=_e.far):_e.isFogExp2&&($.fogDensity.value=_e.density)},refreshMaterialUniforms:function($,_e,it,ot,ct){_e.isMeshBasicMaterial||_e.isMeshLambertMaterial?_($,_e):_e.isMeshToonMaterial?(_($,_e),function(mt,gt){gt.gradientMap&&(mt.gradientMap.value=gt.gradientMap)}($,_e)):_e.isMeshPhongMaterial?(_($,_e),function(mt,gt){mt.specular.value.copy(gt.specular),mt.shininess.value=Math.max(gt.shininess,1e-4)}($,_e)):_e.isMeshStandardMaterial?(_($,_e),function(mt,gt){mt.roughness.value=gt.roughness,mt.metalness.value=gt.metalness,gt.roughnessMap&&(mt.roughnessMap.value=gt.roughnessMap),gt.metalnessMap&&(mt.metalnessMap.value=gt.metalnessMap),o.get(gt).envMap&&(mt.envMapIntensity.value=gt.envMapIntensity)}($,_e),_e.isMeshPhysicalMaterial&&function(mt,gt,St){mt.ior.value=gt.ior,gt.sheen>0&&(mt.sheenColor.value.copy(gt.sheenColor).multiplyScalar(gt.sheen),mt.sheenRoughness.value=gt.sheenRoughness,gt.sheenColorMap&&(mt.sheenColorMap.value=gt.sheenColorMap),gt.sheenRoughnessMap&&(mt.sheenRoughnessMap.value=gt.sheenRoughnessMap)),gt.clearcoat>0&&(mt.clearcoat.value=gt.clearcoat,mt.clearcoatRoughness.value=gt.clearcoatRoughness,gt.clearcoatMap&&(mt.clearcoatMap.value=gt.clearcoatMap),gt.clearcoatRoughnessMap&&(mt.clearcoatRoughnessMap.value=gt.clearcoatRoughnessMap),gt.clearcoatNormalMap&&(mt.clearcoatNormalScale.value.copy(gt.clearcoatNormalScale),mt.clearcoatNormalMap.value=gt.clearcoatNormalMap,gt.side===Ft&&mt.clearcoatNormalScale.value.negate())),gt.iridescence>0&&(mt.iridescence.value=gt.iridescence,mt.iridescenceIOR.value=gt.iridescenceIOR,mt.iridescenceThicknessMinimum.value=gt.iridescenceThicknessRange[0],mt.iridescenceThicknessMaximum.value=gt.iridescenceThicknessRange[1],gt.iridescenceMap&&(mt.iridescenceMap.value=gt.iridescenceMap),gt.iridescenceThicknessMap&&(mt.iridescenceThicknessMap.value=gt.iridescenceThicknessMap)),gt.transmission>0&&(mt.transmission.value=gt.transmission,mt.transmissionSamplerMap.value=St.texture,mt.transmissionSamplerSize.value.set(St.width,St.height),gt.transmissionMap&&(mt.transmissionMap.value=gt.transmissionMap),mt.thickness.value=gt.thickness,gt.thicknessMap&&(mt.thicknessMap.value=gt.thicknessMap),mt.attenuationDistance.value=gt.attenuationDistance,mt.attenuationColor.value.copy(gt.attenuationColor)),mt.specularIntensity.value=gt.specularIntensity,mt.specularColor.value.copy(gt.specularColor),gt.specularIntensityMap&&(mt.specularIntensityMap.value=gt.specularIntensityMap),gt.specularColorMap&&(mt.specularColorMap.value=gt.specularColorMap)}($,_e,ct)):_e.isMeshMatcapMaterial?(_($,_e),function(mt,gt){gt.matcap&&(mt.matcap.value=gt.matcap)}($,_e)):_e.isMeshDepthMaterial?_($,_e):_e.isMeshDistanceMaterial?(_($,_e),function(mt,gt){mt.referencePosition.value.copy(gt.referencePosition),mt.nearDistance.value=gt.nearDistance,mt.farDistance.value=gt.farDistance}($,_e)):_e.isMeshNormalMaterial?_($,_e):_e.isLineBasicMaterial?(function(mt,gt){mt.diffuse.value.copy(gt.color),mt.opacity.value=gt.opacity}($,_e),_e.isLineDashedMaterial&&function(mt,gt){mt.dashSize.value=gt.dashSize,mt.totalSize.value=gt.dashSize+gt.gapSize,mt.scale.value=gt.scale}($,_e)):_e.isPointsMaterial?function(mt,gt,St,Tt){let Ct;mt.diffuse.value.copy(gt.color),mt.opacity.value=gt.opacity,mt.size.value=gt.size*St,mt.scale.value=.5*Tt,gt.map&&(mt.map.value=gt.map),gt.alphaMap&&(mt.alphaMap.value=gt.alphaMap),gt.alphaTest>0&&(mt.alphaTest.value=gt.alphaTest),gt.map?Ct=gt.map:gt.alphaMap&&(Ct=gt.alphaMap),Ct!==void 0&&(Ct.matrixAutoUpdate===!0&&Ct.updateMatrix(),mt.uvTransform.value.copy(Ct.matrix))}($,_e,it,ot):_e.isSpriteMaterial?function(mt,gt){let St;mt.diffuse.value.copy(gt.color),mt.opacity.value=gt.opacity,mt.rotation.value=gt.rotation,gt.map&&(mt.map.value=gt.map),gt.alphaMap&&(mt.alphaMap.value=gt.alphaMap),gt.alphaTest>0&&(mt.alphaTest.value=gt.alphaTest),gt.map?St=gt.map:gt.alphaMap&&(St=gt.alphaMap),St!==void 0&&(St.matrixAutoUpdate===!0&&St.updateMatrix(),mt.uvTransform.value.copy(St.matrix))}($,_e):_e.isShadowMaterial?($.color.value.copy(_e.color),$.opacity.value=_e.opacity):_e.isShaderMaterial&&(_e.transmission!==void 0&&($.transmission&&($.transmission.value=_e.transmission),$.transmissionSamplerMap&&ct&&($.transmissionSamplerMap.value=ct?ct.texture:null),$.transmissionSamplerSize&&ct&&$.transmissionSamplerSize.value.set(ct.width,ct.height)),_e.uniformsNeedUpdate=!1)}}}function _T(ut,o,_,$){let _e={},it={},ot=[];const ct=_.isWebGL2?ut.getParameter(35375):0;function mt(Tt,Ct,Pt){const Ot=Tt.value;if(Pt[Ct]===void 0)return Pt[Ct]=typeof Ot=="number"?Ot:Ot.clone(),!0;if(typeof Ot=="number"){if(Pt[Ct]!==Ot)return Pt[Ct]=Ot,!0}else{const Dt=Pt[Ct];if(Dt.equals(Ot)===!1)return Dt.copy(Ot),!0}return!1}function gt(Tt){const Ct=Tt.value,Pt={boundary:0,storage:0};return typeof Ct=="number"?(Pt.boundary=4,Pt.storage=4):Ct.isVector2?(Pt.boundary=8,Pt.storage=8):Ct.isVector3||Ct.isColor?(Pt.boundary=16,Pt.storage=12):Ct.isVector4?(Pt.boundary=16,Pt.storage=16):Ct.isMatrix3?(Pt.boundary=48,Pt.storage=48):Ct.isMatrix4?(Pt.boundary=64,Pt.storage=64):Ct.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",Ct),Pt}function St(Tt){const Ct=Tt.target;Ct.removeEventListener("dispose",St);const Pt=ot.indexOf(Ct.__bindingPointIndex);ot.splice(Pt,1),ut.deleteBuffer(_e[Ct.id]),delete _e[Ct.id],delete it[Ct.id]}return{bind:function(Tt,Ct){const Pt=Ct.program;$.uniformBlockBinding(Tt,Pt)},update:function(Tt,Ct){let Pt=_e[Tt.id];Pt===void 0&&(function(Yt){const Xt=Yt.uniforms;let Jt=0,an=0;for(let fn=0,gn=Xt.length;fn<gn;fn++){const _n=Xt[fn],On=gt(_n);if(_n.__data=new Float32Array(On.storage/Float32Array.BYTES_PER_ELEMENT),_n.__offset=Jt,fn>0){an=Jt%16;const Ln=16-an;an!==0&&Ln-On.boundary<0&&(Jt+=16-an,_n.__offset=Jt)}Jt+=On.storage}an=Jt%16,an>0&&(Jt+=16-an),Yt.__size=Jt,Yt.__cache={}}(Tt),Pt=function(Yt){const Xt=function(){for(let gn=0;gn<ct;gn++)if(ot.indexOf(gn)===-1)return ot.push(gn),gn;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();Yt.__bindingPointIndex=Xt;const Jt=ut.createBuffer(),an=Yt.__size,fn=Yt.usage;return ut.bindBuffer(35345,Jt),ut.bufferData(35345,an,fn),ut.bindBuffer(35345,null),ut.bindBufferBase(35345,Xt,Jt),Jt}(Tt),_e[Tt.id]=Pt,Tt.addEventListener("dispose",St));const Ot=Ct.program;$.updateUBOMapping(Tt,Ot);const Dt=o.render.frame;it[Tt.id]!==Dt&&(function(Yt){const Xt=_e[Yt.id],Jt=Yt.uniforms,an=Yt.__cache;ut.bindBuffer(35345,Xt);for(let fn=0,gn=Jt.length;fn<gn;fn++){const _n=Jt[fn];if(mt(_n,fn,an)===!0){const On=_n.value,Ln=_n.__offset;typeof On=="number"?(_n.__data[0]=On,ut.bufferSubData(35345,Ln,_n.__data)):(_n.value.isMatrix3?(_n.__data[0]=_n.value.elements[0],_n.__data[1]=_n.value.elements[1],_n.__data[2]=_n.value.elements[2],_n.__data[3]=_n.value.elements[0],_n.__data[4]=_n.value.elements[3],_n.__data[5]=_n.value.elements[4],_n.__data[6]=_n.value.elements[5],_n.__data[7]=_n.value.elements[0],_n.__data[8]=_n.value.elements[6],_n.__data[9]=_n.value.elements[7],_n.__data[10]=_n.value.elements[8],_n.__data[11]=_n.value.elements[0]):On.toArray(_n.__data),ut.bufferSubData(35345,Ln,_n.__data))}}ut.bindBuffer(35345,null)}(Tt),it[Tt.id]=Dt)},dispose:function(){for(const Tt in _e)ut.deleteBuffer(_e[Tt]);ot=[],_e={},it={}}}}function ou(ut={}){this.isWebGLRenderer=!0;const o=ut.canvas!==void 0?ut.canvas:function(){const Mn=k_("canvas");return Mn.style.display="block",Mn}(),_=ut.context!==void 0?ut.context:null,$=ut.depth===void 0||ut.depth,_e=ut.stencil===void 0||ut.stencil,it=ut.antialias!==void 0&&ut.antialias,ot=ut.premultipliedAlpha===void 0||ut.premultipliedAlpha,ct=ut.preserveDrawingBuffer!==void 0&&ut.preserveDrawingBuffer,mt=ut.powerPreference!==void 0?ut.powerPreference:"default",gt=ut.failIfMajorPerformanceCaveat!==void 0&&ut.failIfMajorPerformanceCaveat;let St;St=_!==null?_.getContextAttributes().alpha:ut.alpha!==void 0&&ut.alpha;let Tt=null,Ct=null;const Pt=[],Ot=[];this.domElement=o,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Am,this.physicallyCorrectLights=!1,this.toneMapping=ws,this.toneMappingExposure=1,this.userData={},Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});const Dt=this;let Yt=!1,Xt=0,Jt=0,an=null,fn=-1,gn=null;const _n=new Fo,On=new Fo;let Ln=null,$n=o.width,Jn=o.height,Un=1,Er=null,Or=null;const xr=new Fo(0,0,$n,Jn),Gr=new Fo(0,0,$n,Jn);let Hr=!1;const pr=new zw;let vr=!1,jr=!1,Sr=null;const Qr=new Us,As=new Rr,go=new An,bs={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function lo(){return an===null?Un:1}let Pn,Sn,ir,Xn,Dn,Hn,mr,ln,gr,tr,br,Tr,$r,Es,Os,ro,Ps,Ns,Yo,Rm,Zs,na,ga,jE,ns=_;function uI(Mn,yr){for(let Pr=0;Pr<Mn.length;Pr++){const Mr=Mn[Pr],zr=o.getContext(Mr,yr);if(zr!==null)return zr}return null}try{const Mn={alpha:!0,depth:$,stencil:_e,antialias:it,premultipliedAlpha:ot,preserveDrawingBuffer:ct,powerPreference:mt,failIfMajorPerformanceCaveat:gt};if("setAttribute"in o&&o.setAttribute("data-engine",`three.js r${d}`),o.addEventListener("webglcontextlost",HC,!1),o.addEventListener("webglcontextrestored",dI,!1),o.addEventListener("webglcontextcreationerror",WC,!1),ns===null){const yr=["webgl2","webgl","experimental-webgl"];if(Dt.isWebGL1Renderer===!0&&yr.shift(),ns=uI(yr,Mn),ns===null)throw uI(yr)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}ns.getShaderPrecisionFormat===void 0&&(ns.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Mn){throw console.error("THREE.WebGLRenderer: "+Mn.message),Mn}function hI(){Pn=new Kr(ns),Sn=new LM(ns,Pn,ut),Pn.init(Sn),na=new G1(ns,Pn,Sn),ir=new JS(ns,Pn,Sn),Xn=new wv,Dn=new uT,Hn=new ZS(ns,Pn,ir,Dn,Sn,na,Xn),mr=new lP(Dt),ln=new UM(Dt),gr=new FA(ns,Sn),ga=new oP(ns,Pn,gr,Sn),tr=new Js(ns,gr,Xn,ga),br=new ba(ns,tr,gr,Xn),Yo=new jM(ns,Sn,Hn),ro=new aP(Dn),Tr=new pP(Dt,mr,ln,Pn,Sn,ga,ro),$r=new vT(Dt,Dn),Es=new KS,Os=new fT(Pn,Sn),Ns=new sP(Dt,mr,ir,br,St,ot),Ps=new mT(Dt,br,Sn),jE=new _T(ns,Xn,Sn,ir),Rm=new OM(ns,Pn,Xn,Sn),Zs=new UA(ns,Pn,Xn,Sn),Xn.programs=Tr.programs,Dt.capabilities=Sn,Dt.extensions=Pn,Dt.properties=Dn,Dt.renderLists=Es,Dt.shadowMap=Ps,Dt.state=ir,Dt.info=Xn,Dt.background=Ns,Dt.cubeuvmaps=ln}hI();const zp=new Jw(Dt,ns);function HC(Mn){Mn.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),Yt=!0}function dI(){console.log("THREE.WebGLRenderer: Context Restored."),Yt=!1;const Mn=Xn.autoReset,yr=Ps.enabled,Pr=Ps.autoUpdate,Mr=Ps.needsUpdate,zr=Ps.type;hI(),Xn.autoReset=Mn,Ps.enabled=yr,Ps.autoUpdate=Pr,Ps.needsUpdate=Mr,Ps.type=zr}function WC(Mn){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Mn.statusMessage)}function bo(Mn){const yr=Mn.target;yr.removeEventListener("dispose",bo),function(Pr){(function(Mr){const zr=Dn.get(Mr).programs;zr!==void 0&&(zr.forEach(function(fs){Tr.releaseProgram(fs)}),Mr.isShaderMaterial&&Tr.releaseShaderCache(Mr))})(Pr),Dn.remove(Pr)}(yr)}this.xr=zp,this.getContext=function(){return ns},this.getContextAttributes=function(){return ns.getContextAttributes()},this.forceContextLoss=function(){const Mn=Pn.get("WEBGL_lose_context");Mn&&Mn.loseContext()},this.forceContextRestore=function(){const Mn=Pn.get("WEBGL_lose_context");Mn&&Mn.restoreContext()},this.getPixelRatio=function(){return Un},this.setPixelRatio=function(Mn){Mn!==void 0&&(Un=Mn,this.setSize($n,Jn,!1))},this.getSize=function(Mn){return Mn.set($n,Jn)},this.setSize=function(Mn,yr,Pr){zp.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):($n=Mn,Jn=yr,o.width=Math.floor(Mn*Un),o.height=Math.floor(yr*Un),Pr!==!1&&(o.style.width=Mn+"px",o.style.height=yr+"px"),this.setViewport(0,0,Mn,yr))},this.getDrawingBufferSize=function(Mn){return Mn.set($n*Un,Jn*Un).floor()},this.setDrawingBufferSize=function(Mn,yr,Pr){$n=Mn,Jn=yr,Un=Pr,o.width=Math.floor(Mn*Pr),o.height=Math.floor(yr*Pr),this.setViewport(0,0,Mn,yr)},this.getCurrentViewport=function(Mn){return Mn.copy(_n)},this.getViewport=function(Mn){return Mn.copy(xr)},this.setViewport=function(Mn,yr,Pr,Mr){Mn.isVector4?xr.set(Mn.x,Mn.y,Mn.z,Mn.w):xr.set(Mn,yr,Pr,Mr),ir.viewport(_n.copy(xr).multiplyScalar(Un).floor())},this.getScissor=function(Mn){return Mn.copy(Gr)},this.setScissor=function(Mn,yr,Pr,Mr){Mn.isVector4?Gr.set(Mn.x,Mn.y,Mn.z,Mn.w):Gr.set(Mn,yr,Pr,Mr),ir.scissor(On.copy(Gr).multiplyScalar(Un).floor())},this.getScissorTest=function(){return Hr},this.setScissorTest=function(Mn){ir.setScissorTest(Hr=Mn)},this.setOpaqueSort=function(Mn){Er=Mn},this.setTransparentSort=function(Mn){Or=Mn},this.getClearColor=function(Mn){return Mn.copy(Ns.getClearColor())},this.setClearColor=function(){Ns.setClearColor.apply(Ns,arguments)},this.getClearAlpha=function(){return Ns.getClearAlpha()},this.setClearAlpha=function(){Ns.setClearAlpha.apply(Ns,arguments)},this.clear=function(Mn=!0,yr=!0,Pr=!0){let Mr=0;Mn&&(Mr|=16384),yr&&(Mr|=256),Pr&&(Mr|=1024),ns.clear(Mr)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){o.removeEventListener("webglcontextlost",HC,!1),o.removeEventListener("webglcontextrestored",dI,!1),o.removeEventListener("webglcontextcreationerror",WC,!1),Es.dispose(),Os.dispose(),Dn.dispose(),mr.dispose(),ln.dispose(),br.dispose(),ga.dispose(),jE.dispose(),Tr.dispose(),zp.dispose(),zp.removeEventListener("sessionstart",Vp),zp.removeEventListener("sessionend",pI),Sr&&(Sr.dispose(),Sr=null),eA.stop()},this.renderBufferDirect=function(Mn,yr,Pr,Mr,zr,fs){yr===null&&(yr=bs);const Do=zr.isMesh&&zr.matrixWorld.determinant()<0,Bs=function(fp,Hx,kv,qs,ip){Hx.isScene!==!0&&(Hx=bs),Hn.resetTextureUnits();const GE=Hx.fog,KC=qs.isMeshStandardMaterial?Hx.environment:null,gI=an===null?Dt.outputEncoding:an.isXRRenderTarget===!0||an.texture.encoding&&an.texture.encoding!==mo?an.texture.encoding:Am,Wx=(qs.isMeshStandardMaterial?ln:mr).get(qs.envMap||KC),nv=qs.vertexColors===!0&&!!kv.attributes.color&&kv.attributes.color.itemSize===4,xP=!!qs.normalMap&&!!kv.attributes.tangent,vI=!!kv.morphAttributes.position,$C=!!kv.morphAttributes.normal,bP=!!kv.morphAttributes.color,EP=qs.toneMapped?Dt.toneMapping:ws,HE=kv.morphAttributes.position||kv.morphAttributes.normal||kv.morphAttributes.color,SP=HE!==void 0?HE.length:0,$a=Dn.get(qs),_I=Ct.state.lights;if(vr===!0&&(jr===!0||fp!==gn)){const Gp=fp===gn&&qs.id===fn;ro.setState(qs,fp,Gp)}let p_=!1;qs.version===$a.__version?$a.needsLights&&$a.lightsStateVersion!==_I.state.version||$a.outputEncoding!==gI||ip.isInstancedMesh&&$a.instancing===!1?p_=!0:ip.isInstancedMesh||$a.instancing!==!0?ip.isSkinnedMesh&&$a.skinning===!1?p_=!0:ip.isSkinnedMesh||$a.skinning!==!0?$a.envMap!==Wx||qs.fog===!0&&$a.fog!==GE?p_=!0:$a.numClippingPlanes===void 0||$a.numClippingPlanes===ro.numPlanes&&$a.numIntersection===ro.numIntersection?($a.vertexAlphas!==nv||$a.vertexTangents!==xP||$a.morphTargets!==vI||$a.morphNormals!==$C||$a.morphColors!==bP||$a.toneMapping!==EP||Sn.isWebGL2===!0&&$a.morphTargetsCount!==SP)&&(p_=!0):p_=!0:p_=!0:p_=!0:(p_=!0,$a.__version=qs.version);let f_=$a.currentProgram;p_===!0&&(f_=Vx(qs,Hx,ip));let WE=!1,tA=!1,Qp=!1;const mp=f_.getUniforms(),Bv=$a.uniforms;if(ir.useProgram(f_.program)&&(WE=!0,tA=!0,Qp=!0),qs.id!==fn&&(fn=qs.id,tA=!0),WE||gn!==fp){if(mp.setValue(ns,"projectionMatrix",fp.projectionMatrix),Sn.logarithmicDepthBuffer&&mp.setValue(ns,"logDepthBufFC",2/(Math.log(fp.far+1)/Math.LN2)),gn!==fp&&(gn=fp,tA=!0,Qp=!0),qs.isShaderMaterial||qs.isMeshPhongMaterial||qs.isMeshToonMaterial||qs.isMeshStandardMaterial||qs.envMap){const Gp=mp.map.cameraPosition;Gp!==void 0&&Gp.setValue(ns,go.setFromMatrixPosition(fp.matrixWorld))}(qs.isMeshPhongMaterial||qs.isMeshToonMaterial||qs.isMeshLambertMaterial||qs.isMeshBasicMaterial||qs.isMeshStandardMaterial||qs.isShaderMaterial)&&mp.setValue(ns,"isOrthographic",fp.isOrthographicCamera===!0),(qs.isMeshPhongMaterial||qs.isMeshToonMaterial||qs.isMeshLambertMaterial||qs.isMeshBasicMaterial||qs.isMeshStandardMaterial||qs.isShaderMaterial||qs.isShadowMaterial||ip.isSkinnedMesh)&&mp.setValue(ns,"viewMatrix",fp.matrixWorldInverse)}if(ip.isSkinnedMesh){mp.setOptional(ns,ip,"bindMatrix"),mp.setOptional(ns,ip,"bindMatrixInverse");const Gp=ip.skeleton;Gp&&(Sn.floatVertexTextures?(Gp.boneTexture===null&&Gp.computeBoneTexture(),mp.setValue(ns,"boneTexture",Gp.boneTexture,Hn),mp.setValue(ns,"boneTextureSize",Gp.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const qE=kv.morphAttributes;var rv,iv;(qE.position!==void 0||qE.normal!==void 0||qE.color!==void 0&&Sn.isWebGL2===!0)&&Yo.update(ip,kv,qs,f_),(tA||$a.receiveShadow!==ip.receiveShadow)&&($a.receiveShadow=ip.receiveShadow,mp.setValue(ns,"receiveShadow",ip.receiveShadow)),qs.isMeshGouraudMaterial&&qs.envMap!==null&&(Bv.envMap.value=Wx,Bv.flipEnvMap.value=Wx.isCubeTexture&&Wx.isRenderTargetTexture===!1?-1:1),tA&&(mp.setValue(ns,"toneMappingExposure",Dt.toneMappingExposure),$a.needsLights&&(iv=Qp,(rv=Bv).ambientLightColor.needsUpdate=iv,rv.lightProbe.needsUpdate=iv,rv.directionalLights.needsUpdate=iv,rv.directionalLightShadows.needsUpdate=iv,rv.pointLights.needsUpdate=iv,rv.pointLightShadows.needsUpdate=iv,rv.spotLights.needsUpdate=iv,rv.spotLightShadows.needsUpdate=iv,rv.rectAreaLights.needsUpdate=iv,rv.hemisphereLights.needsUpdate=iv),GE&&qs.fog===!0&&$r.refreshFogUniforms(Bv,GE),$r.refreshMaterialUniforms(Bv,qs,Un,Jn,Dt.userData.transmissionRenderTarget||Sr),F1.upload(ns,$a.uniformsList,Bv,Hn)),qs.isShaderMaterial&&qs.uniformsNeedUpdate===!0&&(F1.upload(ns,$a.uniformsList,Bv,Hn),qs.uniformsNeedUpdate=!1),qs.isSpriteMaterial&&mp.setValue(ns,"center",ip.center),mp.setValue(ns,"modelViewMatrix",ip.modelViewMatrix),mp.setValue(ns,"normalMatrix",ip.normalMatrix),mp.setValue(ns,"modelMatrix",ip.matrixWorld);const JC=qs.extraUniformsToUpload;if(JC&&Object.entries(JC).forEach(([Gp,qx])=>mp.setValue(ns,Gp,qx.value,Hn)),qs.isShaderMaterial||qs.isRawShaderMaterial){const Gp=qs.uniformsGroups;for(let qx=0,CP=Gp.length;qx<CP;qx++)if(Sn.isWebGL2){const yI=Gp[qx];jE.update(yI,f_),jE.bind(yI,f_)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return f_}(Mn,yr,Pr,Mr,zr);ir.setMaterial(Mr,Do);let vo=Pr.index;const Kl=Pr.attributes.position;if(vo===null){if(Kl===void 0||Kl.count===0)return}else if(vo.count===0)return;let Ro,ho=1;Mr.wireframe===!0&&(vo=tr.getWireframeAttribute(Pr),ho=2),ga.setup(zr,Mr,Bs,Pr,vo);let Mu=Rm;vo!==null&&(Ro=gr.get(vo),Mu=Zs,Mu.setIndex(Ro));const Qx=vo!==null?vo.count:Kl.count,tv=Pr.drawRange.start*ho,VE=Pr.drawRange.count*ho,d_=fs!==null?fs.start*ho:0,YC=fs!==null?fs.count*ho:1/0,QE=Math.max(tv,d_),XC=Math.min(Qx,tv+VE,d_+YC)-1,Gx=Math.max(0,XC-QE+1);if(Gx!==0){if(zr.isMesh)Mr.wireframe===!0?(ir.setLineWidth(Mr.wireframeLinewidth*lo()),Mu.setMode(1)):Mu.setMode(4);else if(zr.isLine){let fp=Mr.linewidth;fp===void 0&&(fp=1),ir.setLineWidth(fp*lo()),zr.isLineSegments?Mu.setMode(1):zr.isLineLoop?Mu.setMode(2):Mu.setMode(3)}else zr.isPoints?Mu.setMode(0):zr.isSprite&&Mu.setMode(4);if(zr.isInstancedMesh)Mu.renderInstances(QE,Gx,zr.count);else if(Pr.isInstancedBufferGeometry){const fp=Math.min(Pr.instanceCount,Pr._maxInstanceCount);Mu.renderInstances(QE,Gx,fp)}else Mu.render(QE,Gx)}},this.compile=function(Mn,yr){function Pr(Mr,zr,fs){Mr.transparent===!0&&Mr.side===nn?(Mr.side=Ft,Mr.needsUpdate=!0,Vx(Mr,zr,fs),Mr.side=Kt,Mr.needsUpdate=!0,Vx(Mr,zr,fs),Mr.side=nn):Vx(Mr,zr,fs)}Ct=Os.get(Mn),Ct.init(),Ot.push(Ct),Mn.traverseVisible(function(Mr){Mr.isLight&&Mr.layers.test(yr.layers)&&(Ct.pushLight(Mr),Mr.castShadow&&Ct.pushShadow(Mr))}),Ct.setupLights(Dt.physicallyCorrectLights),Mn.traverse(function(Mr){const zr=Mr.material;if(zr)if(Array.isArray(zr))for(let fs=0;fs<zr.length;fs++)Pr(zr[fs],Mn,Mr);else Pr(zr,Mn,Mr)}),Ot.pop(),Ct=null};let uu=null;function Vp(){eA.stop()}function pI(){eA.start()}const eA=new Q_;function fI(Mn,yr,Pr,Mr){if(Mn.visible===!1)return;if(Mn.layers.test(yr.layers)){if(Mn.isGroup)Pr=Mn.renderOrder;else if(Mn.isLOD)Mn.autoUpdate===!0&&Mn.update(yr);else if(Mn.isLight)Ct.pushLight(Mn),Mn.castShadow&&Ct.pushShadow(Mn);else if(Mn.isSprite){if(!Mn.frustumCulled||pr.intersectsSprite(Mn)){Mr&&go.setFromMatrixPosition(Mn.matrixWorld).applyMatrix4(Qr);const fs=br.update(Mn),Do=Mn.material;Do.visible&&Tt.push(Mn,fs,Do,Pr,go.z,null)}}else if((Mn.isMesh||Mn.isLine||Mn.isPoints)&&(Mn.isSkinnedMesh&&Mn.skeleton.frame!==Xn.render.frame&&(Mn.skeleton.update(),Mn.skeleton.frame=Xn.render.frame),!Mn.frustumCulled||pr.intersectsObject(Mn))){Mr&&go.setFromMatrixPosition(Mn.matrixWorld).applyMatrix4(Qr);const fs=br.update(Mn),Do=Mn.material;if(Array.isArray(Do)){const Bs=fs.groups;for(let vo=0,Kl=Bs.length;vo<Kl;vo++){const Ro=Bs[vo],ho=Do[Ro.materialIndex];ho&&ho.visible&&Tt.push(Mn,fs,ho,Pr,go.z,Ro)}}else Do.visible&&Tt.push(Mn,fs,Do,Pr,go.z,null)}}const zr=Mn.children;for(let fs=0,Do=zr.length;fs<Do;fs++)fI(zr[fs],yr,Pr,Mr)}function mI(Mn,yr,Pr,Mr){const zr=Mn.opaque,fs=Mn.transmissive,Do=Mn.transparent;if(Ct.setupLightsView(Pr),Dt.userData.transmissionRender===void 0&&Dt.userData.renderTransmissionPass!==!1&&fs.length>0&&function(Bs,vo,Kl){console.error("three.js internal render transmission pass should not be called");const Ro=Sn.isWebGL2;Sr===null&&(Sr=new xp(1,1,{generateMipmaps:!0,type:Pn.has("EXT_color_buffer_half_float")?pu:Gs,minFilter:oo,samples:Ro&&it===!0?4:0})),Dt.getDrawingBufferSize(As),Ro?Sr.setSize(As.x,As.y):Sr.setSize(lp(As.x),lp(As.y));const ho=Dt.getRenderTarget();Dt.setRenderTarget(Sr),Dt.clear();const Mu=Dt.toneMapping;Dt.toneMapping=ws,zE(Bs,vo,Kl),Dt.toneMapping=Mu,Hn.updateMultisampleRenderTarget(Sr),Hn.updateRenderTargetMipmap(Sr),Dt.setRenderTarget(ho)}([...zr,...Do],yr,Pr),Mr&&ir.viewport(_n.copy(Mr)),Dt.userData.opaqueRender!==!1&&zr.length>0&&zE(zr,yr,Pr),Dt.userData.transparentRender!==!1&&Do.length>0&&zE(Do,yr,Pr),Dt.userData.transmissionRender!==!1&&fs.length>0){Sr||(Sr=new xp(1,1));const Bs=Dt.userData.transmissionRenderTarget.texture,vo=Sn.isWebGL2,Kl=Bs.generateMipmaps,Ro=Bs.minFilter;vo&&Dt.userData.blurTransmissionTarget&&(Bs.generateMipmaps=!0,Bs.minFilter=oo,Bs.needsUpdate=!0,Hn.updateRenderTargetMipmap(Dt.userData.transmissionRenderTarget)),zE(fs,yr,Pr),vo&&Dt.userData.blurTransmissionTarget&&(Bs.generateMipmaps=Kl,Bs.minFilter=Ro,Bs.needsUpdate=!0,Hn.updateRenderTargetMipmap(Dt.userData.transmissionRenderTarget))}ir.buffers.depth.setTest(!0),ir.buffers.depth.setMask(!0),ir.buffers.color.setMask(!0),ir.setPolygonOffset(!1)}function zE(Mn,yr,Pr){const Mr={...Dt.userData};Dt.userData.opaqueRender=void 0,Dt.userData.transparentRender=void 0,Dt.userData.transmissionRender=void 0,Dt.userData.backgroundRender=void 0;const zr=yr.isScene===!0?yr.overrideMaterial:null;for(let fs=0,Do=Mn.length;fs<Do;fs++){const Bs=Mn[fs],vo=Bs.object,Kl=Bs.geometry,Ro=zr===null?Bs.material:zr,ho=Bs.group;vo.layers.test(Pr.layers)&&wP(vo,yr,Pr,Kl,Ro,ho)}Object.assign(Dt.userData,Mr)}function wP(Mn,yr,Pr,Mr,zr,fs){Mn.onBeforeRender(Dt,yr,Pr,Mr,zr,fs),Mn.modelViewMatrix.multiplyMatrices(Pr.matrixWorldInverse,Mn.matrixWorld),Mn.normalMatrix.getNormalMatrix(Mn.modelViewMatrix),zr.onBeforeRender(Dt,yr,Pr,Mr,Mn,fs),zr.transparent===!0&&zr.side===nn?(zr.side=Ft,zr.needsUpdate=!0,Dt.renderBufferDirect(Pr,yr,Mr,zr,Mn,fs),zr.side=Kt,zr.needsUpdate=!0,Dt.renderBufferDirect(Pr,yr,Mr,zr,Mn,fs),zr.side=nn):Dt.renderBufferDirect(Pr,yr,Mr,zr,Mn,fs),Mn.onAfterRender(Dt,yr,Pr,Mr,zr,fs),zr.onAfterRender(Dt,yr,Pr,Mr,Mn,fs)}function Vx(Mn,yr,Pr){yr.isScene!==!0&&(yr=bs);const Mr=Dn.get(Mn),zr=Ct.state.lights,fs=Ct.state.shadowsArray,Do=zr.state.version,Bs=Tr.getParameters(Mn,zr.state,fs,yr,Pr),vo=Tr.getProgramCacheKey(Bs);let Kl=Mr.programs;Mr.environment=Mn.isMeshStandardMaterial?yr.environment:null,Mr.fog=yr.fog,Mr.envMap=(Mn.isMeshStandardMaterial?ln:mr).get(Mn.envMap||Mr.environment),Kl===void 0&&(Mn.addEventListener("dispose",bo),Kl=new Map,Mr.programs=Kl);let Ro=Kl.get(vo);if(Ro!==void 0){if(Mr.currentProgram===Ro&&Mr.lightsStateVersion===Do)return qC(Mn,Bs),Ro}else Bs.uniforms=Tr.getUniforms(Mn),Mn.onBuild(Pr,Bs,Dt),Mn.onBeforeCompile(Bs,Dt),Ro=Tr.acquireProgram(Bs,vo),Kl.set(vo,Ro),Mr.uniforms=Bs.uniforms;const ho=Mr.uniforms;(Mn.isShaderMaterial||Mn.isRawShaderMaterial)&&Mn.clipping!==!0||(ho.clippingPlanes=ro.uniform),qC(Mn,Bs),Mr.needsLights=function(tv){return tv.isMeshLambertMaterial||tv.isMeshToonMaterial||tv.isMeshPhongMaterial||tv.isMeshStandardMaterial||tv.isShadowMaterial||tv.isShaderMaterial&&tv.lights===!0}(Mn),Mr.lightsStateVersion=Do,Mr.needsLights&&(ho.ambientLightColor.value=zr.state.ambient,ho.lightProbe.value=zr.state.probe,ho.directionalLights.value=zr.state.directional,ho.directionalLightShadows.value=zr.state.directionalShadow,ho.spotLights.value=zr.state.spot,ho.spotLightShadows.value=zr.state.spotShadow,ho.rectAreaLights.value=zr.state.rectArea,ho.ltc_1.value=zr.state.rectAreaLTC1,ho.ltc_2.value=zr.state.rectAreaLTC2,ho.pointLights.value=zr.state.point,ho.pointLightShadows.value=zr.state.pointShadow,ho.hemisphereLights.value=zr.state.hemi,ho.directionalShadowMap.value=zr.state.directionalShadowMap,ho.directionalShadowMatrix.value=zr.state.directionalShadowMatrix,ho.spotShadowMap.value=zr.state.spotShadowMap,ho.spotLightMatrix.value=zr.state.spotLightMatrix,ho.spotLightMap.value=zr.state.spotLightMap,ho.pointShadowMap.value=zr.state.pointShadowMap,ho.pointShadowMatrix.value=zr.state.pointShadowMatrix);const Mu=Ro.getUniforms(),Qx=F1.seqWithValue(Mu.seq,ho);return Mr.currentProgram=Ro,Mr.uniformsList=Qx,Ro}function qC(Mn,yr){const Pr=Dn.get(Mn);Pr.outputEncoding=yr.outputEncoding,Pr.instancing=yr.instancing,Pr.skinning=yr.skinning,Pr.morphTargets=yr.morphTargets,Pr.morphNormals=yr.morphNormals,Pr.morphColors=yr.morphColors,Pr.morphTargetsCount=yr.morphTargetsCount,Pr.numClippingPlanes=yr.numClippingPlanes,Pr.numIntersection=yr.numClipIntersection,Pr.vertexAlphas=yr.vertexAlphas,Pr.vertexTangents=yr.vertexTangents,Pr.toneMapping=yr.toneMapping}eA.setAnimationLoop(function(Mn){uu&&uu(Mn)}),typeof self<"u"&&eA.setContext(self),this.setAnimationLoop=function(Mn){uu=Mn,zp.setAnimationLoop(Mn),Mn===null?eA.stop():eA.start()},zp.addEventListener("sessionstart",Vp),zp.addEventListener("sessionend",pI),this.render=function(Mn,yr){if(yr===void 0||yr.isCamera===!0){if(Yt!==!0){if(Mn.matrixWorldAutoUpdate===!0&&Mn.updateMatrixWorld(),yr.parent===null&&yr.matrixWorldAutoUpdate===!0&&yr.updateMatrixWorld(),zp.enabled===!0&&zp.isPresenting===!0&&(zp.cameraAutoUpdate===!0&&zp.updateCamera(yr),yr=zp.getCamera()),Mn.isScene===!0&&Mn.onBeforeRender(Dt,Mn,yr,an),Ct=Os.get(Mn,Ot.length),Ct.init(),Ot.push(Ct),Qr.multiplyMatrices(yr.projectionMatrix,yr.matrixWorldInverse),pr.setFromProjectionMatrix(Qr),jr=this.localClippingEnabled,vr=ro.init(this.clippingPlanes,jr,yr),Tt=Es.get(Mn,Pt.length),Tt.init(),Pt.push(Tt),fI(Mn,yr,0,Dt.sortObjects),Tt.finish(),Dt.sortObjects===!0&&Tt.sort(Er,Or),Dt.userData.shadowMapRender){vr===!0&&ro.beginShadows();const Pr=Ct.state.shadowsArray;Pr.length>0&&Ps.render(Pr,Mn,yr),vr===!0&&ro.endShadows()}if(this.info.autoReset===!0&&this.info.reset(),Dt.userData.backgroundRender!==!1&&Ns.render(Tt,Mn),Dt.userData.sceneRender!==!1)if(Ct.setupLights(Dt.physicallyCorrectLights),yr.isArrayCamera){const Pr=yr.cameras;for(let Mr=0,zr=Pr.length;Mr<zr;Mr++){const fs=Pr[Mr];mI(Tt,Mn,fs,fs.viewport)}}else mI(Tt,Mn,yr);an!==null&&(Hn.updateMultisampleRenderTarget(an),Hn.updateRenderTargetMipmap(an)),Mn.isScene===!0&&Mn.onAfterRender(Dt,Mn,yr),ga.resetDefaultState(),fn=-1,gn=null,Ot.pop(),Ct=Ot.length>0?Ot[Ot.length-1]:null,Pt.pop(),Tt=Pt.length>0?Pt[Pt.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return Xt},this.getActiveMipmapLevel=function(){return Jt},this.getRenderTarget=function(){return an},this.setRenderTargetTextures=function(Mn,yr,Pr){Dn.get(Mn.texture).__webglTexture=yr,Dn.get(Mn.depthTexture).__webglTexture=Pr;const Mr=Dn.get(Mn);Mr.__hasExternalTextures=!0,Mr.__hasExternalTextures&&(Mr.__autoAllocateDepthBuffer=Pr===void 0,Mr.__autoAllocateDepthBuffer||Pn.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Mr.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(Mn,yr){const Pr=Dn.get(Mn);Pr.__webglFramebuffer=yr,Pr.__useDefaultFramebuffer=yr===void 0},this.setRenderTarget=function(Mn,yr=0,Pr=0){an=Mn,Xt=yr,Jt=Pr;let Mr=!0;if(Mn){const Bs=Dn.get(Mn);Bs.__useDefaultFramebuffer!==void 0?(ir.bindFramebuffer(36160,null),Mr=!1):Bs.__webglFramebuffer===void 0?Hn.setupRenderTarget(Mn):Bs.__hasExternalTextures&&Hn.rebindTextures(Mn,Dn.get(Mn.texture).__webglTexture,Dn.get(Mn.depthTexture).__webglTexture)}let zr=null,fs=!1,Do=!1;if(Mn){const Bs=Mn.texture;(Bs.isData3DTexture||Bs.isDataArrayTexture)&&(Do=!0);const vo=Dn.get(Mn).__webglFramebuffer;Mn.isWebGLCubeRenderTarget?(zr=vo[yr],fs=!0):zr=Sn.isWebGL2&&Mn.samples>0&&Hn.useMultisampledRTT(Mn)===!1?Dn.get(Mn).__webglMultisampledFramebuffer:vo,_n.copy(Mn.viewport),On.copy(Mn.scissor),Ln=Mn.scissorTest}else _n.copy(xr).multiplyScalar(Un).floor(),On.copy(Gr).multiplyScalar(Un).floor(),Ln=Hr;if(ir.bindFramebuffer(36160,zr)&&Sn.drawBuffers&&Mr&&ir.drawBuffers(Mn,zr),ir.viewport(_n),ir.scissor(On),ir.setScissorTest(Ln),fs){const Bs=Dn.get(Mn.texture);ns.framebufferTexture2D(36160,36064,34069+yr,Bs.__webglTexture,Pr)}else if(Do){const Bs=Dn.get(Mn.texture),vo=yr||0;ns.framebufferTextureLayer(36160,36064,Bs.__webglTexture,Pr||0,vo)}fn=-1},this.readRenderTargetPixels=function(Mn,yr,Pr,Mr,zr,fs,Do){if(!Mn||!Mn.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Bs=Dn.get(Mn).__webglFramebuffer;if(Mn.isWebGLCubeRenderTarget&&Do!==void 0&&(Bs=Bs[Do]),Bs){ir.bindFramebuffer(36160,Bs);try{const vo=Mn.texture,Kl=vo.format,Ro=vo.type;if(Kl!==Ls&&na.convert(Kl)!==ns.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const ho=Ro===pu&&(Pn.has("EXT_color_buffer_half_float")||Sn.isWebGL2&&Pn.has("EXT_color_buffer_float"));if(!(Ro===Gs||na.convert(Ro)===ns.getParameter(35738)||Ro===Pl&&(Sn.isWebGL2||Pn.has("OES_texture_float")||Pn.has("WEBGL_color_buffer_float"))||ho))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");yr>=0&&yr<=Mn.width-Mr&&Pr>=0&&Pr<=Mn.height-zr&&ns.readPixels(yr,Pr,Mr,zr,na.convert(Kl),na.convert(Ro),fs)}finally{const vo=an!==null?Dn.get(an).__webglFramebuffer:null;ir.bindFramebuffer(36160,vo)}}},this.copyFramebufferToTexture=function(Mn,yr,Pr=0){const Mr=Math.pow(2,-Pr),zr=Math.floor(yr.image.width*Mr),fs=Math.floor(yr.image.height*Mr);Hn.setTexture2D(yr,0),ns.copyTexSubImage2D(3553,Pr,0,0,Mn.x,Mn.y,zr,fs),ir.unbindTexture()},this.copyTextureToTexture=function(Mn,yr,Pr,Mr=0){const zr=yr.image.width,fs=yr.image.height,Do=na.convert(Pr.format),Bs=na.convert(Pr.type);Hn.setTexture2D(Pr,0),ns.pixelStorei(37440,Pr.flipY),ns.pixelStorei(37441,Pr.premultiplyAlpha),ns.pixelStorei(3317,Pr.unpackAlignment),yr.isDataTexture?ns.texSubImage2D(3553,Mr,Mn.x,Mn.y,zr,fs,Do,Bs,yr.image.data):yr.isCompressedTexture?ns.compressedTexSubImage2D(3553,Mr,Mn.x,Mn.y,yr.mipmaps[0].width,yr.mipmaps[0].height,Do,yr.mipmaps[0].data):ns.texSubImage2D(3553,Mr,Mn.x,Mn.y,Do,Bs,yr.image),Mr===0&&Pr.generateMipmaps&&ns.generateMipmap(3553),ir.unbindTexture()},this.copyTextureToTexture3D=function(Mn,yr,Pr,Mr,zr=0){if(Dt.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const fs=Mn.max.x-Mn.min.x+1,Do=Mn.max.y-Mn.min.y+1,Bs=Mn.max.z-Mn.min.z+1,vo=na.convert(Mr.format),Kl=na.convert(Mr.type);let Ro;if(Mr.isData3DTexture)Hn.setTexture3D(Mr,0),Ro=32879;else{if(!Mr.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Hn.setTexture2DArray(Mr,0),Ro=35866}ns.pixelStorei(37440,Mr.flipY),ns.pixelStorei(37441,Mr.premultiplyAlpha),ns.pixelStorei(3317,Mr.unpackAlignment);const ho=ns.getParameter(3314),Mu=ns.getParameter(32878),Qx=ns.getParameter(3316),tv=ns.getParameter(3315),VE=ns.getParameter(32877),d_=Pr.isCompressedTexture?Pr.mipmaps[0]:Pr.image;ns.pixelStorei(3314,d_.width),ns.pixelStorei(32878,d_.height),ns.pixelStorei(3316,Mn.min.x),ns.pixelStorei(3315,Mn.min.y),ns.pixelStorei(32877,Mn.min.z),Pr.isDataTexture||Pr.isData3DTexture?ns.texSubImage3D(Ro,zr,yr.x,yr.y,yr.z,fs,Do,Bs,vo,Kl,d_.data):Pr.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ns.compressedTexSubImage3D(Ro,zr,yr.x,yr.y,yr.z,fs,Do,Bs,vo,d_.data)):ns.texSubImage3D(Ro,zr,yr.x,yr.y,yr.z,fs,Do,Bs,vo,Kl,d_),ns.pixelStorei(3314,ho),ns.pixelStorei(32878,Mu),ns.pixelStorei(3316,Qx),ns.pixelStorei(3315,tv),ns.pixelStorei(32877,VE),zr===0&&Mr.generateMipmaps&&ns.generateMipmap(Ro),ir.unbindTexture()},this.initTexture=function(Mn){Mn.isCubeTexture?Hn.setTextureCube(Mn,0):Mn.isData3DTexture?Hn.setTexture3D(Mn,0):Mn.isDataArrayTexture?Hn.setTexture2DArray(Mn,0):Hn.setTexture2D(Mn,0),ir.unbindTexture()},this.resetState=function(){Xt=0,Jt=0,an=null,ir.reset(),ga.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class nC extends ou{}nC.prototype.isWebGL1Renderer=!0;class Q0{constructor(o,_=25e-5){this.isFogExp2=!0,this.name="",this.color=new is(o),this.density=_}clone(){return new Q0(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class QA{constructor(o,_=1,$=1e3){this.isFog=!0,this.name="",this.color=new is(o),this.near=_,this.far=$}clone(){return new QA(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class yT extends no{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(o,_){return super.copy(o,_),o.background!==null&&(this.background=o.background.clone()),o.environment!==null&&(this.environment=o.environment.clone()),o.fog!==null&&(this.fog=o.fog.clone()),o.overrideMaterial!==null&&(this.overrideMaterial=o.overrideMaterial.clone()),this.matrixAutoUpdate=o.matrixAutoUpdate,this}toJSON(o){const _=super.toJSON(o);return this.fog!==null&&(_.object.fog=this.fog.toJSON()),_}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(o){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=o}}class W1{constructor(o,_){this.isInterleavedBuffer=!0,this.array=o,this.stride=_,this.count=o!==void 0?o.length/_:0,this.usage=I_,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Ju()}onUploadCallback(){}set needsUpdate(o){o===!0&&this.version++}setUsage(o){return this.usage=o,this}copy(o){return this.array=new o.array.constructor(o.array),this.count=o.count,this.stride=o.stride,this.usage=o.usage,this}copyAt(o,_,$){o*=this.stride,$*=_.stride;for(let _e=0,it=this.stride;_e<it;_e++)this.array[o+_e]=_.array[$+_e];return this}set(o,_=0){return this.array.set(o,_),this}clone(o){o.arrayBuffers===void 0&&(o.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ju()),o.arrayBuffers[this.array.buffer._uuid]===void 0&&(o.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const _=new this.array.constructor(o.arrayBuffers[this.array.buffer._uuid]),$=new this.constructor(_,this.stride);return $.setUsage(this.usage),$}onUpload(o){return this.onUploadCallback=o,this}toJSON(o){return o.arrayBuffers===void 0&&(o.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ju()),o.arrayBuffers[this.array.buffer._uuid]===void 0&&(o.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Cp=new An;class r_{constructor(o,_,$,_e=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=o,this.itemSize=_,this.offset=$,this.normalized=_e===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(o){this.data.needsUpdate=o}applyMatrix4(o){for(let _=0,$=this.data.count;_<$;_++)Cp.fromBufferAttribute(this,_),Cp.applyMatrix4(o),this.setXYZ(_,Cp.x,Cp.y,Cp.z);return this}applyNormalMatrix(o){for(let _=0,$=this.count;_<$;_++)Cp.fromBufferAttribute(this,_),Cp.applyNormalMatrix(o),this.setXYZ(_,Cp.x,Cp.y,Cp.z);return this}transformDirection(o){for(let _=0,$=this.count;_<$;_++)Cp.fromBufferAttribute(this,_),Cp.transformDirection(o),this.setXYZ(_,Cp.x,Cp.y,Cp.z);return this}setX(o,_){return this.normalized&&(_=Zo(_,this.array)),this.data.array[o*this.data.stride+this.offset]=_,this}setY(o,_){return this.normalized&&(_=Zo(_,this.array)),this.data.array[o*this.data.stride+this.offset+1]=_,this}setZ(o,_){return this.normalized&&(_=Zo(_,this.array)),this.data.array[o*this.data.stride+this.offset+2]=_,this}setW(o,_){return this.normalized&&(_=Zo(_,this.array)),this.data.array[o*this.data.stride+this.offset+3]=_,this}getX(o){let _=this.data.array[o*this.data.stride+this.offset];return this.normalized&&(_=fv(_,this.array)),_}getY(o){let _=this.data.array[o*this.data.stride+this.offset+1];return this.normalized&&(_=fv(_,this.array)),_}getZ(o){let _=this.data.array[o*this.data.stride+this.offset+2];return this.normalized&&(_=fv(_,this.array)),_}getW(o){let _=this.data.array[o*this.data.stride+this.offset+3];return this.normalized&&(_=fv(_,this.array)),_}setXY(o,_,$){return o=o*this.data.stride+this.offset,this.normalized&&(_=Zo(_,this.array),$=Zo($,this.array)),this.data.array[o+0]=_,this.data.array[o+1]=$,this}setXYZ(o,_,$,_e){return o=o*this.data.stride+this.offset,this.normalized&&(_=Zo(_,this.array),$=Zo($,this.array),_e=Zo(_e,this.array)),this.data.array[o+0]=_,this.data.array[o+1]=$,this.data.array[o+2]=_e,this}setXYZW(o,_,$,_e,it){return o=o*this.data.stride+this.offset,this.normalized&&(_=Zo(_,this.array),$=Zo($,this.array),_e=Zo(_e,this.array),it=Zo(it,this.array)),this.data.array[o+0]=_,this.data.array[o+1]=$,this.data.array[o+2]=_e,this.data.array[o+3]=it,this}clone(o){if(o===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will deinterleave buffer data.");const _=[];for(let $=0;$<this.count;$++){const _e=$*this.data.stride+this.offset;for(let it=0;it<this.itemSize;it++)_.push(this.data.array[_e+it])}return new $o(new this.array.constructor(_),this.itemSize,this.normalized)}return o.interleavedBuffers===void 0&&(o.interleavedBuffers={}),o.interleavedBuffers[this.data.uuid]===void 0&&(o.interleavedBuffers[this.data.uuid]=this.data.clone(o)),new r_(o.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(o){if(o===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will deinterleave buffer data.");const _=[];for(let $=0;$<this.count;$++){const _e=$*this.data.stride+this.offset;for(let it=0;it<this.itemSize;it++)_.push(this.data.array[_e+it])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:_,normalized:this.normalized}}return o.interleavedBuffers===void 0&&(o.interleavedBuffers={}),o.interleavedBuffers[this.data.uuid]===void 0&&(o.interleavedBuffers[this.data.uuid]=this.data.toJSON(o)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class q1 extends Uu{constructor(o){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new is(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.alphaMap=o.alphaMap,this.rotation=o.rotation,this.sizeAttenuation=o.sizeAttenuation,this.fog=o.fog,this}}let G0;const W_=new An,Uy=new An,i_=new An,q_=new Rr,jy=new Rr,AT=new Us,H0=new An,W0=new An,Zw=new An,Y1=new Rr,X1=new Rr,wT=new Rr;class K1 extends no{constructor(o){if(super(),this.isSprite=!0,this.type="Sprite",G0===void 0){G0=new ps;const _=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),$=new W1(_,5);G0.setIndex([0,1,2,0,2,3]),G0.setAttribute("position",new r_($,3,0,!1)),G0.setAttribute("uv",new r_($,2,3,!1))}this.geometry=G0,this.material=o!==void 0?o:new q1,this.center=new Rr(.5,.5)}raycast(o,_){o.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Uy.setFromMatrixScale(this.matrixWorld),AT.copy(o.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(o.camera.matrixWorldInverse,this.matrixWorld),i_.setFromMatrixPosition(this.modelViewMatrix),o.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Uy.multiplyScalar(-i_.z);const $=this.material.rotation;let _e,it;$!==0&&(it=Math.cos($),_e=Math.sin($));const ot=this.center;Y_(H0.set(-.5,-.5,0),i_,ot,Uy,_e,it),Y_(W0.set(.5,-.5,0),i_,ot,Uy,_e,it),Y_(Zw.set(.5,.5,0),i_,ot,Uy,_e,it),Y1.set(0,0),X1.set(1,0),wT.set(1,1);let ct=o.ray.intersectTriangle(H0,W0,Zw,!1,W_);if(ct===null&&(Y_(W0.set(-.5,.5,0),i_,ot,Uy,_e,it),X1.set(0,1),ct=o.ray.intersectTriangle(H0,Zw,W0,!1,W_),ct===null))return;const mt=o.ray.origin.distanceTo(W_);mt<o.near||mt>o.far||_.push({distance:mt,point:W_.clone(),uv:Fu.getUV(W_,H0,W0,Zw,Y1,X1,wT,new Rr),face:null,object:this})}copy(o,_){return super.copy(o,_),o.center!==void 0&&this.center.copy(o.center),this.material=o.material,this}}function Y_(ut,o,_,$,_e,it){q_.subVectors(ut,_).addScalar(.5).multiply($),_e!==void 0?(jy.x=it*q_.x-_e*q_.y,jy.y=_e*q_.x+it*q_.y):jy.copy(q_),ut.copy(o),ut.x+=jy.x,ut.y+=jy.y,ut.applyMatrix4(AT)}const GA=new An,xT=new An;class HA extends no{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(o){super.copy(o,!1);const _=o.levels;for(let $=0,_e=_.length;$<_e;$++){const it=_[$];this.addLevel(it.object.clone(),it.distance)}return this.autoUpdate=o.autoUpdate,this}addLevel(o,_=0){_=Math.abs(_);const $=this.levels;let _e;for(_e=0;_e<$.length&&!(_<$[_e].distance);_e++);return $.splice(_e,0,{distance:_,object:o}),this.add(o),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(o){const _=this.levels;if(_.length>0){let $,_e;for($=1,_e=_.length;$<_e&&!(o<_[$].distance);$++);return _[$-1].object}return null}raycast(o,_){if(this.levels.length>0){GA.setFromMatrixPosition(this.matrixWorld);const $=o.ray.origin.distanceTo(GA);this.getObjectForDistance($).raycast(o,_)}}update(o){const _=this.levels;if(_.length>1){GA.setFromMatrixPosition(o.matrixWorld),xT.setFromMatrixPosition(this.matrixWorld);const $=GA.distanceTo(xT)/o.zoom;let _e,it;for(_[0].object.visible=!0,_e=1,it=_.length;_e<it&&$>=_[_e].distance;_e++)_[_e-1].object.visible=!1,_[_e].object.visible=!0;for(this._currentLevel=_e-1;_e<it;_e++)_[_e].object.visible=!1}}toJSON(o){const _=super.toJSON(o);this.autoUpdate===!1&&(_.object.autoUpdate=!1),_.object.levels=[];const $=this.levels;for(let _e=0,it=$.length;_e<it;_e++){const ot=$[_e];_.object.levels.push({object:ot.object.uuid,distance:ot.distance})}return _}}const zy=new An,bT=new Fo,ET=new Fo,ST=new An,$1=new Us;class rC extends ju{constructor(o,_){super(o,_),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Us,this.bindMatrixInverse=new Us}copy(o,_){return super.copy(o,_),this.bindMode=o.bindMode,this.bindMatrix.copy(o.bindMatrix),this.bindMatrixInverse.copy(o.bindMatrixInverse),this.skeleton=o.skeleton,this}bind(o,_){this.skeleton=o,_===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),_=this.matrixWorld),this.bindMatrix.copy(_),this.bindMatrixInverse.copy(_).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const o=new Fo,_=this.geometry.attributes.skinWeight;for(let $=0,_e=_.count;$<_e;$++){o.fromBufferAttribute(_,$);const it=1/o.manhattanLength();it!==1/0?o.multiplyScalar(it):o.set(1,0,0,0),_.setXYZW($,o.x,o.y,o.z,o.w)}}updateMatrixWorld(o){super.updateMatrixWorld(o),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(o,_){const $=this.skeleton,_e=this.geometry;bT.fromBufferAttribute(_e.attributes.skinIndex,o),ET.fromBufferAttribute(_e.attributes.skinWeight,o),zy.copy(_).applyMatrix4(this.bindMatrix),_.set(0,0,0);for(let it=0;it<4;it++){const ot=ET.getComponent(it);if(ot!==0){const ct=bT.getComponent(it);$1.multiplyMatrices($.bones[ct].matrixWorld,$.boneInverses[ct]),_.addScaledVector(ST.copy(zy).applyMatrix4($1),ot)}}return _.applyMatrix4(this.bindMatrixInverse)}}class iC extends no{constructor(){super(),this.isBone=!0,this.type="Bone"}}class WA extends yu{constructor(o=null,_=1,$=1,_e,it,ot,ct,mt,gt=Oo,St=Oo,Tt,Ct){super(null,ot,ct,mt,gt,St,_e,it,Tt,Ct),this.isDataTexture=!0,this.image={data:o,width:_,height:$},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const sC=new Us,CT=new Us;class ex{constructor(o=[],_=[]){this.uuid=Ju(),this.bones=o.slice(0),this.boneInverses=_,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const o=this.bones,_=this.boneInverses;if(this.boneMatrices=new Float32Array(16*o.length),_.length===0)this.calculateInverses();else if(o.length!==_.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let $=0,_e=this.bones.length;$<_e;$++)this.boneInverses.push(new Us)}}calculateInverses(){this.boneInverses.length=0;for(let o=0,_=this.bones.length;o<_;o++){const $=new Us;this.bones[o]&&$.copy(this.bones[o].matrixWorld).invert(),this.boneInverses.push($)}}pose(){for(let o=0,_=this.bones.length;o<_;o++){const $=this.bones[o];$&&$.matrixWorld.copy(this.boneInverses[o]).invert()}for(let o=0,_=this.bones.length;o<_;o++){const $=this.bones[o];$&&($.parent&&$.parent.isBone?($.matrix.copy($.parent.matrixWorld).invert(),$.matrix.multiply($.matrixWorld)):$.matrix.copy($.matrixWorld),$.matrix.decompose($.position,$.quaternion,$.scale))}}update(){const o=this.bones,_=this.boneInverses,$=this.boneMatrices,_e=this.boneTexture;for(let it=0,ot=o.length;it<ot;it++){const ct=o[it]?o[it].matrixWorld:CT;sC.multiplyMatrices(ct,_[it]),sC.toArray($,16*it)}_e!==null&&(_e.needsUpdate=!0)}clone(){return new ex(this.bones,this.boneInverses)}computeBoneTexture(){let o=Math.sqrt(4*this.bones.length);o=qv(o),o=Math.max(o,4);const _=new Float32Array(o*o*4);_.set(this.boneMatrices);const $=new WA(_,o,o,Ls,Pl);return $.needsUpdate=!0,this.boneMatrices=_,this.boneTexture=$,this.boneTextureSize=o,this}getBoneByName(o){for(let _=0,$=this.bones.length;_<$;_++){const _e=this.bones[_];if(_e.name===o)return _e}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(o,_){this.uuid=o.uuid;for(let $=0,_e=o.bones.length;$<_e;$++){const it=o.bones[$];let ot=_[it];ot===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",it),ot=new iC),this.bones.push(ot),this.boneInverses.push(new Us().fromArray(o.boneInverses[$]))}return this.init(),this}toJSON(){const o={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};o.uuid=this.uuid;const _=this.bones,$=this.boneInverses;for(let _e=0,it=_.length;_e<it;_e++){const ot=_[_e];o.bones.push(ot.uuid);const ct=$[_e];o.boneInverses.push(ct.toArray())}return o}}class Vy extends $o{constructor(o,_,$,_e=1){super(o,_,$),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=_e}copy(o){return super.copy(o),this.meshPerAttribute=o.meshPerAttribute,this}toJSON(){const o=super.toJSON();return o.meshPerAttribute=this.meshPerAttribute,o.isInstancedBufferAttribute=!0,o}}const oC=new Us,MT=new Us,tx=[],nx=new ju;class J1 extends ju{constructor(o,_,$){super(o,_),this.isInstancedMesh=!0,this.instanceMatrix=new Vy(new Float32Array(16*$),16),this.instanceColor=null,this.count=$,this.frustumCulled=!1}copy(o,_){return super.copy(o,_),this.instanceMatrix.copy(o.instanceMatrix),o.instanceColor!==null&&(this.instanceColor=o.instanceColor.clone()),this.count=o.count,this}getColorAt(o,_){_.fromArray(this.instanceColor.array,3*o)}getMatrixAt(o,_){_.fromArray(this.instanceMatrix.array,16*o)}raycast(o,_){const $=this.matrixWorld,_e=this.count;if(nx.geometry=this.geometry,nx.material=this.material,nx.material!==void 0)for(let it=0;it<_e;it++){this.getMatrixAt(it,oC),MT.multiplyMatrices($,oC),nx.matrixWorld=MT,nx.raycast(o,tx);for(let ot=0,ct=tx.length;ot<ct;ot++){const mt=tx[ot];mt.instanceId=it,mt.object=this,_.push(mt)}tx.length=0}}setColorAt(o,_){this.instanceColor===null&&(this.instanceColor=new Vy(new Float32Array(3*this.instanceMatrix.count),3)),_.toArray(this.instanceColor.array,3*o)}setMatrixAt(o,_){_.toArray(this.instanceMatrix.array,16*o)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Np extends Uu{constructor(o){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new is(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.linewidth=o.linewidth,this.linecap=o.linecap,this.linejoin=o.linejoin,this.fog=o.fog,this}}const Z1=new An,aC=new An,lC=new Us,cC=new $v,rx=new nm;class s_ extends no{constructor(o=new ps,_=new Np){super(),this.isLine=!0,this.type="Line",this.geometry=o,this.material=_,this.updateMorphTargets()}copy(o,_){return super.copy(o,_),this.material=o.material,this.geometry=o.geometry,this}computeLineDistances(){const o=this.geometry;if(o.index===null){const _=o.attributes.position,$=[0];for(let _e=1,it=_.count;_e<it;_e++)Z1.fromBufferAttribute(_,_e-1),aC.fromBufferAttribute(_,_e),$[_e]=$[_e-1],$[_e]+=Z1.distanceTo(aC);o.setAttribute("lineDistance",new dt($,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(o,_){const $=this.geometry,_e=this.matrixWorld,it=o.params.Line.threshold,ot=$.drawRange;if($.boundingSphere===null&&$.computeBoundingSphere(),rx.copy($.boundingSphere),rx.applyMatrix4(_e),rx.radius+=it,o.ray.intersectsSphere(rx)===!1)return;lC.copy(_e).invert(),cC.copy(o.ray).applyMatrix4(lC);const ct=it/((this.scale.x+this.scale.y+this.scale.z)/3),mt=ct*ct,gt=new An,St=new An,Tt=new An,Ct=new An,Pt=this.isLineSegments?2:1,Ot=$.index,Dt=$.attributes.position;if(Ot!==null)for(let Yt=Math.max(0,ot.start),Xt=Math.min(Ot.count,ot.start+ot.count)-1;Yt<Xt;Yt+=Pt){const Jt=Ot.getX(Yt),an=Ot.getX(Yt+1);if(gt.fromBufferAttribute(Dt,Jt),St.fromBufferAttribute(Dt,an),cC.distanceSqToSegment(gt,St,Ct,Tt)>mt)continue;Ct.applyMatrix4(this.matrixWorld);const fn=o.ray.origin.distanceTo(Ct);fn<o.near||fn>o.far||_.push({distance:fn,point:Tt.clone().applyMatrix4(this.matrixWorld),index:Yt,face:null,faceIndex:null,object:this})}else for(let Yt=Math.max(0,ot.start),Xt=Math.min(Dt.count,ot.start+ot.count)-1;Yt<Xt;Yt+=Pt){if(gt.fromBufferAttribute(Dt,Yt),St.fromBufferAttribute(Dt,Yt+1),cC.distanceSqToSegment(gt,St,Ct,Tt)>mt)continue;Ct.applyMatrix4(this.matrixWorld);const Jt=o.ray.origin.distanceTo(Ct);Jt<o.near||Jt>o.far||_.push({distance:Jt,point:Tt.clone().applyMatrix4(this.matrixWorld),index:Yt,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const o=this.geometry.morphAttributes,_=Object.keys(o);if(_.length>0){const $=o[_[0]];if($!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let _e=0,it=$.length;_e<it;_e++){const ot=$[_e].name||String(_e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[ot]=_e}}}}}const TT=new An,eE=new An;class o_ extends s_{constructor(o,_){super(o,_),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const o=this.geometry;if(o.index===null){const _=o.attributes.position,$=[];for(let _e=0,it=_.count;_e<it;_e+=2)TT.fromBufferAttribute(_,_e),eE.fromBufferAttribute(_,_e+1),$[_e]=_e===0?0:$[_e-1],$[_e+1]=$[_e]+TT.distanceTo(eE);o.setAttribute("lineDistance",new dt($,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class qA extends s_{constructor(o,_){super(o,_),this.isLineLoop=!0,this.type="LineLoop"}}class tE extends Uu{constructor(o){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new is(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.alphaMap=o.alphaMap,this.size=o.size,this.sizeAttenuation=o.sizeAttenuation,this.fog=o.fog,this}}const uC=new Us,nE=new $v,rE=new nm,ix=new An;class iE extends no{constructor(o=new ps,_=new tE){super(),this.isPoints=!0,this.type="Points",this.geometry=o,this.material=_,this.updateMorphTargets()}copy(o,_){return super.copy(o,_),this.material=o.material,this.geometry=o.geometry,this}raycast(o,_){const $=this.geometry,_e=this.matrixWorld,it=o.params.Points.threshold,ot=$.drawRange;if($.boundingSphere===null&&$.computeBoundingSphere(),rE.copy($.boundingSphere),rE.applyMatrix4(_e),rE.radius+=it,o.ray.intersectsSphere(rE)===!1)return;uC.copy(_e).invert(),nE.copy(o.ray).applyMatrix4(uC);const ct=it/((this.scale.x+this.scale.y+this.scale.z)/3),mt=ct*ct,gt=$.index,St=$.attributes.position;if(gt!==null)for(let Tt=Math.max(0,ot.start),Ct=Math.min(gt.count,ot.start+ot.count);Tt<Ct;Tt++){const Pt=gt.getX(Tt);ix.fromBufferAttribute(St,Pt),YA(ix,Pt,mt,_e,o,_,this)}else for(let Tt=Math.max(0,ot.start),Ct=Math.min(St.count,ot.start+ot.count);Tt<Ct;Tt++)ix.fromBufferAttribute(St,Tt),YA(ix,Tt,mt,_e,o,_,this)}updateMorphTargets(){const o=this.geometry.morphAttributes,_=Object.keys(o);if(_.length>0){const $=o[_[0]];if($!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let _e=0,it=$.length;_e<it;_e++){const ot=$[_e].name||String(_e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[ot]=_e}}}}}function YA(ut,o,_,$,_e,it,ot){const ct=nE.distanceSqToPoint(ut);if(ct<_){const mt=new An;nE.closestPointToPoint(ut,mt),mt.applyMatrix4($);const gt=_e.ray.origin.distanceTo(mt);if(gt<_e.near||gt>_e.far)return;it.push({distance:gt,distanceToRay:Math.sqrt(ct),point:mt,index:o,face:null,object:ot})}}class hC extends yu{constructor(o,_,$,_e,it,ot,ct,mt,gt){super(o,_,$,_e,it,ot,ct,mt,gt),this.isVideoTexture=!0,this.minFilter=ot!==void 0?ot:zo,this.magFilter=it!==void 0?it:zo,this.generateMipmaps=!1;const St=this;"requestVideoFrameCallback"in o&&o.requestVideoFrameCallback(function Tt(){St.needsUpdate=!0,o.requestVideoFrameCallback(Tt)})}clone(){return new this.constructor(this.image).copy(this)}update(){const o=this.image;!("requestVideoFrameCallback"in o)&&o.readyState>=o.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class sx extends yu{constructor(o,_,$){super({width:o,height:_}),this.isFramebufferTexture=!0,this.format=$,this.magFilter=Oo,this.minFilter=Oo,this.generateMipmaps=!1,this.needsUpdate=!0}}class ox extends yu{constructor(o,_,$,_e,it,ot,ct,mt,gt,St,Tt,Ct){super(null,ot,ct,mt,gt,St,_e,it,Tt,Ct),this.isCompressedTexture=!0,this.image={width:_,height:$},this.mipmaps=o,this.flipY=!1,this.generateMipmaps=!1}}class dC extends yu{constructor(o,_,$,_e,it,ot,ct,mt,gt){super(o,_,$,_e,it,ot,ct,mt,gt),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Mv{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(o,_){const $=this.getUtoTmapping(o);return this.getPoint($,_)}getPoints(o=5){const _=[];for(let $=0;$<=o;$++)_.push(this.getPoint($/o));return _}getSpacedPoints(o=5){const _=[];for(let $=0;$<=o;$++)_.push(this.getPointAt($/o));return _}getLength(){const o=this.getLengths();return o[o.length-1]}getLengths(o=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===o+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const _=[];let $,_e=this.getPoint(0),it=0;_.push(0);for(let ot=1;ot<=o;ot++)$=this.getPoint(ot/o),it+=$.distanceTo(_e),_.push(it),_e=$;return this.cacheArcLengths=_,_}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(o,_){const $=this.getLengths();let _e=0;const it=$.length;let ot;ot=_||o*$[it-1];let ct,mt=0,gt=it-1;for(;mt<=gt;)if(_e=Math.floor(mt+(gt-mt)/2),ct=$[_e]-ot,ct<0)mt=_e+1;else{if(!(ct>0)){gt=_e;break}gt=_e-1}if(_e=gt,$[_e]===ot)return _e/(it-1);const St=$[_e];return(_e+(ot-St)/($[_e+1]-St))/(it-1)}getTangent(o,_){let _e=o-1e-4,it=o+1e-4;_e<0&&(_e=0),it>1&&(it=1);const ot=this.getPoint(_e),ct=this.getPoint(it),mt=_||(ot.isVector2?new Rr:new An);return mt.copy(ct).sub(ot).normalize(),mt}getTangentAt(o,_){const $=this.getUtoTmapping(o);return this.getTangent($,_)}computeFrenetFrames(o,_){const $=new An,_e=[],it=[],ot=[],ct=new An,mt=new Us;for(let Pt=0;Pt<=o;Pt++){const Ot=Pt/o;_e[Pt]=this.getTangentAt(Ot,new An)}it[0]=new An,ot[0]=new An;let gt=Number.MAX_VALUE;const St=Math.abs(_e[0].x),Tt=Math.abs(_e[0].y),Ct=Math.abs(_e[0].z);St<=gt&&(gt=St,$.set(1,0,0)),Tt<=gt&&(gt=Tt,$.set(0,1,0)),Ct<=gt&&$.set(0,0,1),ct.crossVectors(_e[0],$).normalize(),it[0].crossVectors(_e[0],ct),ot[0].crossVectors(_e[0],it[0]);for(let Pt=1;Pt<=o;Pt++){if(it[Pt]=it[Pt-1].clone(),ot[Pt]=ot[Pt-1].clone(),ct.crossVectors(_e[Pt-1],_e[Pt]),ct.length()>Number.EPSILON){ct.normalize();const Ot=Math.acos(Ms(_e[Pt-1].dot(_e[Pt]),-1,1));it[Pt].applyMatrix4(mt.makeRotationAxis(ct,Ot))}ot[Pt].crossVectors(_e[Pt],it[Pt])}if(_===!0){let Pt=Math.acos(Ms(it[0].dot(it[o]),-1,1));Pt/=o,_e[0].dot(ct.crossVectors(it[0],it[o]))>0&&(Pt=-Pt);for(let Ot=1;Ot<=o;Ot++)it[Ot].applyMatrix4(mt.makeRotationAxis(_e[Ot],Pt*Ot)),ot[Ot].crossVectors(_e[Ot],it[Ot])}return{tangents:_e,normals:it,binormals:ot}}clone(){return new this.constructor().copy(this)}copy(o){return this.arcLengthDivisions=o.arcLengthDivisions,this}toJSON(){const o={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return o.arcLengthDivisions=this.arcLengthDivisions,o.type=this.type,o}fromJSON(o){return this.arcLengthDivisions=o.arcLengthDivisions,this}}class sE extends Mv{constructor(o=0,_=0,$=1,_e=1,it=0,ot=2*Math.PI,ct=!1,mt=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=o,this.aY=_,this.xRadius=$,this.yRadius=_e,this.aStartAngle=it,this.aEndAngle=ot,this.aClockwise=ct,this.aRotation=mt}getPoint(o,_){const $=_||new Rr,_e=2*Math.PI;let it=this.aEndAngle-this.aStartAngle;const ot=Math.abs(it)<Number.EPSILON;for(;it<0;)it+=_e;for(;it>_e;)it-=_e;it<Number.EPSILON&&(it=ot?0:_e),this.aClockwise!==!0||ot||(it===_e?it=-_e:it-=_e);const ct=this.aStartAngle+o*it;let mt=this.aX+this.xRadius*Math.cos(ct),gt=this.aY+this.yRadius*Math.sin(ct);if(this.aRotation!==0){const St=Math.cos(this.aRotation),Tt=Math.sin(this.aRotation),Ct=mt-this.aX,Pt=gt-this.aY;mt=Ct*St-Pt*Tt+this.aX,gt=Ct*Tt+Pt*St+this.aY}return $.set(mt,gt)}copy(o){return super.copy(o),this.aX=o.aX,this.aY=o.aY,this.xRadius=o.xRadius,this.yRadius=o.yRadius,this.aStartAngle=o.aStartAngle,this.aEndAngle=o.aEndAngle,this.aClockwise=o.aClockwise,this.aRotation=o.aRotation,this}toJSON(){const o=super.toJSON();return o.aX=this.aX,o.aY=this.aY,o.xRadius=this.xRadius,o.yRadius=this.yRadius,o.aStartAngle=this.aStartAngle,o.aEndAngle=this.aEndAngle,o.aClockwise=this.aClockwise,o.aRotation=this.aRotation,o}fromJSON(o){return super.fromJSON(o),this.aX=o.aX,this.aY=o.aY,this.xRadius=o.xRadius,this.yRadius=o.yRadius,this.aStartAngle=o.aStartAngle,this.aEndAngle=o.aEndAngle,this.aClockwise=o.aClockwise,this.aRotation=o.aRotation,this}}class IT extends sE{constructor(o,_,$,_e,it,ot){super(o,_,$,$,_e,it,ot),this.isArcCurve=!0,this.type="ArcCurve"}}function oE(){let ut=0,o=0,_=0,$=0;function _e(it,ot,ct,mt){ut=it,o=ct,_=-3*it+3*ot-2*ct-mt,$=2*it-2*ot+ct+mt}return{initCatmullRom:function(it,ot,ct,mt,gt){_e(ot,ct,gt*(ct-it),gt*(mt-ot))},initNonuniformCatmullRom:function(it,ot,ct,mt,gt,St,Tt){let Ct=(ot-it)/gt-(ct-it)/(gt+St)+(ct-ot)/St,Pt=(ct-ot)/St-(mt-ot)/(St+Tt)+(mt-ct)/Tt;Ct*=St,Pt*=St,_e(ot,ct,Ct,Pt)},calc:function(it){const ot=it*it;return ut+o*it+_*ot+$*(ot*it)}}}const aE=new An,lE=new oE,pC=new oE,cE=new oE;class PT extends Mv{constructor(o=[],_=!1,$="centripetal",_e=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=o,this.closed=_,this.curveType=$,this.tension=_e}getPoint(o,_=new An){const $=_,_e=this.points,it=_e.length,ot=(it-(this.closed?0:1))*o;let ct,mt,gt=Math.floor(ot),St=ot-gt;this.closed?gt+=gt>0?0:(Math.floor(Math.abs(gt)/it)+1)*it:St===0&&gt===it-1&&(gt=it-2,St=1),this.closed||gt>0?ct=_e[(gt-1)%it]:(aE.subVectors(_e[0],_e[1]).add(_e[0]),ct=aE);const Tt=_e[gt%it],Ct=_e[(gt+1)%it];if(this.closed||gt+2<it?mt=_e[(gt+2)%it]:(aE.subVectors(_e[it-1],_e[it-2]).add(_e[it-1]),mt=aE),this.curveType==="centripetal"||this.curveType==="chordal"){const Pt=this.curveType==="chordal"?.5:.25;let Ot=Math.pow(ct.distanceToSquared(Tt),Pt),Dt=Math.pow(Tt.distanceToSquared(Ct),Pt),Yt=Math.pow(Ct.distanceToSquared(mt),Pt);Dt<1e-4&&(Dt=1),Ot<1e-4&&(Ot=Dt),Yt<1e-4&&(Yt=Dt),lE.initNonuniformCatmullRom(ct.x,Tt.x,Ct.x,mt.x,Ot,Dt,Yt),pC.initNonuniformCatmullRom(ct.y,Tt.y,Ct.y,mt.y,Ot,Dt,Yt),cE.initNonuniformCatmullRom(ct.z,Tt.z,Ct.z,mt.z,Ot,Dt,Yt)}else this.curveType==="catmullrom"&&(lE.initCatmullRom(ct.x,Tt.x,Ct.x,mt.x,this.tension),pC.initCatmullRom(ct.y,Tt.y,Ct.y,mt.y,this.tension),cE.initCatmullRom(ct.z,Tt.z,Ct.z,mt.z,this.tension));return $.set(lE.calc(St),pC.calc(St),cE.calc(St)),$}copy(o){super.copy(o),this.points=[];for(let _=0,$=o.points.length;_<$;_++){const _e=o.points[_];this.points.push(_e.clone())}return this.closed=o.closed,this.curveType=o.curveType,this.tension=o.tension,this}toJSON(){const o=super.toJSON();o.points=[];for(let _=0,$=this.points.length;_<$;_++){const _e=this.points[_];o.points.push(_e.toArray())}return o.closed=this.closed,o.curveType=this.curveType,o.tension=this.tension,o}fromJSON(o){super.fromJSON(o),this.points=[];for(let _=0,$=o.points.length;_<$;_++){const _e=o.points[_];this.points.push(new An().fromArray(_e))}return this.closed=o.closed,this.curveType=o.curveType,this.tension=o.tension,this}}function XA(ut,o,_,$,_e){const it=.5*($-o),ot=.5*(_e-_),ct=ut*ut;return(2*_-2*$+it+ot)*(ut*ct)+(-3*_+3*$-2*it-ot)*ct+it*ut+_}function Qy(ut,o,_,$){return function(_e,it){const ot=1-_e;return ot*ot*it}(ut,o)+function(_e,it){return 2*(1-_e)*_e*it}(ut,_)+function(_e,it){return _e*_e*it}(ut,$)}function au(ut,o,_,$,_e){return function(it,ot){const ct=1-it;return ct*ct*ct*ot}(ut,o)+function(it,ot){const ct=1-it;return 3*ct*ct*it*ot}(ut,_)+function(it,ot){return 3*(1-it)*it*it*ot}(ut,$)+function(it,ot){return it*it*it*ot}(ut,_e)}class ax extends Mv{constructor(o=new Rr,_=new Rr,$=new Rr,_e=new Rr){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=o,this.v1=_,this.v2=$,this.v3=_e}getPoint(o,_=new Rr){const $=_,_e=this.v0,it=this.v1,ot=this.v2,ct=this.v3;return $.set(au(o,_e.x,it.x,ot.x,ct.x),au(o,_e.y,it.y,ot.y,ct.y)),$}copy(o){return super.copy(o),this.v0.copy(o.v0),this.v1.copy(o.v1),this.v2.copy(o.v2),this.v3.copy(o.v3),this}toJSON(){const o=super.toJSON();return o.v0=this.v0.toArray(),o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o.v3=this.v3.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v0.fromArray(o.v0),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this.v3.fromArray(o.v3),this}}class fC extends Mv{constructor(o=new An,_=new An,$=new An,_e=new An){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=o,this.v1=_,this.v2=$,this.v3=_e}getPoint(o,_=new An){const $=_,_e=this.v0,it=this.v1,ot=this.v2,ct=this.v3;return $.set(au(o,_e.x,it.x,ot.x,ct.x),au(o,_e.y,it.y,ot.y,ct.y),au(o,_e.z,it.z,ot.z,ct.z)),$}copy(o){return super.copy(o),this.v0.copy(o.v0),this.v1.copy(o.v1),this.v2.copy(o.v2),this.v3.copy(o.v3),this}toJSON(){const o=super.toJSON();return o.v0=this.v0.toArray(),o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o.v3=this.v3.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v0.fromArray(o.v0),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this.v3.fromArray(o.v3),this}}class lx extends Mv{constructor(o=new Rr,_=new Rr){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=o,this.v2=_}getPoint(o,_=new Rr){const $=_;return o===1?$.copy(this.v2):($.copy(this.v2).sub(this.v1),$.multiplyScalar(o).add(this.v1)),$}getPointAt(o,_){return this.getPoint(o,_)}getTangent(o,_){const $=_||new Rr;return $.copy(this.v2).sub(this.v1).normalize(),$}copy(o){return super.copy(o),this.v1.copy(o.v1),this.v2.copy(o.v2),this}toJSON(){const o=super.toJSON();return o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this}}class mC extends Mv{constructor(o=new An,_=new An){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=o,this.v2=_}getPoint(o,_=new An){const $=_;return o===1?$.copy(this.v2):($.copy(this.v2).sub(this.v1),$.multiplyScalar(o).add(this.v1)),$}getPointAt(o,_){return this.getPoint(o,_)}copy(o){return super.copy(o),this.v1.copy(o.v1),this.v2.copy(o.v2),this}toJSON(){const o=super.toJSON();return o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this}}class X_ extends Mv{constructor(o=new Rr,_=new Rr,$=new Rr){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=o,this.v1=_,this.v2=$}getPoint(o,_=new Rr){const $=_,_e=this.v0,it=this.v1,ot=this.v2;return $.set(Qy(o,_e.x,it.x,ot.x),Qy(o,_e.y,it.y,ot.y)),$}copy(o){return super.copy(o),this.v0.copy(o.v0),this.v1.copy(o.v1),this.v2.copy(o.v2),this}toJSON(){const o=super.toJSON();return o.v0=this.v0.toArray(),o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v0.fromArray(o.v0),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this}}class uE extends Mv{constructor(o=new An,_=new An,$=new An){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=o,this.v1=_,this.v2=$}getPoint(o,_=new An){const $=_,_e=this.v0,it=this.v1,ot=this.v2;return $.set(Qy(o,_e.x,it.x,ot.x),Qy(o,_e.y,it.y,ot.y),Qy(o,_e.z,it.z,ot.z)),$}copy(o){return super.copy(o),this.v0.copy(o.v0),this.v1.copy(o.v1),this.v2.copy(o.v2),this}toJSON(){const o=super.toJSON();return o.v0=this.v0.toArray(),o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v0.fromArray(o.v0),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this}}class gC extends Mv{constructor(o=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=o}getPoint(o,_=new Rr){const $=_,_e=this.points,it=(_e.length-1)*o,ot=Math.floor(it),ct=it-ot,mt=_e[ot===0?ot:ot-1],gt=_e[ot],St=_e[ot>_e.length-2?_e.length-1:ot+1],Tt=_e[ot>_e.length-3?_e.length-1:ot+2];return $.set(XA(ct,mt.x,gt.x,St.x,Tt.x),XA(ct,mt.y,gt.y,St.y,Tt.y)),$}copy(o){super.copy(o),this.points=[];for(let _=0,$=o.points.length;_<$;_++){const _e=o.points[_];this.points.push(_e.clone())}return this}toJSON(){const o=super.toJSON();o.points=[];for(let _=0,$=this.points.length;_<$;_++){const _e=this.points[_];o.points.push(_e.toArray())}return o}fromJSON(o){super.fromJSON(o),this.points=[];for(let _=0,$=o.points.length;_<$;_++){const _e=o.points[_];this.points.push(new Rr().fromArray(_e))}return this}}var Uo=Object.freeze({__proto__:null,ArcCurve:IT,CatmullRomCurve3:PT,CubicBezierCurve:ax,CubicBezierCurve3:fC,EllipseCurve:sE,LineCurve:lx,LineCurve3:mC,QuadraticBezierCurve:X_,QuadraticBezierCurve3:uE,SplineCurve:gC});class vC extends Mv{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(o){this.curves.push(o)}closePath(){const o=this.curves[0].getPoint(0),_=this.curves[this.curves.length-1].getPoint(1);o.equals(_)||this.curves.push(new lx(_,o))}getPoint(o,_){const $=o*this.getLength(),_e=this.getCurveLengths();let it=0;for(;it<_e.length;){if(_e[it]>=$){const ot=_e[it]-$,ct=this.curves[it],mt=ct.getLength(),gt=mt===0?0:1-ot/mt;return ct.getPointAt(gt,_)}it++}return null}getLength(){const o=this.getCurveLengths();return o[o.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const o=[];let _=0;for(let $=0,_e=this.curves.length;$<_e;$++)_+=this.curves[$].getLength(),o.push(_);return this.cacheLengths=o,o}getSpacedPoints(o=40){const _=[];for(let $=0;$<=o;$++)_.push(this.getPoint($/o));return this.autoClose&&_.push(_[0]),_}getPoints(o=12){const _=[];let $;for(let _e=0,it=this.curves;_e<it.length;_e++){const ot=it[_e],ct=ot.isEllipseCurve?2*o:ot.isLineCurve||ot.isLineCurve3?1:ot.isSplineCurve?o*ot.points.length:o,mt=ot.getPoints(ct);for(let gt=0;gt<mt.length;gt++){const St=mt[gt];$&&$.equals(St)||(_.push(St),$=St)}}return this.autoClose&&_.length>1&&!_[_.length-1].equals(_[0])&&_.push(_[0]),_}copy(o){super.copy(o),this.curves=[];for(let _=0,$=o.curves.length;_<$;_++){const _e=o.curves[_];this.curves.push(_e.clone())}return this.autoClose=o.autoClose,this}toJSON(){const o=super.toJSON();o.autoClose=this.autoClose,o.curves=[];for(let _=0,$=this.curves.length;_<$;_++){const _e=this.curves[_];o.curves.push(_e.toJSON())}return o}fromJSON(o){super.fromJSON(o),this.autoClose=o.autoClose,this.curves=[];for(let _=0,$=o.curves.length;_<$;_++){const _e=o.curves[_];this.curves.push(new Uo[_e.type]().fromJSON(_e))}return this}}class KA extends vC{constructor(o){super(),this.type="Path",this.currentPoint=new Rr,o&&this.setFromPoints(o)}setFromPoints(o){this.moveTo(o[0].x,o[0].y);for(let _=1,$=o.length;_<$;_++)this.lineTo(o[_].x,o[_].y);return this}moveTo(o,_){return this.currentPoint.set(o,_),this}lineTo(o,_){const $=new lx(this.currentPoint.clone(),new Rr(o,_));return this.curves.push($),this.currentPoint.set(o,_),this}quadraticCurveTo(o,_,$,_e){const it=new X_(this.currentPoint.clone(),new Rr(o,_),new Rr($,_e));return this.curves.push(it),this.currentPoint.set($,_e),this}bezierCurveTo(o,_,$,_e,it,ot){const ct=new ax(this.currentPoint.clone(),new Rr(o,_),new Rr($,_e),new Rr(it,ot));return this.curves.push(ct),this.currentPoint.set(it,ot),this}splineThru(o){const _=[this.currentPoint.clone()].concat(o),$=new gC(_);return this.curves.push($),this.currentPoint.copy(o[o.length-1]),this}arc(o,_,$,_e,it,ot){const ct=this.currentPoint.x,mt=this.currentPoint.y;return this.absarc(o+ct,_+mt,$,_e,it,ot),this}absarc(o,_,$,_e,it,ot){return this.absellipse(o,_,$,$,_e,it,ot),this}ellipse(o,_,$,_e,it,ot,ct,mt){const gt=this.currentPoint.x,St=this.currentPoint.y;return this.absellipse(o+gt,_+St,$,_e,it,ot,ct,mt),this}absellipse(o,_,$,_e,it,ot,ct,mt){const gt=new sE(o,_,$,_e,it,ot,ct,mt);if(this.curves.length>0){const Tt=gt.getPoint(0);Tt.equals(this.currentPoint)||this.lineTo(Tt.x,Tt.y)}this.curves.push(gt);const St=gt.getPoint(1);return this.currentPoint.copy(St),this}copy(o){return super.copy(o),this.currentPoint.copy(o.currentPoint),this}toJSON(){const o=super.toJSON();return o.currentPoint=this.currentPoint.toArray(),o}fromJSON(o){return super.fromJSON(o),this.currentPoint.fromArray(o.currentPoint),this}}class Xl extends ps{constructor(o=[new Rr(0,-.5),new Rr(.5,0),new Rr(0,.5)],_=12,$=0,_e=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:o,segments:_,phiStart:$,phiLength:_e},_=Math.floor(_),_e=Ms(_e,0,2*Math.PI);const it=[],ot=[],ct=[],mt=[],gt=[],St=1/_,Tt=new An,Ct=new Rr,Pt=new An,Ot=new An,Dt=new An;let Yt=0,Xt=0;for(let Jt=0;Jt<=o.length-1;Jt++)switch(Jt){case 0:Yt=o[Jt+1].x-o[Jt].x,Xt=o[Jt+1].y-o[Jt].y,Pt.x=1*Xt,Pt.y=-Yt,Pt.z=0*Xt,Dt.copy(Pt),Pt.normalize(),mt.push(Pt.x,Pt.y,Pt.z);break;case o.length-1:mt.push(Dt.x,Dt.y,Dt.z);break;default:Yt=o[Jt+1].x-o[Jt].x,Xt=o[Jt+1].y-o[Jt].y,Pt.x=1*Xt,Pt.y=-Yt,Pt.z=0*Xt,Ot.copy(Pt),Pt.x+=Dt.x,Pt.y+=Dt.y,Pt.z+=Dt.z,Pt.normalize(),mt.push(Pt.x,Pt.y,Pt.z),Dt.copy(Ot)}for(let Jt=0;Jt<=_;Jt++){const an=$+Jt*St*_e,fn=Math.sin(an),gn=Math.cos(an);for(let _n=0;_n<=o.length-1;_n++){Tt.x=o[_n].x*fn,Tt.y=o[_n].y,Tt.z=o[_n].x*gn,ot.push(Tt.x,Tt.y,Tt.z),Ct.x=Jt/_,Ct.y=_n/(o.length-1),ct.push(Ct.x,Ct.y);const On=mt[3*_n+0]*fn,Ln=mt[3*_n+1],$n=mt[3*_n+0]*gn;gt.push(On,Ln,$n)}}for(let Jt=0;Jt<_;Jt++)for(let an=0;an<o.length-1;an++){const fn=an+Jt*o.length,gn=fn,_n=fn+o.length,On=fn+o.length+1,Ln=fn+1;it.push(gn,_n,Ln),it.push(On,Ln,_n)}this.setIndex(it),this.setAttribute("position",new dt(ot,3)),this.setAttribute("uv",new dt(ct,2)),this.setAttribute("normal",new dt(gt,3))}static fromJSON(o){return new Xl(o.points,o.segments,o.phiStart,o.phiLength)}}class cx extends Xl{constructor(o=1,_=1,$=4,_e=8){const it=new KA;it.absarc(0,-_/2,o,1.5*Math.PI,0),it.absarc(0,_/2,o,0,.5*Math.PI),super(it.getPoints($),_e),this.type="CapsuleGeometry",this.parameters={radius:o,height:_,capSegments:$,radialSegments:_e}}static fromJSON(o){return new cx(o.radius,o.length,o.capSegments,o.radialSegments)}}class Tm extends ps{constructor(o=1,_=8,$=0,_e=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:o,segments:_,thetaStart:$,thetaLength:_e},_=Math.max(3,_);const it=[],ot=[],ct=[],mt=[],gt=new An,St=new Rr;ot.push(0,0,0),ct.push(0,0,1),mt.push(.5,.5);for(let Tt=0,Ct=3;Tt<=_;Tt++,Ct+=3){const Pt=$+Tt/_*_e;gt.x=o*Math.cos(Pt),gt.y=o*Math.sin(Pt),ot.push(gt.x,gt.y,gt.z),ct.push(0,0,1),St.x=(ot[Ct]/o+1)/2,St.y=(ot[Ct+1]/o+1)/2,mt.push(St.x,St.y)}for(let Tt=1;Tt<=_;Tt++)it.push(Tt,Tt+1,0);this.setIndex(it),this.setAttribute("position",new dt(ot,3)),this.setAttribute("normal",new dt(ct,3)),this.setAttribute("uv",new dt(mt,2))}static fromJSON(o){return new Tm(o.radius,o.segments,o.thetaStart,o.thetaLength)}}class zu extends ps{constructor(o=1,_=1,$=1,_e=8,it=1,ot=!1,ct=0,mt=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:o,radiusBottom:_,height:$,radialSegments:_e,heightSegments:it,openEnded:ot,thetaStart:ct,thetaLength:mt};const gt=this;_e=Math.floor(_e),it=Math.floor(it);const St=[],Tt=[],Ct=[],Pt=[];let Ot=0;const Dt=[],Yt=$/2;let Xt=0;function Jt(an){const fn=Ot,gn=new Rr,_n=new An;let On=0;const Ln=an===!0?o:_,$n=an===!0?1:-1;for(let Un=1;Un<=_e;Un++)Tt.push(0,Yt*$n,0),Ct.push(0,$n,0),Pt.push(.5,.5),Ot++;const Jn=Ot;for(let Un=0;Un<=_e;Un++){const Er=Un/_e*mt+ct,Or=Math.cos(Er),xr=Math.sin(Er);_n.x=Ln*xr,_n.y=Yt*$n,_n.z=Ln*Or,Tt.push(_n.x,_n.y,_n.z),Ct.push(0,$n,0),gn.x=.5*Or+.5,gn.y=.5*xr*$n+.5,Pt.push(gn.x,gn.y),Ot++}for(let Un=0;Un<_e;Un++){const Er=fn+Un,Or=Jn+Un;an===!0?St.push(Or,Or+1,Er):St.push(Or+1,Or,Er),On+=3}gt.addGroup(Xt,On,an===!0?1:2),Xt+=On}(function(){const an=new An,fn=new An;let gn=0;const _n=(_-o)/$;for(let On=0;On<=it;On++){const Ln=[],$n=On/it,Jn=$n*(_-o)+o;for(let Un=0;Un<=_e;Un++){const Er=Un/_e,Or=Er*mt+ct,xr=Math.sin(Or),Gr=Math.cos(Or);fn.x=Jn*xr,fn.y=-$n*$+Yt,fn.z=Jn*Gr,Tt.push(fn.x,fn.y,fn.z),an.set(xr,_n,Gr).normalize(),Ct.push(an.x,an.y,an.z),Pt.push(Er,1-$n),Ln.push(Ot++)}Dt.push(Ln)}for(let On=0;On<_e;On++)for(let Ln=0;Ln<it;Ln++){const $n=Dt[Ln][On],Jn=Dt[Ln+1][On],Un=Dt[Ln+1][On+1],Er=Dt[Ln][On+1];St.push($n,Jn,Er),St.push(Jn,Un,Er),gn+=6}gt.addGroup(Xt,gn,0),Xt+=gn})(),ot===!1&&(o>0&&Jt(!0),_>0&&Jt(!1)),this.setIndex(St),this.setAttribute("position",new dt(Tt,3)),this.setAttribute("normal",new dt(Ct,3)),this.setAttribute("uv",new dt(Pt,2))}static fromJSON(o){return new zu(o.radiusTop,o.radiusBottom,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength)}}class Rl extends zu{constructor(o=1,_=1,$=8,_e=1,it=!1,ot=0,ct=2*Math.PI){super(0,o,_,$,_e,it,ot,ct),this.type="ConeGeometry",this.parameters={radius:o,height:_,radialSegments:$,heightSegments:_e,openEnded:it,thetaStart:ot,thetaLength:ct}}static fromJSON(o){return new Rl(o.radius,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength)}}class K_ extends ps{constructor(o=[],_=[],$=1,_e=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:o,indices:_,radius:$,detail:_e};const it=[],ot=[];function ct(Ct,Pt,Ot,Dt){const Yt=Dt+1,Xt=[];for(let Jt=0;Jt<=Yt;Jt++){Xt[Jt]=[];const an=Ct.clone().lerp(Ot,Jt/Yt),fn=Pt.clone().lerp(Ot,Jt/Yt),gn=Yt-Jt;for(let _n=0;_n<=gn;_n++)Xt[Jt][_n]=_n===0&&Jt===Yt?an:an.clone().lerp(fn,_n/gn)}for(let Jt=0;Jt<Yt;Jt++)for(let an=0;an<2*(Yt-Jt)-1;an++){const fn=Math.floor(an/2);an%2==0?(mt(Xt[Jt][fn+1]),mt(Xt[Jt+1][fn]),mt(Xt[Jt][fn])):(mt(Xt[Jt][fn+1]),mt(Xt[Jt+1][fn+1]),mt(Xt[Jt+1][fn]))}}function mt(Ct){it.push(Ct.x,Ct.y,Ct.z)}function gt(Ct,Pt){const Ot=3*Ct;Pt.x=o[Ot+0],Pt.y=o[Ot+1],Pt.z=o[Ot+2]}function St(Ct,Pt,Ot,Dt){Dt<0&&Ct.x===1&&(ot[Pt]=Ct.x-1),Ot.x===0&&Ot.z===0&&(ot[Pt]=Dt/2/Math.PI+.5)}function Tt(Ct){return Math.atan2(Ct.z,-Ct.x)}(function(Ct){const Pt=new An,Ot=new An,Dt=new An;for(let Yt=0;Yt<_.length;Yt+=3)gt(_[Yt+0],Pt),gt(_[Yt+1],Ot),gt(_[Yt+2],Dt),ct(Pt,Ot,Dt,Ct)})(_e),function(Ct){const Pt=new An;for(let Ot=0;Ot<it.length;Ot+=3)Pt.x=it[Ot+0],Pt.y=it[Ot+1],Pt.z=it[Ot+2],Pt.normalize().multiplyScalar(Ct),it[Ot+0]=Pt.x,it[Ot+1]=Pt.y,it[Ot+2]=Pt.z}($),function(){const Ct=new An;for(let Ot=0;Ot<it.length;Ot+=3){Ct.x=it[Ot+0],Ct.y=it[Ot+1],Ct.z=it[Ot+2];const Dt=Tt(Ct)/2/Math.PI+.5,Yt=(Pt=Ct,Math.atan2(-Pt.y,Math.sqrt(Pt.x*Pt.x+Pt.z*Pt.z))/Math.PI+.5);ot.push(Dt,1-Yt)}var Pt;(function(){const Ot=new An,Dt=new An,Yt=new An,Xt=new An,Jt=new Rr,an=new Rr,fn=new Rr;for(let gn=0,_n=0;gn<it.length;gn+=9,_n+=6){Ot.set(it[gn+0],it[gn+1],it[gn+2]),Dt.set(it[gn+3],it[gn+4],it[gn+5]),Yt.set(it[gn+6],it[gn+7],it[gn+8]),Jt.set(ot[_n+0],ot[_n+1]),an.set(ot[_n+2],ot[_n+3]),fn.set(ot[_n+4],ot[_n+5]),Xt.copy(Ot).add(Dt).add(Yt).divideScalar(3);const On=Tt(Xt);St(Jt,_n+0,Ot,On),St(an,_n+2,Dt,On),St(fn,_n+4,Yt,On)}})(),function(){for(let Ot=0;Ot<ot.length;Ot+=6){const Dt=ot[Ot+0],Yt=ot[Ot+2],Xt=ot[Ot+4],Jt=Math.max(Dt,Yt,Xt),an=Math.min(Dt,Yt,Xt);Jt>.9&&an<.1&&(Dt<.2&&(ot[Ot+0]+=1),Yt<.2&&(ot[Ot+2]+=1),Xt<.2&&(ot[Ot+4]+=1))}}()}(),this.setAttribute("position",new dt(it,3)),this.setAttribute("normal",new dt(it.slice(),3)),this.setAttribute("uv",new dt(ot,2)),_e===0?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(o){return new K_(o.vertices,o.indices,o.radius,o.details)}}class ux extends K_{constructor(o=1,_=0){const $=(1+Math.sqrt(5))/2,_e=1/$;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-_e,-$,0,-_e,$,0,_e,-$,0,_e,$,-_e,-$,0,-_e,$,0,_e,-$,0,_e,$,0,-$,0,-_e,$,0,-_e,-$,0,_e,$,0,_e],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],o,_),this.type="DodecahedronGeometry",this.parameters={radius:o,detail:_}}static fromJSON(o){return new ux(o.radius,o.detail)}}const Tv=new An,$A=new An,hx=new An,JA=new Fu;class hE extends ps{constructor(o=null,_=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:o,thresholdAngle:_},o!==null){const _e=Math.pow(10,4),it=Math.cos(D_*_),ot=o.getIndex(),ct=o.getAttribute("position"),mt=ot?ot.count:ct.count,gt=[0,0,0],St=["a","b","c"],Tt=new Array(3),Ct={},Pt=[];for(let Ot=0;Ot<mt;Ot+=3){ot?(gt[0]=ot.getX(Ot),gt[1]=ot.getX(Ot+1),gt[2]=ot.getX(Ot+2)):(gt[0]=Ot,gt[1]=Ot+1,gt[2]=Ot+2);const{a:Dt,b:Yt,c:Xt}=JA;if(Dt.fromBufferAttribute(ct,gt[0]),Yt.fromBufferAttribute(ct,gt[1]),Xt.fromBufferAttribute(ct,gt[2]),JA.getNormal(hx),Tt[0]=`${Math.round(Dt.x*_e)},${Math.round(Dt.y*_e)},${Math.round(Dt.z*_e)}`,Tt[1]=`${Math.round(Yt.x*_e)},${Math.round(Yt.y*_e)},${Math.round(Yt.z*_e)}`,Tt[2]=`${Math.round(Xt.x*_e)},${Math.round(Xt.y*_e)},${Math.round(Xt.z*_e)}`,Tt[0]!==Tt[1]&&Tt[1]!==Tt[2]&&Tt[2]!==Tt[0])for(let Jt=0;Jt<3;Jt++){const an=(Jt+1)%3,fn=Tt[Jt],gn=Tt[an],_n=JA[St[Jt]],On=JA[St[an]],Ln=`${fn}_${gn}`,$n=`${gn}_${fn}`;$n in Ct&&Ct[$n]?(hx.dot(Ct[$n].normal)<=it&&(Pt.push(_n.x,_n.y,_n.z),Pt.push(On.x,On.y,On.z)),Ct[$n]=null):Ln in Ct||(Ct[Ln]={index0:gt[Jt],index1:gt[an],normal:hx.clone()})}}for(const Ot in Ct)if(Ct[Ot]){const{index0:Dt,index1:Yt}=Ct[Ot];Tv.fromBufferAttribute(ct,Dt),$A.fromBufferAttribute(ct,Yt),Pt.push(Tv.x,Tv.y,Tv.z),Pt.push($A.x,$A.y,$A.z)}this.setAttribute("position",new dt(Pt,3))}}}class Gy extends KA{constructor(o){super(o),this.uuid=Ju(),this.type="Shape",this.holes=[]}getPointsHoles(o){const _=[];for(let $=0,_e=this.holes.length;$<_e;$++)_[$]=this.holes[$].getPoints(o);return _}extractPoints(o){return{shape:this.getPoints(o),holes:this.getPointsHoles(o)}}copy(o){super.copy(o),this.holes=[];for(let _=0,$=o.holes.length;_<$;_++){const _e=o.holes[_];this.holes.push(_e.clone())}return this}toJSON(){const o=super.toJSON();o.uuid=this.uuid,o.holes=[];for(let _=0,$=this.holes.length;_<$;_++){const _e=this.holes[_];o.holes.push(_e.toJSON())}return o}fromJSON(o){super.fromJSON(o),this.uuid=o.uuid,this.holes=[];for(let _=0,$=o.holes.length;_<$;_++){const _e=o.holes[_];this.holes.push(new KA().fromJSON(_e))}return this}}function DT(ut,o,_,$,_e){let it,ot;if(_e===function(ct,mt,gt,St){let Tt=0;for(let Ct=mt,Pt=gt-St;Ct<gt;Ct+=St)Tt+=(ct[Pt]-ct[Ct])*(ct[Ct+1]+ct[Pt+1]),Pt=Ct;return Tt}(ut,o,_,$)>0)for(it=o;it<_;it+=$)ot=mm(it,ut[it],ut[it+1],ot);else for(it=_-$;it>=o;it-=$)ot=mm(it,ut[it],ut[it+1],ot);return ot&&pm(ot,ot.next)&&(mx(ot),ot=ot.next),ot}function q0(ut,o){if(!ut)return ut;o||(o=ut);let _,$=ut;do if(_=!1,$.steiner||!pm($,$.next)&&Gl($.prev,$,$.next)!==0)$=$.next;else{if(mx($),$=o=$.prev,$===$.next)break;_=!0}while(_||$!==o);return o}function dx(ut,o,_,$,_e,it,ot){if(!ut)return;!ot&&it&&function(St,Tt,Ct,Pt){let Ot=St;do Ot.z===null&&(Ot.z=dE(Ot.x,Ot.y,Tt,Ct,Pt)),Ot.prevZ=Ot.prev,Ot.nextZ=Ot.next,Ot=Ot.next;while(Ot!==St);Ot.prevZ.nextZ=null,Ot.prevZ=null,function(Dt){let Yt,Xt,Jt,an,fn,gn,_n,On,Ln=1;do{for(Xt=Dt,Dt=null,fn=null,gn=0;Xt;){for(gn++,Jt=Xt,_n=0,Yt=0;Yt<Ln&&(_n++,Jt=Jt.nextZ,Jt);Yt++);for(On=Ln;_n>0||On>0&&Jt;)_n!==0&&(On===0||!Jt||Xt.z<=Jt.z)?(an=Xt,Xt=Xt.nextZ,_n--):(an=Jt,Jt=Jt.nextZ,On--),fn?fn.nextZ=an:Dt=an,an.prevZ=fn,fn=an;Xt=Jt}fn.nextZ=null,Ln*=2}while(gn>1)}(Ot)}(ut,$,_e,it);let ct,mt,gt=ut;for(;ut.prev!==ut.next;)if(ct=ut.prev,mt=ut.next,it?px(ut,$,_e,it):RT(ut))o.push(ct.i/_),o.push(ut.i/_),o.push(mt.i/_),mx(ut),ut=mt.next,gt=mt.next;else if((ut=mt)===gt){ot?ot===1?dx(ut=kT(q0(ut),o,_),o,_,$,_e,it,2):ot===2&&_C(ut,o,_,$,_e,it):dx(q0(ut),o,_,$,_e,it,1);break}}function RT(ut){const o=ut.prev,_=ut,$=ut.next;if(Gl(o,_,$)>=0)return!1;let _e=ut.next.next;for(;_e!==ut.prev;){if(Xm(o.x,o.y,_.x,_.y,$.x,$.y,_e.x,_e.y)&&Gl(_e.prev,_e,_e.next)>=0)return!1;_e=_e.next}return!0}function px(ut,o,_,$){const _e=ut.prev,it=ut,ot=ut.next;if(Gl(_e,it,ot)>=0)return!1;const ct=_e.x<it.x?_e.x<ot.x?_e.x:ot.x:it.x<ot.x?it.x:ot.x,mt=_e.y<it.y?_e.y<ot.y?_e.y:ot.y:it.y<ot.y?it.y:ot.y,gt=_e.x>it.x?_e.x>ot.x?_e.x:ot.x:it.x>ot.x?it.x:ot.x,St=_e.y>it.y?_e.y>ot.y?_e.y:ot.y:it.y>ot.y?it.y:ot.y,Tt=dE(ct,mt,o,_,$),Ct=dE(gt,St,o,_,$);let Pt=ut.prevZ,Ot=ut.nextZ;for(;Pt&&Pt.z>=Tt&&Ot&&Ot.z<=Ct;){if(Pt!==ut.prev&&Pt!==ut.next&&Xm(_e.x,_e.y,it.x,it.y,ot.x,ot.y,Pt.x,Pt.y)&&Gl(Pt.prev,Pt,Pt.next)>=0||(Pt=Pt.prevZ,Ot!==ut.prev&&Ot!==ut.next&&Xm(_e.x,_e.y,it.x,it.y,ot.x,ot.y,Ot.x,Ot.y)&&Gl(Ot.prev,Ot,Ot.next)>=0))return!1;Ot=Ot.nextZ}for(;Pt&&Pt.z>=Tt;){if(Pt!==ut.prev&&Pt!==ut.next&&Xm(_e.x,_e.y,it.x,it.y,ot.x,ot.y,Pt.x,Pt.y)&&Gl(Pt.prev,Pt,Pt.next)>=0)return!1;Pt=Pt.prevZ}for(;Ot&&Ot.z<=Ct;){if(Ot!==ut.prev&&Ot!==ut.next&&Xm(_e.x,_e.y,it.x,it.y,ot.x,ot.y,Ot.x,Ot.y)&&Gl(Ot.prev,Ot,Ot.next)>=0)return!1;Ot=Ot.nextZ}return!0}function kT(ut,o,_){let $=ut;do{const _e=$.prev,it=$.next.next;!pm(_e,it)&&Y0(_e,$,$.next,it)&&X0(_e,it)&&X0(it,_e)&&(o.push(_e.i/_),o.push($.i/_),o.push(it.i/_),mx($),mx($.next),$=ut=it),$=$.next}while($!==ut);return q0($)}function _C(ut,o,_,$,_e,it){let ot=ut;do{let ct=ot.next.next;for(;ct!==ot.prev;){if(ot.i!==ct.i&&Mp(ot,ct)){let mt=pE(ot,ct);return ot=q0(ot,ot.next),mt=q0(mt,mt.next),dx(ot,o,_,$,_e,it),void dx(mt,o,_,$,_e,it)}ct=ct.next}ot=ot.next}while(ot!==ut)}function fx(ut,o){return ut.x-o.x}function Iv(ut,o){if(o=function(_,$){let _e=$;const it=_.x,ot=_.y;let ct,mt=-1/0;do{if(ot<=_e.y&&ot>=_e.next.y&&_e.next.y!==_e.y){const Ot=_e.x+(ot-_e.y)*(_e.next.x-_e.x)/(_e.next.y-_e.y);if(Ot<=it&&Ot>mt){if(mt=Ot,Ot===it){if(ot===_e.y)return _e;if(ot===_e.next.y)return _e.next}ct=_e.x<_e.next.x?_e:_e.next}}_e=_e.next}while(_e!==$);if(!ct)return null;if(it===mt)return ct;const gt=ct,St=ct.x,Tt=ct.y;let Ct,Pt=1/0;_e=ct;do it>=_e.x&&_e.x>=St&&it!==_e.x&&Xm(ot<Tt?it:mt,ot,St,Tt,ot<Tt?mt:it,ot,_e.x,_e.y)&&(Ct=Math.abs(ot-_e.y)/(it-_e.x),X0(_e,_)&&(Ct<Pt||Ct===Pt&&(_e.x>ct.x||_e.x===ct.x&&BT(ct,_e)))&&(ct=_e,Pt=Ct)),_e=_e.next;while(_e!==gt);return ct}(ut,o),o){const _=pE(o,ut);q0(o,o.next),q0(_,_.next)}}function BT(ut,o){return Gl(ut.prev,ut,o.prev)<0&&Gl(o.next,ut,ut.next)<0}function dE(ut,o,_,$,_e){return(ut=1431655765&((ut=858993459&((ut=252645135&((ut=16711935&((ut=32767*(ut-_)*_e)|ut<<8))|ut<<4))|ut<<2))|ut<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-$)*_e)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function Hy(ut){let o=ut,_=ut;do(o.x<_.x||o.x===_.x&&o.y<_.y)&&(_=o),o=o.next;while(o!==ut);return _}function Xm(ut,o,_,$,_e,it,ot,ct){return(_e-ot)*(o-ct)-(ut-ot)*(it-ct)>=0&&(ut-ot)*($-ct)-(_-ot)*(o-ct)>=0&&(_-ot)*(it-ct)-(_e-ot)*($-ct)>=0}function Mp(ut,o){return ut.next.i!==o.i&&ut.prev.i!==o.i&&!function(_,$){let _e=_;do{if(_e.i!==_.i&&_e.next.i!==_.i&&_e.i!==$.i&&_e.next.i!==$.i&&Y0(_e,_e.next,_,$))return!0;_e=_e.next}while(_e!==_);return!1}(ut,o)&&(X0(ut,o)&&X0(o,ut)&&function(_,$){let _e=_,it=!1;const ot=(_.x+$.x)/2,ct=(_.y+$.y)/2;do _e.y>ct!=_e.next.y>ct&&_e.next.y!==_e.y&&ot<(_e.next.x-_e.x)*(ct-_e.y)/(_e.next.y-_e.y)+_e.x&&(it=!it),_e=_e.next;while(_e!==_);return it}(ut,o)&&(Gl(ut.prev,ut,o.prev)||Gl(ut,o.prev,o))||pm(ut,o)&&Gl(ut.prev,ut,ut.next)>0&&Gl(o.prev,o,o.next)>0)}function Gl(ut,o,_){return(o.y-ut.y)*(_.x-o.x)-(o.x-ut.x)*(_.y-o.y)}function pm(ut,o){return ut.x===o.x&&ut.y===o.y}function Y0(ut,o,_,$){const _e=fm(Gl(ut,o,_)),it=fm(Gl(ut,o,$)),ot=fm(Gl(_,$,ut)),ct=fm(Gl(_,$,o));return _e!==it&&ot!==ct||!(_e!==0||!Km(ut,_,o))||!(it!==0||!Km(ut,$,o))||!(ot!==0||!Km(_,ut,$))||!(ct!==0||!Km(_,o,$))}function Km(ut,o,_){return o.x<=Math.max(ut.x,_.x)&&o.x>=Math.min(ut.x,_.x)&&o.y<=Math.max(ut.y,_.y)&&o.y>=Math.min(ut.y,_.y)}function fm(ut){return ut>0?1:ut<0?-1:0}function X0(ut,o){return Gl(ut.prev,ut,ut.next)<0?Gl(ut,o,ut.next)>=0&&Gl(ut,ut.prev,o)>=0:Gl(ut,o,ut.prev)<0||Gl(ut,ut.next,o)<0}function pE(ut,o){const _=new yC(ut.i,ut.x,ut.y),$=new yC(o.i,o.x,o.y),_e=ut.next,it=o.prev;return ut.next=o,o.prev=ut,_.next=_e,_e.prev=_,$.next=_,_.prev=$,it.next=$,$.prev=it,$}function mm(ut,o,_,$){const _e=new yC(ut,o,_);return $?(_e.next=$.next,_e.prev=$,$.next.prev=_e,$.next=_e):(_e.prev=_e,_e.next=_e),_e}function mx(ut){ut.next.prev=ut.prev,ut.prev.next=ut.next,ut.prevZ&&(ut.prevZ.nextZ=ut.nextZ),ut.nextZ&&(ut.nextZ.prevZ=ut.prevZ)}function yC(ut,o,_){this.i=ut,this.x=o,this.y=_,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Pv{static area(o){const _=o.length;let $=0;for(let _e=_-1,it=0;it<_;_e=it++)$+=o[_e].x*o[it].y-o[it].x*o[_e].y;return .5*$}static isClockWise(o){return Pv.area(o)<0}static triangulateShape(o,_){const $=[],_e=[],it=[];Im(o),fE($,o);let ot=o.length;_.forEach(Im);for(let mt=0;mt<_.length;mt++)_e.push(ot),ot+=_[mt].length,fE($,_[mt]);const ct=function(mt,gt,St=2){const Tt=gt&&gt.length,Ct=Tt?gt[0]*St:mt.length;let Pt=DT(mt,0,Ct,St,!0);const Ot=[];if(!Pt||Pt.next===Pt.prev)return Ot;let Dt,Yt,Xt,Jt,an,fn,gn;if(Tt&&(Pt=function(_n,On,Ln,$n){const Jn=[];let Un,Er,Or,xr,Gr;for(Un=0,Er=On.length;Un<Er;Un++)Or=On[Un]*$n,xr=Un<Er-1?On[Un+1]*$n:_n.length,Gr=DT(_n,Or,xr,$n,!1),Gr===Gr.next&&(Gr.steiner=!0),Jn.push(Hy(Gr));for(Jn.sort(fx),Un=0;Un<Jn.length;Un++)Iv(Jn[Un],Ln),Ln=q0(Ln,Ln.next);return Ln}(mt,gt,Pt,St)),mt.length>80*St){Dt=Xt=mt[0],Yt=Jt=mt[1];for(let _n=St;_n<Ct;_n+=St)an=mt[_n],fn=mt[_n+1],an<Dt&&(Dt=an),fn<Yt&&(Yt=fn),an>Xt&&(Xt=an),fn>Jt&&(Jt=fn);gn=Math.max(Xt-Dt,Jt-Yt),gn=gn!==0?1/gn:0}return dx(Pt,Ot,St,Dt,Yt,gn),Ot}($,_e);for(let mt=0;mt<ct.length;mt+=3)it.push(ct.slice(mt,mt+3));return it}}function Im(ut){const o=ut.length;o>2&&ut[o-1].equals(ut[0])&&ut.pop()}function fE(ut,o){for(let _=0;_<o.length;_++)ut.push(o[_].x),ut.push(o[_].y)}class gx extends ps{constructor(o=new Gy([new Rr(.5,.5),new Rr(-.5,.5),new Rr(-.5,-.5),new Rr(.5,-.5)]),_={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:o,options:_},o=Array.isArray(o)?o:[o];const $=this,_e=[],it=[];for(let ct=0,mt=o.length;ct<mt;ct++)ot(o[ct]);function ot(ct){const mt=[],gt=_.curveSegments!==void 0?_.curveSegments:12,St=_.steps!==void 0?_.steps:1,Tt=_.depth!==void 0?_.depth:1;let Ct=_.bevelEnabled===void 0||_.bevelEnabled,Pt=_.bevelThickness!==void 0?_.bevelThickness:.2,Ot=_.bevelSize!==void 0?_.bevelSize:Pt-.1,Dt=_.bevelOffset!==void 0?_.bevelOffset:0,Yt=_.bevelSegments!==void 0?_.bevelSegments:3;const Xt=_.extrudePath,Jt=_.UVGenerator!==void 0?_.UVGenerator:fP;let an,fn,gn,_n,On,Ln=!1;Xt&&(an=Xt.getSpacedPoints(St),Ln=!0,Ct=!1,fn=Xt.computeFrenetFrames(St,!1),gn=new An,_n=new An,On=new An),Ct||(Yt=0,Pt=0,Ot=0,Dt=0);const $n=ct.extractPoints(gt);let Jn=$n.shape;const Un=$n.holes;if(!Pv.isClockWise(Jn)){Jn=Jn.reverse();for(let Xn=0,Dn=Un.length;Xn<Dn;Xn++){const Hn=Un[Xn];Pv.isClockWise(Hn)&&(Un[Xn]=Hn.reverse())}}const Er=Pv.triangulateShape(Jn,Un),Or=Jn;for(let Xn=0,Dn=Un.length;Xn<Dn;Xn++){const Hn=Un[Xn];Jn=Jn.concat(Hn)}function xr(Xn,Dn,Hn){return Dn||console.error("THREE.ExtrudeGeometry: vec does not exist"),Dn.clone().multiplyScalar(Hn).add(Xn)}const Gr=Jn.length,Hr=Er.length;function pr(Xn,Dn,Hn){let mr,ln,gr;const tr=Xn.x-Dn.x,br=Xn.y-Dn.y,Tr=Hn.x-Xn.x,$r=Hn.y-Xn.y,Es=tr*tr+br*br,Os=tr*$r-br*Tr;if(Math.abs(Os)>Number.EPSILON){const ro=Math.sqrt(Es),Ps=Math.sqrt(Tr*Tr+$r*$r),Ns=Dn.x-br/ro,Yo=Dn.y+tr/ro,Rm=((Hn.x-$r/Ps-Ns)*$r-(Hn.y+Tr/Ps-Yo)*Tr)/(tr*$r-br*Tr);mr=Ns+tr*Rm-Xn.x,ln=Yo+br*Rm-Xn.y;const Zs=mr*mr+ln*ln;if(Zs<=2)return new Rr(mr,ln);gr=Math.sqrt(Zs/2)}else{let ro=!1;tr>Number.EPSILON?Tr>Number.EPSILON&&(ro=!0):tr<-Number.EPSILON?Tr<-Number.EPSILON&&(ro=!0):Math.sign(br)===Math.sign($r)&&(ro=!0),ro?(mr=-br,ln=tr,gr=Math.sqrt(Es)):(mr=tr,ln=br,gr=Math.sqrt(Es/2))}return new Rr(mr/gr,ln/gr)}const vr=[];for(let Xn=0,Dn=Or.length,Hn=Dn-1,mr=Xn+1;Xn<Dn;Xn++,Hn++,mr++)Hn===Dn&&(Hn=0),mr===Dn&&(mr=0),vr[Xn]=pr(Or[Xn],Or[Hn],Or[mr]);const jr=[];let Sr,Qr=vr.concat();for(let Xn=0,Dn=Un.length;Xn<Dn;Xn++){const Hn=Un[Xn];Sr=[];for(let mr=0,ln=Hn.length,gr=ln-1,tr=mr+1;mr<ln;mr++,gr++,tr++)gr===ln&&(gr=0),tr===ln&&(tr=0),Sr[mr]=pr(Hn[mr],Hn[gr],Hn[tr]);jr.push(Sr),Qr=Qr.concat(Sr)}for(let Xn=0;Xn<Yt;Xn++){const Dn=Xn/Yt,Hn=Pt*Math.cos(Dn*Math.PI/2),mr=Ot*Math.sin(Dn*Math.PI/2)+Dt;for(let ln=0,gr=Or.length;ln<gr;ln++){const tr=xr(Or[ln],vr[ln],mr);bs(tr.x,tr.y,-Hn)}for(let ln=0,gr=Un.length;ln<gr;ln++){const tr=Un[ln];Sr=jr[ln];for(let br=0,Tr=tr.length;br<Tr;br++){const $r=xr(tr[br],Sr[br],mr);bs($r.x,$r.y,-Hn)}}}const As=Ot+Dt;for(let Xn=0;Xn<Gr;Xn++){const Dn=Ct?xr(Jn[Xn],Qr[Xn],As):Jn[Xn];Ln?(_n.copy(fn.normals[0]).multiplyScalar(Dn.x),gn.copy(fn.binormals[0]).multiplyScalar(Dn.y),On.copy(an[0]).add(_n).add(gn),bs(On.x,On.y,On.z)):bs(Dn.x,Dn.y,0)}for(let Xn=1;Xn<=St;Xn++)for(let Dn=0;Dn<Gr;Dn++){const Hn=Ct?xr(Jn[Dn],Qr[Dn],As):Jn[Dn];Ln?(_n.copy(fn.normals[Xn]).multiplyScalar(Hn.x),gn.copy(fn.binormals[Xn]).multiplyScalar(Hn.y),On.copy(an[Xn]).add(_n).add(gn),bs(On.x,On.y,On.z)):bs(Hn.x,Hn.y,Tt/St*Xn)}for(let Xn=Yt-1;Xn>=0;Xn--){const Dn=Xn/Yt,Hn=Pt*Math.cos(Dn*Math.PI/2),mr=Ot*Math.sin(Dn*Math.PI/2)+Dt;for(let ln=0,gr=Or.length;ln<gr;ln++){const tr=xr(Or[ln],vr[ln],mr);bs(tr.x,tr.y,Tt+Hn)}for(let ln=0,gr=Un.length;ln<gr;ln++){const tr=Un[ln];Sr=jr[ln];for(let br=0,Tr=tr.length;br<Tr;br++){const $r=xr(tr[br],Sr[br],mr);Ln?bs($r.x,$r.y+an[St-1].y,an[St-1].x+Hn):bs($r.x,$r.y,Tt+Hn)}}}function go(Xn,Dn){let Hn=Xn.length;for(;--Hn>=0;){const mr=Hn;let ln=Hn-1;ln<0&&(ln=Xn.length-1);for(let gr=0,tr=St+2*Yt;gr<tr;gr++){const br=Gr*gr,Tr=Gr*(gr+1);Pn(Dn+mr+br,Dn+ln+br,Dn+ln+Tr,Dn+mr+Tr)}}}function bs(Xn,Dn,Hn){mt.push(Xn),mt.push(Dn),mt.push(Hn)}function lo(Xn,Dn,Hn){Sn(Xn),Sn(Dn),Sn(Hn);const mr=_e.length/3,ln=Jt.generateTopUV($,_e,mr-3,mr-2,mr-1);ir(ln[0]),ir(ln[1]),ir(ln[2])}function Pn(Xn,Dn,Hn,mr){Sn(Xn),Sn(Dn),Sn(mr),Sn(Dn),Sn(Hn),Sn(mr);const ln=_e.length/3,gr=Jt.generateSideWallUV($,_e,ln-6,ln-3,ln-2,ln-1);ir(gr[0]),ir(gr[1]),ir(gr[3]),ir(gr[1]),ir(gr[2]),ir(gr[3])}function Sn(Xn){_e.push(mt[3*Xn+0]),_e.push(mt[3*Xn+1]),_e.push(mt[3*Xn+2])}function ir(Xn){it.push(Xn.x),it.push(Xn.y)}(function(){const Xn=_e.length/3;if(Ct){let Dn=0,Hn=Gr*Dn;for(let mr=0;mr<Hr;mr++){const ln=Er[mr];lo(ln[2]+Hn,ln[1]+Hn,ln[0]+Hn)}Dn=St+2*Yt,Hn=Gr*Dn;for(let mr=0;mr<Hr;mr++){const ln=Er[mr];lo(ln[0]+Hn,ln[1]+Hn,ln[2]+Hn)}}else{for(let Dn=0;Dn<Hr;Dn++){const Hn=Er[Dn];lo(Hn[2],Hn[1],Hn[0])}for(let Dn=0;Dn<Hr;Dn++){const Hn=Er[Dn];lo(Hn[0]+Gr*St,Hn[1]+Gr*St,Hn[2]+Gr*St)}}$.addGroup(Xn,_e.length/3-Xn,0)})(),function(){const Xn=_e.length/3;let Dn=0;go(Or,Dn),Dn+=Or.length;for(let Hn=0,mr=Un.length;Hn<mr;Hn++){const ln=Un[Hn];go(ln,Dn),Dn+=ln.length}$.addGroup(Xn,_e.length/3-Xn,1)}()}this.setAttribute("position",new dt(_e,3)),this.setAttribute("uv",new dt(it,2)),this.computeVertexNormals()}toJSON(){const o=super.toJSON();return function(_,$,_e){if(_e.shapes=[],Array.isArray(_))for(let it=0,ot=_.length;it<ot;it++){const ct=_[it];_e.shapes.push(ct.uuid)}else _e.shapes.push(_.uuid);return _e.options=Object.assign({},$),$.extrudePath!==void 0&&(_e.options.extrudePath=$.extrudePath.toJSON()),_e}(this.parameters.shapes,this.parameters.options,o)}static fromJSON(o,_){const $=[];for(let it=0,ot=o.shapes.length;it<ot;it++){const ct=_[o.shapes[it]];$.push(ct)}const _e=o.options.extrudePath;return _e!==void 0&&(o.options.extrudePath=new Uo[_e.type]().fromJSON(_e)),new gx($,o.options)}}const fP={generateTopUV:function(ut,o,_,$,_e){const it=o[3*_],ot=o[3*_+1],ct=o[3*$],mt=o[3*$+1],gt=o[3*_e],St=o[3*_e+1];return[new Rr(it,ot),new Rr(ct,mt),new Rr(gt,St)]},generateSideWallUV:function(ut,o,_,$,_e,it){const ot=o[3*_],ct=o[3*_+1],mt=o[3*_+2],gt=o[3*$],St=o[3*$+1],Tt=o[3*$+2],Ct=o[3*_e],Pt=o[3*_e+1],Ot=o[3*_e+2],Dt=o[3*it],Yt=o[3*it+1],Xt=o[3*it+2];return Math.abs(ct-St)<Math.abs(ot-gt)?[new Rr(ot,1-mt),new Rr(gt,1-Tt),new Rr(Ct,1-Ot),new Rr(Dt,1-Xt)]:[new Rr(ct,1-mt),new Rr(St,1-Tt),new Rr(Pt,1-Ot),new Rr(Yt,1-Xt)]}};class ZA extends K_{constructor(o=1,_=0){const $=(1+Math.sqrt(5))/2;super([-1,$,0,1,$,0,-1,-$,0,1,-$,0,0,-1,$,0,1,$,0,-1,-$,0,1,-$,$,0,-1,$,0,1,-$,0,-1,-$,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],o,_),this.type="IcosahedronGeometry",this.parameters={radius:o,detail:_}}static fromJSON(o){return new ZA(o.radius,o.detail)}}class pp extends K_{constructor(o=1,_=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],o,_),this.type="OctahedronGeometry",this.parameters={radius:o,detail:_}}static fromJSON(o){return new pp(o.radius,o.detail)}}class Wy extends ps{constructor(o=.5,_=1,$=8,_e=1,it=0,ot=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:o,outerRadius:_,thetaSegments:$,phiSegments:_e,thetaStart:it,thetaLength:ot},$=Math.max(3,$);const ct=[],mt=[],gt=[],St=[];let Tt=o;const Ct=(_-o)/(_e=Math.max(1,_e)),Pt=new An,Ot=new Rr;for(let Dt=0;Dt<=_e;Dt++){for(let Yt=0;Yt<=$;Yt++){const Xt=it+Yt/$*ot;Pt.x=Tt*Math.cos(Xt),Pt.y=Tt*Math.sin(Xt),mt.push(Pt.x,Pt.y,Pt.z),gt.push(0,0,1),Ot.x=(Pt.x/_+1)/2,Ot.y=(Pt.y/_+1)/2,St.push(Ot.x,Ot.y)}Tt+=Ct}for(let Dt=0;Dt<_e;Dt++){const Yt=Dt*($+1);for(let Xt=0;Xt<$;Xt++){const Jt=Xt+Yt,an=Jt,fn=Jt+$+1,gn=Jt+$+2,_n=Jt+1;ct.push(an,fn,_n),ct.push(fn,gn,_n)}}this.setIndex(ct),this.setAttribute("position",new dt(mt,3)),this.setAttribute("normal",new dt(gt,3)),this.setAttribute("uv",new dt(St,2))}static fromJSON(o){return new Wy(o.innerRadius,o.outerRadius,o.thetaSegments,o.phiSegments,o.thetaStart,o.thetaLength)}}class vx extends ps{constructor(o=new Gy([new Rr(0,.5),new Rr(-.5,-.5),new Rr(.5,-.5)]),_=12){super(),this.type="ShapeGeometry",this.parameters={shapes:o,curveSegments:_};const $=[],_e=[],it=[],ot=[];let ct=0,mt=0;if(Array.isArray(o)===!1)gt(o);else for(let St=0;St<o.length;St++)gt(o[St]),this.addGroup(ct,mt,St),ct+=mt,mt=0;function gt(St){const Tt=_e.length/3,Ct=St.extractPoints(_);let Pt=Ct.shape;const Ot=Ct.holes;Pv.isClockWise(Pt)===!1&&(Pt=Pt.reverse());for(let Yt=0,Xt=Ot.length;Yt<Xt;Yt++){const Jt=Ot[Yt];Pv.isClockWise(Jt)===!0&&(Ot[Yt]=Jt.reverse())}const Dt=Pv.triangulateShape(Pt,Ot);for(let Yt=0,Xt=Ot.length;Yt<Xt;Yt++){const Jt=Ot[Yt];Pt=Pt.concat(Jt)}for(let Yt=0,Xt=Pt.length;Yt<Xt;Yt++){const Jt=Pt[Yt];_e.push(Jt.x,Jt.y,0),it.push(0,0,1),ot.push(Jt.x,Jt.y)}for(let Yt=0,Xt=Dt.length;Yt<Xt;Yt++){const Jt=Dt[Yt],an=Jt[0]+Tt,fn=Jt[1]+Tt,gn=Jt[2]+Tt;$.push(an,fn,gn),mt+=3}}this.setIndex($),this.setAttribute("position",new dt(_e,3)),this.setAttribute("normal",new dt(it,3)),this.setAttribute("uv",new dt(ot,2))}toJSON(){const o=super.toJSON();return function(_,$){if($.shapes=[],Array.isArray(_))for(let _e=0,it=_.length;_e<it;_e++){const ot=_[_e];$.shapes.push(ot.uuid)}else $.shapes.push(_.uuid);return $}(this.parameters.shapes,o)}static fromJSON(o,_){const $=[];for(let _e=0,it=o.shapes.length;_e<it;_e++){const ot=_[o.shapes[_e]];$.push(ot)}return new vx($,o.curveSegments)}}class ew extends ps{constructor(o=1,_=32,$=16,_e=0,it=2*Math.PI,ot=0,ct=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:o,widthSegments:_,heightSegments:$,phiStart:_e,phiLength:it,thetaStart:ot,thetaLength:ct},_=Math.max(3,Math.floor(_)),$=Math.max(2,Math.floor($));const mt=Math.min(ot+ct,Math.PI);let gt=0;const St=[],Tt=new An,Ct=new An,Pt=[],Ot=[],Dt=[],Yt=[];for(let Xt=0;Xt<=$;Xt++){const Jt=[],an=Xt/$;let fn=0;Xt==0&&ot==0?fn=.5/_:Xt==$&&mt==Math.PI&&(fn=-.5/_);for(let gn=0;gn<=_;gn++){const _n=gn/_;Tt.x=-o*Math.cos(_e+_n*it)*Math.sin(ot+an*ct),Tt.y=o*Math.cos(ot+an*ct),Tt.z=o*Math.sin(_e+_n*it)*Math.sin(ot+an*ct),Ot.push(Tt.x,Tt.y,Tt.z),Ct.copy(Tt).normalize(),Dt.push(Ct.x,Ct.y,Ct.z),Yt.push(_n+fn,1-an),Jt.push(gt++)}St.push(Jt)}for(let Xt=0;Xt<$;Xt++)for(let Jt=0;Jt<_;Jt++){const an=St[Xt][Jt+1],fn=St[Xt][Jt],gn=St[Xt+1][Jt],_n=St[Xt+1][Jt+1];(Xt!==0||ot>0)&&Pt.push(an,fn,_n),(Xt!==$-1||mt<Math.PI)&&Pt.push(fn,gn,_n)}this.setIndex(Pt),this.setAttribute("position",new dt(Ot,3)),this.setAttribute("normal",new dt(Dt,3)),this.setAttribute("uv",new dt(Yt,2))}static fromJSON(o){return new ew(o.radius,o.widthSegments,o.heightSegments,o.phiStart,o.phiLength,o.thetaStart,o.thetaLength)}}class qy extends K_{constructor(o=1,_=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],o,_),this.type="TetrahedronGeometry",this.parameters={radius:o,detail:_}}static fromJSON(o){return new qy(o.radius,o.detail)}}class K0 extends ps{constructor(o=1,_=.4,$=8,_e=6,it=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:o,tube:_,radialSegments:$,tubularSegments:_e,arc:it},$=Math.floor($),_e=Math.floor(_e);const ot=[],ct=[],mt=[],gt=[],St=new An,Tt=new An,Ct=new An;for(let Pt=0;Pt<=$;Pt++)for(let Ot=0;Ot<=_e;Ot++){const Dt=Ot/_e*it,Yt=Pt/$*Math.PI*2;Tt.x=(o+_*Math.cos(Yt))*Math.cos(Dt),Tt.y=(o+_*Math.cos(Yt))*Math.sin(Dt),Tt.z=_*Math.sin(Yt),ct.push(Tt.x,Tt.y,Tt.z),St.x=o*Math.cos(Dt),St.y=o*Math.sin(Dt),Ct.subVectors(Tt,St).normalize(),mt.push(Ct.x,Ct.y,Ct.z),gt.push(Ot/_e),gt.push(Pt/$)}for(let Pt=1;Pt<=$;Pt++)for(let Ot=1;Ot<=_e;Ot++){const Dt=(_e+1)*Pt+Ot-1,Yt=(_e+1)*(Pt-1)+Ot-1,Xt=(_e+1)*(Pt-1)+Ot,Jt=(_e+1)*Pt+Ot;ot.push(Dt,Yt,Jt),ot.push(Yt,Xt,Jt)}this.setIndex(ot),this.setAttribute("position",new dt(ct,3)),this.setAttribute("normal",new dt(mt,3)),this.setAttribute("uv",new dt(gt,2))}static fromJSON(o){return new K0(o.radius,o.tube,o.radialSegments,o.tubularSegments,o.arc)}}class np extends ps{constructor(o=1,_=.4,$=64,_e=8,it=2,ot=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:o,tube:_,tubularSegments:$,radialSegments:_e,p:it,q:ot},$=Math.floor($),_e=Math.floor(_e);const ct=[],mt=[],gt=[],St=[],Tt=new An,Ct=new An,Pt=new An,Ot=new An,Dt=new An,Yt=new An,Xt=new An;for(let an=0;an<=$;++an){const fn=an/$*it*Math.PI*2;Jt(fn,it,ot,o,Pt),Jt(fn+.01,it,ot,o,Ot),Yt.subVectors(Ot,Pt),Xt.addVectors(Ot,Pt),Dt.crossVectors(Yt,Xt),Xt.crossVectors(Dt,Yt),Dt.normalize(),Xt.normalize();for(let gn=0;gn<=_e;++gn){const _n=gn/_e*Math.PI*2,On=-_*Math.cos(_n),Ln=_*Math.sin(_n);Tt.x=Pt.x+(On*Xt.x+Ln*Dt.x),Tt.y=Pt.y+(On*Xt.y+Ln*Dt.y),Tt.z=Pt.z+(On*Xt.z+Ln*Dt.z),mt.push(Tt.x,Tt.y,Tt.z),Ct.subVectors(Tt,Pt).normalize(),gt.push(Ct.x,Ct.y,Ct.z),St.push(an/$),St.push(gn/_e)}}for(let an=1;an<=$;an++)for(let fn=1;fn<=_e;fn++){const gn=(_e+1)*(an-1)+(fn-1),_n=(_e+1)*an+(fn-1),On=(_e+1)*an+fn,Ln=(_e+1)*(an-1)+fn;ct.push(gn,_n,Ln),ct.push(_n,On,Ln)}function Jt(an,fn,gn,_n,On){const Ln=Math.cos(an),$n=Math.sin(an),Jn=gn/fn*an,Un=Math.cos(Jn);On.x=_n*(2+Un)*.5*Ln,On.y=_n*(2+Un)*$n*.5,On.z=_n*Math.sin(Jn)*.5}this.setIndex(ct),this.setAttribute("position",new dt(mt,3)),this.setAttribute("normal",new dt(gt,3)),this.setAttribute("uv",new dt(St,2))}static fromJSON(o){return new np(o.radius,o.tube,o.tubularSegments,o.radialSegments,o.p,o.q)}}class _x extends ps{constructor(o=new uE(new An(-1,-1,0),new An(-1,1,0),new An(1,1,0)),_=64,$=1,_e=8,it=!1){super(),this.type="TubeGeometry",this.parameters={path:o,tubularSegments:_,radius:$,radialSegments:_e,closed:it};const ot=o.computeFrenetFrames(_,it);this.tangents=ot.tangents,this.normals=ot.normals,this.binormals=ot.binormals;const ct=new An,mt=new An,gt=new Rr;let St=new An;const Tt=[],Ct=[],Pt=[],Ot=[];function Dt(Yt){St=o.getPointAt(Yt/_,St);const Xt=ot.normals[Yt],Jt=ot.binormals[Yt];for(let an=0;an<=_e;an++){const fn=an/_e*Math.PI*2,gn=Math.sin(fn),_n=-Math.cos(fn);mt.x=_n*Xt.x+gn*Jt.x,mt.y=_n*Xt.y+gn*Jt.y,mt.z=_n*Xt.z+gn*Jt.z,mt.normalize(),Ct.push(mt.x,mt.y,mt.z),ct.x=St.x+$*mt.x,ct.y=St.y+$*mt.y,ct.z=St.z+$*mt.z,Tt.push(ct.x,ct.y,ct.z)}}(function(){for(let Yt=0;Yt<_;Yt++)Dt(Yt);Dt(it===!1?_:0),function(){for(let Yt=0;Yt<=_;Yt++)for(let Xt=0;Xt<=_e;Xt++)gt.x=Yt/_,gt.y=Xt/_e,Pt.push(gt.x,gt.y)}(),function(){for(let Yt=1;Yt<=_;Yt++)for(let Xt=1;Xt<=_e;Xt++){const Jt=(_e+1)*(Yt-1)+(Xt-1),an=(_e+1)*Yt+(Xt-1),fn=(_e+1)*Yt+Xt,gn=(_e+1)*(Yt-1)+Xt;Ot.push(Jt,an,gn),Ot.push(an,fn,gn)}}()})(),this.setIndex(Ot),this.setAttribute("position",new dt(Tt,3)),this.setAttribute("normal",new dt(Ct,3)),this.setAttribute("uv",new dt(Pt,2))}toJSON(){const o=super.toJSON();return o.path=this.parameters.path.toJSON(),o}static fromJSON(o){return new _x(new Uo[o.path.type]().fromJSON(o.path),o.tubularSegments,o.radius,o.radialSegments,o.closed)}}class OT extends ps{constructor(o=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:o},o!==null){const _=[],$=new Set,_e=new An,it=new An;if(o.index!==null){const ot=o.attributes.position,ct=o.index;let mt=o.groups;mt.length===0&&(mt=[{start:0,count:ct.count,materialIndex:0}]);for(let gt=0,St=mt.length;gt<St;++gt){const Tt=mt[gt],Ct=Tt.start;for(let Pt=Ct,Ot=Ct+Tt.count;Pt<Ot;Pt+=3)for(let Dt=0;Dt<3;Dt++){const Yt=ct.getX(Pt+Dt),Xt=ct.getX(Pt+(Dt+1)%3);_e.fromBufferAttribute(ot,Yt),it.fromBufferAttribute(ot,Xt),AC(_e,it,$)===!0&&(_.push(_e.x,_e.y,_e.z),_.push(it.x,it.y,it.z))}}}else{const ot=o.attributes.position;for(let ct=0,mt=ot.count/3;ct<mt;ct++)for(let gt=0;gt<3;gt++){const St=3*ct+gt,Tt=3*ct+(gt+1)%3;_e.fromBufferAttribute(ot,St),it.fromBufferAttribute(ot,Tt),AC(_e,it,$)===!0&&(_.push(_e.x,_e.y,_e.z),_.push(it.x,it.y,it.z))}}this.setAttribute("position",new dt(_,3))}}}function AC(ut,o,_){const $=`${ut.x},${ut.y},${ut.z}-${o.x},${o.y},${o.z}`,_e=`${o.x},${o.y},${o.z}-${ut.x},${ut.y},${ut.z}`;return _.has($)!==!0&&_.has(_e)!==!0&&(_.add($),_.add(_e),!0)}var $m=Object.freeze({__proto__:null,BoxGeometry:qm,CapsuleGeometry:cx,CircleGeometry:Tm,ConeGeometry:Rl,CylinderGeometry:zu,DodecahedronGeometry:ux,EdgesGeometry:hE,ExtrudeGeometry:gx,IcosahedronGeometry:ZA,LatheGeometry:Xl,OctahedronGeometry:pp,PlaneGeometry:j0,PolyhedronGeometry:K_,RingGeometry:Wy,ShapeGeometry:vx,SphereGeometry:ew,TetrahedronGeometry:qy,TorusGeometry:K0,TorusKnotGeometry:np,TubeGeometry:_x,WireframeGeometry:OT});class mE extends Uu{constructor(o){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new is(0),this.transparent=!0,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.fog=o.fog,this}}class LT extends Av{constructor(o){super(o),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class wC extends Uu{constructor(o){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new is(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new is(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ru,this.normalScale=new Rr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.defines={STANDARD:""},this.color.copy(o.color),this.roughness=o.roughness,this.metalness=o.metalness,this.map=o.map,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.emissive.copy(o.emissive),this.emissiveMap=o.emissiveMap,this.emissiveIntensity=o.emissiveIntensity,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.roughnessMap=o.roughnessMap,this.metalnessMap=o.metalnessMap,this.alphaMap=o.alphaMap,this.envMap=o.envMap,this.envMapIntensity=o.envMapIntensity,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.flatShading=o.flatShading,this.fog=o.fog,this}}class xC extends wC{constructor(o){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Rr(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Ms(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(_){this.ior=(1+.4*_)/(1-.4*_)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new is(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new is(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new is(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(o)}get sheen(){return this._sheen}set sheen(o){this._sheen>0!=o>0&&this.version++,this._sheen=o}get clearcoat(){return this._clearcoat}set clearcoat(o){this._clearcoat>0!=o>0&&this.version++,this._clearcoat=o}get iridescence(){return this._iridescence}set iridescence(o){this._iridescence>0!=o>0&&this.version++,this._iridescence=o}get transmission(){return this._transmission}set transmission(o){this._transmission>0!=o>0&&this.version++,this._transmission=o}copy(o){return super.copy(o),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=o.clearcoat,this.clearcoatMap=o.clearcoatMap,this.clearcoatRoughness=o.clearcoatRoughness,this.clearcoatRoughnessMap=o.clearcoatRoughnessMap,this.clearcoatNormalMap=o.clearcoatNormalMap,this.clearcoatNormalScale.copy(o.clearcoatNormalScale),this.ior=o.ior,this.iridescence=o.iridescence,this.iridescenceMap=o.iridescenceMap,this.iridescenceIOR=o.iridescenceIOR,this.iridescenceThicknessRange=[...o.iridescenceThicknessRange],this.iridescenceThicknessMap=o.iridescenceThicknessMap,this.sheen=o.sheen,this.sheenColor.copy(o.sheenColor),this.sheenColorMap=o.sheenColorMap,this.sheenRoughness=o.sheenRoughness,this.sheenRoughnessMap=o.sheenRoughnessMap,this.transmission=o.transmission,this.transmissionMap=o.transmissionMap,this.thickness=o.thickness,this.thicknessMap=o.thicknessMap,this.attenuationDistance=o.attenuationDistance,this.attenuationColor.copy(o.attenuationColor),this.specularIntensity=o.specularIntensity,this.specularIntensityMap=o.specularIntensityMap,this.specularColor.copy(o.specularColor),this.specularColorMap=o.specularColorMap,this}}class yx extends Uu{constructor(o){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new is(16777215),this.specular=new is(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new is(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ru,this.normalScale=new Rr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ls,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.specular.copy(o.specular),this.shininess=o.shininess,this.map=o.map,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.emissive.copy(o.emissive),this.emissiveMap=o.emissiveMap,this.emissiveIntensity=o.emissiveIntensity,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.specularMap=o.specularMap,this.alphaMap=o.alphaMap,this.envMap=o.envMap,this.combine=o.combine,this.reflectivity=o.reflectivity,this.refractionRatio=o.refractionRatio,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.flatShading=o.flatShading,this.fog=o.fog,this}}class NT extends Uu{constructor(o){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new is(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new is(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ru,this.normalScale=new Rr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.gradientMap=o.gradientMap,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.emissive.copy(o.emissive),this.emissiveMap=o.emissiveMap,this.emissiveIntensity=o.emissiveIntensity,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.alphaMap=o.alphaMap,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.fog=o.fog,this}}class Ax extends Uu{constructor(o){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ru,this.normalScale=new Rr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(o)}copy(o){return super.copy(o),this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.flatShading=o.flatShading,this}}class bC extends Uu{constructor(o){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new is(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new is(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ru,this.normalScale=new Rr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ls,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.emissive.copy(o.emissive),this.emissiveMap=o.emissiveMap,this.emissiveIntensity=o.emissiveIntensity,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.specularMap=o.specularMap,this.alphaMap=o.alphaMap,this.envMap=o.envMap,this.combine=o.combine,this.reflectivity=o.reflectivity,this.refractionRatio=o.refractionRatio,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.flatShading=o.flatShading,this.fog=o.fog,this}}class wx extends Uu{constructor(o){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new is(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ru,this.normalScale=new Rr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.defines={MATCAP:""},this.color.copy(o.color),this.matcap=o.matcap,this.map=o.map,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.alphaMap=o.alphaMap,this.flatShading=o.flatShading,this.fog=o.fog,this}}class EC extends Np{constructor(o){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(o)}copy(o){return super.copy(o),this.scale=o.scale,this.dashSize=o.dashSize,this.gapSize=o.gapSize,this}}function Pm(ut,o,_){return tu(ut)?new ut.constructor(ut.subarray(o,_!==void 0?_:ut.length)):ut.slice(o,_)}function gm(ut,o,_){return!ut||!_&&ut.constructor===o?ut:typeof o.BYTES_PER_ELEMENT=="number"?new o(ut):Array.prototype.slice.call(ut)}function tu(ut){return ArrayBuffer.isView(ut)&&!(ut instanceof DataView)}function FT(ut){const o=ut.length,_=new Array(o);for(let $=0;$!==o;++$)_[$]=$;return _.sort(function($,_e){return ut[$]-ut[_e]}),_}function Fp(ut,o,_){const $=ut.length,_e=new ut.constructor($);for(let it=0,ot=0;ot!==$;++it){const ct=_[it]*o;for(let mt=0;mt!==o;++mt)_e[ot++]=ut[ct+mt]}return _e}function lu(ut,o,_,$){let _e=1,it=ut[0];for(;it!==void 0&&it[$]===void 0;)it=ut[_e++];if(it===void 0)return;let ot=it[$];if(ot!==void 0)if(Array.isArray(ot))do ot=it[$],ot!==void 0&&(o.push(it.time),_.push.apply(_,ot)),it=ut[_e++];while(it!==void 0);else if(ot.toArray!==void 0)do ot=it[$],ot!==void 0&&(o.push(it.time),ot.toArray(_,_.length)),it=ut[_e++];while(it!==void 0);else do ot=it[$],ot!==void 0&&(o.push(it.time),_.push(ot)),it=ut[_e++];while(it!==void 0)}var xx=Object.freeze({__proto__:null,arraySlice:Pm,convertArray:gm,isTypedArray:tu,getKeyframeOrder:FT,sortedArray:Fp,flattenJSON:lu,subclip:function(ut,o,_,$,_e=30){const it=ut.clone();it.name=o;const ot=[];for(let mt=0;mt<it.tracks.length;++mt){const gt=it.tracks[mt],St=gt.getValueSize(),Tt=[],Ct=[];for(let Pt=0;Pt<gt.times.length;++Pt){const Ot=gt.times[Pt]*_e;if(!(Ot<_||Ot>=$)){Tt.push(gt.times[Pt]);for(let Dt=0;Dt<St;++Dt)Ct.push(gt.values[Pt*St+Dt])}}Tt.length!==0&&(gt.times=gm(Tt,gt.times.constructor),gt.values=gm(Ct,gt.values.constructor),ot.push(gt))}it.tracks=ot;let ct=1/0;for(let mt=0;mt<it.tracks.length;++mt)ct>it.tracks[mt].times[0]&&(ct=it.tracks[mt].times[0]);for(let mt=0;mt<it.tracks.length;++mt)it.tracks[mt].shift(-1*ct);return it.resetDuration(),it},makeClipAdditive:function(ut,o=0,_=ut,$=30){$<=0&&($=30);const _e=_.tracks.length,it=o/$;for(let ot=0;ot<_e;++ot){const ct=_.tracks[ot],mt=ct.ValueTypeName;if(mt==="bool"||mt==="string")continue;const gt=ut.tracks.find(function(Xt){return Xt.name===ct.name&&Xt.ValueTypeName===mt});if(gt===void 0)continue;let St=0;const Tt=ct.getValueSize();ct.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(St=Tt/3);let Ct=0;const Pt=gt.getValueSize();gt.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(Ct=Pt/3);const Ot=ct.times.length-1;let Dt;if(it<=ct.times[0]){const Xt=St,Jt=Tt-St;Dt=Pm(ct.values,Xt,Jt)}else if(it>=ct.times[Ot]){const Xt=Ot*Tt+St,Jt=Xt+Tt-St;Dt=Pm(ct.values,Xt,Jt)}else{const Xt=ct.createInterpolant(),Jt=St,an=Tt-St;Xt.evaluate(it),Dt=Pm(Xt.resultBuffer,Jt,an)}mt==="quaternion"&&new Lu().fromArray(Dt).normalize().conjugate().toArray(Dt);const Yt=gt.times.length;for(let Xt=0;Xt<Yt;++Xt){const Jt=Xt*Pt+Ct;if(mt==="quaternion")Lu.multiplyQuaternionsFlat(gt.values,Jt,Dt,0,gt.values,Jt);else{const an=Pt-2*Ct;for(let fn=0;fn<an;++fn)gt.values[Jt+fn]-=Dt[fn]}}}return ut.blendMode=gA,ut}});class Yy{constructor(o,_,$,_e){this.parameterPositions=o,this._cachedIndex=0,this.resultBuffer=_e!==void 0?_e:new _.constructor($),this.sampleValues=_,this.valueSize=$,this.settings=null,this.DefaultSettings_={}}evaluate(o){const _=this.parameterPositions;let $=this._cachedIndex,_e=_[$],it=_[$-1];e:{t:{let ot;n:{r:if(!(o<_e)){for(let ct=$+2;;){if(_e===void 0){if(o<it)break r;return $=_.length,this._cachedIndex=$,this.copySampleValue_($-1)}if($===ct)break;if(it=_e,_e=_[++$],o<_e)break t}ot=_.length;break n}if(o>=it)break e;{const ct=_[1];o<ct&&($=2,it=ct);for(let mt=$-2;;){if(it===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if($===mt)break;if(_e=it,it=_[--$-1],o>=it)break t}ot=$,$=0}}for(;$<ot;){const ct=$+ot>>>1;o<_[ct]?ot=ct:$=ct+1}if(_e=_[$],it=_[$-1],it===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(_e===void 0)return $=_.length,this._cachedIndex=$,this.copySampleValue_($-1)}this._cachedIndex=$,this.intervalChanged_($,it,_e)}return this.interpolate_($,it,o,_e)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(o){const _=this.resultBuffer,$=this.sampleValues,_e=this.valueSize,it=o*_e;for(let ot=0;ot!==_e;++ot)_[ot]=$[it+ot];return _}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class gE extends Yy{constructor(o,_,$,_e){super(o,_,$,_e),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:_u,endingEnd:_u}}intervalChanged_(o,_,$){const _e=this.parameterPositions;let it=o-2,ot=o+1,ct=_e[it],mt=_e[ot];if(ct===void 0)switch(this.getSettings_().endingStart){case Xp:it=o,ct=2*_-$;break;case E_:it=_e.length-2,ct=_+_e[it]-_e[it+1];break;default:it=o,ct=$}if(mt===void 0)switch(this.getSettings_().endingEnd){case Xp:ot=o,mt=2*$-_;break;case E_:ot=1,mt=$+_e[1]-_e[0];break;default:ot=o-1,mt=_}const gt=.5*($-_),St=this.valueSize;this._weightPrev=gt/(_-ct),this._weightNext=gt/(mt-$),this._offsetPrev=it*St,this._offsetNext=ot*St}interpolate_(o,_,$,_e){const it=this.resultBuffer,ot=this.sampleValues,ct=this.valueSize,mt=o*ct,gt=mt-ct,St=this._offsetPrev,Tt=this._offsetNext,Ct=this._weightPrev,Pt=this._weightNext,Ot=($-_)/(_e-_),Dt=Ot*Ot,Yt=Dt*Ot,Xt=-Ct*Yt+2*Ct*Dt-Ct*Ot,Jt=(1+Ct)*Yt+(-1.5-2*Ct)*Dt+(-.5+Ct)*Ot+1,an=(-1-Pt)*Yt+(1.5+Pt)*Dt+.5*Ot,fn=Pt*Yt-Pt*Dt;for(let gn=0;gn!==ct;++gn)it[gn]=Xt*ot[St+gn]+Jt*ot[gt+gn]+an*ot[mt+gn]+fn*ot[Tt+gn];return it}}class SC extends Yy{constructor(o,_,$,_e){super(o,_,$,_e)}interpolate_(o,_,$,_e){const it=this.resultBuffer,ot=this.sampleValues,ct=this.valueSize,mt=o*ct,gt=mt-ct,St=($-_)/(_e-_),Tt=1-St;for(let Ct=0;Ct!==ct;++Ct)it[Ct]=ot[gt+Ct]*Tt+ot[mt+Ct]*St;return it}}class CC extends Yy{constructor(o,_,$,_e){super(o,_,$,_e)}interpolate_(o){return this.copySampleValue_(o-1)}}class Dv{constructor(o,_,$,_e){if(o===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(_===void 0||_.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+o);this.name=o,this.times=gm(_,this.TimeBufferType),this.values=gm($,this.ValueBufferType),this.setInterpolation(_e||this.DefaultInterpolation)}static toJSON(o){const _=o.constructor;let $;if(_.toJSON!==this.toJSON)$=_.toJSON(o);else{$={name:o.name,times:gm(o.times,Array),values:gm(o.values,Array)};const _e=o.getInterpolation();_e!==o.DefaultInterpolation&&($.interpolation=_e)}return $.type=o.ValueTypeName,$}InterpolantFactoryMethodDiscrete(o){return new CC(this.times,this.values,this.getValueSize(),o)}InterpolantFactoryMethodLinear(o){return new SC(this.times,this.values,this.getValueSize(),o)}InterpolantFactoryMethodSmooth(o){return new gE(this.times,this.values,this.getValueSize(),o)}setInterpolation(o){let _;switch(o){case b_:_=this.InterpolantFactoryMethodDiscrete;break;case w0:_=this.InterpolantFactoryMethodLinear;break;case Du:_=this.InterpolantFactoryMethodSmooth}if(_===void 0){const $="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(o===this.DefaultInterpolation)throw new Error($);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",$),this}return this.createInterpolant=_,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return b_;case this.InterpolantFactoryMethodLinear:return w0;case this.InterpolantFactoryMethodSmooth:return Du}}getValueSize(){return this.values.length/this.times.length}shift(o){if(o!==0){const _=this.times;for(let $=0,_e=_.length;$!==_e;++$)_[$]+=o}return this}scale(o){if(o!==1){const _=this.times;for(let $=0,_e=_.length;$!==_e;++$)_[$]*=o}return this}trim(o,_){const $=this.times,_e=$.length;let it=0,ot=_e-1;for(;it!==_e&&$[it]<o;)++it;for(;ot!==-1&&$[ot]>_;)--ot;if(++ot,it!==0||ot!==_e){it>=ot&&(ot=Math.max(ot,1),it=ot-1);const ct=this.getValueSize();this.times=Pm($,it,ot),this.values=Pm(this.values,it*ct,ot*ct)}return this}validate(){let o=!0;const _=this.getValueSize();_-Math.floor(_)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),o=!1);const $=this.times,_e=this.values,it=$.length;it===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),o=!1);let ot=null;for(let ct=0;ct!==it;ct++){const mt=$[ct];if(typeof mt=="number"&&isNaN(mt)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,ct,mt),o=!1;break}if(ot!==null&&ot>mt){console.error("THREE.KeyframeTrack: Out of order keys.",this,ct,mt,ot),o=!1;break}ot=mt}if(_e!==void 0&&tu(_e))for(let ct=0,mt=_e.length;ct!==mt;++ct){const gt=_e[ct];if(isNaN(gt)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,ct,gt),o=!1;break}}return o}optimize(){const o=Pm(this.times),_=Pm(this.values),$=this.getValueSize(),_e=this.getInterpolation()===Du,it=o.length-1;let ot=1;for(let ct=1;ct<it;++ct){let mt=!1;const gt=o[ct];if(gt!==o[ct+1]&&(ct!==1||gt!==o[0]))if(_e)mt=!0;else{const St=ct*$,Tt=St-$,Ct=St+$;for(let Pt=0;Pt!==$;++Pt){const Ot=_[St+Pt];if(Ot!==_[Tt+Pt]||Ot!==_[Ct+Pt]){mt=!0;break}}}if(mt){if(ct!==ot){o[ot]=o[ct];const St=ct*$,Tt=ot*$;for(let Ct=0;Ct!==$;++Ct)_[Tt+Ct]=_[St+Ct]}++ot}}if(it>0){o[ot]=o[it];for(let ct=it*$,mt=ot*$,gt=0;gt!==$;++gt)_[mt+gt]=_[ct+gt];++ot}return ot!==o.length?(this.times=Pm(o,0,ot),this.values=Pm(_,0,ot*$)):(this.times=o,this.values=_),this}clone(){const o=Pm(this.times,0),_=Pm(this.values,0),$=new this.constructor(this.name,o,_);return $.createInterpolant=this.createInterpolant,$}}Dv.prototype.TimeBufferType=Float32Array,Dv.prototype.ValueBufferType=Float32Array,Dv.prototype.DefaultInterpolation=w0;class $_ extends Dv{}$_.prototype.ValueTypeName="bool",$_.prototype.ValueBufferType=Array,$_.prototype.DefaultInterpolation=b_,$_.prototype.InterpolantFactoryMethodLinear=void 0,$_.prototype.InterpolantFactoryMethodSmooth=void 0;class J_ extends Dv{}J_.prototype.ValueTypeName="color";class Z_ extends Dv{}Z_.prototype.ValueTypeName="number";class bx extends Yy{constructor(o,_,$,_e){super(o,_,$,_e)}interpolate_(o,_,$,_e){const it=this.resultBuffer,ot=this.sampleValues,ct=this.valueSize,mt=($-_)/(_e-_);let gt=o*ct;for(let St=gt+ct;gt!==St;gt+=4)Lu.slerpFlat(it,0,ot,gt-ct,ot,gt,mt);return it}}class vm extends Dv{InterpolantFactoryMethodLinear(o){return new bx(this.times,this.values,this.getValueSize(),o)}}vm.prototype.ValueTypeName="quaternion",vm.prototype.DefaultInterpolation=w0,vm.prototype.InterpolantFactoryMethodSmooth=void 0;class Jm extends Dv{}Jm.prototype.ValueTypeName="string",Jm.prototype.ValueBufferType=Array,Jm.prototype.DefaultInterpolation=b_,Jm.prototype.InterpolantFactoryMethodLinear=void 0,Jm.prototype.InterpolantFactoryMethodSmooth=void 0;class tw extends Dv{}tw.prototype.ValueTypeName="vector";class Ex{constructor(o,_=-1,$,_e=El){this.name=o,this.tracks=$,this.duration=_,this.blendMode=_e,this.uuid=Ju(),this.duration<0&&this.resetDuration()}static parse(o){const _=[],$=o.tracks,_e=1/(o.fps||1);for(let ot=0,ct=$.length;ot!==ct;++ot)_.push($0($[ot]).scale(_e));const it=new this(o.name,o.duration,_,o.blendMode);return it.uuid=o.uuid,it}static toJSON(o){const _=[],$=o.tracks,_e={name:o.name,duration:o.duration,tracks:_,uuid:o.uuid,blendMode:o.blendMode};for(let it=0,ot=$.length;it!==ot;++it)_.push(Dv.toJSON($[it]));return _e}static CreateFromMorphTargetSequence(o,_,$,_e){const it=_.length,ot=[];for(let ct=0;ct<it;ct++){let mt=[],gt=[];mt.push((ct+it-1)%it,ct,(ct+1)%it),gt.push(0,1,0);const St=FT(mt);mt=Fp(mt,1,St),gt=Fp(gt,1,St),_e||mt[0]!==0||(mt.push(it),gt.push(gt[0])),ot.push(new Z_(".morphTargetInfluences["+_[ct].name+"]",mt,gt).scale(1/$))}return new this(o,-1,ot)}static findByName(o,_){let $=o;if(!Array.isArray(o)){const _e=o;$=_e.geometry&&_e.geometry.animations||_e.animations}for(let _e=0;_e<$.length;_e++)if($[_e].name===_)return $[_e];return null}static CreateClipsFromMorphTargetSequences(o,_,$){const _e={},it=/^([\w-]*?)([\d]+)$/;for(let ct=0,mt=o.length;ct<mt;ct++){const gt=o[ct],St=gt.name.match(it);if(St&&St.length>1){const Tt=St[1];let Ct=_e[Tt];Ct||(_e[Tt]=Ct=[]),Ct.push(gt)}}const ot=[];for(const ct in _e)ot.push(this.CreateFromMorphTargetSequence(ct,_e[ct],_,$));return ot}static parseAnimation(o,_){if(!o)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const $=function(St,Tt,Ct,Pt,Ot){if(Ct.length!==0){const Dt=[],Yt=[];lu(Ct,Dt,Yt,Pt),Dt.length!==0&&Ot.push(new St(Tt,Dt,Yt))}},_e=[],it=o.name||"default",ot=o.fps||30,ct=o.blendMode;let mt=o.length||-1;const gt=o.hierarchy||[];for(let St=0;St<gt.length;St++){const Tt=gt[St].keys;if(Tt&&Tt.length!==0)if(Tt[0].morphTargets){const Ct={};let Pt;for(Pt=0;Pt<Tt.length;Pt++)if(Tt[Pt].morphTargets)for(let Ot=0;Ot<Tt[Pt].morphTargets.length;Ot++)Ct[Tt[Pt].morphTargets[Ot]]=-1;for(const Ot in Ct){const Dt=[],Yt=[];for(let Xt=0;Xt!==Tt[Pt].morphTargets.length;++Xt){const Jt=Tt[Pt];Dt.push(Jt.time),Yt.push(Jt.morphTarget===Ot?1:0)}_e.push(new Z_(".morphTargetInfluence["+Ot+"]",Dt,Yt))}mt=Ct.length*ot}else{const Ct=".bones["+_[St].name+"]";$(tw,Ct+".position",Tt,"pos",_e),$(vm,Ct+".quaternion",Tt,"rot",_e),$(tw,Ct+".scale",Tt,"scl",_e)}}return _e.length===0?null:new this(it,mt,_e,ct)}resetDuration(){let o=0;for(let _=0,$=this.tracks.length;_!==$;++_){const _e=this.tracks[_];o=Math.max(o,_e.times[_e.times.length-1])}return this.duration=o,this}trim(){for(let o=0;o<this.tracks.length;o++)this.tracks[o].trim(0,this.duration);return this}validate(){let o=!0;for(let _=0;_<this.tracks.length;_++)o=o&&this.tracks[_].validate();return o}optimize(){for(let o=0;o<this.tracks.length;o++)this.tracks[o].optimize();return this}clone(){const o=[];for(let _=0;_<this.tracks.length;_++)o.push(this.tracks[_].clone());return new this.constructor(this.name,this.duration,o,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function $0(ut){if(ut.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const o=function(_){switch(_.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Z_;case"vector":case"vector2":case"vector3":case"vector4":return tw;case"color":return J_;case"quaternion":return vm;case"bool":case"boolean":return $_;case"string":return Jm}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+_)}(ut.type);if(ut.times===void 0){const _=[],$=[];lu(ut.keys,_,$,"value"),ut.times=_,ut.values=$}return o.parse!==void 0?o.parse(ut):new o(ut.name,ut.times,ut.values,ut.interpolation)}const e0={enabled:!1,files:{},add:function(ut,o){this.enabled!==!1&&(this.files[ut]=o)},get:function(ut,o){return this.enabled===!1?o?Promise.resolve():void 0:o?Promise.resolve(this.files[ut]):this.files[ut]},remove:function(ut){delete this.files[ut]},clear:function(){this.files={}}};class t0{constructor(o,_,$){const _e=this;let it,ot=!1,ct=0,mt=0;const gt=[];this.onStart=void 0,this.onLoad=o,this.onProgress=_,this.onError=$,this.itemStart=function(St){mt++,ot===!1&&_e.onStart!==void 0&&_e.onStart(St,ct,mt),ot=!0},this.itemEnd=function(St){ct++,_e.onProgress!==void 0&&_e.onProgress(St,ct,mt),ct===mt&&(ot=!1,_e.onLoad!==void 0&&_e.onLoad())},this.itemError=function(St){_e.onError!==void 0&&_e.onError(St)},this.resolveURL=function(St){return it?it(St):St},this.setURLModifier=function(St){return it=St,this},this.addHandler=function(St,Tt){return gt.push(St,Tt),this},this.removeHandler=function(St){const Tt=gt.indexOf(St);return Tt!==-1&&gt.splice(Tt,2),this},this.getHandler=function(St){for(let Tt=0,Ct=gt.length;Tt<Ct;Tt+=2){const Pt=gt[Tt],Ot=gt[Tt+1];if(Pt.global&&(Pt.lastIndex=0),Pt.test(St))return Ot}return null}}}const Xy=new t0;class Vu{constructor(o){this.manager=o!==void 0?o:Xy,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(o,_){const $=this;return new Promise(function(_e,it){$.load(o,_e,_,it)})}parse(){}setCrossOrigin(o){return this.crossOrigin=o,this}setWithCredentials(o){return this.withCredentials=o,this}setPath(o){return this.path=o,this}setResourcePath(o){return this.resourcePath=o,this}setRequestHeader(o){return this.requestHeader=o,this}}const Cu={};class mP extends Error{constructor(o,_){super(o),this.response=_}}class n0 extends Vu{constructor(o){super(o),this.responseType="text"}load(o,_,$,_e){o===void 0&&(o=""),this.path!==void 0&&(o=this.path+o),o=this.manager.resolveURL(o),e0.get(o,this.responseType,this.mimeType).then(it=>{if(it!==void 0)return this.manager.itemStart(o),setTimeout(()=>{_&&_(it),this.manager.itemEnd(o)},0),it;if(Cu[o]!==void 0)return void Cu[o].push({onLoad:_,onProgress:$,onError:_e});Cu[o]=[],Cu[o].push({onLoad:_,onProgress:$,onError:_e});const ot=new Request(o,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),ct=this.mimeType,mt=this.responseType;fetch(ot).then(gt=>{if(gt.status===200||gt.status===0){if(gt.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||gt.body===void 0||gt.body.getReader===void 0)return gt;const St=Cu[o],Tt=gt.body.getReader(),Ct=gt.headers.get("Content-Length"),Pt=Ct?parseInt(Ct):0,Ot=Pt!==0;let Dt=0;const Yt=new ReadableStream({start(Xt){(function Jt(){Tt.read().then(({done:an,value:fn})=>{if(an)Xt.close();else{Dt+=fn.byteLength;const gn=new ProgressEvent("progress",{lengthComputable:Ot,loaded:Dt,total:Pt});for(let _n=0,On=St.length;_n<On;_n++){const Ln=St[_n];Ln.onProgress&&Ln.onProgress(gn)}Xt.enqueue(fn),Jt()}})})()}});return new Response(Yt)}throw new mP(`fetch for "${gt.url}" responded with ${gt.status}: ${gt.statusText}`,gt)}).then(gt=>{switch(mt){case"arraybuffer":return gt.arrayBuffer();case"blob":return gt.blob();case"document":return gt.text().then(St=>new DOMParser().parseFromString(St,ct));case"json":return gt.json();default:if(ct===void 0)return gt.text();{const St=/charset="?([^;"\s]*)"?/i.exec(ct),Tt=St&&St[1]?St[1].toLowerCase():void 0,Ct=new TextDecoder(Tt);return gt.arrayBuffer().then(Pt=>Ct.decode(Pt))}}}).then(gt=>{e0.add(o,gt,this.responseType);const St=Cu[o];delete Cu[o];for(let Tt=0,Ct=St.length;Tt<Ct;Tt++){const Pt=St[Tt];Pt.onLoad&&Pt.onLoad(gt)}}).catch(gt=>{const St=Cu[o];if(St===void 0)throw this.manager.itemError(o),gt;delete Cu[o];for(let Tt=0,Ct=St.length;Tt<Ct;Tt++){const Pt=St[Tt];Pt.onError&&Pt.onError(gt)}this.manager.itemError(o)}).finally(()=>{this.manager.itemEnd(o)}),this.manager.itemStart(o)})}setResponseType(o){return this.responseType=o,this}setMimeType(o){return this.mimeType=o,this}}class Sx extends Vu{constructor(o){super(o)}load(o,_,$,_e){const it=this,ot=new n0(this.manager);ot.setPath(this.path),ot.setRequestHeader(this.requestHeader),ot.setWithCredentials(this.withCredentials),ot.load(o,function(ct){try{_(it.parse(JSON.parse(ct)))}catch(mt){_e?_e(mt):console.error(mt),it.manager.itemError(o)}},$,_e)}parse(o){const _=[];for(let $=0;$<o.length;$++){const _e=Ex.parse(o[$]);_.push(_e)}return _}}class Up extends Vu{constructor(o){super(o)}load(o,_,$,_e){const it=this,ot=[],ct=new ox,mt=new n0(this.manager);mt.setPath(this.path),mt.setResponseType("arraybuffer"),mt.setRequestHeader(this.requestHeader),mt.setWithCredentials(it.withCredentials);let gt=0;function St(Tt){mt.load(o[Tt],function(Ct){const Pt=it.parse(Ct,!0);ot[Tt]={width:Pt.width,height:Pt.height,format:Pt.format,mipmaps:Pt.mipmaps},gt+=1,gt===6&&(Pt.mipmapCount===1&&(ct.minFilter=zo),ct.image=ot,ct.format=Pt.format,ct.needsUpdate=!0,_&&_(ct))},$,_e)}if(Array.isArray(o))for(let Tt=0,Ct=o.length;Tt<Ct;++Tt)St(Tt);else mt.load(o,function(Tt){const Ct=it.parse(Tt,!0);if(Ct.isCubemap){const Pt=Ct.mipmaps.length/Ct.mipmapCount;for(let Ot=0;Ot<Pt;Ot++){ot[Ot]={mipmaps:[]};for(let Dt=0;Dt<Ct.mipmapCount;Dt++)ot[Ot].mipmaps.push(Ct.mipmaps[Ot*Ct.mipmapCount+Dt]),ot[Ot].format=Ct.format,ot[Ot].width=Ct.width,ot[Ot].height=Ct.height}ct.image=ot}else ct.image.width=Ct.width,ct.image.height=Ct.height,ct.mipmaps=Ct.mipmaps;Ct.mipmapCount===1&&(ct.minFilter=zo),ct.format=Ct.format,ct.needsUpdate=!0,_&&_(ct)},$,_e);return ct}}class nw extends Vu{constructor(o){super(o)}load(o,_,$,_e){this.path!==void 0&&(o=this.path+o),o=this.manager.resolveURL(o);const it=this,ot=e0.get(o);if(ot!==void 0)return it.manager.itemStart(o),setTimeout(function(){_&&_(ot),it.manager.itemEnd(o)},0),ot;const ct=k_("img");function mt(){St(),e0.add(o,this),_&&_(this),it.manager.itemEnd(o)}function gt(Tt){St(),_e&&_e(Tt),it.manager.itemError(o),it.manager.itemEnd(o)}function St(){ct.removeEventListener("load",mt,!1),ct.removeEventListener("error",gt,!1)}return ct.addEventListener("load",mt,!1),ct.addEventListener("error",gt,!1),o.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(ct.crossOrigin=this.crossOrigin),it.manager.itemStart(o),ct.src=o,ct}}class MC extends Vu{constructor(o){super(o)}load(o,_,$,_e){const it=new NA,ot=new nw(this.manager);ot.setCrossOrigin(this.crossOrigin),ot.setPath(this.path);let ct=0;function mt(gt){ot.load(o[gt],function(St){it.images[gt]=St,ct++,ct===6&&(it.needsUpdate=!0,_&&_(it))},void 0,_e)}for(let gt=0;gt<o.length;++gt)mt(gt);return it}}class r0 extends Vu{constructor(o){super(o)}load(o,_,$,_e){const it=this,ot=new WA,ct=new n0(this.manager);return ct.setResponseType("arraybuffer"),ct.setRequestHeader(this.requestHeader),ct.setPath(this.path),ct.setWithCredentials(it.withCredentials),ct.load(o,function(mt){const gt=it.parse(mt);gt&&(gt.image!==void 0?ot.image=gt.image:gt.data!==void 0&&(ot.image.width=gt.width,ot.image.height=gt.height,ot.image.data=gt.data,ot.image.complete=!0),ot.wrapS=gt.wrapS!==void 0?gt.wrapS:fo,ot.wrapT=gt.wrapT!==void 0?gt.wrapT:fo,ot.magFilter=gt.magFilter!==void 0?gt.magFilter:zo,ot.minFilter=gt.minFilter!==void 0?gt.minFilter:zo,ot.anisotropy=gt.anisotropy!==void 0?gt.anisotropy:1,gt.encoding!==void 0&&(ot.encoding=gt.encoding),gt.flipY!==void 0&&(ot.flipY=gt.flipY),gt.format!==void 0&&(ot.format=gt.format),gt.type!==void 0&&(ot.type=gt.type),gt.mipmaps!==void 0&&(ot.mipmaps=gt.mipmaps,ot.minFilter=oo),gt.mipmapCount===1&&(ot.minFilter=zo),gt.generateMipmaps!==void 0&&(ot.generateMipmaps=gt.generateMipmaps),ot.needsUpdate=!0,_&&_(ot,gt))},$,_e),ot}}class TC extends Vu{constructor(o){super(o)}load(o,_,$,_e){const it=new yu,ot=new nw(this.manager);return ot.setCrossOrigin(this.crossOrigin),ot.setPath(this.path),ot.load(o,function(ct){it.image=ct,it.needsUpdate=!0,_!==void 0&&_(it)},$,_e),it}}class a_ extends no{constructor(o,_=1){super(),this.isLight=!0,this.type="Light",this.color=new is(o),this.intensity=_}dispose(){}copy(o,_){return super.copy(o,_),this.color.copy(o.color),this.intensity=o.intensity,this}toJSON(o){const _=super.toJSON(o);return _.object.color=this.color.getHex(),_.object.intensity=this.intensity,this.groundColor!==void 0&&(_.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(_.object.distance=this.distance),this.angle!==void 0&&(_.object.angle=this.angle),this.decay!==void 0&&(_.object.decay=this.decay),this.penumbra!==void 0&&(_.object.penumbra=this.penumbra),this.shadow!==void 0&&(_.object.shadow=this.shadow.toJSON()),_}}class UT extends a_{constructor(o,_,$){super(o,$),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(no.DefaultUp),this.updateMatrix(),this.groundColor=new is(_)}copy(o,_){return super.copy(o,_),this.groundColor.copy(o.groundColor),this}}const IC=new Us,vE=new An,_E=new An;class Cx{constructor(o){this.camera=o,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Rr(512,512),this.map=null,this.mapPass=null,this.matrix=new Us,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new zw,this._frameExtents=new Rr(1,1),this._viewportCount=1,this._viewports=[new Fo(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(o){const _=this.camera,$=this.matrix;vE.setFromMatrixPosition(o.matrixWorld),_.position.copy(vE),_E.setFromMatrixPosition(o.target.matrixWorld),_.lookAt(_E),_.updateMatrixWorld(),IC.multiplyMatrices(_.projectionMatrix,_.matrixWorldInverse),this._frustum.setFromProjectionMatrix(IC),$.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),$.multiply(_.projectionMatrix),$.multiply(_.matrixWorldInverse)}getViewport(o){return this._viewports[o]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(o){return this.camera=o.camera.clone(),this.bias=o.bias,this.normalBias=o.normalBias,this.radius=o.radius,this.mapSize.copy(o.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const o={};return this.bias!==0&&(o.bias=this.bias),this.normalBias!==0&&(o.normalBias=this.normalBias),this.radius!==1&&(o.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(o.mapSize=this.mapSize.toArray()),o.camera=this.camera.toJSON(!1).object,delete o.camera.matrix,o}}class l_ extends Cx{constructor(){super(new ep(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(o){const _=this.camera,$=2*Ey*o.angle*this.focus,_e=this.mapSize.width/this.mapSize.height,it=o.distance||_.far;$===_.fov&&_e===_.aspect&&it===_.far||(_.fov=$,_.aspect=_e,_.far=it,_.updateProjectionMatrix()),super.updateMatrices(o)}copy(o){return super.copy(o),this.focus=o.focus,this}}class PC extends a_{constructor(o,_,$=0,_e=Math.PI/3,it=0,ot=1){super(o,_),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(no.DefaultUp),this.updateMatrix(),this.target=new no,this.distance=$,this.angle=_e,this.penumbra=it,this.decay=ot,this.map=null,this.shadow=new l_}get power(){return this.intensity*Math.PI}set power(o){this.intensity=o/Math.PI}dispose(){this.shadow.dispose()}copy(o,_){return super.copy(o,_),this.distance=o.distance,this.angle=o.angle,this.penumbra=o.penumbra,this.decay=o.decay,this.target=o.target.clone(),this.shadow=o.shadow.clone(),this}}const yE=new Us,Mx=new An,Tx=new An;class DC extends Cx{constructor(){super(new ep(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Rr(4,2),this._viewportCount=6,this._viewports=[new Fo(2,1,1,1),new Fo(0,1,1,1),new Fo(3,1,1,1),new Fo(1,1,1,1),new Fo(3,0,1,1),new Fo(1,0,1,1)],this._cubeDirections=[new An(1,0,0),new An(-1,0,0),new An(0,0,1),new An(0,0,-1),new An(0,1,0),new An(0,-1,0)],this._cubeUps=[new An(0,1,0),new An(0,1,0),new An(0,1,0),new An(0,1,0),new An(0,0,1),new An(0,0,-1)]}updateMatrices(o,_=0){const $=this.camera,_e=this.matrix,it=o.distance||$.far;it!==$.far&&($.far=it,$.updateProjectionMatrix()),Mx.setFromMatrixPosition(o.matrixWorld),$.position.copy(Mx),Tx.copy($.position),Tx.add(this._cubeDirections[_]),$.up.copy(this._cubeUps[_]),$.lookAt(Tx),$.updateMatrixWorld(),_e.makeTranslation(-Mx.x,-Mx.y,-Mx.z),yE.multiplyMatrices($.projectionMatrix,$.matrixWorldInverse),this._frustum.setFromProjectionMatrix(yE)}}class jT extends a_{constructor(o,_,$=0,_e=1){super(o,_),this.isPointLight=!0,this.type="PointLight",this.distance=$,this.decay=_e,this.shadow=new DC}get power(){return 4*this.intensity*Math.PI}set power(o){this.intensity=o/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(o,_){return super.copy(o,_),this.distance=o.distance,this.decay=o.decay,this.shadow=o.shadow.clone(),this}}class AE extends Cx{constructor(){super(new S1(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class zT extends a_{constructor(o,_){super(o,_),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(no.DefaultUp),this.updateMatrix(),this.target=new no,this.shadow=new AE}dispose(){this.shadow.dispose()}copy(o){return super.copy(o),this.target=o.target.clone(),this.shadow=o.shadow.clone(),this}}class VT extends a_{constructor(o,_){super(o,_),this.isAmbientLight=!0,this.type="AmbientLight"}}class QT extends a_{constructor(o,_,$=10,_e=10){super(o,_),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=$,this.height=_e}get power(){return this.intensity*this.width*this.height*Math.PI}set power(o){this.intensity=o/(this.width*this.height*Math.PI)}copy(o){return super.copy(o),this.width=o.width,this.height=o.height,this}toJSON(o){const _=super.toJSON(o);return _.object.width=this.width,_.object.height=this.height,_}}class Ix{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let o=0;o<9;o++)this.coefficients.push(new An)}set(o){for(let _=0;_<9;_++)this.coefficients[_].copy(o[_]);return this}zero(){for(let o=0;o<9;o++)this.coefficients[o].set(0,0,0);return this}getAt(o,_){const $=o.x,_e=o.y,it=o.z,ot=this.coefficients;return _.copy(ot[0]).multiplyScalar(.282095),_.addScaledVector(ot[1],.488603*_e),_.addScaledVector(ot[2],.488603*it),_.addScaledVector(ot[3],.488603*$),_.addScaledVector(ot[4],$*_e*1.092548),_.addScaledVector(ot[5],_e*it*1.092548),_.addScaledVector(ot[6],.315392*(3*it*it-1)),_.addScaledVector(ot[7],$*it*1.092548),_.addScaledVector(ot[8],.546274*($*$-_e*_e)),_}getIrradianceAt(o,_){const $=o.x,_e=o.y,it=o.z,ot=this.coefficients;return _.copy(ot[0]).multiplyScalar(.886227),_.addScaledVector(ot[1],1.023328*_e),_.addScaledVector(ot[2],1.023328*it),_.addScaledVector(ot[3],1.023328*$),_.addScaledVector(ot[4],.858086*$*_e),_.addScaledVector(ot[5],.858086*_e*it),_.addScaledVector(ot[6],.743125*it*it-.247708),_.addScaledVector(ot[7],.858086*$*it),_.addScaledVector(ot[8],.429043*($*$-_e*_e)),_}add(o){for(let _=0;_<9;_++)this.coefficients[_].add(o.coefficients[_]);return this}addScaledSH(o,_){for(let $=0;$<9;$++)this.coefficients[$].addScaledVector(o.coefficients[$],_);return this}scale(o){for(let _=0;_<9;_++)this.coefficients[_].multiplyScalar(o);return this}lerp(o,_){for(let $=0;$<9;$++)this.coefficients[$].lerp(o.coefficients[$],_);return this}equals(o){for(let _=0;_<9;_++)if(!this.coefficients[_].equals(o.coefficients[_]))return!1;return!0}copy(o){return this.set(o.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(o,_=0){const $=this.coefficients;for(let _e=0;_e<9;_e++)$[_e].fromArray(o,_+3*_e);return this}toArray(o=[],_=0){const $=this.coefficients;for(let _e=0;_e<9;_e++)$[_e].toArray(o,_+3*_e);return o}static getBasisAt(o,_){const $=o.x,_e=o.y,it=o.z;_[0]=.282095,_[1]=.488603*_e,_[2]=.488603*it,_[3]=.488603*$,_[4]=1.092548*$*_e,_[5]=1.092548*_e*it,_[6]=.315392*(3*it*it-1),_[7]=1.092548*$*it,_[8]=.546274*($*$-_e*_e)}}class wE extends a_{constructor(o=new Ix,_=1){super(void 0,_),this.isLightProbe=!0,this.sh=o}copy(o){return super.copy(o),this.sh.copy(o.sh),this}fromJSON(o){return this.intensity=o.intensity,this.sh.fromArray(o.sh),this}toJSON(o){const _=super.toJSON(o);return _.object.sh=this.sh.toArray(),_}}class i0 extends Vu{constructor(o){super(o),this.textures={}}load(o,_,$,_e){const it=this,ot=new n0(it.manager);ot.setPath(it.path),ot.setRequestHeader(it.requestHeader),ot.setWithCredentials(it.withCredentials),ot.load(o,function(ct){try{_(it.parse(JSON.parse(ct)))}catch(mt){_e?_e(mt):console.error(mt),it.manager.itemError(o)}},$,_e)}parse(o){const _=this.textures;function $(it){return _[it]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",it),_[it]}const _e=i0.createMaterialFromType(o.type);if(o.uuid!==void 0&&(_e.uuid=o.uuid),o.name!==void 0&&(_e.name=o.name),o.color!==void 0&&_e.color!==void 0&&_e.color.setHex(o.color),o.roughness!==void 0&&(_e.roughness=o.roughness),o.metalness!==void 0&&(_e.metalness=o.metalness),o.sheen!==void 0&&(_e.sheen=o.sheen),o.sheenColor!==void 0&&(_e.sheenColor=new is().setHex(o.sheenColor)),o.sheenRoughness!==void 0&&(_e.sheenRoughness=o.sheenRoughness),o.emissive!==void 0&&_e.emissive!==void 0&&_e.emissive.setHex(o.emissive),o.specular!==void 0&&_e.specular!==void 0&&_e.specular.setHex(o.specular),o.specularIntensity!==void 0&&(_e.specularIntensity=o.specularIntensity),o.specularColor!==void 0&&_e.specularColor!==void 0&&_e.specularColor.setHex(o.specularColor),o.shininess!==void 0&&(_e.shininess=o.shininess),o.clearcoat!==void 0&&(_e.clearcoat=o.clearcoat),o.clearcoatRoughness!==void 0&&(_e.clearcoatRoughness=o.clearcoatRoughness),o.iridescence!==void 0&&(_e.iridescence=o.iridescence),o.iridescenceIOR!==void 0&&(_e.iridescenceIOR=o.iridescenceIOR),o.iridescenceThicknessRange!==void 0&&(_e.iridescenceThicknessRange=o.iridescenceThicknessRange),o.transmission!==void 0&&(_e.transmission=o.transmission),o.thickness!==void 0&&(_e.thickness=o.thickness),o.attenuationDistance!==void 0&&(_e.attenuationDistance=o.attenuationDistance),o.attenuationColor!==void 0&&_e.attenuationColor!==void 0&&_e.attenuationColor.setHex(o.attenuationColor),o.fog!==void 0&&(_e.fog=o.fog),o.flatShading!==void 0&&(_e.flatShading=o.flatShading),o.blending!==void 0&&(_e.blending=o.blending),o.combine!==void 0&&(_e.combine=o.combine),o.side!==void 0&&(_e.side=o.side),o.shadowSide!==void 0&&(_e.shadowSide=o.shadowSide),o.opacity!==void 0&&(_e.opacity=o.opacity),o.transparent!==void 0&&(_e.transparent=o.transparent),o.alphaTest!==void 0&&(_e.alphaTest=o.alphaTest),o.depthTest!==void 0&&(_e.depthTest=o.depthTest),o.depthWrite!==void 0&&(_e.depthWrite=o.depthWrite),o.colorWrite!==void 0&&(_e.colorWrite=o.colorWrite),o.stencilWrite!==void 0&&(_e.stencilWrite=o.stencilWrite),o.stencilWriteMask!==void 0&&(_e.stencilWriteMask=o.stencilWriteMask),o.stencilFunc!==void 0&&(_e.stencilFunc=o.stencilFunc),o.stencilRef!==void 0&&(_e.stencilRef=o.stencilRef),o.stencilFuncMask!==void 0&&(_e.stencilFuncMask=o.stencilFuncMask),o.stencilFail!==void 0&&(_e.stencilFail=o.stencilFail),o.stencilZFail!==void 0&&(_e.stencilZFail=o.stencilZFail),o.stencilZPass!==void 0&&(_e.stencilZPass=o.stencilZPass),o.wireframe!==void 0&&(_e.wireframe=o.wireframe),o.wireframeLinewidth!==void 0&&(_e.wireframeLinewidth=o.wireframeLinewidth),o.wireframeLinecap!==void 0&&(_e.wireframeLinecap=o.wireframeLinecap),o.wireframeLinejoin!==void 0&&(_e.wireframeLinejoin=o.wireframeLinejoin),o.rotation!==void 0&&(_e.rotation=o.rotation),o.linewidth!==1&&(_e.linewidth=o.linewidth),o.dashSize!==void 0&&(_e.dashSize=o.dashSize),o.gapSize!==void 0&&(_e.gapSize=o.gapSize),o.scale!==void 0&&(_e.scale=o.scale),o.polygonOffset!==void 0&&(_e.polygonOffset=o.polygonOffset),o.polygonOffsetFactor!==void 0&&(_e.polygonOffsetFactor=o.polygonOffsetFactor),o.polygonOffsetUnits!==void 0&&(_e.polygonOffsetUnits=o.polygonOffsetUnits),o.dithering!==void 0&&(_e.dithering=o.dithering),o.alphaToCoverage!==void 0&&(_e.alphaToCoverage=o.alphaToCoverage),o.premultipliedAlpha!==void 0&&(_e.premultipliedAlpha=o.premultipliedAlpha),o.visible!==void 0&&(_e.visible=o.visible),o.toneMapped!==void 0&&(_e.toneMapped=o.toneMapped),o.userData!==void 0&&(_e.userData=o.userData),o.vertexColors!==void 0&&(typeof o.vertexColors=="number"?_e.vertexColors=o.vertexColors>0:_e.vertexColors=o.vertexColors),o.uniforms!==void 0)for(const it in o.uniforms){const ot=o.uniforms[it];switch(_e.uniforms[it]={},ot.type){case"t":_e.uniforms[it].value=$(ot.value);break;case"c":_e.uniforms[it].value=new is().setHex(ot.value);break;case"v2":_e.uniforms[it].value=new Rr().fromArray(ot.value);break;case"v3":_e.uniforms[it].value=new An().fromArray(ot.value);break;case"v4":_e.uniforms[it].value=new Fo().fromArray(ot.value);break;case"m3":_e.uniforms[it].value=new Ou().fromArray(ot.value);break;case"m4":_e.uniforms[it].value=new Us().fromArray(ot.value);break;default:_e.uniforms[it].value=ot.value}}if(o.defines!==void 0&&(_e.defines=o.defines),o.vertexShader!==void 0&&(_e.vertexShader=o.vertexShader),o.fragmentShader!==void 0&&(_e.fragmentShader=o.fragmentShader),o.glslVersion!==void 0&&(_e.glslVersion=o.glslVersion),o.extensions!==void 0)for(const it in o.extensions)_e.extensions[it]=o.extensions[it];if(o.size!==void 0&&(_e.size=o.size),o.sizeAttenuation!==void 0&&(_e.sizeAttenuation=o.sizeAttenuation),o.map!==void 0&&(_e.map=$(o.map)),o.matcap!==void 0&&(_e.matcap=$(o.matcap)),o.alphaMap!==void 0&&(_e.alphaMap=$(o.alphaMap)),o.bumpMap!==void 0&&(_e.bumpMap=$(o.bumpMap)),o.bumpScale!==void 0&&(_e.bumpScale=o.bumpScale),o.normalMap!==void 0&&(_e.normalMap=$(o.normalMap)),o.normalMapType!==void 0&&(_e.normalMapType=o.normalMapType),o.normalScale!==void 0){let it=o.normalScale;Array.isArray(it)===!1&&(it=[it,it]),_e.normalScale=new Rr().fromArray(it)}return o.displacementMap!==void 0&&(_e.displacementMap=$(o.displacementMap)),o.displacementScale!==void 0&&(_e.displacementScale=o.displacementScale),o.displacementBias!==void 0&&(_e.displacementBias=o.displacementBias),o.roughnessMap!==void 0&&(_e.roughnessMap=$(o.roughnessMap)),o.metalnessMap!==void 0&&(_e.metalnessMap=$(o.metalnessMap)),o.emissiveMap!==void 0&&(_e.emissiveMap=$(o.emissiveMap)),o.emissiveIntensity!==void 0&&(_e.emissiveIntensity=o.emissiveIntensity),o.specularMap!==void 0&&(_e.specularMap=$(o.specularMap)),o.specularIntensityMap!==void 0&&(_e.specularIntensityMap=$(o.specularIntensityMap)),o.specularColorMap!==void 0&&(_e.specularColorMap=$(o.specularColorMap)),o.envMap!==void 0&&(_e.envMap=$(o.envMap)),o.envMapIntensity!==void 0&&(_e.envMapIntensity=o.envMapIntensity),o.reflectivity!==void 0&&(_e.reflectivity=o.reflectivity),o.refractionRatio!==void 0&&(_e.refractionRatio=o.refractionRatio),o.lightMap!==void 0&&(_e.lightMap=$(o.lightMap)),o.lightMapIntensity!==void 0&&(_e.lightMapIntensity=o.lightMapIntensity),o.aoMap!==void 0&&(_e.aoMap=$(o.aoMap)),o.aoMapIntensity!==void 0&&(_e.aoMapIntensity=o.aoMapIntensity),o.gradientMap!==void 0&&(_e.gradientMap=$(o.gradientMap)),o.clearcoatMap!==void 0&&(_e.clearcoatMap=$(o.clearcoatMap)),o.clearcoatRoughnessMap!==void 0&&(_e.clearcoatRoughnessMap=$(o.clearcoatRoughnessMap)),o.clearcoatNormalMap!==void 0&&(_e.clearcoatNormalMap=$(o.clearcoatNormalMap)),o.clearcoatNormalScale!==void 0&&(_e.clearcoatNormalScale=new Rr().fromArray(o.clearcoatNormalScale)),o.iridescenceMap!==void 0&&(_e.iridescenceMap=$(o.iridescenceMap)),o.iridescenceThicknessMap!==void 0&&(_e.iridescenceThicknessMap=$(o.iridescenceThicknessMap)),o.transmissionMap!==void 0&&(_e.transmissionMap=$(o.transmissionMap)),o.thicknessMap!==void 0&&(_e.thicknessMap=$(o.thicknessMap)),o.sheenColorMap!==void 0&&(_e.sheenColorMap=$(o.sheenColorMap)),o.sheenRoughnessMap!==void 0&&(_e.sheenRoughnessMap=$(o.sheenRoughnessMap)),_e}setTextures(o){return this.textures=o,this}static createMaterialFromType(o){return new{ShadowMaterial:mE,SpriteMaterial:q1,RawShaderMaterial:LT,ShaderMaterial:Av,PointsMaterial:tE,MeshPhysicalMaterial:xC,MeshStandardMaterial:wC,MeshPhongMaterial:yx,MeshToonMaterial:NT,MeshNormalMaterial:Ax,MeshLambertMaterial:bC,MeshDepthMaterial:$w,MeshDistanceMaterial:VA,MeshBasicMaterial:Wm,MeshMatcapMaterial:wx,LineDashedMaterial:EC,LineBasicMaterial:Np,Material:Uu}[o]}}class c_{static decodeText(o){if(typeof TextDecoder<"u")return new TextDecoder().decode(o);let _="";for(let $=0,_e=o.length;$<_e;$++)_+=String.fromCharCode(o[$]);try{return decodeURIComponent(escape(_))}catch{return _}}static extractUrlBase(o){const _=o.lastIndexOf("/");return _===-1?"./":o.slice(0,_+1)}static resolveURL(o,_){return typeof o!="string"||o===""?"":(/^https?:\/\//i.test(_)&&/^\//.test(o)&&(_=_.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(o)||/^data:.*,.*$/i.test(o)||/^blob:.*$/i.test(o)?o:_+o)}}class _m extends ps{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(o){return super.copy(o),this.instanceCount=o.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const o=super.toJSON(this);return o.instanceCount=this.instanceCount,o.isInstancedBufferGeometry=!0,o}}class GT extends Vu{constructor(o){super(o)}load(o,_,$,_e){const it=this,ot=new n0(it.manager);ot.setPath(it.path),ot.setRequestHeader(it.requestHeader),ot.setWithCredentials(it.withCredentials),ot.load(o,function(ct){try{_(it.parse(JSON.parse(ct)))}catch(mt){_e?_e(mt):console.error(mt),it.manager.itemError(o)}},$,_e)}parse(o){const _={},$={};function _e(Tt,Ct){if(_[Ct]!==void 0)return _[Ct];const Pt=Tt.interleavedBuffers[Ct],Ot=function(Xt,Jt){if($[Jt]!==void 0)return $[Jt];const an=Xt.arrayBuffers[Jt],fn=new Uint32Array(an).buffer;return $[Jt]=fn,fn}(Tt,Pt.buffer),Dt=R_(Pt.type,Ot),Yt=new W1(Dt,Pt.stride);return Yt.uuid=Pt.uuid,_[Ct]=Yt,Yt}const it=o.isInstancedBufferGeometry?new _m:new ps,ot=o.data.index;if(ot!==void 0){const Tt=R_(ot.type,ot.array);it.setIndex(new $o(Tt,1))}const ct=o.data.attributes;for(const Tt in ct){const Ct=ct[Tt];let Pt;if(Ct.isInterleavedBufferAttribute){const Ot=_e(o.data,Ct.data);Pt=new r_(Ot,Ct.itemSize,Ct.offset,Ct.normalized)}else{const Ot=R_(Ct.type,Ct.array);Pt=new(Ct.isInstancedBufferAttribute?Vy:$o)(Ot,Ct.itemSize,Ct.normalized)}Ct.name!==void 0&&(Pt.name=Ct.name),Ct.usage!==void 0&&Pt.setUsage(Ct.usage),Ct.updateRange!==void 0&&(Pt.updateRange.offset=Ct.updateRange.offset,Pt.updateRange.count=Ct.updateRange.count),it.setAttribute(Tt,Pt)}const mt=o.data.morphAttributes;if(mt)for(const Tt in mt){const Ct=mt[Tt],Pt=[];for(let Ot=0,Dt=Ct.length;Ot<Dt;Ot++){const Yt=Ct[Ot];let Xt;if(Yt.isInterleavedBufferAttribute){const Jt=_e(o.data,Yt.data);Xt=new r_(Jt,Yt.itemSize,Yt.offset,Yt.normalized)}else{const Jt=R_(Yt.type,Yt.array);Xt=new $o(Jt,Yt.itemSize,Yt.normalized)}Yt.name!==void 0&&(Xt.name=Yt.name),Pt.push(Xt)}it.morphAttributes[Tt]=Pt}o.data.morphTargetsRelative&&(it.morphTargetsRelative=!0);const gt=o.data.groups||o.data.drawcalls||o.data.offsets;if(gt!==void 0)for(let Tt=0,Ct=gt.length;Tt!==Ct;++Tt){const Pt=gt[Tt];it.addGroup(Pt.start,Pt.count,Pt.materialIndex)}const St=o.data.boundingSphere;if(St!==void 0){const Tt=new An;St.center!==void 0&&Tt.fromArray(St.center),it.boundingSphere=new nm(Tt,St.radius)}return o.name&&(it.name=o.name),o.userData&&(it.userData=o.userData),it}}class RC extends Vu{constructor(o){super(o)}load(o,_,$,_e){const it=this,ot=this.path===""?c_.extractUrlBase(o):this.path;this.resourcePath=this.resourcePath||ot;const ct=new n0(this.manager);ct.setPath(this.path),ct.setRequestHeader(this.requestHeader),ct.setWithCredentials(this.withCredentials),ct.load(o,function(mt){let gt=null;try{gt=JSON.parse(mt)}catch(Tt){return _e!==void 0&&_e(Tt),void console.error("THREE:ObjectLoader: Can't parse "+o+".",Tt.message)}const St=gt.metadata;St!==void 0&&St.type!==void 0&&St.type.toLowerCase()!=="geometry"?it.parse(gt,_):console.error("THREE.ObjectLoader: Can't load "+o)},$,_e)}async loadAsync(o,_){const $=this.path===""?c_.extractUrlBase(o):this.path;this.resourcePath=this.resourcePath||$;const _e=new n0(this.manager);_e.setPath(this.path),_e.setRequestHeader(this.requestHeader),_e.setWithCredentials(this.withCredentials);const it=await _e.loadAsync(o,_),ot=JSON.parse(it),ct=ot.metadata;if(ct===void 0||ct.type===void 0||ct.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+o);return await this.parseAsync(ot)}parse(o,_){const $=this.parseAnimations(o.animations),_e=this.parseShapes(o.shapes),it=this.parseGeometries(o.geometries,_e),ot=this.parseImages(o.images,function(){_!==void 0&&_(gt)}),ct=this.parseTextures(o.textures,ot),mt=this.parseMaterials(o.materials,ct),gt=this.parseObject(o.object,it,mt,ct,$),St=this.parseSkeletons(o.skeletons,gt);if(this.bindSkeletons(gt,St),_!==void 0){let Tt=!1;for(const Ct in ot)if(ot[Ct].data instanceof HTMLImageElement){Tt=!0;break}Tt===!1&&_(gt)}return gt}async parseAsync(o){const _=this.parseAnimations(o.animations),$=this.parseShapes(o.shapes),_e=this.parseGeometries(o.geometries,$),it=await this.parseImagesAsync(o.images),ot=this.parseTextures(o.textures,it),ct=this.parseMaterials(o.materials,ot),mt=this.parseObject(o.object,_e,ct,ot,_),gt=this.parseSkeletons(o.skeletons,mt);return this.bindSkeletons(mt,gt),mt}parseShapes(o){const _={};if(o!==void 0)for(let $=0,_e=o.length;$<_e;$++){const it=new Gy().fromJSON(o[$]);_[it.uuid]=it}return _}parseSkeletons(o,_){const $={},_e={};if(_.traverse(function(it){it.isBone&&(_e[it.uuid]=it)}),o!==void 0)for(let it=0,ot=o.length;it<ot;it++){const ct=new ex().fromJSON(o[it],_e);$[ct.uuid]=ct}return $}parseGeometries(o,_){const $={};if(o!==void 0){const _e=new GT;for(let it=0,ot=o.length;it<ot;it++){let ct;const mt=o[it];switch(mt.type){case"BufferGeometry":case"InstancedBufferGeometry":ct=_e.parse(mt);break;default:mt.type in $m?ct=$m[mt.type].fromJSON(mt,_):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${mt.type}"`)}ct.uuid=mt.uuid,mt.name!==void 0&&(ct.name=mt.name),ct.isBufferGeometry===!0&&mt.userData!==void 0&&(ct.userData=mt.userData),$[mt.uuid]=ct}}return $}parseMaterials(o,_){const $={},_e={};if(o!==void 0){const it=new i0;it.setTextures(_);for(let ot=0,ct=o.length;ot<ct;ot++){const mt=o[ot];$[mt.uuid]===void 0&&($[mt.uuid]=it.parse(mt)),_e[mt.uuid]=$[mt.uuid]}}return _e}parseAnimations(o){const _={};if(o!==void 0)for(let $=0;$<o.length;$++){const _e=o[$],it=Ex.parse(_e);_[it.uuid]=it}return _}parseImages(o,_){const $=this,_e={};let it;function ot(ct){if(typeof ct=="string"){const mt=ct;return function(gt){return $.manager.itemStart(gt),it.load(gt,function(){$.manager.itemEnd(gt)},void 0,function(){$.manager.itemError(gt),$.manager.itemEnd(gt)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(mt)?mt:$.resourcePath+mt)}return ct.data?{data:R_(ct.type,ct.data),width:ct.width,height:ct.height,complete:!0}:null}if(o!==void 0&&o.length>0){const ct=new t0(_);it=new nw(ct),it.setCrossOrigin(this.crossOrigin);for(let mt=0,gt=o.length;mt<gt;mt++){const St=o[mt],Tt=St.url;if(Array.isArray(Tt)){const Ct=[];for(let Pt=0,Ot=Tt.length;Pt<Ot;Pt++){const Dt=ot(Tt[Pt]);Dt!==null&&(Dt instanceof HTMLImageElement?Ct.push(Dt):Ct.push(new WA(Dt.data,Dt.width,Dt.height)))}_e[St.uuid]=new B_(Ct)}else{const Ct=ot(St.url);_e[St.uuid]=new B_(Ct)}}}return _e}async parseImagesAsync(o){const _=this,$={};let _e;async function it(ot){if(typeof ot=="string"){const ct=ot,mt=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(ct)?ct:_.resourcePath+ct;return await _e.loadAsync(mt)}return ot.data?{data:R_(ot.type,ot.data),width:ot.width,height:ot.height,complete:!0}:null}if(o!==void 0&&o.length>0){_e=new nw(this.manager),_e.setCrossOrigin(this.crossOrigin);for(let ot=0,ct=o.length;ot<ct;ot++){const mt=o[ot],gt=mt.url;if(Array.isArray(gt)){const St=[];for(let Tt=0,Ct=gt.length;Tt<Ct;Tt++){const Pt=gt[Tt],Ot=await it(Pt);Ot!==null&&(Ot instanceof HTMLImageElement?St.push(Ot):St.push(new WA(Ot.data,Ot.width,Ot.height)))}$[mt.uuid]=new B_(St)}else{const St=await it(mt.url);$[mt.uuid]=new B_(St)}}}return $}parseTextures(o,_){function $(it,ot){return typeof it=="number"?it:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",it),ot[it])}const _e={};if(o!==void 0)for(let it=0,ot=o.length;it<ot;it++){const ct=o[it];ct.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',ct.uuid),_[ct.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",ct.image);const mt=_[ct.image],gt=mt?mt.data:void 0;let St;Array.isArray(gt)?(St=new NA,gt.length===6&&(St.needsUpdate=!0)):(St=gt&&gt.data?new WA:new yu,gt&&gt.complete&&(St.needsUpdate=!0)),St.source=mt,St.uuid=ct.uuid,ct.name!==void 0&&(St.name=ct.name),ct.mapping!==void 0&&(St.mapping=$(ct.mapping,gP)),ct.offset!==void 0&&St.offset.fromArray(ct.offset),ct.repeat!==void 0&&St.repeat.fromArray(ct.repeat),ct.center!==void 0&&St.center.fromArray(ct.center),ct.rotation!==void 0&&(St.rotation=ct.rotation),ct.wrap!==void 0&&(St.wrapS=$(ct.wrap[0],xE),St.wrapT=$(ct.wrap[1],xE)),ct.format!==void 0&&(St.format=ct.format),ct.type!==void 0&&(St.type=ct.type),ct.encoding!==void 0&&(St.encoding=ct.encoding),ct.minFilter!==void 0&&(St.minFilter=$(ct.minFilter,HT)),ct.magFilter!==void 0&&(St.magFilter=$(ct.magFilter,HT)),ct.anisotropy!==void 0&&(St.anisotropy=ct.anisotropy),ct.flipY!==void 0&&(St.flipY=ct.flipY),ct.premultiplyAlpha!==void 0&&(St.premultiplyAlpha=ct.premultiplyAlpha),ct.unpackAlignment!==void 0&&(St.unpackAlignment=ct.unpackAlignment),ct.userData!==void 0&&(St.userData=ct.userData),_e[ct.uuid]=St}return _e}parseObject(o,_,$,_e,it){let ot,ct,mt;function gt(Ct){return _[Ct]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",Ct),_[Ct]}function St(Ct){if(Ct!==void 0){if(Array.isArray(Ct)){const Pt=[];for(let Ot=0,Dt=Ct.length;Ot<Dt;Ot++){const Yt=Ct[Ot];$[Yt]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",Yt),Pt.push($[Yt])}return Pt}return $[Ct]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",Ct),$[Ct]}}function Tt(Ct){return _e[Ct]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",Ct),_e[Ct]}switch(o.type){case"Scene":ot=new yT,o.background!==void 0&&(Number.isInteger(o.background)?ot.background=new is(o.background):ot.background=Tt(o.background)),o.environment!==void 0&&(ot.environment=Tt(o.environment)),o.fog!==void 0&&(o.fog.type==="Fog"?ot.fog=new QA(o.fog.color,o.fog.near,o.fog.far):o.fog.type==="FogExp2"&&(ot.fog=new Q0(o.fog.color,o.fog.density)));break;case"PerspectiveCamera":ot=new ep(o.fov,o.aspect,o.near,o.far),o.focus!==void 0&&(ot.focus=o.focus),o.zoom!==void 0&&(ot.zoom=o.zoom),o.filmGauge!==void 0&&(ot.filmGauge=o.filmGauge),o.filmOffset!==void 0&&(ot.filmOffset=o.filmOffset),o.view!==void 0&&(ot.view=Object.assign({},o.view));break;case"OrthographicCamera":ot=new S1(o.left,o.right,o.top,o.bottom,o.near,o.far),o.zoom!==void 0&&(ot.zoom=o.zoom),o.view!==void 0&&(ot.view=Object.assign({},o.view));break;case"AmbientLight":ot=new VT(o.color,o.intensity);break;case"DirectionalLight":ot=new zT(o.color,o.intensity);break;case"PointLight":ot=new jT(o.color,o.intensity,o.distance,o.decay);break;case"RectAreaLight":ot=new QT(o.color,o.intensity,o.width,o.height);break;case"SpotLight":ot=new PC(o.color,o.intensity,o.distance,o.angle,o.penumbra,o.decay);break;case"HemisphereLight":ot=new UT(o.color,o.groundColor,o.intensity);break;case"LightProbe":ot=new wE().fromJSON(o);break;case"SkinnedMesh":ct=gt(o.geometry),mt=St(o.material),ot=new rC(ct,mt),o.bindMode!==void 0&&(ot.bindMode=o.bindMode),o.bindMatrix!==void 0&&ot.bindMatrix.fromArray(o.bindMatrix),o.skeleton!==void 0&&(ot.skeleton=o.skeleton);break;case"Mesh":ct=gt(o.geometry),mt=St(o.material),ot=new ju(ct,mt);break;case"InstancedMesh":ct=gt(o.geometry),mt=St(o.material);const Ct=o.count,Pt=o.instanceMatrix,Ot=o.instanceColor;ot=new J1(ct,mt,Ct),ot.instanceMatrix=new Vy(new Float32Array(Pt.array),16),Ot!==void 0&&(ot.instanceColor=new Vy(new Float32Array(Ot.array),Ot.itemSize));break;case"LOD":ot=new HA;break;case"Line":ot=new s_(gt(o.geometry),St(o.material));break;case"LineLoop":ot=new qA(gt(o.geometry),St(o.material));break;case"LineSegments":ot=new o_(gt(o.geometry),St(o.material));break;case"PointCloud":case"Points":ot=new iE(gt(o.geometry),St(o.material));break;case"Sprite":ot=new K1(St(o.material));break;case"Group":ot=new H_;break;case"Bone":ot=new iC;break;default:ot=new no}if(ot.uuid=o.uuid,o.name!==void 0&&(ot.name=o.name),o.matrix!==void 0?(ot.matrix.fromArray(o.matrix),o.matrixAutoUpdate!==void 0&&(ot.matrixAutoUpdate=o.matrixAutoUpdate),ot.matrixAutoUpdate&&ot.matrix.decompose(ot.position,ot.quaternion,ot.scale)):(o.position!==void 0&&ot.position.fromArray(o.position),o.rotation!==void 0&&ot.rotation.fromArray(o.rotation),o.quaternion!==void 0&&ot.quaternion.fromArray(o.quaternion),o.scale!==void 0&&ot.scale.fromArray(o.scale)),o.castShadow!==void 0&&(ot.castShadow=o.castShadow),o.receiveShadow!==void 0&&(ot.receiveShadow=o.receiveShadow),o.shadow&&(o.shadow.bias!==void 0&&(ot.shadow.bias=o.shadow.bias),o.shadow.normalBias!==void 0&&(ot.shadow.normalBias=o.shadow.normalBias),o.shadow.radius!==void 0&&(ot.shadow.radius=o.shadow.radius),o.shadow.mapSize!==void 0&&ot.shadow.mapSize.fromArray(o.shadow.mapSize),o.shadow.camera!==void 0&&(ot.shadow.camera=this.parseObject(o.shadow.camera))),o.visible!==void 0&&(ot.visible=o.visible),o.frustumCulled!==void 0&&(ot.frustumCulled=o.frustumCulled),o.renderOrder!==void 0&&(ot.renderOrder=o.renderOrder),o.userData!==void 0&&(ot.userData=o.userData),o.layers!==void 0&&(ot.layers.mask=o.layers),o.children!==void 0){const Ct=o.children;for(let Pt=0;Pt<Ct.length;Pt++)ot.add(this.parseObject(Ct[Pt],_,$,_e,it))}if(o.animations!==void 0){const Ct=o.animations;for(let Pt=0;Pt<Ct.length;Pt++){const Ot=Ct[Pt];ot.animations.push(it[Ot])}}if(o.type==="LOD"){o.autoUpdate!==void 0&&(ot.autoUpdate=o.autoUpdate);const Ct=o.levels;for(let Pt=0;Pt<Ct.length;Pt++){const Ot=Ct[Pt],Dt=ot.getObjectByProperty("uuid",Ot.object);Dt!==void 0&&ot.addLevel(Dt,Ot.distance)}}return ot}bindSkeletons(o,_){Object.keys(_).length!==0&&o.traverse(function($){if($.isSkinnedMesh===!0&&$.skeleton!==void 0){const _e=_[$.skeleton];_e===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",$.skeleton):$.bind(_e,$.bindMatrix)}})}}const gP={UVMapping:Nl,CubeReflectionMapping:Qs,CubeRefractionMapping:So,EquirectangularReflectionMapping:_l,EquirectangularRefractionMapping:Mo,CubeUVReflectionMapping:Bo},xE={RepeatWrapping:_o,ClampToEdgeWrapping:fo,MirroredRepeatWrapping:Wl},HT={NearestFilter:Oo,NearestMipmapNearestFilter:yl,NearestMipmapLinearFilter:co,LinearFilter:zo,LinearMipmapNearestFilter:Yu,LinearMipmapLinearFilter:oo};class kC extends Vu{constructor(o){super(o),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(o){return this.options=o,this}load(o,_,$,_e){o===void 0&&(o=""),this.path!==void 0&&(o=this.path+o),o=this.manager.resolveURL(o);const it=this,ot=e0.get(o);if(ot!==void 0)return it.manager.itemStart(o),setTimeout(function(){_&&_(ot),it.manager.itemEnd(o)},0),ot;const ct={};ct.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",ct.headers=this.requestHeader,fetch(o,ct).then(function(mt){return mt.blob()}).then(function(mt){return createImageBitmap(mt,Object.assign(it.options,{colorSpaceConversion:"none"}))}).then(function(mt){e0.add(o,mt),_&&_(mt),it.manager.itemEnd(o)}).catch(function(mt){_e&&_e(mt),it.manager.itemError(o),it.manager.itemEnd(o)}),it.manager.itemStart(o)}}let bE;const Px={getContext:function(){return bE===void 0&&(bE=new(window.AudioContext||window.webkitAudioContext)),bE},setContext:function(ut){bE=ut}};class vP extends Vu{constructor(o){super(o)}load(o,_,$,_e){const it=this,ot=new n0(this.manager);ot.setResponseType("arraybuffer"),ot.setPath(this.path),ot.setRequestHeader(this.requestHeader),ot.setWithCredentials(this.withCredentials),ot.load(o,function(ct){try{const mt=ct.slice(0);Px.getContext().decodeAudioData(mt,function(gt){_(gt)})}catch(mt){_e?_e(mt):console.error(mt),it.manager.itemError(o)}},$,_e)}}class BC extends wE{constructor(o,_,$=1){super(void 0,$),this.isHemisphereLightProbe=!0;const _e=new is().set(o),it=new is().set(_),ot=new An(_e.r,_e.g,_e.b),ct=new An(it.r,it.g,it.b),mt=Math.sqrt(Math.PI),gt=mt*Math.sqrt(.75);this.sh.coefficients[0].copy(ot).add(ct).multiplyScalar(mt),this.sh.coefficients[1].copy(ot).sub(ct).multiplyScalar(gt)}}class EE extends wE{constructor(o,_=1){super(void 0,_),this.isAmbientLightProbe=!0;const $=new is().set(o);this.sh.coefficients[0].set($.r,$.g,$.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const rw=new Us,SE=new Us,s0=new Us;class Ky{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ep,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ep,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(o){const _=this._cache;if(_.focus!==o.focus||_.fov!==o.fov||_.aspect!==o.aspect*this.aspect||_.near!==o.near||_.far!==o.far||_.zoom!==o.zoom||_.eyeSep!==this.eyeSep){_.focus=o.focus,_.fov=o.fov,_.aspect=o.aspect*this.aspect,_.near=o.near,_.far=o.far,_.zoom=o.zoom,_.eyeSep=this.eyeSep,s0.copy(o.projectionMatrix);const $=_.eyeSep/2,_e=$*_.near/_.focus,it=_.near*Math.tan(D_*_.fov*.5)/_.zoom;let ot,ct;SE.elements[12]=-$,rw.elements[12]=$,ot=-it*_.aspect+_e,ct=it*_.aspect+_e,s0.elements[0]=2*_.near/(ct-ot),s0.elements[8]=(ct+ot)/(ct-ot),this.cameraL.projectionMatrix.copy(s0),ot=-it*_.aspect-_e,ct=it*_.aspect-_e,s0.elements[0]=2*_.near/(ct-ot),s0.elements[8]=(ct+ot)/(ct-ot),this.cameraR.projectionMatrix.copy(s0)}this.cameraL.matrixWorld.copy(o.matrixWorld).multiply(SE),this.cameraR.matrixWorld.copy(o.matrixWorld).multiply(rw)}}class CE{constructor(o=!0){this.autoStart=o,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=WT(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let o=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const _=WT();o=(_-this.oldTime)/1e3,this.oldTime=_,this.elapsedTime+=o}return o}}function WT(){return(typeof performance>"u"?Date:performance).now()}const J0=new An,o0=new Lu,_P=new An,Tp=new An;class qT extends no{constructor(){super(),this.type="AudioListener",this.context=Px.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new CE}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(o){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=o,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(o){return this.gain.gain.setTargetAtTime(o,this.context.currentTime,.01),this}updateMatrixWorld(o){super.updateMatrixWorld(o);const _=this.context.listener,$=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(J0,o0,_P),Tp.set(0,0,-1).applyQuaternion(o0),_.positionX){const _e=this.context.currentTime+this.timeDelta;_.positionX.linearRampToValueAtTime(J0.x,_e),_.positionY.linearRampToValueAtTime(J0.y,_e),_.positionZ.linearRampToValueAtTime(J0.z,_e),_.forwardX.linearRampToValueAtTime(Tp.x,_e),_.forwardY.linearRampToValueAtTime(Tp.y,_e),_.forwardZ.linearRampToValueAtTime(Tp.z,_e),_.upX.linearRampToValueAtTime($.x,_e),_.upY.linearRampToValueAtTime($.y,_e),_.upZ.linearRampToValueAtTime($.z,_e)}else _.setPosition(J0.x,J0.y,J0.z),_.setOrientation(Tp.x,Tp.y,Tp.z,$.x,$.y,$.z)}}class a0 extends no{constructor(o){super(),this.type="Audio",this.listener=o,this.context=o.context,this.gain=this.context.createGain(),this.gain.connect(o.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(o){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=o,this.connect(),this}setMediaElementSource(o){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(o),this.connect(),this}setMediaStreamSource(o){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(o),this.connect(),this}setBuffer(o){return this.buffer=o,this.sourceType="buffer",this.autoplay&&this.play(),this}play(o=0){if(this.isPlaying===!0)return void console.warn("THREE.Audio: Audio is already playing.");if(this.hasPlaybackControl===!1)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+o;const _=this.context.createBufferSource();return _.buffer=this.buffer,_.loop=this.loop,_.loopStart=this.loopStart,_.loopEnd=this.loopEnd,_.onended=this.onEnded.bind(this),_.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=_,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(this.hasPlaybackControl!==!1)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let o=1,_=this.filters.length;o<_;o++)this.filters[o-1].connect(this.filters[o]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let o=1,_=this.filters.length;o<_;o++)this.filters[o-1].disconnect(this.filters[o]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(o){return o||(o=[]),this._connected===!0?(this.disconnect(),this.filters=o.slice(),this.connect()):this.filters=o.slice(),this}setDetune(o){if(this.detune=o,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(o){return this.setFilters(o?[o]:[])}setPlaybackRate(o){if(this.hasPlaybackControl!==!1)return this.playbackRate=o,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(o){if(this.hasPlaybackControl!==!1)return this.loop=o,this.isPlaying===!0&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(o){return this.loopStart=o,this}setLoopEnd(o){return this.loopEnd=o,this}getVolume(){return this.gain.gain.value}setVolume(o){return this.gain.gain.setTargetAtTime(o,this.context.currentTime,.01),this}}const Z0=new An,ME=new Lu,Dx=new An,Rv=new An;class YT extends a0{constructor(o){super(o),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(o){return this.panner.refDistance=o,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(o){return this.panner.rolloffFactor=o,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(o){return this.panner.distanceModel=o,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(o){return this.panner.maxDistance=o,this}setDirectionalCone(o,_,$){return this.panner.coneInnerAngle=o,this.panner.coneOuterAngle=_,this.panner.coneOuterGain=$,this}updateMatrixWorld(o){if(super.updateMatrixWorld(o),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Z0,ME,Dx),Rv.set(0,0,1).applyQuaternion(ME);const _=this.panner;if(_.positionX){const $=this.context.currentTime+this.listener.timeDelta;_.positionX.linearRampToValueAtTime(Z0.x,$),_.positionY.linearRampToValueAtTime(Z0.y,$),_.positionZ.linearRampToValueAtTime(Z0.z,$),_.orientationX.linearRampToValueAtTime(Rv.x,$),_.orientationY.linearRampToValueAtTime(Rv.y,$),_.orientationZ.linearRampToValueAtTime(Rv.z,$)}else _.setPosition(Z0.x,Z0.y,Z0.z),_.setOrientation(Rv.x,Rv.y,Rv.z)}}class ey{constructor(o,_=2048){this.analyser=o.context.createAnalyser(),this.analyser.fftSize=_,this.data=new Uint8Array(this.analyser.frequencyBinCount),o.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let o=0;const _=this.getFrequencyData();for(let $=0;$<_.length;$++)o+=_[$];return o/_.length}}class Rx{constructor(o,_,$){let _e,it,ot;switch(this.binding=o,this.valueSize=$,_){case"quaternion":_e=this._slerp,it=this._slerpAdditive,ot=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*$),this._workIndex=5;break;case"string":case"bool":_e=this._select,it=this._select,ot=this._setAdditiveIdentityOther,this.buffer=new Array(5*$);break;default:_e=this._lerp,it=this._lerpAdditive,ot=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*$)}this._mixBufferRegion=_e,this._mixBufferRegionAdditive=it,this._setIdentity=ot,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(o,_){const $=this.buffer,_e=this.valueSize,it=o*_e+_e;let ot=this.cumulativeWeight;if(ot===0){for(let ct=0;ct!==_e;++ct)$[it+ct]=$[ct];ot=_}else{ot+=_;const ct=_/ot;this._mixBufferRegion($,it,0,ct,_e)}this.cumulativeWeight=ot}accumulateAdditive(o){const _=this.buffer,$=this.valueSize,_e=$*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(_,_e,0,o,$),this.cumulativeWeightAdditive+=o}apply(o){const _=this.valueSize,$=this.buffer,_e=o*_+_,it=this.cumulativeWeight,ot=this.cumulativeWeightAdditive,ct=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,it<1){const mt=_*this._origIndex;this._mixBufferRegion($,_e,mt,1-it,_)}ot>0&&this._mixBufferRegionAdditive($,_e,this._addIndex*_,1,_);for(let mt=_,gt=_+_;mt!==gt;++mt)if($[mt]!==$[mt+_]){ct.setValue($,_e);break}}saveOriginalState(){const o=this.binding,_=this.buffer,$=this.valueSize,_e=$*this._origIndex;o.getValue(_,_e);for(let it=$,ot=_e;it!==ot;++it)_[it]=_[_e+it%$];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const o=3*this.valueSize;this.binding.setValue(this.buffer,o)}_setAdditiveIdentityNumeric(){const o=this._addIndex*this.valueSize,_=o+this.valueSize;for(let $=o;$<_;$++)this.buffer[$]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const o=this._origIndex*this.valueSize,_=this._addIndex*this.valueSize;for(let $=0;$<this.valueSize;$++)this.buffer[_+$]=this.buffer[o+$]}_select(o,_,$,_e,it){if(_e>=.5)for(let ot=0;ot!==it;++ot)o[_+ot]=o[$+ot]}_slerp(o,_,$,_e){Lu.slerpFlat(o,_,o,_,o,$,_e)}_slerpAdditive(o,_,$,_e,it){const ot=this._workIndex*it;Lu.multiplyQuaternionsFlat(o,ot,o,_,o,$),Lu.slerpFlat(o,_,o,_,o,ot,_e)}_lerp(o,_,$,_e,it){const ot=1-_e;for(let ct=0;ct!==it;++ct){const mt=_+ct;o[mt]=o[mt]*ot+o[$+ct]*_e}}_lerpAdditive(o,_,$,_e,it){for(let ot=0;ot!==it;++ot){const ct=_+ot;o[ct]=o[ct]+o[$+ot]*_e}}}const kx=new RegExp("[\\[\\]\\.:\\/]","g"),iw="[^\\[\\]\\.:\\/]",sw="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",TE=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",iw)+/(WCOD+)?/.source.replace("WCOD",sw)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",iw)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",iw)+"$"),Bx=["material","materials","bones","map"];class Po{constructor(o,_,$){this.path=_,this.parsedPath=$||Po.parseTrackName(_),this.node=Po.findNode(o,this.parsedPath.nodeName)||o,this.rootNode=o,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(o,_,$){return o&&o.isAnimationObjectGroup?new Po.Composite(o,_,$):new Po(o,_,$)}static sanitizeNodeName(o){return o.replace(/\s/g,"_").replace(kx,"")}static parseTrackName(o){const _=TE.exec(o);if(_===null)throw new Error("PropertyBinding: Cannot parse trackName: "+o);const $={nodeName:_[2],objectName:_[3],objectIndex:_[4],propertyName:_[5],propertyIndex:_[6]},_e=$.nodeName&&$.nodeName.lastIndexOf(".");if(_e!==void 0&&_e!==-1){const it=$.nodeName.substring(_e+1);Bx.indexOf(it)!==-1&&($.nodeName=$.nodeName.substring(0,_e),$.objectName=it)}if($.propertyName===null||$.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+o);return $}static findNode(o,_){if(_===void 0||_===""||_==="."||_===-1||_===o.name||_===o.uuid)return o;if(o.skeleton){const $=o.skeleton.getBoneByName(_);if($!==void 0)return $}if(o.children){const $=function(it){for(let ot=0;ot<it.length;ot++){const ct=it[ot];if(ct.name===_||ct.uuid===_)return ct;const mt=$(ct.children);if(mt)return mt}return null},_e=$(o.children);if(_e)return _e}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(o,_){o[_]=this.targetObject[this.propertyName]}_getValue_array(o,_){const $=this.resolvedProperty;for(let _e=0,it=$.length;_e!==it;++_e)o[_++]=$[_e]}_getValue_arrayElement(o,_){o[_]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(o,_){this.resolvedProperty.toArray(o,_)}_setValue_direct(o,_){this.targetObject[this.propertyName]=o[_]}_setValue_direct_setNeedsUpdate(o,_){this.targetObject[this.propertyName]=o[_],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(o,_){this.targetObject[this.propertyName]=o[_],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(o,_){const $=this.resolvedProperty;for(let _e=0,it=$.length;_e!==it;++_e)$[_e]=o[_++]}_setValue_array_setNeedsUpdate(o,_){const $=this.resolvedProperty;for(let _e=0,it=$.length;_e!==it;++_e)$[_e]=o[_++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(o,_){const $=this.resolvedProperty;for(let _e=0,it=$.length;_e!==it;++_e)$[_e]=o[_++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(o,_){this.resolvedProperty[this.propertyIndex]=o[_]}_setValue_arrayElement_setNeedsUpdate(o,_){this.resolvedProperty[this.propertyIndex]=o[_],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(o,_){this.resolvedProperty[this.propertyIndex]=o[_],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(o,_){this.resolvedProperty.fromArray(o,_)}_setValue_fromArray_setNeedsUpdate(o,_){this.resolvedProperty.fromArray(o,_),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(o,_){this.resolvedProperty.fromArray(o,_),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(o,_){this.bind(),this.getValue(o,_)}_setValue_unbound(o,_){this.bind(),this.setValue(o,_)}bind(){let o=this.node;const _=this.parsedPath,$=_.objectName,_e=_.propertyName;let it=_.propertyIndex;if(o||(o=Po.findNode(this.rootNode,_.nodeName)||this.rootNode,this.node=o),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!o)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if($){let gt=_.objectIndex;switch($){case"materials":if(!o.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!o.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);o=o.material.materials;break;case"bones":if(!o.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);o=o.skeleton.bones;for(let St=0;St<o.length;St++)if(o[St].name===gt){gt=St;break}break;case"map":if(!o.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!o.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);o=o.material.map;break;default:if(o[$]===void 0)return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);o=o[$]}if(gt!==void 0){if(o[gt]===void 0)return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,o);o=o[gt]}}const ot=o[_e];if(ot===void 0){const gt=_.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+gt+"."+_e+" but it wasn't found.",o)}let ct=this.Versioning.None;this.targetObject=o,o.needsUpdate!==void 0?ct=this.Versioning.NeedsUpdate:o.matrixWorldNeedsUpdate!==void 0&&(ct=this.Versioning.MatrixWorldNeedsUpdate);let mt=this.BindingType.Direct;if(it!==void 0){if(_e==="morphTargetInfluences"){if(!o.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!o.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);o.morphTargetDictionary[it]!==void 0&&(it=o.morphTargetDictionary[it])}mt=this.BindingType.ArrayElement,this.resolvedProperty=ot,this.propertyIndex=it}else ot.fromArray!==void 0&&ot.toArray!==void 0?(mt=this.BindingType.HasFromToArray,this.resolvedProperty=ot):Array.isArray(ot)?(mt=this.BindingType.EntireArray,this.resolvedProperty=ot):this.propertyName=_e;this.getValue=this.GetterByBindingType[mt],this.setValue=this.SetterByBindingTypeAndVersioning[mt][ct]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Po.Composite=class{constructor(ut,o,_){const $=_||Po.parseTrackName(o);this._targetGroup=ut,this._bindings=ut.subscribe_(o,$)}getValue(ut,o){this.bind();const _=this._targetGroup.nCachedObjects_,$=this._bindings[_];$!==void 0&&$.getValue(ut,o)}setValue(ut,o){const _=this._bindings;for(let $=this._targetGroup.nCachedObjects_,_e=_.length;$!==_e;++$)_[$].setValue(ut,o)}bind(){const ut=this._bindings;for(let o=this._targetGroup.nCachedObjects_,_=ut.length;o!==_;++o)ut[o].bind()}unbind(){const ut=this._bindings;for(let o=this._targetGroup.nCachedObjects_,_=ut.length;o!==_;++o)ut[o].unbind()}},Po.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Po.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Po.prototype.GetterByBindingType=[Po.prototype._getValue_direct,Po.prototype._getValue_array,Po.prototype._getValue_arrayElement,Po.prototype._getValue_toArray],Po.prototype.SetterByBindingTypeAndVersioning=[[Po.prototype._setValue_direct,Po.prototype._setValue_direct_setNeedsUpdate,Po.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Po.prototype._setValue_array,Po.prototype._setValue_array_setNeedsUpdate,Po.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Po.prototype._setValue_arrayElement,Po.prototype._setValue_arrayElement_setNeedsUpdate,Po.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Po.prototype._setValue_fromArray,Po.prototype._setValue_fromArray_setNeedsUpdate,Po.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class $y{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Ju(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const o={};this._indicesByUUID=o;for(let $=0,_e=arguments.length;$!==_e;++$)o[arguments[$].uuid]=$;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const _=this;this.stats={objects:{get total(){return _._objects.length},get inUse(){return this.total-_.nCachedObjects_}},get bindingsPerObject(){return _._bindings.length}}}add(){const o=this._objects,_=this._indicesByUUID,$=this._paths,_e=this._parsedPaths,it=this._bindings,ot=it.length;let ct,mt=o.length,gt=this.nCachedObjects_;for(let St=0,Tt=arguments.length;St!==Tt;++St){const Ct=arguments[St],Pt=Ct.uuid;let Ot=_[Pt];if(Ot===void 0){Ot=mt++,_[Pt]=Ot,o.push(Ct);for(let Dt=0,Yt=ot;Dt!==Yt;++Dt)it[Dt].push(new Po(Ct,$[Dt],_e[Dt]))}else if(Ot<gt){ct=o[Ot];const Dt=--gt,Yt=o[Dt];_[Yt.uuid]=Ot,o[Ot]=Yt,_[Pt]=Dt,o[Dt]=Ct;for(let Xt=0,Jt=ot;Xt!==Jt;++Xt){const an=it[Xt],fn=an[Dt];let gn=an[Ot];an[Ot]=fn,gn===void 0&&(gn=new Po(Ct,$[Xt],_e[Xt])),an[Dt]=gn}}else o[Ot]!==ct&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=gt}remove(){const o=this._objects,_=this._indicesByUUID,$=this._bindings,_e=$.length;let it=this.nCachedObjects_;for(let ot=0,ct=arguments.length;ot!==ct;++ot){const mt=arguments[ot],gt=mt.uuid,St=_[gt];if(St!==void 0&&St>=it){const Tt=it++,Ct=o[Tt];_[Ct.uuid]=St,o[St]=Ct,_[gt]=Tt,o[Tt]=mt;for(let Pt=0,Ot=_e;Pt!==Ot;++Pt){const Dt=$[Pt],Yt=Dt[Tt],Xt=Dt[St];Dt[St]=Yt,Dt[Tt]=Xt}}}this.nCachedObjects_=it}uncache(){const o=this._objects,_=this._indicesByUUID,$=this._bindings,_e=$.length;let it=this.nCachedObjects_,ot=o.length;for(let ct=0,mt=arguments.length;ct!==mt;++ct){const gt=arguments[ct].uuid,St=_[gt];if(St!==void 0)if(delete _[gt],St<it){const Tt=--it,Ct=o[Tt],Pt=--ot,Ot=o[Pt];_[Ct.uuid]=St,o[St]=Ct,_[Ot.uuid]=Tt,o[Tt]=Ot,o.pop();for(let Dt=0,Yt=_e;Dt!==Yt;++Dt){const Xt=$[Dt],Jt=Xt[Tt],an=Xt[Pt];Xt[St]=Jt,Xt[Tt]=an,Xt.pop()}}else{const Tt=--ot,Ct=o[Tt];Tt>0&&(_[Ct.uuid]=St),o[St]=Ct,o.pop();for(let Pt=0,Ot=_e;Pt!==Ot;++Pt){const Dt=$[Pt];Dt[St]=Dt[Tt],Dt.pop()}}}this.nCachedObjects_=it}subscribe_(o,_){const $=this._bindingsIndicesByPath;let _e=$[o];const it=this._bindings;if(_e!==void 0)return it[_e];const ot=this._paths,ct=this._parsedPaths,mt=this._objects,gt=mt.length,St=this.nCachedObjects_,Tt=new Array(gt);_e=it.length,$[o]=_e,ot.push(o),ct.push(_),it.push(Tt);for(let Ct=St,Pt=mt.length;Ct!==Pt;++Ct){const Ot=mt[Ct];Tt[Ct]=new Po(Ot,o,_)}return Tt}unsubscribe_(o){const _=this._bindingsIndicesByPath,$=_[o];if($!==void 0){const _e=this._paths,it=this._parsedPaths,ot=this._bindings,ct=ot.length-1,mt=ot[ct];_[o[ct]]=$,ot[$]=mt,ot.pop(),it[$]=it[ct],it.pop(),_e[$]=_e[ct],_e.pop()}}}class IE{constructor(o,_,$=null,_e=_.blendMode){this._mixer=o,this._clip=_,this._localRoot=$,this.blendMode=_e;const it=_.tracks,ot=it.length,ct=new Array(ot),mt={endingStart:_u,endingEnd:_u};for(let gt=0;gt!==ot;++gt){const St=it[gt].createInterpolant(null);ct[gt]=St,St.settings=mt}this._interpolantSettings=mt,this._interpolants=ct,this._propertyBindings=new Array(ot),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=mA,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(o){return this._startTime=o,this}setLoop(o,_){return this.loop=o,this.repetitions=_,this}setEffectiveWeight(o){return this.weight=o,this._effectiveWeight=this.enabled?o:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(o){return this._scheduleFading(o,0,1)}fadeOut(o){return this._scheduleFading(o,1,0)}crossFadeFrom(o,_,$){if(o.fadeOut(_),this.fadeIn(_),$){const _e=this._clip.duration,it=o._clip.duration,ot=it/_e,ct=_e/it;o.warp(1,ot,_),this.warp(ct,1,_)}return this}crossFadeTo(o,_,$){return o.crossFadeFrom(this,_,$)}stopFading(){const o=this._weightInterpolant;return o!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(o)),this}setEffectiveTimeScale(o){return this.timeScale=o,this._effectiveTimeScale=this.paused?0:o,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(o){return this.timeScale=this._clip.duration/o,this.stopWarping()}syncWith(o){return this.time=o.time,this.timeScale=o.timeScale,this.stopWarping()}halt(o){return this.warp(this._effectiveTimeScale,0,o)}warp(o,_,$){const _e=this._mixer,it=_e.time,ot=this.timeScale;let ct=this._timeScaleInterpolant;ct===null&&(ct=_e._lendControlInterpolant(),this._timeScaleInterpolant=ct);const mt=ct.parameterPositions,gt=ct.sampleValues;return mt[0]=it,mt[1]=it+$,gt[0]=o/ot,gt[1]=_/ot,this}stopWarping(){const o=this._timeScaleInterpolant;return o!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(o)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(o,_,$,_e){if(!this.enabled)return void this._updateWeight(o);const it=this._startTime;if(it!==null){const mt=(o-it)*$;mt<0||$===0?_=0:(this._startTime=null,_=$*mt)}_*=this._updateTimeScale(o);const ot=this._updateTime(_),ct=this._updateWeight(o);if(ct>0){const mt=this._interpolants,gt=this._propertyBindings;if(this.blendMode===gA)for(let St=0,Tt=mt.length;St!==Tt;++St)mt[St].evaluate(ot),gt[St].accumulateAdditive(ct);else for(let St=0,Tt=mt.length;St!==Tt;++St)mt[St].evaluate(ot),gt[St].accumulate(_e,ct)}}_updateWeight(o){let _=0;if(this.enabled){_=this.weight;const $=this._weightInterpolant;if($!==null){const _e=$.evaluate(o)[0];_*=_e,o>$.parameterPositions[1]&&(this.stopFading(),_e===0&&(this.enabled=!1))}}return this._effectiveWeight=_,_}_updateTimeScale(o){let _=0;if(!this.paused){_=this.timeScale;const $=this._timeScaleInterpolant;$!==null&&(_*=$.evaluate(o)[0],o>$.parameterPositions[1]&&(this.stopWarping(),_===0?this.paused=!0:this.timeScale=_))}return this._effectiveTimeScale=_,_}_updateTime(o){const _=this._clip.duration,$=this.loop;let _e=this.time+o,it=this._loopCount;const ot=$===x_;if(o===0)return it===-1?_e:ot&&(1&it)==1?_-_e:_e;if($===wp){it===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(_e>=_)_e=_;else{if(!(_e<0)){this.time=_e;break e}_e=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=_e,this._mixer.dispatchEvent({type:"finished",action:this,direction:o<0?-1:1})}}else{if(it===-1&&(o>=0?(it=0,this._setEndings(!0,this.repetitions===0,ot)):this._setEndings(this.repetitions===0,!0,ot)),_e>=_||_e<0){const ct=Math.floor(_e/_);_e-=_*ct,it+=Math.abs(ct);const mt=this.repetitions-it;if(mt<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,_e=o>0?_:0,this.time=_e,this._mixer.dispatchEvent({type:"finished",action:this,direction:o>0?1:-1});else{if(mt===1){const gt=o<0;this._setEndings(gt,!gt,ot)}else this._setEndings(!1,!1,ot);this._loopCount=it,this.time=_e,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:ct})}}else this.time=_e;if(ot&&(1&it)==1)return _-_e}return _e}_setEndings(o,_,$){const _e=this._interpolantSettings;$?(_e.endingStart=Xp,_e.endingEnd=Xp):(_e.endingStart=o?this.zeroSlopeAtStart?Xp:_u:E_,_e.endingEnd=_?this.zeroSlopeAtEnd?Xp:_u:E_)}_scheduleFading(o,_,$){const _e=this._mixer,it=_e.time;let ot=this._weightInterpolant;ot===null&&(ot=_e._lendControlInterpolant(),this._weightInterpolant=ot);const ct=ot.parameterPositions,mt=ot.sampleValues;return ct[0]=it,mt[0]=_,ct[1]=it+o,mt[1]=$,this}}const PE=new Float32Array(1);class OC extends Fs{constructor(o){super(),this._root=o,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(o,_){const $=o._localRoot||this._root,_e=o._clip.tracks,it=_e.length,ot=o._propertyBindings,ct=o._interpolants,mt=$.uuid,gt=this._bindingsByRootAndName;let St=gt[mt];St===void 0&&(St={},gt[mt]=St);for(let Tt=0;Tt!==it;++Tt){const Ct=_e[Tt],Pt=Ct.name;let Ot=St[Pt];if(Ot!==void 0)++Ot.referenceCount,ot[Tt]=Ot;else{if(Ot=ot[Tt],Ot!==void 0){Ot._cacheIndex===null&&(++Ot.referenceCount,this._addInactiveBinding(Ot,mt,Pt));continue}const Dt=_&&_._propertyBindings[Tt].binding.parsedPath;Ot=new Rx(Po.create($,Pt,Dt),Ct.ValueTypeName,Ct.getValueSize()),++Ot.referenceCount,this._addInactiveBinding(Ot,mt,Pt),ot[Tt]=Ot}ct[Tt].resultBuffer=Ot.buffer}}_activateAction(o){if(!this._isActiveAction(o)){if(o._cacheIndex===null){const $=(o._localRoot||this._root).uuid,_e=o._clip.uuid,it=this._actionsByClip[_e];this._bindAction(o,it&&it.knownActions[0]),this._addInactiveAction(o,_e,$)}const _=o._propertyBindings;for(let $=0,_e=_.length;$!==_e;++$){const it=_[$];it.useCount++==0&&(this._lendBinding(it),it.saveOriginalState())}this._lendAction(o)}}_deactivateAction(o){if(this._isActiveAction(o)){const _=o._propertyBindings;for(let $=0,_e=_.length;$!==_e;++$){const it=_[$];--it.useCount==0&&(it.restoreOriginalState(),this._takeBackBinding(it))}this._takeBackAction(o)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const o=this;this.stats={actions:{get total(){return o._actions.length},get inUse(){return o._nActiveActions}},bindings:{get total(){return o._bindings.length},get inUse(){return o._nActiveBindings}},controlInterpolants:{get total(){return o._controlInterpolants.length},get inUse(){return o._nActiveControlInterpolants}}}}_isActiveAction(o){const _=o._cacheIndex;return _!==null&&_<this._nActiveActions}_addInactiveAction(o,_,$){const _e=this._actions,it=this._actionsByClip;let ot=it[_];if(ot===void 0)ot={knownActions:[o],actionByRoot:{}},o._byClipCacheIndex=0,it[_]=ot;else{const ct=ot.knownActions;o._byClipCacheIndex=ct.length,ct.push(o)}o._cacheIndex=_e.length,_e.push(o),ot.actionByRoot[$]=o}_removeInactiveAction(o){const _=this._actions,$=_[_.length-1],_e=o._cacheIndex;$._cacheIndex=_e,_[_e]=$,_.pop(),o._cacheIndex=null;const it=o._clip.uuid,ot=this._actionsByClip,ct=ot[it],mt=ct.knownActions,gt=mt[mt.length-1],St=o._byClipCacheIndex;gt._byClipCacheIndex=St,mt[St]=gt,mt.pop(),o._byClipCacheIndex=null,delete ct.actionByRoot[(o._localRoot||this._root).uuid],mt.length===0&&delete ot[it],this._removeInactiveBindingsForAction(o)}_removeInactiveBindingsForAction(o){const _=o._propertyBindings;for(let $=0,_e=_.length;$!==_e;++$){const it=_[$];--it.referenceCount==0&&this._removeInactiveBinding(it)}}_lendAction(o){const _=this._actions,$=o._cacheIndex,_e=this._nActiveActions++,it=_[_e];o._cacheIndex=_e,_[_e]=o,it._cacheIndex=$,_[$]=it}_takeBackAction(o){const _=this._actions,$=o._cacheIndex,_e=--this._nActiveActions,it=_[_e];o._cacheIndex=_e,_[_e]=o,it._cacheIndex=$,_[$]=it}_addInactiveBinding(o,_,$){const _e=this._bindingsByRootAndName,it=this._bindings;let ot=_e[_];ot===void 0&&(ot={},_e[_]=ot),ot[$]=o,o._cacheIndex=it.length,it.push(o)}_removeInactiveBinding(o){const _=this._bindings,$=o.binding,_e=$.rootNode.uuid,it=$.path,ot=this._bindingsByRootAndName,ct=ot[_e],mt=_[_.length-1],gt=o._cacheIndex;mt._cacheIndex=gt,_[gt]=mt,_.pop(),delete ct[it],Object.keys(ct).length===0&&delete ot[_e]}_lendBinding(o){const _=this._bindings,$=o._cacheIndex,_e=this._nActiveBindings++,it=_[_e];o._cacheIndex=_e,_[_e]=o,it._cacheIndex=$,_[$]=it}_takeBackBinding(o){const _=this._bindings,$=o._cacheIndex,_e=--this._nActiveBindings,it=_[_e];o._cacheIndex=_e,_[_e]=o,it._cacheIndex=$,_[$]=it}_lendControlInterpolant(){const o=this._controlInterpolants,_=this._nActiveControlInterpolants++;let $=o[_];return $===void 0&&($=new SC(new Float32Array(2),new Float32Array(2),1,PE),$.__cacheIndex=_,o[_]=$),$}_takeBackControlInterpolant(o){const _=this._controlInterpolants,$=o.__cacheIndex,_e=--this._nActiveControlInterpolants,it=_[_e];o.__cacheIndex=_e,_[_e]=o,it.__cacheIndex=$,_[$]=it}clipAction(o,_,$){const _e=_||this._root,it=_e.uuid;let ot=typeof o=="string"?Ex.findByName(_e,o):o;const ct=ot!==null?ot.uuid:o,mt=this._actionsByClip[ct];let gt=null;if($===void 0&&($=ot!==null?ot.blendMode:El),mt!==void 0){const Tt=mt.actionByRoot[it];if(Tt!==void 0&&Tt.blendMode===$)return Tt;gt=mt.knownActions[0],ot===null&&(ot=gt._clip)}if(ot===null)return null;const St=new IE(this,ot,_,$);return this._bindAction(St,gt),this._addInactiveAction(St,ct,it),St}existingAction(o,_){const $=_||this._root,_e=$.uuid,it=typeof o=="string"?Ex.findByName($,o):o,ot=it?it.uuid:o,ct=this._actionsByClip[ot];return ct!==void 0&&ct.actionByRoot[_e]||null}stopAllAction(){const o=this._actions;for(let _=this._nActiveActions-1;_>=0;--_)o[_].stop();return this}update(o){o*=this.timeScale;const _=this._actions,$=this._nActiveActions,_e=this.time+=o,it=Math.sign(o),ot=this._accuIndex^=1;for(let gt=0;gt!==$;++gt)_[gt]._update(_e,o,it,ot);const ct=this._bindings,mt=this._nActiveBindings;for(let gt=0;gt!==mt;++gt)ct[gt].apply(ot);return this}setTime(o){this.time=0;for(let _=0;_<this._actions.length;_++)this._actions[_].time=0;return this.update(o)}getRoot(){return this._root}uncacheClip(o){const _=this._actions,$=o.uuid,_e=this._actionsByClip,it=_e[$];if(it!==void 0){const ot=it.knownActions;for(let ct=0,mt=ot.length;ct!==mt;++ct){const gt=ot[ct];this._deactivateAction(gt);const St=gt._cacheIndex,Tt=_[_.length-1];gt._cacheIndex=null,gt._byClipCacheIndex=null,Tt._cacheIndex=St,_[St]=Tt,_.pop(),this._removeInactiveBindingsForAction(gt)}delete _e[$]}}uncacheRoot(o){const _=o.uuid,$=this._actionsByClip;for(const it in $){const ot=$[it].actionByRoot[_];ot!==void 0&&(this._deactivateAction(ot),this._removeInactiveAction(ot))}const _e=this._bindingsByRootAndName[_];if(_e!==void 0)for(const it in _e){const ot=_e[it];ot.restoreOriginalState(),this._removeInactiveBinding(ot)}}uncacheAction(o,_){const $=this.existingAction(o,_);$!==null&&(this._deactivateAction($),this._removeInactiveAction($))}}class ty{constructor(o){this.value=o}clone(){return new ty(this.value.clone===void 0?this.value:this.value.clone())}}let DE=0;class Ox extends Fs{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:DE++}),this.name="",this.usage=I_,this.uniforms=[]}add(o){return this.uniforms.push(o),this}remove(o){const _=this.uniforms.indexOf(o);return _!==-1&&this.uniforms.splice(_,1),this}setName(o){return this.name=o,this}setUsage(o){return this.usage=o,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(o){this.name=o.name,this.usage=o.usage;const _=o.uniforms;this.uniforms.length=0;for(let $=0,_e=_.length;$<_e;$++)this.uniforms.push(_[$].clone());return this}clone(){return new this.constructor().copy(this)}}class RE extends W1{constructor(o,_,$=1){super(o,_),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=$}copy(o){return super.copy(o),this.meshPerAttribute=o.meshPerAttribute,this}clone(o){const _=super.clone(o);return _.meshPerAttribute=this.meshPerAttribute,_}toJSON(o){const _=super.toJSON(o);return _.isInstancedInterleavedBuffer=!0,_.meshPerAttribute=this.meshPerAttribute,_}}class ow{constructor(o,_,$,_e,it){this.isGLBufferAttribute=!0,this.buffer=o,this.type=_,this.itemSize=$,this.elementSize=_e,this.count=it,this.version=0}set needsUpdate(o){o===!0&&this.version++}setBuffer(o){return this.buffer=o,this}setType(o,_){return this.type=o,this.elementSize=_,this}setItemSize(o){return this.itemSize=o,this}setCount(o){return this.count=o,this}}class kE{constructor(o,_,$=0,_e=1/0){this.ray=new $v(o,_),this.near=$,this.far=_e,this.camera=null,this.layers=new cp,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(o,_){this.ray.set(o,_)}setFromCamera(o,_){_.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(_.matrixWorld),this.ray.direction.set(o.x,o.y,.5).unproject(_).sub(this.ray.origin).normalize(),this.camera=_):_.isOrthographicCamera?(this.ray.origin.set(o.x,o.y,(_.near+_.far)/(_.near-_.far)).unproject(_),this.ray.direction.set(0,0,-1).transformDirection(_.matrixWorld),this.camera=_):console.error("THREE.Raycaster: Unsupported camera type: "+_.type)}intersectObject(o,_=!0,$=[]){return OE(o,this,$,_),$.sort(BE),$}intersectObjects(o,_=!0,$=[]){for(let _e=0,it=o.length;_e<it;_e++)OE(o[_e],this,$,_);return $.sort(BE),$}}function BE(ut,o){return ut.distance-o.distance}function OE(ut,o,_,$){if(ut.layers.test(o.layers)&&ut.raycast(o,_),$===!0){const _e=ut.children;for(let it=0,ot=_e.length;it<ot;it++)OE(_e[it],o,_,!0)}}class yP{constructor(o=1,_=0,$=0){return this.radius=o,this.phi=_,this.theta=$,this}set(o,_,$){return this.radius=o,this.phi=_,this.theta=$,this}copy(o){return this.radius=o.radius,this.phi=o.phi,this.theta=o.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(o){return this.setFromCartesianCoords(o.x,o.y,o.z)}setFromCartesianCoords(o,_,$){return this.radius=Math.sqrt(o*o+_*_+$*$),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(o,$),this.phi=Math.acos(Ms(_/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class XT{constructor(o=1,_=0,$=0){return this.radius=o,this.theta=_,this.y=$,this}set(o,_,$){return this.radius=o,this.theta=_,this.y=$,this}copy(o){return this.radius=o.radius,this.theta=o.theta,this.y=o.y,this}setFromVector3(o){return this.setFromCartesianCoords(o.x,o.y,o.z)}setFromCartesianCoords(o,_,$){return this.radius=Math.sqrt(o*o+$*$),this.theta=Math.atan2(o,$),this.y=_,this}clone(){return new this.constructor().copy(this)}}const KT=new Rr;class AP{constructor(o=new Rr(1/0,1/0),_=new Rr(-1/0,-1/0)){this.isBox2=!0,this.min=o,this.max=_}set(o,_){return this.min.copy(o),this.max.copy(_),this}setFromPoints(o){this.makeEmpty();for(let _=0,$=o.length;_<$;_++)this.expandByPoint(o[_]);return this}setFromCenterAndSize(o,_){const $=KT.copy(_).multiplyScalar(.5);return this.min.copy(o).sub($),this.max.copy(o).add($),this}clone(){return new this.constructor().copy(this)}copy(o){return this.min.copy(o.min),this.max.copy(o.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(o){return this.isEmpty()?o.set(0,0):o.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(o){return this.isEmpty()?o.set(0,0):o.subVectors(this.max,this.min)}expandByPoint(o){return this.min.min(o),this.max.max(o),this}expandByVector(o){return this.min.sub(o),this.max.add(o),this}expandByScalar(o){return this.min.addScalar(-o),this.max.addScalar(o),this}containsPoint(o){return!(o.x<this.min.x||o.x>this.max.x||o.y<this.min.y||o.y>this.max.y)}containsBox(o){return this.min.x<=o.min.x&&o.max.x<=this.max.x&&this.min.y<=o.min.y&&o.max.y<=this.max.y}getParameter(o,_){return _.set((o.x-this.min.x)/(this.max.x-this.min.x),(o.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(o){return!(o.max.x<this.min.x||o.min.x>this.max.x||o.max.y<this.min.y||o.min.y>this.max.y)}clampPoint(o,_){return _.copy(o).clamp(this.min,this.max)}distanceToPoint(o){return KT.copy(o).clamp(this.min,this.max).sub(o).length()}intersect(o){return this.min.max(o.min),this.max.min(o.max),this}union(o){return this.min.min(o.min),this.max.max(o.max),this}translate(o){return this.min.add(o),this.max.add(o),this}equals(o){return o.min.equals(this.min)&&o.max.equals(this.max)}}const LC=new An,aw=new An;class $T{constructor(o=new An,_=new An){this.start=o,this.end=_}set(o,_){return this.start.copy(o),this.end.copy(_),this}copy(o){return this.start.copy(o.start),this.end.copy(o.end),this}getCenter(o){return o.addVectors(this.start,this.end).multiplyScalar(.5)}delta(o){return o.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(o,_){return this.delta(_).multiplyScalar(o).add(this.start)}closestPointToPointParameter(o,_){LC.subVectors(o,this.start),aw.subVectors(this.end,this.start);const $=aw.dot(aw);let _e=aw.dot(LC)/$;return _&&(_e=Ms(_e,0,1)),_e}closestPointToPoint(o,_,$){const _e=this.closestPointToPointParameter(o,_);return this.delta($).multiplyScalar(_e).add(this.start)}applyMatrix4(o){return this.start.applyMatrix4(o),this.end.applyMatrix4(o),this}equals(o){return o.start.equals(this.start)&&o.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const Co=new An;class rp extends no{constructor(o,_){super(),this.light=o,this.light.updateMatrixWorld(),this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1,this.color=_;const $=new ps,_e=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let ot=0,ct=1,mt=32;ot<mt;ot++,ct++){const gt=ot/mt*Math.PI*2,St=ct/mt*Math.PI*2;_e.push(Math.cos(gt),Math.sin(gt),1,Math.cos(St),Math.sin(St),1)}$.setAttribute("position",new dt(_e,3));const it=new Np({fog:!1,toneMapped:!1});this.cone=new o_($,it),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const o=this.light.distance?this.light.distance:1e3,_=o*Math.tan(this.light.angle);this.cone.scale.set(_,_,o),Co.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Co),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Ip=new An,l0=new Us,ny=new Us;class Lx extends o_{constructor(o){const _=NC(o),$=new ps,_e=[],it=[],ot=new is(0,0,1),ct=new is(0,1,0);for(let mt=0;mt<_.length;mt++){const gt=_[mt];gt.parent&&gt.parent.isBone&&(_e.push(0,0,0),_e.push(0,0,0),it.push(ot.r,ot.g,ot.b),it.push(ct.r,ct.g,ct.b))}$.setAttribute("position",new dt(_e,3)),$.setAttribute("color",new dt(it,3)),super($,new Np({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=o,this.bones=_,this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(o){const _=this.bones,$=this.geometry,_e=$.getAttribute("position");ny.copy(this.root.matrixWorld).invert();for(let it=0,ot=0;it<_.length;it++){const ct=_[it];ct.parent&&ct.parent.isBone&&(l0.multiplyMatrices(ny,ct.matrixWorld),Ip.setFromMatrixPosition(l0),_e.setXYZ(ot,Ip.x,Ip.y,Ip.z),l0.multiplyMatrices(ny,ct.parent.matrixWorld),Ip.setFromMatrixPosition(l0),_e.setXYZ(ot+1,Ip.x,Ip.y,Ip.z),ot+=2)}$.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(o)}}function NC(ut){const o=[];ut.isBone===!0&&o.push(ut);for(let _=0;_<ut.children.length;_++)o.push.apply(o,NC(ut.children[_]));return o}class JT extends ju{constructor(o,_,$){super(new ew(_,4,2),new Wm({wireframe:!0,fog:!1,toneMapped:!1})),this.light=o,this.light.updateMatrixWorld(),this.color=$,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const FC=new An,Nx=new is,UC=new is;class ZT extends no{constructor(o,_,$){super(),this.light=o,this.light.updateMatrixWorld(),this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1,this.color=$;const _e=new pp(_);_e.rotateY(.5*Math.PI),this.material=new Wm({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const it=_e.getAttribute("position"),ot=new Float32Array(3*it.count);_e.setAttribute("color",new $o(ot,3)),this.add(new ju(_e,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const o=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const _=o.geometry.getAttribute("color");Nx.copy(this.light.color),UC.copy(this.light.groundColor);for(let $=0,_e=_.count;$<_e;$++){const it=$<_e/2?Nx:UC;_.setXYZ($,it.r,it.g,it.b)}_.needsUpdate=!0}o.lookAt(FC.setFromMatrixPosition(this.light.matrixWorld).negate())}}class jC extends o_{constructor(o=10,_=10,$=4473924,_e=8947848){$=new is($),_e=new is(_e);const it=_/2,ot=o/_,ct=o/2,mt=[],gt=[];for(let Tt=0,Ct=0,Pt=-ct;Tt<=_;Tt++,Pt+=ot){mt.push(-ct,0,Pt,ct,0,Pt),mt.push(Pt,0,-ct,Pt,0,ct);const Ot=Tt===it?$:_e;Ot.toArray(gt,Ct),Ct+=3,Ot.toArray(gt,Ct),Ct+=3,Ot.toArray(gt,Ct),Ct+=3,Ot.toArray(gt,Ct),Ct+=3}const St=new ps;St.setAttribute("position",new dt(mt,3)),St.setAttribute("color",new dt(gt,3)),super(St,new Np({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}class Fx extends o_{constructor(o=10,_=16,$=8,_e=64,it=4473924,ot=8947848){it=new is(it),ot=new is(ot);const ct=[],mt=[];if(_>1)for(let St=0;St<_;St++){const Tt=St/_*(2*Math.PI),Ct=Math.sin(Tt)*o,Pt=Math.cos(Tt)*o;ct.push(0,0,0),ct.push(Ct,0,Pt);const Ot=1&St?it:ot;mt.push(Ot.r,Ot.g,Ot.b),mt.push(Ot.r,Ot.g,Ot.b)}for(let St=0;St<$;St++){const Tt=1&St?it:ot,Ct=o-o/$*St;for(let Pt=0;Pt<_e;Pt++){let Ot=Pt/_e*(2*Math.PI),Dt=Math.sin(Ot)*Ct,Yt=Math.cos(Ot)*Ct;ct.push(Dt,0,Yt),mt.push(Tt.r,Tt.g,Tt.b),Ot=(Pt+1)/_e*(2*Math.PI),Dt=Math.sin(Ot)*Ct,Yt=Math.cos(Ot)*Ct,ct.push(Dt,0,Yt),mt.push(Tt.r,Tt.g,Tt.b)}}const gt=new ps;gt.setAttribute("position",new dt(ct,3)),gt.setAttribute("color",new dt(mt,3)),super(gt,new Np({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}}const Hl=new An,u_=new An,Dm=new An;class c0 extends no{constructor(o,_,$){super(),this.light=o,this.light.updateMatrixWorld(),this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1,this.color=$,_===void 0&&(_=1);let _e=new ps;_e.setAttribute("position",new dt([-_,_,0,_,_,0,_,-_,0,-_,-_,0,-_,_,0],3));const it=new Np({fog:!1,toneMapped:!1});this.lightPlane=new s_(_e,it),this.add(this.lightPlane),_e=new ps,_e.setAttribute("position",new dt([0,0,0,0,0,1],3)),this.targetLine=new s_(_e,it),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){Hl.setFromMatrixPosition(this.light.matrixWorld),u_.setFromMatrixPosition(this.light.target.matrixWorld),Dm.subVectors(u_,Hl),this.lightPlane.lookAt(u_),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(u_),this.targetLine.scale.z=Dm.length()}}const u0=new An,cu=new LA;class eI extends o_{constructor(o){const _=new ps,$=new Np({color:16777215,vertexColors:!0,toneMapped:!1}),_e=[],it=[],ot={};function ct(Ot,Dt){mt(Ot),mt(Dt)}function mt(Ot){_e.push(0,0,0),it.push(0,0,0),ot[Ot]===void 0&&(ot[Ot]=[]),ot[Ot].push(_e.length/3-1)}ct("n1","n2"),ct("n2","n4"),ct("n4","n3"),ct("n3","n1"),ct("f1","f2"),ct("f2","f4"),ct("f4","f3"),ct("f3","f1"),ct("n1","f1"),ct("n2","f2"),ct("n3","f3"),ct("n4","f4"),ct("p","n1"),ct("p","n2"),ct("p","n3"),ct("p","n4"),ct("u1","u2"),ct("u2","u3"),ct("u3","u1"),ct("c","t"),ct("p","c"),ct("cn1","cn2"),ct("cn3","cn4"),ct("cf1","cf2"),ct("cf3","cf4"),_.setAttribute("position",new dt(_e,3)),_.setAttribute("color",new dt(it,3)),super(_,$),this.type="CameraHelper",this.camera=o,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=ot,this.update();const gt=new is(16755200),St=new is(16711680),Tt=new is(43775),Ct=new is(16777215),Pt=new is(3355443);this.setColors(gt,St,Tt,Ct,Pt)}setColors(o,_,$,_e,it){const ot=this.geometry.getAttribute("color");ot.setXYZ(0,o.r,o.g,o.b),ot.setXYZ(1,o.r,o.g,o.b),ot.setXYZ(2,o.r,o.g,o.b),ot.setXYZ(3,o.r,o.g,o.b),ot.setXYZ(4,o.r,o.g,o.b),ot.setXYZ(5,o.r,o.g,o.b),ot.setXYZ(6,o.r,o.g,o.b),ot.setXYZ(7,o.r,o.g,o.b),ot.setXYZ(8,o.r,o.g,o.b),ot.setXYZ(9,o.r,o.g,o.b),ot.setXYZ(10,o.r,o.g,o.b),ot.setXYZ(11,o.r,o.g,o.b),ot.setXYZ(12,o.r,o.g,o.b),ot.setXYZ(13,o.r,o.g,o.b),ot.setXYZ(14,o.r,o.g,o.b),ot.setXYZ(15,o.r,o.g,o.b),ot.setXYZ(16,o.r,o.g,o.b),ot.setXYZ(17,o.r,o.g,o.b),ot.setXYZ(18,o.r,o.g,o.b),ot.setXYZ(19,o.r,o.g,o.b),ot.setXYZ(20,o.r,o.g,o.b),ot.setXYZ(21,o.r,o.g,o.b),ot.setXYZ(22,o.r,o.g,o.b),ot.setXYZ(23,o.r,o.g,o.b),ot.setXYZ(24,_.r,_.g,_.b),ot.setXYZ(25,_.r,_.g,_.b),ot.setXYZ(26,_.r,_.g,_.b),ot.setXYZ(27,_.r,_.g,_.b),ot.setXYZ(28,_.r,_.g,_.b),ot.setXYZ(29,_.r,_.g,_.b),ot.setXYZ(30,_.r,_.g,_.b),ot.setXYZ(31,_.r,_.g,_.b),ot.setXYZ(32,$.r,$.g,$.b),ot.setXYZ(33,$.r,$.g,$.b),ot.setXYZ(34,$.r,$.g,$.b),ot.setXYZ(35,$.r,$.g,$.b),ot.setXYZ(36,$.r,$.g,$.b),ot.setXYZ(37,$.r,$.g,$.b),ot.setXYZ(38,_e.r,_e.g,_e.b),ot.setXYZ(39,_e.r,_e.g,_e.b),ot.setXYZ(40,it.r,it.g,it.b),ot.setXYZ(41,it.r,it.g,it.b),ot.setXYZ(42,it.r,it.g,it.b),ot.setXYZ(43,it.r,it.g,it.b),ot.setXYZ(44,it.r,it.g,it.b),ot.setXYZ(45,it.r,it.g,it.b),ot.setXYZ(46,it.r,it.g,it.b),ot.setXYZ(47,it.r,it.g,it.b),ot.setXYZ(48,it.r,it.g,it.b),ot.setXYZ(49,it.r,it.g,it.b),ot.needsUpdate=!0}update(){const o=this.geometry,_=this.pointMap;cu.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),mu("c",_,o,cu,0,0,-1),mu("t",_,o,cu,0,0,1),mu("n1",_,o,cu,-1,-1,-1),mu("n2",_,o,cu,1,-1,-1),mu("n3",_,o,cu,-1,1,-1),mu("n4",_,o,cu,1,1,-1),mu("f1",_,o,cu,-1,-1,1),mu("f2",_,o,cu,1,-1,1),mu("f3",_,o,cu,-1,1,1),mu("f4",_,o,cu,1,1,1),mu("u1",_,o,cu,.7,1.1,-1),mu("u2",_,o,cu,-.7,1.1,-1),mu("u3",_,o,cu,0,2,-1),mu("cf1",_,o,cu,-1,0,1),mu("cf2",_,o,cu,1,0,1),mu("cf3",_,o,cu,0,-1,1),mu("cf4",_,o,cu,0,1,1),mu("cn1",_,o,cu,-1,0,-1),mu("cn2",_,o,cu,1,0,-1),mu("cn3",_,o,cu,0,-1,-1),mu("cn4",_,o,cu,0,1,-1),o.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function mu(ut,o,_,$,_e,it,ot){u0.set(_e,it,ot).unproject($);const ct=o[ut];if(ct!==void 0){const mt=_.getAttribute("position");for(let gt=0,St=ct.length;gt<St;gt++)mt.setXYZ(ct[gt],u0.x,u0.y,u0.z)}}const Ux=new L_;class LE extends o_{constructor(o,_=16776960){const $=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),_e=new Float32Array(24),it=new ps;it.setIndex(new $o($,1)),it.setAttribute("position",new $o(_e,3)),super(it,new Np({color:_,toneMapped:!1})),this.object=o,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(o){if(o!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Ux.setFromObject(this.object),Ux.isEmpty())return;const _=Ux.min,$=Ux.max,_e=this.geometry.attributes.position,it=_e.array;it[0]=$.x,it[1]=$.y,it[2]=$.z,it[3]=_.x,it[4]=$.y,it[5]=$.z,it[6]=_.x,it[7]=_.y,it[8]=$.z,it[9]=$.x,it[10]=_.y,it[11]=$.z,it[12]=$.x,it[13]=$.y,it[14]=_.z,it[15]=_.x,it[16]=$.y,it[17]=_.z,it[18]=_.x,it[19]=_.y,it[20]=_.z,it[21]=$.x,it[22]=_.y,it[23]=_.z,_e.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(o){return this.object=o,this.update(),this}copy(o,_){return super.copy(o,_),this.object=o.object,this}}class Zm extends o_{constructor(o,_=16776960){const $=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),_e=new ps;_e.setIndex(new $o($,1)),_e.setAttribute("position",new dt([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(_e,new Np({color:_,toneMapped:!1})),this.box=o,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(o){const _=this.box;_.isEmpty()||(_.getCenter(this.position),_.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(o))}}class NE extends s_{constructor(o,_=1,$=16776960){const _e=$,it=new ps;it.setAttribute("position",new dt([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),it.computeBoundingSphere(),super(it,new Np({color:_e,toneMapped:!1})),this.type="PlaneHelper",this.plane=o,this.size=_;const ot=new ps;ot.setAttribute("position",new dt([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),ot.computeBoundingSphere(),this.add(new ju(ot,new Wm({color:_e,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(o){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(o)}}const lw=new An;let jp,Jy;class h_ extends no{constructor(o=new An(0,0,1),_=new An(0,0,0),$=1,_e=16776960,it=.2*$,ot=.2*it){super(),this.type="ArrowHelper",jp===void 0&&(jp=new ps,jp.setAttribute("position",new dt([0,0,0,0,1,0],3)),Jy=new zu(0,.5,1,5,1),Jy.translate(0,-.5,0)),this.position.copy(_),this.line=new s_(jp,new Np({color:_e,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new ju(Jy,new Wm({color:_e,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(o),this.setLength($,it,ot)}setDirection(o){if(o.y>.99999)this.quaternion.set(0,0,0,1);else if(o.y<-.99999)this.quaternion.set(1,0,0,0);else{lw.set(o.z,0,-o.x).normalize();const _=Math.acos(o.y);this.quaternion.setFromAxisAngle(lw,_)}}setLength(o,_=.2*o,$=.2*_){this.line.scale.set(1,Math.max(1e-4,o-_),1),this.line.updateMatrix(),this.cone.scale.set($,_,$),this.cone.position.y=o,this.cone.updateMatrix()}setColor(o){this.line.material.color.set(o),this.cone.material.color.set(o)}copy(o){return super.copy(o,!1),this.line.copy(o.line),this.cone.copy(o.cone),this}}class cw extends o_{constructor(o=1){const _=[0,0,0,o,0,0,0,0,0,0,o,0,0,0,0,0,0,o],$=new ps;$.setAttribute("position",new dt(_,3)),$.setAttribute("color",new dt([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super($,new Np({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(o,_,$){const _e=new is,it=this.geometry.attributes.color.array;return _e.set(o),_e.toArray(it,0),_e.toArray(it,3),_e.set(_),_e.toArray(it,6),_e.toArray(it,9),_e.set($),_e.toArray(it,12),_e.toArray(it,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class FE{constructor(){this.type="ShapePath",this.color=new is,this.subPaths=[],this.currentPath=null}moveTo(o,_){return this.currentPath=new KA,this.subPaths.push(this.currentPath),this.currentPath.moveTo(o,_),this}lineTo(o,_){return this.currentPath.lineTo(o,_),this}quadraticCurveTo(o,_,$,_e){return this.currentPath.quadraticCurveTo(o,_,$,_e),this}bezierCurveTo(o,_,$,_e,it,ot){return this.currentPath.bezierCurveTo(o,_,$,_e,it,ot),this}splineThru(o){return this.currentPath.splineThru(o),this}toShapes(o,_){function $(Jt){const an=[];for(let fn=0,gn=Jt.length;fn<gn;fn++){const _n=Jt[fn],On=new Gy;On.curves=_n.curves,an.push(On)}return an}function _e(Jt,an){const fn=an.length;let gn=!1;for(let _n=fn-1,On=0;On<fn;_n=On++){let Ln=an[_n],$n=an[On],Jn=$n.x-Ln.x,Un=$n.y-Ln.y;if(Math.abs(Un)>Number.EPSILON){if(Un<0&&(Ln=an[On],Jn=-Jn,$n=an[_n],Un=-Un),Jt.y<Ln.y||Jt.y>$n.y)continue;if(Jt.y===Ln.y){if(Jt.x===Ln.x)return!0}else{const Er=Un*(Jt.x-Ln.x)-Jn*(Jt.y-Ln.y);if(Er===0)return!0;if(Er<0)continue;gn=!gn}}else{if(Jt.y!==Ln.y)continue;if($n.x<=Jt.x&&Jt.x<=Ln.x||Ln.x<=Jt.x&&Jt.x<=$n.x)return!0}}return gn}const it=Pv.isClockWise,ot=this.subPaths;if(ot.length===0)return[];if(_===!0)return $(ot);let ct,mt,gt;const St=[];if(ot.length===1)return mt=ot[0],gt=new Gy,gt.curves=mt.curves,St.push(gt),St;let Tt=!it(ot[0].getPoints());Tt=o?!Tt:Tt;const Ct=[],Pt=[];let Ot,Dt,Yt=[],Xt=0;Pt[Xt]=void 0,Yt[Xt]=[];for(let Jt=0,an=ot.length;Jt<an;Jt++)mt=ot[Jt],Ot=mt.getPoints(),ct=it(Ot),ct=o?!ct:ct,ct?(!Tt&&Pt[Xt]&&Xt++,Pt[Xt]={s:new Gy,p:Ot},Pt[Xt].s.curves=mt.curves,Tt&&Xt++,Yt[Xt]=[]):Yt[Xt].push({h:mt,p:Ot[0]});if(!Pt[0])return $(ot);if(Pt.length>1){let Jt=!1,an=0;for(let fn=0,gn=Pt.length;fn<gn;fn++)Ct[fn]=[];for(let fn=0,gn=Pt.length;fn<gn;fn++){const _n=Yt[fn];for(let On=0;On<_n.length;On++){const Ln=_n[On];let $n=!0;for(let Jn=0;Jn<Pt.length;Jn++)_e(Ln.p,Pt[Jn].p)&&(fn!==Jn&&an++,$n?($n=!1,Ct[Jn].push(Ln)):Jt=!0);$n&&Ct[fn].push(Ln)}}an>0&&Jt===!1&&(Yt=Ct)}for(let Jt=0,an=Pt.length;Jt<an;Jt++){gt=Pt[Jt].s,St.push(gt),Dt=Yt[Jt];for(let fn=0,gn=Dt.length;fn<gn;fn++)gt.holes.push(Dt[fn].h)}return St}}const _g=zC();function zC(){const ut=new ArrayBuffer(4),o=new Float32Array(ut),_=new Uint32Array(ut),$=new Uint32Array(512),_e=new Uint32Array(512);for(let mt=0;mt<256;++mt){const gt=mt-127;gt<-27?($[mt]=0,$[256|mt]=32768,_e[mt]=24,_e[256|mt]=24):gt<-14?($[mt]=1024>>-gt-14,$[256|mt]=1024>>-gt-14|32768,_e[mt]=-gt-1,_e[256|mt]=-gt-1):gt<=15?($[mt]=gt+15<<10,$[256|mt]=gt+15<<10|32768,_e[mt]=13,_e[256|mt]=13):gt<128?($[mt]=31744,$[256|mt]=64512,_e[mt]=24,_e[256|mt]=24):($[mt]=31744,$[256|mt]=64512,_e[mt]=13,_e[256|mt]=13)}const it=new Uint32Array(2048),ot=new Uint32Array(64),ct=new Uint32Array(64);for(let mt=1;mt<1024;++mt){let gt=mt<<13,St=0;for(;!(8388608&gt);)gt<<=1,St-=8388608;gt&=-8388609,St+=947912704,it[mt]=gt|St}for(let mt=1024;mt<2048;++mt)it[mt]=939524096+(mt-1024<<13);for(let mt=1;mt<31;++mt)ot[mt]=mt<<23;ot[31]=1199570944,ot[32]=2147483648;for(let mt=33;mt<63;++mt)ot[mt]=2147483648+(mt-32<<23);ot[63]=3347054592;for(let mt=1;mt<64;++mt)mt!==32&&(ct[mt]=1024);return{floatView:o,uint32View:_,baseTable:$,shiftTable:_e,mantissaTable:it,exponentTable:ot,offsetTable:ct}}var uw=Object.freeze({__proto__:null,toHalfFloat:function(ut){Math.abs(ut)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),ut=Ms(ut,-65504,65504),_g.floatView[0]=ut;const o=_g.uint32View[0],_=o>>23&511;return _g.baseTable[_]+((8388607&o)>>_g.shiftTable[_])},fromHalfFloat:function(ut){const o=ut>>10;return _g.uint32View[0]=_g.mantissaTable[_g.offsetTable[o]+(1023&ut)]+_g.exponentTable[o],_g.floatView[0]}});function jx(){console.error("THREE.ImmediateRenderObject has been removed.")}class VC extends xp{constructor(o,_,$){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.'),super(o,_,$),this.samples=4}}class tI extends T0{constructor(o,_,$,_e){console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),super(o,_,$,_e)}}class h0 extends O_{constructor(o,_,$,_e){console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),super(o,_,$,_e)}}class nI extends qm{constructor(o,_,$,_e,it,ot){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(o,_,$,_e,it,ot)}}class rI extends cx{constructor(o,_,$,_e){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(o,_,$,_e)}}class hw extends Tm{constructor(o,_,$,_e){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(o,_,$,_e)}}class QC extends Rl{constructor(o,_,$,_e,it,ot,ct){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(o,_,$,_e,it,ot,ct)}}class Zy extends zu{constructor(o,_,$,_e,it,ot,ct,mt){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(o,_,$,_e,it,ot,ct,mt)}}class zx extends ux{constructor(o,_){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(o,_)}}class iI extends gx{constructor(o,_){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(o,_)}}class UE extends ZA{constructor(o,_){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(o,_)}}class sI extends Xl{constructor(o,_,$,_e){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(o,_,$,_e)}}class dw extends pp{constructor(o,_){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(o,_)}}class pw extends j0{constructor(o,_,$,_e){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(o,_,$,_e)}}class oI extends K_{constructor(o,_,$,_e){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(o,_,$,_e)}}class aI extends Wy{constructor(o,_,$,_e,it,ot){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(o,_,$,_e,it,ot)}}class lI extends vx{constructor(o,_){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(o,_)}}class cI extends ew{constructor(o,_,$,_e,it,ot,ct){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(o,_,$,_e,it,ot,ct)}}class ry extends qy{constructor(o,_){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(o,_)}}class GC extends K0{constructor(o,_,$,_e,it){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(o,_,$,_e,it)}}class fw extends np{constructor(o,_,$,_e,it,ot){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(o,_,$,_e,it,ot)}}class ev extends _x{constructor(o,_,$,_e,it){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(o,_,$,_e,it)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:d}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=d)},553:function(b,g,j){j.d(g,{_:function(){return at}});var d=j(988);const nt=new WeakMap;class at extends d.aNw{constructor(bt){super(bt),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(bt){return this.decoderPath=bt,this}setDecoderConfig(bt){return this.decoderConfig=bt,this}setWorkerLimit(bt){return this.workerLimit=bt,this}load(bt,kt,Vt,qt){const zt=new d.hH6(this.manager);zt.setPath(this.path),zt.setResponseType("arraybuffer"),zt.setRequestHeader(this.requestHeader),zt.setWithCredentials(this.withCredentials),zt.load(bt,jt=>{this.decodeDracoFile(jt,kt).catch(qt)},Vt,qt)}decodeDracoFile(bt,kt,Vt,qt){const zt={attributeIDs:Vt||this.defaultAttributeIDs,attributeTypes:qt||this.defaultAttributeTypes,useUniqueIDs:!!Vt};return this.decodeGeometry(bt,zt).then(kt)}decodeGeometry(bt,kt){const Vt=JSON.stringify(kt);if(nt.has(bt)){const Ft=nt.get(bt);if(Ft.key===Vt)return Ft.promise;if(bt.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let qt;const zt=this.workerNextTaskID++,jt=bt.byteLength,Kt=this._getWorker(zt,jt).then(Ft=>(qt=Ft,new Promise((nn,Lt)=>{qt._callbacks[zt]={resolve:nn,reject:Lt},qt.postMessage({type:"decode",id:zt,taskConfig:kt,buffer:bt},[bt])}))).then(Ft=>this._createGeometry(Ft.geometry));return Kt.catch(()=>!0).then(()=>{qt&&zt&&this._releaseTask(qt,zt)}),nt.set(bt,{key:Vt,promise:Kt}),Kt}_createGeometry(bt){const kt=new d.u9r;bt.index&&kt.setIndex(new d.TlE(bt.index.array,1));for(let Vt=0;Vt<bt.attributes.length;Vt++){const qt=bt.attributes[Vt],zt=qt.name,jt=qt.array,Kt=qt.itemSize;kt.setAttribute(zt,new d.TlE(jt,Kt))}return kt}_loadLibrary(bt,kt){const Vt=new d.hH6(this.manager);return Vt.setPath(this.decoderPath),Vt.setResponseType(kt),Vt.setWithCredentials(this.withCredentials),new Promise((qt,zt)=>{Vt.load(bt,qt,void 0,zt)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const bt=typeof WebAssembly!="object"||this.decoderConfig.type==="js",kt=[];return bt?kt.push(this._loadLibrary("draco_decoder.js","text")):(kt.push(this._loadLibrary("draco_wasm_wrapper.js","text")),kt.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(kt).then(Vt=>{const qt=Vt[0];bt||(this.decoderConfig.wasmBinary=Vt[1]);const zt=ht.toString(),jt=["/* draco decoder */",qt,"","/* worker */",zt.substring(zt.indexOf("{")+1,zt.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([jt]))}),this.decoderPending}_getWorker(bt,kt){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const qt=new Worker(this.workerSourceURL);qt._callbacks={},qt._taskCosts={},qt._taskLoad=0,qt.postMessage({type:"init",decoderConfig:this.decoderConfig}),qt.onmessage=function(zt){const jt=zt.data;switch(jt.type){case"decode":qt._callbacks[jt.id].resolve(jt);break;case"error":qt._callbacks[jt.id].reject(jt);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+jt.type+'"')}},this.workerPool.push(qt)}else this.workerPool.sort(function(qt,zt){return qt._taskLoad>zt._taskLoad?-1:1});const Vt=this.workerPool[this.workerPool.length-1];return Vt._taskCosts[bt]=kt,Vt._taskLoad+=kt,Vt})}_releaseTask(bt,kt){bt._taskLoad-=bt._taskCosts[kt],delete bt._callbacks[kt],delete bt._taskCosts[kt]}debug(){console.log("Task load: ",this.workerPool.map(bt=>bt._taskLoad))}dispose(){for(let bt=0;bt<this.workerPool.length;++bt)this.workerPool[bt].terminate();return this.workerPool.length=0,this}}function ht(){let _t,bt;function kt(Vt,qt,zt,jt,Kt,Ft){const nn=Ft.num_components(),Lt=zt.num_points()*nn,Nt=Lt*Kt.BYTES_PER_ELEMENT,Ht=function(cn,Ut){switch(Ut){case Float32Array:return cn.DT_FLOAT32;case Int8Array:return cn.DT_INT8;case Int16Array:return cn.DT_INT16;case Int32Array:return cn.DT_INT32;case Uint8Array:return cn.DT_UINT8;case Uint16Array:return cn.DT_UINT16;case Uint32Array:return cn.DT_UINT32}}(Vt,Kt),on=Vt._malloc(Nt);qt.GetAttributeDataArrayForAllPoints(zt,Ft,Ht,Nt,on);const en=new Kt(Vt.HEAPF32.buffer,on,Lt).slice();return Vt._free(on),{name:jt,array:en,itemSize:nn}}onmessage=function(Vt){const qt=Vt.data;switch(qt.type){case"init":_t=qt.decoderConfig,bt=new Promise(function(Kt){_t.onModuleLoaded=function(Ft){Kt({draco:Ft})},DracoDecoderModule(_t)});break;case"decode":const zt=qt.buffer,jt=qt.taskConfig;bt.then(Kt=>{const Ft=Kt.draco,nn=new Ft.Decoder,Lt=new Ft.DecoderBuffer;Lt.Init(new Int8Array(zt),zt.byteLength);try{const Nt=function(on,en,cn,Ut){const Gt=Ut.attributeIDs,$t=Ut.attributeTypes;let un,hn;const Bn=en.GetEncodedGeometryType(cn);if(Bn===on.TRIANGULAR_MESH)un=new on.Mesh,hn=en.DecodeBufferToMesh(cn,un);else{if(Bn!==on.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");un=new on.PointCloud,hn=en.DecodeBufferToPointCloud(cn,un)}if(!hn.ok()||un.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+hn.error_msg());const ar={index:null,attributes:[]};for(const sr in Gt){const ur=self[$t[sr]];let nr,hr;if(Ut.useUniqueIDs)hr=Gt[sr],nr=en.GetAttributeByUniqueId(un,hr);else{if(hr=en.GetAttributeId(un,on[Gt[sr]]),hr===-1)continue;nr=en.GetAttribute(un,hr)}ar.attributes.push(kt(on,en,un,sr,ur,nr))}return Bn===on.TRIANGULAR_MESH&&(ar.index=function(sr,ur,nr){const hr=3*nr.num_faces(),zn=4*hr,Yn=sr._malloc(zn);ur.GetTrianglesUInt32Array(nr,zn,Yn);const sn=new Uint32Array(sr.HEAPF32.buffer,Yn,hr).slice();return sr._free(Yn),{array:sn,itemSize:1}}(on,en,un)),on.destroy(un),ar}(Ft,nn,Lt,jt),Ht=Nt.attributes.map(on=>on.array.buffer);Nt.index&&Ht.push(Nt.index.array.buffer),self.postMessage({type:"decode",id:qt.id,geometry:Nt},Ht)}catch(Nt){console.error(Nt),self.postMessage({type:"error",id:qt.id,error:Nt.message})}finally{Ft.destroy(Lt),Ft.destroy(nn)}})}}}}},__webpackgi_module_cache__={};function __webpackgi_require__(b){var g=__webpackgi_module_cache__[b];if(g!==void 0)return g.exports;var j=__webpackgi_module_cache__[b]={id:b,exports:{}};return __webpackgi_modules__[b].call(j.exports,j,j.exports,__webpackgi_require__),j.exports}__webpackgi_require__.n=function(b){var g=b&&b.__esModule?function(){return b.default}:function(){return b};return __webpackgi_require__.d(g,{a:g}),g},__webpackgi_require__.d=function(b,g){for(var j in g)__webpackgi_require__.o(g,j)&&!__webpackgi_require__.o(b,j)&&Object.defineProperty(b,j,{enumerable:!0,get:g[j]})},__webpackgi_require__.o=function(b,g){return Object.prototype.hasOwnProperty.call(b,g)},__webpackgi_require__.r=function(b){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(b,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(b,"__esModule",{value:!0})},__webpackgi_require__.nc=void 0;var __webpackgi_exports__={};(function(){__webpackgi_require__.d(__webpackgi_exports__,{LY2:function(){return d.LY2},HRj:function(){return zm},li4:function(){return VB},FO5:function(){return QB},Nlh:function(){return jB},QvI:function(){return Js},JHp:function(){return zS},bGH:function(){return d.bGH},NDo:function(){return d.NDo},gSk:function(){return d.gSk},WMw:function(){return d.WMw},OTo:function(){return d.OTo},Se2:function(){return d.Se2},cum:function(){return d.cum},Mig:function(){return d.Mig},B$7:function(){return I1},i_9:function(){return d.i_9},m7l:function(){return d.m7l},sYA:function(){return d.sYA},Xcj:function(){return d.Xcj},mzJ:function(){return d.mzJ},ZZA:function(){return d.ZZA},$Ph:function(){return mm},T__:function(){return d.T__},HkE:function(){return d.HkE},tGC:function(){return d.tGC},g1S:function(){return iy},I$C:function(){return ZC},QIH:function(){return uo},_JE:function(){return o0},ksm:function(){return Kr},jl_:function(){return Cm},b7R:function(){return Sp},BDV:function(){return ys},Ea_:function(){return Ry},qff:function(){return Cm},tmC:function(){return iu},BON:function(){return lP},P40:function(){return ju},wLL:function(){return um},iHO:function(){return b1},BbS:function(){return d.BbS},kqm:function(){return d.kqm},Hmr:function(){return d.Hmr},SJI:function(){return d.SJI},mTL:function(){return d.mTL},y8_:function(){return d.y8_},_Li:function(){return d._Li},g56:function(){return Mp},bj3:function(){return ws},z81:function(){return d.z81},_MY:function(){return d._MY},yEv:function(){return SP},dFZ:function(){return X0},N$j:function(){return d.N$j},_YM:function(){return d._YM},TUj:function(){return d.TUj},ZzF:function(){return d.ZzF},qzb:function(){return sr},GQ:function(){return d.GQ},nvb:function(){return d.nvb},DvJ:function(){return d.DvJ},fQA:function(){return d.fQA},cPz:function(){return $S},TlE:function(){return d.TlE},u9r:function(){return d.u9r},s4_:function(){return d.s4_},T95:function(){return d.T95},F5w:function(){return y2},NlP:function(){return F2},$8Z:function(){return oA},YYN:function(){return iA},CtF:function(){return d.CtF},V1s:function(){return d.V1s},jOv:function(){return wp},Rki:function(){return d.Rki},pzV:function(){return q2},itZ:function(){return Fp},qKx:function(){return lu},vlJ:function(){return oM},nPO:function(){return cy},zcQ:function(){return EC},GH1:function(){return gm},ROQ:function(){return d.ROQ},YN5:function(){return d.YN5},BVQ:function(){return d.BVQ},YT8:function(){return d.YT8},_DE:function(){return DE},YGz:function(){return d.YGz},trn:function(){return d.trn},zf8:function(){return d.zf8},uWy:function(){return d.uWy},wYQ:function(){return $m},SUY:function(){return d.SUY},Ilk:function(){return d.Ilk},R2R:function(){return d.R2R},epp:function(){return d.epp},xmJ:function(){return Tp},GD$:function(){return Lp},EB7:function(){return d.EB7},DqL:function(){return d.DqL},_3:function(){return d._3},b_z:function(){return d.b_z},OCn:function(){return uy},_am:function(){return d._am},kB7:function(){return qM},fY$:function(){return d.fY$},vxC:function(){return d.vxC},BtG:function(){return d.BtG},cBK:function(){return d.cBK},g8_:function(){return d.g8_},AXT:function(){return d.AXT},yj7:function(){return d.yj7},dYG:function(){return d.dYG},tm_:function(){return d.tm_},S2y:function(){return d.S2y},B02:function(){return d.B02},PeU:function(){return d.PeU},Hyl:function(){return d.Hyl},Wqd:function(){return d.Wqd},Xaj:function(){return d.Xaj},DUb:function(){return np},dZ3:function(){return d.dZ3},m_w:function(){return d.m_w},fHI:function(){return d.fHI},LBq:function(){return d.LBq},dHf:function(){return UB},Qww:function(){return F_.Q},CGV:function(){return ZE},JUT:function(){return d.JUT},p3g:function(){return d.p3g},IEO:function(){return d.IEO},CN8:function(){return d.CN8},zob:function(){return d.zob},yxD:function(){return d.yxD},CUS:function(){return $a},A5E:function(){return d.A5E},zqG:function(){return Tv},PfX:function(){return BM},Q1o:function(){return N0},jfJ:function(){return d.jfJ},T_J:function(){return d.T_J},tEQ:function(){return d.tEQ},gb4:function(){return Dr},qkB:function(){return d.qkB},cvk:function(){return $0},HWo:function(){return t0},brP:function(){return d.brP},$YQ:function(){return d.$YQ},X8d:function(){return CM},Zdt:function(){return KD},yNB:function(){return Ml},h7x:function(){return Xl},Ox3:function(){return d.Ox3},qtn:function(){return n_},cBI:function(){return d.cBI},cU9:function(){return d.cU9},DT1:function(){return d.DT1},Kgo:function(){return d.Kgo},ehD:function(){return d.ehD},fhJ:function(){return Vw},y1s:function(){return Qw},fSK:function(){return d.fSK},Vdb:function(){return d.Vdb},l8J:function(){return d.l8J},dj0:function(){return d.dj0},QM0:function(){return d.QM0},OIS:function(){return zp},q8b:function(){return Qy},TOt:function(){return d.TOt},xaN:function(){return jt},Ny0:function(){return d.Ny0},NeD:function(){return MD},Zof:function(){return DS},eD:function(){return d.eD},jwo:function(){return d.jwo},dSO:function(){return d.dSO},Bf4:function(){return d.Bf4},USm:function(){return d.USm},pBf:function(){return d.pBf},$Vf:function(){return d.$Vf},O7d:function(){return d.O7d},ksq:function(){return ho},gXf:function(){return _C},hH6:function(){return d.hH6},kpi:function(){return kE},DwZ:function(){return _p},kN3:function(){return ZD},e62:function(){return d.e62},a$l:function(){return d.a$l},OM3:function(){return d.OM3},VzW:function(){return d.VzW},ybr:function(){return d.ybr},yo9:function(){return d.yo9},$Bt:function(){return X_},Wzm:function(){return d.Wzm},Wl3:function(){return d.Wl3},iWj:function(){return d.iWj},DNz:function(){return su},m1M:function(){return ba},ylh:function(){return d.ylh},v9Y:function(){return d.v9Y},LSk:function(){return d.LSk},LHE:function(){return Rl},KE0:function(){return XP},KCF:function(){return kB},a4n:function(){return MP},zIH:function(){return w1},Hfk:function(){return vv},png:function(){return xm},tAj:function(){return Yv},Eb_:function(){return bm},BT2:function(){return YC},_8p:function(){return yR},V5Z:function(){return Z0},s5b:function(){return ME},hkn:function(){return vA},GFY:function(){return wv},w$m:function(){return d.w$m},ksN:function(){return d.ksN},j4z:function(){return d.j4z},OAl:function(){return d.OAl},VLJ:function(){return d.VLJ},C73:function(){return pm},ZAu:function(){return d.ZAu},ibP:function(){return L0},_fI:function(){return Lp},hUN:function(){return vm},cLu:function(){return d.cLu},vmT:function(){return d.vmT},Qpg:function(){return d.Qpg},So8:function(){return d.So8},eOv:function(){return Q2},Wjw:function(){return d.Wjw},cJO:function(){return d.cJO},QRU:function(){return d.QRU},S3k:function(){return d.S3k},PpQ:function(){return d.PpQ},AHu:function(){return d.AHu},q_9:function(){return zl},ZRs:function(){return d.ZRs},oqc:function(){return d.oqc},T_x:function(){return Cl},lb7:function(){return d.lb7},L5s:function(){return d.L5s},$TI:function(){return d.$TI},SPe:function(){return d.SPe},aVm:function(){return d.aVm},j87:function(){return d.j87},RNb:function(){return d.RNb},Kz5:function(){return d.Kz5},vpT:function(){return d.vpT},kB5:function(){return d.kB5},_C8:function(){return d._C8},Syv:function(){return d.Syv},NMF:function(){return d.NMF},pIN:function(){return d.pIN},eMJ:function(){return d.eMJ},rN7:function(){return Tx},iUp:function(){return DC},GFd:function(){return HE},x5V:function(){return d.x5V},tUh:function(){return d.tUh},z8B:function(){return d.z8B},vcl:function(){return TE},GZb:function(){return d.GZb},p7y:function(){return d.p7y},S9g:function(){return d.S9g},Zr5:function(){return d.Zr5},vCF:function(){return d.vCF},yt0:function(){return d.yt0},uXU:function(){return d.uXU},_kC:function(){return d._kC},lk7:function(){return d.lk7},USc:function(){return G2},x12:function(){return d.x12},Zzh:function(){return d.Zzh},nls:function(){return d.nls},g_z:function(){return d.g_z},U7:function(){return d.U7},FT0:function(){return d.FT0},blk:function(){return d.blk},ejS:function(){return d.ejS},rnI:function(){return d.rnI},wem:function(){return d.wem},lfu:function(){return d.lfu},FDw:function(){return d.FDw},lRj:function(){return d.lRj},D1R:function(){return d.D1R},qyh:function(){return d.qyh},GUF:function(){return d.GUF},EoG:function(){return d.EoG},aNw:function(){return d.aNw},Zp0:function(){return d.Zp0},lLk:function(){return d.lLk},jAl:function(){return d.jAl},uEv:function(){return d.uEv},YKA:function(){return d.YKA},cRx:function(){return d.cRx},Y8D:function(){return d.Y8D},RsA:function(){return d.RsA},Y0m:function(){return Gx},F5T:function(){return d.F5T},EDU:function(){return s2},z$Q:function(){return a1},KA8:function(){return ku},XUj:function(){return g2},Me$:function(){return yw},u7G:function(){return d.u7G},PEk:function(){return I_},BG4:function(){return nD},M8C:function(){return d.M8C},Vkp:function(){return d.Vkp},yGw:function(){return d.yGw},Sm8:function(){return d.Sm8},Kj0:function(){return d.Kj0},vBJ:function(){return d.vBJ},QfV:function(){return $p},lRF:function(){return d.lRF},Lun:function(){return d.Lun},YBo:function(){return d.YBo},kaV:function(){return d.kaV},RSm:function(){return d.RSm},xoR:function(){return d.xoR},EJi:function(){return d.EJi},Wid:function(){return d.Wid},iuj:function(){return $u},IKL:function(){return d.IKL},r_:function(){return d.r_},OoA:function(){return d.OoA},qhX:function(){return d.qhX},qPT:function(){return Gw},M5h:function(){return d.M5h},Ns1:function(){return d.Ns1},TyD:function(){return d.TyD},vZf:function(){return d.vZf},HTd:function(){return d.HTd},aH4:function(){return d.aH4},YLQ:function(){return d.YLQ},BVF:function(){return d.BVF},MyG:function(){return d.MyG},jFi:function(){return d.jFi},aCh:function(){return d.aCh},uL9:function(){return d.uL9},TNj:function(){return pp},IFH:function(){return d.IFH},bdR:function(){return d.bdR},kM_:function(){return YM},M6v:function(){return d.M6v},RvT:function(){return d.RvT},dUE:function(){return d.dUE},oe_:function(){return vI},BuN:function(){return $C},Tme:function(){return d.Tme},N9P:function(){return dv},Gql:function(){return d.Gql},$XY:function(){return SA},O9d:function(){return JM},zEO:function(){return E0},qfx:function(){return fy},PA7:function(){return d.PA7},REq:function(){return d.REq},pQR:function(){return d.pQR},ghN:function(){return d.ghN},Hy8:function(){return d.Hy8},Wpd:function(){return d.Wpd},LgZ:function(){return d.LgZ},iWC:function(){return d.iWC},mqn:function(){return EF},SKe:function(){return No},iKG:function(){return d.iKG},_iA:function(){return d._iA},ntZ:function(){return d.ntZ},anP:function(){return d.anP},X2e:function(){return OB},FCo:function(){return g0},y$t:function(){return d.y$t},cPb:function(){return d.cPb},lmx:function(){return Uo},JOQ:function(){return d.JOQ},BKK:function(){return d.BKK},_12:function(){return d._12},tJx:function(){return d.tJx},cek:function(){return d.cek},qD0:function(){return kS},xG9:function(){return d.xG9},wI8:function(){return cA},Sgv:function(){return eR},woe:function(){return d.woe},UY4:function(){return d.UY4},aq0:function(){return d.aq0},ujx:function(){return d.ujx},Uol:function(){return d.Uol},JiH:function(){return fM},VYz:function(){return d.VYz},_Pm:function(){return i0},EsW:function(){return dp},iUV:function(){return d.iUV},tf:function(){return d.tf},ZQ6:function(){return d.ZQ6},mXe:function(){return d.mXe},_fP:function(){return d._fP},iLg:function(){return d.iLg},zbs:function(){return d.zbs},UZH:function(){return d.UZH},mSO:function(){return d.mSO},wk1:function(){return d.wk1},E2K:function(){return d.E2K},FUD:function(){return d.FUD},pKu:function(){return d.pKu},GG6:function(){return d.GG6},Gih:function(){return d.Gih},iiP:function(){return d.iiP},SvJ:function(){return d.SvJ},ptH:function(){return d.ptH},jZA:function(){return d.jZA},y2t:function(){return d.y2t},gi4:function(){return d.gi4},Djp:function(){return d.Djp},BG$:function(){return d.BG$},NYV:function(){return d.NYV},xJs:function(){return d.xJs},bsb:function(){return d.bsb},ekQ:function(){return d.ekQ},CaW:function(){return d.CaW},eaV:function(){return d.eaV},BFQ:function(){return d.BFQ},v3W:function(){return d.v3W},ILR:function(){return d.ILR},UCm:function(){return d.UCm},Inb:function(){return d.Inb},U1$:function(){return zn},LgE:function(){return d.LgE},fto:function(){return d.fto},l0P:function(){return d.l0P},vCx:function(){return d.vCx},_AM:function(){return d._AM},wuA:function(){return d.wuA},av9:function(){return d.av9},CtA:function(){return d.CtA},BvQ:function(){return px},FZJ:function(){return J_},FIo:function(){return d.FIo},zHn:function(){return d.zHn},iMs:function(){return d.iMs},T_f:function(){return d.T_f},hEm:function(){return d.hEm},D9w:function(){return d.D9w},sHH:function(){return Hy},CdI:function(){return d.CdI},rkc:function(){return uA},rpg:function(){return d.rpg},ce8:function(){return d.ce8},rOj:function(){return d.rOj},P6m:function(){return d_},JA6:function(){return VE},V4E:function(){return d.V4E},o8S:function(){return d.o8S},flB:function(){return x_},DUH:function(){return sN},KI_:function(){return d.KI_},iLN:function(){return N1},jsw:function(){return Cu},srG:function(){return v2},i6Z:function(){return O1},vfv:function(){return XC},xsS:function(){return d.xsS},or:function(){return H2},EQj:function(){return _m},ov0:function(){return KS},WdD:function(){return d.WdD},Vj0:function(){return d.Vj0},jyz:function(){return d.jyz},mTM:function(){return M_},Mn1:function(){return Bu},Hlq:function(){return bu},Fi7:function(){return Iv},Tn7:function(){return d.Tn7},bnF:function(){return d.bnF},HW6:function(){return d.HW6},oa8:function(){return d.oa8},T_1:function(){return d.T_1},zHJ:function(){return Uv},iDF:function(){return d.iDF},iAb:function(){return d.iAb},d4E:function(){return KT},lBg:function(){return z2},JeJ:function(){return AP},FKY:function(){return j},zlZ:function(){return _I},vkg:function(){return AA},brh:function(){return p_},kZK:function(){return jv},puG:function(){return V2},OdW:function(){return d.OdW},_YX:function(){return d._YX},TUv:function(){return d.TUv},Hw6:function(){return d.Hw6},aLr:function(){return d.aLr},Aip:function(){return d.Aip},xo$:function(){return d.xo$},bIn:function(){return SF},$V:function(){return d.$V},lDi:function(){return d.lDi},gti:function(){return d.gti},PMe:function(){return d.PMe},iwP:function(){return Ny},FvO:function(){return d.FvO},jyi:function(){return d.jyi},xeV:function(){return d.xeV},k74:function(){return d.k74},RlZ:function(){return d.RlZ},KhW:function(){return d.KhW},HgB:function(){return d.HgB},W2J:function(){return d.W2J},JWc:function(){return d.JWc},u37:function(){return d.u37},Z6B:function(){return d.Z6B},QZ1:function(){return d.QZ1},Ir4:function(){return d.Ir4},NwF:function(){return d.NwF},Wbm:function(){return d.Wbm},N4l:function(){return d.N4l},ej9:function(){return Aw},QmN:function(){return d.QmN},IOt:function(){return d.IOt},NOD:function(){return wx},L5g:function(){return d.L5g},H$k:function(){return d.H$k},cuP:function(){return vp},xEZ:function(){return d.xEZ},dpR:function(){return d.dpR},wOD:function(){return Im},KNb:function(){return UM},IiN:function(){return Rx},Cne:function(){return d.Cne},XvJ:function(){return d.XvJ},XZw:function(){return d.XZw},FE5:function(){return d.FE5},lVp:function(){return vC},CJI:function(){return d.CJI},z$h:function(){return d.z$h},UlW:function(){return d.UlW},WwZ:function(){return d.WwZ},Lcc:function(){return d.Lcc},WXh:function(){return d.WXh},Vjr:function(){return SD},LuM:function(){return oR},LP5:function(){return BO},xfE:function(){return d.xfE},qlB:function(){return d.qlB},lCJ:function(){return d.lCJ},WTc:function(){return d.WTc},rAo:function(){return d.rAo},LZj:function(){return YT},xWb:function(){return d.xWb},gH0:function(){return d.gH0},rBU:function(){return d.rBU},rDY:function(){return d.rDY},ywz:function(){return d.ywz},wJv:function(){return d.wJv},JQ4:function(){return d.JQ4},k0A:function(){return d.k0A},irR:function(){return d.irR},LsT:function(){return d.LsT},q5h:function(){return S1},TKh:function(){return aP},tyg:function(){return LM},Ro5:function(){return Oy},dwk:function(){return d.dwk},FM8:function(){return d.FM8},Pa4:function(){return d.Pa4},Ltg:function(){return d.Ltg},yC1:function(){return d.yC1},lHq:function(){return Ax},fO1:function(){return d.fO1},oMA:function(){return Ym},JzW:function(){return b},QEt:function(){return IE},b5g:function(){return d.b5g},Ywn:function(){return d.Ywn},GVz:function(){return d.GVz},oAp:function(){return d.oAp},kFz:function(){return d.kFz},p7A:function(){return d.p7A},dd2:function(){return d.dd2},CP7:function(){return d.CP7},fQK:function(){return d.fQK},Wd$:function(){return XT},t1_:function(){return hR},Uk6:function(){return d.Uk6},_sL:function(){return d._sL},Pnf:function(){return d.Pnf},c8b:function(){return d.c8b},_lf:function(){return d._lf},ad5:function(){return d.ad5},sZV:function(){return sP},TfA:function(){return Zr},sKX:function(){return M1},UdM:function(){return ao},P0y:function(){return OA},L_r:function(){return d.L_r},Bve:function(){return BE},UeO:function(){return Kv},$nx:function(){return TP},Bk6:function(){return Lu},y4l:function(){return y1},pQ0:function(){return T1},wXW:function(){return r3},r5x:function(){return e3},MSI:function(){return o3},EUu:function(){return MF},jtH:function(){return XA},T0T:function(){return mC},gAb:function(){return J2},iwT:function(){return xx},je_:function(){return NO},wBP:function(){return lx},LU2:function(){return tC},wQL:function(){return TF},Zs7:function(){return h2},x7s:function(){return A3},Mnd:function(){return PF},A0_:function(){return DF},d73:function(){return l2},HCD:function(){return ls},RG9:function(){return Rs},G2P:function(){return H_},XLf:function(){return H1},CGN:function(){return gT},mvg:function(){return iS},Hiy:function(){return Dw},XMc:function(){return t3},N7M:function(){return JB},iv:function(){return i3},n55:function(){return _u},IaC:function(){return Lv},h9t:function(){return vT},yDW:function(){return _T},gJv:function(){return Jw},l$g:function(){return W3},vQi:function(){return IO},$MY:function(){return VM},wJl:function(){return FS},Z7Y:function(){return ZS},X7D:function(){return eC},BnX:function(){return G1},uZ5:function(){return Q0},zVI:function(){return KB},DpF:function(){return tw},nNb:function(){return z_},cqZ:function(){return t_},pKN:function(){return ZI},d_$:function(){return KM},DdI:function(){return KP},rrX:function(){return e2},KlC:function(){return XM},KVn:function(){return hr},oau:function(){return mD},aw9:function(){return Jl},Aap:function(){return Ko},Dxg:function(){return on},MjT:function(){return Pu},F7Q:function(){return fT},IFq:function(){return gR},IJl:function(){return Q1},O5A:function(){return b_},wCn:function(){return El},gGT:function(){return pT},pEc:function(){return FB},Bi6:function(){return gA},fi_:function(){return E3},TT:function(){return hN},q2Z:function(){return yF},NyK:function(){return io},bgu:function(){return v1},kcS:function(){return Gv},rRN:function(){return DD},ivY:function(){return Gt},_s1:function(){return FF},_HO:function(){return Cr},tpL:function(){return Ar},DMK:function(){return tE},LjN:function(){return kM},iFs:function(){return Av},qTg:function(){return Lt},Wtl:function(){return Ts},DmK:function(){return ps},Htt:function(){return zO},Hx7:function(){return os},imt:function(){return Ds},US6:function(){return lS},vZs:function(){return $M},TE$:function(){return RF},lmu:function(){return Du},SvO:function(){return Xp},YQY:function(){return VA},mZN:function(){return JS},VvG:function(){return mT},omp:function(){return G3},utz:function(){return sS},TFV:function(){return xv},hrz:function(){return en},JKM:function(){return dD},jZf:function(){return fR},RjL:function(){return tR},RRI:function(){return _3},RUq:function(){return H3},_t4:function(){return Ap},YHh:function(){return Yp},R8g:function(){return Yn},Bbl:function(){return yA},V9r:function(){return Nt},PZ2:function(){return Ht},w7A:function(){return Kt},N6S:function(){return Kn},Uxp:function(){return wr},tAz:function(){return qn},R$F:function(){return rn},N33:function(){return Gn},gw2:function(){return P1},KlU:function(){return sn},wo6:function(){return C_},H4P:function(){return Ut},swA:function(){return ky},_Z3:function(){return By},ivc:function(){return z_},rZ1:function(){return t_},CpZ:function(){return b3},dyc:function(){return $t},MxZ:function(){return xN},btp:function(){return bN},mXy:function(){return TD},Ej0:function(){return to},ep4:function(){return Gs},DQP:function(){return xa},VNr:function(){return Xu},V7q:function(){return S_},zEk:function(){return Ru},qfq:function(){return Am},piB:function(){return Bn},IIc:function(){return CF},rrF:function(){return cm},naq:function(){return _d},sXR:function(){return eE},p5I:function(){return fC},wps:function(){return Z2},wuo:function(){return vR},GpE:function(){return Ft},F4b:function(){return qA},t$v:function(){return Nm},tdn:function(){return gE},Y9t:function(){return SC},GEo:function(){return $w},DH3:function(){return n3},uxM:function(){return HB},zH3:function(){return WB},MLs:function(){return UA},xXG:function(){return To},YM4:function(){return ax},B3r:function(){return mR},iAx:function(){return aM},lDn:function(){return kn},oaQ:function(){return V1},CD7:function(){return W_},Rc0:function(){return $1},iPG:function(){return s_},TIc:function(){return Tw},xsC:function(){return a3},zOc:function(){return mo},r46:function(){return d3},z2C:function(){return hn},_X$:function(){return _A},_yn:function(){return wo},Dyg:function(){return w0},cUc:function(){return Pw},zGw:function(){return Z1},Ctq:function(){return hD},$ch:function(){return kF},k5b:function(){return oS},kZl:function(){return c2},OCg:function(){return fD},YjH:function(){return y3},Ui8:function(){return AR},YD2:function(){return G0},vi9:function(){return jO},ij3:function(){return ZB},YPW:function(){return $B},Bg1:function(){return xF},kon:function(){return cn},M3g:function(){return Kw},F2z:function(){return Nv},pJF:function(){return Q3},knz:function(){return d.knz},Ejo:function(){return nn},BgY:function(){return ss},qCG:function(){return jn},HD9:function(){return Wr},fEB:function(){return Pl},Udc:function(){return Vo},ZQg:function(){return eo},ofC:function(){return Lr},yRy:function(){return ap},_NL:function(){return OE},LCA:function(){return vs},j1w:function(){return P_},i8J:function(){return jF},p7C:function(){return Ul},ZAS:function(){return Dv},ipH:function(){return BF},$TF:function(){return QO},uZI:function(){return OF},VWG:function(){return tD},pQ7:function(){return Yy},STw:function(){return r_},jc8:function(){return Iw},BL_:function(){return s1},S6:function(){return UF},T8U:function(){return RS},TD6:function(){return U0},akS:function(){return rD},QKE:function(){return qB},dKx:function(){return un},OvX:function(){return FO},VsW:function(){return au},YMc:function(){return VO},aPg:function(){return us},LFn:function(){return x0},wey:function(){return Lm},MaE:function(){return Ao},s4x:function(){return op},FJA:function(){return Io},vIA:function(){return vu},Spv:function(){return Ws},w8l:function(){return Ku},riG:function(){return so},Kbh:function(){return qp},t8K:function(){return Xr},Q7n:function(){return Jr},KGF:function(){return Qo},e5:function(){return dn},Rik:function(){return NM},GZo:function(){return C1},Bds:function(){return Uw},HTu:function(){return qm},cTq:function(){return E_},X_Y:function(){return US},dA8:function(){return NS},bwS:function(){return uD},Lks:function(){return LF},Rvq:function(){return UO},P4F:function(){return aN},Pd0:function(){return _f},Pjo:function(){return cD},Tum:function(){return An},dRH:function(){return em},RX0:function(){return mv},reQ:function(){return NF},cWm:function(){return s3},NC9:function(){return GB},$Re:function(){return oP},Xo9:function(){return OM},LNO:function(){return E1},iZP:function(){return Fw}});var b,g={};__webpackgi_require__.r(g),__webpackgi_require__.d(g,{AsyncCompress:function(){return gn},AsyncDecompress:function(){return Qr},AsyncDeflate:function(){return Pt},AsyncGunzip:function(){return $n},AsyncGzip:function(){return gn},AsyncInflate:function(){return Xt},AsyncUnzipInflate:function(){return ga},AsyncUnzlib:function(){return pr},AsyncZipDeflate:function(){return Ps},AsyncZlib:function(){return Or},Compress:function(){return fn},DecodeUTF8:function(){return Xn},Decompress:function(){return Sr},Deflate:function(){return Ct},EncodeUTF8:function(){return Dn},Gunzip:function(){return Ln},Gzip:function(){return fn},Inflate:function(){return Yt},Unzip:function(){return jE},UnzipInflate:function(){return na},UnzipPassThrough:function(){return Zs},Unzlib:function(){return Hr},Zip:function(){return Ns},ZipDeflate:function(){return ro},ZipPassThrough:function(){return Os},Zlib:function(){return Er},compress:function(){return _n},compressSync:function(){return On},decompress:function(){return As},decompressSync:function(){return go},deflate:function(){return Ot},deflateSync:function(){return Dt},gunzip:function(){return Jn},gunzipSync:function(){return Un},gzip:function(){return _n},gzipSync:function(){return On},inflate:function(){return Jt},inflateSync:function(){return an},strFromU8:function(){return mr},strToU8:function(){return Hn},unzip:function(){return ns},unzipSync:function(){return uI},unzlib:function(){return vr},unzlibSync:function(){return jr},zip:function(){return Yo},zipSync:function(){return Rm},zlib:function(){return xr},zlibSync:function(){return Gr}}),function(c){c[c.Error=-2]="Error",c[c.Destroyed=-1]="Destroyed",c[c.None=0]="None",c[c.Running=1]="Running",c[c.Paused=2]="Paused"}(b||(b={}));class j{constructor(){this._eventListeners={},this.dispatchEvent=this.dispatchEvent.bind(this),this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.hasEventListener=this.hasEventListener.bind(this)}addEventListener(e,i){const s=this._eventListeners;s[e]===void 0&&(s[e]=[]),s[e].includes(i)||s[e].push(i)}hasEventListener(e,i){const s=this._eventListeners;return s[e]!==void 0&&s[e].includes(i)}removeEventListener(e,i){const s=this._eventListeners[e];if(s!==void 0){const a=s.indexOf(i);a!==-1&&s.splice(a,1)}}dispatchEvent(e){const i=this._eventListeners[e.type];if(i!==void 0){e.target=this;const s=i.slice(0);for(let a=0,h=s.length;a<h;a++)s[a].call(this,e)}}}var d=__webpackgi_require__(988);const nt={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.a *= opacity;


		}`};class at{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const ht=new d.iKG(-1,1,1,-1,0,1),_t=new d.u9r;_t.setAttribute("position",new d.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),_t.setAttribute("uv",new d.a$l([0,2,0,0,2,0],2));class bt{constructor(e){this._mesh=new d.Kj0(_t,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,ht)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class kt extends at{constructor(e,i){super(),this.textureID=i!==void 0?i:"tDiffuse",e instanceof d.jyz?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=d.rDY.clone(e.uniforms),this.material=new d.jyz({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new bt(this.material),this.useExistingRenderTarget=!1}render(e,i,s){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=s.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(this.useExistingRenderTarget||e.setRenderTarget(i),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}}class Vt extends at{constructor(e,i){super(),this.scene=e,this.camera=i,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,i,s){const a=e.getContext(),h=e.state;let f,k;h.buffers.color.setMask(!1),h.buffers.depth.setMask(!1),h.buffers.color.setLocked(!0),h.buffers.depth.setLocked(!0),this.inverse?(f=0,k=1):(f=1,k=0),h.buffers.stencil.setTest(!0),h.buffers.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),h.buffers.stencil.setFunc(a.ALWAYS,f,4294967295),h.buffers.stencil.setClear(k),h.buffers.stencil.setLocked(!0),e.setRenderTarget(s),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),h.buffers.color.setLocked(!1),h.buffers.depth.setLocked(!1),h.buffers.stencil.setLocked(!1),h.buffers.stencil.setFunc(a.EQUAL,1,4294967295),h.buffers.stencil.setOp(a.KEEP,a.KEEP,a.KEEP),h.buffers.stencil.setLocked(!0)}}class qt extends at{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}new d.iKG(-1,1,1,-1,0,1);const zt=new d.u9r;zt.setAttribute("position",new d.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),zt.setAttribute("uv",new d.a$l([0,2,0,0,2,0],2));class jt extends class{constructor(e,i){if(this.renderer=e,i===void 0){const s=e.getSize(new d.FM8);this._pixelRatio=e.getPixelRatio(),this._width=s.width,this._height=s.height,(i=new d.dd2(this._width*this._pixelRatio,this._height*this._pixelRatio)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=i.width,this._height=i.height;this.renderTarget1=i,this.renderTarget2=i.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],nt===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),kt===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new kt(nt),this.clock=new d.SUY}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,i){this.passes.splice(i,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const i=this.passes.indexOf(e);i!==-1&&this.passes.splice(i,1)}isLastEnabledPass(e){for(let i=e+1;i<this.passes.length;i++)if(this.passes[i].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const i=this.renderer.getRenderTarget();let s=!1;for(let a=0,h=this.passes.length;a<h;a++){const f=this.passes[a];if(f.enabled!==!1){if(f.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(a),f.render(this.renderer,this.writeBuffer,this.readBuffer,e,s),f.needsSwap){if(s){const k=this.renderer.getContext(),et=this.renderer.state.buffers.stencil;et.setFunc(k.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),et.setFunc(k.EQUAL,1,4294967295)}this.swapBuffers()}Vt!==void 0&&(f instanceof Vt?s=!0:f instanceof qt&&(s=!1))}}this.renderer.setRenderTarget(i)}reset(e){if(e===void 0){const i=this.renderer.getSize(new d.FM8);this._pixelRatio=this.renderer.getPixelRatio(),this._width=i.width,this._height=i.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,i){this._width=e,this._height=i;const s=this._width*this._pixelRatio,a=this._height*this._pixelRatio;this.renderTarget1.setSize(s,a),this.renderTarget2.setSize(s,a);for(let h=0;h<this.passes.length;h++)this.passes[h].setSize(s,a)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}{constructor(e,i){super(e,i)}setPixelRatio(e,i=!0){const s=this.setSize;i||(this.setSize=()=>{}),super.setPixelRatio(e),i||(this.setSize=s)}}function Kt(c,e){let i;do i=Object.getOwnPropertyDescriptor(c,e);while(!i&&(c=Object.getPrototypeOf(c)));return i}function Ft(c,e,i=!1,s=!1){const a=Kt(c,e);return!!(a!=null&&a.set)||i&&(a==null?void 0:a.writable)!==!1&&(a==null?void 0:a.get)===void 0||s&&!a}function nn(c,e,i,s=!1,a=!1){return!(!c||!Ft(c,e,s,a)||(c[e]=i,0))}function Lt(c,e){for(;c.length>0;){if(!e)return;const i=c.splice(0,1)[0];if(!(i.length<1)){if(!(i in e))return console.error("invalid access, check",i,e),e;e=e[i]}}return e}function Nt(c,e){return Object.keys(c).find(i=>c[i]===e)}function Ht(c,...e){return typeof c=="function"&&(c=c(...e)),c}function on(c,e,i){for(const s of i){const a=c[s];a!==void 0&&nn(e,s,a,!0)}}function en(c){return c.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}function cn(c,e,i){return c.replace(new RegExp(en(e),"g"),i)}const Ut=(c,...e)=>String.raw({raw:c},...e),Gt=(c,...e)=>String.raw({raw:c},...e),$t=(c,...e)=>String.raw({raw:c},...e),un=(c,...e)=>{let i=String.raw({raw:c},...e);return i=cn(i,"%","%25"),i=cn(i,"> <","><"),i=cn(i,"; }",";}"),i=cn(i,"<","%3c"),i=cn(i,">","%3e"),i=cn(i,'"',"'"),i=cn(i,"#","%23"),i=cn(i,"{","%7b"),i=cn(i,"}","%7d"),i=cn(i,"|","%7c"),i=cn(i,"^","%5e"),i=cn(i,"`","%60"),i=cn(i,"@","%40"),i=cn(i,"&","&amp;"),i=cn(i,`
`,"%0A"),"data:image/svg+xml;charset=UTF-8,"+i};function hn(c){if(!c)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return(e,i)=>{let s=e[i];Object.defineProperty(e,i,{get:()=>s,set(a){var h;if(s===a)return;s=a;const f=[i,a];if(typeof c=="string")(h=this[c])===null||h===void 0||h.call(this,...f);else if(typeof c=="function"){let k=!1;if(c.name){let et=this;for(;et;){if(et[c.name]===c){c.call(this,...f),k=!0;break}et=Object.getPrototypeOf(et)}}k||(c.name&&this[c.name].name===`bound ${c.name}`?this[c.name](...f):c(...f))}}})}}function Bn(c,e){for(const i of e)if(!c.includes(i))return!1;return!0}String.prototype.replaceAll||(String.prototype.replaceAll=function(c,e){return Object.prototype.toString.call(c).toLowerCase()==="[object regexp]"?this.replace(c,e):this.replace(new RegExp(c,"g"),e)});class ar{constructor(e=0,i=0){ar.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,s=this.y,a=e.elements;return this.x=a[0]*i+a[3]*s+a[6],this.y=a[1]*i+a[4]*s+a[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampLength(e,i){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(i,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,s=this.y-e.y;return i*i+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,s){return this.x=e.x+(i.x-e.x)*s,this.y=e.y+(i.y-e.y)*s,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){const s=Math.cos(i),a=Math.sin(i),h=this.x-e.x,f=this.y-e.y;return this.x=h*s-f*a+e.x,this.y=h*a+f*s+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class sr extends d.ZzF{expandByObject(e,i=!1,s=!1){var a;if(((a=e.userData)===null||a===void 0?void 0:a.bboxVisible)===!1)return this;if(!e.visible&&s)return this;e.updateWorldMatrix(!1,!1);const h=e.geometry;if(h!==void 0)if(i&&h.attributes!=null&&h.attributes.position!==void 0){const k=h.attributes.position;for(let et=0,tt=k.count;et<tt;et++)nr.fromBufferAttribute(k,et).applyMatrix4(e.matrixWorld),this.expandByPoint(nr)}else h.boundingBox===null&&h.computeBoundingBox(),ur.copy(h.boundingBox),ur.applyMatrix4(e.matrixWorld),this.union(ur);const f=e.children;for(let k=0,et=f.length;k<et;k++)this.expandByObject(f[k],i,s);return this}expandByObjects(e,i=!1,s=!1){for(let a=0,h=e.length;a<h;a++)this.expandByObject(e[a],i,s);return this}getPoints(){return[new d.Pa4(this.min.x,this.min.y,this.min.z),new d.Pa4(this.min.x,this.min.y,this.max.z),new d.Pa4(this.min.x,this.max.y,this.min.z),new d.Pa4(this.min.x,this.max.y,this.max.z),new d.Pa4(this.max.x,this.min.y,this.min.z),new d.Pa4(this.max.x,this.min.y,this.max.z),new d.Pa4(this.max.x,this.max.y,this.min.z),new d.Pa4(this.max.x,this.max.y,this.max.z)]}getScreenSpaceBounds(e){const i=this.getPoints(),s=new d.TUj;for(const a of i){const h=a.project(e);s.min.min(h),s.max.max(h)}return s}}const ur=new sr,nr=new d.Pa4;function hr(c,e){let i,s;if(Array.isArray(c))for(const h of c){const f=hr(h,e);i===void 0||s===void 0?(i=f.min.clone(),s=f.max.clone()):(i.min(f.min),s.max(f.max))}const a=c;if(a.geometry!==void 0){const h=a.geometry.vertices;if(h===void 0&&a.geometry.attributes!==void 0&&"position"in a.geometry.attributes){const f=new d.Pa4,k=a.geometry.attributes.position;for(let et=0;et<k.count*k.itemSize;et+=k.itemSize){f.set(k.array[et],k.array[et+1],k.array[3]);const tt=f.applyMatrix4(c.matrixWorld).project(e),rt=new ar(tt.x,tt.y);i===void 0||s===void 0?(i=rt.clone(),s=rt.clone()):(i.min(rt),s.max(rt))}}else for(const f of h){const k=f.clone().applyMatrix4(c.matrixWorld).project(e),et=new ar(k.x,k.y);i===void 0||s===void 0?(i=et.clone(),s=et.clone()):(i.min(et),s.max(et))}}if(c.children!==void 0)for(const h of c.children){const f=hr(h,e);i===void 0||s===void 0?(i=f.min.clone(),s=f.max.clone()):(i.min(f.min),s.max(f.max))}return new d.TUj(i,s)}const zn=3005;function Yn(c){switch(c){case d.rnI:return["Linear","( value )"];case d.knz:return["sRGB","( value )"];case zn:return["RGBM","( value, 16.0 )"];default:return console.warn("utils: Unsupported encoding:",c),["Linear","( value )"]}}function sn(c,e){let i;return c&&c.isTexture?i=c.encoding:c&&c.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),i=c.texture.encoding):i=d.rnI,e&&c&&c.isTexture&&c.format===d.wk1&&c.type===d.ywz&&c.encoding===d.knz&&(i=d.rnI),i}function qn(c,e){const i=Yn(e);return"vec4 "+c+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function Kn(c,e,i){return qn(c+"TexelToLinear",sn(e,i))+`
`}function wr(c,e){return qn(c+"TexelToLinear",e)+`
`}function Gn(c,e){const i=Yn(e);return"vec4 "+c+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function rn(c,e,i){return Gn(c,sn(e,i))}function dn({uniforms:c,propKey:e,thisTarget:i=!1}={}){const s=!!c,a=!!e,h=i;return(f,k)=>{const et=tt=>{const rt=h?tt:s?c:tt.uniforms||tt._uniforms;let lt=a?e:k;h&&(lt="_"+lt);let pt=rt[lt];return pt||(pt={value:null},rt[lt]=pt),pt};Object.defineProperty(f,k,{get(){return et(this).value},set(tt){et(this).value=tt,nn(this,"uniformsNeedUpdate",!0,!0)}})}}function kn(c,e,i=!1,s){const a=!!e,h=!!c;return(f,k)=>{const et=tt=>({t:a?e:tt.defines||tt._defines,p:h?c:k});Object.defineProperty(f,k,{get(){const{t:tt,p:rt}=et(i?this:this.material);return tt[rt]},set(tt){const{t:rt,p:lt}=et(i?this:this.material);if(nn(rt,lt,tt,!0),typeof s=="function"){const pt=[lt,tt];if(s.name){const ft=this[s.name];ft===s?s.call(this,...pt):ft.name===`bound ${s.name}`?ft(...pt):s(...pt)}else s(...pt)}else nn(i?this:this.material,"needsUpdate",!0,!0)}})}}function Cr(c){const e=new d.IEO(new Uint8Array([Math.floor(255*c.r),Math.floor(255*c.g),Math.floor(255*c.b),255]),1,1,d.wk1,d.ywz);return e.needsUpdate=!0,e.encoding=d.rnI,e}function Ar(c){const e=new d.IEO(new Uint8Array([Math.floor(255*c.x),Math.floor(255*c.y),Math.floor(255*c.z),Math.floor(255*c.w)]),1,1,d.wk1,d.ywz);return e.needsUpdate=!0,e}function Lr(c,e,i){const s=c.userData,{backgroundRender:a,transparentRender:h,shadowMapRender:f,mainRenderPass:k,opaqueRender:et,transmissionRender:tt,sceneRender:rt,screenSpaceRendering:lt}=s;e.backgroundRender!==void 0&&(s.backgroundRender=e.backgroundRender),e.transparentRender!==void 0&&(s.transparentRender=e.transparentRender),e.shadowMapRender!==void 0&&(s.shadowMapRender=e.shadowMapRender),e.mainRenderPass!==void 0&&(s.mainRenderPass=e.mainRenderPass),e.opaqueRender!==void 0&&(s.opaqueRender=e.opaqueRender),e.sceneRender!==void 0&&(s.sceneRender=e.sceneRender),e.transmissionRender!==void 0&&(s.transmissionRender=e.transmissionRender),e.screenSpaceRendering!==void 0&&(s.screenSpaceRendering=e.screenSpaceRendering),i(),s.backgroundRender=a,s.transparentRender=h,s.shadowMapRender=f,s.mainRenderPass=k,s.opaqueRender=et,s.sceneRender=rt,s.transmissionRender=tt,s.screenSpaceRendering=lt}function ls(c){const e=new sr().expandByObject(c,!0,!0).getCenter(new d.Pa4);c.position.sub(e),c.updateMatrix(),c.userData.autoCentered=!0}function Rs(c,e){const i=.5*new sr().expandByObject(c,!0,!0).getSize(new d.Pa4).length();e===void 0&&(e=c.userData.autoScaleRadius||1);const s=e/i;return isFinite(s)&&(c.userData.pseudoCentered?c.children.forEach(a=>{a.scale.multiplyScalar(s)}):c.scale.multiplyScalar(s)),c.traverse(a=>{var h,f;a.isLight&&(!((f=(h=a.shadow)===null||h===void 0?void 0:h.camera)===null||f===void 0)&&f.right)&&(a.shadow.camera.right*=s,a.shadow.camera.left*=s,a.shadow.camera.top*=s,a.shadow.camera.bottom*=s),a.isCamera&&a.right&&(a.right*=s,a.left*=s,a.top*=s,a.bottom*=s)}),c.userData.autoScaled=!0,c.userData.autoScaleRadius=e,c.dispatchEvent({type:"objectUpdate"}),c}function us(c,e=-1){return function(i,s=1e-4){const a=s>0;s=Math.max(s,Number.EPSILON);const h={},f=i.getIndex(),k=i.getAttribute("position"),et=f?f.count:k.count;let tt=0;const rt=Object.keys(i.attributes),lt={},pt={},ft=[],vt=["getX","getY","getZ","getW"];for(let Et=0,At=rt.length;Et<At;Et++){const Rt=rt[Et];lt[Rt]=[];const Bt=i.morphAttributes[Rt];Bt&&(pt[Rt]=new Array(Bt.length).fill().map(()=>[]))}const yt=Math.log10(1/s),Mt=Math.pow(10,yt);for(let Et=0;Et<et;Et++){const At=f?f.getX(Et):Et;let Rt="";for(let Bt=0,Qt=rt.length;Bt<Qt&&a;Bt++){const Wt=rt[Bt],tn=i.getAttribute(Wt),pn=tn.itemSize;for(let yn=0;yn<pn;yn++)Rt+=~~(tn[vt[yn]](At)*Mt)+","}if(a&&Rt in h)ft.push(h[Rt]);else{for(let Bt=0,Qt=rt.length;Bt<Qt;Bt++){const Wt=rt[Bt],tn=i.getAttribute(Wt),pn=i.morphAttributes[Wt],yn=tn.itemSize,En=lt[Wt],wn=pt[Wt];for(let In=0;In<yn;In++){const xn=vt[In];if(En.push(tn[xn](At)),pn)for(let Cn=0,Fn=pn.length;Cn<Fn;Cn++)wn[Cn].push(pn[Cn][xn](At))}}a&&(h[Rt]=tt),ft.push(tt),tt++}}const xt=i.clone();for(let Et=0,At=rt.length;Et<At;Et++){const Rt=rt[Et],Bt=i.getAttribute(Rt),Qt=new Bt.array.constructor(lt[Rt]),Wt=new d.TlE(Qt,Bt.itemSize,Bt.normalized);if(xt.setAttribute(Rt,Wt),Rt in pt)for(let tn=0;tn<pt[Rt].length;tn++){const pn=i.morphAttributes[Rt][tn],yn=new pn.array.constructor(pt[Rt][tn]),En=new d.TlE(yn,pn.itemSize,pn.normalized);xt.morphAttributes[Rt][tn]=En}}return xt.setIndex(ft),xt}(c,e)}class ws extends j{constructor({animationLoop:e,canvas:i,alpha:s=!0,targetOptions:a}){super(),this._isWebGL2=!1,this._trackedTargets=[],this.dirty=!0,this._lastTime=0,this.frameWaitTime=0,this._passes=[],this._pipeline=[],this._passesNeedsUpdate=!0,this._displayCanvasScaling=1,this._renderSize=new d.FM8(512,512),this._frameCount=0,this._tempTargets={},this.maxTempPerKey=5,this._animationLoop=this._animationLoop.bind(this),this._processNewTarget=this._processNewTarget.bind(this),this._processNewTempTarget=this._processNewTempTarget.bind(this),this.trackTarget=this.trackTarget.bind(this),this.disposeTarget=this.disposeTarget.bind(this),this.createTarget=this.createTarget.bind(this),this.createTargetCustom=this.createTargetCustom.bind(this),this._renderer=new d.CP7({canvas:i,antialias:!0,alpha:s,premultipliedAlpha:!1,preserveDrawingBuffer:!0}),this._renderer.baseRenderer=this,this._renderer.setAnimationLoop(this._animationLoop),this._context=this._renderer.getContext(),this._isWebGL2=this._renderer.capabilities.isWebGL2,this._renderSize=new d.FM8(i.clientWidth,i.clientHeight),this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling),this._renderer.toneMapping=d.uL9,this._renderer.toneMappingExposure=1,this._renderer.outputEncoding=d.rnI,this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=d._iA,this._renderer.shadowMap.autoUpdate=!1,this.resetShadows(),this._composerTarget=this.createTarget(a,!1),this._composerTarget.texture.name="EffectComposer.rt1",this._composer=new jt(this._renderer,this._composerTarget),e&&this.addEventListener("animationLoop",e)}get composer(){return this._composer}get passes(){return this._passes}get isWebGL2(){return this._isWebGL2}get composerTarget(){return this._composerTarget}get renderSize(){return this._renderSize}get displayCanvasScaling(){return this._displayCanvasScaling}set displayCanvasScaling(e){e!==this._displayCanvasScaling&&(this._displayCanvasScaling=e,this.setSize(void 0,void 0,!0))}get frameCount(){return this._frameCount}set pipeline(e){this._pipeline=e,this._passesNeedsUpdate=!0}get pipeline(){return this._pipeline}refreshPipeline(){var e,i,s;const a=this._passes,h=[],f={};for(const k of a){if(k.enabled===!1)continue;const et={after:(e=k.after)!==null&&e!==void 0?e:[],before:(i=k.before)!==null&&i!==void 0?i:[],dependencies:new Set((s=k.required)!==null&&s!==void 0?s:[])};f[k.passId]=et}for(const[k,et]of Object.entries(f)){const tt=new Set([...et.after,...et.before]);et.dependencies.forEach(rt=>tt.has(rt)&&tt.delete(rt)),tt.forEach(rt=>{const lt=f[rt];if(lt){if(lt.dependencies.has(k))throw console.error("cyclic",k,rt),"Cyclic dependency";et.dependencies.add(rt)}})}for(;;){let k=!1;const et=[...Object.entries(f)];for(const[tt,rt]of et)if(!h.includes(tt)&&Bn(h,rt.dependencies.values())){const lt=Math.max(-1,...rt.after.map(ft=>h.indexOf(ft))),pt=Math.min(h.length,...rt.before.map(ft=>{const vt=h.indexOf(ft);return vt<0?h.length:vt}));if(lt>=pt)throw console.error(rt,a,h,lt,pt),"Not possible";h.splice(rt.after.length>0?lt+1:pt,0,tt),k=!0,delete f[tt]}if(Object.keys(f).length<1)break;if(!k)throw console.log(et,f,h),"Not possible 2"}return this.pipeline=h,this.pipeline}get context(){return this._context}get rendererObject(){return this._renderer}_animationLoop(e,i){const s=e-this._lastTime;this._lastTime=e,this.frameWaitTime-=s,this.frameWaitTime>0||(this.frameWaitTime=0,this.dispatchEvent({type:"animationLoop",deltaTime:s,time:e,renderer:this,xrFrame:i}))}get clock(){return this._composer.clock}registerPass(e,i=!0){var s;if(i)for(const a of[...this._passes])e.passId===a.passId&&this.unregisterPass(a);this._passes.push(e),(s=e.onRegister)===null||s===void 0||s.call(e,this),this._passesNeedsUpdate=!0,this._updated()}unregisterPass(e){var i;const s=this._passes.indexOf(e);s>=0&&((i=e.onUnregister)===null||i===void 0||i.call(e,this),this._passes.splice(s,1),this._passesNeedsUpdate=!0,this._updated())}setSize(e,i,s=!1){!s&&(e?Math.abs(e-this._renderSize.width):0)+(i?Math.abs(i-this._renderSize.height):0)<.1||(e&&(this._renderSize.width=e),i&&(this._renderSize.height=i),this.rendererObject.xr.enabled||(this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling)),this._composer.setPixelRatio(this._displayCanvasScaling,!1),this._composer.setSize(this._renderSize.width,this._renderSize.height),this._trackedTargets.forEach(a=>{const h=a,f=h.sizeMultiplier;if(f){const k=this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*f);h.setSize(k.width,k.height)}}),this.dispatchEvent({type:"resize"}),this._updated(),this.reset())}blit(e,i,{viewport:s,material:a,shader:h,pass:f,clear:k=!0}={}){const et=this._composer.copyPass,{renderToScreen:tt,material:rt,uniforms:lt,clear:pt}=et;a&&(et.material=a);const ft=this._renderer.getViewport(new d.Ltg),vt=this._renderer.autoClear,yt=this._renderer.getRenderTarget();s&&this._renderer.setViewport(new d.Ltg().fromArray(s)),this._renderer.autoClear=!1,et.uniforms=et.material.uniforms,et.renderToScreen=!1,et.clear=k,Lr(this._renderer,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!0,transmissionRender:!1},()=>{et.render(this._renderer,i??null,{texture:e},0,!1)}),et.renderToScreen=tt,et.clear=pt,et.material=rt,et.uniforms=lt,this._renderer.autoClear=vt,s&&this._renderer.setViewport(ft),this._renderer.setRenderTarget(yt)}clearColor({r:e,g:i,b:s,a,target:h,depth:f=!0,stencil:k=!0}){var et;const tt=this._renderer.getClearColor(new d.Ilk),rt=this._renderer.getClearAlpha();this._renderer.setClearAlpha(a??rt),this._renderer.setClearColor(new d.Ilk(e??tt.r,i??tt.g,s??tt.b));const lt=this._renderer.getRenderTarget(),pt=this._renderer.getActiveCubeFace(),ft=this._renderer.getActiveMipmapLevel();this._renderer.setRenderTarget((et=h)!==null&&et!==void 0?et:null),this._renderer.clear(!0,f,k),this._renderer.setRenderTarget(lt,pt,ft),this._renderer.setClearColor(tt),this._renderer.setClearAlpha(rt)}renderModel(e,i){this._renderer.render(e.modelObject,i.cameraObject)}renderScene(e){const i=e.activeCamera;i&&this.renderModel(e,i)}_updated(){this.dispatchEvent({type:"update"})}render(){var e;this._passesNeedsUpdate&&this.refreshPasses();for(const i of this._passes)i.passObject.enabled&&((e=i.update)===null||e===void 0||e.call(i));this._composer.render(),this._frameCount+=1,this.dirty=!1}updateDirty(){this.dirty=this.dirty||this._passes.findIndex(e=>e.dirty)>=0}reset(){this._frameCount=0,this.dirty=!0}resetShadows(){this._renderer.shadowMap.needsUpdate=!0}refreshPasses(){if(!this._passesNeedsUpdate)return;this._passesNeedsUpdate=!1;const e=[];for(const i of this._pipeline){const s=this._passes.find(a=>a.passId===i);s?e.push(s.passObject):console.warn("Unable to find pass: ",i)}[...this._composer.passes].forEach(i=>this._composer.removePass(i)),e.forEach(i=>this._composer.addPass(i)),this._updated()}dispose(){this._renderer.dispose()}trackTarget(e){this._trackedTargets.push(e)}removeTrackedTarget(e){const i=this._trackedTargets.indexOf(e);i>=0&&this._trackedTargets.splice(i,1)}createTarget({sizeMultiplier:e,samples:i=0,encoding:s=d.rnI,type:a=d.ywz,format:h=d.wk1,depthBuffer:f=!0,depthTexture:k=!1,size:et,textureCount:tt=1,...rt}={},lt=!0){this.isWebGL2||(i=0),e!==void 0&&et!==void 0&&console.error("Both sizeMultiplier and size are defined. sizeMultiplier will be ignored."),et=et||this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*(e=e||1));const pt=k?new d.$YQ(et.width,et.height,d.ywz):void 0,ft=this.createTargetCustom(tt>1?{width:et.width,height:et.height,count:tt}:et,{samples:i,encoding:s,type:a,format:h,depthBuffer:f,depthTexture:pt},tt>1?d.kFz:d.dd2);return this._processNewTarget(ft,e,lt),this._setTargetOptions(ft,rt),ft}_processNewTarget(e,i,s){return i!==void 0&&(e.sizeMultiplier=i),s&&this.trackTarget(e),e}disposeTarget(e){if(e){if(e.isTemporary)return this.releaseTempTarget(e);this.removeTrackedTarget(e),e.dispose()}}createTargetCustom({width:e,height:i,count:s},a={},h){var f;const k=this._processNewTarget;let et=[e,i];if(s&&s>1&&et.push(s),(h==null?void 0:h.prototype)===d.oAp.prototype){if(e!==i)throw"Width and height of cube render target must be equal";et=[e]}a={format:d.wk1,minFilter:d.wem,magFilter:d.wem,generateMipmaps:!1,type:d.ywz,encoding:d.rnI,...a};const tt=[...et,a];return new class extends((f=h)!==null&&f!==void 0?f:d.dd2){constructor(...rt){super(...rt),Array.isArray(this.texture)?this.texture.forEach(lt=>{lt.encoding=a.encoding,lt.toJSON=()=>({})}):this.texture.toJSON=()=>({})}clone(rt=!0){if(this.isTemporary)throw"Cloning temporary render targets not supported";if(Array.isArray(this.texture))throw"Cloning multiple render targets not supported";const lt=super.clone();return lt.texture.isRenderTargetTexture=!0,k(lt,this.sizeMultiplier||1,rt)}}(...tt)}getTempTarget(e={}){var i;const s=io(e);let a;return!((i=this._tempTargets[s])===null||i===void 0)&&i.length&&(a=this._tempTargets[s].pop()),a?this._setTargetOptions(a,e):(a=this.createTarget(e),this._processNewTempTarget(a,s)),a}_processNewTempTarget(e,i){return e.isTemporary=!0,e.targetKey=i,this._tempTargets[i]===void 0&&(this._tempTargets[i]=[]),e}releaseTempTarget(e){const i=e.targetKey;if(!i||!e.isTemporary)throw"Not a temp target";this._tempTargets[i].length>this.maxTempPerKey?e.dispose():this._tempTargets[i].push(e)}updateShaderProperties(e){return e.uniforms.frameCount?e.uniforms.frameCount.value=this.frameCount:console.warn("BaseRenderer: no uniform: frameCount"),this}_setTargetOptions(e,i){var s,a,h;e.texture.minFilter=(s=i.minFilter)!==null&&s!==void 0?s:d.wem,e.texture.magFilter=(a=i.magFilter)!==null&&a!==void 0?a:d.wem,e.texture.generateMipmaps=(h=i.generateMipmaps)!==null&&h!==void 0&&h,e.texture.generateMipmaps&&e.texture.minFilter===d.wem&&(e.texture.minFilter=d.FDw),e.texture.generateMipmaps||e.texture.minFilter!==d.FDw||(e.texture.minFilter=d.wem)}}function io(c={}){var e,i;return[c.sizeMultiplier,c.samples,c.encoding,c.type,c.format,c.depthBuffer,c.depthTexture,(e=c.size)===null||e===void 0?void 0:e.width,(i=c.size)===null||i===void 0?void 0:i.height].join(";")}const ks=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function er(){const c=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,s=4294967295*Math.random()|0;return(ks[255&c]+ks[c>>8&255]+ks[c>>16&255]+ks[c>>24&255]+"-"+ks[255&e]+ks[e>>8&255]+"-"+ks[e>>16&15|64]+ks[e>>24&255]+"-"+ks[63&i|128]+ks[i>>8&255]+"-"+ks[i>>16&255]+ks[i>>24&255]+ks[255&s]+ks[s>>8&255]+ks[s>>16&255]+ks[s>>24&255]).toLowerCase()}function Vs(c,e,i){return Math.max(e,Math.min(i,c))}function Ll(c,e,i){return(1-i)*c+i*e}const Nl=0,Qs=1,So=3,_l=4,Mo=1006,Bo="srgb",_o="srgb-linear";function fo(c){return c<.04045?.0773993808*c:Math.pow(.9478672986*c+.0521327014,2.4)}function Wl(c){return c<.0031308?12.92*c:1.055*Math.pow(c,.41666)-.055}const Oo={[Bo]:{[_o]:fo},[_o]:{[Bo]:Wl}},yl={legacyMode:!0,get workingColorSpace(){return _o},set workingColorSpace(c){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(c,e,i){if(this.legacyMode||e===i||!e||!i)return c;if(Oo[e]&&Oo[e][i]!==void 0){const s=Oo[e][i];return c.r=s(c.r),c.g=s(c.g),c.b=s(c.b),c}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(c,e){return this.convert(c,this.workingColorSpace,e)},toWorkingColorSpace:function(c,e){return this.convert(c,e,this.workingColorSpace)}},Dp={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},co={r:0,g:0,b:0},gu={h:0,s:0,l:0},zo={h:0,s:0,l:0};function Yu(c,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?c+6*(e-c)*i:i<.5?e:i<2/3?c+6*(e-c)*(2/3-i):c}function Rp(c,e){return e.r=c.r,e.g=c.g,e.b=c.b,e}class oo{constructor(e,i,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,i===void 0&&s===void 0?this.set(e):this.setRGB(e,i,s)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,i="srgb"){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,yl.toWorkingColorSpace(this,i),this}setRGB(e,i,s,a="srgb-linear"){return this.r=e,this.g=i,this.b=s,yl.toWorkingColorSpace(this,a),this}setHSL(e,i,s,a="srgb-linear"){if(e=function(h,f){return(h%f+f)%f}(e,1),i=Vs(i,0,1),s=Vs(s,0,1),i===0)this.r=this.g=this.b=s;else{const h=s<=.5?s*(1+i):s+i-s*i,f=2*s-h;this.r=Yu(f,h,e+1/3),this.g=Yu(f,h,e),this.b=Yu(f,h,e-1/3)}return yl.toWorkingColorSpace(this,a),this}setStyle(e,i="srgb"){function s(h){h!==void 0&&parseFloat(h)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let a;if(a=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let h;const f=a[1],k=a[2];switch(f){case"rgb":case"rgba":if(h=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(k))return this.r=Math.min(255,parseInt(h[1],10))/255,this.g=Math.min(255,parseInt(h[2],10))/255,this.b=Math.min(255,parseInt(h[3],10))/255,yl.toWorkingColorSpace(this,i),s(h[4]),this;if(h=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(k))return this.r=Math.min(100,parseInt(h[1],10))/100,this.g=Math.min(100,parseInt(h[2],10))/100,this.b=Math.min(100,parseInt(h[3],10))/100,yl.toWorkingColorSpace(this,i),s(h[4]),this;break;case"hsl":case"hsla":if(h=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(k)){const et=parseFloat(h[1])/360,tt=parseFloat(h[2])/100,rt=parseFloat(h[3])/100;return s(h[4]),this.setHSL(et,tt,rt,i)}}}else if(a=/^\#([A-Fa-f\d]+)$/.exec(e)){const h=a[1],f=h.length;if(f===3)return this.r=parseInt(h.charAt(0)+h.charAt(0),16)/255,this.g=parseInt(h.charAt(1)+h.charAt(1),16)/255,this.b=parseInt(h.charAt(2)+h.charAt(2),16)/255,yl.toWorkingColorSpace(this,i),this;if(f===6)return this.r=parseInt(h.charAt(0)+h.charAt(1),16)/255,this.g=parseInt(h.charAt(2)+h.charAt(3),16)/255,this.b=parseInt(h.charAt(4)+h.charAt(5),16)/255,yl.toWorkingColorSpace(this,i),this}return e&&e.length>0?this.setColorName(e,i):this}setColorName(e,i="srgb"){const s=Dp[e.toLowerCase()];return s!==void 0?this.setHex(s,i):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=fo(e.r),this.g=fo(e.g),this.b=fo(e.b),this}copyLinearToSRGB(e){return this.r=Wl(e.r),this.g=Wl(e.g),this.b=Wl(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e="srgb"){return yl.fromWorkingColorSpace(Rp(this,co),e),Vs(255*co.r,0,255)<<16^Vs(255*co.g,0,255)<<8^Vs(255*co.b,0,255)<<0}getHexString(e="srgb"){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,i="srgb-linear"){yl.fromWorkingColorSpace(Rp(this,co),i);const s=co.r,a=co.g,h=co.b,f=Math.max(s,a,h),k=Math.min(s,a,h);let et,tt;const rt=(k+f)/2;if(k===f)et=0,tt=0;else{const lt=f-k;switch(tt=rt<=.5?lt/(f+k):lt/(2-f-k),f){case s:et=(a-h)/lt+(a<h?6:0);break;case a:et=(h-s)/lt+2;break;case h:et=(s-a)/lt+4}et/=6}return e.h=et,e.s=tt,e.l=rt,e}getRGB(e,i="srgb-linear"){return yl.fromWorkingColorSpace(Rp(this,co),i),e.r=co.r,e.g=co.g,e.b=co.b,e}getStyle(e="srgb"){return yl.fromWorkingColorSpace(Rp(this,co),e),e!==Bo?`color(${e} ${co.r} ${co.g} ${co.b})`:`rgb(${255*co.r|0},${255*co.g|0},${255*co.b|0})`}offsetHSL(e,i,s){return this.getHSL(gu),gu.h+=e,gu.s+=i,gu.l+=s,this.setHSL(gu.h,gu.s,gu.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,i){return this.r=e.r+i.r,this.g=e.g+i.g,this.b=e.b+i.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,i){return this.r+=(e.r-this.r)*i,this.g+=(e.g-this.g)*i,this.b+=(e.b-this.b)*i,this}lerpColors(e,i,s){return this.r=e.r+(i.r-e.r)*s,this.g=e.g+(i.g-e.g)*s,this.b=e.b+(i.b-e.b)*s,this}lerpHSL(e,i){this.getHSL(gu),e.getHSL(zo);const s=Ll(gu.h,zo.h,i),a=Ll(gu.s,zo.s,i),h=Ll(gu.l,zo.l,i);return this.setHSL(s,a,h),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,i=0){return this.r=e[i],this.g=e[i+1],this.b=e[i+2],this}toArray(e=[],i=0){return e[i]=this.r,e[i+1]=this.g,e[i+2]=this.b,e}fromBufferAttribute(e,i){return this.r=e.getX(i),this.g=e.getY(i),this.b=e.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}function To(c,e){const i=e==="map";return{type:"folder",label:e+" Sampler",hidden:()=>!c[e],children:[()=>({type:"vec2",label:"Repeat",hidden:()=>!i&&c.map,bounds:[-100,100],stepSize:.001,property:[c[e],"repeat"],onChange:c==null?void 0:c.setDirty}),()=>({type:"vec2",label:"Offset",hidden:()=>!i&&c.map,bounds:[-2,2],property:[c[e],"offset"],onChange:c==null?void 0:c.setDirty}),()=>({type:"vec2",label:"Center",hidden:()=>!i&&c.map,bounds:[-2,2],property:[c[e],"center"],onChange:c==null?void 0:c.setDirty}),()=>({type:"input",label:"Rotation",hidden:()=>!i&&c.map,bounds:[-Math.PI,Math.PI],property:[c[e],"rotation"],onChange:c==null?void 0:c.setDirty}),()=>({type:"dropdown",label:"Encoding",property:[c[e],"encoding"],children:[["Linear",d.rnI],["sRGB",d.knz]].map(s=>({label:s[0],value:s[1]})),onChange:[()=>{const s=c[e];s&&(s.needsUpdate=!0)},c==null?void 0:c.setDirty]}),()=>({type:"checkbox",label:"Flip Y",getValue:()=>{var s,a;return(a=(s=c[e])===null||s===void 0?void 0:s.flipY)!==null&&a!==void 0&&a},setValue:s=>{var a;const h=c[e];if(h&&h.flipY!==s)if(h.image&&ImageBitmap&&h.image instanceof ImageBitmap){const f=h,k=h.source.data;createImageBitmap(k,{imageOrientation:"flipY"}).then(et=>{var tt;k.close&&k.close(),f.flipY=s,f.source.data=et,f.source.needsUpdate=!0,f.needsUpdate=!0,(tt=c==null?void 0:c.setDirty)===null||tt===void 0||tt.call(c)})}else h.flipY=s,h.needsUpdate=!0,(a=c==null?void 0:c.setDirty)===null||a===void 0||a.call(c)}}),()=>({type:"dropdown",label:"Wrap S",property:[c[e],"wrapS"],children:[["ClampToEdge",d.uWy],["MirroredRepeat",d.OoA],["Repeat",d.rpg]].map(s=>({label:s[0],value:s[1]})),onChange:[()=>{c[e]&&(c[e].needsUpdate=!0)},c==null?void 0:c.setDirty]}),()=>({type:"dropdown",label:"Wrap T",property:[c[e],"wrapT"],children:[["ClampToEdge",d.uWy],["MirroredRepeat",d.OoA],["Repeat",d.rpg]].map(s=>({label:s[0],value:s[1]})),onChange:[()=>{c[e]&&(c[e].needsUpdate=!0)},c==null?void 0:c.setDirty]}),()=>({type:"input",label:"Anisotropy",bounds:[1,6],stepSize:1,property:[c[e],"anisotropy"],onChange:[()=>{c[e]&&(c[e].needsUpdate=!0),c.needsUpdate=!0},c==null?void 0:c.setDirty]}),()=>({type:"dropdown",label:"Min Filter",property:[c[e],"minFilter"],children:[["Linear",Mo],["Nearest",d.TyD],["NearestMipmapNearest",d.YLQ],["NearestMipmapLinear",d.vZf],["LinearMipmapNearest",d.qyh],["LinearMipmapLinear",d.D1R]].map(s=>({label:s[0],value:s[1]})),onChange:[()=>{c[e]&&(c[e].needsUpdate=!0)},c==null?void 0:c.setDirty]}),()=>({type:"dropdown",label:"Mag Filter",property:[c[e],"magFilter"],children:[["Linear",Mo],["Nearest",d.TyD]].map(s=>({label:s[0],value:s[1]})),onChange:[()=>{c[e]&&(c[e].needsUpdate=!0)},c==null?void 0:c.setDirty]})]}}oo.NAMES=Dp;const Gs=["appliedMeshes","imageLoadAwaiter","inverseModelMatrix","uvTransform","uuid","iMaterial"];function Jl(c,e){if(e)for(const i of Object.keys(e))Gs.includes(i)||i.startsWith("__")||typeof c[i]!="function"&&typeof e[i]!="function"&&(c[i]=e[i]);return c}const Xu=["appliedMaterials","uuid"];function Pu(c,e){if(e)for(const i of Object.keys(e))Xu.includes(i)||i.startsWith("__")||typeof c[i]!="function"&&typeof e[i]!="function"&&(c[i]=e[i]);return c}const xu=new Map;function jn(c){return(e,i)=>{const s=e.constructor;if(s===Object)throw new Error("All properties in an object are serialized by default");xu.has(s)||xu.set(s,[]),xu.get(s).push([c||i,i])}}const Pl={obj:(c,e)=>Object.fromEntries(Object.entries(c).map(([i,s])=>[i,Wr(s,!1,e)])),vec4:c=>({x:c.x,y:c.y,z:c.z,w:c.w,isVector4:!0}),vec3:c=>({x:c.x,y:c.y,z:c.z,isVector3:!0}),vec2:c=>({x:c.x,y:c.y,isVector2:!0}),color:c=>({r:c.r,g:c.g,b:c.b,isColor:!0}),quat:c=>({x:c.x,y:c.y,z:c.z,w:c.w,isQuaternion:!0}),texture:(c,e)=>{if(!(c!=null&&c.isTexture))throw new Error("Expected a texture");if(c.isRenderTargetTexture)return;if(e!=null&&e.textures[c.uuid])return{uuid:c.uuid,resource:"textures"};const i=c.source.data;c.userData.rootPath&&(c.source.data=null);const s=c.userData;c.userData={};let a=c.toJSON(e);return c.userData=s,a.userData=Wr(Pu({},s),!1,e),c.userData.rootPath&&(delete e.images[c.source.uuid],c.source.data=i),e!=null&&e.textures&&(e.textures[a.uuid]||(e.textures[a.uuid]=a),a={uuid:a.uuid,resource:"textures"}),a},material:(c,e)=>{var i;if(!(c!=null&&c.isMaterial))throw new Error("Expected a material");if(e!=null&&e.materials[c.uuid])return{uuid:c.uuid,resource:"materials"};c.userData.rootPath&&console.error("TODO: handle material with root path with material inheritance/hierarchy");const s=e??{textures:{},images:{}},a={},h={};for(const[k,et]of Object.entries(c))if(!((i=et)===null||i===void 0)&&i.isTexture&&!k.startsWith("__")){const tt=Pl.texture(et,s);a[k]=tt,h[k]=et,c[k]=tt?{isTexture:!0,toJSON:()=>tt}:null}let f=c.toJSON(e);for(const[k,et]of Object.entries(h))c[k]=et,delete h[k];if(e){for(const[k,et]of Object.entries(a))et&&(f[k]=et);e!=null&&e.materials&&(e.materials[f.uuid]||(e.materials[f.uuid]=f),f={uuid:f.uuid,resource:"materials"})}else{for(const[k,et]of Object.entries(a))f[k]=et.uuid;f.textures=Object.values(s.textures),f.images=Object.values(s.images)}return f}},pu=c=>(e,i)=>{var s,a;return(a=(s=i==null?void 0:i.copy)===null||s===void 0?void 0:s.call(i,e))!==null&&a!==void 0?a:new c().copy(e)},Ds={obj:(c,e,i)=>Object.assign(e,Object.fromEntries(Object.entries(c).map(([s,a])=>[s,os(a,e==null?void 0:e[s],!1,i)]))),vec4:pu(d.Ltg),vec3:pu(d.Pa4),vec2:pu(ar),color:pu(oo),quat:pu(d._fP)};function Wr(c,e,i){var s,a;if(typeof c=="function")return;if(Array.isArray(c))return c.map(k=>Wr(k,!1,i));if(typeof c!="object"){if(typeof c=="number"){if(c===1/0)return"Infinity";if(c===-1/0)return"-Infinity";if(isNaN(c))return"NaN"}return c}if(!c)return c;let h=(s=c.constructor)!==null&&s!==void 0?s:Object;if(h===Object)return Pl.obj(c,i);if(c.isVector2)return Pl.vec2(c);if(c.isVector3)return Pl.vec3(c);if(c.isVector4)return Pl.vec4(c);if(c.isColor)return Pl.color(c);if(c.isQuaternion)return Pl.quat(c);if(c.isTexture)return Pl.texture(c,i);if(c.isMaterial)return Pl.material(c,i);if(!e&&typeof c.toJSON=="function")return c.toJSON(i);const f={};for(;h&&h!==Object;)(a=xu.get(h))===null||a===void 0||a.forEach(([k,et])=>{const tt=c[et];f[k]=Wr(tt,!1,i)}),h=Object.getPrototypeOf(h);return c.serializableClassId&&(f.serializableClassId=c.serializableClassId),f}function os(c,e,i,s){var a,h,f;let k=e;if(c===void 0)return k;if(typeof e=="number"){if(c==="Infinity")return 1/0;if(c==="-Infinity")return-1/0;if(c==="NaN")return NaN;if(typeof c=="number"||!c)return c}if(Array.isArray(c)){const rt=c.length;Array.isArray(k)||(k=[]);for(let lt=0;lt<rt;lt++){const pt=c[lt],ft=k.length>lt?os(pt,k[lt],!1,s):os(pt,void 0,!1,s);k.length<=lt?k.push(ft):k[lt]=ft}return k}let et=!1;if(c&&c.resource&&typeof c.resource=="string"&&(c=(a=s[c.resource])===null||a===void 0?void 0:a[c.uuid],et=!0),!k&&c&&!et)if(c.serializableClassId){const rt=Al.get(c.serializableClassId);rt&&(k=new rt)}else typeof c!="object"||c.constructor&&c.constructor!==Object||(k={});if(typeof k=="function")return console.error("cannot deserialize over function",k,c),k;if(c&&typeof c=="object"&&!et){if(c.isVector2)return Ds.vec2(c,k);if(c.isVector3)return Ds.vec3(c,k);if(c.isVector4)return Ds.vec4(c,k);if(c.isColor)return Ds.color(c,k);if(c.isQuaternion)return Ds.quat(c,k)}if(c==null||k==null||typeof k!="object"||k.isTexture)return et&&(c?c.__useCount=c.__useCount?c.__useCount+1:1:console.warn("probable error deserialize: resource not found.")),c;let tt=(h=k.constructor)!==null&&h!==void 0?h:Object;if(tt===Object)return Ds.obj(c,k,s);if(!i&&typeof k.fromJSON=="function")return k.isMaterial&&(Object.entries(c).forEach(([rt,lt])=>{var pt;if(!lt||!lt.resource||typeof lt.resource!="string")return;const ft=(pt=s[lt.resource])===null||pt===void 0?void 0:pt[lt.uuid];c[rt]=ft||null}),c.userData&&(c.userData=os(c.userData,void 0,!1,s))),k.fromJSON(c,s),k;for(;tt&&tt!==Object;)(f=xu.get(tt))===null||f===void 0||f.forEach(([rt,lt])=>{const pt=k[lt],ft=os(c[rt],pt,!1,s);ft!==pt&&nn(k,lt,ft,!0)}),tt=Object.getPrototypeOf(tt);return k}const Al=new Map;function ss(c){return e=>(e=class extends e{constructor(){super(...arguments),this.serializableClassId=c}},Al.set(c,e),e)}function Ls(c,e){if(c.uiConfig)return c.uiConfig;const i={type:"folder",label:c.name||"unnamed",expanded:!0,limitedUi:!0,children:[{type:"checkbox",label:"Visible",property:[c,"visible"],limitedUi:!0},{type:"button",label:"Pick/Focus",value:()=>{c.dispatchEvent({type:"select",ui:!0,value:c,focusCamera:!0})}},{type:"button",label:"Pick Parent",hidden:()=>!c.parent,value:()=>{const a=c.parent;a&&a.dispatchEvent({type:"select",ui:!0,value:a})}},{type:"input",label:"Name",property:[c,"name"]},{type:"checkbox",label:"Casts Shadow",hidden:()=>!c.isMesh,property:[c,"castShadow"]},{type:"checkbox",label:"Receive Shadow",hidden:()=>!c.isMesh,property:[c,"receiveShadow"]},{type:"vec3",label:"Position",property:[c,"position"],limitedUi:!0},{type:"vec3",label:"Rotation",property:[c,"rotation"],limitedUi:!0},{type:"vec3",label:"Scale",property:[c,"scale"]},{type:"button",label:"Auto Scale",prompt:["Auto Scale Radius: Object will be scaled to the given radius",c.userData.autoScaleRadius||"2",!0],value:a=>{if(!a)return;const h=parseFloat(a);Math.abs(h)>0&&Rs(c,h)}},c.userData.license!==void 0?{type:"input",label:"License/Credits",property:[c.userData,"license"],limitedUi:!0}:{}]},s=c;if(s!=null&&s.isMesh&&e!==!1){const a=[()=>{var h;return(h=s.geometry)===null||h===void 0?void 0:h.uiConfig},()=>{var h;return Array.isArray(s.material)?s.material.length<1?void 0:{label:"Materials",type:"folder",children:s.material.map(f=>f==null?void 0:f.uiConfig).filter(f=>f)}:(h=s.material)===null||h===void 0?void 0:h.uiConfig}];i.children.push(...a)}if(c!=null&&c.isCamera){const a=[{type:"button",label:"Set View",value:()=>{c.dispatchEvent({type:"setView",ui:!0,camera:c})}},{type:"button",label:"Activate main",hidden:()=>{var h;return(h=c.userData.iCamera)===null||h===void 0?void 0:h.isActiveCamera},value:()=>{c.dispatchEvent({type:"activateMain",ui:!0,camera:c})}},{type:"button",label:"Deactivate main",hidden:()=>{var h;return!(!((h=c.userData.iCamera)===null||h===void 0)&&h.isActiveCamera)},value:()=>{c.dispatchEvent({type:"activateMain",ui:!0,camera:void 0})}}];i.children.push(...a)}return c.uiConfig=i,i}function vs(c,e,i){var s;if(!c)return void console.warn("setupIModel: object is undefined");if(c.__disposed&&(console.warn("re-init/re-add disposed object, things might not work as intended",c),delete c.__disposed),c.userData||(c.userData={}),c.userData.__iModelSetup&&c.modelObject)return c;c.userData.__iModelSetup=!0;let a=[];a.push(()=>{[...c.children].forEach(vt=>{var yt;(yt=vt==null?void 0:vt.dispose)===null||yt===void 0||yt.call(vt)}),c.children=[],c.parent&&c.removeFromParent()}),c.isLight&&!c.assetType?(c.assetType="light",c.lightObject=c):c.isCamera?(c.assetType="camera",c.cameraObject=c):c.assetType||(c.assetType="model"),c.modelObject||(c.modelObject=c),c.setDirty||(c.setDirty=(vt={})=>{c.dispatchEvent({...vt,type:"objectUpdate",object:c})},c.userData.setDirty&&console.warn("userData.setDirty already defined",c.userData.setDirty,c),c.userData.setDirty=vt=>{var yt;console.warn("userData.setDirty is deprecated, use setDirty directly"),(yt=c.setDirty)===null||yt===void 0||yt.call(c,vt)});const h=vt=>{var yt,Mt,xt;const Et=(Mt=(yt=c.parent)===null||yt===void 0?void 0:yt.userData.parentRoot)!==null&&Mt!==void 0?Mt:c.parent;Et!==c.userData.parentRoot&&c.traverse(At=>{At.userData.parentRoot=Et}),(xt=c.setDirty)===null||xt===void 0||xt.call(c,{change:"addedToParent"})},f=()=>{var vt;(vt=c.setDirty)===null||vt===void 0||vt.call(c,{change:"removedFromParent"}),c.userData.parentRoot!==void 0&&c.traverse(yt=>{yt.userData.parentRoot=void 0})};c.addEventListener("added",h),c.addEventListener("removed",f),a.push(()=>{c.removeEventListener("added",h),c.removeEventListener("removed",f)});const k=c.dispose;c.dispose=()=>{c.dispatchEvent({type:"dispose"}),k==null||k.call(c)},c.userData.dispose&&console.warn("userData.dispose already defined"),c.userData.dispose=()=>{var vt;console.warn("userData.dispose is deprecated, use dispose directly"),(vt=c.dispose)===null||vt===void 0||vt.call(c)};const et=c;!et.isMesh&&!et.isLine||et.userData.__meshSetup||(et.userData.__meshSetup=!0,et.setMaterial||(et.setMaterial=vt=>eo(et,vt)),et.setGeometry||(et.setGeometry=(vt,yt=!1)=>Vo(et,vt,yt),et.setGeometry(et.geometry,!0)),c.userData.setMaterial&&console.warn("userData.setMaterial already defined"),c.userData.setMaterial=vt=>{var yt;console.warn("userData.setMaterial is deprecated, use setMaterial directly"),(yt=c.setMaterial)===null||yt===void 0||yt.call(c,vt)},c.userData.setGeometry&&console.warn("userData.setGeometry already defined"),c.userData.setGeometry=(vt,...yt)=>{var Mt;console.warn("userData.setGeometry is deprecated, use setGeometry directly"),(Mt=c.setGeometry)===null||Mt===void 0||Mt.call(c,vt,...yt)},c.userData.__keepShadowDef||(c.castShadow=!0,c.receiveShadow=!0,c.userData.__keepShadowDef=!0),a.push(()=>{var vt,yt;const Mt=((vt=et.setMaterial)===null||vt===void 0?void 0:vt.call(et,void 0))||[],xt=(yt=et.setGeometry)===null||yt===void 0?void 0:yt.call(et,void 0);for(const Et of Mt)Et&&Et.userData.__appliedMeshes.size===0&&Et.userData.disposeOnIdle!==!1&&Et.dispose();xt&&xt.userData.__appliedMeshes.size===0&&xt.userData.disposeOnIdle!==!1&&xt.dispose()})),c.uiConfig||c.assetType!=="model"&&c.assetType!=="camera"||(Ls(c),a.push(()=>{c.uiConfig=void 0}));const tt=()=>{var vt,yt;return(yt=(vt=c.uiConfig)===null||vt===void 0?void 0:vt.uiRefresh)===null||yt===void 0?void 0:yt.call(vt,"postFrame",!0,1)};c.addEventListener("objectUpdate",tt),a.push(()=>c.removeEventListener("objectUpdate",tt)),c.userData.__autoParentDispatchEvents?console.warn("object.userData.__autoParentDispatchEvents already set"):(c.userData.__autoParentDispatchEvents=c.userData.__autoParentDispatchEvents||["objectUpdate","materialUpdate","select"],c.isCamera&&c.userData.__autoParentDispatchEvents.push("activateMain","setView")),e&&(c.userData.parentRoot=e),a.push(()=>{delete c.userData.parentRoot});const rt=c.dispatchEvent;c.dispatchEvent=vt=>{var yt;!((yt=c.userData.__autoParentDispatchEvents)===null||yt===void 0)&&yt.includes(vt.type)&&(vt.parentDispatch=!0),vt.parentDispatch&&(Mt=>{var xt;const Et=(xt=c.userData.parentRoot)!==null&&xt!==void 0?xt:c.parent;Et!=null&&Et.modelObject&&Et.dispatchEvent(Mt)})(vt),rt.call(c,vt)},a.push(()=>{c.dispatchEvent=rt});const lt=c.clone;c.clone=(...vt)=>{const yt=c.userData;c.userData={};let Mt=lt.call(c,...vt);c.userData=yt,Ko(Mt.userData,yt);const xt=c.userData.parentRoot;return xt&&xt.assetType!=="model"&&console.warn("Cloning an object with a parent that is not an IModel is not supported"),Mt=vs(Mt,xt,i),Mt.userData.cloneParent=c.uuid,Mt},a.push(()=>{c.clone=lt});const pt=c.copy;c.copy=(vt,...yt)=>{const Mt=vt.userData;vt.userData={};const xt=pt.call(c,vt,...yt);return vt.userData=Mt,Ko(c.userData,vt),xt},a.push(()=>{c.copy=pt});const ft=c.add;return c.add=(...vt)=>(vt.forEach(yt=>vs(yt,c.userData.parentRoot||c,i)),ft.call(c,...vt)),a.push(()=>{c.add=ft}),c=(s=i==null?void 0:i(c))!==null&&s!==void 0?s:c,a.push(()=>{nn(c,"modelObject",void 0,!0),c.userData={}}),c.addEventListener("dispose",()=>{c.__disposed?console.warn("Object already disposed",c):(c.__disposed=!0,a.forEach(vt=>vt()),a=[])}),[...c.children].forEach(vt=>vs(vt,c,i)),c}function eo(c,e){var i,s,a,h,f;const k=(Array.isArray(e)?e:[e]).map(rt=>rt==null?void 0:rt.materialObject).filter(rt=>rt);if(c.material==k||k.length===1&&c.material===k[0])return[];c.userData.__materialUpdater||(c.userData.__materialUpdater=()=>{c.dispatchEvent({type:"materialUpdate"})});const et=Array.isArray(c.material)?[...c.material]:[c.material];for(const rt of et)rt&&(rt.removeEventListener("materialUpdate",c.userData.__materialUpdater),(s=(i=rt.userData)===null||i===void 0?void 0:i.__appliedMeshes)===null||s===void 0||s.delete(c));const tt=[];for(const rt of k)rt.userData.__appliedMeshes||(rt.userData.__appliedMeshes=new Set),tt.push(rt),rt&&(rt.addEventListener("materialUpdate",c.userData.__materialUpdater),rt.userData.__appliedMeshes.add(c));return c.material=tt.length!==1?tt:(a=tt[0])!==null&&a!==void 0?a:void 0,c.traverseAncestors(rt=>{rt.isRootScene&&rt.refreshEnvMapIntensity(c)}),c.dispatchEvent({type:"materialChanged",material:e}),(f=(h=c.uiConfig)===null||h===void 0?void 0:h.uiRefresh)===null||f===void 0||f.call(h,"postFrame",!0),et}function Vo(c,e,i=!1){var s,a,h,f,k,et,tt;c.userData.__objectUpdater||(c.userData.__objectUpdater=pt=>{c.dispatchEvent({...pt,type:"objectUpdate"})});let rt=c.geometry;const lt=rt;return(rt!==e||i)&&(rt&&(rt.removeEventListener("geometryUpdate",c.userData.__objectUpdater),(a=(s=rt.userData)===null||s===void 0?void 0:s.__appliedMeshes)===null||a===void 0||a.delete(c)),rt=e,rt&&!rt.userData.__appliedMeshes&&(rt.userData.__appliedMeshes=new Set),c.geometry=(h=rt)!==null&&h!==void 0?h:void 0,rt&&(rt.addEventListener("geometryUpdate",c.userData.__objectUpdater),(k=(f=rt.userData)===null||f===void 0?void 0:f.__appliedMeshes)===null||k===void 0||k.add(c))),e&&!e.uiConfig&&(e.uiConfig=function(pt){return{label:"Geometry",type:"folder",children:[{type:"input",property:[pt,"uuid"],disabled:!0},{type:"button",label:"Create uv2 from uv",value:()=>{pt.hasAttribute("uv2")&&!confirm("uv2 already exists, replace with uv data?")||pt.setAttribute("uv2",pt.getAttribute("uv"))}},{type:"input",label:"Mesh count",get value(){var ft,vt,yt;return(yt=(vt=(ft=pt.userData)===null||ft===void 0?void 0:ft.__appliedMeshes)===null||vt===void 0?void 0:vt.size)!==null&&yt!==void 0?yt:0},set value(ft){},disabled:!0}]}}(c.geometry)),c.dispatchEvent({type:"geometryChanged",geometry:e}),(tt=(et=c.uiConfig)===null||et===void 0?void 0:et.uiRefresh)===null||tt===void 0||tt.call(et,"postFrame",!0),lt===rt?void 0:lt||void 0}const to=["appliedMeshes"],xa=["parentRoot","iCamera","iModel"];function Ko(c,e){if(e)for(const i of Object.keys(e))xa.includes(i)||i.startsWith("__")||typeof c[i]!="function"&&typeof e[i]!="function"&&(c[i]=e[i]);return c}var Zl,xl=new Uint8Array(16);function yo(){if(!Zl&&!(Zl=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Zl(xl)}for(var Dl=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,Lo=function(c){return typeof c=="string"&&Dl.test(c)},Hs=[],Yl=0;Yl<256;++Yl)Hs.push((Yl+256).toString(16).substr(1));var Ho=function(c,e,i){var s=(c=c||{}).random||(c.rng||yo)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e){i=i||0;for(var a=0;a<16;++a)e[i+a]=s[a];return e}return function(h){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,k=(Hs[h[f+0]]+Hs[h[f+1]]+Hs[h[f+2]]+Hs[h[f+3]]+"-"+Hs[h[f+4]]+Hs[h[f+5]]+"-"+Hs[h[f+6]]+Hs[h[f+7]]+"-"+Hs[h[f+8]]+Hs[h[f+9]]+"-"+Hs[h[f+10]]+Hs[h[f+11]]+Hs[h[f+12]]+Hs[h[f+13]]+Hs[h[f+14]]+Hs[h[f+15]]).toLowerCase();if(!Lo(k))throw TypeError("Stringified UUID is invalid");return k}(s)};const Fl=new Map;function Io(c,e){return(i,s)=>{const a=i.constructor;if(a===Object)throw new Error("All properties in an object are serialized by default");Fl.has(a)||Fl.set(a,[]);const h=Fl.get(a);if(!(h.findIndex(f=>f.propKey===s)<0))throw new Error(`Property ${s} already has a uiConfig decorator`);h.push({params:e||{},propKey:s,uiType:c})}}function Jr(c,e){return Io("checkbox",{label:c,params:e})}function qp(c,e){return Io("monitor",{label:c,params:e})}function Xr(c,e,i,s){return Io("slider",{label:c,bounds:e,stepSize:i,params:s})}function Qo(c,e,i,s){return Io("vec",{label:c,bounds:e,stepSize:i,params:s})}function vu(c,e,i){return Io("dropdown",{label:c,children:e,params:i})}function Ao(c,e){return Io("button",{label:c,params:e})}function so(c,e){return Io("input",{label:c,params:e})}function op(c,e){return Io("color",{label:c,params:e})}function Ku(c,e){return Io("image",{label:c,params:e})}function Ap(c){let e=c==null?void 0:c.constructor;if(!c||!e)return[];const i=[],s=[];for(;e&&e!==Object;)s.push(e),e=Object.getPrototypeOf(e);return s.reverse().forEach(a=>{var h;(h=Fl.get(a))===null||h===void 0||h.forEach(({params:f,propKey:k,uiType:et})=>{var tt;let rt;if(et||(rt=(tt=c[k])===null||tt===void 0?void 0:tt.uiConfig),rt||(rt={property:[c,k],type:et||"input"}),f){const lt=typeof f.params=="function"?f.params(c):f.params||{};delete f.params,Object.assign(rt,{...f,...lt})}i.push(rt)})}),i}function Yp(c,e,i={}){return{type:"folder",label:c,children:Ap(e),uuid:Ho(),...i}}function Ws(c,e){return i=>class extends i{constructor(){super(...arguments),this.uiConfig=Yp(c,this,e||{})}}}const fA={type:"change"},w_={type:"start"},Vv={type:"end"};class Qv extends d.pBf{constructor(e,i){super(),this.object=e,this.domElement=i,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new d.Pa4,this.minDistance=.01,this.maxDistance=1/0,this.autoPushTarget=!0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.maxZoomSpeed=1,this.dollyZoom=!1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:d.RsA.ROTATE,MIDDLE:d.RsA.DOLLY,RIGHT:d.RsA.PAN},this.touches={ONE:d.QmN.ROTATE,TWO:d.QmN.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return k.phi},this.getAzimuthalAngle=function(){return k.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(cr){cr.addEventListener("keydown",Ys),this._domElementKeyEvents=cr},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(fA),s.update(),h=a.NONE},this.update=function(){const cr=new d.Pa4,Nr=new d._fP().setFromUnitVectors(e.up,new d.Pa4(0,1,0)),Fr=Nr.clone().invert(),Ks=new d.Pa4,Xo=new d._fP,mn=2*Math.PI;return function(){const Nn=s.object.position;cr.copy(Nn).sub(s.target),cr.applyQuaternion(Nr),k.setFromVector3(cr),s.autoRotate&&h===a.NONE&&tn(2*Math.PI/60/60*s.autoRotateSpeed),s.enableDamping?(k.theta+=et.theta*s.dampingFactor,k.phi+=et.phi*s.dampingFactor):(k.theta+=et.theta,k.phi+=et.phi);let vn=s.minAzimuthAngle,Qn=s.maxAzimuthAngle;isFinite(vn)&&isFinite(Qn)&&(vn<-Math.PI?vn+=mn:vn>Math.PI&&(vn-=mn),Qn<-Math.PI?Qn+=mn:Qn>Math.PI&&(Qn-=mn),k.theta=vn<=Qn?Math.max(vn,Math.min(Qn,k.theta)):k.theta>(vn+Qn)/2?Math.max(vn,k.theta):Math.min(Qn,k.theta)),k.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,k.phi)),k.makeSafe(),Math.abs(et.radius)>0&&(s.dollyZoom&&(s.object.zoom=Math.max(Math.max(s.minZoom,.1),Math.min(Math.min(s.maxZoom,20),s.object.zoom*(1+et.radius*(s.enableDamping?s.dampingFactor:1)))),s.object.updateProjectionMatrix(),(s.object.zoom>=Math.min(s.maxZoom,20)||s.object.zoom<=Math.max(s.minZoom,.1))&&(et.radius=0)),k.radius*=1+et.radius*(s.enableDamping?s.dampingFactor:1)),Math.abs(tt-1)>1e-5&&(s.dollyZoom&&(s.object.zoom=Math.max(Math.max(s.minZoom,.1),Math.min(Math.min(s.maxZoom,20),s.object.zoom*tt)),s.object.updateProjectionMatrix(),(s.object.zoom>=Math.min(s.maxZoom,20)||s.object.zoom<=Math.max(s.minZoom,.1))&&(tt=1)),k.radius*=tt);let Zn=0;s.autoPushTarget&&k.radius<s.minDistance&&(Zn=s.minDistance-k.radius),k.radius=Math.max(s.minDistance,Math.min(s.maxDistance,k.radius)),s.enableDamping===!0?s.target.addScaledVector(rt,s.dampingFactor):s.target.add(rt),cr.setFromSpherical(k),cr.applyQuaternion(Fr),Nn.copy(s.target).add(cr),s.target.add(cr.normalize().multiplyScalar(-Zn)),s.object.lookAt(s.target);let Vn=!1;return s.enableDamping===!0&&Math.abs(et.theta)+Math.abs(et.phi)+Math.abs(et.radius)+rt.length()>.001?(et.theta*=1-s.dampingFactor,et.phi*=1-s.dampingFactor,et.radius*=1-s.dampingFactor,rt.multiplyScalar(1-s.dampingFactor),Vn=!0):(et.set(0,0,0),rt.set(0,0,0)),tt=1,!!(lt||Vn||Ks.distanceToSquared(s.object.position)>f||8*(1-Xo.dot(s.object.quaternion))>f)&&(s.dispatchEvent(fA),Ks.copy(s.object.position),Xo.copy(s.object.quaternion),lt=!1,!0)}}(),this.stopDamping=function(){et.set(0,0,0),rt.set(0,0,0)},this.dispose=function(){s.domElement.removeEventListener("contextmenu",po),s.domElement.removeEventListener("pointerdown",kr),s.domElement.removeEventListener("pointercancel",hs),s.domElement.removeEventListener("wheel",_r),s.domElement.removeEventListener("pointermove",Br),s.domElement.removeEventListener("pointerup",Ur),s._domElementKeyEvents!==null&&s._domElementKeyEvents.removeEventListener("keydown",Ys)};const s=this,a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let h=a.NONE;const f=1e-6,k=new d.$V,et=new d.$V(0,0,0);let tt=1;const rt=new d.Pa4;let lt=!1;const pt=new d.FM8,ft=new d.FM8,vt=new d.FM8,yt=new d.FM8,Mt=new d.FM8,xt=new d.FM8,Et=new d.FM8,At=new d.FM8,Rt=new d.FM8,Bt=[],Qt={};function Wt(){return s.enableDamping?1:Math.pow(.95,s.zoomSpeed)}function tn(cr){et.theta-=cr}function pn(cr){et.phi-=cr}this.rotateUp=pn,this.rotateLeft=tn;const yn=function(){const cr=new d.Pa4;return function(Nr,Fr){cr.setFromMatrixColumn(Fr,0),cr.multiplyScalar(-Nr),rt.add(cr)}}(),En=function(){const cr=new d.Pa4;return function(Nr,Fr){s.screenSpacePanning===!0?cr.setFromMatrixColumn(Fr,1):(cr.setFromMatrixColumn(Fr,0),cr.crossVectors(s.object.up,cr)),cr.multiplyScalar(Nr),rt.add(cr)}}(),wn=function(){const cr=new d.Pa4;return function(Nr,Fr){const Ks=s.domElement;if(s.object.isPerspectiveCamera){const Xo=s.object.position;cr.copy(Xo).sub(s.target);let mn=cr.length();mn*=Math.tan(s.object.fov/2*Math.PI/180),yn(2*Nr*mn/Ks.clientHeight,s.object.matrix),En(2*Fr*mn/Ks.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(yn(Nr*(s.object.right-s.object.left)/s.object.zoom/Ks.clientWidth,s.object.matrix),En(Fr*(s.object.top-s.object.bottom)/s.object.zoom/Ks.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function In(cr,Nr=0){s.object.isPerspectiveCamera?(tt/=cr,et.radius=Math.max(-s.maxZoomSpeed,Math.min(s.maxZoomSpeed,et.radius-Nr))):s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*cr)),s.object.updateProjectionMatrix(),lt=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function xn(cr,Nr=0){s.object.isPerspectiveCamera?(tt*=cr,et.radius=Math.max(-s.maxZoomSpeed,Math.min(s.maxZoomSpeed,et.radius+Nr))):s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/cr)),s.object.updateProjectionMatrix(),lt=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function Cn(cr){pt.set(cr.clientX,cr.clientY)}function Fn(cr){yt.set(cr.clientX,cr.clientY)}function Tn(){if(Bt.length===1)pt.set(Bt[0].pageX,Bt[0].pageY);else{const cr=.5*(Bt[0].pageX+Bt[1].pageX),Nr=.5*(Bt[0].pageY+Bt[1].pageY);pt.set(cr,Nr)}}function Wn(){if(Bt.length===1)yt.set(Bt[0].pageX,Bt[0].pageY);else{const cr=.5*(Bt[0].pageX+Bt[1].pageX),Nr=.5*(Bt[0].pageY+Bt[1].pageY);yt.set(cr,Nr)}}function or(){const cr=Bt[0].pageX-Bt[1].pageX,Nr=Bt[0].pageY-Bt[1].pageY,Fr=Math.sqrt(cr*cr+Nr*Nr);Et.set(0,Fr)}function fr(cr){if(Bt.length==1)ft.set(cr.pageX,cr.pageY);else{const Fr=Jo(cr),Ks=.5*(cr.pageX+Fr.x),Xo=.5*(cr.pageY+Fr.y);ft.set(Ks,Xo)}vt.subVectors(ft,pt).multiplyScalar(s.rotateSpeed);const Nr=s.domElement;tn(2*Math.PI*vt.x/Nr.clientHeight),pn(2*Math.PI*vt.y/Nr.clientHeight),pt.copy(ft)}function rr(cr){if(Bt.length===1)Mt.set(cr.pageX,cr.pageY);else{const Nr=Jo(cr),Fr=.5*(cr.pageX+Nr.x),Ks=.5*(cr.pageY+Nr.y);Mt.set(Fr,Ks)}xt.subVectors(Mt,yt).multiplyScalar(s.panSpeed),wn(xt.x,xt.y),yt.copy(Mt)}function Ir(cr){const Nr=Jo(cr),Fr=cr.pageX-Nr.x,Ks=cr.pageY-Nr.y,Xo=Math.sqrt(Fr*Fr+Ks*Ks);At.set(0,Xo),Rt.set(0,Math.pow(At.y/Et.y,s.zoomSpeed)),In(Rt.y),Et.copy(At)}function kr(cr){s.enabled!==!1&&(Bt.length===0&&(s.domElement.setPointerCapture(cr.pointerId),s.domElement.addEventListener("pointermove",Br),s.domElement.addEventListener("pointerup",Ur)),function(Nr){Bt.push(Nr)}(cr),cr.pointerType==="touch"?function(Nr){switch(ko(Nr),Bt.length){case 1:switch(s.touches.ONE){case d.QmN.ROTATE:if(s.enableRotate===!1)return;Tn(),h=a.TOUCH_ROTATE;break;case d.QmN.PAN:if(s.enablePan===!1)return;Wn(),h=a.TOUCH_PAN;break;default:h=a.NONE}break;case 2:switch(s.touches.TWO){case d.QmN.DOLLY_PAN:if(s.enableZoom===!1&&s.enablePan===!1)return;s.enableZoom&&or(),s.enablePan&&Wn(),h=a.TOUCH_DOLLY_PAN;break;case d.QmN.DOLLY_ROTATE:if(s.enableZoom===!1&&s.enableRotate===!1)return;s.enableZoom&&or(),s.enableRotate&&Tn(),h=a.TOUCH_DOLLY_ROTATE;break;default:h=a.NONE}break;default:h=a.NONE}h!==a.NONE&&s.dispatchEvent(w_)}(cr):function(Nr){let Fr;switch(Nr.button){case 0:Fr=s.mouseButtons.LEFT;break;case 1:Fr=s.mouseButtons.MIDDLE;break;case 2:Fr=s.mouseButtons.RIGHT;break;default:Fr=-1}switch(Fr){case d.RsA.DOLLY:if(s.enableZoom===!1)return;(function(Ks){Et.set(Ks.clientX,Ks.clientY)})(Nr),h=a.DOLLY;break;case d.RsA.ROTATE:if(Nr.ctrlKey||Nr.metaKey||Nr.shiftKey){if(s.enablePan===!1)return;Fn(Nr),h=a.PAN}else{if(s.enableRotate===!1)return;Cn(Nr),h=a.ROTATE}break;case d.RsA.PAN:if(Nr.ctrlKey||Nr.metaKey||Nr.shiftKey){if(s.enableRotate===!1)return;Cn(Nr),h=a.ROTATE}else{if(s.enablePan===!1)return;Fn(Nr),h=a.PAN}break;default:h=a.NONE}h!==a.NONE&&s.dispatchEvent(w_)}(cr))}function Br(cr){s.enabled!==!1&&(cr.pointerType==="touch"?function(Nr){switch(ko(Nr),h){case a.TOUCH_ROTATE:if(s.enableRotate===!1)return;fr(Nr),s.update();break;case a.TOUCH_PAN:if(s.enablePan===!1)return;rr(Nr),s.update();break;case a.TOUCH_DOLLY_PAN:if(s.enableZoom===!1&&s.enablePan===!1)return;(function(Fr){s.enableZoom&&Ir(Fr),s.enablePan&&rr(Fr)})(Nr),s.update();break;case a.TOUCH_DOLLY_ROTATE:if(s.enableZoom===!1&&s.enableRotate===!1)return;(function(Fr){s.enableZoom&&Ir(Fr),s.enableRotate&&fr(Fr)})(Nr),s.update();break;default:h=a.NONE}}(cr):function(Nr){switch(h){case a.ROTATE:if(s.enableRotate===!1)return;(function(Fr){ft.set(Fr.clientX,Fr.clientY),vt.subVectors(ft,pt).multiplyScalar(s.rotateSpeed);const Ks=s.domElement;tn(2*Math.PI*vt.x/Ks.clientHeight),pn(2*Math.PI*vt.y/Ks.clientHeight),pt.copy(ft),s.update()})(Nr);break;case a.DOLLY:if(s.enableZoom===!1)return;(function(Fr){At.set(Fr.clientX,Fr.clientY),Rt.subVectors(At,Et),Rt.y>0?In(Wt()):Rt.y<0&&xn(Wt()),Et.copy(At),s.update()})(Nr);break;case a.PAN:if(s.enablePan===!1)return;(function(Fr){Mt.set(Fr.clientX,Fr.clientY),xt.subVectors(Mt,yt).multiplyScalar(s.panSpeed),wn(xt.x,xt.y),yt.copy(Mt),s.update()})(Nr)}}(cr))}function Ur(cr){Xs(cr),Bt.length===0&&(s.domElement.releasePointerCapture(cr.pointerId),s.domElement.removeEventListener("pointermove",Br),s.domElement.removeEventListener("pointerup",Ur)),s.dispatchEvent(Vv),h=a.NONE}function hs(cr){Xs(cr)}function _r(cr){s.enabled!==!1&&s.enableZoom!==!1&&h===a.NONE&&(cr.preventDefault(),s.dispatchEvent(w_),function(Nr){let Fr=0;switch(Nr.deltaMode){case 2:Fr+=1*Nr.deltaY;break;case 1:Fr+=.4*Nr.deltaY;break;default:Fr+=.01*Nr.deltaY}Nr.deltaY<0?xn(1,Fr*s.zoomSpeed):Nr.deltaY>0&&In(1,-Fr*s.zoomSpeed),s.update()}(cr),s.dispatchEvent(Vv))}function Ys(cr){s.enabled!==!1&&s.enablePan!==!1&&function(Nr){let Fr=!1;switch(Nr.code){case s.keys.UP:wn(0,s.keyPanSpeed),Fr=!0;break;case s.keys.BOTTOM:wn(0,-s.keyPanSpeed),Fr=!0;break;case s.keys.LEFT:wn(s.keyPanSpeed,0),Fr=!0;break;case s.keys.RIGHT:wn(-s.keyPanSpeed,0),Fr=!0}Fr&&(Nr.preventDefault(),s.update())}(cr)}function po(cr){s.enabled!==!1&&cr.preventDefault()}function Xs(cr){delete Qt[cr.pointerId];for(let Nr=0;Nr<Bt.length;Nr++)if(Bt[Nr].pointerId==cr.pointerId)return void Bt.splice(Nr,1)}function ko(cr){let Nr=Qt[cr.pointerId];Nr===void 0&&(Nr=new d.FM8,Qt[cr.pointerId]=Nr),Nr.set(cr.pageX,cr.pageY)}function Jo(cr){const Nr=cr.pointerId===Bt[0].pointerId?Bt[1]:Bt[0];return Qt[Nr.pointerId]}this.zoomIn=function(cr){In(1,cr*s.zoomSpeed)},this.zoomOut=function(cr){xn(1,cr*s.zoomSpeed)},s.domElement.addEventListener("contextmenu",po),s.domElement.addEventListener("pointerdown",kr),s.domElement.addEventListener("pointercancel",hs),s.domElement.addEventListener("wheel",_r,{passive:!1}),this.update()}}var Wo=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};let No=class extends Qv{constructor(){super(...arguments),this.type="OrbitControls",this.enabled=!0,this.dollyZoom=!1,this.enableDamping=!0,this.dampingFactor=.08,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableZoom=!0,this.zoomSpeed=.15,this.maxZoomSpeed=.2,this.enableRotate=!0,this.rotateSpeed=2,this.enablePan=!0,this.panSpeed=1,this.autoPushTarget=!1,this.minDistance=.35,this.maxDistance=1e3,this.minZoom=.01,this.maxZoom=1e3,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1e4,this.maxAzimuthAngle=1e4,this.screenSpacePanning=!0,this.keyPanSpeed=7}zoomIn(c){super.zoomIn(c)}zoomOut(c){super.zoomOut(c)}dispatchEvent(c){super.dispatchEvent(c)}};Wo([jn()],No.prototype,"type",void 0),Wo([Jr()],No.prototype,"enabled",void 0),Wo([Jr(),jn()],No.prototype,"dollyZoom",void 0),Wo([Jr(),jn()],No.prototype,"enableDamping",void 0),Wo([so(),jn()],No.prototype,"dampingFactor",void 0),Wo([Jr(),jn()],No.prototype,"autoRotate",void 0),Wo([so(),jn()],No.prototype,"autoRotateSpeed",void 0),Wo([Jr(),jn()],No.prototype,"enableZoom",void 0),Wo([so(),jn()],No.prototype,"zoomSpeed",void 0),Wo([so(),jn()],No.prototype,"maxZoomSpeed",void 0),Wo([Jr(),jn()],No.prototype,"enableRotate",void 0),Wo([so(),jn()],No.prototype,"rotateSpeed",void 0),Wo([Jr(),jn()],No.prototype,"enablePan",void 0),Wo([so(),jn()],No.prototype,"panSpeed",void 0),Wo([so(),jn()],No.prototype,"autoPushTarget",void 0),Wo([so(),jn()],No.prototype,"minDistance",void 0),Wo([so(),jn()],No.prototype,"maxDistance",void 0),Wo([so(),jn()],No.prototype,"minZoom",void 0),Wo([so(),jn()],No.prototype,"maxZoom",void 0),Wo([so(),jn()],No.prototype,"minPolarAngle",void 0),Wo([so(),jn()],No.prototype,"maxPolarAngle",void 0),Wo([so(),jn()],No.prototype,"minAzimuthAngle",void 0),Wo([so(),jn()],No.prototype,"maxAzimuthAngle",void 0),Wo([jn()],No.prototype,"screenSpacePanning",void 0),Wo([jn()],No.prototype,"keyPanSpeed",void 0),No=Wo([Ws("Orbit Controls")],No);var hv=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};class wp extends j{constructor(e,i,s){super(),this._controlsMode="",this._isActiveCamera=!1,this.userData={},this._cameraObjectUpdate=f=>{this.setDirty(f)},this._interactionsEnabled=!0,this.autoLookAtTarget=!0,this.near=.01,this.far=50,this._options={type:"PerspectiveCamera",aspect:"auto",focus:10,fov:25,zoom:1,frustumSize:1,top:1,bottom:-1,left:-1,right:1,controlsMode:"orbit",controlsEnabled:!0},this._position=new d.Pa4(0,0,10),this._target=new d.Pa4(0,0,0),this._controlsCtors=new Map([["orbit",(f,k)=>{const et=new No(f,k.ownerDocument?k:k.documentElement);return et.screenSpacePanning=!0,et}]]),this._camUi=[{type:"vec3",label:"Position",property:[this,"position"],onChange:()=>this.positionUpdated(!0)},{type:"vec3",label:"Target",property:[this,"target"],onChange:()=>this.targetUpdated(!0)},{type:"slider",bounds:[1,180],label:"Field Of View",hidden:()=>!this._camera.modelObject.isPerspectiveCamera,property:[this._options,"fov"],onChange:()=>{this.refreshCameraOptions()},limitedUi:!0},{type:"slider",bounds:[.001,20],label:"Zoom",property:[this._options,"zoom"],onChange:()=>{this.refreshCameraOptions()}},()=>({type:"dropdown",label:"Controls Mode",property:[this._options,"controlsMode"],children:["","orbit","firstPerson","pointerLock",...this._controlsCtors.keys()].map(f=>({label:f===""?"none":f,value:f})),onChange:()=>{this.refreshCameraOptions()}})],this.uiConfig={type:"folder",label:"Camera",limitedUi:!0,children:[...this._camUi,()=>{var f;return(f=this._controls)===null||f===void 0?void 0:f.uiConfig},()=>{var f;return!((f=this._controls)===null||f===void 0)&&f.zoomIn?{type:"button",label:"Zoom in",value:()=>{var k;(k=this._controls)===null||k===void 0||k.zoomIn(1)}}:{}},()=>{var f;return!((f=this._controls)===null||f===void 0)&&f.zoomOut?{type:"button",label:"Zoom out",value:()=>{var k;(k=this._controls)===null||k===void 0||k.zoomOut(1)}}:{}}]},this.assetType="model",this.uuid=er(),this.setDirty=this.setDirty.bind(this),this.targetUpdated=this.targetUpdated.bind(this),this._refreshCameraOptions=this._refreshCameraOptions.bind(this),this._container=s??document.body;const a=i??this._options;this._camera=this._setCameraObject(e??(a.type==="OrthographicCamera"?new d.iKG(-1,1,1,-1):new d.cPb)),this._camera.modelObject.userData.iCamera=this;const h=e;e&&(h.isPerspectiveCamera?(a.fov=h.fov,a.focus=h.focus,a.aspect=h.aspect<=0||h.userData.autoAspect?"auto":h.aspect,a.zoom=h.zoom):h.isOrthographicCamera&&(a.left=h.left,a.right=h.right,a.top=h.top,a.bottom=h.bottom,a.zoom=h.zoom),a.near=h.near,a.far=h.far,this._position.copy(e.position),this.refreshTarget()),this.positionUpdated(!1),e||this.targetUpdated(!1),this.setCameraOptions(a)}get controls(){return this._controls}getControls(){return this._controls}get isActiveCamera(){return this._isActiveCamera}get target(){return this._target}set target(e){const i=this._target.sub(e).length()>1e-5;this._target.copy(e),i&&this.targetUpdated()}get position(){return this._position}set position(e){const i=this._position.sub(e).length()>1e-5;this._position.copy(e),i&&this.positionUpdated()}get name(){return this._camera.name}set name(e){this._camera.name=e}getCameraOptions(){return{...this._options,position:this._position.toArray(),target:this._target.toArray()}}setCameraOptions(e,i=!0){var s,a;const h={...e};!((s=h.position)===null||s===void 0)&&s.isVector3&&(h.position=[h.position.x,h.position.y,h.position.z]),!((a=h.target)===null||a===void 0)&&a.isVector3&&(h.target=[h.target.x,h.target.y,h.target.z]),Object.keys(h).forEach(f=>f!=="frustumSize"&&h[f]===void 0&&delete h[f]),Object.assign(this._options,h),this._refreshCameraOptions(!1),this.refreshCameraControls(!1),i&&this.setDirty()}_refreshCameraOptions(e=!0){let i=this._camera.modelObject;if(this._options.type!==i.type){const a=this._options.type==="PerspectiveCamera"?new d.cPb:new d.iKG;a.name=this._camera.name,a.near=this._camera.modelObject.near,a.far=this._camera.modelObject.far,a.zoom=this._camera.modelObject.zoom,a.scale.copy(this._camera.modelObject.scale);const h=this._isActiveCamera;h&&this.deactivateMain(),this._camera=this._setCameraObject(a),i=this._camera.modelObject,h&&this.activateMain(),this._camera.modelObject.updateProjectionMatrix()}let s=this._options.aspect;if(s==="auto"&&(s=this._container.clientWidth/this._container.clientHeight),this._options.position&&(this.position.set(...this._options.position),delete this._options.position),this._options.target&&(this.target.set(...this._options.target),delete this._options.target),this.positionTargetUpdated(!1),this._options.type==="PerspectiveCamera"&&(i.fov=this._options.fov,i.focus=this._options.focus,i.aspect=s),this._options.type==="OrthographicCamera"){const a=this._options.frustumSize;a!==void 0?(i.top=a/2,i.bottom=-a/2,i.left=s*a/2,i.right=-s*a/2):(i.top=this._options.top,i.bottom=this._options.bottom,i.left=this._options.left,i.right=this._options.right)}i.zoom=this._options.zoom,this._nearFarChanged(),e&&this.setDirty()}_setCameraObject(e){return this._camera&&this._camera.removeEventListener("objectUpdate",this._cameraObjectUpdate),this._camera=vs(e),this._camera.addEventListener("objectUpdate",this._cameraObjectUpdate),this._camera}get interactionsEnabled(){return this._interactionsEnabled&&this._isActiveCamera&&this._options.controlsEnabled}set interactionsEnabled(e){this._interactionsEnabled!==e&&(this._interactionsEnabled=e,this.refreshCameraControls(!0))}_nearFarChanged(){this._camera&&(this._camera.modelObject.near=this.near,this._camera.modelObject.far=this.far,this._camera.modelObject.updateProjectionMatrix())}refreshAspect(e=!0){this._options.aspect==="auto"&&this._refreshCameraOptions(e)}refreshTarget(){var e;!((e=this._controls)===null||e===void 0)&&e.enabled&&this._controls.target?this._target.copy(this._controls.target):this._target.set(0,0,-1).applyQuaternion(this._camera.modelObject.getWorldQuaternion(new d._fP))}setControlsCtor(e,i,s=!1){s||!this._controlsCtors.has(e)?this._controlsCtors.set(e,i):console.error(e+" already exists.")}removeControlsCtor(e){this._controlsCtors.delete(e)}_initCameraControls(){var e,i,s;const a=this._options.controlsMode;this._controls=(i=(e=this._controlsCtors.get(a))===null||e===void 0?void 0:e(this._camera.modelObject,this._container))!==null&&i!==void 0?i:void 0,this._controls||console.error("Unable to create controls with mode "+a+". Are you missing a plugin?"),(s=this._controls)===null||s===void 0||s.addEventListener("change",this.setDirty),this._controlsMode=this._controls?a:""}_disposeCameraControls(){var e,i;this._controlsMode,(e=this._controls)===null||e===void 0||e.removeEventListener("change",this.setDirty),(i=this._controls)===null||i===void 0||i.dispose(),this._controlsMode="",this._controls=void 0}refreshCameraControls(e=!0){var i,s;if(this._options.controlsEnabled){const a=this._options.controlsMode;this._controls?this._controlsMode===a&&this._camera.modelObject===this._controls.object||(this._disposeCameraControls(),this._initCameraControls()):this._initCameraControls(),this._controlsMode=a}if(this._controls){const a=this.interactionsEnabled;this._controls.enabled=a,a&&this._camera.modelObject.up.copy(d.Tme.DefaultUp)}e&&this.setDirty(),(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)}setDirty(e){this._position.copy(this._camera.modelObject.position),this._controls&&this._controls.enabled&&this._controls.target&&this._target.copy(this._controls.target),this._camera.modelObject.fov!==void 0&&(this._options.fov=this._camera.modelObject.fov),this._camera.modelObject.focus!==void 0&&(this._options.focus=this._camera.modelObject.focus),this._camera.modelObject.zoom!==void 0&&(this._options.zoom=this._camera.modelObject.zoom),this.dispatchEvent({...e,type:"update"}),this._camUi.forEach(i=>{var s;return(s=i==null?void 0:i.uiRefresh)===null||s===void 0?void 0:s.call(i,"postFrame",!1,1)})}activateMain(e=!0){var i,s;this._isActiveCamera||(this._isActiveCamera=!0,this._camera.modelObject.userData.__lastScale=this._camera.modelObject.scale.clone(),this._camera.modelObject.scale.divide(this._camera.modelObject.getWorldScale(new d.Pa4)),e&&(this.refreshCameraControls(!0),this.refreshAspect()),(s=(i=this._camera).setDirty)===null||s===void 0||s.call(i,{change:"activateMain"}))}deactivateMain(e=!0){this._isActiveCamera&&(this._isActiveCamera=!1,this._camera.modelObject.userData.__lastScale&&(this._camera.modelObject.scale.copy(this._camera.modelObject.userData.__lastScale),delete this._camera.modelObject.userData.__lastScale),e&&this.refreshCameraControls(!0))}get cameraObject(){return this._camera.modelObject}get modelObject(){return this._camera.modelObject}dispose(){this._disposeCameraControls()}targetUpdated(e=!0){var i,s;const a=this.target;(s=(i=this._controls)===null||i===void 0?void 0:i.target)===null||s===void 0||s.set(a.x,a.y,a.z),this._controls&&this._controls.enabled&&this._controls.target?e&&this.setDirty():this._camera&&(this.autoLookAtTarget&&this._camera.modelObject.lookAt(a),e&&this.setDirty())}positionUpdated(e=!0){const i=this.position;this._camera.modelObject.position.set(i.x,i.y,i.z),e&&this.setDirty()}positionTargetUpdated(e=!0){this.positionUpdated(!1),this.targetUpdated(e)}copyFromCamera(e,i=4){e.getWorldPosition(this._position),e.getWorldDirection(this._target).multiplyScalar(i).add(this._position),this.positionTargetUpdated(!1),this.setCameraOptions({fov:e.fov,focus:e.focus,zoom:e.zoom,type:e.type},!0)}updateShaderProperties(e){var i;return!((i=e.uniforms.cameraPositionWorld)===null||i===void 0)&&i.value&&this._camera.modelObject.getWorldPosition(e.uniforms.cameraPositionWorld.value),e.uniforms.cameraNearFar?e.uniforms.cameraNearFar.value.set(this._camera.modelObject.near,this._camera.modelObject.far):console.warn("BaseRenderer: no uniform: cameraNearFar"),e.uniforms.projection&&(e.uniforms.projection.value=this._camera.modelObject.projectionMatrix),e.defines.PERSPECTIVE_CAMERA=this._camera.modelObject.type==="PerspectiveCamera"?"1":"0",e.defines.ORTHOGRAPHIC_CAMERA=this._camera.modelObject.type==="OrthographicCamera"?"1":"0",this}toJSON(e){return Object.assign({},Wr(this,!0,e))}fromJSON(e,i){return os(e,this,!0,i),this.positionTargetUpdated(!1),this.refreshCameraOptions(),this.setDirty(),this}refreshCameraOptions(e=!0){this.setCameraOptions(this._options,e)}get visible(){return!0}set visible(e){console.error("Cannot set visible on camera",e)}}hv([jn("camControls")],wp.prototype,"_controls",void 0),hv([jn()],wp.prototype,"userData",void 0),hv([hn(wp.prototype._nearFarChanged)],wp.prototype,"near",void 0),hv([hn(wp.prototype._nearFarChanged)],wp.prototype,"far",void 0),hv([jn("camOptions")],wp.prototype,"_options",void 0),hv([jn("position")],wp.prototype,"_position",void 0),hv([jn("target")],wp.prototype,"_target",void 0);var mA=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};class x_ extends d.xsS{constructor(e){super(),this.isRootScene=!0,this.assetType="model",this._sceneBounds=new sr,this._sceneBoundingRadius=0,this._cameras=[],this._activeCamera=-1,this.envMapIntensity=1,this._dummyCam=new wp(new d.cPb,{controlsMode:"",controlsEnabled:!1}),this.environment=null,this.background=null,this.minNearDistance=.2,this.setDirty=this.setDirty.bind(this),this.updateScene=this.updateScene.bind(this),this.refreshActiveCameraNearFar=this.refreshActiveCameraNearFar.bind(this),this._activeCameraUpdate=this._activeCameraUpdate.bind(this),this._onSceneMaterialUpdate=this._onSceneMaterialUpdate.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this.addEventListener("materialUpdate",this._onSceneMaterialUpdate),this.addEventListener("objectUpdate",this._onSceneUpdate),this.defaultCamera=e,this.modelRoot=vs(new d.ZAu,void 0),this.modelRoot.userData.rootSceneModelRoot=!0,this.modelRoot.name="Scene",this.modelRoot.addEventListener("update",this.setDirty),this.addSceneObject(this.modelRoot,{addToRoot:!0,autoScale:!1}),this.addSceneObject(this.defaultCamera,{addToRoot:!0}),this.activeCamera=this.defaultCamera,this.boxHelper=new d.GQ(this.getBounds())}refreshEnvMapIntensity(e){return e!=null&&e.isObject3D||(e=this),(e??this).traverse(i=>{(Array.isArray(i.material)?i.material:[i.material]).forEach(s=>{s&&s.envMapIntensity!==void 0&&!s.userData.separateEnvMapIntensity&&(s.envMapIntensity=this.envMapIntensity,s.needsUpdate=!0)})}),this.setDirty(),this}get activeCamera(){return this._activeCamera>=0?this._cameras[this._activeCamera]:this._dummyCam}set activeCamera(e){const i=this.activeCamera;if(e||(e=this.defaultCamera),i!==e){if(i&&(i.deactivateMain(),i.removeEventListener("update",this._activeCameraUpdate)),e){e.activateMain(),e.addEventListener("update",this._activeCameraUpdate);let s=this._cameras.indexOf(e);s<0&&(this._cameras.push(e),s=this._cameras.length-1),this._activeCamera=s}else this._activeCamera=-1;this.dispatchEvent({type:"activeCameraChange",lastCamera:i,camera:e}),this.setDirty()}}get modelObject(){return this}addModel(e,i={}){return e.assetType!=="model"&&console.error("Invalid asset type for ",e,", adding anyway"),this.addSceneObject(e,i)}addWidget(e,i={}){e.assetType!=="widget"&&console.warn("Invalid asset type for ",e,", adding anyway"),this.add(e.modelObject)}_addModel(e,i={}){return this._addObject3D(e==null?void 0:e.modelObject,i)}addSceneObject(e,i){if(!e)return e;const s=e.assetType;let a=!1;switch(s){case"model":a=e.modelObject.isCamera,a&&(i={...i,autoScale:!1}),this._addModel(e,i);break;case"material":break;case"texture":this.dispatchEvent({type:"textureAdded",texture:e});break;case"light":this._addLight(e,i);break;default:console.warn("Unknown asset imported",e,s)}return this.dispatchEvent({type:"addSceneObject",object:e}),e}_addObject3D(e,{autoScale:i=!0,autoScaleRadius:s=2,addToRoot:a=!1}={}){const h=e;h?(i&&!h.userData.autoScaled&&Rs(h,h.userData.autoScaleRadius||s),h.traverse(f=>{f.isMesh&&!f.userData.__keepShadowDef&&(f.castShadow=!0,f.receiveShadow=!0,f.userData.__keepShadowDef=!0)}),this.refreshEnvMapIntensity(h),a?this.modelObject.add(h):this.modelRoot.add(h),this.setDirty()):console.error("Invalid Model, cannot add.")}removeSceneModels(){this.modelRoot.clear(),this.modelRoot.children=[],this.setDirty({sceneUpdate:!0})}disposeSceneModels(){this.modelRoot.children.forEach(e=>{var i,s;((i=e.dispose)!==null&&i!==void 0?i:(s=e.modelObject)===null||s===void 0?void 0:s.removeFromParent)()}),this.setDirty({sceneUpdate:!0})}_onEnvironmentChange(){this.dispatchEvent({type:"environmentChanged",environment:this.getEnvironment()}),this._onSceneUpdate()}add(...e){return super.add(...e.map(i=>vs(i))),this._onSceneUpdate(),this}setEnvironment(e){if(!e)return this.environment=null,this.dispatchEvent({type:"environmentChanged"}),void this._onSceneUpdate();if((e==null?void 0:e.assetType)!=="texture")return void console.error("Unknown Environment type",e);e.mapping===d.xfE&&(e.mapping=d.dSO,e.needsUpdate=!0);const i=e.textureObject||e;this.environment=i,this._onEnvironmentChange()}getEnvironment(){return this.environment}setBackground(e){var i;let s;if(!e||e.assetType==="texture"||e.isColor||e.isVector4)s=((i=e)===null||i===void 0?void 0:i.assetType)==="texture"&&e.textureObject||e;else{if(typeof e!="string"&&typeof e!="number")return void console.error("Unknown Background type",e);s=new d.Ilk(e)}this.background=s,this._onSceneUpdate({geometryChanged:!1})}getBackground(){return this.background}setDirty(e){return e!=null&&e.sceneUpdate?this._onSceneUpdate(e):this.dispatchEvent({type:"update"}),this}updateScene(e){return this._onSceneUpdate(e)}_activeCameraUpdate(){this.setDirty(),this.refreshActiveCameraNearFar(),this.dispatchEvent({type:"activeCameraUpdate"})}_onSceneUpdate(e={}){var i,s,a;return e.sceneUpdate===!1?this.setDirty(e):(this.refreshActiveCameraNearFar(),this._sceneBounds=this.getBounds(!1,!0),(a=(s=(i=this.boxHelper)===null||i===void 0?void 0:i.box)===null||s===void 0?void 0:s.copy)===null||a===void 0||a.call(s,this._sceneBounds),this._sceneBoundingRadius=this._sceneBounds.getSize(new d.Pa4).length()/2,this.dispatchEvent({...e,type:"sceneUpdate",hierarchyChanged:["addedToParent","removedFromParent"].includes(e.change||"")}),this)}_onSceneMaterialUpdate(){this.dispatchEvent({type:"sceneMaterialUpdate"})}dispose(){this.clear()}findObjectsByName(e,i){const s=[];return(i??this.modelObject).traverse(a=>{a.name===e&&s.push(a)}),s}addLight(e,i={}){this.addSceneObject(e,i)}_addLight(e,{addToRoot:i=!1}={}){var s;const a=e.lightObject;a&&((s=a.children)===null||s===void 0||s.length,i?this.add(a):this.modelRoot.add(a))}getBounds(e=!1,i=!0){return new sr().expandByObject(this.modelObject,e,i)}refreshActiveCameraNearFar(){const e=this.activeCamera;if(!e)return;const i=this.getBounds(!1),s=e.cameraObject.getWorldPosition(new d.Pa4).sub(i.getCenter(new d.Pa4)),a=1.5*i.getSize(new d.Pa4).length()/2,h=s.length(),f=Math.max(this.minNearDistance,h-a),k=Math.max(f+1,h+a);e.near=f,e.far=k}updateShaderProperties(e){return e.uniforms.sceneBoundingRadius?e.uniforms.sceneBoundingRadius.value=this._sceneBoundingRadius:console.warn("BaseRenderer: no uniform: frameCount"),this}toJSON(e){return Wr(this,!0,e)}fromJSON(e,i){const s=e.environment;return s!==void 0&&(this.setEnvironment(os(s,this.getEnvironment(),!1,i)),delete e.environment),os(e,this,!0,i),e.environment=s,this}addEventListener(e,i){super.addEventListener(e,i)}removeEventListener(e,i){super.removeEventListener(e,i)}}function b_(){const c=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return c.style.display="block",c}function w0(c,e){const i=e||"/";return c.join(i)}function Du(c,e){const i=window.URL.createObjectURL(c),s=document.createElement("a");s.style.display="none",s.href=i,s.download=e,document.body.appendChild(s),s.click(),setTimeout(()=>{document.body.removeChild(s),window.URL.revokeObjectURL(i)},1e3)}async function _u(c){return new Promise((e,i)=>{const s=new FileReader;s.onload=a=>e(s.result),s.onerror=a=>i(s.error),s.onabort=a=>i(new Error("Read aborted")),s.readAsDataURL(c)})}function Xp(c,e){return Du(c,e??c.name)}async function E_(c=!1,e=!1,i){const s=document.createElement("input");s.type="file",s.multiple=c,s.accept=i||"*",s.webkitdirectory=e,s.style.display="none",document.body.appendChild(s),s.click();const a=await new Promise(h=>{s.onchange=f=>{h(Array.from(s.files||[]))}});return document.body.removeChild(s),a}function El({innerHTML:c="",id:e,classList:i,addToBody:s=!0,elementTag:a="div"}){const h=document.createElement(a);return e&&(h.id=e),h.innerHTML=c,i&&h.classList.add(...i),s&&document.body.appendChild(h),h}async function gA(c){return new Promise((e,i)=>{const s=new Image;s.onload=()=>e(s),s.onerror=i,s.crossOrigin="anonymous",s.decoding="sync",s.src=c})}function Gv(c){const e=document.createElement("style");return e.type="text/css",e.innerText=c,document.head.appendChild(e),e}async function v1(c){return new Promise((e,i)=>{const s=document.createElement("script");s.setAttribute("src",c),s.addEventListener("load",e),s.addEventListener("error",i),document.body.appendChild(s)})}function S_(c,e=8192,i=!1){var s;if(!c.width||!c.height)return"";const a=document.createElement("canvas");a.width=Math.min(e,c.width),a.height=Math.floor(1+a.width*c.height/c.width);const h=c instanceof ImageBitmap,f=h&&i&&Math.abs(a.width-c.width)<.5?a.getContext("bitmaprenderer"):void 0;f?f.transferFromImageBitmap(c):(s=a.getContext("2d"))===null||s===void 0||s.drawImage(c,0,0,a.width,a.height);const k=a.toDataURL("image/png");return a.remove(),h&&i&&c.close(),k}async function Am(c){return new Promise((e,i)=>{const s=new Image;s.addEventListener("load",()=>{const a=document.createElement("canvas");a.width=s.width,a.height=s.height;const h=a.getContext("2d");if(!h)return void i(new Error("Could not get 2d context"));h.drawImage(s,0,0,a.width,a.height);const f=h.getImageData(0,0,a.width,a.height);e(f),a.remove(),s.remove()},!1),s.addEventListener("error",a=>{s.remove(),i(a)},!1),s.src=c})}function mo(){return(typeof performance>"u"?Date:performance).now()}function Tw(){let c=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(c=!0),c;var e}function C_(c,e=null){var i;return(i=new URL(window.location.href).searchParams.get(c))!==null&&i!==void 0?i:e}function ap(c,e,i=!1){const s=new URLSearchParams(location.search);e==null?s.has(c)&&s.delete(c):s.set(c,e),i?window.location.search=s.toString():window.history.replaceState({},"","?"+s.toString())}function x0(c){return c.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}function Ru(c,{backgroundColor:e="",displayPixelRatio:i=1,width:s=512,height:a=512}){const h=document.createElement("canvas"),f=h.getContext("2d"),k=i,et=s,tt=a;return h.width=et*k,h.height=tt*k,h.style.width=`${et}`,h.style.height=`${tt}`,(e==null?void 0:e.length)>0&&(f.fillStyle=e,f.fillRect(0,0,h.width,h.height)),f.drawImage(c,0,0,h.width,h.height),h}mA([jn()],x_.prototype,"defaultCamera",void 0),mA([hn(x_.prototype.refreshEnvMapIntensity),jn()],x_.prototype,"envMapIntensity",void 0),mA([jn()],x_.prototype,"environment",void 0),ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(c,e){const i=new Uint8Array(this);e==null&&(e=i.length);const s=new ArrayBuffer(e-c),a=new Uint8Array(s);for(let h=0;h<a.length;h++)a[h]=i[h+c];return s});class ku{static ApplyMaterialExtensions(e,i,s,a){for(const h of s)this.ApplyMaterialExtension(e,i,h,a)}static ApplyMaterialExtension(e,i,s,a){var h,f;let k=(h=Ht(s.parsFragmentSnippet,a,e))!==null&&h!==void 0?h:"";k.length&&(i.fragmentShader=i.fragmentShader.replace(this.FragVoidMain,`
${k}
${this.FragVoidMain}`)),k=(f=Ht(s.parsVertexSnippet,a,e))!==null&&f!==void 0?f:"",k.length&&(i.vertexShader=i.vertexShader.replace(this.VertVoidMain,`
${k}
${this.VertVoidMain}`)),s.extraUniforms&&(i.uniforms=Object.assign(i.uniforms,s.extraUniforms)),s.shaderExtender&&s.shaderExtender(i,e,a),e.lastShader=i}static CacheKeyForExtensions(e,i){let s="";for(const a of i)s+=this.CacheKeyForExtension(e,a);return s}static CacheKeyForExtension(e,i){let s="";return i.customCacheKey&&(s+=i.customCacheKey),i.computeCacheKey&&(s+=i.computeCacheKey(e)),s}static RegisterExtensions(e,i){const s=[];if(i)for(const a of i)a.isCompatible&&a.isCompatible(e)&&(s.push(a),a.uuid||(a.uuid=Ho()),a.setDirty||(a.setDirty=()=>{a.updateVersion||(a.updateVersion=0),a.updateVersion++}));return e.materialExtensions=s,e.__ext_beforeRenderListen||(e.__ext_beforeRenderListen=!0,e.addEventListener("beforeRender",a=>function(h,{object:f,renderer:k}){var et;(et=h.materialExtensions)===null||et===void 0||et.forEach(tt=>{var rt,lt;(rt=tt.onObjectRender)===null||rt===void 0||rt.call(tt,f,h,k),h.lastShader&&((lt=Ht(tt.updaters))===null||lt===void 0||lt.forEach(pt=>pt==null?void 0:pt.updateShaderProperties(h.lastShader))),tt.updateVersion!==h.materialObject.userData["_"+tt.uuid+"_version"]&&(h.materialObject.userData["_"+tt.uuid+"_version"]=tt.updateVersion,h.materialObject.needsUpdate=!0)})}(e,a))),e.__ext_afterRenderListen||(e.__ext_afterRenderListen=!0,e.addEventListener("afterRender",a=>function(h,{object:f,renderer:k}){var et;(et=h.materialExtensions)===null||et===void 0||et.forEach(tt=>{var rt;(rt=tt.onAfterRender)===null||rt===void 0||rt.call(tt,f,h,k)})}(e,a))),s}}ku.FragVoidMain="void main() {",ku.VertVoidMain="void main() {";class M_ extends d.jyz{constructor(e){var i;super(e),this.typeSlug="shaderMat",this.assetType="material",this.materialObject=this,this.materialExtensions=[],this.extraUniformsToUpload={},this.materialExtensions=ku.RegisterExtensions(this,(i=e==null?void 0:e.customMaterialExtensions)!==null&&i!==void 0?i:[])}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...ku.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}onBeforeCompile(e,i){ku.ApplyMaterialExtensions(this,e,this.materialExtensions,i),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:i}),super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()+ku.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,i,s,a,h){super.onBeforeRender(e,i,s,a,h),this.dispatchEvent({type:"beforeRender",renderer:e,scene:i,camera:s,geometry:a,object:h})}onAfterRender(e,i,s,a,h){super.onAfterRender(e,i,s,a,h),this.dispatchEvent({type:"afterRender",renderer:e,scene:i,camera:s,geometry:a,object:h})}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,i){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){}}class Bu extends M_{constructor(e,i){super(e),this.typeSlug="shaderMat",this.textures=[],this.setTextureIds(i)}setTextureIds(e){this.textures.map(i=>i.id).join(";")!==e.join(";")&&(this.textures=e.map(i=>({id:i,encoding:d.rnI})),this.setDirty())}_setUniformTexSize(e,i){var s,a,h,f;if(!i||!e)return;const k=(a=(s=i.image)===null||s===void 0?void 0:s.width)!==null&&a!==void 0?a:512,et=(f=(h=i.image)===null||h===void 0?void 0:h.height)!==null&&f!==void 0?f:512,tt=e.value;tt.isVector2||console.warn("uniform is not a Vector2"),tt&&Math.abs(tt.x-k)+Math.abs(tt.y-et)>.1&&(tt.x=k,tt.y=et,this.uniformsNeedUpdate=!0)}onBeforeRender(e,i,s,a,h){var f,k;this._setUniformTexSize(this.uniforms.screenSize,(f=e.getRenderTarget())===null||f===void 0?void 0:f.texture);for(const et of this.textures){const tt=et.id,rt=(k=this.uniforms[tt])===null||k===void 0?void 0:k.value;rt&&(this._setUniformTexSize(this.uniforms[tt+"Size"],rt),rt.encoding!==et.encoding&&(et.encoding=rt.encoding,this.needsUpdate=!0))}super.onBeforeRender(e,i,s,a,h)}onBeforeCompile(e,i){e.fragmentShader=this.textures.map(s=>{var a,h;return`uniform sampler2D ${s.id}; 
`+wr((a=s.id)!==null&&a!==void 0?a:"input",(h=s.encoding)!==null&&h!==void 0?h:d.rnI)}).join(`
`)+e.fragmentShader,super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()+this.textures.map(e=>e.id+e.encoding).join(";")}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,i){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}function wo(c,...e){const i=c.fragmentShader;return new Bu({defines:Object.assign({},c.defines),uniforms:c.uniforms,vertexShader:c.vertexShader,fragmentShader:i},e)}class bu extends kt{constructor(e,...i){super(e.isMaterial?e:wo(e,...i),i.length<1?bu.DEFAULT_TEX_ID:i[0]),this.onDirty=[],this.isShaderPass2=!0,this.enabled=!0,this.setDirty=this.setDirty.bind(this)}dispose(){var e,i,s,a;(i=(e=this.material)===null||e===void 0?void 0:e.dispose)===null||i===void 0||i.call(e),(a=(s=this.fsQuad)===null||s===void 0?void 0:s.dispose)===null||a===void 0||a.call(s),this.onDirty=[]}setDirty(){this.onDirty.forEach(e=>e())}updateShaderProperties(e){e&&(Array.isArray(e)||(e=[e]),e.forEach(i=>i==null?void 0:i.updateShaderProperties(this.material)))}render(e,i,s,a,h){this.enabled&&super.render(e,i,s,a,h)}}bu.DEFAULT_TEX_ID="tDiffuse",function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);h>3&&f&&Object.defineProperty(e,i,f)}([Jr("Enabled"),jn()],bu.prototype,"enabled",void 0);class Go extends at{constructor(e,i,s,a,h){super(),this.scene=e,this.camera=i,this.overrideMaterial=s,this.clearColor=a,this.clearAlpha=h!==void 0?h:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new d.Ilk}render(e,i,s,a,h,f){const k=e.autoClear;let et,tt;if(e.autoClear=!1,this.overrideMaterial!==void 0&&(tt=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),et=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:s),f){const rt=e.getContext();rt.framebufferRenderbuffer(rt.FRAMEBUFFER,rt.DEPTH_ATTACHMENT,rt.RENDERBUFFER,f)}if(this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),f){const rt=e.getContext();rt.framebufferRenderbuffer(rt.FRAMEBUFFER,rt.DEPTH_ATTACHMENT,rt.RENDERBUFFER,null)}this.clearColor&&e.setClearColor(this._oldClearColor,et),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=tt),e.autoClear=k}}class vA extends bu{constructor(e,i="c = a + b;",s="",a){super({vertexShader:nt.vertexShader,fragmentShader:Ut`
                varying vec2 vUv;
                
                ${s}
                
                void blend(in vec4 a, in vec4 b, inout vec4 c){
                
                ${i}
                
                }
                void main() {
                    vec4 texel = vec4(0);
                    blend(tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ), tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), texel);
                    texel = clamp(texel, vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:a},...e}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}}class Kp extends d.jyz{constructor(e=!0){super({vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
out vec3 vViewPosition;void main(){
#include <uv_vertex>
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition=-mvPosition.xyz;}`,fragmentShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#include <packing>
uniform float alphaTest;
#endif
#ifndef gl_FragColor 
layout(location=0)out vec4 A;layout(location=1)out vec4 B;
#endif
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <alphamap_pars_fragment>
uniform vec2 cameraNearFar;uniform vec4 flags;in vec3 vViewPosition;vec2 pack16(float value){float sMax=65535.;int v=int(clamp(value,0.,1.)*sMax+0.5);int digit0=v/256;int digit1=v-digit0*256;return vec2(float(digit0)/255.,float(digit1)/255.);}vec2 packNormal(vec3 n){float p=sqrt(n.z*8.+8.);return vec2(n.xy/p+0.5);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}void main(){
#ifdef USE_ALPHAMAP
#ifdef ALPHA_I_RGBA_PACKING
if(1.-unpackRGBAToDepth(texture2D(alphaMap,vUv))<alphaTest)
#else
if(texture2D(alphaMap,vUv).g<alphaTest)
#endif
discard;
#endif
#include <normal_fragment_begin>
#ifdef FORCED_LINEAR_DEPTH
float linearZ=float(FORCED_LINEAR_DEPTH);
#else
float linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);
#endif
vec2 packedZ=pack16(pow(linearZ,0.5));vec2 packedNormal=packNormal(normal);
#ifndef gl_FragColor 
A=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);B=flags;
#else
gl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);
#endif
}`,uniforms:{cameraNearFar:{value:new d.FM8(.1,1e3)},alphaMap:{value:null},alphaTest:{value:null},flags:{value:new d.Ltg(1,1,1,1)}},glslVersion:e?d.LSk:d.v9Y})}onBeforeRender(e,i,s,a,h){var f,k,et;let tt=h.material;Array.isArray(tt)&&(tt=tt[0]),this.uniforms.alphaMap.value=(f=tt==null?void 0:tt.alphaMap)!==null&&f!==void 0?f:null,this.uniforms.alphaTest.value=!tt||!tt.alphaTest||tt.alphaTest<1e-7?.001:tt.alphaTest,this.uniforms.flags.value.x=(tt==null?void 0:tt.userData.postTonemap)===!1?0:1,this.uniforms.flags.value.y=tt!=null&&tt.userData._ssBevel?(tt==null?void 0:tt.userData._ssBevel.radius)/255:0,this.uniforms.flags.value.z=(tt!=null&&tt.userData.matId?tt==null?void 0:tt.userData.matId:0)/255,this.uniforms.flags.value.w=tt!=null&&tt.userData.enableLUT?tt==null?void 0:tt.userData.enableLUT:0,this.uniformsNeedUpdate=!0;let rt=this.uniforms.alphaMap.value?1:void 0;rt!==this.defines.USE_ALPHAMAP&&(rt===void 0?delete this.defines.USE_ALPHAMAP:this.defines.USE_ALPHAMAP=rt,this.needsUpdate=!0),rt=tt.userData.ALPHA_I_RGBA_PACKING?1:void 0,rt!==this.defines.ALPHA_I_RGBA_PACKING&&(rt===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=rt,this.needsUpdate=!0),rt=(k=tt.userData.forcedLinearDepth)!==null&&k!==void 0?k:void 0,rt!==this.defines.FORCED_LINEAR_DEPTH&&(rt===void 0?delete this.defines.FORCED_LINEAR_DEPTH:this.defines.FORCED_LINEAR_DEPTH=rt,this.needsUpdate=!0),this.side=(et=tt.side)!==null&&et!==void 0?et:d.ehD}}var Hv=`#ifndef UNPACK_GBUFFER_SNIPPET
#define UNPACK_GBUFFER_SNIPPET 
uniform sampler2D tNormalDepth;float unpack16(vec2 value){return(value.x*0.996108949416342426275150501169264316558837890625+value.y*0.00389105058365758760263730664519243873655796051025390625);}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}float unpackDepth(vec2 uncodedDepth){float x=unpack16(uncodedDepth.xy);return x*x;}float getDepth(vec2 uv){vec4 uncodedDepth=texture2D(tNormalDepth,uv);return unpackDepth(uncodedDepth.xy);}void getDepthNormal(const in vec2 uv,out float depth,out vec3 normal){vec4 uncodedDepth=texture2D(tNormalDepth,uv);depth=unpackDepth(uncodedDepth.xy);normal=unpackNormal(uncodedDepth.zw);}vec3 getViewNormal(const in vec2 uv){return unpackNormal(texture2D(tNormalDepth,uv).zw);}
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
uniform sampler2D tGBufferFlags;
#endif
vec4 getGBufferFlags(const in vec2 uv){
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
return texture2D(tGBufferFlags,uv);
#else
return vec4(1.);
#endif
}
#endif
`;const T_={name:"",fog:!0,blending:d.bdR,side:d.Wl3,vertexColors:!1,opacity:1,transparent:!1,blendSrc:d.k74,blendDst:d.LgZ,blendEquation:d.bGH,blendSrcAlpha:null,blendDstAlpha:null,blendEquationAlpha:null,depthFunc:d.vCF,depthTest:!0,depthWrite:!0,stencilWriteMask:255,stencilFunc:d.cum,stencilRef:0,stencilFuncMask:255,stencilFail:d.x5V,stencilZFail:d.x5V,stencilZPass:d.x5V,stencilWrite:!1,clippingPlanes:null,clipIntersection:!1,clipShadows:!1,shadowSide:null,colorWrite:!0,precision:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0,dithering:!1,alphaTest:0,alphaToCoverage:!1,premultipliedAlpha:!1,visible:!0,toneMapped:!0,userData:{},wireframeLinecap:"round",wireframeLinejoin:"round"};function Ul(c,e,i,{replaceAll:s=!1,prepend:a=!1,append:h=!1}={}){if(!c.includes(e))return console.error(`${e} not found in shader`),c;let f=i;return a?f=i+e:h&&(f=e+i),s?c.replaceAll(e,f):c.replace(e,f)}const Iw={...T_,color:"#000000",roughness:0,metalness:0,map:null,lightMap:null,lightMapIntensity:0,aoMap:null,aoMapIntensity:0,emissive:"#000000",emissiveIntensity:0,emissiveMap:null,bumpMap:null,bumpScale:0,normalMap:null,normalMapType:d.IOt,normalScale:new d.FM8(1,1),displacementMap:null,displacementScale:0,displacementBias:0,roughnessMap:null,metalnessMap:null,alphaMap:null,envMap:null,envMapIntensity:0,refractionRatio:0,wireframe:!1,wireframeLinewidth:0,skinning:!1,morphTargets:!1,morphNormals:!1,flatShading:!1,glossiness:0,glossinessMap:null,specularColor:new oo(0),specularColorMap:null},Pw={...Iw,clearcoat:0,clearcoatMap:null,clearcoatRoughness:0,clearcoatRoughnessMap:null,clearcoatNormalScale:new d.FM8(1,1),clearcoatNormalMap:null,reflectivity:.5,sheen:0,sheenColor:new oo(0),sheenColorMap:null,sheenRoughness:1,sheenRoughnessMap:null,specularIntensity:1,specularIntensityMap:null,specularColor:new oo(1,1,1),specularColorMap:null,transmission:0,transmissionMap:null,thickness:0,thicknessMap:null,attenuationDistance:0,attenuationColor:new oo(1,1,1),iridescenceMap:null,iridescenceIOR:1.3,iridescenceThicknessRange:[100,400],iridescenceThicknessMap:null};class $u extends d.EJi{constructor(e){var i;super(e),this.typeSlug=$u.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshStandardMaterial2=!0,this.extraUniformsToUpload={},this.setDirty=this.setDirty.bind(this),this.userData.setDirty=s=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(s)},this.fog=!1,this.userData.enableLUT=!0,this.materialExtensions=ku.RegisterExtensions(this,(i=e==null?void 0:e.customMaterialExtensions)!==null&&i!==void 0?i:[])}setDirty(e){var i,s;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(s=(i=this._uiConfig)===null||i===void 0?void 0:i.uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...ku.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},To(this,"map"),{type:"folder",label:"Rough/Metal",limitedUi:!0,children:[{type:"slider",bounds:[0,1],property:[this,"roughness"],limitedUi:!0},{type:"slider",bounds:[0,1],property:[this,"metalness"],limitedUi:!0},{type:"image",property:[this,"roughnessMap"]},To(this,"roughnessMap"),{type:"image",property:[this,"metalnessMap"]},To(this,"metalnessMap")]},{type:"folder",label:"Bump/Normal",limitedUi:!0,children:[{type:"slider",bounds:[0,.2],stepSize:.001,property:[this,"bumpScale"],hidden:()=>!this.bumpMap},{type:"image",property:[this,"bumpMap"]},To(this,"bumpMap"),{type:"image",property:[this,"normalMap"]},{type:"vec2",property:[this,"normalScale"],hidden:()=>!this.normalMap},{type:"dropdown",hidden:()=>!this.normalMap,property:[this,"normalMapType"],children:[["TangentSpace",d.IOt],["ObjectSpace",d.PA7]].map(e=>({label:e[0],value:e[1]}))},To(this,"normalMap"),{type:"input",property:[this,"displacementScale"],hidden:()=>!this.displacementMap},{type:"image",property:[this,"displacementMap"]},To(this,"displacementMap")]},{type:"folder",label:"Sheen",children:[{type:"slider",bounds:[0,1],property:[this,"sheen"]},{type:"color",hidden:()=>this.sheen<.001,property:[this,"sheenColor"]},{type:"image",property:[this,"sheenColorMap"]},To(this,"sheenColorMap"),{type:"slider",bounds:[0,1],property:[this,"sheenRoughness"]},{type:"image",property:[this,"sheenRoughnessMap"]},To(this,"sheenRoughnessMap")]},{type:"folder",label:"Clearcoat",children:[{type:"slider",bounds:[0,1],property:[this,"clearcoat"]},{type:"slider",bounds:[0,1],hidden:()=>this.clearcoat<.001,property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatMap"]},To(this,"clearcoatMap"),{type:"slider",bounds:[0,1],property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatRoughnessMap"]},To(this,"clearcoatRoughnessMap"),{type:"image",property:[this,"clearcoatNormalMap"]},{type:"vec2",property:[this,"clearcoatNormalScale"],hidden:()=>!this.clearcoatNormalMap},To(this,"clearcoatNormalMap")]},{type:"folder",label:"Emission",children:[{type:"color",property:[this,"emissive"]},{type:"slider",bounds:[0,10],property:[this,"emissiveIntensity"]},{type:"image",property:[this,"emissiveMap"]},To(this,"emissiveMap")]},{type:"folder",label:"Refraction",children:[{type:"slider",bounds:[0,1],property:[this,"reflectivity"]},{type:"slider",bounds:[0,1],property:[this,"transmission"],limitedUi:!0},{type:"slider",bounds:[0,1],stepSize:.001,property:[this,"thickness"]},{type:"image",property:[this,"transmissionMap"]},To(this,"transmissionMap"),{type:"image",property:[this,"thicknessMap"]},To(this,"thicknessMap")]},{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"dropdown",property:[this,"depthFunc"],children:[["Never",d.BVF],["Always",d.Se2],["Less",d.Zr5],["LessEqual",d.vCF],["Equal",d.eD],["GreaterEqual",d.ksN],["Greater",d.w$m],["NotEqual",d.M6v]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[this,"depthTest"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",Nl],["Normal",Qs],["Additive",d.WMw],["Subtractive",So],["Multiply",_l]].map(e=>({label:e[0],value:e[1]}))},{type:"image",property:[this,"alphaMap"]},To(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}},{type:"checkbox",label:"Inverse AlphaMap",hidden:()=>!this.transparent,getValue:()=>this.userData.inverseAlphaMap===!0,setValue:e=>{this.userData.inverseAlphaMap=e||void 0,this.setDirty()}}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},To(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},To(this,"lightMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",d.Wl3],["Back",d._Li],["Double",d.ehD]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[this,"flatShading"]},{type:"checkbox",label:"Enable LUT",getValue:()=>this.userData.enableLUT===!0,setValue:e=>{this.userData.enableLUT=e||void 0,this.setDirty()}},{type:"input",label:"Mesh count",getValue:()=>{var e,i,s;return(s=(i=(e=this.userData)===null||e===void 0?void 0:e.__appliedMeshes)===null||i===void 0?void 0:i.size)!==null&&s!==void 0?s:0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{Du(new Blob([JSON.stringify(this.toJSON(),null,2)],{type:"application/json"}),`physical-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Physical Material",expanded:!0,children:this._uiConfigChildren,uuid:"MSM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var i;return(i=e.getUiConfig)===null||i===void 0?void 0:i.call(e,this)})].filter(e=>e),this._uiConfig}onBeforeCompile(e,i){const s=[["vec3 totalDiffuse = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["#include <lights_physical_fragment>","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],a=[["#include <uv_vertex>","mainStart"]];for(const h of a)e.vertexShader=Ul(e.vertexShader,h[0],"#glMarker "+h[1]+`
`+h[0]);for(const h of s)e.fragmentShader=Ul(e.fragmentShader,h[0],"#glMarker "+h[1]+`
`+h[0]);ku.ApplyMaterialExtensions(this,e,this.materialExtensions,i),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),e.defines.INVERSE_ALPHAMAP=this.userData.inverseAlphaMap?1:0,super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()+ku.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,i,s,a,h){super.onBeforeRender(e,i,s,a,h),this.dispatchEvent({type:"beforeRender",renderer:e,scene:i,camera:s,geometry:a,object:h});const f=this.userData.inverseAlphaMap?1:0;f!==this.defines.INVERSE_ALPHAMAP&&(this.defines.INVERSE_ALPHAMAP=f,this.needsUpdate=!0)}copyProps(e,i=!1){if(!i&&!["MeshStandardMaterial",$u.TYPE,"MeshPhysicalMaterial"].includes(e.type))return console.error("Material type is not supported:",e.type),this;const s={};on(e,s,Array.from(Object.keys(Pw)));const a=s.userData;delete s.userData;for(const h of Object.keys(s))s[h]===void 0&&delete s[h];return this.setValues(s),a&&Jl(this.userData,a),this.setDirty(),this}toJSON(e){var i,s;const a=this.userData;this.userData={};const h=super.toJSON(e);this.userData=a,h.userData={},Jl(h.userData,a),h.userData.uuid=this.userData.uuid;const f=e||{textures:Object.fromEntries(((i=h.textures)===null||i===void 0?void 0:i.map(k=>[k.uuid,k]))||[]),images:Object.fromEntries(((s=h.images)===null||s===void 0?void 0:s.map(k=>[k.uuid,k]))||[])};h.userData=Wr(h.userData,!1,f),e||(Object.keys(f.textures).length>0&&(h.textures=Object.values(f.textures)),Object.keys(f.images).length>0&&(h.images=Object.values(f.images))),h.type=$u.TYPE;for(const k of Object.keys(h))h[k]===void 0&&delete h[k];return h}fromJSON(e,i,s=!1){return Array.isArray(e.normalScale)&&(e.normalScale=new d.FM8().fromArray(e.normalScale)),Array.isArray(e.clearcoatNormalScale)&&(e.clearcoatNormalScale=new d.FM8().fromArray(e.clearcoatNormalScale)),this.copyProps(e,s)}clone(){return super.clone()}}$u.TypeSlug="pmat",$u.TYPE="MeshStandardMaterial2";const Dw={...T_,color:"#000000",map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,alphaMap:null,envMap:null,combine:d.Ns1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinewidth:0,skinning:!1};class $p extends d.vBJ{constructor(e){var i;super(e),this.typeSlug=$p.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshBasicMaterial2=!0,this.extraUniformsToUpload={},this.fog=!1,this.setDirty=this.setDirty.bind(this),this.userData.setDirty=s=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(s)},this.materialExtensions=ku.RegisterExtensions(this,(i=e==null?void 0:e.customMaterialExtensions)!==null&&i!==void 0?i:[])}setDirty(e){var i,s;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(s=(i=this._uiConfig)===null||i===void 0?void 0:i.uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...ku.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},To(this,"map"),{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",Nl],["Normal",Qs],["Additive",d.WMw],["Subtractive",So],["Multiply",_l]].map(e=>({label:e[0],value:e[1]}))},{type:"image",property:[this,"alphaMap"]},To(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},To(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},To(this,"lightMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",d.Wl3],["Back",d._Li],["Double",d.ehD]].map(e=>({label:e[0],value:e[1]}))},{type:"input",label:"Mesh count",getValue:()=>{var e,i,s;return(s=(i=(e=this.userData)===null||e===void 0?void 0:e.__appliedMeshes)===null||i===void 0?void 0:i.size)!==null&&s!==void 0?s:0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{Du(new Blob([JSON.stringify(this.toJSON(),null,2)],{type:"application/json"}),`unlit-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Unlit Material",expanded:!0,children:this._uiConfigChildren,uuid:"MBM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var i;return(i=e.getUiConfig)===null||i===void 0?void 0:i.call(e,this)})].filter(e=>e),this._uiConfig}onBeforeCompile(e,i){const s=[["vec3 outgoingLight = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["ReflectedLight reflectedLight = ","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],a=[["#include <uv_vertex>","mainStart"]];for(const h of a)e.vertexShader=Ul(e.vertexShader,h[0],"#glMarker "+h[1]+`
`+h[0]);for(const h of s)e.fragmentShader=Ul(e.fragmentShader,h[0],"#glMarker "+h[1]+`
`+h[0]);ku.ApplyMaterialExtensions(this,e,this.materialExtensions,i),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()+ku.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,i,s,a,h){super.onBeforeRender(e,i,s,a,h),this.dispatchEvent({type:"beforeRender",renderer:e,scene:i,camera:s,geometry:a,object:h})}copyProps(e,i=!1){if(!i&&!["MeshBasicMaterial",$p.TYPE].includes(e.type))return console.error("Material type is not supported:",e.type),this;const s={};on(e,s,Array.from(Object.keys(Dw)));const a=s.userData;delete s.userData;for(const h of Object.keys(s))s[h]===void 0&&delete s[h];return this.setValues(s),a&&Jl(this.userData,a),this.setDirty(),this}toJSON(e){var i,s;const a=this.userData;this.userData={};const h=super.toJSON(e);this.userData=a,h.userData={},Jl(h.userData,a),h.userData.uuid=this.userData.uuid;const f=e||{textures:Object.fromEntries(((i=h.textures)===null||i===void 0?void 0:i.map(k=>[k.uuid,k]))||[]),images:Object.fromEntries(((s=h.images)===null||s===void 0?void 0:s.map(k=>[k.uuid,k]))||[])};h.userData=Wr(h.userData,!1,f),e||(Object.keys(f.textures).length>0&&(h.textures=Object.values(f.textures)),Object.keys(f.images).length>0&&(h.images=Object.values(f.images))),h.type=$p.TYPE;for(const k of Object.keys(h))h[k]===void 0&&delete h[k];return h}fromJSON(e,i,s=!1){return this.copyProps(e,s)}clone(){return super.clone()}}$p.TypeSlug="bmat",$p.TYPE="MeshBasicMaterial2";const Wv={materialType:$u.TYPE,name:"standard",color:"#ffffff"},b0={materialType:$p.TYPE,name:"basic",color:"#ffffff"},_1={[$u.TYPE]:Wv.name,MeshStandardMaterial:Wv.name,MeshPhysicalMaterial:Wv.name,[$p.TYPE]:b0.name,MeshBasicMaterial:b0.name};class zm extends j{constructor(){super(),this._templates=[Wv,b0],this._materials=[],this._disposeMaterial=e=>{const i=e.target;if(!i||i.assetType!=="material")return;this._refreshTextureRefs();const s=this._getMapsForMaterial(i),a=[];s.forEach(h=>{const f=h.userData.__appliedMaterials;f==null||f.delete(i),f&&h.userData.disposeOnIdle!==!1&&f.size===0&&a.push(h)}),a.forEach(h=>{h.dispose()}),this.unregisterMaterial(i)},this._materialExtensions=[],this.processModel=this.processModel.bind(this),this.processMaterial=this.processMaterial.bind(this)}findOrCreate(e,i){let s=this.findMaterial(e);return s||(s=this.generateFromTemplate(e,i)),s}generateFromTemplate(e,i){const s=this.findTemplate(e);if(s)return this._generateFromTemplate(s,i??{})}generateFromTemplateType(e,i){const s=this._templates.find(a=>a.materialType===e);if(s)return this._generateFromTemplate(s,i??{})}findTemplate(e){return this._templates.find(i=>i.name===e)}_refreshTextureRefs(){this.getAllMaterials().forEach(e=>{this._getMapsForMaterial(e).forEach(i=>{let s=i.userData.__appliedMaterials;s||(i.userData.__appliedMaterials=s=new Set),s.add(e)})})}_getMapsForMaterial(e){var i;const s=new Set;for(const a of Object.values(e))a&&a.isTexture&&s.add(a);for(const a of Object.values((i=e.userData)!==null&&i!==void 0?i:{}))a&&a.isTexture&&s.add(a);return s}registerMaterial(e){if(this._materials.includes(e))return;const i=this.findMaterial(e.uuid);i?console.warn("Material UUID already exists",e,i):(e.addEventListener("dispose",this._disposeMaterial),this._materials.push(e))}registerMaterialObject(e){const i=e.materialObject?e:Object.assign(e,{assetType:"material",materialObject:e});return this.registerMaterial(i),i}unregisterMaterial(e){this._materials=this._materials.filter(i=>i.uuid!==e.uuid),e.removeEventListener("dispose",this._disposeMaterial)}registerMaterialTemplate(e){e.templateUUID||(e.templateUUID=Ho());const i=this._templates.find(s=>s.templateUUID===e.templateUUID);i?console.warn("MaterialTemplate already exists",e,i):this._templates.push(e)}unregisterMaterialTemplate(e){this._templates=this._templates.filter(i=>i.templateUUID!==e.templateUUID)}dispose(){}findMaterial(e){return e?this._materials.find(i=>i.uuid===e):void 0}findMaterialsByName(e){return this._materials.filter(i=>i.name===e)}getMaterialsOfType(e){return e?this._materials.filter(i=>i.typeSlug===e):[]}getAllMaterials(){return[...this._materials]}processModel(e,i){return nn(e,"modelObject",this._processModel(e,i)),e}_processMaterial(e,i){var s,a,h;if(!e)return;if(!((s=e.materialObject)===null||s===void 0)&&s.isMaterial)return e;let f=e.mmMaterial;if(!f){const k=((a=e.userData)===null||a===void 0?void 0:a.uuid)||e.uuid;if(f=this.findMaterial(k),f)f.copyProps(e);else{const et=i.useSourceMaterial===!1||!e.isMaterial,tt=(h=i.materialTemplate)!==null&&h!==void 0?h:et?"standard":_1[e.type]||"standard";f=this.generateFromTemplate(tt,et?{}:e)}e.mmMaterial=f}return f}processMaterial(e,i){return i.register!==!1&&this.registerMaterial(e),e.materialObject||(e=this._processMaterial(e,{...i,register:!1})),e}registerMaterialExtension(e){this._materialExtensions.includes(e)||this._materialExtensions.push(e)}unregisterMaterialExtension(e){const i=this._materialExtensions.indexOf(e);i>=0&&this._materialExtensions.splice(i,1)}exportMaterial(e,i,s=!0,a=!1){const h=Wr(e,!1),f=JSON.stringify(h,null,s?0:2),k=(i||e.name||"physical_material")+"."+e.typeSlug,et=new File([f],k,{type:"application/json"});return a&&Xp(et),et}}class I_ extends zm{_generateFromTemplate(e,i){var s,a,h,f,k,et;let tt;const rt={...e};rt.customMaterialExtensions=[...(s=rt.customMaterialExtensions)!==null&&s!==void 0?s:[],...this._materialExtensions];let lt={};switch(e.materialType){case"MeshStandardMaterial2":case"standard":i&&on(i,rt,Array.from(Object.keys(Pw))),(i==null?void 0:i.type)==="MeshBasicMaterial"&&(rt.roughness=.9,rt.metalness=0,!((a=rt.userData)===null||a===void 0)&&a.uuid&&delete rt.userData.uuid),lt=(h=rt.userData)===null||h===void 0?void 0:h.uuid,lt&&delete rt.userData.uuid,tt=new $u({customMaterialExtensions:rt.customMaterialExtensions}).fromJSON(rt,void 0,!0),lt&&(tt.uuid=lt),tt.userData.uuid=tt.uuid,tt.setDirty(),i!=null&&i.isMaterial&&i.userData!==void 0&&(i.userData.iMaterial=tt);break;case"MeshBasicMaterial2":case"basic":case"unlit":i&&on(i,rt,Array.from(Object.keys(Dw))),lt=(f=rt.userData)===null||f===void 0?void 0:f.uuid,lt&&delete rt.userData.uuid,tt=new $p({customMaterialExtensions:rt.customMaterialExtensions}).fromJSON(rt,void 0,!0),lt&&(tt.uuid=lt),tt.userData.uuid=tt.uuid,tt.setDirty();break;case"shadow":throw"TODO: Not implemented shadow material";default:lt=null,i&&i.userData&&(lt=i.userData,delete i.userData),tt=((k=e.generator)===null||k===void 0?void 0:k.call(e,rt,i))||void 0,i&&lt&&(i.userData=lt),lt&&tt&&(Jl(tt.userData,lt),lt!=null&&lt.uuid&&(tt.uuid=lt.uuid),lt=null),tt&&(tt.userData.uuid=tt.uuid)}if(tt){i.runtimeMaterial&&(tt.userData.__runtimeMaterial=!0);const pt=tt;if(tt.clone=()=>{pt.userData.cloneId||(pt.userData.cloneId="0",pt.userData.cloneCount=0),pt.userData.cloneCount+=1;const ft=this.generateFromTemplate(e.name);return ft&&(ft.copyProps(pt),ft.userData.cloneId=ft.userData.cloneId+"_"+pt.userData.cloneCount,ft.userData.cloneCount=0,ft.name=ft.name+"_"+ft.userData.cloneId),ft==null?void 0:ft.materialObject},i){let ft=this.findMaterial(i==null?void 0:i.uuid);ft&&this.unregisterMaterial(ft),ft=this.findMaterial((et=i==null?void 0:i.materialObject)===null||et===void 0?void 0:et.uuid),ft&&this.unregisterMaterial(ft)}return this.registerMaterialObject(pt)}}_processModel(e,i){if(!e.modelObject)return console.error("MaterialManager: No modelObject found for ",e),e;let s=e.material;if(!s&&e.geometry&&(this._defaultMaterial||(this._defaultMaterial=this.generateFromTemplate("standard")),s=this._defaultMaterial,e.material=s),s){let a=!0;Array.isArray(s)||(s=[s],a=!1);const h=[];for(const f of s){const k=this._processMaterial(f,i);h.push(k==null?void 0:k.materialObject)}e.setMaterial&&(e.modelObject.material=null,e.setMaterial(a?h:h[0]))}if(i.recursive!==!1)for(let a=0;a<e.modelObject.children.length;a++)e.modelObject.children[a]=this._processModel(e.modelObject.children[a],i);return e}}class zl{constructor(e,i,s,a){this.cls=e,this.ext=i,this.root=s,this.onCtor=a}ctor(e){const i=this.cls&&new this.cls(e.loadingManager);return typeof this.onCtor=="function"?this.onCtor(i,e):i}}function _A(c){var e;if(!c||c===""||c.match(/__MACOSX\/.*\._/))return"";const i=(e=(c=c.replace(/\?.*$/,"")).split(/[\\/]/).pop())!==null&&e!==void 0?e:"",s=i.lastIndexOf(".");return i===""||s<1?"":i.slice(s+1)}function yA(c){return c.substring(c.lastIndexOf("/")+1)}class dv{constructor(e,{pseudoCenter:i=!1,autoCenter:s=!1,autoScale:a=!1,autoScaleRadius:h=2,license:f=""}={}){if(this.assetType="model",this._modelObject=vs(new d.Tme),this.setDirty=this.setDirty.bind(this),this.updateBounds=this.updateBounds.bind(this),e||(e=this._modelObject),!i||e.userData.pseudoCentered||e.userData.isCentered)!s||e.userData.autoCentered||e.userData.isCentered||e.userData.pseudoCentered?i||s||(e.userData.isCentered=!0):ls(e),this._modelObject=e;else{s&&console.error("cannot use pseudoCenter and autoCenter at the same time");const k=new sr().expandByObject(e,!0,!0).getCenter(new d.Pa4);this._modelObject.position.copy(k).negate(),this._modelObject.updateMatrix(),this._modelObject.add(e),this._modelObject.name=e.name+"-centered",this._modelObject.userData.pseudoCentered=!0,e.userData.iModel=this}a&&!this._modelObject.userData.autoScaled?Rs(this._modelObject,e.userData.autoScaleRadius||h):this._modelObject.userData.autoScaled=!0,this._modelObject.addEventListener("dispose",()=>{this.__disposed=!0}),this._modelObject.userData.iModel=this,this.license=f}get visible(){return this._modelObject.visible}set visible(e){this._modelObject.visible=e}get uuid(){return this._modelObject.uuid}get modelObject(){return this._modelObject}get name(){return this._modelObject.name}set name(e){this._modelObject.name=e}get license(){return this._modelObject.userData.license}set license(e){this._modelObject.userData.license=e}addEventListener(e,i){this._modelObject.addEventListener(e,i)}dispatchEvent(e){this._modelObject.dispatchEvent(e)}hasEventListener(e,i){return this._modelObject.hasEventListener(e,i)}removeEventListener(e,i){this._modelObject.removeEventListener(e,i)}traverse(e){this._modelObject.traverse(e)}dispose(){const e=this._modelObject.dispose;e&&typeof e=="function"?e():(console.warn("no dispose in modelObject"),this._modelObject.removeFromParent())}setDirty(e){var i,s,a,h;(s=(i=this._modelObject)===null||i===void 0?void 0:i.setDirty)===null||s===void 0||s.call(i,e),(h=(a=this._uiConfig)===null||a===void 0?void 0:a.uiRefresh)===null||h===void 0||h.call(a,"postFrame",!0)}setMaterial(e){var i,s;return this._modelObject.isMesh?((s=(i=this._modelObject).setMaterial)===null||s===void 0?void 0:s.call(i,e))||[]:(console.error("setMaterial only works on meshes"),[])}get material(){return this._modelObject.material}get geometry(){return this._modelObject.geometry}setGeometry(e,i=!1){var s,a;if(this._modelObject.isMesh)return(a=(s=this._modelObject).setGeometry)===null||a===void 0?void 0:a.call(s,e,i);console.error("setGeometry only works on meshes")}get userData(){return this._modelObject.userData}set userData(e){this._modelObject.userData=e}updateBounds(){console.warn("updateBounds: NOT IMPLEMENTED"),this.setDirty()}get uiConfig(){return this._uiConfig||(this._uiConfig=Ls(this._modelObject,!1)),this._uiConfig}clone(){return new dv(this._modelObject.clone(),{pseudoCenter:!1,autoScale:!1,autoCenter:!1,license:this.license})}}function P_(c,e){return[c.modelObject,...c.modelObject.children].forEach(i=>{vs(i,i!==c.modelObject?c:void 0,e)}),c}class E0{constructor(){this._processors=new Map}add(e,i){var s;this._processors.has(e)||this._processors.set(e,[]),(s=this._processors.get(e))===null||s===void 0||s.push(i)}remove(e,i){const s=this._processors.get(e),a=(s==null?void 0:s.indexOf(i))||(s==null?void 0:s.findIndex(h=>h.process&&h.process===i.process||h.processAsync&&h.processAsync===i.processAsync));!s||!a||a<0||s.splice(a,1)}get(e){var i;return(i=this._processors.get(e))!==null&&i!==void 0?i:[]}async process(e,i,s){var a,h,f,k;const et=this.get(e),tt=i.assetType;for(const rt of et)rt.forAssetType===tt&&(i=(h=(a=rt.process)===null||a===void 0?void 0:a.call(rt,i,s))!==null&&h!==void 0?h:i,i=(k=await((f=rt.processAsync)===null||f===void 0?void 0:f.call(rt,i,s)))!==null&&k!==void 0?k:i);return i}dispose(){this._processors.clear()}}class AA extends d.hH6{load(e,i,s,a){return super.load(e,h=>{try{if(typeof h!="string")throw new Error("Invalid JSON");i==null||i(JSON.parse(h))}catch(f){a==null||a(f)}},s,a)}}class IS extends d.yxD{constructor(e){super(e),this.type=d.cLu}parse(e){const i=function(et,tt){switch(et){case 1:console.error("THREE.RGBELoader Read Error: "+(tt||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(tt||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(tt||""));break;default:console.error("THREE.RGBELoader: Error: "+(tt||""))}return-1},s=function(et,tt,rt){tt=tt||1024;let lt=et.pos,pt=-1,ft=0,vt="",yt=String.fromCharCode.apply(null,new Uint16Array(et.subarray(lt,lt+128)));for(;0>(pt=yt.indexOf(`
`))&&ft<tt&&lt<et.byteLength;)vt+=yt,ft+=yt.length,lt+=128,yt+=String.fromCharCode.apply(null,new Uint16Array(et.subarray(lt,lt+128)));return-1<pt&&(rt!==!1&&(et.pos+=ft+pt+1),vt+yt.slice(0,pt))},a=function(et,tt,rt,lt){const pt=et[tt+3],ft=Math.pow(2,pt-128)/255;rt[lt+0]=et[tt+0]*ft,rt[lt+1]=et[tt+1]*ft,rt[lt+2]=et[tt+2]*ft,rt[lt+3]=1},h=function(et,tt,rt,lt){const pt=et[tt+3],ft=Math.pow(2,pt-128)/255;rt[lt+0]=d.A5E.toHalfFloat(Math.min(et[tt+0]*ft,65504)),rt[lt+1]=d.A5E.toHalfFloat(Math.min(et[tt+1]*ft,65504)),rt[lt+2]=d.A5E.toHalfFloat(Math.min(et[tt+2]*ft,65504)),rt[lt+3]=d.A5E.toHalfFloat(1)},f=new Uint8Array(e);f.pos=0;const k=function(et){const tt=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,rt=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,lt=/^\s*FORMAT=(\S+)\s*$/,pt=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,ft={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let vt,yt;if(et.pos>=et.byteLength||!(vt=s(et)))return i(1,"no header found");if(!(yt=vt.match(/^#\?(\S+)/)))return i(3,"bad initial token");for(ft.valid|=1,ft.programtype=yt[1],ft.string+=vt+`
`;vt=s(et),vt!==!1;)if(ft.string+=vt+`
`,vt.charAt(0)!=="#"){if((yt=vt.match(tt))&&(ft.gamma=parseFloat(yt[1])),(yt=vt.match(rt))&&(ft.exposure=parseFloat(yt[1])),(yt=vt.match(lt))&&(ft.valid|=2,ft.format=yt[1]),(yt=vt.match(pt))&&(ft.valid|=4,ft.height=parseInt(yt[1],10),ft.width=parseInt(yt[2],10)),2&ft.valid&&4&ft.valid)break}else ft.comments+=vt+`
`;return 2&ft.valid?4&ft.valid?ft:i(3,"missing image size specifier"):i(3,"missing format specifier")}(f);if(k!==-1){const et=k.width,tt=k.height,rt=function(lt,pt,ft){const vt=pt;if(vt<8||vt>32767||lt[0]!==2||lt[1]!==2||128&lt[2])return new Uint8Array(lt);if(vt!==(lt[2]<<8|lt[3]))return i(3,"wrong scanline width");const yt=new Uint8Array(4*pt*ft);if(!yt.length)return i(4,"unable to allocate buffer space");let Mt=0,xt=0;const Et=4*vt,At=new Uint8Array(4),Rt=new Uint8Array(Et);let Bt=ft;for(;Bt>0&&xt<lt.byteLength;){if(xt+4>lt.byteLength)return i(1);if(At[0]=lt[xt++],At[1]=lt[xt++],At[2]=lt[xt++],At[3]=lt[xt++],At[0]!=2||At[1]!=2||(At[2]<<8|At[3])!=vt)return i(3,"bad rgbe scanline format");let Qt,Wt=0;for(;Wt<Et&&xt<lt.byteLength;){Qt=lt[xt++];const pn=Qt>128;if(pn&&(Qt-=128),Qt===0||Wt+Qt>Et)return i(3,"bad scanline data");if(pn){const yn=lt[xt++];for(let En=0;En<Qt;En++)Rt[Wt++]=yn}else Rt.set(lt.subarray(xt,xt+Qt),Wt),Wt+=Qt,xt+=Qt}const tn=vt;for(let pn=0;pn<tn;pn++){let yn=0;yt[Mt]=Rt[pn+yn],yn+=vt,yt[Mt+1]=Rt[pn+yn],yn+=vt,yt[Mt+2]=Rt[pn+yn],yn+=vt,yt[Mt+3]=Rt[pn+yn],Mt+=4}Bt--}return yt}(f.subarray(f.pos),et,tt);if(rt!==-1){let lt,pt,ft;switch(this.type){case d.VzW:ft=rt.length/4;const vt=new Float32Array(4*ft);for(let Mt=0;Mt<ft;Mt++)a(rt,4*Mt,vt,4*Mt);lt=vt,pt=d.VzW;break;case d.cLu:ft=rt.length/4;const yt=new Uint16Array(4*ft);for(let Mt=0;Mt<ft;Mt++)h(rt,4*Mt,yt,4*Mt);lt=yt,pt=d.cLu;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:et,height:tt,data:lt,header:k.string,gamma:k.gamma,exposure:k.exposure,type:pt}}}return null}setDataType(e){return this.type=e,this}load(e,i,s,a){return super.load(e,function(h,f){switch(h.type){case d.VzW:case d.cLu:h.encoding=d.rnI,h.minFilter=d.wem,h.magFilter=d.wem,h.generateMipmaps=!1,h.flipY=!0}i&&i(h,f)},s,a)}}function y1(c){uo.Importers.push(new zl(class extends IS{constructor(e){super(e),this.setDataType(P1(c))}},["hdr"],!1))}class pv extends d.aNw{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(i){return new Ey(i)}),this.register(function(i){return new lp(i)}),this.register(function(i){return new fv(i)}),this.register(function(i){return new Ms(i)}),this.register(function(i){return new Vm(i)}),this.register(function(i){return new Sy(i)}),this.register(function(i){return new Cy(i)}),this.register(function(i){return new D_(i)}),this.register(function(i){return new qv(i)}),this.register(function(i){return new Ju(i)}),this.register(function(i){return new ru(i)}),this.register(function(i){return new Zo(i)})}load(e,i,s,a){const h=this;let f;f=this.resourcePath!==""?this.resourcePath:this.path!==""?this.path:d.Zp0.extractUrlBase(e),this.manager.itemStart(e);const k=function(tt){a?a(tt):console.error(tt),h.manager.itemError(e),h.manager.itemEnd(e)},et=new d.hH6(this.manager);et.setPath(this.path),et.setResponseType("arraybuffer"),et.setRequestHeader(this.requestHeader),et.setWithCredentials(this.withCredentials),et.load(e,function(tt){try{h.parse(tt,f,function(rt){i(rt),h.manager.itemEnd(e)},k)}catch(rt){k(rt)}},s,k)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,i,s,a){let h;const f={},k={};if(typeof e=="string")h=e;else if(d.Zp0.decodeText(new Uint8Array(e,0,4))===xA){try{f[Fs.KHR_BINARY_GLTF]=new Rr(e)}catch(rt){return void(a&&a(rt))}h=f[Fs.KHR_BINARY_GLTF].content}else h=d.Zp0.decodeText(new Uint8Array(e));const et=JSON.parse(h);if(et.asset===void 0||et.asset.version[0]<2)return void(a&&a(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const tt=new yu(et,{path:i||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});tt.fileLoader.setRequestHeader(this.requestHeader);for(let rt=0;rt<this.pluginCallbacks.length;rt++){const lt=this.pluginCallbacks[rt](tt);k[lt.name]=lt,f[lt.name]=!0}if(et.extensionsUsed)for(let rt=0;rt<et.extensionsUsed.length;++rt){const lt=et.extensionsUsed[rt],pt=et.extensionsRequired||[];switch(lt){case Fs.KHR_MATERIALS_UNLIT:f[lt]=new Rw;break;case Fs.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:f[lt]=new R_;break;case Fs.KHR_DRACO_MESH_COMPRESSION:f[lt]=new Ou(et,this.dracoLoader);break;case Fs.KHR_TEXTURE_TRANSFORM:f[lt]=new A1;break;case Fs.KHR_MESH_QUANTIZATION:f[lt]=new k_;break;default:pt.indexOf(lt)>=0&&k[lt]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+lt+'".')}}tt.setExtensions(f),tt.setPlugins(k),tt.parse(s,a)}parseAsync(e,i){const s=this;return new Promise(function(a,h){s.parse(e,i,a,h)})}}function wA(){let c={};return{get:function(e){return c[e]},add:function(e,i){c[e]=i},remove:function(e){delete c[e]},removeAll:function(){c={}}}}const Fs={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class ru{constructor(e){this.parser=e,this.name=Fs.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,i=this.parser.json.nodes||[];for(let s=0,a=i.length;s<a;s++){const h=i[s];h.extensions&&h.extensions[this.name]&&h.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,h.extensions[this.name].light)}}_loadLight(e){const i=this.parser,s="light:"+e;let a=i.cache.get(s);if(a)return a;const h=i.json,f=((h.extensions&&h.extensions[this.name]||{}).lights||[])[e];let k;const et=new d.Ilk(16777215);f.color!==void 0&&et.fromArray(f.color);const tt=f.range!==void 0?f.range:0;switch(f.type){case"directional":k=new d.Ox3(et),k.target.position.set(0,0,-1),k.add(k.target);break;case"point":k=new d.cek(et),k.distance=tt;break;case"spot":k=new d.PMe(et),k.distance=tt,f.spot=f.spot||{},f.spot.innerConeAngle=f.spot.innerConeAngle!==void 0?f.spot.innerConeAngle:0,f.spot.outerConeAngle=f.spot.outerConeAngle!==void 0?f.spot.outerConeAngle:Math.PI/4,k.angle=f.spot.outerConeAngle,k.penumbra=1-f.spot.innerConeAngle/f.spot.outerConeAngle,k.target.position.set(0,0,-1),k.add(k.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+f.type)}return k.position.set(0,0,0),k.decay=2,f.intensity!==void 0&&(k.intensity=f.intensity),k.name=i.createUniqueName(f.name||"light_"+e),a=Promise.resolve(k),i.cache.add(s,a),a}createNodeAttachment(e){const i=this,s=this.parser,a=s.json.nodes[e],h=(a.extensions&&a.extensions[this.name]||{}).light;return h===void 0?null:this._loadLight(h).then(function(f){return s._getNodeRef(i.cache,h,f)})}}class Rw{constructor(){this.name=Fs.KHR_MATERIALS_UNLIT}getMaterialType(){return d.vBJ}extendParams(e,i,s){const a=[];e.color=new d.Ilk(1,1,1),e.opacity=1;const h=i.pbrMetallicRoughness;if(h){if(Array.isArray(h.baseColorFactor)){const f=h.baseColorFactor;e.color.fromArray(f),e.opacity=f[3]}h.baseColorTexture!==void 0&&a.push(s.assignTexture(e,"map",h.baseColorTexture,d.knz))}return Promise.all(a)}}class D_{constructor(e){this.parser=e,this.name=Fs.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name].emissiveStrength;return a!==void 0&&(i.emissiveIntensity=a),Promise.resolve()}}class Ey{constructor(e){this.parser=e,this.name=Fs.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?d.EJi:null}extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],f=a.extensions[this.name];if(f.clearcoatFactor!==void 0&&(i.clearcoat=f.clearcoatFactor),f.clearcoatTexture!==void 0&&h.push(s.assignTexture(i,"clearcoatMap",f.clearcoatTexture)),f.clearcoatRoughnessFactor!==void 0&&(i.clearcoatRoughness=f.clearcoatRoughnessFactor),f.clearcoatRoughnessTexture!==void 0&&h.push(s.assignTexture(i,"clearcoatRoughnessMap",f.clearcoatRoughnessTexture)),f.clearcoatNormalTexture!==void 0&&(h.push(s.assignTexture(i,"clearcoatNormalMap",f.clearcoatNormalTexture)),f.clearcoatNormalTexture.scale!==void 0)){const k=f.clearcoatNormalTexture.scale;i.clearcoatNormalScale=new d.FM8(k,k)}return Promise.all(h)}}class Ju{constructor(e){this.parser=e,this.name=Fs.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?d.EJi:null}extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],f=a.extensions[this.name];return f.iridescenceFactor!==void 0&&(i.iridescence=f.iridescenceFactor),f.iridescenceTexture!==void 0&&h.push(s.assignTexture(i,"iridescenceMap",f.iridescenceTexture)),f.iridescenceIor!==void 0&&(i.iridescenceIOR=f.iridescenceIor),i.iridescenceThicknessRange===void 0&&(i.iridescenceThicknessRange=[100,400]),f.iridescenceThicknessMinimum!==void 0&&(i.iridescenceThicknessRange[0]=f.iridescenceThicknessMinimum),f.iridescenceThicknessMaximum!==void 0&&(i.iridescenceThicknessRange[1]=f.iridescenceThicknessMaximum),f.iridescenceThicknessTexture!==void 0&&h.push(s.assignTexture(i,"iridescenceThicknessMap",f.iridescenceThicknessTexture)),Promise.all(h)}}class Ms{constructor(e){this.parser=e,this.name=Fs.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?d.EJi:null}extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[];i.sheenColor=new d.Ilk(0,0,0),i.sheenRoughness=0,i.sheen=1;const f=a.extensions[this.name];return f.sheenColorFactor!==void 0&&i.sheenColor.fromArray(f.sheenColorFactor),f.sheenRoughnessFactor!==void 0&&(i.sheenRoughness=f.sheenRoughnessFactor),f.sheenColorTexture!==void 0&&h.push(s.assignTexture(i,"sheenColorMap",f.sheenColorTexture,d.knz)),f.sheenRoughnessTexture!==void 0&&h.push(s.assignTexture(i,"sheenRoughnessMap",f.sheenRoughnessTexture)),a.extras&&a.extras.sheenFactor!==void 0&&(i.sheen=a.extras.sheenFactor,delete a.extras.sheenFactor),Promise.all(h)}}class Vm{constructor(e){this.parser=e,this.name=Fs.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?d.EJi:null}extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],f=a.extensions[this.name];return f.transmissionFactor!==void 0&&(i.transmission=f.transmissionFactor),f.transmissionTexture!==void 0&&h.push(s.assignTexture(i,"transmissionMap",f.transmissionTexture)),Promise.all(h)}}class Sy{constructor(e){this.parser=e,this.name=Fs.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?d.EJi:null}extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],f=a.extensions[this.name];i.thickness=f.thicknessFactor!==void 0?f.thicknessFactor:0,f.thicknessTexture!==void 0&&h.push(s.assignTexture(i,"thicknessMap",f.thicknessTexture)),i.attenuationDistance=f.attenuationDistance||0;const k=f.attenuationColor||[1,1,1];return i.attenuationColor=new d.Ilk(k[0],k[1],k[2]),Promise.all(h)}}class Cy{constructor(e){this.parser=e,this.name=Fs.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?d.EJi:null}extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name];return i.ior=a.ior!==void 0?a.ior:1.5,Promise.resolve()}}class qv{constructor(e){this.parser=e,this.name=Fs.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?d.EJi:null}extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],f=a.extensions[this.name];i.specularIntensity=f.specularFactor!==void 0?f.specularFactor:1,f.specularTexture!==void 0&&h.push(s.assignTexture(i,"specularIntensityMap",f.specularTexture));const k=f.specularColorFactor||[1,1,1];return i.specularColor=new d.Ilk(k[0],k[1],k[2]),f.specularColorTexture!==void 0&&h.push(s.assignTexture(i,"specularColorMap",f.specularColorTexture,d.knz)),Promise.all(h)}}class lp{constructor(e){this.parser=e,this.name=Fs.KHR_TEXTURE_BASISU}loadTexture(e){const i=this.parser,s=i.json,a=s.textures[e];if(!a.extensions||!a.extensions[this.name])return null;const h=a.extensions[this.name],f=i.options.ktx2Loader;if(!f){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return i.loadTextureImage(e,h.source,f)}}class fv{constructor(e){this.parser=e,this.name=Fs.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const i=this.name,s=this.parser,a=s.json,h=a.textures[e];if(!h.extensions||!h.extensions[i])return null;const f=h.extensions[i],k=a.images[f.source];let et=s.textureLoader;if(k.uri){const tt=s.options.manager.getHandler(k.uri);tt!==null&&(et=tt)}return this.detectSupport().then(function(tt){if(tt)return s.loadTextureImage(e,f.source,et);if(a.extensionsRequired&&a.extensionsRequired.indexOf(i)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const i=new Image;i.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",i.onload=i.onerror=function(){e(i.height===1)}})),this.isSupported}}class Zo{constructor(e){this.name=Fs.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const i=this.parser.json,s=i.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const a=s.extensions[this.name],h=this.parser.getDependency("buffer",a.buffer),f=this.parser.options.meshoptDecoder;if(!f||!f.supported){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return h.then(function(k){const et=a.byteOffset||0,tt=a.byteLength||0,rt=a.count,lt=a.byteStride,pt=new Uint8Array(k,et,tt);return f.decodeGltfBufferAsync?f.decodeGltfBufferAsync(rt,lt,pt,a.mode,a.filter).then(function(ft){return ft.buffer}):f.ready.then(function(){const ft=new ArrayBuffer(rt*lt);return f.decodeGltfBuffer(new Uint8Array(ft),rt,lt,pt,a.mode,a.filter),ft})})}return null}}const xA="glTF";class Rr{constructor(e){this.name=Fs.KHR_BINARY_GLTF,this.content=null,this.body=null;const i=new DataView(e,0,12);if(this.header={magic:d.Zp0.decodeText(new Uint8Array(e.slice(0,4))),version:i.getUint32(4,!0),length:i.getUint32(8,!0)},this.header.magic!==xA)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-12,a=new DataView(e,12);let h=0;for(;h<s;){const f=a.getUint32(h,!0);h+=4;const k=a.getUint32(h,!0);if(h+=4,k===1313821514){const et=new Uint8Array(e,12+h,f);this.content=d.Zp0.decodeText(et)}else if(k===5130562){const et=12+h;this.body=e.slice(et,et+f)}h+=f}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Ou{constructor(e,i){if(!i)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Fs.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=i,this.dracoLoader.preload()}decodePrimitive(e,i){const s=this.json,a=this.dracoLoader,h=e.extensions[this.name].bufferView,f=e.extensions[this.name].attributes,k={},et={},tt={};for(const rt in f){const lt=C0[rt]||rt.toLowerCase();k[lt]=f[rt]}for(const rt in e.attributes){const lt=C0[rt]||rt.toLowerCase();if(f[rt]!==void 0){const pt=s.accessors[e.attributes[rt]],ft=Zu[pt.componentType];tt[lt]=ft.name,et[lt]=pt.normalized===!0}}return i.getDependency("bufferView",h).then(function(rt){return new Promise(function(lt){a.decodeDracoFile(rt,function(pt){for(const ft in pt.attributes){const vt=pt.attributes[ft],yt=et[ft];yt!==void 0&&(vt.normalized=yt)}lt(pt)},k,tt)})})}}class A1{constructor(){this.name=Fs.KHR_TEXTURE_TRANSFORM}extendTexture(e,i){return i.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),i.offset===void 0&&i.rotation===void 0&&i.scale===void 0||(e=e.clone(),i.offset!==void 0&&e.offset.fromArray(i.offset),i.rotation!==void 0&&(e.rotation=i.rotation),i.scale!==void 0&&e.repeat.fromArray(i.scale),e.needsUpdate=!0),e}}class kw extends d.Wid{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const i=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),s=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),a=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),h=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),f=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),k={specular:{value:new d.Ilk().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=k,this.onBeforeCompile=function(et){for(const tt in k)et.uniforms[tt]=k[tt];et.fragmentShader=et.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",i).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",a).replace("#include <metalnessmap_fragment>",h).replace("#include <lights_physical_fragment>",f)},Object.defineProperties(this,{specular:{get:function(){return k.specular.value},set:function(et){k.specular.value=et}},specularMap:{get:function(){return k.specularMap.value},set:function(et){k.specularMap.value=et,et?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return k.glossiness.value},set:function(et){k.glossiness.value=et}},glossinessMap:{get:function(){return k.glossinessMap.value},set:function(et){k.glossinessMap.value=et,et?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class R_{constructor(){this.name=Fs.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return kw}extendParams(e,i,s){const a=i.extensions[this.name];e.color=new d.Ilk(1,1,1),e.opacity=1;const h=[];if(Array.isArray(a.diffuseFactor)){const f=a.diffuseFactor;e.color.fromArray(f),e.opacity=f[3]}if(a.diffuseTexture!==void 0&&h.push(s.assignTexture(e,"map",a.diffuseTexture,d.knz)),e.emissive=new d.Ilk(0,0,0),e.glossiness=a.glossinessFactor!==void 0?a.glossinessFactor:1,e.specular=new d.Ilk(1,1,1),Array.isArray(a.specularFactor)&&e.specular.fromArray(a.specularFactor),a.specularGlossinessTexture!==void 0){const f=a.specularGlossinessTexture;h.push(s.assignTexture(e,"glossinessMap",f)),h.push(s.assignTexture(e,"specularMap",f,d.knz))}return Promise.all(h)}createMaterial(e){const i=new kw(e);return i.fog=!0,i.color=e.color,i.map=e.map===void 0?null:e.map,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=e.aoMap===void 0?null:e.aoMap,i.aoMapIntensity=1,i.emissive=e.emissive,i.emissiveIntensity=e.emissiveIntensity===void 0?1:e.emissiveIntensity,i.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,i.bumpMap=e.bumpMap===void 0?null:e.bumpMap,i.bumpScale=1,i.normalMap=e.normalMap===void 0?null:e.normalMap,i.normalMapType=d.IOt,e.normalScale&&(i.normalScale=e.normalScale),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.specularMap=e.specularMap===void 0?null:e.specularMap,i.specular=e.specular,i.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,i.glossiness=e.glossiness,i.alphaMap=null,i.envMap=e.envMap===void 0?null:e.envMap,i.envMapIntensity=1,i}}class k_{constructor(){this.name=Fs.KHR_MESH_QUANTIZATION}}class wm extends d._C8{constructor(e,i,s,a){super(e,i,s,a)}copySampleValue_(e){const i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,h=e*a*3+a;for(let f=0;f!==a;f++)i[f]=s[h+f];return i}interpolate_(e,i,s,a){const h=this.resultBuffer,f=this.sampleValues,k=this.valueSize,et=2*k,tt=3*k,rt=a-i,lt=(s-i)/rt,pt=lt*lt,ft=pt*lt,vt=e*tt,yt=vt-tt,Mt=-2*ft+3*pt,xt=ft-pt,Et=1-Mt,At=xt-pt+lt;for(let Rt=0;Rt!==k;Rt++){const Bt=f[yt+Rt+k],Qt=f[yt+Rt+et]*rt,Wt=f[vt+Rt+k],tn=f[vt+Rt]*rt;h[Rt]=Et*Bt+At*Qt+Mt*Wt+xt*tn}return h}}const My=new d._fP;class S0 extends wm{interpolate_(e,i,s,a){const h=super.interpolate_(e,i,s,a);return My.fromArray(h).normalize().toArray(h),h}}const Zu={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},bA={9728:d.TyD,9729:d.wem,9984:d.YLQ,9985:d.qyh,9986:d.aH4,9987:d.D1R},Vl={33071:d.uWy,33648:d.OoA,10497:d.rpg},Jp={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},C0={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},kp={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},EA={CUBICSPLINE:void 0,LINEAR:d.NMF,STEP:d.Syv};function is(c,e,i){for(const s in i.extensions)c[s]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=i.extensions[s])}function Zp(c,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(c.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Ty(c,e){if(c.updateMorphTargets(),e.weights!==void 0)for(let i=0,s=e.weights.length;i<s;i++)c.morphTargetInfluences[i]=e.weights[i];if(e.extras&&Array.isArray(e.extras.targetNames)){const i=e.extras.targetNames;if(c.morphTargetInfluences.length===i.length){c.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++)c.morphTargetDictionary[i[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function B_(c){const e=c.extensions&&c.extensions[Fs.KHR_DRACO_MESH_COMPRESSION];let i;return i=e?"draco:"+e.bufferView+":"+e.indices+":"+M0(e.attributes):c.indices+":"+M0(c.attributes)+":"+c.mode,i}function M0(c){let e="";const i=Object.keys(c).sort();for(let s=0,a=i.length;s<a;s++)e+=i[s]+":"+c[i[s]]+";";return e}function Bw(c){switch(c){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class yu{constructor(e={},i={}){this.json=e,this.extensions={},this.plugins={},this.options=i,this.cache=new wA,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const s=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,a=navigator.userAgent.indexOf("Firefox")>-1,h=a?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;typeof createImageBitmap>"u"||s||a&&h<98?this.textureLoader=new d.dpR(this.options.manager):this.textureLoader=new d.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new d.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,i){const s=this,a=this.json,h=this.extensions;this.cache.removeAll(),this._invokeAll(function(f){return f._markDefs&&f._markDefs()}),Promise.all(this._invokeAll(function(f){return f.beforeRoot&&f.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(f){const k={scene:f[0][a.scene||0],scenes:f[0],animations:f[1],cameras:f[2],asset:a.asset,parser:s,userData:{}};is(h,k,a),Zp(k,a),Promise.all(s._invokeAll(function(et){return et.afterRoot&&et.afterRoot(k)})).then(function(){e(k)})}).catch(i)}_markDefs(){const e=this.json.nodes||[],i=this.json.skins||[],s=this.json.meshes||[];for(let a=0,h=i.length;a<h;a++){const f=i[a].joints;for(let k=0,et=f.length;k<et;k++)e[f[k]].isBone=!0}for(let a=0,h=e.length;a<h;a++){const f=e[a];f.mesh!==void 0&&(this._addNodeRef(this.meshCache,f.mesh),f.skin!==void 0&&(s[f.mesh].isSkinnedMesh=!0)),f.camera!==void 0&&this._addNodeRef(this.cameraCache,f.camera)}}_addNodeRef(e,i){i!==void 0&&(e.refs[i]===void 0&&(e.refs[i]=e.uses[i]=0),e.refs[i]++)}_getNodeRef(e,i,s){if(e.refs[i]<=1)return s;const a=s.clone(),h=(f,k)=>{const et=this.associations.get(f);et!=null&&this.associations.set(k,et);for(const[tt,rt]of f.children.entries())h(rt,k.children[tt])};return h(s,a),a.name+="_instance_"+e.uses[i]++,a}_invokeOne(e){const i=Object.values(this.plugins);i.push(this);for(let s=0;s<i.length;s++){const a=e(i[s]);if(a)return a}return null}_invokeAll(e){const i=Object.values(this.plugins);i.unshift(this);const s=[];for(let a=0;a<i.length;a++){const h=e(i[a]);h&&s.push(h)}return s}getDependency(e,i){const s=e+":"+i;let a=this.cache.get(s);if(!a){switch(e){case"scene":a=this.loadScene(i);break;case"node":a=this.loadNode(i);break;case"mesh":a=this._invokeOne(function(h){return h.loadMesh&&h.loadMesh(i)});break;case"accessor":a=this.loadAccessor(i);break;case"bufferView":a=this._invokeOne(function(h){return h.loadBufferView&&h.loadBufferView(i)});break;case"buffer":a=this.loadBuffer(i);break;case"material":a=this._invokeOne(function(h){return h.loadMaterial&&h.loadMaterial(i)});break;case"texture":a=this._invokeOne(function(h){return h.loadTexture&&h.loadTexture(i)});break;case"skin":a=this.loadSkin(i);break;case"animation":a=this._invokeOne(function(h){return h.loadAnimation&&h.loadAnimation(i)});break;case"camera":a=this.loadCamera(i);break;default:throw new Error("Unknown type: "+e)}this.cache.add(s,a)}return a}getDependencies(e){let i=this.cache.get(e);if(!i){const s=this,a=this.json[e+(e==="mesh"?"es":"s")]||[];i=Promise.all(a.map(function(h,f){return s.getDependency(e,f)})),this.cache.add(e,i)}return i}loadBuffer(e){const i=this.json.buffers[e],s=this.fileLoader;if(i.type&&i.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+i.type+" buffer type is not supported.");if(i.uri===void 0&&e===0)return Promise.resolve(this.extensions[Fs.KHR_BINARY_GLTF].body);const a=this.options;return new Promise(function(h,f){s.load(d.Zp0.resolveURL(i.uri,a.path),h,void 0,function(){f(new Error('THREE.GLTFLoader: Failed to load buffer "'+i.uri+'".'))})})}loadBufferView(e){const i=this.json.bufferViews[e];return this.getDependency("buffer",i.buffer).then(function(s){const a=i.byteLength||0,h=i.byteOffset||0;return s.slice(h,h+a)})}loadAccessor(e){const i=this,s=this.json,a=this.json.accessors[e];if(a.bufferView===void 0&&a.sparse===void 0)return Promise.resolve(null);const h=[];return a.bufferView!==void 0?h.push(this.getDependency("bufferView",a.bufferView)):h.push(null),a.sparse!==void 0&&(h.push(this.getDependency("bufferView",a.sparse.indices.bufferView)),h.push(this.getDependency("bufferView",a.sparse.values.bufferView))),Promise.all(h).then(function(f){const k=f[0],et=Jp[a.type],tt=Zu[a.componentType],rt=tt.BYTES_PER_ELEMENT,lt=rt*et,pt=a.byteOffset||0,ft=a.bufferView!==void 0?s.bufferViews[a.bufferView].byteStride:void 0,vt=a.normalized===!0;let yt,Mt;if(ft&&ft!==lt){const xt=Math.floor(pt/ft),Et="InterleavedBuffer:"+a.bufferView+":"+a.componentType+":"+xt+":"+a.count;let At=i.cache.get(Et);At||(yt=new tt(k,xt*ft,a.count*ft/rt),At=new d.vpT(yt,ft/rt),i.cache.add(Et,At)),Mt=new d.kB5(At,et,pt%ft/rt,vt)}else yt=k===null?new tt(a.count*et):new tt(k,pt,a.count*et),Mt=new d.TlE(yt,et,vt);if(a.sparse!==void 0){const xt=Jp.SCALAR,Et=Zu[a.sparse.indices.componentType],At=a.sparse.indices.byteOffset||0,Rt=a.sparse.values.byteOffset||0,Bt=new Et(f[1],At,a.sparse.count*xt),Qt=new tt(f[2],Rt,a.sparse.count*et);k!==null&&(Mt=new d.TlE(Mt.array.slice(),Mt.itemSize,Mt.normalized));for(let Wt=0,tn=Bt.length;Wt<tn;Wt++){const pn=Bt[Wt];if(Mt.setX(pn,Qt[Wt*et]),et>=2&&Mt.setY(pn,Qt[Wt*et+1]),et>=3&&Mt.setZ(pn,Qt[Wt*et+2]),et>=4&&Mt.setW(pn,Qt[Wt*et+3]),et>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return Mt})}loadTexture(e){const i=this.json,s=this.options,a=i.textures[e].source,h=i.images[a];let f=this.textureLoader;if(h.uri){const k=s.manager.getHandler(h.uri);k!==null&&(f=k)}return this.loadTextureImage(e,a,f)}loadTextureImage(e,i,s){const a=this,h=this.json,f=h.textures[e],k=h.images[i],et=(k.uri||k.bufferView)+":"+f.sampler;if(this.textureCache[et])return this.textureCache[et];const tt=this.loadImageSource(i,s).then(function(rt){f.name&&(rt.name=f.name);const lt=(h.samplers||{})[f.sampler]||{};return rt.magFilter=bA[lt.magFilter]||d.wem,rt.minFilter=bA[lt.minFilter]||d.D1R,rt.wrapS=Vl[lt.wrapS]||d.rpg,rt.wrapT=Vl[lt.wrapT]||d.rpg,lt.extras&&lt.extras.uuid!==void 0&&(rt.uuid=lt.extras.uuid),a.associations.set(rt,{textures:e}),rt}).catch(function(){return null});return this.textureCache[et]=tt,tt}loadImageSource(e,i){const s=this,a=this.json,h=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(lt=>lt.clone());const f=a.images[e],k=self.URL||self.webkitURL;let et=f.uri||"",tt=!1;if(f.bufferView!==void 0)et=s.getDependency("bufferView",f.bufferView).then(function(lt){tt=!0;const pt=new Blob([lt],{type:f.mimeType});return et=k.createObjectURL(pt),et});else if(f.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const rt=Promise.resolve(et).then(function(lt){return new Promise(function(pt,ft){let vt=pt;i.isImageBitmapLoader===!0&&(vt=function(yt){const Mt=new d.xEZ(yt);Mt.needsUpdate=!0,pt(Mt)}),i.load(d.Zp0.resolveURL(lt,h.path),vt,void 0,function(yt){i.isImageBitmapLoader===!0?(i=new d.dpR(s.options.manager),vt=pt,i.setCrossOrigin(s.options.crossOrigin),i.setRequestHeader(s.options.requestHeader),i.load(d.Zp0.resolveURL(lt,h.path),vt,void 0,ft)):ft(yt)})})}).then(function(lt){var pt;if(tt===!0&&k.revokeObjectURL(et),lt.userData.mimeType=f.mimeType||((pt=f.uri).search(/\.jpe?g($|\?)/i)>0||pt.search(/^data\:image\/jpeg/)===0?"image/jpeg":pt.search(/\.webp($|\?)/i)>0||pt.search(/^data\:image\/webp/)===0?"image/webp":"image/png"),lt.flipY=!1,f.extras){if(f.extras.flipY!==void 0){if(i.isImageBitmapLoader===!0&&typeof createImageBitmap!==void 0){const ft=lt,vt=f.extras.flipY&&!ft.flipY;createImageBitmap(ft.source.data,{imageOrientation:vt?"flipY":"none"}).then(function(yt){ft.source.data.close&&ft.source.data.close(),ft.source.data=yt,ft.source.needsUpdate=!0,ft.needsUpdate=!0})}lt.flipY=f.extras.flipY,lt.needsUpdate=!0,delete f.extras.flipY}f.extras.uuid!==void 0&&(lt.source.uuid=f.extras.uuid),f.extras.t_uuid!==void 0&&(lt.uuid=f.extras.t_uuid)}return f.uri&&typeof f.uri=="string"&&(lt.userData.rootPath=f.uri),lt}).catch(function(lt){throw console.error("THREE.GLTFLoader: Couldn't load texture",et),lt});return this.sourceCache[e]=rt,rt}assignTexture(e,i,s,a){const h=this;return this.getDependency("texture",s.index).then(function(f){if(s.texCoord===void 0||s.texCoord==0||i==="aoMap"&&s.texCoord==1||console.warn("THREE.GLTFLoader: Custom UV set "+s.texCoord+" for texture "+i+" not yet supported."),h.extensions[Fs.KHR_TEXTURE_TRANSFORM]){const k=s.extensions!==void 0?s.extensions[Fs.KHR_TEXTURE_TRANSFORM]:void 0;if(k){const et=h.associations.get(f);f=h.extensions[Fs.KHR_TEXTURE_TRANSFORM].extendTexture(f,k),h.associations.set(f,et)}}return a!==void 0&&(f.encoding=a),e[i]=f,f})}assignFinalMaterial(e){const i=e.geometry;let s=e.material;const a=i.attributes.tangent===void 0,h=i.attributes.color!==void 0,f=i.attributes.normal===void 0;if(e.isPoints){const k="PointsMaterial:"+s.uuid;let et=this.cache.get(k);et||(et=new d.UY4,d.F5T.prototype.copy.call(et,s),et.color.copy(s.color),et.map=s.map,et.sizeAttenuation=!1,this.cache.add(k,et)),s=et}else if(e.isLine){const k="LineBasicMaterial:"+s.uuid;let et=this.cache.get(k);et||(et=new d.nls,d.F5T.prototype.copy.call(et,s),et.color.copy(s.color),this.cache.add(k,et)),s=et}if(a||h||f){let k="ClonedMaterial:"+s.uuid+":";s.isGLTFSpecularGlossinessMaterial&&(k+="specular-glossiness:"),a&&(k+="derivative-tangents:"),h&&(k+="vertex-colors:"),f&&(k+="flat-shading:");let et=this.cache.get(k);et||(et=s.clone(),h&&(et.vertexColors=!0),f&&(et.flatShading=!0),a&&(et.normalScale&&(et.normalScale.y*=-1),et.clearcoatNormalScale&&(et.clearcoatNormalScale.y*=-1)),this.cache.add(k,et),this.associations.set(et,this.associations.get(s))),s=et}s.aoMap&&i.attributes.uv2===void 0&&i.attributes.uv!==void 0&&i.setAttribute("uv2",i.attributes.uv),e.material=s}getMaterialType(){return d.Wid}loadMaterial(e){const i=this,s=this.json,a=this.extensions,h=s.materials[e];let f;const k={},et=h.extensions||{},tt=[];if(et[Fs.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const lt=a[Fs.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];f=lt.getMaterialType(),tt.push(lt.extendParams(k,h,i))}else if(et[Fs.KHR_MATERIALS_UNLIT]){const lt=a[Fs.KHR_MATERIALS_UNLIT];f=lt.getMaterialType(),tt.push(lt.extendParams(k,h,i))}else{const lt=h.pbrMetallicRoughness||{};if(k.color=new d.Ilk(1,1,1),k.opacity=1,Array.isArray(lt.baseColorFactor)){const pt=lt.baseColorFactor;k.color.fromArray(pt),k.opacity=pt[3]}lt.baseColorTexture!==void 0&&tt.push(i.assignTexture(k,"map",lt.baseColorTexture,d.knz)),k.metalness=lt.metallicFactor!==void 0?lt.metallicFactor:1,k.roughness=lt.roughnessFactor!==void 0?lt.roughnessFactor:1,lt.metallicRoughnessTexture!==void 0&&(tt.push(i.assignTexture(k,"metalnessMap",lt.metallicRoughnessTexture)),tt.push(i.assignTexture(k,"roughnessMap",lt.metallicRoughnessTexture))),f=this._invokeOne(function(pt){return pt.getMaterialType&&pt.getMaterialType(e)}),tt.push(Promise.all(this._invokeAll(function(pt){return pt.extendMaterialParams&&pt.extendMaterialParams(e,k)})))}h.doubleSided===!0&&(k.side=d.ehD);const rt=h.alphaMode||"OPAQUE";if(rt==="BLEND"?(k.transparent=!0,k.depthWrite=!1):(k.transparent=!1,rt==="MASK"&&(k.alphaTest=h.alphaCutoff!==void 0?h.alphaCutoff:.5)),h.normalTexture!==void 0&&f!==d.vBJ&&(tt.push(i.assignTexture(k,"normalMap",h.normalTexture)),k.normalScale=new d.FM8(1,1),h.normalTexture.scale!==void 0)){const lt=h.normalTexture.scale;k.normalScale.set(lt,lt)}return h.occlusionTexture!==void 0&&f!==d.vBJ&&(tt.push(i.assignTexture(k,"aoMap",h.occlusionTexture)),h.occlusionTexture.strength!==void 0&&(k.aoMapIntensity=h.occlusionTexture.strength)),h.emissiveFactor!==void 0&&f!==d.vBJ&&(k.emissive=new d.Ilk().fromArray(h.emissiveFactor)),h.emissiveTexture!==void 0&&f!==d.vBJ&&tt.push(i.assignTexture(k,"emissiveMap",h.emissiveTexture,d.knz)),Promise.all(tt).then(function(){let lt;return lt=f===kw?a[Fs.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(k):new f(k),h.name&&(lt.name=h.name),Zp(lt,h),i.associations.set(lt,{materials:e}),h.extensions&&is(a,lt,h),lt})}createUniqueName(e){const i=d.iUV.sanitizeNodeName(e||"");let s=i;for(let a=1;this.nodeNamesUsed[s];++a)s=i+"_"+a;return this.nodeNamesUsed[s]=!0,s}loadGeometries(e){const i=this,s=this.extensions,a=this.primitiveCache;function h(k){return s[Fs.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(k,i).then(function(et){return xp(et,k,i)})}const f=[];for(let k=0,et=e.length;k<et;k++){const tt=e[k],rt=B_(tt),lt=a[rt];if(lt)f.push(lt.promise);else{let pt;pt=tt.extensions&&tt.extensions[Fs.KHR_DRACO_MESH_COMPRESSION]?h(tt):xp(new d.u9r,tt,i),a[rt]={primitive:tt,promise:pt},f.push(pt)}}return Promise.all(f)}loadMesh(e){const i=this,s=this.json,a=this.extensions,h=s.meshes[e],f=h.primitives,k=[];for(let tt=0,rt=f.length;tt<rt;tt++){const lt=f[tt].material===void 0?((et=this.cache).DefaultMaterial===void 0&&(et.DefaultMaterial=new d.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:d.Wl3})),et.DefaultMaterial):this.getDependency("material",f[tt].material);k.push(lt)}var et;return k.push(i.loadGeometries(f)),Promise.all(k).then(function(tt){const rt=tt.slice(0,tt.length-1),lt=tt[tt.length-1],pt=[];for(let vt=0,yt=lt.length;vt<yt;vt++){const Mt=lt[vt],xt=f[vt];let Et;const At=rt[vt];if(xt.mode===4||xt.mode===5||xt.mode===6||xt.mode===void 0)Et=h.isSkinnedMesh===!0?new d.TUv(Mt,At):new d.Kj0(Mt,At),Et.isSkinnedMesh!==!0||Et.geometry.attributes.skinWeight.normalized||Et.normalizeSkinWeights(),xt.mode===5?Et.geometry=T0(Et.geometry,d.UlW):xt.mode===6&&(Et.geometry=T0(Et.geometry,d.z$h));else if(xt.mode===1)Et=new d.ejS(Mt,At);else if(xt.mode===3)Et=new d.x12(Mt,At);else if(xt.mode===2)Et=new d.blk(Mt,At);else{if(xt.mode!==0)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+xt.mode);Et=new d.woe(Mt,At)}Object.keys(Et.geometry.morphAttributes).length>0&&Ty(Et,h),Et.name=i.createUniqueName(h.name||"mesh_"+e),Zp(Et,h),xt.extensions&&is(a,Et,xt),i.assignFinalMaterial(Et),pt.push(Et)}h.extensions&&pt.forEach(vt=>is(a,vt,h));for(let vt=0,yt=pt.length;vt<yt;vt++)i.associations.set(pt[vt],{meshes:e,primitives:vt});if(pt.length===1)return pt[0];const ft=new d.ZAu;i.associations.set(ft,{meshes:e});for(let vt=0,yt=pt.length;vt<yt;vt++)ft.add(pt[vt]);return ft})}loadCamera(e){let i;const s=this.json.cameras[e],a=s[s.type];if(a)return s.type==="perspective"?i=new d.cPb(d.M8C.radToDeg(a.yfov),a.aspectRatio||1,a.znear||1,a.zfar||2e6):s.type==="orthographic"&&(i=new d.iKG(-a.xmag,a.xmag,a.ymag,-a.ymag,a.znear,a.zfar)),s.name&&(i.name=this.createUniqueName(s.name)),Zp(i,s),Promise.resolve(i);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const i=this.json.skins[e],s={joints:i.joints};return i.inverseBindMatrices===void 0?Promise.resolve(s):this.getDependency("accessor",i.inverseBindMatrices).then(function(a){return s.inverseBindMatrices=a,s})}loadAnimation(e){const i=this.json.animations[e],s=[],a=[],h=[],f=[],k=[];for(let et=0,tt=i.channels.length;et<tt;et++){const rt=i.channels[et],lt=i.samplers[rt.sampler],pt=rt.target,ft=pt.node,vt=i.parameters!==void 0?i.parameters[lt.input]:lt.input,yt=i.parameters!==void 0?i.parameters[lt.output]:lt.output;s.push(this.getDependency("node",ft)),a.push(this.getDependency("accessor",vt)),h.push(this.getDependency("accessor",yt)),f.push(lt),k.push(pt)}return Promise.all([Promise.all(s),Promise.all(a),Promise.all(h),Promise.all(f),Promise.all(k)]).then(function(et){const tt=et[0],rt=et[1],lt=et[2],pt=et[3],ft=et[4],vt=[];for(let Mt=0,xt=tt.length;Mt<xt;Mt++){const Et=tt[Mt],At=rt[Mt],Rt=lt[Mt],Bt=pt[Mt],Qt=ft[Mt];if(Et===void 0)continue;let Wt;switch(Et.updateMatrix(),kp[Qt.path]){case kp.weights:Wt=d.dUE;break;case kp.rotation:Wt=d.iLg;break;default:Wt=d.yC1}const tn=Et.name?Et.name:Et.uuid,pn=Bt.interpolation!==void 0?EA[Bt.interpolation]:d.NMF,yn=[];kp[Qt.path]===kp.weights?Et.traverse(function(wn){wn.morphTargetInfluences&&yn.push(wn.name?wn.name:wn.uuid)}):yn.push(tn);let En=Rt.array;if(Rt.normalized){const wn=Bw(En.constructor),In=new Float32Array(En.length);for(let xn=0,Cn=En.length;xn<Cn;xn++)In[xn]=En[xn]*wn;En=In}for(let wn=0,In=yn.length;wn<In;wn++){const xn=new Wt(yn[wn]+"."+kp[Qt.path],At.array,En,pn);Bt.interpolation==="CUBICSPLINE"&&(xn.createInterpolant=function(Cn){return new(this instanceof d.iLg?S0:wm)(this.times,this.values,this.getValueSize()/3,Cn)},xn.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),vt.push(xn)}}const yt=i.name?i.name:"animation_"+e;return new d.m7l(yt,void 0,vt)})}createNodeMesh(e){const i=this.json,s=this,a=i.nodes[e];return a.mesh===void 0?null:s.getDependency("mesh",a.mesh).then(function(h){const f=s._getNodeRef(s.meshCache,a.mesh,h);return a.weights!==void 0&&f.traverse(function(k){if(k.isMesh)for(let et=0,tt=a.weights.length;et<tt;et++)k.morphTargetInfluences[et]=a.weights[et]}),f})}loadNode(e){const i=this.json,s=this.extensions,a=this,h=i.nodes[e],f=h.name?a.createUniqueName(h.name):"";return function(){const k=[],et=a._invokeOne(function(tt){return tt.createNodeMesh&&tt.createNodeMesh(e)});return et&&k.push(et),h.camera!==void 0&&k.push(a.getDependency("camera",h.camera).then(function(tt){return a._getNodeRef(a.cameraCache,h.camera,tt)})),a._invokeAll(function(tt){return tt.createNodeAttachment&&tt.createNodeAttachment(e)}).forEach(function(tt){k.push(tt)}),Promise.all(k)}().then(function(k){let et;if(et=h.isBone===!0?new d.N$j:k.length>1?new d.ZAu:k.length===1?k[0]:new d.Tme,et!==k[0])for(let tt=0,rt=k.length;tt<rt;tt++)et.add(k[tt]);if(h.name&&(et.userData.name=h.name,et.name=f),Zp(et,h),h.extensions&&is(s,et,h),h.matrix!==void 0){const tt=new d.yGw;tt.fromArray(h.matrix),et.applyMatrix4(tt)}else h.translation!==void 0&&et.position.fromArray(h.translation),h.rotation!==void 0&&et.quaternion.fromArray(h.rotation),h.scale!==void 0&&et.scale.fromArray(h.scale);return a.associations.has(et)||a.associations.set(et,{}),a.associations.get(et).nodes=e,et})}loadScene(e){const i=this.json,s=this.extensions,a=this.json.scenes[e],h=this,f=new d.ZAu;a.name&&(f.name=h.createUniqueName(a.name)),Zp(f,a),a.extensions&&is(s,f,a);const k=a.nodes||[],et=[];for(let tt=0,rt=k.length;tt<rt;tt++)et.push(Fo(k[tt],f,i,h));return Promise.all(et).then(function(){return h.associations=(tt=>{const rt=new Map;for(const[lt,pt]of h.associations)(lt instanceof d.F5T||lt instanceof d.xEZ)&&rt.set(lt,pt);return tt.traverse(lt=>{const pt=h.associations.get(lt);pt!=null&&rt.set(lt,pt)}),rt})(f),f})}}function Fo(c,e,i,s){const a=i.nodes[c];return s.getDependency("node",c).then(function(h){if(a.skin===void 0)return h;let f;return s.getDependency("skin",a.skin).then(function(k){f=k;const et=[];for(let tt=0,rt=f.joints.length;tt<rt;tt++)et.push(s.getDependency("node",f.joints[tt]));return Promise.all(et)}).then(function(k){return h.traverse(function(et){if(!et.isMesh)return;const tt=[],rt=[];for(let lt=0,pt=k.length;lt<pt;lt++){const ft=k[lt];if(ft){tt.push(ft);const vt=new d.yGw;f.inverseBindMatrices!==void 0&&vt.fromArray(f.inverseBindMatrices.array,16*lt),rt.push(vt)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',f.joints[lt])}et.bind(new d.OdW(tt,rt),et.matrixWorld)}),h})}).then(function(h){e.add(h);const f=[];if(a.children){const k=a.children;for(let et=0,tt=k.length;et<tt;et++){const rt=k[et];f.push(Fo(rt,h,i,s))}}return Promise.all(f)})}function xp(c,e,i){const s=e.attributes,a=[];function h(f,k){return i.getDependency("accessor",f).then(function(et){c.setAttribute(k,et)})}for(const f in s){const k=C0[f]||f.toLowerCase();k in c.attributes||a.push(h(s[f],k))}if(e.indices!==void 0&&!c.index){const f=i.getDependency("accessor",e.indices).then(function(k){c.setIndex(k)});a.push(f)}return Zp(c,e),function(f,k,et){const tt=k.attributes,rt=new d.ZzF;if(tt.POSITION===void 0)return;{const ft=et.json.accessors[tt.POSITION],vt=ft.min,yt=ft.max;if(vt===void 0||yt===void 0)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(rt.set(new d.Pa4(vt[0],vt[1],vt[2]),new d.Pa4(yt[0],yt[1],yt[2])),ft.normalized){const Mt=Bw(Zu[ft.componentType]);rt.min.multiplyScalar(Mt),rt.max.multiplyScalar(Mt)}}const lt=k.targets;if(lt!==void 0){const ft=new d.Pa4,vt=new d.Pa4;for(let yt=0,Mt=lt.length;yt<Mt;yt++){const xt=lt[yt];if(xt.POSITION!==void 0){const Et=et.json.accessors[xt.POSITION],At=Et.min,Rt=Et.max;if(At!==void 0&&Rt!==void 0){if(vt.setX(Math.max(Math.abs(At[0]),Math.abs(Rt[0]))),vt.setY(Math.max(Math.abs(At[1]),Math.abs(Rt[1]))),vt.setZ(Math.max(Math.abs(At[2]),Math.abs(Rt[2]))),Et.normalized){const Bt=Bw(Zu[Et.componentType]);vt.multiplyScalar(Bt)}ft.max(vt)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}rt.expandByVector(ft)}f.boundingBox=rt;const pt=new d.aLr;rt.getCenter(pt.center),pt.radius=rt.min.distanceTo(rt.max)/2,f.boundingSphere=pt}(c,e,i),Promise.all(a).then(function(){return e.targets!==void 0?function(f,k,et){let tt=!1,rt=!1,lt=!1;for(let yt=0,Mt=k.length;yt<Mt;yt++){const xt=k[yt];if(xt.POSITION!==void 0&&(tt=!0),xt.NORMAL!==void 0&&(rt=!0),xt.COLOR_0!==void 0&&(lt=!0),tt&&rt&&lt)break}if(!tt&&!rt&&!lt)return Promise.resolve(f);const pt=[],ft=[],vt=[];for(let yt=0,Mt=k.length;yt<Mt;yt++){const xt=k[yt];if(tt){const Et=xt.POSITION!==void 0?et.getDependency("accessor",xt.POSITION):f.attributes.position;pt.push(Et)}if(rt){const Et=xt.NORMAL!==void 0?et.getDependency("accessor",xt.NORMAL):f.attributes.normal;ft.push(Et)}if(lt){const Et=xt.COLOR_0!==void 0?et.getDependency("accessor",xt.COLOR_0):f.attributes.color;vt.push(Et)}}return Promise.all([Promise.all(pt),Promise.all(ft),Promise.all(vt)]).then(function(yt){const Mt=yt[0],xt=yt[1],Et=yt[2];return tt&&(f.morphAttributes.position=Mt),rt&&(f.morphAttributes.normal=xt),lt&&(f.morphAttributes.color=Et),f.morphTargetsRelative=!0,f})}(c,e.targets,i):c})}function T0(c,e){let i=c.getIndex();if(i===null){const f=[],k=c.getAttribute("position");if(k===void 0)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),c;for(let et=0;et<k.count;et++)f.push(et);c.setIndex(f),i=c.getIndex()}const s=i.count-2,a=[];if(e===d.z$h)for(let f=1;f<=s;f++)a.push(i.getX(0)),a.push(i.getX(f)),a.push(i.getX(f+1));else for(let f=0;f<s;f++)f%2==0?(a.push(i.getX(f)),a.push(i.getX(f+1)),a.push(i.getX(f+2))):(a.push(i.getX(f+2)),a.push(i.getX(f+1)),a.push(i.getX(f)));a.length/3!==s&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const h=c.clone();return h.setIndex(a),h}class w1 extends pv{constructor(e){super(e),this.isGLTFLoader2=!0}async loadAsync(e,i){const s=await super.loadAsync(e,i),a=s?s.scene||s.scenes&&s.scenes.length>0&&s.scenes[0]:void 0;return a&&s.animations.length>0&&(a.animations=s.animations),a.traverse(h=>{h.userData.gltfUUID&&(h.uuid=h.userData.gltfUUID,delete h.userData.gltfUUID)}),a}register(e){return super.register(e)}}class O_ extends d.hH6{constructor(e){super(e),this.type=d.cLu}async loadAsync(e,i){const s=await this.parseAsync(e,i,!1),a=new d.IEO(s.data,s.width,s.height,d.wk1,this.type);return a.needsUpdate=!0,a.flipY=!0,a.encoding=d.rnI,a.minFilter=d.wem,a.magFilter=d.wem,a.source.data.complete=!0,a}async parseAsync(e,i,s=!1){if(!e.startsWith("data:")){this.responseType="blob";const k=await super.loadAsync(e,i);e=(e=await _u(k)).replace("application/octet-stream","image/png")}const a=await Am(e);let h=Uint8Array;return this.type===d.cLu?h=Uint16Array:this.type===d.VzW&&(h=Uint32Array),{data:function(k,et=3,tt=Uint16Array,rt=!1){let lt;const pt=k.byteLength>>2,ft=new tt(pt*et);for(let vt=0;vt<pt;vt++)lt=Math.pow(2,k[4*vt+3]-136),rt?(ft[vt*et]=Math.min(k[4*vt]*lt,65504),ft[vt*et+1]=Math.min(k[4*vt+1]*lt,65504),ft[vt*et+2]=Math.min(k[4*vt+2]*lt,65504)):(ft[vt*et]=d.A5E.toHalfFloat(Math.min(k[4*vt]*lt,65504)),ft[vt*et+1]=d.A5E.toHalfFloat(Math.min(k[4*vt+1]*lt,65504)),ft[vt*et+2]=d.A5E.toHalfFloat(Math.min(k[4*vt+2]*lt,65504))),et===4&&(ft[vt*et+3]=d.A5E.toHalfFloat(1));return ft}(a.data,4,h,s),width:a.width,height:a.height}}setDataType(e){return this.type=e,this}}class SA extends d.Gql{constructor(e){super(e),this._imageLoader=new d.S3k(e)}parseTextures2(e,i,s){var a;for(const h of e){const f=(a=h==null?void 0:h.userData)===null||a===void 0?void 0:a.rootPath;if(f&&(!h.image||!i[h.image])){const k=new d.Hw6(this._imageLoader.load(f,s));if(!k)continue;h.image&&(k.uuid=h.image),i[k.uuid]=k,h.image=k.uuid}h.userData=os(h.userData,void 0,!1,{images:i})}return super.parseTextures(e,i)}parseMaterials2(e,i,s){const a={};return e.forEach(h=>{if(!h)return;const f={...h},k=Object.keys(f);for(const tt of k)if(tt==="map"||tt.endsWith("Map")){const rt=f[tt];typeof rt=="string"&&(i[rt]?f[tt]=i[rt]:(console.warn(`Texture ${rt} not found`),delete f[tt]))}f.userData&&(f.userData=os(f.userData,void 0,!1,{textures:i}));const et=s.generateFromTemplateType(f.type,f);et&&(a[h.uuid]=et)}),a}}const _f="WEBGI_viewer";function Lu(c){uo.Importers.push(new zl(w1,["gltf","glb","data:model/gltf"],!0,(e,i)=>{if(!e)return e;const s=e,a=new SA(i.loadingManager);return s.register(gv(a,c)),s.register(L_()),s.register(N_(a)),s.register(h=>new Xv(h)),s.register(h=>new bp(h)),s.register(h=>new I0(h)),s.register(h=>new MA(h)),s.register(h=>{var f,k,et,tt,rt,lt,pt,ft,vt;const yt=Ho()+".drc",Mt=Ho()+".ktx2",xt=(et=(k=(f=h.json)===null||f===void 0?void 0:f.extensionsRequired)===null||k===void 0?void 0:k.includes)===null||et===void 0?void 0:et.call(k,"KHR_draco_mesh_compression");if(xt){const At=i.registerFile(yt);At&&s.setDRACOLoader(At)}!((lt=(rt=(tt=h.json)===null||tt===void 0?void 0:tt.extensionsUsed)===null||rt===void 0?void 0:rt.includes)===null||lt===void 0)&&lt.call(rt,"EXT_meshopt_compression")&&(window.MeshoptDecoder?(s.setMeshoptDecoder(window.MeshoptDecoder),h.options.meshoptDecoder=window.MeshoptDecoder):console.error("Add GLTFMeshOptPlugin to viewer to enable EXT_meshopt_compression decode"));const Et=(vt=(ft=(pt=h.json)===null||pt===void 0?void 0:pt.extensionsUsed)===null||ft===void 0?void 0:ft.includes)===null||vt===void 0?void 0:vt.call(ft,"KHR_texture_basisu");if(Et){const At=i.registerFile(Mt);At&&(s.setKTX2Loader(At),h.options.ktx2Loader=At)}return{name:"GLTF2_HELPER_PLUGIN",afterRoot:async At=>{xt&&i.unregisterFile(yt),Et&&i.unregisterFile(Mt);const Rt=await CA(h,c,a);At.scene.__importedViewerConfig=Rt}}}),s}))}const An="WEBGI_light_extras",mv="WEBGI_object3d_extras",em="WEBGI_material_extras",L_=c=>e=>({name:"__"+mv,afterRoot:async i=>{(i.scenes||(i.scene?[i.scene]:[])).forEach(s=>{s.traverse(a=>{var h,f;if(!a.isObject3D)return;const k=(f=(h=a.userData)===null||h===void 0?void 0:h.gltfExtensions)===null||f===void 0?void 0:f[mv];if(!k)return void(a.isLight&&!a.isAmbientLight&&(a.castShadow=!0));const et=k.castShadow!==void 0||k.receiveShadow!==void 0;k.castShadow!==void 0&&(a.castShadow=k.castShadow),k.receiveShadow!==void 0&&(a.receiveShadow=k.receiveShadow),k.visible!==void 0&&(a.visible=k.visible),k.frustumCulled!==void 0&&(a.frustumCulled=k.frustumCulled),k.renderOrder!==void 0&&(a.renderOrder=k.renderOrder),k.layers!==void 0&&(a.layers.mask=k.layers),et&&(a.userData.__keepShadowDef=!0),delete a.userData.gltfExtensions[mv]})})}}),gv=(c,e)=>i=>({name:"__"+em,afterRoot:async s=>{var a,h,f;const k=s.scenes||(s.scene?[s.scene]:[]);for(const et of k){const tt=(h=(a=et.userData)===null||a===void 0?void 0:a.gltfExtensions)===null||h===void 0?void 0:h[em],rt=tt&&await((f=e.getPlugin(Kr))===null||f===void 0?void 0:f.importConfigResources(tt.resources||{}))||{};et.traverse(lt=>{var pt,ft;const vt=lt==null?void 0:lt.material;if(!(vt!=null&&vt.isMaterial))return;const yt=(ft=(pt=vt.userData)===null||pt===void 0?void 0:pt.gltfExtensions)===null||ft===void 0?void 0:ft[em];yt&&(yt.emissiveIntensity!==void 0&&(vt.emissiveIntensity=yt.emissiveIntensity),yt.fog!==void 0&&(vt.fog=yt.fog),yt.flatShading!==void 0&&(vt.flatShading=yt.flatShading),yt.blending!==void 0&&(vt.blending=yt.blending),yt.side!==void 0&&(vt.side=yt.side),yt.shadowSide!==void 0&&(vt.shadowSide=yt.shadowSide),yt.depthFunc!==void 0&&(vt.depthFunc=yt.depthFunc),yt.depthTest!==void 0&&(vt.depthTest=yt.depthTest),yt.depthWrite!==void 0&&(vt.depthWrite=yt.depthWrite),yt.colorWrite!==void 0&&(vt.colorWrite=yt.colorWrite),yt.wireframe!==void 0&&(vt.wireframe=yt.wireframe),yt.wireframeLinewidth!==void 0&&(vt.wireframeLinewidth=yt.wireframeLinewidth),yt.wireframeLinecap!==void 0&&(vt.wireframeLinecap=yt.wireframeLinecap),yt.wireframeLinejoin!==void 0&&(vt.wireframeLinejoin=yt.wireframeLinejoin),yt.rotation!==void 0&&(vt.rotation=yt.rotation),yt.polygonOffset!==void 0&&(vt.polygonOffset=yt.polygonOffset),yt.polygonOffsetFactor!==void 0&&(vt.polygonOffsetFactor=yt.polygonOffsetFactor),yt.polygonOffsetUnits!==void 0&&(vt.polygonOffsetUnits=yt.polygonOffsetUnits),yt.dithering!==void 0&&(vt.dithering=yt.dithering),yt.alphaToCoverage!==void 0&&(vt.alphaToCoverage=yt.alphaToCoverage),yt.premultipliedAlpha!==void 0&&(vt.premultipliedAlpha=yt.premultipliedAlpha),yt.toneMapped!==void 0&&(vt.toneMapped=yt.toneMapped),yt.reflectivity!==void 0&&(vt.reflectivity=yt.reflectivity),Object.entries(yt).forEach(([Mt,xt])=>{Mt.startsWith("_")||xt&&xt.resource&&typeof xt.resource=="string"&&(vt[Mt]=os(xt,vt[Mt],!1,rt))}),delete vt.userData.gltfExtensions[em])}),tt&&delete et.userData.gltfExtensions[em]}}}),N_=c=>e=>({name:"__"+An,afterRoot:async i=>{(i.scenes||(i.scene?[i.scene]:[])).forEach(s=>{s.traverse(a=>{var h,f;if(!a.isLight)return;const k=(f=(h=a.userData)===null||h===void 0?void 0:h.gltfExtensions)===null||f===void 0?void 0:f[An];k&&(!a.shadow&&k.shadow&&console.error("Light has no shadow, cannot import",a,k),k.shadow&&a.shadow&&(k.shadow.bias!==void 0&&(a.shadow.bias=k.shadow.bias),k.shadow.normalBias!==void 0&&(a.shadow.normalBias=k.shadow.normalBias),k.shadow.radius!==void 0&&(a.shadow.radius=k.shadow.radius),k.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(k.shadow.mapSize),k.shadow.camera!==void 0&&(a.shadow.camera=c.parseObject(k.shadow.camera))),delete a.userData.gltfExtensions[An])})})}});async function CA(c,e,i,s){var a;if(!s){const et=c.json.scenes||[];if(et.length!==1){for(const tt of et)await CA(c,e,tt);return}s=et[0]}const h=(a=s.extensions)===null||a===void 0?void 0:a[_f];if(!h)return;const f=[];Object.values(h.resources).forEach(et=>{Object.values(et).forEach(tt=>{tt.url&&(tt.url.type==="Uint16Array"&&tt.url.data&&f.push(tt.url),tt.url.type==="Uint8Array"&&tt.url.data&&f.push(tt.url))})});for(const et of f){const tt=et.data.image,rt=c.json.images[tt],lt=await c.getDependency("bufferView",rt.bufferView);if(rt.mimeType.startsWith("image/")&&et.type==="Uint16Array"&&et.encoding==="rgbe"){const pt=new Blob([lt],{type:rt.mimeType}),ft="data:image/png;base64,"+btoa(await pt.text());et.data=(await new O_().parseAsync(ft,void 0,!0)).data,delete et.encoding}else et.data=lt}const k={textures:{}};if(h.resources.textures&&c.json.textures)for(const[et,tt]of Object.entries(h.resources.textures)){if(tt.uuid||!et)continue;delete h.resources.textures[et];const rt=c.json.textures.findIndex(lt=>{var pt,ft,vt,yt,Mt,xt,Et;return((pt=lt.extras)===null||pt===void 0?void 0:pt.uuid)===et||((yt=(vt=(ft=c.json.samplers)===null||ft===void 0?void 0:ft[lt.sampler])===null||vt===void 0?void 0:vt.extras)===null||yt===void 0?void 0:yt.uuid)===et||((Et=(xt=(Mt=c.json.images)===null||Mt===void 0?void 0:Mt[lt.source])===null||xt===void 0?void 0:xt.extras)===null||Et===void 0?void 0:Et.t_uuid)===et});rt>=0&&(k.textures[et]=await c.getDependency("texture",rt))}if(h.resources.materials&&c.json.materials)for(const[et,tt]of Object.entries(h.resources.materials)){if(tt.uuid||!et)continue;delete h.resources.materials[et];const rt=c.json.materials.findIndex(lt=>{var pt;return((pt=lt.extras)===null||pt===void 0?void 0:pt.uuid)===et});rt>=0&&(k.materials[et]=await c.getDependency("material",rt))}return h.resources=await e.getPlugin(Kr).importConfigResources(h.resources||{},i,k),h}const xm="WEBGI_materials_bumpmap",Yv="WEBGI_materials_displacementmap",vv="WEBGI_materials_alphamap",bm="WEBGI_materials_lightmap";class Xv{constructor(e){this.parser=e,this.name=xm}async extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],f=a.extensions[this.name];return f.bumpScale!==void 0&&(i.bumpScale=f.bumpScale),f.bumpTexture!==void 0&&h.push(s.assignTexture(i,"bumpMap",f.bumpTexture)),Promise.all(h)}}class bp{constructor(e){this.parser=e,this.name=Yv}async extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],f=a.extensions[this.name];return f.displacementScale!==void 0&&(i.displacementScale=f.displacementScale),f.displacementBias!==void 0&&(i.displacementBias=f.displacementBias),f.displacementTexture!==void 0&&h.push(s.assignTexture(i,"displacementMap",f.displacementTexture)),Promise.all(h)}}class I0{constructor(e){this.parser=e,this.name=bm}async extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],f=a.extensions[this.name];return f.lightMapIntensity!==void 0&&(i.lightMapIntensity=f.lightMapIntensity),f.lightMapTexture!==void 0&&h.push(s.assignTexture(i,"lightMap",f.lightMapTexture)),Promise.all(h)}}class MA{constructor(e){this.parser=e,this.name=vv}async extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],f=a.extensions[this.name];return f.alphaTexture!==void 0&&h.push(s.assignTexture(i,"alphaMap",f.alphaTexture)),Promise.all(h)}}var F_=__webpackgi_require__(23);function Kv(){uo.Importers.push(new zl(F_.Q,["drc"],!0))}var TA={},xo=Uint8Array,Sl=Uint16Array,tm=Uint32Array,Bp=new xo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),nm=new xo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),fu=new xo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),IA=function(c,e){for(var i=new Sl(31),s=0;s<31;++s)i[s]=e+=1<<c[s-1];var a=new tm(i[30]);for(s=1;s<30;++s)for(var h=i[s];h<i[s+1];++h)a[h]=h-i[s]<<5|s;return[i,a]},P0=IA(Bp,2),Qm=P0[0],D0=P0[1];Qm[28]=258,D0[258]=28;for(var Iy=IA(nm,0),PA=Iy[0],$v=Iy[1],Us=new Sl(32768),qo=0;qo<32768;++qo){var Eu=(43690&qo)>>>1|(21845&qo)<<1;Eu=(61680&(Eu=(52428&Eu)>>>2|(13107&Eu)<<2))>>>4|(3855&Eu)<<4,Us[qo]=((65280&Eu)>>>8|(255&Eu)<<8)>>>1}var rm=function(c,e,i){for(var s=c.length,a=0,h=new Sl(e);a<s;++a)++h[c[a]-1];var f,k=new Sl(e);for(a=0;a<e;++a)k[a]=k[a-1]+h[a-1]<<1;if(i){f=new Sl(1<<e);var et=15-e;for(a=0;a<s;++a)if(c[a])for(var tt=a<<4|c[a],rt=e-c[a],lt=k[c[a]-1]++<<rt,pt=lt|(1<<rt)-1;lt<=pt;++lt)f[Us[lt]>>>et]=tt}else for(f=new Sl(s),a=0;a<s;++a)c[a]&&(f[a]=Us[k[c[a]-1]++]>>>15-c[a]);return f},_v=new xo(288);for(qo=0;qo<144;++qo)_v[qo]=8;for(qo=144;qo<256;++qo)_v[qo]=9;for(qo=256;qo<280;++qo)_v[qo]=7;for(qo=280;qo<288;++qo)_v[qo]=8;var Su=new xo(32);for(qo=0;qo<32;++qo)Su[qo]=5;var R0=rm(_v,9,0),Ep=rm(_v,9,1),Ow=rm(Su,5,0),Py=rm(Su,5,1),Em=function(c){for(var e=c[0],i=1;i<c.length;++i)c[i]>e&&(e=c[i]);return e},cp=function(c,e,i){var s=e/8|0;return(c[s]|c[s+1]<<8)>>(7&e)&i},yv=function(c,e){var i=e/8|0;return(c[i]|c[i+1]<<8|c[i+2]<<16)>>(7&e)},U_=function(c){return(c/8|0)+(7&c&&1)},Nu=function(c,e,i){(e==null||e<0)&&(e=0),(i==null||i>c.length)&&(i=c.length);var s=new(c instanceof Sl?Sl:c instanceof tm?tm:xo)(i-e);return s.set(c.subarray(e,i)),s},Op=function(c,e,i){var s=c.length;if(!s||i&&!i.l&&s<5)return e||new xo(0);var a=!e||i,h=!i||i.i;i||(i={}),e||(e=new xo(3*s));var f=function(hs){var _r=e.length;if(hs>_r){var Ys=new xo(Math.max(2*_r,hs));Ys.set(e),e=Ys}},k=i.f||0,et=i.p||0,tt=i.b||0,rt=i.l,lt=i.d,pt=i.m,ft=i.n,vt=8*s;do{if(!rt){i.f=k=cp(c,et,1);var yt=cp(c,et+1,3);if(et+=3,!yt){var Mt=c[(En=U_(et)+4)-4]|c[En-3]<<8,xt=En+Mt;if(xt>s){if(h)throw"unexpected EOF";break}a&&f(tt+Mt),e.set(c.subarray(En,xt),tt),i.b=tt+=Mt,i.p=et=8*xt;continue}if(yt==1)rt=Ep,lt=Py,pt=9,ft=5;else{if(yt!=2)throw"invalid block type";var Et=cp(c,et,31)+257,At=cp(c,et+10,15)+4,Rt=Et+cp(c,et+5,31)+1;et+=14;for(var Bt=new xo(Rt),Qt=new xo(19),Wt=0;Wt<At;++Wt)Qt[fu[Wt]]=cp(c,et+3*Wt,7);et+=3*At;var tn=Em(Qt),pn=(1<<tn)-1,yn=rm(Qt,tn,1);for(Wt=0;Wt<Rt;){var En,wn=yn[cp(c,et,pn)];if(et+=15&wn,(En=wn>>>4)<16)Bt[Wt++]=En;else{var In=0,xn=0;for(En==16?(xn=3+cp(c,et,3),et+=2,In=Bt[Wt-1]):En==17?(xn=3+cp(c,et,7),et+=3):En==18&&(xn=11+cp(c,et,127),et+=7);xn--;)Bt[Wt++]=In}}var Cn=Bt.subarray(0,Et),Fn=Bt.subarray(Et);pt=Em(Cn),ft=Em(Fn),rt=rm(Cn,pt,1),lt=rm(Fn,ft,1)}if(et>vt){if(h)throw"unexpected EOF";break}}a&&f(tt+131072);for(var Tn=(1<<pt)-1,Wn=(1<<ft)-1,or=et;;or=et){var fr=(In=rt[yv(c,et)&Tn])>>>4;if((et+=15&In)>vt){if(h)throw"unexpected EOF";break}if(!In)throw"invalid length/literal";if(fr<256)e[tt++]=fr;else{if(fr==256){or=et,rt=null;break}var rr=fr-254;if(fr>264){var Ir=Bp[Wt=fr-257];rr=cp(c,et,(1<<Ir)-1)+Qm[Wt],et+=Ir}var kr=lt[yv(c,et)&Wn],Br=kr>>>4;if(!kr)throw"invalid distance";if(et+=15&kr,Fn=PA[Br],Br>3&&(Ir=nm[Br],Fn+=yv(c,et)&(1<<Ir)-1,et+=Ir),et>vt){if(h)throw"unexpected EOF";break}a&&f(tt+131072);for(var Ur=tt+rr;tt<Ur;tt+=4)e[tt]=e[tt-Fn],e[tt+1]=e[tt+1-Fn],e[tt+2]=e[tt+2-Fn],e[tt+3]=e[tt+3-Fn];tt=Ur}}i.l=rt,i.p=or,i.b=tt,rt&&(k=1,i.m=pt,i.d=lt,i.n=ft)}while(!k);return tt==e.length?e:Nu(e,0,tt)},_h=function(c,e,i){i<<=7&e;var s=e/8|0;c[s]|=i,c[s+1]|=i>>>8},Gm=function(c,e,i){i<<=7&e;var s=e/8|0;c[s]|=i,c[s+1]|=i>>>8,c[s+2]|=i>>>16},DA=function(c,e){for(var i=[],s=0;s<c.length;++s)c[s]&&i.push({s,f:c[s]});var a=i.length,h=i.slice();if(!a)return[no,0];if(a==1){var f=new xo(i[0].s+1);return f[i[0].s]=1,[f,1]}i.sort(function(Bt,Qt){return Bt.f-Qt.f}),i.push({s:-1,f:25001});var k=i[0],et=i[1],tt=0,rt=1,lt=2;for(i[0]={s:-1,f:k.f+et.f,l:k,r:et};rt!=a-1;)k=i[i[tt].f<i[lt].f?tt++:lt++],et=i[tt!=rt&&i[tt].f<i[lt].f?tt++:lt++],i[rt++]={s:-1,f:k.f+et.f,l:k,r:et};var pt=h[0].s;for(s=1;s<a;++s)h[s].s>pt&&(pt=h[s].s);var ft=new Sl(pt+1),vt=Jv(i[rt-1],ft,0);if(vt>e){s=0;var yt=0,Mt=vt-e,xt=1<<Mt;for(h.sort(function(Bt,Qt){return ft[Qt.s]-ft[Bt.s]||Bt.f-Qt.f});s<a;++s){var Et=h[s].s;if(!(ft[Et]>e))break;yt+=xt-(1<<vt-ft[Et]),ft[Et]=e}for(yt>>>=Mt;yt>0;){var At=h[s].s;ft[At]<e?yt-=1<<e-ft[At]++-1:++s}for(;s>=0&&yt;--s){var Rt=h[s].s;ft[Rt]==e&&(--ft[Rt],++yt)}vt=e}return[new xo(ft),vt]},Jv=function(c,e,i){return c.s==-1?Math.max(Jv(c.l,e,i+1),Jv(c.r,e,i+1)):e[c.s]=i},Dy=function(c){for(var e=c.length;e&&!c[--e];);for(var i=new Sl(++e),s=0,a=c[0],h=1,f=function(et){i[s++]=et},k=1;k<=e;++k)if(c[k]==a&&k!=e)++h;else{if(!a&&h>2){for(;h>138;h-=138)f(32754);h>2&&(f(h>10?h-11<<5|28690:h-3<<5|12305),h=0)}else if(h>3){for(f(a),--h;h>6;h-=6)f(8304);h>2&&(f(h-3<<5|8208),h=0)}for(;h--;)f(a);h=1,a=c[k]}return[i.subarray(0,s),e]},j_=function(c,e){for(var i=0,s=0;s<e.length;++s)i+=c[s]*e[s];return i},Zv=function(c,e,i){var s=i.length,a=U_(e+2);c[a]=255&s,c[a+1]=s>>>8,c[a+2]=255^c[a],c[a+3]=255^c[a+1];for(var h=0;h<s;++h)c[a+h+4]=i[h];return 8*(a+4+s)},RA=function(c,e,i,s,a,h,f,k,et,tt,rt){_h(e,rt++,i),++a[256];for(var lt=DA(a,15),pt=lt[0],ft=lt[1],vt=DA(h,15),yt=vt[0],Mt=vt[1],xt=Dy(pt),Et=xt[0],At=xt[1],Rt=Dy(yt),Bt=Rt[0],Qt=Rt[1],Wt=new Sl(19),tn=0;tn<Et.length;++tn)Wt[31&Et[tn]]++;for(tn=0;tn<Bt.length;++tn)Wt[31&Bt[tn]]++;for(var pn=DA(Wt,7),yn=pn[0],En=pn[1],wn=19;wn>4&&!yn[fu[wn-1]];--wn);var In,xn,Cn,Fn,Tn=tt+5<<3,Wn=j_(a,_v)+j_(h,Su)+f,or=j_(a,pt)+j_(h,yt)+f+14+3*wn+j_(Wt,yn)+(2*Wt[16]+3*Wt[17]+7*Wt[18]);if(Tn<=Wn&&Tn<=or)return Zv(e,rt,c.subarray(et,et+tt));if(_h(e,rt,1+(or<Wn)),rt+=2,or<Wn){In=rm(pt,ft,0),xn=pt,Cn=rm(yt,Mt,0),Fn=yt;var fr=rm(yn,En,0);for(_h(e,rt,At-257),_h(e,rt+5,Qt-1),_h(e,rt+10,wn-4),rt+=14,tn=0;tn<wn;++tn)_h(e,rt+3*tn,yn[fu[tn]]);rt+=3*wn;for(var rr=[Et,Bt],Ir=0;Ir<2;++Ir){var kr=rr[Ir];for(tn=0;tn<kr.length;++tn){var Br=31&kr[tn];_h(e,rt,fr[Br]),rt+=yn[Br],Br>15&&(_h(e,rt,kr[tn]>>>5&127),rt+=kr[tn]>>>12)}}}else In=R0,xn=_v,Cn=Ow,Fn=Su;for(tn=0;tn<k;++tn)if(s[tn]>255){Br=s[tn]>>>18&31,Gm(e,rt,In[Br+257]),rt+=xn[Br+257],Br>7&&(_h(e,rt,s[tn]>>>23&31),rt+=Bp[Br]);var Ur=31&s[tn];Gm(e,rt,Cn[Ur]),rt+=Fn[Ur],Ur>3&&(Gm(e,rt,s[tn]>>>5&8191),rt+=nm[Ur])}else Gm(e,rt,In[s[tn]]),rt+=xn[s[tn]];return Gm(e,rt,In[256]),rt+xn[256]},Lw=new tm([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),no=new xo(0),im=function(c,e,i,s,a,h){var f=c.length,k=new xo(s+f+5*(1+Math.ceil(f/7e3))+a),et=k.subarray(s,k.length-a),tt=0;if(!e||f<8)for(var rt=0;rt<=f;rt+=65535){var lt=rt+65535;lt<f?tt=Zv(et,tt,c.subarray(rt,lt)):(et[rt]=h,tt=Zv(et,tt,c.subarray(rt,f)))}else{for(var pt=Lw[e-1],ft=pt>>>13,vt=8191&pt,yt=(1<<i)-1,Mt=new Sl(32768),xt=new Sl(yt+1),Et=Math.ceil(i/3),At=2*Et,Rt=function(Jo){return(c[Jo]^c[Jo+1]<<Et^c[Jo+2]<<At)&yt},Bt=new tm(25e3),Qt=new Sl(288),Wt=new Sl(32),tn=0,pn=0,yn=(rt=0,0),En=0,wn=0;rt<f;++rt){var In=Rt(rt),xn=32767&rt,Cn=xt[In];if(Mt[xn]=Cn,xt[In]=xn,En<=rt){var Fn=f-rt;if((tn>7e3||yn>24576)&&Fn>423){tt=RA(c,et,0,Bt,Qt,Wt,pn,yn,wn,rt-wn,tt),yn=tn=pn=0,wn=rt;for(var Tn=0;Tn<286;++Tn)Qt[Tn]=0;for(Tn=0;Tn<30;++Tn)Wt[Tn]=0}var Wn=2,or=0,fr=vt,rr=xn-Cn&32767;if(Fn>2&&In==Rt(rt-rr))for(var Ir=Math.min(ft,Fn)-1,kr=Math.min(32767,rt),Br=Math.min(258,Fn);rr<=kr&&--fr&&xn!=Cn;){if(c[rt+Wn]==c[rt+Wn-rr]){for(var Ur=0;Ur<Br&&c[rt+Ur]==c[rt+Ur-rr];++Ur);if(Ur>Wn){if(Wn=Ur,or=rr,Ur>Ir)break;var hs=Math.min(rr,Ur-2),_r=0;for(Tn=0;Tn<hs;++Tn){var Ys=rt-rr+Tn+32768&32767,po=Ys-Mt[Ys]+32768&32767;po>_r&&(_r=po,Cn=Ys)}}}rr+=(xn=Cn)-(Cn=Mt[xn])+32768&32767}if(or){Bt[yn++]=268435456|D0[Wn]<<18|$v[or];var Xs=31&D0[Wn],ko=31&$v[or];pn+=Bp[Xs]+nm[ko],++Qt[257+Xs],++Wt[ko],En=rt+Wn,++tn}else Bt[yn++]=c[rt],++Qt[c[rt]]}}tt=RA(c,et,h,Bt,Qt,Wt,pn,yn,wn,rt-wn,tt),!h&&7&tt&&(tt=Zv(et,tt+1,no))}return Nu(k,0,s+U_(tt)+a)},Hm=function(){for(var c=new Int32Array(256),e=0;e<256;++e){for(var i=e,s=9;--s;)i=(1&i&&-306674912)^i>>>1;c[e]=i}return c}(),up=function(){var c=-1;return{p:function(e){for(var i=c,s=0;s<e.length;++s)i=Hm[255&i^e[s]]^i>>>8;c=i},d:function(){return~c}}},Sm=function(){var c=1,e=0;return{p:function(i){for(var s=c,a=e,h=i.length,f=0;f!=h;){for(var k=Math.min(f+2655,h);f<k;++f)a+=s+=i[f];s=(65535&s)+15*(s>>16),a=(65535&a)+15*(a>>16)}c=s,e=a},d:function(){return(255&(c%=65521))<<24|c>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},sm=function(c,e,i,s,a){return im(c,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(c.length)))):12+e.mem,i,s,!a)},om=function(c,e){var i={};for(var s in c)i[s]=c[s];for(var s in e)i[s]=e[s];return i},kA=function(c,e,i){for(var s=c(),a=c.toString(),h=a.slice(a.indexOf("[")+1,a.lastIndexOf("]")).replace(/ /g,"").split(","),f=0;f<s.length;++f){var k=s[f],et=h[f];if(typeof k=="function"){e+=";"+et+"=";var tt=k.toString();if(k.prototype)if(tt.indexOf("[native code]")!=-1){var rt=tt.indexOf(" ",8)+1;e+=tt.slice(rt,tt.indexOf("(",rt))}else for(var lt in e+=tt,k.prototype)e+=";"+et+".prototype."+lt+"="+k.prototype[lt].toString();else e+=tt}else i[et]=k}return[e,i]},k0=[],BA=function(c,e,i,s){var a;if(!k0[i]){for(var h="",f={},k=c.length-1,et=0;et<k;++et)h=(a=kA(c[et],h,f))[0],f=a[1];k0[i]=kA(c[k],h,f)}var tt=om({},k0[i][1]);return function(rt,lt,pt,ft,vt){var yt=new Worker(TA[lt]||(TA[lt]=URL.createObjectURL(new Blob([rt],{type:"text/javascript"}))));return yt.onerror=function(Mt){return vt(Mt.error,null)},yt.onmessage=function(Mt){return vt(null,Mt.data)},yt.postMessage(pt,ft),yt}(k0[i][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",i,tt,function(rt){var lt=[];for(var pt in rt)(rt[pt]instanceof xo||rt[pt]instanceof Sl||rt[pt]instanceof tm)&&lt.push((rt[pt]=new rt[pt].constructor(rt[pt])).buffer);return lt}(tt),s)},e_=function(){return[xo,Sl,tm,Bp,nm,fu,Qm,PA,Ep,Py,Us,rm,Em,cp,yv,U_,Nu,Op,_d,am,$o]},Fu=function(){return[xo,Sl,tm,Bp,nm,fu,D0,$v,R0,_v,Ow,Su,Us,Lw,no,rm,_h,Gm,DA,Jv,Dy,j_,Zv,RA,U_,Nu,im,sm,ps,am]},x1=function(){return[st,Zt,wt,up,Hm]},Uu=function(){return[dt,It]},Wm=function(){return[bn,wt,Sm]},_c=function(){return[Rn]},am=function(c){return postMessage(c,[c.buffer])},$o=function(c){return c&&c.size&&new xo(c.size)},B0=function(c,e,i,s,a,h){var f=BA(i,s,a,function(k,et){f.terminate(),h(k,et)});return f.postMessage([c,e],e.consume?[c.buffer]:[]),function(){f.terminate()}},lm=function(c){return c.ondata=function(e,i){return postMessage([e,i],[e.buffer])},function(e){return c.push(e.data[0],e.data[1])}},O0=function(c,e,i,s,a){var h,f=BA(c,s,a,function(k,et){k?(f.terminate(),e.ondata.call(e,k)):(et[1]&&f.terminate(),e.ondata.call(e,k,et[0],et[1]))});f.postMessage(i),e.push=function(k,et){if(h)throw"stream finished";if(!e.ondata)throw"no stream handler";f.postMessage([k,h=et],[k.buffer])},e.terminate=function(){f.terminate()}},hp=function(c,e){return c[e]|c[e+1]<<8},Ql=function(c,e){return(c[e]|c[e+1]<<8|c[e+2]<<16|c[e+3]<<24)>>>0},Nw=function(c,e){return Ql(c,e)+4294967296*Ql(c,e+4)},wt=function(c,e,i){for(;i;++e)c[e]=i,i>>>=8},st=function(c,e){var i=e.filename;if(c[0]=31,c[1]=139,c[2]=8,c[8]=e.level<2?4:e.level==9?2:0,c[9]=3,e.mtime!=0&&wt(c,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),i){c[3]=8;for(var s=0;s<=i.length;++s)c[s+10]=i.charCodeAt(s)}},dt=function(c){if(c[0]!=31||c[1]!=139||c[2]!=8)throw"invalid gzip data";var e=c[3],i=10;4&e&&(i+=c[10]|2+(c[11]<<8));for(var s=(e>>3&1)+(e>>4&1);s>0;s-=!c[i++]);return i+(2&e)},It=function(c){var e=c.length;return(c[e-4]|c[e-3]<<8|c[e-2]<<16|c[e-1]<<24)>>>0},Zt=function(c){return 10+(c.filename&&c.filename.length+1||0)},bn=function(c,e){var i=e.level,s=i==0?0:i<6?1:i==9?3:2;c[0]=120,c[1]=s<<6|(s?32-2*s:1)},Rn=function(c){if((15&c[0])!=8||c[0]>>>4>7||(c[0]<<8|c[1])%31)throw"invalid zlib data";if(32&c[1])throw"invalid zlib data: preset dictionaries not supported"};function dr(c,e){return e||typeof c!="function"||(e=c,c={}),this.ondata=e,c}var Dr=function(){function c(e,i){i||typeof e!="function"||(i=e,e={}),this.ondata=i,this.o=e||{}}return c.prototype.p=function(e,i){this.ondata(sm(e,this.o,0,0,!i),i)},c.prototype.push=function(e,i){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=i,this.p(e,i||!1)},c}(),ys=function(){return function(c,e){O0([Fu,function(){return[lm,Dr]}],this,dr.call(this,c,e),function(i){var s=new Dr(i.data);onmessage=lm(s)},6)}}();function Ts(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return B0(c,e,[Fu],function(s){return am(ps(s.data[0],s.data[1]))},0,i)}function ps(c,e){return sm(c,e||{},0,0)}var Cl=function(){function c(e){this.s={},this.p=new xo(0),this.ondata=e}return c.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var i=this.p.length,s=new xo(i+e.length);s.set(this.p),s.set(e,i),this.p=s},c.prototype.c=function(e){this.d=this.s.i=e||!1;var i=this.s.b,s=Op(this.p,this.o,this.s);this.ondata(Nu(s,i,this.s.b),this.d),this.o=Nu(s,this.s.b-32768),this.s.b=this.o.length,this.p=Nu(this.p,this.s.p/8|0),this.s.p&=7},c.prototype.push=function(e,i){this.e(e),this.c(i)},c}(),iu=function(){return function(c){this.ondata=c,O0([e_,function(){return[lm,Cl]}],this,0,function(){var e=new Cl;onmessage=lm(e)},7)}}();function cm(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return B0(c,e,[e_],function(s){return am(_d(s.data[0],$o(s.data[1])))},1,i)}function _d(c,e){return Op(c,e)}var Lp=function(){function c(e,i){this.c=up(),this.l=0,this.v=1,Dr.call(this,e,i)}return c.prototype.push=function(e,i){Dr.prototype.push.call(this,e,i)},c.prototype.p=function(e,i){this.c.p(e),this.l+=e.length;var s=sm(e,this.o,this.v&&Zt(this.o),i&&8,!i);this.v&&(st(s,this.o),this.v=0),i&&(wt(s,s.length-8,this.c.d()),wt(s,s.length-4,this.l)),this.ondata(s,i)},c}(),Cm=function(){return function(c,e){O0([Fu,x1,function(){return[lm,Dr,Lp]}],this,dr.call(this,c,e),function(i){var s=new Lp(i.data);onmessage=lm(s)},8)}}();function z_(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return B0(c,e,[Fu,x1,function(){return[t_]}],function(s){return am(t_(s.data[0],s.data[1]))},2,i)}function t_(c,e){e||(e={});var i=up(),s=c.length;i.p(c);var a=sm(c,e,Zt(e),8),h=a.length;return st(a,e),wt(a,h-8,i.d()),wt(a,h-4,s),a}var L0=function(){function c(e){this.v=1,Cl.call(this,e)}return c.prototype.push=function(e,i){if(Cl.prototype.e.call(this,e),this.v){var s=this.p.length>3?dt(this.p):4;if(s>=this.p.length&&!i)return;this.p=this.p.subarray(s),this.v=0}if(i){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Cl.prototype.c.call(this,i)},c}(),Ry=function(){return function(c){this.ondata=c,O0([e_,Uu,function(){return[lm,Cl,L0]}],this,0,function(){var e=new L0;onmessage=lm(e)},9)}}();function ky(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return B0(c,e,[e_,Uu,function(){return[By]}],function(s){return am(By(s.data[0]))},3,i)}function By(c,e){return Op(c.subarray(dt(c),-8),e||new xo(It(c)))}var OA=function(){function c(e,i){this.c=Sm(),this.v=1,Dr.call(this,e,i)}return c.prototype.push=function(e,i){Dr.prototype.push.call(this,e,i)},c.prototype.p=function(e,i){this.c.p(e);var s=sm(e,this.o,this.v&&2,i&&4,!i);this.v&&(bn(s,this.o),this.v=0),i&&wt(s,s.length-4,this.c.d()),this.ondata(s,i)},c}(),b1=function(){return function(c,e){O0([Fu,Wm,function(){return[lm,Dr,OA]}],this,dr.call(this,c,e),function(i){var s=new OA(i.data);onmessage=lm(s)},10)}}();function E1(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return B0(c,e,[Fu,Wm,function(){return[Fw]}],function(s){return am(Fw(s.data[0],s.data[1]))},4,i)}function Fw(c,e){e||(e={});var i=Sm();i.p(c);var s=sm(c,e,2,4);return bn(s,e),wt(s,s.length-4,i.d()),s}var Oy=function(){function c(e){this.v=1,Cl.call(this,e)}return c.prototype.push=function(e,i){if(Cl.prototype.e.call(this,e),this.v){if(this.p.length<2&&!i)return;this.p=this.p.subarray(2),this.v=0}if(i){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Cl.prototype.c.call(this,i)},c}(),ju=function(){return function(c){this.ondata=c,O0([e_,_c,function(){return[lm,Cl,Oy]}],this,0,function(){var e=new Oy;onmessage=lm(e)},11)}}();function Uw(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return B0(c,e,[e_,_c,function(){return[qm]}],function(s){return am(qm(s.data[0],$o(s.data[1])))},5,i)}function qm(c,e){return Op((Rn(c),c.subarray(2,-4)),e)}var N0=function(){function c(e){this.G=L0,this.I=Cl,this.Z=Oy,this.ondata=e}return c.prototype.push=function(e,i){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,i);else{if(this.p&&this.p.length){var s=new xo(this.p.length+e.length);s.set(this.p),s.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var a=this,h=function(){a.ondata.apply(a,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(h):(15&this.p[0])!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(h):new this.Z(h),this.s.push(this.p,i),this.p=null}}},c}(),Sp=function(){function c(e){this.G=Ry,this.I=iu,this.Z=ju,this.ondata=e}return c.prototype.push=function(e,i){N0.prototype.push.call(this,e,i)},c}();function kM(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return c[0]==31&&c[1]==139&&c[2]==8?ky(c,e,i):(15&c[0])!=8||c[0]>>4>7||(c[0]<<8|c[1])%31?cm(c,e,i):Uw(c,e,i)}function Av(c,e){return c[0]==31&&c[1]==139&&c[2]==8?By(c,e):(15&c[0])!=8||c[0]>>4>7||(c[0]<<8|c[1])%31?_d(c,e):qm(c,e)}var LA=function(c,e,i,s){for(var a in c){var h=c[a],f=e+a;h instanceof xo?i[f]=[h,s]:Array.isArray(h)?i[f]=[h[0],om(s,h[1])]:LA(h,f+"/",i,s)}},ep=typeof TextEncoder<"u"&&new TextEncoder,F0=typeof TextDecoder<"u"&&new TextDecoder,PS=0;try{F0.decode(no,{stream:!0}),PS=1}catch{}var NA=function(c){for(var e="",i=0;;){var s=c[i++],a=(s>127)+(s>223)+(s>239);if(i+a>c.length)return[e,Nu(c,i-1)];a?a==3?(s=((15&s)<<18|(63&c[i++])<<12|(63&c[i++])<<6|63&c[i++])-65536,e+=String.fromCharCode(55296|s>>10,56320|1023&s)):e+=1&a?String.fromCharCode((31&s)<<6|63&c[i++]):String.fromCharCode((15&s)<<12|(63&c[i++])<<6|63&c[i++]):e+=String.fromCharCode(s)}},BM=function(){function c(e){this.ondata=e,PS?this.t=new TextDecoder:this.p=no}return c.prototype.push=function(e,i){if(!this.ondata)throw"no callback";if(i=!!i,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),i),i){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var s=new xo(this.p.length+e.length);s.set(this.p),s.set(e,this.p.length);var a=NA(s),h=a[0],f=a[1];if(i){if(f.length)throw"invalid utf-8 data";this.p=null}else this.p=f;this.ondata(h,i)}},c}(),DS=function(){function c(e){this.ondata=e}return c.prototype.push=function(e,i){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(U0(e),this.d=i||!1)},c}();function U0(c,e){if(e){for(var i=new xo(c.length),s=0;s<c.length;++s)i[s]=c.charCodeAt(s);return i}if(ep)return ep.encode(c);var a=c.length,h=new xo(c.length+(c.length>>1)),f=0,k=function(rt){h[f++]=rt};for(s=0;s<a;++s){if(f+5>h.length){var et=new xo(f+8+(a-s<<1));et.set(h),h=et}var tt=c.charCodeAt(s);tt<128||e?k(tt):tt<2048?(k(192|tt>>6),k(128|63&tt)):tt>55295&&tt<57344?(k(240|(tt=65536+(1047552&tt)|1023&c.charCodeAt(++s))>>18),k(128|tt>>12&63),k(128|tt>>6&63),k(128|63&tt)):(k(224|tt>>12),k(128|tt>>6&63),k(128|63&tt))}return Nu(h,0,f)}function RS(c,e){if(e){for(var i="",s=0;s<c.length;s+=16384)i+=String.fromCharCode.apply(null,c.subarray(s,s+16384));return i}if(F0)return F0.decode(c);var a=NA(c),h=a[0];if(a[1].length)throw"invalid utf-8 data";return h}var V_=function(c){return c==1?3:c<6?2:c==9?1:0},Ly=function(c,e){return e+30+hp(c,e+26)+hp(c,e+28)},jw=function(c,e,i){var s=hp(c,e+28),a=RS(c.subarray(e+46,e+46+s),!(2048&hp(c,e+8))),h=e+46+s,f=Ql(c,e+20),k=i&&f==4294967295?zw(c,h):[f,Ql(c,e+24),Ql(c,e+42)],et=k[0],tt=k[1],rt=k[2];return[hp(c,e+10),et,tt,a,h+hp(c,e+30)+hp(c,e+32),rt]},zw=function(c,e){for(;hp(c,e)!=1;e+=4+hp(c,e+2));return[Nw(c,e+12),Nw(c,e+4),Nw(c,e+20)]},Q_=function(c){var e=0;if(c)for(var i in c){var s=c[i].length;if(s>65535)throw"extra field too long";e+=s+4}return e},FA=function(c,e,i,s,a,h,f,k){var et=s.length,tt=i.extra,rt=k&&k.length,lt=Q_(tt);wt(c,e,f!=null?33639248:67324752),e+=4,f!=null&&(c[e++]=20,c[e++]=i.os),c[e]=20,e+=2,c[e++]=i.flag<<1|(h==null&&8),c[e++]=a&&8,c[e++]=255&i.compression,c[e++]=i.compression>>8;var pt=new Date(i.mtime==null?Date.now():i.mtime),ft=pt.getFullYear()-1980;if(ft<0||ft>119)throw"date not in range 1980-2099";if(wt(c,e,ft<<25|pt.getMonth()+1<<21|pt.getDate()<<16|pt.getHours()<<11|pt.getMinutes()<<5|pt.getSeconds()>>>1),e+=4,h!=null&&(wt(c,e,i.crc),wt(c,e+4,h),wt(c,e+8,i.size)),wt(c,e+12,et),wt(c,e+14,lt),e+=16,f!=null&&(wt(c,e,rt),wt(c,e+6,i.attrs),wt(c,e+10,f),e+=14),c.set(s,e),e+=et,lt)for(var vt in tt){var yt=tt[vt],Mt=yt.length;wt(c,e,+vt),wt(c,e+2,Mt),c.set(yt,e+4),e+=4+Mt}return rt&&(c.set(k,e),e+=rt),e},j0=function(c,e,i,s,a){wt(c,e,101010256),wt(c,e+8,i),wt(c,e+10,i),wt(c,e+12,s),wt(c,e+16,a)},ao=function(){function c(e){this.filename=e,this.c=up(),this.size=0,this.compression=0}return c.prototype.process=function(e,i){this.ondata(null,e,i)},c.prototype.push=function(e,i){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,i&&(this.crc=this.c.d()),this.process(e,i||!1)},c}(),Zr=function(){function c(e,i){var s=this;i||(i={}),ao.call(this,e),this.d=new Dr(i,function(a,h){s.ondata(null,a,h)}),this.compression=8,this.flag=V_(i.level)}return c.prototype.process=function(e,i){try{this.d.push(e,i)}catch(s){this.ondata(s,null,i)}},c.prototype.push=function(e,i){ao.prototype.push.call(this,e,i)},c}(),um=function(){function c(e,i){var s=this;i||(i={}),ao.call(this,e),this.d=new ys(i,function(a,h,f){s.ondata(a,h,f)}),this.compression=8,this.flag=V_(i.level),this.terminate=this.d.terminate}return c.prototype.process=function(e,i){this.d.push(e,i)},c.prototype.push=function(e,i){ao.prototype.push.call(this,e,i)},c}(),sP=function(){function c(e){this.ondata=e,this.u=[],this.d=1}return c.prototype.add=function(e){var i=this;if(2&this.d)throw"stream finished";var s=U0(e.filename),a=s.length,h=e.comment,f=h&&U0(h),k=a!=e.filename.length||f&&h.length!=f.length,et=a+Q_(e.extra)+30;if(a>65535)throw"filename too long";var tt=new xo(et);FA(tt,0,e,s,k);var rt=[tt],lt=function(){for(var Mt=0,xt=rt;Mt<xt.length;Mt++){var Et=xt[Mt];i.ondata(null,Et,!1)}rt=[]},pt=this.d;this.d=0;var ft=this.u.length,vt=om(e,{f:s,u:k,o:f,t:function(){e.terminate&&e.terminate()},r:function(){if(lt(),pt){var Mt=i.u[ft+1];Mt?Mt.r():i.d=1}pt=1}}),yt=0;e.ondata=function(Mt,xt,Et){if(Mt)i.ondata(Mt,xt,Et),i.terminate();else if(yt+=xt.length,rt.push(xt),Et){var At=new xo(16);wt(At,0,134695760),wt(At,4,e.crc),wt(At,8,yt),wt(At,12,e.size),rt.push(At),vt.c=yt,vt.b=et+yt+16,vt.crc=e.crc,vt.size=e.size,pt&&vt.r(),pt=1}else pt&&lt()},this.u.push(vt)},c.prototype.end=function(){var e=this;if(2&this.d)throw 1&this.d?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},c.prototype.e=function(){for(var e=0,i=0,s=0,a=0,h=this.u;a<h.length;a++)s+=46+(tt=h[a]).f.length+Q_(tt.extra)+(tt.o?tt.o.length:0);for(var f=new xo(s+22),k=0,et=this.u;k<et.length;k++){var tt=et[k];FA(f,e,tt,tt.f,tt.u,tt.c,i,tt.o),e+=46+tt.f.length+Q_(tt.extra)+(tt.o?tt.o.length:0),i+=tt.b}j0(f,e,this.u.length,s,i),this.ondata(null,f,!0),this.d=2},c.prototype.terminate=function(){for(var e=0,i=this.u;e<i.length;e++)i[e].t();this.d=2},c}();function oP(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";var s={};LA(c,"",s,e);var a=Object.keys(s),h=a.length,f=0,k=0,et=h,tt=new Array(h),rt=[],lt=function(){for(var yt=0;yt<rt.length;++yt)rt[yt]()},pt=function(){var yt=new xo(k+22),Mt=f,xt=k-f;k=0;for(var Et=0;Et<et;++Et){var At=tt[Et];try{var Rt=At.c.length;FA(yt,k,At,At.f,At.u,Rt);var Bt=30+At.f.length+Q_(At.extra),Qt=k+Bt;yt.set(At.c,Qt),FA(yt,f,At,At.f,At.u,Rt,k,At.m),f+=16+Bt+(At.m?At.m.length:0),k=Qt+Rt}catch(Wt){return i(Wt,null)}}j0(yt,f,tt.length,xt,Mt),i(null,yt)};h||pt();for(var ft=function(yt){var Mt=a[yt],xt=s[Mt],Et=xt[0],At=xt[1],Rt=up(),Bt=Et.length;Rt.p(Et);var Qt=U0(Mt),Wt=Qt.length,tn=At.comment,pn=tn&&U0(tn),yn=pn&&pn.length,En=Q_(At.extra),wn=At.level==0?0:8,In=function(xn,Cn){if(xn)lt(),i(xn,null);else{var Fn=Cn.length;tt[yt]=om(At,{size:Bt,crc:Rt.d(),c:Cn,f:Qt,m:pn,u:Wt!=Mt.length||pn&&tn.length!=yn,compression:wn}),f+=30+Wt+En+Fn,k+=76+2*(Wt+En)+(yn||0)+Fn,--h||pt()}};if(Wt>65535&&In("filename too long",null),wn)if(Bt<16e4)try{In(null,ps(Et,At))}catch(xn){In(xn,null)}else rt.push(Ts(Et,At,In));else In(null,Et)},vt=0;vt<et;++vt)ft(vt);return lt}function OM(c,e){e||(e={});var i={},s=[];LA(c,"",i,e);var a=0,h=0;for(var f in i){var k=i[f],et=k[0],tt=k[1],rt=tt.level==0?0:8,lt=(Wt=U0(f)).length,pt=tt.comment,ft=pt&&U0(pt),vt=ft&&ft.length,yt=Q_(tt.extra);if(lt>65535)throw"filename too long";var Mt=rt?ps(et,tt):et,xt=Mt.length,Et=up();Et.p(et),s.push(om(tt,{size:et.length,crc:Et.d(),c:Mt,f:Wt,m:ft,u:lt!=f.length||ft&&pt.length!=vt,o:a,compression:rt})),a+=30+lt+yt+xt,h+=76+2*(lt+yt)+(vt||0)+xt}for(var At=new xo(h+22),Rt=a,Bt=h-a,Qt=0;Qt<s.length;++Qt){var Wt=s[Qt];FA(At,Wt.o,Wt,Wt.f,Wt.u,Wt.c.length);var tn=30+Wt.f.length+Q_(Wt.extra);At.set(Wt.c,Wt.o+tn),FA(At,a,Wt,Wt.f,Wt.u,Wt.c.length,Wt.o,Wt.m),a+=16+tn+(Wt.m?Wt.m.length:0)}return j0(At,a,s.length,Bt,Rt),At}var LM=function(){function c(){}return c.prototype.push=function(e,i){this.ondata(null,e,i)},c.compression=0,c}(),aP=function(){function c(){var e=this;this.i=new Cl(function(i,s){e.ondata(null,i,s)})}return c.prototype.push=function(e,i){try{this.i.push(e,i)}catch(s){this.ondata(s,e,i)}},c.compression=8,c}(),lP=function(){function c(e,i){var s=this;i<32e4?this.i=new Cl(function(a,h){s.ondata(null,a,h)}):(this.i=new iu(function(a,h,f){s.ondata(a,h,f)}),this.terminate=this.i.terminate)}return c.prototype.push=function(e,i){this.i.terminate&&(e=Nu(e,0)),this.i.push(e,i)},c.compression=8,c}(),S1=function(){function c(e){this.onfile=e,this.k=[],this.o={0:LM},this.p=no}return c.prototype.push=function(e,i){var s=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var a=Math.min(this.c,e.length),h=e.subarray(0,a);if(this.c-=a,this.d?this.d.push(h,!this.c):this.k[0].push(h),(e=e.subarray(a)).length)return this.push(e,i)}else{var f=0,k=0,et=void 0,tt=void 0;this.p.length?e.length?((tt=new xo(this.p.length+e.length)).set(this.p),tt.set(e,this.p.length)):tt=this.p:tt=e;for(var rt=tt.length,lt=this.c,pt=lt&&this.d,ft=function(){var Mt,xt=Ql(tt,k);if(xt==67324752){f=1,et=k,vt.d=null,vt.c=0;var Et=hp(tt,k+6),At=hp(tt,k+8),Rt=2048&Et,Bt=8&Et,Qt=hp(tt,k+26),Wt=hp(tt,k+28);if(rt>k+30+Qt+Wt){var tn=[];vt.k.unshift(tn),f=2;var pn,yn=Ql(tt,k+18),En=Ql(tt,k+22),wn=RS(tt.subarray(k+30,k+=30+Qt),!Rt);yn==4294967295?(Mt=Bt?[-2]:zw(tt,k),yn=Mt[0],En=Mt[1]):Bt&&(yn=-1),k+=Wt,vt.c=yn;var In={name:wn,compression:At,start:function(){if(!In.ondata)throw"no callback";if(yn){var xn=s.o[At];if(!xn)throw"unknown compression type "+At;(pn=yn<0?new xn(wn):new xn(wn,yn,En)).ondata=function(Wn,or,fr){In.ondata(Wn,or,fr)};for(var Cn=0,Fn=tn;Cn<Fn.length;Cn++){var Tn=Fn[Cn];pn.push(Tn,!1)}s.k[0]==tn&&s.c?s.d=pn:pn.push(no,!0)}else In.ondata(null,no,!0)},terminate:function(){pn&&pn.terminate&&pn.terminate()}};yn>=0&&(In.size=yn,In.originalSize=En),vt.onfile(In)}return"break"}if(lt){if(xt==134695760)return et=k+=12+(lt==-2&&8),f=3,vt.c=0,"break";if(xt==33639248)return et=k-=4,f=3,vt.c=0,"break"}},vt=this;k<rt-4&&ft()!=="break";++k);if(this.p=no,lt<0){var yt=f?tt.subarray(0,et-12-(lt==-2&&8)-(Ql(tt,et-16)==134695760&&4)):tt.subarray(0,k);pt?pt.push(yt,!!f):this.k[+(f==2)].push(yt)}if(2&f)return this.push(tt.subarray(k),i);this.p=tt.subarray(k)}if(i){if(this.c)throw"invalid zip file";this.p=null}},c.prototype.register=function(e){this.o[e.compression]=e},c}();function NM(c,e){if(typeof e!="function")throw"no callback";for(var i=[],s=function(){for(var pt=0;pt<i.length;++pt)i[pt]()},a={},h=c.length-22;Ql(c,h)!=101010256;--h)if(!h||c.length-h>65558)return void e("invalid zip file",null);var f=hp(c,h+8);f||e(null,{});var k=f,et=Ql(c,h+16),tt=et==4294967295;if(tt){if(h=Ql(c,h-12),Ql(c,h)!=101075792)return void e("invalid zip file",null);k=f=Ql(c,h+32),et=Ql(c,h+48)}for(var rt=function(pt){var ft=jw(c,et,tt),vt=ft[0],yt=ft[1],Mt=ft[2],xt=ft[3],Et=ft[4],At=ft[5],Rt=Ly(c,At);et=Et;var Bt=function(Wt,tn){Wt?(s(),e(Wt,null)):(a[xt]=tn,--f||e(null,a))};if(vt)if(vt==8){var Qt=c.subarray(Rt,Rt+yt);if(yt<32e4)try{Bt(null,_d(Qt,new xo(Mt)))}catch(Wt){Bt(Wt,null)}else i.push(cm(Qt,{size:Mt},Bt))}else Bt("unknown compression type "+vt,null);else Bt(null,Nu(c,Rt,Rt+yt))},lt=0;lt<k;++lt)rt();return s}function C1(c){for(var e={},i=c.length-22;Ql(c,i)!=101010256;--i)if(!i||c.length-i>65558)throw"invalid zip file";var s=hp(c,i+8);if(!s)return{};var a=Ql(c,i+16),h=a==4294967295;if(h){if(i=Ql(c,i-12),Ql(c,i)!=101075792)throw"invalid zip file";s=Ql(c,i+32),a=Ql(c,i+48)}for(var f=0;f<s;++f){var k=jw(c,a,h),et=k[0],tt=k[1],rt=k[2],lt=k[3],pt=k[4],ft=k[5],vt=Ly(c,ft);if(a=pt,et){if(et!=8)throw"unknown compression type "+et;e[lt]=_d(c.subarray(vt,vt+tt),new xo(rt))}else e[lt]=Nu(c,vt,vt+tt)}return e}class M1 extends d.hH6{load(e,i,s,a){return this.setResponseType("arraybuffer"),super.load(e,h=>{const f=C1(new Uint8Array(h)),k=new Map(Object.entries(f).map(([et,tt])=>[et,new File([tt],et)]));i==null||i(k)},s,a)}}function T1(){uo.Importers.push(new zl(M1,["zip"],!0))}class n_ extends d.Ox3{constructor(e,i){super(),this.assetType="light",this.isDirectionalLight2=!0,this.color=new d.Ilk(e),this.intensity=i||1,this.target.position.set(0,0,-1),this.add(this.target)}get lightObject(){return this}get modelObject(){return this}copy(e,i){const s=this.target,a=e.userData;return e.userData={},super.copy(e,i),Ko(this.userData,a),s.position.copy(this.target.position),s.updateMatrixWorld(),this.target=s,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,i;(e=this.shadow.map)===null||e===void 0||e.dispose(),(i=this.shadow.mapPass)===null||i===void 0||i.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[-.1,.1],stepSize:.005,label:"Shadow Normal Bias",property:[this==null?void 0:this.shadow,"normalBias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty},{type:"slider",bounds:[.1,50],label:"Shadow frustum",getValue:()=>2*this.shadow.camera.right,setValue:e=>{this.shadow.camera.left=-e/2,this.shadow.camera.right=e/2,this.shadow.camera.top=e/2,this.shadow.camera.bottom=-e/2},onChange:this.setDirty}]}}toJSON(e){const{userData:i,children:s}=this;this.userData={},this.children=[];const a=super.toJSON(e);return a.userData=Wr(Ko({},i),!1),this.userData={},this.children=s,a.type="DirectionalLight2",a.target=this.target.position.toArray(),Object.assign(a,Wr(this,!0,e))}fromJSON(e,i){if(e.type!=="DirectionalLight2")return null;const s=e.target,a=e.object;return e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld(),delete e.target),e.object&&delete e.object,os(e,this,!0,i),s&&(e.target=s),a&&(a.color!==void 0&&this.color.set(a.color),a.intensity!==void 0&&(this.intensity=a.intensity),e.object=a),this}}class Ny extends d.PMe{constructor(e,i,s,a,h,f){super(e,i,s,a,h,f),this.assetType="light",this.target.position.set(0,0,-1),this.add(this.target)}get lightObject(){return this}get modelObject(){return this}copy(e,i){const s=this.target,a=e.userData;return e.userData={},super.copy(e,i),Ko(this.userData,a),s.position.copy(this.target.position),s.updateMatrixWorld(),this.target=s,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Spot Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,30],property:[this,"intensity"]},{type:"slider",bounds:[0,2],property:[this,"angle"]},{type:"slider",bounds:[0,.9999],property:[this,"penumbra"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,i;(e=this.shadow.map)===null||e===void 0||e.dispose(),(i=this.shadow.mapPass)===null||i===void 0||i.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:i,children:s}=this;this.userData={},this.children=[];const a=super.toJSON(e);return a.userData=Wr(Ko({},i),!1),this.userData={},this.children=s,a.type="SpotLight2",a.target=this.target.position.toArray(),Object.assign(a,Wr(this,!0,e))}fromJSON(e,i){return e.type!=="SpotLight2"?null:(e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld()),e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),e.object.distance!==void 0&&(this.distance=e.object.distance),e.object.angle!==void 0&&(this.angle=e.object.angle),e.object.decay!==void 0&&(this.decay=e.object.decay),e.object.penumbra!==void 0&&(this.penumbra=e.object.penumbra),os(e,this,!0,i),this):this)}}class kS extends d.cek{constructor(e,i,s,a){super(e,i,s,a),this.assetType="light"}get lightObject(){return this}get modelObject(){return this}copy(e,i){const s=e.userData;return e.userData={},super.copy(e,i),Ko(this.userData,s),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Point Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,30],property:[this,"intensity"]},{type:"input",label:"Distance",property:[this,"distance"]},{type:"input",property:[this,"decay"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,i;(e=this.shadow.map)===null||e===void 0||e.dispose(),(i=this.shadow.mapPass)===null||i===void 0||i.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:i}=this;this.userData={};const s=super.toJSON(e);return s.userData=Wr(Ko({},i),!1),this.userData={},s.type="PointLight2",Object.assign(s,Wr(this,!0,e))}fromJSON(e,i){return e.type!=="PointLight2"?null:e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),e.object.distance!==void 0&&(this.distance=e.object.distance),e.object.decay!==void 0&&(this.decay=e.object.decay),os(e,this,!0,i),this):this}}class I1 extends d.Mig{constructor(e,i){super(e,i),this.assetType="light"}get lightObject(){return this}get modelObject(){return this}copy(e,i){const s=e.userData;return e.userData={},super.copy(e,i),Ko(this.userData,s),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ambient Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]}]}}toJSON(e){const{userData:i}=this;this.userData={};const s=super.toJSON(e);return s.userData=Wr(Ko({},i),!1),this.userData={},s.type="AmbientLight2",Object.assign(s,Wr(this,!0,e))}fromJSON(e,i){return e.type!=="AmbientLight2"?null:e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),os(e,this,!0,i),this):this}}class FM extends d.aNw{load(e,i,s,a){const h=new d.hH6(this.manager);h.setPath(this.path),h.setResponseType("text"),h.load(e,f=>{try{i(this.parse(f))}catch(k){a?a(k):console.error(k),this.manager.itemError(e)}},s,a)}parse(e){e=e.replace(/^#.*?(\n|\r)/gm,"").replace(/^\s*?(\n|\r)/gm,"").trim();let i=null,s=null;const a=new d.Pa4(0,0,0),h=new d.Pa4(1,1,1),f=e.split(/[\n\r]+/g);let k=null,et=0;for(let lt=0,pt=f.length;lt<pt;lt++){const ft=f[lt].trim(),vt=ft.split(/\s/g);switch(vt[0]){case"TITLE":i=ft.substring(7,ft.length-1);break;case"LUT_3D_SIZE":const yt=vt[1];s=parseFloat(yt),k=new Uint8Array(s*s*s*4);break;case"DOMAIN_MIN":a.x=parseFloat(vt[1]),a.y=parseFloat(vt[2]),a.z=parseFloat(vt[3]);break;case"DOMAIN_MAX":h.x=parseFloat(vt[1]),h.y=parseFloat(vt[2]),h.z=parseFloat(vt[3]);break;default:const Mt=parseFloat(vt[0]),xt=parseFloat(vt[1]),Et=parseFloat(vt[2]);if(Mt>1||Mt<0||xt>1||xt<0||Et>1||Et<0)throw new Error("LUTCubeLoader : Non normalized values not supported.");k[et+0]=255*Mt,k[et+1]=255*xt,k[et+2]=255*Et,k[et+3]=255,et+=4}}const tt=new d.IEO;tt.image.data=k,tt.image.width=s,tt.image.height=s*s,tt.type=d.ywz,tt.magFilter=d.wem,tt.minFilter=d.wem,tt.wrapS=d.uWy,tt.wrapT=d.uWy,tt.generateMipmaps=!1,tt.needsUpdate=!0;const rt=new d.JUT;return rt.image.data=k,rt.image.width=s,rt.image.height=s,rt.image.depth=s,rt.type=d.ywz,rt.magFilter=d.wem,rt.minFilter=d.wem,rt.wrapS=d.uWy,rt.wrapT=d.uWy,rt.wrapR=d.uWy,rt.generateMipmaps=!1,rt.needsUpdate=!0,{title:i,size:s,domainMin:a,domainMax:h,texture:tt,texture3D:rt}}}class uo extends j{constructor(e,i=!1){super(),this._processors=new E0,this._logger=console.log,this._loaderCache=[],this._fileDatabase=new Map,this._cachedAssets=[],i||(this._logger=()=>{}),this._viewer=e,this._onLoad=this._onLoad.bind(this),this._onProgress=this._onProgress.bind(this),this._onError=this._onError.bind(this),this._onStart=this._onStart.bind(this),this._urlModifier=this._urlModifier.bind(this),this._loadingManager=new d.lLk(this._onLoad,this._onProgress,this._onError),this._loadingManager.onStart=this._onStart,this._loadingManager.setURLModifier(this._urlModifier),T1(),y1(e.renderer.rendererObject),Lu(e),Kv()}get processors(){return this._processors}get loadingManager(){return this._loadingManager}_onLoad(){this.dispatchEvent({type:"onLoad"})}_onProgress(e,i,s){this.dispatchEvent({type:"onProgress",url:e,loaded:i,total:s})}_onError(e){this.dispatchEvent({type:"onError",url:e})}_onStart(e,i,s){this.dispatchEvent({type:"onStart",url:e,loaded:i,total:s})}_urlModifier(e){var i;let s=decodeURI(e);const a=(i=this._rootContext)===null||i===void 0?void 0:i.rootUrl;s.includes("://")||!a||s.startsWith(a)||(s=a+s),s=s.replace("./",""),s=s.replace(/^(\/\/)/,"/"),s=s.replace(/\?.*$/,"");const h=this._fileDatabase.get(s);return h?h.ext?(h.objectUrl||(h.objectUrl=URL.createObjectURL(h)+"#"+s),h.objectUrl):(console.error("Unable to determine file extension",h),e):e}_createLoader(e){const i=this._getImporter(e),s=i==null?void 0:i.ctor(this);return s&&(i==null||i.ext.forEach(a=>{const h=new RegExp(a.startsWith("data:")?"^"+a+"\\/":"\\."+a+"$","i");this._loadingManager.addHandler(h,s)})),s&&(this._loaderCache.push({loader:s,files:[]}),this.dispatchEvent({type:"loaderCreate",loader:s})),s}async importFiles(e,i={}){const s=new Map;let{allowedExtensions:a}=i;if(a&&a.length<1&&(a=void 0),e.size===0)return s;this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"start"});const h=[],f=[];if(e.forEach((k,et)=>{var tt;this.registerFile(et,k);const rt=k.ext;rt&&((tt=a==null?void 0:a.includes(rt.toLowerCase()))===null||tt===void 0||tt)&&(this._isRootFileExtension(rt)?h.push(et):f.push(et))}),h.length>0)for(const k of h){let et=await this._importFile(k,void 0,i);et&&(et=await this.processImported(et,i)),s.set(k,et)}else for(const k of f){let et=await this._importFile(k,void 0,i);et&&(et=await this.processImported(et,i)),s.set(k,et)}return this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"end"}),e.forEach((k,et)=>{this.unregisterFile(et)}),s}registerFile(e,i){var s,a,h;e=e.replace(/\?.*$/,"");const f=(s=i==null?void 0:i.ext)!==null&&s!==void 0?s:(h=_A((a=i==null?void 0:i.name)!==null&&a!==void 0?a:e))===null||h===void 0?void 0:h.toLowerCase();i&&(i.ext||(i.ext=f),this._fileDatabase.set(e,i));let k=this._getLoader(e);if(k||(k=this._createLoader(i??{name:e,ext:f})),k){for(const et of this._loaderCache)if(et.loader===k){et.files.push(e);break}}return k}unregisterFile(e){e=e.replace(/\?.*$/,"");const i=this._fileDatabase.get(e);i!=null&&i.objectUrl&&(URL.revokeObjectURL(i.objectUrl),i.objectUrl=void 0),i&&this._fileDatabase.delete(e)}_isRootFileExtension(e){return uo.Importers.find(i=>i.root&&i.ext.includes(e.toLowerCase()))!=null}resolveURL(e){return this._loadingManager.resolveURL(e)}async _importFile(e,i,s={},a){var h,f;if(!((h=i)===null||h===void 0)&&h.__imported)return i.__imported;let k;this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:0});try{this.registerFile(e,i),s.rootPath=e;const et=this.resolveURL(e),tt=e.replace(/\?.*$/,""),rt=(f=s.fileHandler)!==null&&f!==void 0?f:await this._loadingManager.getHandler(tt)||(i?await this._loadingManager.getHandler(i.name||i.ext||""):void 0);if(!rt)throw new Error("AssetImporter: Unable to find loader for "+e);this._rootContext={path:e,url:et,rootUrl:d.Zp0.extractUrlBase(e),baseUrl:d.Zp0.extractUrlBase(et)},k=await rt.loadAsync(e+(s.queryString?(e.includes("?")?"&":"?")+s.queryString:""),lt=>{a&&a(lt),this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:lt.loaded/lt.total})}),this._rootContext=void 0,this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:1}),this.dispatchEvent({type:"importFile",path:e,state:"adding"}),i?this._logger("AssetImporter: loaded",e):this._logger("AssetImporter: downloaded",e),i&&this.unregisterFile(e)}catch(et){return console.error("AssetImporter: Unable to import file",e,i),console.error(et),console.error(et==null?void 0:et.stack),this.dispatchEvent({type:"importFile",path:e,state:"error",error:et}),[]}return this.dispatchEvent({type:"importFile",path:e,state:"done"}),i&&(i.__imported=k),k}_getImporter(e,i=!1){return uo.Importers.find(s=>{if(i&&!s.root)return!1;const a=s.ext.find(h=>{var f,k,et;return e.ext&&h===e.ext.toLowerCase()||((k=(f=e.name)===null||f===void 0?void 0:f.toLowerCase())===null||k===void 0?void 0:k.endsWith("."+h.toLowerCase()))||(h==null?void 0:h.startsWith("data:"))&&((et=e.name)===null||et===void 0?void 0:et.startsWith(h))});return!!a&&(e.ext=a,!0)})}_getLoader(e){var i;return(i=this._loadingManager.getHandler(e))!==null&&i!==void 0?i:void 0}async importAsset(e,i={},s){var a;if(!e)return[];if(!this._cachedAssets.includes(e)){if(Object.entries(e).length===1&&e.path){const k=this._cachedAssets.find(et=>et.path===e.path);k&&Object.assign(e,k)}const f=this._cachedAssets.findIndex(k=>k.path===e.path);f>=0&&this._cachedAssets.splice(f,1),this._cachedAssets.push(e)}let h;if(e!=null&&e.preImported&&(h=await e.preImported),!i.forceImport&&h){const f=await this.processImported(h,i);let k=!1;for(const et of f)if(et.__disposed){k=!0;break}if(!k||i.reimportDisposed===!1)return f}return e.preImported=this._importFile(i.pathOverride||e.path,typeof((a=e.file)===null||a===void 0?void 0:a.arrayBuffer)=="function"?e.file:void 0,i,s),h=await e.preImported,h&&(h=await this.processImported(h,i)),h}async importSingle(e,i={}){var s;return(s=await this.importAsset(e,i))===null||s===void 0?void 0:s[0]}async importSinglePath(e,i){var s;return(s=await this.importPath(e,i))===null||s===void 0?void 0:s[0]}async importPath(e,i={}){const s={...i};delete s.pathOverride,delete s.forceImport,delete s.reimportDisposed;const a=JSON.stringify(s);let h;return h=this._cachedAssets.find(f=>f.path===e&&f._options===a)||{path:e},h._options=a,await this.importAsset(h,i)}async processImportedSingle(e,i={}){return(await this.processImported(e,i))[0]}async processImported(e,i={}){var s,a,h,f,k,et,tt,rt;let lt=e;if(!lt)return[];if(i.processImported===!1)return[lt];if(Array.isArray(lt)){const pt=[];for(const ft of lt)pt.push(...await this.processImported(ft,i));return pt}if(!((s=lt.userData)===null||s===void 0)&&s.rootSceneModelRoot){if(i._rootSceneImported=!0,lt.__processedChildren&&!i.forceImporterReprocess)return lt.__processedChildren;if(!(lt.children.length<1))return lt.animations&&(lt.children[0].animations||(lt.children[0].animations=[]),lt.children[0].animations.push(...lt.animations)),lt.__importedViewerConfig&&(lt.children[0].__importedViewerConfig=lt.__importedViewerConfig),lt.__processedChildren=await this.processImported([...lt.children],i),lt.__processedChildren;if(((a=lt.animations)===null||a===void 0?void 0:a.length)>0&&console.error("AssetImporter: animations in empty scene not supported yet. animations will be ignored",lt.animations),!lt.__importedViewerConfig)return[];lt=lt.__importedViewerConfig}if(!((h=lt.userData)===null||h===void 0)&&h.iModel&&(lt=lt.userData.iModel),!((f=lt.userData)===null||f===void 0)&&f.iMaterial&&(lt=lt.userData.iMaterial),lt.assetImporterProcessed&&!i.forceImporterReprocess)return[lt];if(!lt.assetType){if(lt.isBufferGeometry&&(lt=new d.Kj0(lt,new d.Wid)),lt.isObject3D){if(lt.isLight)lt=BS(lt);else{const pt=[];lt.traverse(ft=>{ft!==lt&&ft.isLight&&pt.push(ft)});for(const ft of pt)BS(ft);lt=new dv(lt,i)}!i.rootPath||lt.modelObject.userData.rootPath||i.rootPath.startsWith("blob:")||i.rootPath.startsWith("/")||(lt.modelObject.userData.rootPath=i.rootPath)}lt.isTexture&&(lt.assetType="texture",i._testDataTextureComplete&&(lt.isDataTexture&&(!((k=lt.image)===null||k===void 0)&&k.data)&&(lt.image.complete=!0),!((et=lt.image)===null||et===void 0)&&et.complete&&(lt.needsUpdate=!0)),i.generateMipmaps!==void 0&&(lt.generateMipmaps=i.generateMipmaps),lt.generateMipmaps||lt.isRenderTargetTexture||(lt.minFilter=lt.minFilter===d.D1R?d.wem:lt.minFilter,lt.magFilter=lt.magFilter===d.D1R?d.wem:lt.magFilter),!i.rootPath||lt.userData.rootPath||i.rootPath.startsWith("blob:")||i.rootPath.startsWith("/")||(lt.userData.rootPath=i.rootPath)),lt.isMaterial&&(lt.assetType="material",!i.rootPath||lt.userData.rootPath||i.rootPath.startsWith("blob:")||i.rootPath.startsWith("/")||(lt.userData.rootPath=i.rootPath))}if(lt.assetType!=null)return lt=await this._processors.process(lt.assetType,lt,{}),lt.assetImporterProcessed=!0,[lt];if(lt instanceof Map)return[...(await this.importFiles(lt,i)).values()].flat();if(lt.type){const pt=this._viewer.getPluginByType(lt.type);if(pt){let ft=lt._importedResources||{};return lt.resources&&(ft=await((tt=this._viewer.getManager())===null||tt===void 0?void 0:tt.importConfigResources(lt.resources)),delete lt.resources,lt._importedResources=ft),typeof pt.fromJSON=="function"&&(await Promise.resolve(pt.fromJSON(lt,ft)),lt.assetImporterProcessed=!1),[]}}else if(lt.plugins)return lt.resources=await((rt=this._viewer.getManager())===null||rt===void 0?void 0:rt.importConfigResources(lt.resources)),await this._viewer.getManager().importViewerConfig(lt),lt.assetImporterProcessed=!1,[];return console.warn("unknown asset type: ",lt),[lt]}dispose(){var e;(e=this._processors)===null||e===void 0||e.dispose()}}function P1(c){if(!c)return d.ywz;const e=c.extensions.has("EXT_color_buffer_half_float")||c.capabilities.isWebGL2&&c.extensions.has("EXT_color_buffer_float"),i=c.capabilities.isWebGL2||c.extensions.has("OES_texture_float")||c.extensions.has("WEBGL_color_buffer_float");return e?d.cLu:i?d.VzW:d.ywz}function BS(c){var e,i,s;if(!c.isLight||c.assetType==="light")return c;if(c.uiConfig)return console.warn("ui config already exists, not supported",c),c;let a;if(c.children.length,c.isDirectionalLight&&(a=new n_),c.isAmbientLight&&(a=new I1),c.isSpotLight&&(a=new Ny),c.isPointLight&&(a=new kS),a){(i=(e=a.lightObject).copy)===null||i===void 0||i.call(e,c);const h=c.parent;!((s=h)===null||s===void 0)&&s.isObject3D&&(h.remove(c),c.dispose(),c.userData.iModel=a,h.add(a.lightObject),a.uuid=c.uuid),vs(a.lightObject,h)}else console.warn("unknown light type: ",c);return a}uo.Importers=[new zl(AA,["json"],!1),new zl(d.hH6,["txt"],!1),new zl(O_,["rgbe.png","hdr.png","hdrpng"],!1),new zl(d.dpR,["webp","png","jpeg","jpg","svg","data:image"],!1),new zl(FM,["CUBE"],!1)];class UM extends d.u7G{constructor(e){super(e)}async loadAsync(e,i){var s;const a=new d.hH6(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials);const h=await a.loadAsync(e,i);try{const f=JSON.parse(h);if(f.images&&this.importer){const k={};let et=f.images;Array.isArray(et)||(et=Object.values(et));for(const tt of f.images){if(!tt.url||!tt.uuid)continue;const rt=(s=await this.importer.importPath(tt.url,{processImported:!1}))===null||s===void 0?void 0:s[0],lt=rt==null?void 0:rt.source;if(!rt||!lt)continue;const pt=new d.Hw6(lt.data);pt.uuid=tt.uuid,k[pt.uuid]=pt,rt.dispose()}return this.parse(f,k)}return this.parse(f)}catch(f){throw console.error(f),this.manager.itemError(e),f}}parse(e,i){var s,a;let h;const f={p:new Promise(rt=>{h=rt})};if(e.images||e.textures){const rt=new SA(this.manager);let lt={};const pt=Mt=>{h(),f.p=void 0,Object.values(lt).forEach(xt=>{var Et;xt.isTexture&&(!((Et=xt.image)===null||Et===void 0)&&Et.complete)&&(xt.needsUpdate=!0)})};let ft=e.images||[];Array.isArray(ft)||(ft=Object.values(ft));const vt=i||rt.parseImages(ft,pt);let yt=e.textures;Array.isArray(yt)||(yt=Object.values(yt)),lt=rt.parseTextures2(yt,vt,pt),this.setTextures(lt)}this.materials||console.warn("A Material Manager is not set to import three materials, trying standard materials");const k={...e};if(Object.entries(k).forEach(([rt,lt])=>{lt&&typeof lt=="string"&&this.textures[lt]&&(k[rt]=this.textures[lt])}),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?k.vertexColors=e.vertexColors>0:k.vertexColors=e.vertexColors),e.normalScale!==void 0){let rt=e.normalScale;Array.isArray(rt)===!1&&(rt=[rt,rt]),k.normalScale=new d.FM8().fromArray(rt)}let et=e.type;et!=="MeshPhysicalMaterial"&&et!=="MeshStandardMaterial"||(et=$u.TYPE),k.userData=os(k.userData,void 0,!1,this);const tt=(a=(s=this.materials)===null||s===void 0?void 0:s.generateFromTemplateType(et,k))!==null&&a!==void 0?a:super.parse(e);return this.setTextures({}),tt.userData.imageLoadAwaiter=f,tt}}class Kr extends j{constructor(e,i,{simpleCache:s=!1,storage:a}={}){if(super(),this._sceneUpdated=this._sceneUpdated.bind(this),this.addAsset=this.addAsset.bind(this),this.addProcessedAssets=this.addProcessedAssets.bind(this),this.addImported=this.addImported.bind(this),(s||a)&&(s&&(d.CtF.enabled=!0),a&&window.Cache&&typeof window.Cache=="function"&&a instanceof window.Cache)){const h={...d.CtF};d.CtF.get=(f,k,et)=>k?f.startsWith("data:")||f.startsWith("blob")||f.startsWith("chrome-extension")?Promise.resolve(void 0):a.match(f).then(tt=>{if(tt)switch(k){case"arraybuffer":return tt.arrayBuffer();case"blob":return tt.blob();case"document":return tt.text().then(rt=>new DOMParser().parseFromString(rt,et??"text/html"));case"json":return tt.json();default:if(et===void 0)return tt.text();{const rt=/charset="?([^;"\s]*)"?/i.exec(et),lt=rt&&rt[1]?rt[1].toLowerCase():void 0,pt=new TextDecoder(lt);return tt.arrayBuffer().then(ft=>pt.decode(ft))}}}):h.get(f),d.CtF.add=(f,k,et)=>{et||h.add(f,k),f.startsWith("data:")||f.startsWith("blob")||f.startsWith("chrome-extension")||a.put(f,new Response(k,{status:200}))},d.CtF.remove=(f,k)=>{k||h.remove(f),a.delete(f)}}this._importer=e,this._materials=i}async addAsset(e,i={}){if(!this._importer||!this._viewer)return[];const s=await this._importer.importAsset(e,i);return s?(this.addProcessedAssets(s,i),s):(console.warn("Unable to import",e,s),[])}async addFromPath(e,i={}){if(!this._importer||!this._viewer)return[];const s=await this._importer.importPath(e,i);return s?(this.addProcessedAssets(s,i),s):(console.warn("Unable to import",e,s),[])}addProcessedAssets(e,i){return e.map(s=>{var a;return(a=this._viewer)===null||a===void 0?void 0:a.scene.addSceneObject(s,i)})}async addAssetSingle(e,i={}){var s;return e?(s=await(typeof e=="string"?this.addFromPath:this.addAsset)(e,i))===null||s===void 0?void 0:s[0]:void 0}async addImported(e,i={}){var s;return(s=this._importer)===null||s===void 0?void 0:s.processImported(e,i).then(a=>(this.addProcessedAssets(a,i),a))}async addImportedSingle(e,i={}){return this.addImported(e,i).then(s=>s==null?void 0:s[0])}_sceneUpdated(e){var i;if(e.type==="addSceneObject"){const s=e.object;s.assetType==="material"&&((i=this._materials)===null||i===void 0||i.processMaterial(s,{}))}else console.error("Unexpected")}async onAdded(e){this._viewer=e,this._materials||(this._materials=new I_,this._viewer.scene.addEventListener("addSceneObject",this._sceneUpdated)),this._importer||(this._importer=new uo(e,!!e.getPluginByType("debug")),this._importer.processors.add("model",{forAssetType:"model",process:(s,a)=>(P_(s,h=>{var f;return(f=this._materials)===null||f===void 0?void 0:f.processModel(h,{recursive:!1})}),s)}),this._importer.processors.add("model",{forAssetType:"model",process:this._materials.processModel}),this._importer.processors.add("material",{forAssetType:"material",process:(s,a)=>{var h;return!((h=this.materials)===null||h===void 0)&&h.findMaterial(s.uuid)&&(console.warn("imported material uuid already exists, creating new uuid"),s.uuid=er(),s.userData.uuid&&(s.userData.uuid=s.uuid)),this._materials.processMaterial(s,a)}})),uo.Importers.push(new zl(UM,[$u.TypeSlug],!1,s=>(s&&(s.materials=this._materials),s&&(s.importer=this._importer),s)));const i=this.importViewerConfig.bind(this);uo.Importers.push(new zl(class extends AA{async loadAsync(s,a){return i(await super.loadAsync(s,a))}},[Kr.ViewerTypeSlug],!0))}async onDispose(e){}async onRemove(e){var i,s;e===this._viewer&&((i=this._importer)===null||i===void 0||i.dispose(),this._importer=void 0,this._viewer.scene.removeEventListener("addSceneObject",this._sceneUpdated),(s=this._materials)===null||s===void 0||s.dispose(),this._materials=void 0)}get importer(){return this._importer}get exporter(){var e,i;return(i=(e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("AssetExporterPlugin"))===null||i===void 0?void 0:i.exporter}get materials(){return this._materials}exportViewerConfig(e){if(!this._viewer)return{};const i={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},...e},s=this._viewer.toJSON(i);return s.resources=i,s}exportPluginPresets(e){var i;const s={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}};return{plugins:(i=this._viewer)===null||i===void 0?void 0:i.serializePlugins(s,e),resources:s}}exportPluginPreset(e){if(!e.toJSON)return;const i={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},s=e.toJSON(i);return s.resources=i,s}async importPluginPreset(e,i){var s;const a=e.type;if(!(i=i||((s=this._viewer)===null||s===void 0?void 0:s.getPluginByType(a))))return void console.warn(`No plugin found for type ${a} to import preset`);if(!i.fromJSON)return void console.warn(`Plugin ${a} does not support importing presets`);const h=e.resources||{};return e.resources&&delete e.resources,await i.fromJSON(e,h),h&&(e.resources=h),i}async importViewerConfig(e,i){if(!this._viewer||!this._importer)return void console.warn("No viewer or importer");const s=await this.importConfigResources(e.resources||{},i);this.applyViewerConfig(e,s)}applyViewerConfig(e,i){var s;if(this._viewer&&this._importer)if((i=i||e.resources).__isLoadedResources){this._viewer.fromJSON(e,i);for(const a of Object.values(i.materials))a.__useCount?delete a.__useCount:(s=this._materials)===null||s===void 0||s.unregisterMaterial(a);for(const a of Object.values(i.textures))a.__useCount&&delete a.__useCount}else console.error("Cannot load viewer config: resources not loaded",e);else console.warn("No viewer or importer")}async importConfigResources(e,i,s){var a,h,f;if(!this._importer)throw"Importer not initialized yet.";if(e.__isLoadedResources)return e;const k={};i=i??new SA(this._importer.loadingManager),k.animations=e.animations?i.parseAnimations(e.animations):{},s&&s.animations&&(k.animations={...k.animations,...s.animations}),k.shapes=e.shapes?i.parseShapes(e.shapes):{},s&&s.shapes&&(k.shapes={...k.shapes,...s.shapes}),k.geometries=e.geometries?i.parseGeometries(e.geometries,k.shapes):{},s&&s.geometries&&(k.geometries={...k.geometries,...s.geometries}),k.images=e.images?await i.parseImagesAsync(Object.values(e.images)):{},s&&s.images&&(k.images={...k.images,...s.images});for(const tt of Object.values(e.textures)){const rt=(a=tt==null?void 0:tt.userData)===null||a===void 0?void 0:a.rootPath;if(rt&&(!tt.image||!k.images[tt.image])){const lt=(h=await this._importer.importPath(rt,{processImported:!1}))===null||h===void 0?void 0:h[0],pt=lt==null?void 0:lt.source;if(!lt||!pt)continue;const ft=new d.Hw6(pt.data);tt.image&&(ft.uuid=tt.image),k.images[ft.uuid]=ft,tt.image=ft.uuid,lt.dispose()}}k.textures=e.textures?i.parseTextures2(Object.values(e.textures),k.images,()=>{Object.values(k.textures).forEach(tt=>{var rt;tt.isTexture&&(!((rt=tt.image)===null||rt===void 0)&&rt.complete)&&(tt.needsUpdate=!0)})}):{};for(const tt of Object.entries(k.textures))tt[1]=(f=await this._importer.processImported(tt[1],{}))===null||f===void 0?void 0:f[0],tt[1]?k.textures[tt[0]]=tt[1]:delete k.textures[tt[0]];s&&s.textures&&(k.textures={...k.textures,...s.textures});const et=e.materials?Object.values(e.materials):[];for(const tt of et)Object.entries(tt).forEach(([rt,lt])=>{lt&&lt.resource&&lt.uuid&&lt.resource==="textures"&&(tt[rt]=lt.uuid)});return k.materials=i.parseMaterials2(et,k.textures,this._materials),s&&s.materials&&(k.materials={...k.materials,...s.materials}),e.object&&(k.object=i.parseObject(e.object,k.geometries,k.materials,k.textures,k.animations),e.skeletons&&(k.skeletons=i.parseSkeletons(e.skeletons,k.object),i.bindSkeletons(k.object,k.skeletons))),k.__isLoadedResources=!0,k}}Kr.PluginType="AssetManager",Kr.ViewerTypeSlug="vjson";class Js extends j{constructor(){super(...arguments),this._dirty=!1}get dirty(){return this._dirty}set dirty(e){this._dirty=e}async onAdded(e){this._viewer=e}async onDispose(e){}async onRemove(e){this._viewer!==e&&console.error("Wrong viewer"),this._viewer=void 0}toJSON(e){const i=Wr(this,!0,e);return i.type=this.constructor.PluginType,this.dispatchEvent({type:"serialize",data:i}),i}fromJSON(e,i){return e.type!==this.constructor.PluginType?null:(os(e,this,!0,i),this.dispatchEvent({type:"deserialize",data:e}),this)}}function UA(c,e,i){return{...e,get dirty(){return e.dirty||!1},set dirty(s){nn(e,"dirty",s,!0)},update(){var s,a,h;this.passObject.enabled&&((a=(s=this.passObject).updateShaderProperties)===null||a===void 0||a.call(s,Ht(i)),(h=e.update)===null||h===void 0||h.call(this))},onRegister(s){var a,h,f;this.passObject.materialExtension&&((h=(a=c.getPlugin(Kr))===null||a===void 0?void 0:a.materials)===null||h===void 0||h.registerMaterialExtension(this.passObject.materialExtension)),(f=e.onRegister)===null||f===void 0||f.call(this,s)},onUnregister(s){var a,h,f;this.passObject.materialExtension&&((h=(a=c.getPlugin(Kr))===null||a===void 0?void 0:a.materials)===null||h===void 0||h.unregisterMaterialExtension(this.passObject.materialExtension)),(f=e.onUnregister)===null||f===void 0||f.call(this,s)},dispose(){var s,a,h;(a=(s=this.passObject).dispose)===null||a===void 0||a.call(s),(h=e.dispose)===null||h===void 0||h.call(this)}}}class wv extends Js{constructor(){super(),this._enabledTemp=!0}_update(e){var i;return((i=this._pass)===null||i===void 0?void 0:i.enabled)&&this.enabled||!1}get enabled(){var e,i;return((i=(e=this._pass)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.enabled)||this._enabledTemp}set enabled(e){var i;!((i=this._pass)===null||i===void 0)&&i.passObject&&(this._pass.passObject.enabled=e),this._enabledTemp=e}async onAdded(e){await super.onAdded(e);const i={enabled:!0,passId:this.passId,passObject:this.passCtor(e),after:this._afterFilters,before:this._beforeFilters,required:this._requiredFilters,set dirty(s){s&&e.setDirty()},get dirty(){return!1},update:()=>this._update(e)};this._pass=UA(e,i),i.passObject.onDirty!==void 0&&i.passObject.onDirty.push(()=>i.dirty=!0),e.renderer.registerPass(this._pass),this.enabled=this._enabledTemp}async onRemove(e){var i,s;this._pass&&e.renderer.unregisterPass(this._pass),(s=(i=this._pass)===null||i===void 0?void 0:i.dispose)===null||s===void 0||s.call(i),this._pass=void 0,await super.onRemove(e)}get pass(){return this._pass}toJSON(e){var i,s;const a=super.toJSON(e);if(!a.type)return a;const h=this.pass;return h&&(a.pass=Wr((s=(i=h)===null||i===void 0?void 0:i.passObject)!==null&&s!==void 0?s:h,!1,e)),a}fromJSON(e,i){var s,a;if(!super.fromJSON(e,i))return null;if(e.pass){const h=this.pass;h&&os(e.pass,(a=(s=h)===null||s===void 0?void 0:s.passObject)!==null&&a!==void 0?a:h,!1,i)}return this}}(function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);h>3&&f&&Object.defineProperty(e,i,f)})([jn()],wv.prototype,"enabled",null);const OS=new Set,LS=new Set;class jM extends Go{constructor(e,i,s,a){super(void 0,void 0,i,new oo(1,1,1),1),this.target=e}render(e,i,s,a,h){const f=e.getRenderTarget(),k=e.getActiveCubeFace(),et=e.getActiveMipmapLevel();this.scene.traverse(({material:tt})=>{tt&&((tt.transparent&&tt.userData.renderToDepth||!tt.transparent&&tt.transmission===0&&tt.userData.renderToDepth===!1)&&(OS.add(tt),tt.transparent=!tt.transparent),Math.abs(tt.transmission||0)>0&&tt.userData.renderToDepth&&(LS.add([tt,tt.transmission]),tt.transmission=0))}),Lr(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(e,i,this.target,a,h)),OS.forEach(tt=>tt.transparent=!tt.transparent),OS.clear(),LS.forEach(([tt,rt])=>tt.transmission=rt),LS.clear(),e.setRenderTarget(f,k,et)}}class ba extends wv{constructor(e=!0){super(),this.renderFlagsBuffer=e,this.passId="gbuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._gbufferTextures=[]}passCtor(e){var i,s;const a=((i=this._viewer)===null||i===void 0?void 0:i.renderer.isWebGL2)&&this.renderFlagsBuffer,h=e.renderer.createTarget({depthBuffer:!0,type:d.ywz,textureCount:a?2:1});Array.isArray(h.texture)?(h.texture[0].name="gbufferDepthNormal",h.texture[1].name="gbufferFlags",this._gbufferTextures=h.texture):(h.texture.name="gbufferDepthNormal",this._gbufferTextures.push(h.texture)),this._gbufferTarget=h;const f=(s=this._viewer)===null||s===void 0?void 0:s.getPluginByType("debug");return f&&(f.addTexture("gbuffer depth normal",()=>this.getDepthNormal(),[40,110,300,200]),this._gbufferTextures.length>1&&f.addTexture("gbuffer flags",()=>this.getFlagsTexture(),[40,310,200,100])),new jM(h,new Kp(a))}_update(e){if(!super._update(e))return!1;const i=this.pass.passObject;return i.scene=e.scene.modelObject,e.scene.activeCamera.updateShaderProperties(i.overrideMaterial),i.camera=e.scene.activeCamera.cameraObject,!0}getDepthNormal(){return this._gbufferTextures.length>0?this._gbufferTextures[0]:void 0}getFlagsTexture(){return this._gbufferTextures.length>1?this._gbufferTextures[1]:void 0}async onDispose(e){}async onRemove(e){return this._gbufferTarget&&(e.renderer.disposeTarget(this._gbufferTarget),this._gbufferTarget=void 0),super.onRemove(e)}getTarget(){return this._gbufferTarget}getUnpackSnippet(){return Hv}updateShaderProperties(e){var i,s;if(e.uniforms.tNormalDepth?e.uniforms.tNormalDepth.value=(i=this.getDepthNormal())!==null&&i!==void 0?i:void 0:console.warn("BaseRenderer: no uniform: tNormalDepth"),e.uniforms.tGBufferFlags){e.uniforms.tGBufferFlags.value=(s=this.getFlagsTexture())!==null&&s!==void 0?s:void 0;const a=e.uniforms.tGBufferFlags.value?1:0;a!==e.defines.GBUFFER_HAS_FLAGS&&(e.defines.GBUFFER_HAS_FLAGS=a,e.needsUpdate=!0)}return this}}ba.PluginType="GBuffer";class zM extends Go{constructor(e,i=!0){super(),this.blurTransmissionTarget=!1,this._viewer=e,this._doTransmissionFix=i,this.clear=!0,this.clearColor=new oo(0,0,0),this.clearAlpha=0,this.clearDepth=!1,this._blendPass=new vA({},"c = vec4(a.rgb * (1. - b.a) + b.rgb * b.a, 1.);")}get transparentTarget(){return this._transparentTarget||(this._transparentTarget=this._viewer.renderer.getTempTarget({sizeMultiplier:1,samples:this._viewer.renderer.composerTarget.samples||0,encoding:d.rnI,type:d.cLu,format:d.wk1,minFilter:d.wem,magFilter:d.wem,depthBuffer:!1})),this._transparentTarget}_releaseTransparentTarget(){this._transparentTarget&&this._viewer.renderer.releaseTempTarget(this._transparentTarget),this._transparentTarget=void 0}render(e,i,s,a,h){var f;let k=!1;if(e.userData.mainRenderPass=!0,!this._doTransmissionFix)return super.render(e,i,s,a,h),this.needsSwap=k,void(e.userData.mainRenderPass=void 0);const et=e.userData;et||console.error("threejs is not patched?");const tt=this._viewer.useGBufferDepth;let rt;if(tt){const pt=(f=this._viewer.getPlugin(ba))===null||f===void 0?void 0:f.getTarget();if(pt){const ft=e.properties.get(pt);rt=ft.__webglDepthRenderbuffer||ft.__webglDepthbuffer}else console.warn("No Gbuffer present for depth prepass.")}let lt=()=>{super.render(e,void 0,s,a,h,rt)};if(this._viewer.useRgbm){if(this._viewer.useRgbm){if(k=!1,!e.info.autoReset)throw"renderer.info.autoReset must be true";{const pt=e.autoClearDepth;e.autoClearDepth=!tt,Lr(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},lt),e.autoClearDepth=pt}if(!tt){const pt=e.properties.get(s);rt=pt.__webglDepthRenderbuffer||pt.__webglDepthbuffer}lt=()=>{super.render(e,void 0,this.transparentTarget,a,h,rt)};{const pt=this.clear,ft=e.autoClearDepth;e.autoClearDepth=!1,this.clear=!0,Lr(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!0,transmissionRender:!1},lt),this.clear=pt,e.autoClearDepth=ft}e.info.render.calls>0&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,i,s,a,h),k=!0);{const pt=this.clear;this.clear=!1,et.transmissionRenderTarget=k?i:s,et.blurTransmissionTarget=this.blurTransmissionTarget,Lr(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},lt),et.blurTransmissionTarget=void 0,et.transmissionRenderTarget=void 0,this.clear=pt}e.info.render.calls>0&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,i,s,a,h),k=!0)}}else{{const pt=this.clear,ft=e.autoClearDepth;e.autoClearDepth=!tt,this.clear=!0,Lr(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!0,transmissionRender:!1},lt),this.clear=pt,e.autoClearDepth=ft}{this._viewer.renderer.blit(s.texture,i,{clear:!0});const pt=this.clear;this.clear=!1,et.transmissionRenderTarget=i,et.blurTransmissionTarget=this.blurTransmissionTarget,Lr(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},lt),et.blurTransmissionTarget=void 0,et.transmissionRenderTarget=void 0,this.clear=pt}k=!1}this._releaseTransparentTarget(),this.needsSwap=k,e.userData.mainRenderPass=void 0}}function NS(c,e){return c.multiplyScalar(c.w*e),c.w=1,c}function FS(c,e){return NS(c,e),new oo(c.x,c.y,c.z)}function US(c,e){const i=Math.max(c.x,Math.max(c.y,c.z));let s=Math.max(Math.min(i/e,1),0);return s=Math.ceil(255*s)/255,c.divideScalar(s*e),c.w=s,c}function VM(c,e){return US(new d.Ltg(c.r,c.g,c.b,1),e)}var D1=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};function jS(c){return Object.getPrototypeOf(c).constructor.PluginType}d.Vj0.background.fragmentShader=d.Vj0.background.fragmentShader.replace("uniform sampler2D t2D;",`uniform sampler2D t2D;
uniform float intensity;`),d.Vj0.background.fragmentShader=d.Vj0.background.fragmentShader.replace("texture2D( t2D, vUv )","texture2D( t2D, vUv )*intensity");class Ym extends j{constructor({isAntialiased:e=!1,useRgbm:i=!0,useGBufferDepth:s=!1,screenShader:a="",...h}){var f;super(),this.console=console,this._state=b.None,this.plugins={},this._needsResize=!1,this.resizeObserver=window.ResizeObserver?new window.ResizeObserver(pt=>this.resize()):void 0,this._lastSize=new d.FM8,this._onContextRestore=pt=>{this.enabled=!0,this._canvas.width=this._lastSize.width,this._canvas.height=this._lastSize.height,this.resize(),this.scene.setDirty({sceneUpdate:!0,frameFade:!1})},this._onContextLost=pt=>{this._lastSize.set(this._canvas.width,this._canvas.height),this._canvas.width=2,this._canvas.height=2,this.resize(),this.enabled=!1},this.resize=()=>{this._needsResize=!0,this.setDirty()},this._needsReset=!0,this.enabled=!0,this.renderEnabled=!0,this._isRenderingFrame=!1,this.maxFramePerLoop=1,this._rawBackground=null,this.backgroundIntensity=1,this._sceneEnvironmentChanged=()=>{this._rawBackground===xv&&this.scene.setBackground(this.scene.getEnvironment())},this._addSceneObject=pt=>{var ft;if(!pt||!pt.object)return;const vt=pt.object.__importedViewerConfig||((ft=pt.object.modelObject)===null||ft===void 0?void 0:ft.__importedViewerConfig);if(!vt)return;const yt=this.getManager();yt?yt.applyViewerConfig(vt,vt.resources):this.fromJSON(vt,vt.resources)},this.alert=async pt=>alert(pt),this.confirm=async pt=>confirm(pt),this.prompt=async(pt,ft,vt=!0)=>prompt(pt,ft),this._useRgbm=i,this._useGBufferDepth=s,this._screenShader=a,this._canvas=h.canvas||b_();let k=h.container;if(k&&!h.canvas&&k.appendChild(this._canvas),k||(k=(f=this._canvas.parentElement)!==null&&f!==void 0?f:void 0),!k)throw new Error("No container.");this._container=k,this._animationLoop=this._animationLoop.bind(this),this.setDirty=this.setDirty.bind(this),this._setActiveCameraView=this._setActiveCameraView.bind(this),window.webGiViewers||(window.webGiViewers=[]),window.webGiViewers.push(this),async function(){try{const pt=window.location.href;if(pt.startsWith("http://localhost:8062")||pt.startsWith("https://localhost:8062"))return!0;await fetch("https://europe-west1-pixotronics-320918.cloudfunctions.net/viewer-hit-test"+"/?u="+encodeURIComponent(pt),{mode:"no-cors",method:"POST",credentials:"omit",cache:"no-store",keepalive:!1,referrer:"about:client",referrerPolicy:"unsafe-url"})}catch{return!1}}(),async function(){var pt;const ft=window.location.href,vt="https://dev-sandbox.pixotronics.com/webgi/";if(!ft.startsWith(vt)||C_("noUpdate")!==null)return!0;const yt=(pt=ft.match(/\/webgi\/([0-9.a-zA-Z]+)/))===null||pt===void 0?void 0:pt[1],Mt=(await(await fetch(vt+"version.txt")).text()).split(`
`)[0];if(yt&&yt!==Mt){if(confirm(`New version ${Mt} is available, do you want to open?`)){const xt=window.location.href.replace(yt,Mt);return window.location.href=xt,!1}window.location.href.includes("noUpdate")||(window.location.href+=(window.location.href.includes("?")?"&":"?")+"noUpdate")}}();const et=new wp(void 0,void 0,this._canvas);this.addEventListener("postFrame",()=>{var pt,ft;const vt=rt.scene.activeCamera;if(vt&&vt.interactionsEnabled){if(((pt=this.getPluginByType("Progressive"))===null||pt===void 0?void 0:pt.postFrameConvergedRecordingDelta())===0)return;(ft=vt.controls)===null||ft===void 0||ft.update()}}),this.scene=new x_(et),this.scene.addEventListener("environmentChanged",this._sceneEnvironmentChanged),this.scene.addEventListener("addSceneObject",this._addSceneObject),this.scene.addEventListener("setView",this._setActiveCameraView),this.scene.addEventListener("activateMain",this._setActiveCameraView),this._renderer=new ws({canvas:this._canvas,animationLoop:this._animationLoop,targetOptions:{samples:e?4:0,encoding:i?zn:d.rnI,type:i?d.ywz:d.cLu,depthBuffer:!s}}),this._isAntialiased=e&&this._renderer.isWebGL2;let tt=!0;this._renderer.rendererObject.userData||(tt=!1,this._renderer.rendererObject.userData={}),this._renderer.rendererObject.userData.renderTransmissionPass=!tt;const rt=this;this.renderFilter={passId:"render",passObject:new zM(this,tt),update(){const pt=this.passObject;pt.scene=rt.scene.modelObject,pt.camera=rt.scene.activeCamera.cameraObject}};const lt={passId:"screen",after:["render"],required:["render"],passObject:jA(a)};[this.renderFilter,lt].forEach(pt=>this._renderer.registerPass(pt)),this._renderer.pipeline=["render","screen"],this.scene.addEventListener("sceneMaterialUpdate",pt=>this.setDirty(this.scene,pt)),this.scene.addEventListener("sceneUpdate",pt=>{this.setDirty(this.scene,pt),pt.geometryChanged!==!1&&this.renderer.resetShadows()}),this.scene.addEventListener("update",pt=>this.setDirty(this.scene,pt)),this._renderer.addEventListener("update",pt=>this.setDirty(this._renderer,pt)),this.resizeObserver&&this.resizeObserver.observe(this._canvas),window&&window.addEventListener("resize",this.resize),this._canvas.addEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.addEventListener("webglcontextlost",this._onContextLost,!1),this.renderer.addEventListener("resize",()=>{this.scene.activeCamera.refreshAspect()}),this.setBackground("#ffffff"),this.console.log("WebGi Viewer instance initialized, version: ",Ym.VERSION)}get useRgbm(){return this._useRgbm}get screenShader(){return this._screenShader}get useGBufferDepth(){return this._useGBufferDepth}get isAntialiased(){return this._isAntialiased}setDirty(e,i){this._needsReset=!0,e=e??this,this.dispatchEvent({...i??{},type:"update",source:e})}get renderer(){return this._renderer}dispose(){var e;this._canvas.removeEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.removeEventListener("webglcontextlost",this._onContextLost,!1),(e=window.webGiViewers)===null||e===void 0||e.splice(window.webGiViewers.indexOf(this),1),this.resizeObserver?this.resizeObserver.unobserve(this._canvas):window.removeEventListener("resize",this.resize),this.dispatchEvent({type:"dispose"})}_animationLoop({time:e,deltaTime:i,xrFrame:s}){var a,h;if(this.enabled&&this.renderEnabled)if(this._isRenderingFrame)this.console.warn("animation loop: frame skip");else{this._isRenderingFrame=!0;for(let f=0;f<this.maxFramePerLoop;f++){if(this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._needsResize){const tt=[this._canvas.clientWidth,this._canvas.clientHeight];if(s){const rt=(h=(a=this._renderer.rendererObject.xr.getCamera())===null||a===void 0?void 0:a.cameras[0])===null||h===void 0?void 0:h.viewport;rt?(rt.x===0&&rt.y===0||this.console.warn("x and y must be 0?"),tt[0]=rt.width,tt[1]=rt.height,this.console.log("resize for xr",tt)):this._needsResize=!1}this._needsResize&&(this._renderer.setSize(...tt),this._needsResize=!1)}this.dispatchEvent({type:"preFrame",target:this,time:e,deltaTime:i,xrFrame:s});const k=Object.values(this.plugins).filter(tt=>tt.dirty);k.length>0&&this.setDirty(k),this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._renderer.updateDirty();const et=this._renderer.dirty;if(et){this.dispatchEvent({type:"preRender",target:this});try{this._renderer.render()}catch(tt){this.console.error(tt),this.enabled=!1}this.dispatchEvent({type:"postRender",target:this})}if(this.dispatchEvent({type:"postFrame",target:this}),!et)break}this._isRenderingFrame=!1}}get state(){return this._state}get container(){return this._container}get canvas(){return this._canvas}getPlugin(e){return this.plugins[e.PluginType]}getPluginByType(e){return this.plugins[e]}async addPlugin(e,...i){var s;let a;a=e.prototype?new e(...i):e;const h=jS(a);return h?((s=a.dependencies)===null||s===void 0||s.forEach(f=>{this.getPlugin(f)||(this.console.log("Adding plugin dependency",f.name,"for",h),this.addPlugin(f))}),this.plugins[h]&&this.console.error(`Plugin of type ${h} already exists`,this.plugins[h],a),this.plugins[h]=a,await a.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:a}),this.setDirty(a),a):(this.console.error("PluginType is not defined for",a),a)}async removePlugin(e,i=!0){const s=jS(e);this.plugins[s]&&(await e.onRemove(this),delete this.plugins[s],i&&await e.onDispose(this),this.setDirty(e))}createCamera(e){var i;const s=(i=e.userData.iCamera)!==null&&i!==void 0?i:new wp(e,{controlsMode:"",controlsEnabled:!1},this._canvas);return s.autoLookAtTarget=!1,s}setSize(e){this._canvas.style.width=e!=null&&e.width?e.width+"px":"100%",this._canvas.style.height=e!=null&&e.height?e.height+"px":"100%",this.resize()}_backgroundIntensityChanged(){var e,i,s,a;const h=(a=(s=(i=(e=this._renderer)===null||e===void 0?void 0:e.rendererObject)===null||i===void 0?void 0:i.background.getPlaneMesh())===null||s===void 0?void 0:s.material.uniforms)!==null&&a!==void 0?a:d.Vj0.background.uniforms;h.intensity||(h.intensity={value:1}),h.intensity.value=this.backgroundIntensity,this.setDirty()}setBackgroundColor(e){const i=new oo().set(e).convertSRGBToLinear();return this.setBackground(i)}setBackground(e){if(this._rawBackground=e,e!=null&&(typeof e=="string"||typeof e=="number"||e.isVector4||e.isColor)){if(e===xv)return this._sceneEnvironmentChanged();const i=e.isVector4?Ar(e):Cr(e.isColor?e:new oo(e));return i.assetType="texture",this.scene.setBackground(i)}return!e&&this.useRgbm&&this.console.error("Transparent background not supported with HDR RGBM rendering mode"),this.scene.setBackground(e)}getBackground(e=!1){var i,s,a;if(e)return this._rawBackground;let h=(i=this._rawBackground)!==null&&i!==void 0?i:this.scene.getBackground();return h?(!((s=h)===null||s===void 0)&&s.isVector4&&(h=FS(h,7).getHexString()),!((a=h)===null||a===void 0)&&a.isColor?h.getHexString():this._rawBackground===xv?this.scene.getEnvironment():h):null}getManager(){return this.getPluginByType("AssetManager")}resetCamera({rootObject:e,centerOffset:i=new d.Pa4(1,1,1),targetOffset:s=new d.Pa4(0,0,0),...a}={}){if(this.scene.activeCamera){this.scene.matrixWorldNeedsUpdate=!0,this.scene.updateMatrixWorld(!0);const h=e?new sr().expandByObject(e,!0,!0):this.scene.getBounds(!0),f=h.getCenter(new d.Pa4),k=.5*h.getSize(new d.Pa4).length();f.add(s.clone().multiplyScalar(k)),this.scene.activeCamera.position=new d.Pa4(f.x+i.x*k,f.y+i.y*k,f.z+i.z*k),this.scene.activeCamera.target=f,this.setDirty()}}async createObject3D(e){var i;return(i=this.getManager())===null||i===void 0?void 0:i.addImportedSingle(e||new d.Tme,{autoScale:!1,pseudoCenter:!1})}createPhysicalMaterial(e){return this.createMaterial("standard",e)}createMaterial(e,i){var s,a,h,f,k;if(!((s=i)===null||s===void 0)&&s.isMaterial){const et=(h=(a=this.getManager())===null||a===void 0?void 0:a.materials)===null||h===void 0?void 0:h.findMaterial(i.uuid);if(et)return et}return(k=(f=this.getManager())===null||f===void 0?void 0:f.materials)===null||k===void 0?void 0:k.generateFromTemplate(e,i)}serializePlugins(e,i){return Object.entries(this.plugins).map(s=>{var a,h;if(!i||i.includes(s[1].constructor.PluginType))return s[1].serializeWithViewer!==!1?(h=(a=s[1]).toJSON)===null||h===void 0?void 0:h.call(a,e):void 0}).filter(s=>!!s)}deserializePlugins(e,i){return e.forEach(s=>{var a;if(!s.type)return void this.console.warn("Invalid plugin to import ",s);const h=this.getPluginByType(s.type);h&&((a=h.fromJSON)===null||a===void 0||a.call(h,s,i))}),this}traverseSceneObjects(e){this.scene.modelRoot.modelObject.traverse(e)}toJSON(e,i){return Object.assign({version:Ym.VERSION,plugins:this.serializePlugins(e,i)},Wr(this,!0,e))}fromJSON(e,i){return os(e,this,!0,i),Array.isArray(e.plugins)&&this.deserializePlugins(e.plugins,i),this.setBackground(this._rawBackground),this}_setActiveCameraView(e={}){if(e.type==="setView"){if(!e.camera)return void console.warn("Cannot find camera",e);this.scene.activeCamera.copyFromCamera(e.camera)}else e.type==="activateMain"&&(this.scene.activeCamera=e.camera?this.createCamera(e.camera):void 0)}}Ym.VERSION="0.5.5",D1([jn()],Ym.prototype,"scene",void 0),D1([jn("background")],Ym.prototype,"_rawBackground",void 0),D1([jn(),hn(Ym.prototype._backgroundIntensityChanged)],Ym.prototype,"backgroundIntensity",void 0);const xv="envMapBackground";function jA(c){var e,i,s;return!((e=c)===null||e===void 0)&&e.isShaderPass2?c:new bu({...nt,fragmentShader:`
                       varying vec2 vUv;
                       
                       ${Array.isArray(c)?c[0]:((i=c)===null||i===void 0?void 0:i.pars)||""}
                       
                       void main() {

                            gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                            
                            ${Array.isArray(c)?c[1]:typeof c=="string"?c:((s=c)===null||s===void 0?void 0:s.main)||""}
                            
                        }`,uniforms:{tDiffuse:{value:null}}},"tDiffuse")}var tp=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};let su=class extends Js{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this._lastSize=["100%","100%"],this._lastFsElement=null,this._fsChangeHandler=c=>{var e;if(this.isFullScreen())this.dispatchEvent({type:"enter"});else{const i=this._lastFsElement||((e=this._viewer)===null||e===void 0?void 0:e.canvas);i&&(i.style.width=this._lastSize[0],i.style.height=this._lastSize[1]),document.removeEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("fullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("MSFullscreenChange",this._fsChangeHandler,!1),this.dispatchEvent({type:"exit"})}},this.enter=this.enter.bind(this),this.exit=this.exit.bind(this)}async enter(c){var e;if(this.isFullScreen())return;const i=c||((e=this._viewer)===null||e===void 0?void 0:e.canvas);return i?(this._lastFsElement=i,document.addEventListener&&(document.addEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("fullscreenchange",this._fsChangeHandler,!1),document.addEventListener("MSFullscreenChange",this._fsChangeHandler,!1)),this._lastSize=[i.style.width,i.style.height],i.style.width="100%",i.style.height="100%",i.requestFullscreen?i.requestFullscreen():i.mozRequestFullScreen?i.mozRequestFullScreen():i.webkitRequestFullscreen?i.webkitRequestFullscreen():i.msRequestFullscreen?i.msRequestFullscreen():void 0):void 0}async exit(){return document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():void 0}async toggle(c){return this.isFullScreen()?this.exit():this.enter(c)}isFullScreen(){return document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement!==void 0}};su.PluginType="FullScreenPlugin",tp([Ao("Enter FullScreen")],su.prototype,"enter",null),tp([Ao("Exit FullScreen")],su.prototype,"exit",null),tp([Ao("Toggle FullScreen")],su.prototype,"toggle",null),su=tp([Ws("Full Screen")],su);class Vw{constructor(e,i,s){this._el=e,this._inputEl=i,this._listeners={drop:[],dropstart:[],droperror:[]},this._onDragover=this._onDragover.bind(this),this._onDrop=this._onDrop.bind(this),this._onSelect=this._onSelect.bind(this),e==null||e.addEventListener("dragover",this._onDragover,!1),e==null||e.addEventListener("drop",this._onDrop,!1),i==null||i.addEventListener("change",this._onSelect),s&&Object.entries(s).forEach(([a,h])=>h&&this.on(a,h))}get inputEl(){return this._inputEl}get el(){return this._el}on(e,i){return this._listeners[e].push(i),this}_emit(e,i){return this._listeners[e].forEach(s=>s(i)),this}destroy(){const e=this._el,i=this._inputEl;e==null||e.removeEventListener("dragover",this._onDragover),e==null||e.removeEventListener("drop",this._onDrop),i==null||i.removeEventListener("change",this._onSelect)}_onDrop(e){var i,s;e.stopPropagation(),e.preventDefault(),this._emit("dropstart");const a=Array.from(((i=e.dataTransfer)===null||i===void 0?void 0:i.files)||[]),h=Array.from(((s=e.dataTransfer)===null||s===void 0?void 0:s.items)||[]);if(a.length!==0||h.length!==0)if(h.length>0){const f=h.map(k=>k.webkitGetAsEntry());this._loadNextEntry(new Map,f)}else this._emit("drop",{files:new Map(a.map(f=>(f.filePath=f.name,[f.filePath,f])))});else this._fail("Required drag-and-drop APIs are not supported in this browser.")}_onDragover(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")}_onSelect(e){var i;if(!this._inputEl)return void console.warn("Invalid Dropzone event ",e);this._emit("dropstart");const s=[].slice.call((i=this._inputEl.files)!==null&&i!==void 0?i:new FileList),a=new Map;s.forEach(h=>{h.filePath=h.webkitRelativePath||h.name,a.set(h.filePath,h)}),this._emit("drop",{files:a})}_loadNextEntry(e,i){const s=i.pop();if(s)if(s.isFile)s.file(a=>{a.filePath=s.fullPath,e.set(s.fullPath,a),this._loadNextEntry(e,i)},()=>console.error("Could not load file: %s",s.fullPath));else if(s.isDirectory){const a=s.createReader(),h=f=>{f.length?(i=i.concat(f),a.readEntries(h)):this._loadNextEntry(e,i)};a.readEntries(h)}else console.warn("Unknown asset type: "+s.fullPath),this._loadNextEntry(e,i);else this._emit("drop",{files:e})}_fail(e){this._emit("droperror",{message:e})}}class Qw extends j{constructor(e){super(),this._domElement=e,this._allowedExtensions=void 0,this.importerParams={autoScale:!0,autoScaleRadius:2,pseudoCenter:!0,autoCenter:!1,autoImport:!0,autoAdd:!0,centerOffset:new d.Pa4(.5,.5,3)},this.dependencies=[Kr],this.uiConfig={type:"folder",label:"Drop Options",children:[{label:"Auto Center",type:"checkbox",property:[this.importerParams,"pseudoCenter"],limitedUi:!0},{label:"Auto Scale",type:"checkbox",property:[this.importerParams,"autoScale"],limitedUi:!0},{label:"Auto scale radius",type:"slider",bounds:[.5,100],property:[this.importerParams,"autoScaleRadius"]}]}}async onAdded(e){this._inputEl=document.createElement("input"),this._viewer=e,this._inputEl.type="file",this._dropzone=new Vw(this._domElement||e.canvas,this._inputEl,{drop:this._onFileDrop.bind(this)})}async _onFileDrop({files:e}){var i,s,a,h,f,k;if(!e)return;const et=this._viewer;if(!et)return;if(this._allowedExtensions!==void 0)for(const lt of e.keys())this._allowedExtensions.includes((s=(i=lt.split(".").pop())===null||i===void 0?void 0:i.toLowerCase())!==null&&s!==void 0?s:"")||e.delete(lt);if(e.size<1)return;const tt=et.getPlugin(Kr),rt={type:"drop",files:e};if(this.importerParams.autoImport){const lt={allowedExtensions:this.allowedExtensions,...this.importerParams};if(rt.imported=await((a=tt.importer)===null||a===void 0?void 0:a.importFiles(e,lt)),this.importerParams.autoAdd){const pt=(k=[...(f=(h=rt.imported)===null||h===void 0?void 0:h.values())!==null&&f!==void 0?f:[]].flat(2).filter(ft=>!!ft))!==null&&k!==void 0?k:[];if(rt.assets=tt.addProcessedAssets(pt,{...this.importerParams}),!lt._rootSceneImported)for(const ft of rt.assets)ft.modelObject&&ft.modelObject.dispatchEvent({type:"select",value:ft.modelObject})}}this.dispatchEvent(rt)}promptForFile(){var e;(e=this._inputEl)===null||e===void 0||e.click()}async onDispose(e){}async onRemove(e){var i;(i=this._dropzone)===null||i===void 0||i.destroy(),this._dropzone=void 0,this._viewer=void 0}get allowedExtensions(){return this._allowedExtensions}set allowedExtensions(e){this._allowedExtensions=e,this._inputEl&&(this._inputEl.accept=e?e.map(i=>"."+i).join(", "):"")}}Qw.PluginType="Dropzone";class zS extends bu{constructor(e){super({vertexShader:nt.vertexShader,fragmentShader:Ut`
                uniform vec4 weight;
                uniform vec4 weight2;
                varying vec2 vUv;
                void main() {
                    vec4 texel = clamp(weight * tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ) + weight2 * tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:e},weight:{value:new d.Ltg(1,1,1,1)},weight2:{value:new d.Ltg(1,1,1,1)}}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}set weights2(e){this.uniforms.weight2.value.copy(e)}get weights2(){return this.uniforms.weight2.value}set weights1(e){this.uniforms.weight.value.copy(e)}get weights1(){return this.uniforms.weight.value}set blendTexture(e){this.uniforms.tDiffuse2.value=e}}class Gw extends Js{constructor(){super(),this._pipeline=[]}get passes(){if(!this._passes)throw"Plugin not yet added to the viewer";return this._passes}get pipeline(){return this._pipeline}set pipeline(e){this._pipeline=e}async onAdded(e){await super.onAdded(e);const i=this.createPasses(e);this._passes=Object.fromEntries(i.map(s=>(s.passId||(console.warn("no id found for pass",s),s.passId=Ho()),e.renderer.registerPass(s,!0),[s.passId,s])))}async onRemove(e){var i;if(this._passes){for(const s of[...Object.values(this._passes)]){const a=s;e.renderer.unregisterPass(a),(i=a==null?void 0:a.dispose)===null||i===void 0||i.call(a)}this._passes=void 0}await super.onRemove(e)}toJSON(e){var i,s;const a=super.toJSON(e);if(!a.type)return a;const h=Object.entries(this.passes);a.passes={};for(const[f,k]of h)a.passes[f]=Wr((s=(i=k)===null||i===void 0?void 0:i.passObject)!==null&&s!==void 0?s:k,!1,e);return a}fromJSON(e,i){var s,a;if(!super.fromJSON(e,i))return null;if(e.passes){const h=Object.entries(this.passes);for(const[f,k]of h)os(e.passes[f],(a=(s=k)===null||s===void 0?void 0:s.passObject)!==null&&a!==void 0?a:k,!1,i)}return this}}var QM=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};const VS=[{x:0,y:0},{x:-.5,y:0},{x:-.375,y:-.25},{x:-.1875,y:-.125},{x:-.125,y:-.375},{x:.0625,y:-.0625},{x:.125,y:-.3125},{x:.375,y:-.4375},{x:.3125,y:-.1875},{x:.25,y:.0625},{x:.4375,y:.25},{x:.1875,y:.3125},{x:0,y:.4375},{x:-.0625,y:.1875},{x:-.25,y:.375},{x:-.4375,y:.5},{x:-.3125,y:.125}];class dp extends Gw{constructor(e=2*VS.length){super(),this.enabled=!0,this.jitter=!0,this._hasSetOffset=!1,this.trackedJitterCameras=new Set,this._addSceneObject=i=>{const s=i.object;(s.modelObject||s.lightObject)&&(s.modelObject||s.lightObject).traverse(a=>{var h;!((h=a==null?void 0:a.shadow)===null||h===void 0)&&h.camera&&a.shadow.mapSize&&this.trackedJitterCameras.add([a.shadow.camera,a.shadow.mapSize])})},this._jitterCamera=i=>{var s;const a=i.target;if(this.jitter&&a.renderer.frameCount>2){const h=(k,et)=>{const tt={...VS[a.renderer.frameCount%VS.length]};k.setViewOffset(et.width,et.height,tt.x,tt.y,et.width,et.height)},f=a.scene.activeCamera.cameraObject;h(f,{width:a.canvas.clientWidth*a.renderer.displayCanvasScaling,height:a.canvas.clientHeight*a.renderer.displayCanvasScaling}),this.trackedJitterCameras.forEach(k=>h(...k)),this._hasSetOffset=!0,(s=this._viewer)===null||s===void 0||s.renderer.resetShadows()}},this._resetCameraJitter=i=>{const s=i.target;this._hasSetOffset&&(s.scene.activeCamera.cameraObject.clearViewOffset(),this._hasSetOffset=!1)},this.uiConfig=Yp("Progressive",this),this.maxFrameCount=e}async onAdded(e){return this._lastFrame=e.renderer.composerTarget.clone(!0),await super.onAdded(e)}async onRemove(e){e.removeEventListener("preRender",this._jitterCamera),e.removeEventListener("postRender",this._resetCameraJitter),e.scene.removeEventListener("addSceneObject",this._addSceneObject),this._lastFrame&&e.renderer.disposeTarget(this._lastFrame),this._lastFrame=void 0,await super.onRemove(e)}get lastFrame(){return this._lastFrame}createPasses(e){e.addEventListener("preRender",this._jitterCamera),e.addEventListener("postRender",this._resetCameraJitter),e.scene.addEventListener("addSceneObject",this._addSceneObject);const i=this;return[UA(e,{passId:"progressive",get dirty(){var a;return i.jitter&&(((a=i._viewer)===null||a===void 0?void 0:a.renderer.frameCount)||0)<i.maxFrameCount},after:["render"],before:["combinedPost","screen"],required:["render"],passObject:new class extends zS{render(a,h,f,k,et){if(e.renderer.frameCount<1)return this.needsSwap=!1,void((f==null?void 0:f.texture)&&e.renderer.blit(f.texture,i.lastFrame,{}));this.needsSwap=!0,super.render(a,h,f,k,et),e.renderer.blit(h.texture,i.lastFrame,{})}},update(){if(!i.lastFrame)return void console.error("lastFrame render target undefined");let a=1/(Math.max(e.renderer.frameCount,0)+1);this.passObject.weights1.set(a,a,a,a),a=1-a,this.passObject.weights2.set(a,a,a,a),this.passObject.blendTexture=i.lastFrame.texture,this.passObject.material.uniformsNeedUpdate=!0}})]}isConverged(e=!1){var i;return(((i=this._viewer)===null||i===void 0?void 0:i.renderer.frameCount)||0)>=this.maxFrameCount-1+(e?1:0)}updateShaderProperties(e){var i,s;return e.uniforms.tLastFrame&&(e.uniforms.tLastFrame.value=(s=(i=this.lastFrame)===null||i===void 0?void 0:i.texture)!==null&&s!==void 0?s:void 0),this}postFrameConvergedRecordingDelta(e="CanvasRecorder"){const i=this._viewer.getPluginByType(e);return i&&i.isRecording()&&i.convergeMode?this.isConverged(!0)?1/i.videoFrameRate:0:-1}}dp.PluginType="Progressive",QM([jn(),so("Frame count")],dp.prototype,"maxFrameCount",void 0),QM([jn(),Jr("Jitter")],dp.prototype,"jitter",void 0);var bv="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}",Hw=`#ifndef BASIC_CAMERA_HELPERS
#define BASIC_CAMERA_HELPERS 
uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;uniform mat4 projection;
#ifndef THREE_PACKING_INCLUDED
#define THREE_PACKING_INCLUDED 
#include <packing>
#endif
float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}float depthToViewZ(const in float depth){return(depth>0.999)?-cameraNearFar.y*1000.:-mix(cameraNearFar.x,cameraNearFar.y,depth);}float viewZToDepth(const in float viewZ){return linstep(-cameraNearFar.x,-cameraNearFar.y,viewZ);}vec4 viewToScreen3(const in vec3 pos){vec4 projected=projection*vec4(pos,1.);projected.z=pos.z;projected.w=1./projected.w;projected.xyz*=projected.w;projected.xy=0.5+0.5*projected.xy;return projected;}vec3 screenToView(const in vec2 uv,const in float viewZ){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewZ/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewZ/projection[1][1];return vec3(xe,ye,viewZ);}
#endif
`,R1=`#ifndef BASIC_HELPERS
#define BASIC_HELPERS 
float saturate2(float v,float mx){return max(0.,min(mx,v));}vec3 saturate2(vec3 v){return max(vec3(0.),min(vec3(1.),v));}
#endif
`,Ev=`#ifndef BASIC_RANDOM_HELPERS
#define BASIC_RANDOM_HELPERS 
uniform float frameCount;float random(float n){return fract(sin(n)*43758.5453123);}float random2(vec2 n,float x){n+=x;return fract(sin(dot(n.xy,vec2(12.9898,78.233)))*43758.5453);}float random3(vec3 v){v=fract(v*443.8975);v+=dot(v,v.yzx+19.19);return fract((v.x+v.y)*v.z);}float interleavedGradientNoise(const in vec2 fragCoord,const in float seed){vec3 magic=vec3(0.06711056,0.00583715,52.9829189);return fract(magic.z*fract(dot(fragCoord.xy+seed*vec2(2.083,4.867),magic.xy)));}vec3 hash3(vec2 p){vec3 q=vec3(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3)),dot(p,vec2(419.2,371.9)));return fract(sin(q)*43758.5453);}
#endif
`,QS=`#define PI  3.141592653589793
mat3 GetTangentBasis(vec3 TangentZ){vec3 up=vec3(0.,0.,1.);vec3 TangentX=normalize(cross(dot(TangentZ,up)<0.8?up:vec3(1.,0.,0.),TangentZ));vec3 TangentY=cross(TangentZ,TangentX);return mat3(TangentX,TangentY,TangentZ);}vec4 CosineSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=sqrt(E.y);float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=CosTheta*(1./PI);return vec4(H,PDF);}vec4 UniformSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=E.y;float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=1./(2.*PI);return vec4(H,PDF);}vec2 UniformSampleDiskConcentric(vec2 E){vec2 p=2.*E-1.;float Radius;float Phi;if(abs(p.x)>abs(p.y)){Radius=p.x;Phi=(PI/4.)*(p.y/p.x);}else{Radius=p.y;Phi=(PI/2.)-(PI/4.)*(p.x/p.y);}return vec2(Radius*cos(Phi),Radius*sin(Phi));}vec2 UniformSampleDiskConcentricApprox(vec2 E){vec2 sf=E*sqrt(2.)-sqrt(0.5);vec2 sq=sf*sf;float root=sqrt(2.*max(sq.x,sq.y)-min(sq.x,sq.y));if(sq.x>sq.y){sf.x=sf.x>0.?root:-root;}else{sf.y=sf.y>0.?root:-root;}return sf;}`,k1=`#ifndef SSRT_PARS_SNIP
#define SSRT_PARS_SNIP 
#define pow2(a)a*a
float getDepth2(const in vec2 uv,const in float lod){float viewDepth=getDepth(uv);return depthToViewZ(viewDepth);}
#define LOD_DEPTH  1.0
#define LOD_COLOR  5.0
void _traceRay(in vec4 ray_origin,in vec4 ray_dir,in float tolerance,inout vec3 state,in int loopMax,in float iStepCount){vec4 sample_uv;float d,hit;float dLod=0.;
#pragma unroll_loop_start
for(int i=0;i<8;i++){if(UNROLLED_LOOP_INDEX<loopMax){sample_uv=ray_origin+ray_dir*state.y;d=getDepth2(sample_uv.xy,dLod);d=sample_uv.z/sample_uv.w-d;if(abs(d+tolerance)<tolerance){hit=clamp(state.x/(state.x-d),0.,1.)-1.;hit=(state.y+hit*iStepCount);state.z=min(state.z,hit);}state.x=d;state.y+=1.*iStepCount;}}
#pragma unroll_loop_end
}vec3 traceRay(in vec3 ray_origin_view,in vec3 ray_dir_view,in float tolerance,inout vec3 state,in int _STEP_COUNT){vec4 sample_uv;vec4 ray_origin=viewToScreen3(ray_origin_view);vec3 ray_end_view=ray_origin_view+ray_dir_view;vec4 ray_dir=viewToScreen3(ray_end_view);vec2 clamp_end=clamp(ray_dir.xy,vec2(0.),vec2(1.));vec2 correction=abs(ray_dir.xy-clamp_end);correction=(step(0.01,correction)*correction/(abs(clamp_end-ray_origin.xy)+0.01))+1.;correction.x=1./min(max(correction.y,correction.x),10.);ray_dir=ray_dir-ray_origin;ray_dir.xyw*=correction.x;float iStepCount=1./float(_STEP_COUNT);tolerance*=0.125;_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT,iStepCount);if(_STEP_COUNT>8&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-8,iStepCount);if(_STEP_COUNT>15&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);if(_STEP_COUNT>23&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);sample_uv=ray_origin+ray_dir*state.z;sample_uv.z/=sample_uv.w;state.z=state.z<0.999?state.z:9999999.;return sample_uv.xyz;}
#endif
`,GM=`uniform float objectRadius;uniform float radius;uniform float tolerance;uniform bool autoRadius;
#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
vec3 ComputeReflectionL(vec3 N,vec2 E,vec3 V,float rough){float rough4=rough*rough*rough*rough;float phi=2.*PI*E.x;float cos_theta=pow(max(E.y,0.000001),rough4/(2.-rough4));float sin_theta=sqrt(max(0.,1.-cos_theta*cos_theta));vec3 half_vec=vec3(sin_theta*cos(phi),sin_theta*sin(phi),cos_theta);vec3 tangentX=normalize(cross(abs(N.z)<0.999?vec3(0.,0.,1.):vec3(1.,0.,0.),N));vec3 tangentY=cross(N,tangentX);half_vec=half_vec.x*tangentX+half_vec.y*tangentY+half_vec.z*N;vec3 ray_dir=(2.*dot(V,half_vec))*half_vec-V;return ray_dir;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=interleavedGradientNoise(gl_FragCoord.xy,frameCount*117.);rand_e.y=fract(rand_e.x*38.65435);rand_e.y=mix(rand_e.y,1.,0.7);return rand_e;}vec4 calculateSSR(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor,in float roughness){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeReflectionL(normal,E,-normalize(viewPos),roughness);L=normalize(L);float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?mix((cameraDist+objectRadius*sceneBoundingRadius)+viewPos.z,-viewPos.z-max(0.,cameraDist-objectRadius*sceneBoundingRadius),L.z*0.5+0.5):objectRadius*sceneBoundingRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount+seed);rayLen=max(rayLen,0.001);int steps=SSR_STEP_COUNT/(frameCount<float(SSR_LOW_QUALITY_FRAMES)?2:1);vec3 state=vec3(0.,(r+0.5)/float(steps),2.);viewPos+=normal*max(-0.0001*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,steps);if(state.z<0.99){vec3 hitColor=(tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy))).rgb;float ssrWeight=1.;return vec4(hitColor*ssrWeight,1.);}return vec4(0.);}`,B1=`#ifndef SIMPLE_CAMERA_HELPERS
#define SIMPLE_CAMERA_HELPERS 
#ifndef USE_TRANSMISSION
uniform mat4 projectionMatrix;
#endif
vec3 viewToScreen(const in vec3 pos){vec4 projected=projectionMatrix*vec4(pos,1.);return vec3(0.5+0.5*projected.xy/projected.w,projected.w);}
#endif
`,Sv=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};let Mm=class extends bu{constructor(c,e,i,s=!0){super({vertexShader:bv,fragmentShader:`

varying vec2 vUv;

${R1}
${Hw}
${Ev}
${QS}
${i}

${k1}

${GM}

uniform sampler2D tLastThis;void main(){vec4 texel=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 lastAO=tLastThisTexelToLinear(texture2D(tLastThis,vUv));float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>=0.999){discard;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec3 viewPos=screenToView(screenPos.xy,screenPos.z);viewPos.z=viewZ/viewPos.z;vec4 ao=vec4(0.);ao+=calculateSSR(8.,screenPos,normal,1.,0.1);ao.rgb=min(vec3(3.),ao.rgb);ao.rgb=max(vec3(0.),ao.rgb);if(frameCount<1.){gl_FragColor=ao;return;}if(ao.a<0.01){gl_FragColor.rgb=lastAO.rgb;gl_FragColor.a=(((lastAO.a)*frameCount)/(frameCount+1.));}else{gl_FragColor=((ao+(lastAO)*frameCount)/(frameCount+1.));}
#include <encodings_fragment>
}


            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:0},boost:{value:new d.Pa4(0,0,0)},objectRadius:{value:0},autoRadius:{value:!1},power:{value:0},maskFrontFactor:{value:-.1},tolerance:{value:0},frameCount:{value:0},projection:{value:new d.yGw},cameraPositionWorld:{value:new d.Pa4},cameraNearFar:{value:new d.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},defines:{PERSPECTIVE_CAMERA:1,SSR_STEP_COUNT:16,SSR_LOW_QUALITY_FRAMES:2,SSR_MASK_FRONT_RAYS:!0,SSR_INLINE:s?"1":"0",SSR_NON_PHYSICAL:"0"}},"tDiffuse","tLastThis","tLastFrame"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(a,h,f)=>{if(!a.defines.SSR_ENABLED)return;const k="#glMarker beforeModulation";a.fragmentShader=a.fragmentShader.replace(k,`

            
            #if defined(SSR_ENABLED) && SSR_ENABLED > 0
vec3 screenPos=viewToScreen(geometry.position);vec4 ssrColor=vec4(0,0,0,0);float alphaModifier=1.-clamp(material.roughness*.3,0.,1.);alphaModifier*=ssrIntensity;
#if defined(SSR_MASK_FRONT_RAYS) && SSR_MASK_FRONT_RAYS > 0
alphaModifier*=clamp(-4.*dot(geometry.viewDir,normal)+(4.+ssrMaskFrontFactor),0.,1.);
#endif
#ifdef USE_TRANSMISSION
alphaModifier*=1.-transmission;
#endif
float vignette=1.;if(true){float fadeStrength=0.1;float dist=min(min(1.-screenPos.x,1.-screenPos.y),min(screenPos.x,screenPos.y));float fade=dist*dist/(fadeStrength+0.001);fade=clamp(fade,0.,1.);fade=pow(fade,0.3);vignette=fade;}alphaModifier*=vignette;vec3 specularColor=EnvironmentBRDF(geometry.normal,geometry.viewDir,material.specularColor.rgb,material.specularF90,material.roughness);if(length(specularColor.rgb)*alphaModifier>0.01&&roughnessFactor<0.9){
#if defined(SSR_INLINE) && SSR_INLINE > 0
ssrColor=calculateSSR(8.,vec3(screenPos.xy,geometry.position.z),geometry.normal,1.,material.roughness);
#else
ssrColor=tSSRMapTexelToLinear(texture2D(tSSRMap,screenPos.xy));
#endif 
}ssrColor.rgb*=ssrBoost;ssrColor.a*=alphaModifier;ssrColor.a=min(ssrColor.a,1.);
#if defined(SSR_NON_PHYSICAL) && SSR_NON_PHYSICAL > 0
diffuseColor.a=max(ssrColor.a,diffuseColor.a*diffuseColor.a);reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(diffuseColor.rgb*ssrColor.rgb),1.);reflectedLight.indirectDiffuse=diffuseColor.rgb*(1.-ssrColor.a);reflectedLight.directDiffuse=vec3(0.);reflectedLight.directSpecular=vec3(0.);
#else
reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(specularColor.rgb*ssrColor.rgb),ssrColor.a);
#endif
#endif

            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            
${k}`)},onObjectRender:(a,h,f)=>{var k,et,tt,rt;let lt=this.enabled&&f.userData.screenSpaceRendering!==!1&&!(!((k=h.materialObject.userData)===null||k===void 0)&&k.ssreflDisabled)?1:0;h.materialObject.defines.SSR_ENABLED!==lt&&(h.materialObject.defines.SSR_ENABLED=lt,h.materialObject.needsUpdate=!0),lt=this.material.defines.SSR_STEP_COUNT,h.materialObject.defines.SSR_STEP_COUNT!==lt&&(h.materialObject.defines.SSR_STEP_COUNT=lt,h.materialObject.needsUpdate=!0),lt=this.material.defines.SSR_LOW_QUALITY_FRAMES,h.materialObject.defines.SSR_LOW_QUALITY_FRAMES!==lt&&(h.materialObject.defines.SSR_LOW_QUALITY_FRAMES=lt,h.materialObject.needsUpdate=!0),lt=this.material.defines.PERSPECTIVE_CAMERA,h.materialObject.defines.PERSPECTIVE_CAMERA!==lt&&(h.materialObject.defines.PERSPECTIVE_CAMERA=lt,h.materialObject.needsUpdate=!0),lt=this.material.defines.SSR_INLINE,h.materialObject.defines.SSR_INLINE!==lt&&(h.materialObject.defines.SSR_INLINE=lt,h.materialObject.needsUpdate=!0),lt=this.material.defines.SSR_MASK_FRONT_RAYS?1:0,h.materialObject.defines.SSR_MASK_FRONT_RAYS!==lt&&(h.materialObject.defines.SSR_MASK_FRONT_RAYS=lt,h.materialObject.needsUpdate=!0),lt=!((et=h.materialObject.userData)===null||et===void 0)&&et.ssreflNonPhysical?"1":"0",h.materialObject.defines.SSR_NON_PHYSICAL!==lt&&(h.materialObject.defines.SSR_NON_PHYSICAL=lt,h.materialObject.needsUpdate=!0),lt=(rt=(tt=this._target)===null||tt===void 0?void 0:tt.texture)!==null&&rt!==void 0?rt:null,this.materialExtension.extraUniforms.tSSRMap.value!==lt&&(this.materialExtension.extraUniforms.tSSRMap.value=lt,h.materialObject.needsUpdate=!0)},parsFragmentSnippet:a=>{var h;return`
uniform float ssrPower;
uniform float ssrIntensity;
uniform float ssrMaskFrontFactor;
uniform vec3 ssrBoost;
uniform sampler2D tSSRMap;
uniform sampler2D tLastFrame;
`+Kn("tSSRMap",(h=this._target)===null||h===void 0?void 0:h.texture,a.capabilities.isWebGL2)+Kn("tLastFrame",this.materialExtension.extraUniforms.tLastFrame.value,a.capabilities.isWebGL2)+(this._inline?`
#if 1
// #if SSR_INLINE
    ${R1}
    
    #define THREE_PACKING_INCLUDED
    ${Hw}
    
    ${Ev}
    ${QS}
    ${Hv}
    
    ${k1}
    
    ${GM}
// #endif // SSR_INLINE
#endif
`:"")+`

${B1}

        `},extraUniforms:{tSSRMap:{value:null},ssrPower:this.material.uniforms.power,ssrIntensity:this.material.uniforms.intensity,ssrMaskFrontFactor:this.material.uniforms.maskFrontFactor,ssrBoost:this.material.uniforms.boost,tNormalDepth:this.material.uniforms.tNormalDepth,tLastFrame:this.material.uniforms.tLastFrame,objectRadius:this.material.uniforms.objectRadius,autoRadius:this.material.uniforms.autoRadius,tolerance:this.material.uniforms.tolerance,frameCount:this.material.uniforms.frameCount,projection:this.material.uniforms.projection,cameraPositionWorld:this.material.uniforms.cameraPositionWorld,cameraNearFar:this.material.uniforms.cameraNearFar,sceneBoundingRadius:this.material.uniforms.sceneBoundingRadius},computeCacheKey:a=>{var h,f;return this.enabled?"1":"0"+((f=(h=this._target)===null||h===void 0?void 0:h.texture)===null||f===void 0?void 0:f.encoding)},isCompatible:a=>{var h;return!(!((h=a.materialObject.userData)===null||h===void 0)&&h.ssreflDisabled)&&a.isMeshStandardMaterial2}},this.intensity=1,this.boost=new d.Pa4(1,1,1),this.objectRadius=1,this.autoRadius=!0,this.power=1.1,this.tolerance=.5,this.stepCount=16,this.lowQualityFrames=0,this.maskFrontRays=!0,this.maskFrontFactor=-.2,this._renderer=c,this._target=e,this.needsSwap=!1,this._inline=s}render(c,e,i,s,a){if(this._inline)this.needsSwap=!1;else{if(!this._target)throw"Target must be set when inline = false";this._renderer.blit(this._target.texture,e,{}),this.uniforms.tLastThis.value=e.texture,super.render(c,this._target,i,s,a),this.needsSwap=!1}}};Sv([Xr("Intensity",[0,4]),jn(),dn()],Mm.prototype,"intensity",void 0),Sv([Qo("Boost"),jn(),dn()],Mm.prototype,"boost",void 0),Sv([Xr("Object Radius",[.01,2]),jn(),dn()],Mm.prototype,"objectRadius",void 0),Sv([Jr("Auto radius"),jn(),dn()],Mm.prototype,"autoRadius",void 0),Sv([Xr("Power",[0,3]),jn(),dn()],Mm.prototype,"power",void 0),Sv([Xr("Tolerance",[.1,5]),jn(),dn()],Mm.prototype,"tolerance",void 0),Sv([Xr("Step count",[1,32],1),jn(),kn("SSR_STEP_COUNT")],Mm.prototype,"stepCount",void 0),Sv([Xr("Low Quality Frames",[0,4],1),jn(),kn("SSR_LOW_QUALITY_FRAMES")],Mm.prototype,"lowQualityFrames",void 0),Sv([Jr("Ignore front rays"),jn(),kn("SSR_MASK_FRONT_RAYS")],Mm.prototype,"maskFrontRays",void 0),Sv([Xr("Mask front rays factor",[-1,1],.01,c=>({hidden:()=>!c.maskFrontRays})),jn(),dn()],Mm.prototype,"maskFrontFactor",void 0),Mm=Sv([Ws("Screen Space Reflections")],Mm);class O1 extends Gw{constructor(){super(),this.dependencies=[Kr,ba,dp],this.inlineSSR=!0,this.setDirty=this.setDirty.bind(this)}get ssrTarget(){return this._ssrTarget}get enabled(){var e,i;return((i=(e=this.passes.ssr)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.enabled)||!1}set enabled(e){var i;!((i=this.passes.ssr)===null||i===void 0)&&i.passObject&&(this.passes.ssr.passObject.enabled=e)}async onAdded(e){var i,s;e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSRPlugin"),await super.onAdded(e),(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)}createPasses(e){var i,s;return this._ssrTarget=this.inlineSSR?void 0:e.renderer.createTarget({sizeMultiplier:1}),[UA(e,{passId:"ssr",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new Mm(e.renderer,this._ssrTarget,(s=(i=e.getPlugin(ba))===null||i===void 0?void 0:i.getUnpackSnippet())!==null&&s!==void 0?s:"",this.inlineSSR)},()=>[e.getPlugin(ba),e.getPlugin(dp),e.scene.activeCamera,e.renderer,e.scene])]}async onRemove(e){return this._ssrTarget&&e.renderer.disposeTarget(this._ssrTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get uiConfig(){var e,i,s,a,h;const f=(s=(i=(e=this.passes.ssr)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.uiConfig)!==null&&s!==void 0?s:{};return(h=(a=f.children)===null||a===void 0?void 0:a.map(k=>Ht(k)))===null||h===void 0||h.flat(2).forEach(k=>k&&(k.onChange=this.setDirty)),f}}O1.PluginType="SSReflection";var HM=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};class L1 extends bu{constructor(e,i,s="rgba"){super({vertexShader:nt.vertexShader,fragmentShader:i+`uniform vec2 tDiffuseSize;uniform vec2 bilDirection;varying vec2 vUv;uniform bool smoothEnabled;uniform float edgeSharpness;vec4 bilaterialAO(){vec4 color=clamp((texture2D(tDiffuse,vUv.xy)).B_SRC_ACCESSOR,0.,5.);if(!smoothEnabled)return color;float depth;vec3 normal;getDepthNormal(vUv.xy,depth,normal);float gaussianWeights[4];gaussianWeights[0]=0.153170;gaussianWeights[1]=0.144893;gaussianWeights[2]=0.122649;gaussianWeights[3]=0.092902;float Z=gaussianWeights[0]+0.03;vec4 final_colour=Z*color;vec2 nuv;vec4 cc;float dp;vec3 nor;vec2 direction=bilDirection/tDiffuseSize.xy;
#pragma unroll_loop_start
for(int i=0;i<6;i++){direction*=-1.;nuv=vUv+2.*direction*float(UNROLLED_LOOP_INDEX/2+1);getDepthNormal(nuv,dp,nor);if(dp<0.999){float normalCloseness=dot(normal,nor);normalCloseness*=normalCloseness;float normalError=(1.-normalCloseness)*8.;float normalWeight=max((1.-normalError*edgeSharpness),0.00);float depthWeight=max(0.,1.-edgeSharpness*4000.*abs(depth-dp));float kernelWeight=gaussianWeights[UNROLLED_LOOP_INDEX/2]+0.03;float bilateralWeight=kernelWeight*depthWeight*normalWeight;Z+=bilateralWeight;cc=clamp((texture2D(tDiffuse,nuv)).B_SRC_ACCESSOR,0.,5.);final_colour+=bilateralWeight*cc;}}
#pragma unroll_loop_end
final_colour/=Z;return final_colour;}void main(){vec4 ao=clamp(bilaterialAO(),vec4(0.),vec4(1.));gl_FragColor=ao;}`,uniforms:{bilDirection:{value:new d.FM8(1,0)},tNormalDepth:{value:null},tDiffuse:{value:e.texture},tDiffuseSize:{value:new d.FM8}},defines:{B_SRC_ACCESSOR:s}},"tDiffuse"),this.smoothEnabled=!0,this.edgeSharpness=.1,this._target=e,this.clear=!1,this.needsSwap=!1}render(e,i,s,a,h){var f,k,et,tt;this.enabled&&(this.uniforms.bilDirection.value.set(1,0),this.uniforms.tDiffuse.value=this._target.texture,this.uniforms.tDiffuseSize.value.set(((f=this.uniforms.tDiffuse.value)===null||f===void 0?void 0:f.image.width)||0,((k=this.uniforms.tDiffuse.value)===null||k===void 0?void 0:k.image.height)||0),super.render(e,i,this._target,a,h),this.uniforms.bilDirection.value.set(0,1),this.uniforms.tDiffuse.value=i.texture,this.uniforms.tDiffuseSize.value.set(((et=this.uniforms.tDiffuse.value)===null||et===void 0?void 0:et.image.width)||0,((tt=this.uniforms.tDiffuse.value)===null||tt===void 0?void 0:tt.image.height)||0),super.render(e,this._target,i,a,h))}}HM([jn(),dn()],L1.prototype,"smoothEnabled",void 0),HM([jn(),dn()],L1.prototype,"edgeSharpness",void 0);var WM=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};class GS extends bu{constructor(e,i,s){super({defines:{LINEAR_DEPTH:1,NUM_SAMPLES:11,NUM_SPIRAL_TURNS:3,DEPTH_NORMAL_TEXTURE:1,DEPTH_PACKING_MODE:2,PERSPECTIVE_CAMERA:1},uniforms:{tLastThis:{value:null},tNormalDepth:{value:null},screenSize:{value:new d.FM8(512,512)},saoData:{value:new d.Ltg},frameCount:{value:0},cameraNearFar:{value:new d.FM8(.1,1e3)},projection:{value:new d.yGw},saoBiasEpsilon:{value:new d.Pa4(1,1,1)}},vertexShader:bv,fragmentShader:`

${Ev}

${s}

#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cameraNearFar;uniform mat4 projection;uniform sampler2D tLastThis;uniform vec4 saoData;uniform vec3 saoBiasEpsilon;uniform vec2 screenSize;const float INV_NUM_SAMPLES=1./float(NUM_SAMPLES);float getViewZFromNDCZ(const in float depth){
#if PERSPECTIVE_CAMERA == 1
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}vec3 packFloatToRGB(const in float x){const vec3 code=vec3(1.,255.,65025.);vec3 pack=vec3(code*x);pack.gb=fract(pack.gb);pack.rg-=pack.gb*(1./256.);return pack;}vec3 getViewPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return vec3(xe,ye,viewDepth);}float decodeDepth(const in vec2 uv){vec4 uncodedDepth;
#if DEPTH_PACKING_MODE == 2
uncodedDepth=texture2D(tNormalDepth,uv);
#else
uncodedDepth=texture2D(tDepth,uv);
#endif
#if DEPTH_PACKING_MODE == 0
return uncodedDepth.x;
#elif DEPTH_PACKING_MODE == 1
#if LINEAR_DEPTH == 1
return pow2(unpackRGBAToDepth(uncodedDepth));
#else
return unpackRGBAToDepth(uncodedDepth);
#endif
#else
return pow2(unpack16(uncodedDepth.xy));
#endif
}vec3 getPositionFromOffset(const in vec2 uv,const in vec2 offset,const in float screenSpaceRadius){vec2 uvOffset=uv+floor(screenSpaceRadius*offset)/screenSize;float d=decodeDepth(uvOffset);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(d);return getViewPositionFromViewZ(uvOffset,centerViewZ);
#else
d=mix(-cameraNearFar.x,-cameraNearFar.y,d);return getViewPositionFromViewZ(uvOffset,d);
#endif
}float getOcclusion(const in vec2 uv,const in int id,const in float randomAngle,const in float occlusionSphereRadius,const in vec3 centerPosition,const in vec3 centerNormal){float screenSpaceRadius=(float(id)+mod(randomAngle,1.)+0.5)*INV_NUM_SAMPLES;float angle=screenSpaceRadius*(float(NUM_SPIRAL_TURNS)*6.28)+randomAngle;screenSpaceRadius=(screenSpaceRadius*occlusionSphereRadius);vec2 offset=vec2(cos(angle),sin(angle));vec3 samplePosition=getPositionFromOffset(uv,offset,screenSpaceRadius);vec3 direction=samplePosition-centerPosition;float d2=dot(direction,direction);float ao=max((dot(centerNormal,direction)+centerPosition.z*saoBiasEpsilon.x)/(saoBiasEpsilon.z*d2+saoBiasEpsilon.y),0.);return ao;}void main(){float centerDepth;vec3 centerNormal;getDepthNormal(vUv,centerDepth,centerNormal);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(centerDepth);
#else
float centerViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,centerDepth);
#endif
vec3 centerPosition=getViewPositionFromViewZ(vUv,centerViewZ);float occlusionSphereScreenRadius=200.*saoData.z/(-centerPosition.z);float randomAngle=6.2*random3(vec3(vUv,frameCount*0.1));float sum=0.;sum+=getOcclusion(vUv,0,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#if NUM_SAMPLES > 1
sum+=getOcclusion(vUv,1,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 2
sum+=getOcclusion(vUv,2,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 3
sum+=getOcclusion(vUv,3,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 4
sum+=getOcclusion(vUv,4,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 5
sum+=getOcclusion(vUv,5,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 6
sum+=getOcclusion(vUv,6,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 7
sum+=getOcclusion(vUv,7,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 8
sum+=getOcclusion(vUv,8,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 9
sum+=getOcclusion(vUv,9,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 10
sum+=getOcclusion(vUv,10,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
float aoValue=sum*saoData.y*INV_NUM_SAMPLES;aoValue=clamp(1.-max(aoValue,0.),0.,1.);gl_FragColor.gba=packFloatToRGB(centerDepth);gl_FragColor.r=(vec4(aoValue)).r;}

            `},"tDiffuse"),this.parameters={intensity:.25,occlusionWorldRadius:1,bias:.001,falloff:1,edgeSharpness:.3,blurEnabled:!0},this._smoothEnabled=!0,this.materialExtension={shaderExtender:(a,h,f)=>{a.defines.SSAO_ENABLED&&(a.fragmentShader=a.fragmentShader.replace("#include <aomap_fragment>",`#ifndef USE_TRANSMISSION
#if defined(SSAO_ENABLED) && SSAO_ENABLED > 0
float ambientOcclusion=tSSAOMapTexelToLinear(texture2D(tSSAOMap,viewToScreen(vViewPosition.xyz).xy)).r;reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));reflectedLight.indirectSpecular*=computeSpecularOcclusion(dotNV,ambientOcclusion,material.roughness);
#endif
#endif
#endif
`))},onObjectRender:(a,h,f)=>{var k,et;this.materialExtension.extraUniforms.tSSAOMap.value=(k=this._target)===null||k===void 0?void 0:k.texture;const tt=h.materialObject,rt=!tt.transparent&&tt.transmission<.001;let lt=this.enabled&&rt&&f.userData.screenSpaceRendering!==!1&&!(!((et=h.materialObject.userData)===null||et===void 0)&&et.ssaoDisabled)?1:0;tt.defines.SSAO_ENABLED!==lt&&(tt.defines.SSAO_ENABLED=lt,tt.needsUpdate=!0),lt=this._target.texture,this.materialExtension.extraUniforms.tSSAOMap.value!==lt&&(this.materialExtension.extraUniforms.tSSAOMap.value=lt,tt.needsUpdate=!0)},parsFragmentSnippet:a=>{var h;return Ut`
             uniform sampler2D tSSAOMap;
             ${Kn("tSSAOMap",(h=this._target)===null||h===void 0?void 0:h.texture,a.capabilities.isWebGL2)}
            ${B1}
        `},extraUniforms:{tSSAOMap:{value:null}},computeCacheKey:a=>{var h,f;return this.enabled?"1":"0"+((f=(h=this._target)===null||h===void 0?void 0:h.texture)===null||f===void 0?void 0:f.encoding)},isCompatible:a=>{var h;return!(!((h=a.materialObject.userData)===null||h===void 0)&&h.ssaoDisabled)&&a.isMeshStandardMaterial2}},this._renderer=e,this._target=i,this.needsSwap=!1,this.clear=!0,this.bilateralPass=new L1(this._target,s,"rrrr")}get smoothEnabled(){return this._smoothEnabled}set smoothEnabled(e){this._smoothEnabled=e,this.bilateralPass.enabled=e,this.bilateralPass.uniforms.smoothEnabled.value=e}render(e,i,s,a,h){this.enabled&&(this._updateParameters(),this._renderer.blit(this._target.texture,i,{}),this.uniforms.tLastThis.value=i.texture,super.render(e,this._target,s,a,h),this._smoothEnabled&&this.bilateralPass.render(e,i,s,a,h))}_updateParameters(){const e=this.material.uniforms.saoData.value;e.y=this.parameters.intensity,e.z=this.parameters.occlusionWorldRadius;const i=this.material.uniforms.saoBiasEpsilon.value;i.x=this.parameters.bias,i.y=.001,i.z=this.parameters.falloff}}WM([jn()],GS.prototype,"bilateralPass",void 0),WM([jn()],GS.prototype,"parameters",void 0);class N1 extends Gw{constructor(){super(),this.dependencies=[Kr,ba],this.setDirty=this.setDirty.bind(this)}get aoTarget(){return this._aoTarget}async onAdded(e){return e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSAOPlugin"),super.onAdded(e)}createPasses(e){var i,s;return this._aoTarget=e.renderer.createTarget({sizeMultiplier:1}),[UA(e,{passId:"ssao",after:["gbuffer"],before:["render"],required:["render","gbuffer"],passObject:new GS(e.renderer,this._aoTarget,(s=(i=e.getPlugin(ba))===null||i===void 0?void 0:i.getUnpackSnippet())!==null&&s!==void 0?s:""),update(){this.passObject.bilateralPass.updateShaderProperties([e.getPlugin(ba)])}},()=>[e.getPlugin(ba),e.scene.activeCamera,e.renderer])]}async onRemove(e){return e.renderer.disposeTarget(this._aoTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get enabled(){var e,i;return((i=(e=this.passes.ssao)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.enabled)||!1}set enabled(e){var i;!((i=this.passes.ssao)===null||i===void 0)&&i.passObject&&(this.passes.ssao.passObject.enabled=e)}get uiConfig(){var e;if(this._uiConfig)return this._uiConfig;const i=this,s=i.passes.ssao.passObject;return this._uiConfig={type:"folder",label:"SS Ambient Occlusion",children:[{type:"checkbox",label:"Enabled",property:[s,"enabled"],onChange:i.setDirty},{type:"slider",label:"Intensity",bounds:[0,4],property:[s.parameters,"intensity"],onChange:i.setDirty},{type:"slider",label:"Radius",bounds:[.1,8],property:[s.parameters,"occlusionWorldRadius"],onChange:i.setDirty},{type:"slider",label:"Bias",bounds:[1e-5,.01],property:[s.parameters,"bias"],onChange:i.setDirty},{type:"slider",label:"Falloff",bounds:[.01,3],property:[s.parameters,"falloff"],onChange:i.setDirty},{type:"slider",label:"Num samples",stepSize:1,bounds:[1,11],property:[(e=s.material)===null||e===void 0?void 0:e.defines,"NUM_SAMPLES"],onChange:[()=>s.material.needsUpdate=!0,i.setDirty]},{type:"checkbox",property:[s.bilateralPass,"smoothEnabled"],onChange:i.setDirty},{type:"vec4",property:[s.bilateralPass,"edgeSharpness"],onChange:i.setDirty}]}}}N1.PluginType="SSAO";class qM{constructor(e){this._normalsCache={},this._renderer=e,this._scene=new d.xsS,this._mesh=new d.Kj0,this._mesh.frustumCulled=!1,this._scene.add(this._mesh),this._mesh.position.set(0,0,0),this._mesh.material=new YM}dispose(){this._mesh.material.dispose()}captureNormalMap(e,i,s=512){if(!e)throw"No geometry";if(e.userData._normalsCaptureMap)return!1;const a=i==null?void 0:i.split(";").find(et=>this._normalsCache[et]);if(a){const et=this._normalsCache[a];return i==null||i.split(";").forEach(tt=>tt!==a&&(this._normalsCache[tt]=et)),et.width!==s&&console.warn("last cacheKey normalMapRes mismatch, check model",s),e.userData._normalsCaptureMap=et,!1}const h=this._renderer.createTargetCustom({width:s,height:s},{minFilter:d.TyD,magFilter:d.TyD,generateMipmaps:!1,type:d.cLu},d.oAp);if(!h)throw"Unable to create render target";i==null||i.split(";").forEach(et=>this._normalsCache[et]=h),h.addEventListener("dispose",()=>delete this._normalsCache[i]);const f=new d._am(1e-4,100,h);this._scene.add(f);const k=e.userData._normalsCaptureOffsets;return k.center!==void 0&&this._mesh.material.uniforms.offsetCenter.value.copy(k.center),k.offsetMatrixInv!==void 0&&this._mesh.material.uniforms.offsetMatrixInv.value.copy(k.offsetMatrixInv),k.radius!==void 0&&(this._mesh.material.uniforms.radius.value=k.radius),this._mesh.geometry=e,f.update(this._renderer.rendererObject,this._scene),this._scene.remove(f),this._mesh.geometry=void 0,e.userData._normalsCaptureMap=h,!0}}class YM extends d.jyz{constructor(){super({vertexShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform mat4 offsetMatrixInv;uniform vec3 offsetCenter;void main(){vNormal=normalize((offsetMatrixInv*vec4(normal,0.)).xyz);vecPosition=(modelMatrix*offsetMatrixInv*vec4(position-offsetCenter,1.)).xyz;gl_Position=projectionMatrix*modelViewMatrix*offsetMatrixInv*vec4(position-offsetCenter,1.);}",fragmentShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform float radius;void main(){vec3 color=normalize(vNormal);color=color*0.5+0.5;gl_FragColor=vec4(color.x,color.y,color.z,length(vecPosition)/radius);}",side:d.ehD,clipping:!1,uniforms:{radius:{value:1},offsetMatrixInv:{value:new d.yGw().identity()},offsetCenter:{value:new d.Pa4}}})}}var cP=__webpackgi_require__(654);function XM(c){const e=new d.Pa4(0,0,0),i=new d.Pa4(0,0,0),s=new d.Pa4(0,0,0),a=new d.Pa4(0,0,0),h=c.getAttribute("position"),f=c.index;if(f)for(let pt=Math.max(0,c.drawRange.start),ft=Math.min(f.count,c.drawRange.start+c.drawRange.count)-1;pt<ft/3;pt+=3){const vt=f.getX(pt),yt=f.getX(pt+1),Mt=f.getX(pt+2);i.set(h.getX(vt),h.getY(vt),h.getZ(vt)),s.set(h.getX(yt),h.getY(yt),h.getZ(yt)),a.set(h.getX(Mt),h.getY(Mt),h.getZ(Mt)),s.sub(i),a.sub(i),a.cross(s),a.normalize(),e.add(a)}else for(let pt=0;pt<h.count;pt+=3)i.set(h.getX(pt),h.getY(pt),h.getZ(pt)),s.set(h.getX(pt+1),h.getY(pt+1),h.getZ(pt+1)),a.set(h.getX(pt+2),h.getY(pt+2),h.getZ(pt+2)),s.sub(i),a.sub(i),a.cross(s),a.normalize(),e.add(a);e.normalize();let k=!1,et=0;for(;!k;){const pt=et/3,ft=f?f.getX(pt):pt,vt=f?f.getX(pt+1):pt+1;i.set(h.getX(ft),h.getY(ft),h.getZ(ft)),s.set(h.getX(vt),h.getY(vt),h.getZ(vt)),i.sub(s),i.normalize();const yt=e.dot(i);Math.abs(yt-1)>.001&&i.length()>.5&&(k=!0),et+=3}s.crossVectors(i,e),s.normalize(),i.crossVectors(e,s),i.normalize();const tt=new d.yGw;tt.elements[0]=i.x,tt.elements[1]=i.y,tt.elements[2]=i.z,tt.elements[3]=0,tt.elements[4]=e.x,tt.elements[5]=e.y,tt.elements[6]=e.z,tt.elements[7]=0,tt.elements[8]=s.x,tt.elements[9]=s.y,tt.elements[10]=s.z,tt.elements[11]=0,tt.elements[12]=0,tt.elements[13]=0,tt.elements[14]=0,tt.elements[15]=1,c.computeBoundingSphere();const rt=c.boundingSphere.radius,lt=new d.yGw().makeScale(rt,rt,rt);return tt.multiply(lt),tt}function KM(c){const e=c.getAttribute("position");if(e.count>0)return XM(c);const i=new d.Pa4(0,0,0),s=new d.Pa4(0,0,0),a=new d.Pa4(0,0,0),h=c.index,f=[];if(h)for(let lt=Math.max(0,c.drawRange.start),pt=Math.min(h.count,c.drawRange.start+c.drawRange.count)-1;lt<pt/3;lt+=3){const ft=h.getX(lt),vt=h.getX(lt+1),yt=h.getX(lt+2);i.set(e.getX(ft),e.getY(ft),e.getZ(ft)),s.set(e.getX(vt),e.getY(vt),e.getZ(vt)),a.set(e.getX(yt),e.getY(yt),e.getZ(yt)),f.push(i.toArray(),s.toArray(),a.toArray())}else for(let lt=0;lt<e.count;lt++)i.set(e.getX(lt),e.getY(lt),e.getZ(lt)),f.push(i.toArray());const k=(0,cP.getEigenVectors)(f),et=new d.yGw;et.elements[0]=k[0].vector[0],et.elements[1]=k[0].vector[1],et.elements[2]=k[0].vector[2],et.elements[3]=0,et.elements[4]=k[1].vector[0],et.elements[5]=k[1].vector[1],et.elements[6]=k[1].vector[2],et.elements[7]=0,et.elements[8]=k[2].vector[0],et.elements[9]=k[2].vector[1],et.elements[10]=k[2].vector[2],et.elements[11]=0,et.elements[12]=0,et.elements[13]=0,et.elements[14]=0,et.elements[15]=1,console.log(et.determinant()),c.computeBoundingSphere();const tt=c.boundingSphere.radius,rt=new d.yGw().makeScale(tt,tt,tt);return et.multiply(rt),et}const $M={...T_,color:new oo(1,1,1),envMapIntensity:1,envMapRotation:0,dispersion:.012,squashFactor:.98,geometryFactor:.5,gammaFactor:1,absorptionFactor:1,reflectivity:.5,refractiveIndex:2.4,boostFactors:new d.Pa4(.892,.892,.98595025),envMap:null,wireframe:!1,wireframeLinewidth:0,skinning:!1,transmission:0,morphTargets:!1,morphNormals:!1,rayBounces:1,diamondOrientedEnvMap:0};var hm=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};class Ml extends d.jyz{constructor(e){super({side:d.ehD,defines:{DIA_ORIENT_ENVMAP:0,RAY_BOUNCES:5,ENV_MAP_TYPE:0,PI:3.1428},vertexShader:`#ifndef USE_ENVMAP
#define USE_ENVMAP  
#endif
varying vec3 vWorldPosition;varying vec3 vWorldNormal;void main(){vWorldNormal=(modelMatrix*vec4(normal,0.)).xyz;
#include <begin_vertex>
#include <project_vertex>
#include <worldpos_vertex>
vWorldPosition=worldPosition.xyz;}`,fragmentShader:`varying vec3 vWorldNormal;varying vec3 vWorldPosition;uniform samplerCube tCubeMapNormals;
#if ENV_MAP_TYPE == 0
uniform samplerCube envMap;
#elif ENV_MAP_TYPE == 1
uniform sampler2D envMap;
#endif
uniform float envMapIntensity;uniform mat4 modelMatrix;uniform mat4 inverseModelMatrix;uniform mat4 offsetMatrixInv;uniform mat4 offsetMatrix;uniform float transmission;uniform vec2 transmissionSamplerSize;uniform sampler2D transmissionSamplerMap;uniform float refractiveIndex;uniform float radius;uniform float rIndexDelta;uniform float squashFactor;uniform float geometryFactor;uniform vec3 color;uniform vec3 colorCorrection;uniform vec3 boostFactors;uniform vec3 centerOffset;uniform float gammaFactor;uniform float absorptionFactor;uniform float envMapRotation;uniform float reflectivity;vec3 BRDF_Specular_GGX_Environment(const in vec3 viewDir,const in vec3 normal,const in vec3 specularColor,const in float roughness){float dotNV=abs(dot(normal,viewDir));const vec4 c0=vec4(-1,-0.0275,-0.572,0.022);const vec4 c1=vec4(1,0.0425,1.04,-0.04);vec4 r=roughness*c0+c1;float a004=min(r.x*r.x,exp2(-9.28*dotNV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec2 cartesianToPolar(vec3 n){vec2 uv;uv.x=atan(n.z,n.x)/(PI*2.)+0.5;uv.y=asin(n.y)/PI+0.5;return uv;}vec4 sampleEnvMap(vec3 direction){
#if !defined(USE_ENVMAP)
return vec4(direction,1);
#else
float cs=cos(envMapRotation);float sn=sin(envMapRotation);float temp=cs*direction.x+sn*direction.z;direction.z=-sn*direction.x+cs*direction.z;direction.x=temp;direction.x*=-1.;direction.z*=-1.;
#if ENV_MAP_TYPE == 0
return(textureCube(envMap,direction));
#elif ENV_MAP_TYPE == 1
return(texture2D(envMap,cartesianToPolar(direction)));
#endif
return vec4(1,0,1,1);
#endif
}vec4 SampleSpecularReflection(vec3 direction){return envMapIntensity*(sampleEnvMap(direction));}uniform mat4 projectionMatrix;vec4 SampleSpecularContribution(vec3 direction){direction=normalize(direction);direction.x*=-1.;direction.z*=-1.;return envMapIntensity*(sampleEnvMap(direction));}vec4 SampleSpecularContributionRef(vec3 origin,int i){vec4 ndcPos=projectionMatrix*viewMatrix*vec4(origin,1.);vec2 refractionCoords=ndcPos.xy/ndcPos.w;refractionCoords+=1.;refractionCoords/=2.;return transmissionSamplerMapTexelToLinear(texture2D(transmissionSamplerMap,refractionCoords));}vec3 intersectSphere(vec3 origin,vec3 direction){origin-=centerOffset;direction.y/=squashFactor;float A=dot(direction,direction);float B=2.*dot(origin,direction);float C=dot(origin,origin)-radius*radius;float disc=B*B-4.*A*C;if(disc>0.){disc=sqrt(disc);float t1=(-B+disc)*geometryFactor/A;float t2=(-B-disc)*geometryFactor/A;float t=(t1>t2)?t1:t2;direction.y*=squashFactor;return vec3(origin+centerOffset+direction*t);}return vec3(0.);}vec3 linePlaneIntersect(in vec3 pointOnLine,in vec3 lineDirection,in vec3 pointOnPlane,in vec3 planeNormal){return lineDirection*(dot(planeNormal,pointOnPlane-pointOnLine)/dot(planeNormal,lineDirection))+pointOnLine;}vec4 getNormalDistance(vec3 d){return textureCube(tCubeMapNormals,d);}vec3 getSurfaceNormal(vec4 surfaceInfos){vec3 surfaceNormal=surfaceInfos.rgb;surfaceNormal=surfaceNormal*2.-1.;return-normalize(surfaceNormal);}vec3 intersect(vec3 rayOrigin,vec3 rayDirection){vec3 sphereHitPoint=intersectSphere(rayOrigin,rayDirection);vec3 direction1=normalize(sphereHitPoint-centerOffset);vec4 normalDistanceData1=getNormalDistance(direction1);float distance1=normalDistanceData1.a*radius;vec3 pointOnPlane1=centerOffset+direction1*distance1;vec3 planeNormal1=getSurfaceNormal(normalDistanceData1);vec3 hitPoint1=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane1,planeNormal1);vec3 direction2=normalize(hitPoint1-centerOffset);vec4 normalDistanceData2=getNormalDistance(direction2);float distance2=normalDistanceData2.a*radius;vec3 pointOnPlane2=centerOffset+direction2*distance2;vec3 hitPoint=hitPoint1;vec3 planeNormal2=getSurfaceNormal(normalDistanceData2);hitPoint=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane2,planeNormal2);return hitPoint;}vec3 debugBounces(int count){vec3 color=vec3(1.,1.,1.);if(count==1)color=vec3(0.,1.,0.);else if(count==2)color=vec3(0.,0.,1.);else if(count==3)color=vec3(1.,1.,0.);else if(count==4)color=vec3(0.,1.,1.);else color=vec3(0.,1.,0.);if(count==0)color=vec3(1.,0.,0.);return color;}vec3 traceRay(vec3 origin,vec3 direction,vec3 normal){vec3 outColor=vec3(0.);const float n1=1.;const float epsilon=1e-4;float f0=(2.4-n1)/(2.4+n1);f0*=f0;vec3 attenuationFactor=vec3(1.);vec3 newDirection=refract(direction,normal,n1/refractiveIndex);vec3 reflectedDirection=reflect(direction,normal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(reflectedDirection,normal,vec3(f0),0.);vec3 brdfRefracted=BRDF_Specular_GGX_Environment(newDirection,-normal,vec3(f0),0.);attenuationFactor*=(vec3(1.)-brdfRefracted);outColor+=SampleSpecularReflection(reflectedDirection).rgb*brdfReflected*reflectivity*2.;int count=0;newDirection=(offsetMatrixInv*inverseModelMatrix*vec4(newDirection,0.)).xyz;newDirection=normalize(newDirection);origin=(offsetMatrixInv*inverseModelMatrix*vec4(origin,1.)).xyz;vec3 origin2=origin;origin2=(modelMatrix*offsetMatrix*vec4(origin2,1.)).xyz;for(int i=0;i<RAY_BOUNCES;i++){vec3 intersectedPos=intersect(origin,newDirection);vec3 dist=intersectedPos-origin;vec3 d=normalize(intersectedPos-centerOffset);vec3 mappedNormal=getNormalDistance(d).rgb;mappedNormal=2.*mappedNormal-1.;mappedNormal=-normalize(mappedNormal);float r=length(dist)/radius*absorptionFactor;attenuationFactor*=exp(-r*(1.-color));origin=intersectedPos;origin2=(modelMatrix*offsetMatrix*vec4(intersectedPos,1.)).xyz;vec3 oldDir=newDirection;newDirection=refract(newDirection,mappedNormal,refractiveIndex/n1);if(dot(newDirection,newDirection)<epsilon){newDirection=reflect(oldDir,mappedNormal);if(i==RAY_BOUNCES-1){vec3 brdfReflected=BRDF_Specular_GGX_Environment(-oldDir,mappedNormal,vec3(f0),0.);vec3 d1=(modelMatrix*offsetMatrix*vec4(oldDir,0.)).xyz;d1=normalize(d1);float cosT=1.-dot(direction,d1);outColor+=((transmission>0.&&cosT<transmission)?SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb:SampleSpecularContribution(DIA_ORIENT_ENVMAP<1?d1:newDirection).rgb)*attenuationFactor*colorCorrection*boostFactors*(vec3(1.)-brdfReflected);}}else{vec3 brdfRefracted=vec3(1.)-BRDF_Specular_GGX_Environment(newDirection,-mappedNormal,vec3(f0),0.);vec3 d1=(modelMatrix*offsetMatrix*vec4(newDirection,0.)).xyz;d1=normalize(d1);float cosT=1.-dot(direction,d1);if(transmission>0.&&cosT<transmission){outColor+=SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}else{vec3 dir0=newDirection;vec3 dir1=refract(oldDir,mappedNormal,(refractiveIndex+rIndexDelta)/n1);vec3 dir2=refract(oldDir,mappedNormal,(refractiveIndex-rIndexDelta)/n1);
#if DIA_ORIENT_ENVMAP < 1
dir0=d1;dir1=(modelMatrix*offsetMatrix*vec4(dir1,0.)).xyz;dir2=(modelMatrix*offsetMatrix*vec4(dir2,0.)).xyz;
#endif
outColor+=vec3(SampleSpecularContribution(dir1).r,SampleSpecularContribution(dir0).g,SampleSpecularContribution(dir2).b)*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}newDirection=reflect(oldDir,mappedNormal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(newDirection,mappedNormal,vec3(f0),0.);attenuationFactor*=brdfReflected*boostFactors;count++;}}return outColor;}void main(){vec3 normalizedNormal=normalize(vWorldNormal);vec3 viewVector=normalize(vWorldPosition-cameraPosition);vec3 color=traceRay(vWorldPosition,viewVector,normalizedNormal);gl_FragColor=vec4(color.rgb,1.);
#include <encodings_fragment>
}`,uniforms:{envMap:{value:e.envMap||null},envMapRotation:{value:0},transmission:{value:0},transmissionSamplerMap:{value:null},transmissionSamplerSize:{value:new d.FM8},normalOffset:{value:0},distanceOffset:{value:0},colorCorrection:{value:new d.Pa4(1,1,1)}}}),this.typeSlug=Ml.TypeSlug,this.assetType="material",this.__envMap=null,this.isDiamondMaterial=!0,this.color=new oo(1,1,1),this.envMapIntensity=1,this.dispersion=.012,this.absorptionFactor=1,this.refractiveIndex=2.4,this.squashFactor=.98,this.geometryFactor=.5,this.gammaFactor=1,this.boostFactors=new d.Pa4(.892,.892,.98595025),this.transmission=0,this.reflectivity=.5,this.rayBounces=5,this.diamondOrientedEnvMap=0,this.normalsCaptureMap=null,this.extraUniformsToUpload={inverseModelMatrix:{value:new d.yGw().identity()},radius:{value:1},centerOffset:{value:new d.Pa4(0,0,0)},offsetMatrix:{value:new d.yGw().identity()},offsetMatrixInv:{value:new d.yGw().identity()}},this.setDirty=this.setDirty.bind(this),this.userData.setDirty=i=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(i)},this.userData.separateEnvMapIntensity=!0,this.userData.enableLUT=!0,this.setValues(e)}get mmMaterial(){return this}get materialObject(){return this}onBeforeRender(e,i,s,a,h){var f,k;super.onBeforeRender(e,i,s,a,h),this.uniforms.envMapRotation.value=((f=this.envMap)===null||f===void 0?void 0:f.rotation)||0,this.extraUniformsToUpload.inverseModelMatrix.value.copy(h.matrixWorld).invert();const et=a.userData._normalsCaptureOffsets;et&&(this.extraUniformsToUpload.centerOffset.value.copy(et.centerOffset),this.extraUniformsToUpload.offsetMatrix.value.copy(et.offsetMatrix),this.extraUniformsToUpload.offsetMatrixInv.value.copy(et.offsetMatrixInv),this.extraUniformsToUpload.radius.value=et.radius);const tt=(k=a.userData._normalsCaptureMap)===null||k===void 0?void 0:k.texture;this.normalsCaptureMap!==tt&&(this.normalsCaptureMap=tt)}setDirty(e){var i,s;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(s=(i=this._uiConfig)===null||i===void 0?void 0:i.uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0,1)}set envMap(e){var i;this.__envMap=e,this.uniforms.envMap.value=this.__envMap,!((i=this.__envMap)===null||i===void 0)&&i.isCubeTexture?(this.defines.ENV_MAP_TYPE=0,this.needsUpdate=!0):(this.defines.ENV_MAP_TYPE=1,this.needsUpdate=!0)}get envMap(){return this.__envMap}clone(){return super.clone()}toJSON(e){const i={};return i.name=this.name,i.uuid=this.uuid,i.color=this.color.getHex(),i.envMapIntensity=this.envMapIntensity,i.dispersion=this.dispersion,i.squashFactor=this.squashFactor,i.geometryFactor=this.geometryFactor,i.gammaFactor=this.gammaFactor,i.absorptionFactor=this.absorptionFactor,i.reflectivity=this.reflectivity,i.refractiveIndex=this.refractiveIndex,i.rayBounces=this.rayBounces,i.diamondOrientedEnvMap=this.diamondOrientedEnvMap,i.boostFactors={x:this.boostFactors.x,y:this.boostFactors.y,z:this.boostFactors.z,isVector3:!0},i.transmission=this.transmission,i.isDiamondMaterialParameters=!0,i.type=Ml.TYPE,i.userData={},Jl(i.userData,this.userData),i.userData.uuid=this.userData.uuid,i}get uiConfig(){const e=this;return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},...Ap(this),{type:"input",label:"Mesh count",get value(){var i,s,a;return(a=(s=(i=e.userData)===null||i===void 0?void 0:i.__appliedMeshes)===null||s===void 0?void 0:s.size)!==null&&a!==void 0?a:0},set value(i){},disabled:!0},{type:"checkbox",label:"Enable LUT",getValue:()=>this.userData.enableLUT===!0,setValue:i=>{this.userData.enableLUT=i||void 0,this.setDirty()}},{type:"input",label:"uuid",get value(){return e.uuid},set value(i){},disabled:!0},{type:"checkbox",label:"Render to Depth",hidden:()=>this.transmission===0,get value(){return e.userData.renderToDepth===!0},set value(i){e.userData.renderToDepth=i||void 0}},{type:"button",label:"Download .dmat",value:()=>{Du(new Blob([JSON.stringify(e.toJSON(),null,2)],{type:"application/json"}),"diamond-material.dmat")}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Diamond Material",expanded:!0,children:this._uiConfigChildren,limitedUi:!0}),this._uiConfig}copyProps(e){if(!e.isDiamondMaterialParameters&&!e.isDiamondMaterial&&!e.isDiamond&&e.type!==Ml.TYPE)return console.warn("Material type is not supported",e),this;const i={};on(e,i,Array.from(Object.keys($M)));const s=i.userData;return delete i.userData,this.setValues(i),Jl(this.userData,s),this.setDirty(),this}fromJSON(e,i){return this.copyProps(e)}}Ml.TypeSlug="dmat",Ml.TYPE="DiamondMaterial",hm([op("Color",{limitedUi:!0}),dn()],Ml.prototype,"color",void 0),hm([Xr("Env Intensity",[0,5],.01,{limitedUi:!0}),dn()],Ml.prototype,"envMapIntensity",void 0),hm([Xr("Dispersion",[0,.1],1e-4,{limitedUi:!0}),dn({propKey:"rIndexDelta"})],Ml.prototype,"dispersion",void 0),hm([Xr("Absorption",[0,15],.01,{limitedUi:!0}),dn()],Ml.prototype,"absorptionFactor",void 0),hm([Xr("Refractive Index",[0,4],.01,{limitedUi:!0}),dn()],Ml.prototype,"refractiveIndex",void 0),hm([dn()],Ml.prototype,"squashFactor",void 0),hm([dn()],Ml.prototype,"geometryFactor",void 0),hm([dn()],Ml.prototype,"gammaFactor",void 0),hm([Qo("RGB Boost",void 0,void 0,{limitedUi:!0}),dn()],Ml.prototype,"boostFactors",void 0),hm([Xr("Transmission",[0,1],.01,{limitedUi:!0}),dn()],Ml.prototype,"transmission",void 0),hm([Xr("Reflectivity",[0,2],.01,{limitedUi:!0}),dn()],Ml.prototype,"reflectivity",void 0),hm([kn("RAY_BOUNCES",void 0,!0),Xr("Ray Bounces",[1,16],1)],Ml.prototype,"rayBounces",void 0),hm([kn("DIA_ORIENT_ENVMAP",void 0,!0),Xr("Diamond Oriented Lighting",[0,1],1)],Ml.prototype,"diamondOrientedEnvMap",void 0),hm([dn({propKey:"tCubeMapNormals"})],Ml.prototype,"normalsCaptureMap",void 0);class JM extends j{constructor(e,i,s,a){super(),this._scene=e,this._camera=s??this._scene.activeCamera,this.domElement=i,this._time=this.time,this._mouseDownTime=0,this._mouseUpTime=1,this.selectionCondition=a??(h=>h.userData.userSelectable!==!1&&h.userData.bboxVisible!==!1&&h.material!=null&&h.material.type!=="ShadowMaterial"),this.raycaster=new d.iMs,this.mouse=new d.FM8,this._selected=[],this._hovering=[],this.cursorStyles={default:"grab",down:"grabbing"},this._activeCameraChange=this._activeCameraChange.bind(this),this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.domElement.style.touchAction="none",this.domElement.style.cursor=this.cursorStyles.default,this.domElement.addEventListener("pointermove",h=>this.onPointerMove(h)),this.domElement.addEventListener("pointerleave",h=>this.onPointerLeave(h)),this.domElement.addEventListener("pointerout",h=>this.onPointerLeave(h)),this.domElement.addEventListener("pointercancel",h=>this.onPointerCancel(h)),this.domElement.addEventListener("pointerenter",h=>this.onPointerEnter(h)),this.domElement.addEventListener("pointerdown",h=>this.onPointerDown(h)),this.domElement.addEventListener("pointerup",h=>this.onPointerUp(h))}get scene(){return this._scene}set scene(e){var i;(i=this._scene)===null||i===void 0||i.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene=e,this._scene.addEventListener("activeCameraChange",this._activeCameraChange)}_activeCameraChange(){this.camera=this._scene.activeCamera}get camera(){return this._camera}set camera(e){this._camera=e}get selectedObject(){return this._selected.length>0?this._selected[0]:null}set selectedObject(e){this._selected.length===1&&this._selected[0]===e||(this._selected=e?Array.isArray(e)?[...e]:[e]:[],this.refreshOutlinePass(),this.dispatchEvent({type:"selectedObjectChanged",object:this.selectedObject}))}get hoverObject(){return this._hovering.length>0?this._hovering[0]:null}set hoverObject(e){this._hovering=e?Array.isArray(e)?[...e]:[e]:[],this.refreshOutlinePass(),this.dispatchEvent({type:"hoverObjectChanged",object:this.hoverObject})}get time(){return this._time=mo(),this._time}get isMouseDown(){return this.mouseDownDeltaTime<0}get mouseDownDeltaTime(){return this._mouseUpTime-this._mouseDownTime}onPointerMove(e){e.isPrimary!==!1&&this.updateMouseFromEvent(e)}onPointerLeave(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.default,this.hoverObject=null)}onPointerEnter(e){}onPointerCancel(e){}updateMouseFromEvent(e){const i=this.domElement.getBoundingClientRect();this.mouse.x=(e.clientX-i.x)/i.width*2-1,this.mouse.y=-(e.clientY-i.y)/i.height*2+1}onPointerDown(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.down,this._mouseDownTime=this.time)}onPointerUp(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.default,this._mouseUpTime=this.time,this.mouseDownDeltaTime<200&&this.onPointerClick(e))}onPointerClick(e){if(e.isPrimary===!1)return;this.updateMouseFromEvent(e);const i=this.checkIntersection();i&&this.dispatchEvent({type:"hitObject",time:this._mouseUpTime,intersects:i}),this.selectedObject=(i==null?void 0:i.selectedObject)||null}addPasses(){}checkIntersection(){var e;const i=(e=this._camera)===null||e===void 0?void 0:e.cameraObject;if(!i)return null;this.raycaster.setFromCamera(this.mouse,i);const s=this.raycaster.intersectObject(this._scene.modelRoot.modelObject,!0),a=this.selectedObject;if(a){const h=s.length-1-[...s].reverse().findIndex(f=>{let k=f.object;for(;k;){if(f.object===a)return!0;k=k.parent}return!1});h>=0&&s.splice(0,h+1)}if(s.length>0){for(const h of s){let f=h.object;for(;!(f==null||f.visible&&this.selectionCondition(f));)f=f.parent;if(f)return{selectedObject:f,intersect:h,intersects:s,mouse:this.mouse.toArray()}}return null}return null}refreshOutlinePass(){var e;(e=this.hoverObject)!==null&&e!==void 0||this.selectedObject}isHovering(){return this.hoverObject!=null}isSelected(){return this.selectedObject!=null}}const Fy=new d.iMs,dm=new d.Pa4,z0=new d.Pa4,eu=new d._fP,ZM={X:new d.Pa4(1,0,0),Y:new d.Pa4(0,1,0),Z:new d.Pa4(0,0,1)},HS={type:"change"},eT={type:"mouseDown"},tT={type:"mouseUp",mode:null},nT={type:"objectChange"};class uP extends d.Tme{constructor(e,i){super(),i===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),i=document),this.isTransformControls=!0,this.visible=!1,this.domElement=i,this.domElement.style.touchAction="none";const s=new aT;this._gizmo=s,this.add(s);const a=new dP;this._plane=a,this.add(a);const h=this;function f(xt,Et){let At=Et;Object.defineProperty(h,xt,{get:function(){return At!==void 0?At:Et},set:function(Rt){At!==Rt&&(At=Rt,a[xt]=Rt,s[xt]=Rt,h.dispatchEvent({type:xt+"-changed",value:Rt}),h.dispatchEvent(HS))}}),h[xt]=Et,a[xt]=Et,s[xt]=Et}f("camera",e),f("object",void 0),f("enabled",!0),f("axis",null),f("mode","translate"),f("translationSnap",null),f("rotationSnap",null),f("scaleSnap",null),f("space","world"),f("size",1),f("dragging",!1),f("showX",!0),f("showY",!0),f("showZ",!0);const k=new d.Pa4,et=new d.Pa4,tt=new d._fP,rt=new d._fP,lt=new d.Pa4,pt=new d._fP,ft=new d.Pa4,vt=new d.Pa4,yt=new d.Pa4,Mt=new d.Pa4;f("worldPosition",k),f("worldPositionStart",et),f("worldQuaternion",tt),f("worldQuaternionStart",rt),f("cameraPosition",lt),f("cameraQuaternion",pt),f("pointStart",ft),f("pointEnd",vt),f("rotationAxis",yt),f("rotationAngle",0),f("eye",Mt),this._offset=new d.Pa4,this._startNorm=new d.Pa4,this._endNorm=new d.Pa4,this._cameraScale=new d.Pa4,this._parentPosition=new d.Pa4,this._parentQuaternion=new d._fP,this._parentQuaternionInv=new d._fP,this._parentScale=new d.Pa4,this._worldScaleStart=new d.Pa4,this._worldQuaternionInv=new d._fP,this._worldScale=new d.Pa4,this._positionStart=new d.Pa4,this._quaternionStart=new d._fP,this._scaleStart=new d.Pa4,this._getPointer=WS.bind(this),this._onPointerDown=hP.bind(this),this._onPointerHover=rT.bind(this),this._onPointerMove=F1.bind(this),this._onPointerUp=iT.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye):this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;Fy.setFromCamera(e,this.camera);const i=qS(this._gizmo.picker[this.mode],Fy);this.axis=i?i.object.name:null}pointerDown(e){if(this.object!==void 0&&this.dragging!==!0&&e.button===0&&this.axis!==null){Fy.setFromCamera(e,this.camera);const i=qS(this._plane,Fy,!0);i&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(i.point).sub(this.worldPositionStart)),this.dragging=!0,eT.mode=this.mode,this.dispatchEvent(eT)}}pointerMove(e){const i=this.axis,s=this.mode,a=this.object;let h=this.space;if(s==="scale"?h="local":i!=="E"&&i!=="XYZE"&&i!=="XYZ"||(h="world"),a===void 0||i===null||this.dragging===!1||e.button!==-1)return;Fy.setFromCamera(e,this.camera);const f=qS(this._plane,Fy,!0);if(f){if(this.pointEnd.copy(f.point).sub(this.worldPositionStart),s==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),h==="local"&&i!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),i.indexOf("X")===-1&&(this._offset.x=0),i.indexOf("Y")===-1&&(this._offset.y=0),i.indexOf("Z")===-1&&(this._offset.z=0),h==="local"&&i!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),a.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(h==="local"&&(a.position.applyQuaternion(eu.copy(this._quaternionStart).invert()),i.search("X")!==-1&&(a.position.x=Math.round(a.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(a.position.y=Math.round(a.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(a.position.z=Math.round(a.position.z/this.translationSnap)*this.translationSnap),a.position.applyQuaternion(this._quaternionStart)),h==="world"&&(a.parent&&a.position.add(dm.setFromMatrixPosition(a.parent.matrixWorld)),i.search("X")!==-1&&(a.position.x=Math.round(a.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(a.position.y=Math.round(a.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(a.position.z=Math.round(a.position.z/this.translationSnap)*this.translationSnap),a.parent&&a.position.sub(dm.setFromMatrixPosition(a.parent.matrixWorld))));else if(s==="scale"){if(i.search("XYZ")!==-1){let k=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(k*=-1),z0.set(k,k,k)}else dm.copy(this.pointStart),z0.copy(this.pointEnd),dm.applyQuaternion(this._worldQuaternionInv),z0.applyQuaternion(this._worldQuaternionInv),z0.divide(dm),i.search("X")===-1&&(z0.x=1),i.search("Y")===-1&&(z0.y=1),i.search("Z")===-1&&(z0.z=1);a.scale.copy(this._scaleStart).multiply(z0),this.scaleSnap&&(i.search("X")!==-1&&(a.scale.x=Math.round(a.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Y")!==-1&&(a.scale.y=Math.round(a.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Z")!==-1&&(a.scale.z=Math.round(a.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(s==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const k=20/this.worldPosition.distanceTo(dm.setFromMatrixPosition(this.camera.matrixWorld));i==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):i==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(dm.copy(this.rotationAxis).cross(this.eye))*k):i!=="X"&&i!=="Y"&&i!=="Z"||(this.rotationAxis.copy(ZM[i]),dm.copy(ZM[i]),h==="local"&&dm.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(dm.cross(this.eye).normalize())*k),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),h==="local"&&i!=="E"&&i!=="XYZE"?(a.quaternion.copy(this._quaternionStart),a.quaternion.multiply(eu.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),a.quaternion.copy(eu.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),a.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(HS),this.dispatchEvent(nT)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(tT.mode=this.mode,this.dispatchEvent(tT)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(HS),this.dispatchEvent(nT),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Fy}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function WS(c){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:c.button};{const e=this.domElement.getBoundingClientRect();return{x:(c.clientX-e.left)/e.width*2-1,y:-(c.clientY-e.top)/e.height*2+1,button:c.button}}}function rT(c){if(this.enabled)switch(c.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(c))}}function hP(c){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(c.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(c)),this.pointerDown(this._getPointer(c)))}function F1(c){this.enabled&&this.pointerMove(this._getPointer(c))}function iT(c){this.enabled&&(this.domElement.releasePointerCapture(c.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(c)))}function qS(c,e,i){const s=e.intersectObject(c,!0);for(let a=0;a<s.length;a++)if(s[a].object.visible||i)return s[a];return!1}const Ww=new d.USm,Tl=new d.Pa4(0,1,0),sT=new d.Pa4(0,0,0),oT=new d.yGw,U1=new d._fP,V0=new d._fP,Cv=new d.Pa4,YS=new d.yGw,qw=new d.Pa4(1,0,0),G_=new d.Pa4(0,1,0),Yw=new d.Pa4(0,0,1),j1=new d.Pa4,zA=new d.Pa4,Xw=new d.Pa4;class aT extends d.Tme{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new d.vBJ({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=new d.nls({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=e.clone();s.opacity=.15;const a=i.clone();a.opacity=.5;const h=e.clone();h.color.setHex(16711680);const f=e.clone();f.color.setHex(65280);const k=e.clone();k.color.setHex(255);const et=e.clone();et.color.setHex(16711680),et.opacity=.5;const tt=e.clone();tt.color.setHex(65280),tt.opacity=.5;const rt=e.clone();rt.color.setHex(255),rt.opacity=.5;const lt=e.clone();lt.opacity=.25;const pt=e.clone();pt.color.setHex(16776960),pt.opacity=.25,e.clone().color.setHex(16776960);const ft=e.clone();ft.color.setHex(7895160);const vt=new d.fHI(0,.04,.1,12);vt.translate(0,.05,0);const yt=new d.DvJ(.08,.08,.08);yt.translate(0,.04,0);const Mt=new d.u9r;Mt.setAttribute("position",new d.a$l([0,0,0,1,0,0],3));const xt=new d.fHI(.0075,.0075,.5,3);function Et(In,xn){const Cn=new d.XvJ(In,.0075,3,64,xn*Math.PI*2);return Cn.rotateY(Math.PI/2),Cn.rotateX(Math.PI/2),Cn}xt.translate(0,.25,0);const At={X:[[new d.Kj0(vt,h),[.5,0,0],[0,0,-Math.PI/2]],[new d.Kj0(vt,h),[-.5,0,0],[0,0,Math.PI/2]],[new d.Kj0(xt,h),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new d.Kj0(vt,f),[0,.5,0]],[new d.Kj0(vt,f),[0,-.5,0],[Math.PI,0,0]],[new d.Kj0(xt,f)]],Z:[[new d.Kj0(vt,k),[0,0,.5],[Math.PI/2,0,0]],[new d.Kj0(vt,k),[0,0,-.5],[-Math.PI/2,0,0]],[new d.Kj0(xt,k),null,[Math.PI/2,0,0]]],XYZ:[[new d.Kj0(new d.pQR(.1,0),lt.clone()),[0,0,0]]],XY:[[new d.Kj0(new d.DvJ(.15,.15,.01),rt.clone()),[.15,.15,0]]],YZ:[[new d.Kj0(new d.DvJ(.15,.15,.01),et.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new d.Kj0(new d.DvJ(.15,.15,.01),tt.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},Rt={X:[[new d.Kj0(new d.fHI(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new d.Kj0(new d.fHI(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new d.Kj0(new d.fHI(.2,0,.6,4),s),[0,.3,0]],[new d.Kj0(new d.fHI(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new d.Kj0(new d.fHI(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new d.Kj0(new d.fHI(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new d.Kj0(new d.pQR(.2,0),s)]],XY:[[new d.Kj0(new d.DvJ(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new d.Kj0(new d.DvJ(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new d.Kj0(new d.DvJ(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]]},Bt={START:[[new d.Kj0(new d.pQR(.01,2),a),null,null,null,"helper"]],END:[[new d.Kj0(new d.pQR(.01,2),a),null,null,null,"helper"]],DELTA:[[new d.x12(function(){const In=new d.u9r;return In.setAttribute("position",new d.a$l([0,0,0,1,1,1],3)),In}(),a),null,null,null,"helper"]],X:[[new d.x12(Mt,a.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new d.x12(Mt,a.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new d.x12(Mt,a.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},Qt={XYZE:[[new d.Kj0(Et(.5,1),ft),null,[0,Math.PI/2,0]]],X:[[new d.Kj0(Et(.5,.5),h)]],Y:[[new d.Kj0(Et(.5,.5),f),null,[0,0,-Math.PI/2]]],Z:[[new d.Kj0(Et(.5,.5),k),null,[0,Math.PI/2,0]]],E:[[new d.Kj0(Et(.75,1),pt),null,[0,Math.PI/2,0]]]},Wt={AXIS:[[new d.x12(Mt,a.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},tn={XYZE:[[new d.Kj0(new d.xo$(.25,10,8),s)]],X:[[new d.Kj0(new d.XvJ(.5,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new d.Kj0(new d.XvJ(.5,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new d.Kj0(new d.XvJ(.5,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new d.Kj0(new d.XvJ(.75,.1,2,24),s)]]},pn={X:[[new d.Kj0(yt,h),[.5,0,0],[0,0,-Math.PI/2]],[new d.Kj0(xt,h),[0,0,0],[0,0,-Math.PI/2]],[new d.Kj0(yt,h),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new d.Kj0(yt,f),[0,.5,0]],[new d.Kj0(xt,f)],[new d.Kj0(yt,f),[0,-.5,0],[0,0,Math.PI]]],Z:[[new d.Kj0(yt,k),[0,0,.5],[Math.PI/2,0,0]],[new d.Kj0(xt,k),[0,0,0],[Math.PI/2,0,0]],[new d.Kj0(yt,k),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new d.Kj0(new d.DvJ(.15,.15,.01),rt),[.15,.15,0]]],YZ:[[new d.Kj0(new d.DvJ(.15,.15,.01),et),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new d.Kj0(new d.DvJ(.15,.15,.01),tt),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new d.Kj0(new d.DvJ(.1,.1,.1),lt.clone())]]},yn={X:[[new d.Kj0(new d.fHI(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new d.Kj0(new d.fHI(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new d.Kj0(new d.fHI(.2,0,.6,4),s),[0,.3,0]],[new d.Kj0(new d.fHI(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new d.Kj0(new d.fHI(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new d.Kj0(new d.fHI(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new d.Kj0(new d.DvJ(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new d.Kj0(new d.DvJ(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new d.Kj0(new d.DvJ(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new d.Kj0(new d.DvJ(.2,.2,.2),s),[0,0,0]]]},En={X:[[new d.x12(Mt,a.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new d.x12(Mt,a.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new d.x12(Mt,a.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function wn(In){const xn=new d.Tme;for(const Cn in In)for(let Fn=In[Cn].length;Fn--;){const Tn=In[Cn][Fn][0].clone(),Wn=In[Cn][Fn][1],or=In[Cn][Fn][2],fr=In[Cn][Fn][3],rr=In[Cn][Fn][4];Tn.name=Cn,Tn.tag=rr,Wn&&Tn.position.set(Wn[0],Wn[1],Wn[2]),or&&Tn.rotation.set(or[0],or[1],or[2]),fr&&Tn.scale.set(fr[0],fr[1],fr[2]),Tn.updateMatrix();const Ir=Tn.geometry.clone();Ir.applyMatrix4(Tn.matrix),Tn.geometry=Ir,Tn.renderOrder=1/0,Tn.position.set(0,0,0),Tn.rotation.set(0,0,0),Tn.scale.set(1,1,1),xn.add(Tn)}return xn}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=wn(At)),this.add(this.gizmo.rotate=wn(Qt)),this.add(this.gizmo.scale=wn(pn)),this.add(this.picker.translate=wn(Rt)),this.add(this.picker.rotate=wn(tn)),this.add(this.picker.scale=wn(yn)),this.add(this.helper.translate=wn(Bt)),this.add(this.helper.rotate=wn(Wt)),this.add(this.helper.scale=wn(En)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const i=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:V0;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let a=0;a<s.length;a++){const h=s[a];let f;h.visible=!0,h.rotation.set(0,0,0),h.position.copy(this.worldPosition),f=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),h.scale.set(1,1,1).multiplyScalar(f*this.size/4),h.tag!=="helper"?(h.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"?(h.name==="X"&&Math.abs(Tl.copy(qw).applyQuaternion(i).dot(this.eye))>.99&&(h.scale.set(1e-10,1e-10,1e-10),h.visible=!1),h.name==="Y"&&Math.abs(Tl.copy(G_).applyQuaternion(i).dot(this.eye))>.99&&(h.scale.set(1e-10,1e-10,1e-10),h.visible=!1),h.name==="Z"&&Math.abs(Tl.copy(Yw).applyQuaternion(i).dot(this.eye))>.99&&(h.scale.set(1e-10,1e-10,1e-10),h.visible=!1),h.name==="XY"&&Math.abs(Tl.copy(Yw).applyQuaternion(i).dot(this.eye))<.2&&(h.scale.set(1e-10,1e-10,1e-10),h.visible=!1),h.name==="YZ"&&Math.abs(Tl.copy(qw).applyQuaternion(i).dot(this.eye))<.2&&(h.scale.set(1e-10,1e-10,1e-10),h.visible=!1),h.name==="XZ"&&Math.abs(Tl.copy(G_).applyQuaternion(i).dot(this.eye))<.2&&(h.scale.set(1e-10,1e-10,1e-10),h.visible=!1)):this.mode==="rotate"&&(U1.copy(i),Tl.copy(this.eye).applyQuaternion(eu.copy(i).invert()),h.name.search("E")!==-1&&h.quaternion.setFromRotationMatrix(oT.lookAt(this.eye,sT,G_)),h.name==="X"&&(eu.setFromAxisAngle(qw,Math.atan2(-Tl.y,Tl.z)),eu.multiplyQuaternions(U1,eu),h.quaternion.copy(eu)),h.name==="Y"&&(eu.setFromAxisAngle(G_,Math.atan2(Tl.x,Tl.z)),eu.multiplyQuaternions(U1,eu),h.quaternion.copy(eu)),h.name==="Z"&&(eu.setFromAxisAngle(Yw,Math.atan2(Tl.y,Tl.x)),eu.multiplyQuaternions(U1,eu),h.quaternion.copy(eu))),h.visible=h.visible&&(h.name.indexOf("X")===-1||this.showX),h.visible=h.visible&&(h.name.indexOf("Y")===-1||this.showY),h.visible=h.visible&&(h.name.indexOf("Z")===-1||this.showZ),h.visible=h.visible&&(h.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),h.material._color=h.material._color||h.material.color.clone(),h.material._opacity=h.material._opacity||h.material.opacity,h.material.color.copy(h.material._color),h.material.opacity=h.material._opacity,this.enabled&&this.axis&&(h.name===this.axis||this.axis.split("").some(function(k){return h.name===k}))&&(h.material.color.setHex(16776960),h.material.opacity=1)):(h.visible=!1,h.name==="AXIS"?(h.position.copy(this.worldPositionStart),h.visible=!!this.axis,this.axis==="X"&&(eu.setFromEuler(Ww.set(0,0,0)),h.quaternion.copy(i).multiply(eu),Math.abs(Tl.copy(qw).applyQuaternion(i).dot(this.eye))>.9&&(h.visible=!1)),this.axis==="Y"&&(eu.setFromEuler(Ww.set(0,0,Math.PI/2)),h.quaternion.copy(i).multiply(eu),Math.abs(Tl.copy(G_).applyQuaternion(i).dot(this.eye))>.9&&(h.visible=!1)),this.axis==="Z"&&(eu.setFromEuler(Ww.set(0,Math.PI/2,0)),h.quaternion.copy(i).multiply(eu),Math.abs(Tl.copy(Yw).applyQuaternion(i).dot(this.eye))>.9&&(h.visible=!1)),this.axis==="XYZE"&&(eu.setFromEuler(Ww.set(0,Math.PI/2,0)),Tl.copy(this.rotationAxis),h.quaternion.setFromRotationMatrix(oT.lookAt(sT,Tl,G_)),h.quaternion.multiply(eu),h.visible=this.dragging),this.axis==="E"&&(h.visible=!1)):h.name==="START"?(h.position.copy(this.worldPositionStart),h.visible=this.dragging):h.name==="END"?(h.position.copy(this.worldPosition),h.visible=this.dragging):h.name==="DELTA"?(h.position.copy(this.worldPositionStart),h.quaternion.copy(this.worldQuaternionStart),dm.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),dm.applyQuaternion(this.worldQuaternionStart.clone().invert()),h.scale.copy(dm),h.visible=this.dragging):(h.quaternion.copy(i),this.dragging?h.position.copy(this.worldPositionStart):h.position.copy(this.worldPosition),this.axis&&(h.visible=this.axis.search(h.name)!==-1)))}super.updateMatrixWorld(e)}}class dP extends d.Kj0{constructor(){super(new d._12(1e5,1e5,2,2),new d.vBJ({visible:!1,wireframe:!0,side:d.ehD,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let i=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(i="local"),j1.copy(qw).applyQuaternion(i==="local"?this.worldQuaternion:V0),zA.copy(G_).applyQuaternion(i==="local"?this.worldQuaternion:V0),Xw.copy(Yw).applyQuaternion(i==="local"?this.worldQuaternion:V0),Tl.copy(zA),this.mode){case"translate":case"scale":switch(this.axis){case"X":Tl.copy(this.eye).cross(j1),Cv.copy(j1).cross(Tl);break;case"Y":Tl.copy(this.eye).cross(zA),Cv.copy(zA).cross(Tl);break;case"Z":Tl.copy(this.eye).cross(Xw),Cv.copy(Xw).cross(Tl);break;case"XY":Cv.copy(Xw);break;case"YZ":Cv.copy(j1);break;case"XZ":Tl.copy(Xw),Cv.copy(zA);break;case"XYZ":case"E":Cv.set(0,0,0)}break;default:Cv.set(0,0,0)}Cv.length()===0?this.quaternion.copy(this.cameraQuaternion):(YS.lookAt(dm.set(0,0,0),Cv,Tl),this.quaternion.setFromRotationMatrix(YS)),super.updateMatrixWorld(e)}}const lT=new d.ZzF,z1=new d.Pa4;class cT extends d.L5s{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new d.a$l([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new d.a$l([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const i=this.attributes.instanceStart,s=this.attributes.instanceEnd;return i!==void 0&&(i.applyMatrix4(e),s.applyMatrix4(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let i;e instanceof Float32Array?i=e:Array.isArray(e)&&(i=new Float32Array(e));const s=new d.$TI(i,6,1);return this.setAttribute("instanceStart",new d.kB5(s,3,0)),this.setAttribute("instanceEnd",new d.kB5(s,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let i;e instanceof Float32Array?i=e:Array.isArray(e)&&(i=new Float32Array(e));const s=new d.$TI(i,6,1);return this.setAttribute("instanceColorStart",new d.kB5(s,3,0)),this.setAttribute("instanceColorEnd",new d.kB5(s,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new d.Uk6(e.geometry)),this}fromLineSegments(e){const i=e.geometry;return this.setPositions(i.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new d.ZzF);const e=this.attributes.instanceStart,i=this.attributes.instanceEnd;e!==void 0&&i!==void 0&&(this.boundingBox.setFromBufferAttribute(e),lT.setFromBufferAttribute(i),this.boundingBox.union(lT))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new d.aLr),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,i=this.attributes.instanceEnd;if(e!==void 0&&i!==void 0){const s=this.boundingSphere.center;this.boundingBox.getCenter(s);let a=0;for(let h=0,f=e.count;h<f;h++)z1.fromBufferAttribute(e,h),a=Math.max(a,s.distanceToSquared(z1)),z1.fromBufferAttribute(i,h),a=Math.max(a,s.distanceToSquared(z1));this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}class pP extends cT{constructor(e){super(),this.isWireframeGeometry2=!0,this.type="WireframeGeometry2",this.fromWireframeGeometry(new d.Uk6(e))}}d.rBU.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new d.FM8(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},d.Vj0.line={uniforms:d.rDY.merge([d.rBU.common,d.rBU.fog,d.rBU.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class uT extends d.jyz{constructor(e){super({type:"LineMaterial",uniforms:d.rDY.clone(d.Vj0.line.uniforms),vertexShader:d.Vj0.line.vertexShader,fragmentShader:d.Vj0.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(i){this.uniforms.diffuse.value=i}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(i){i===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(i){this.uniforms.linewidth.value=i}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(i){!!i!="USE_DASH"in this.defines&&(this.needsUpdate=!0),i===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(i){this.uniforms.dashScale.value=i}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(i){this.uniforms.dashSize.value=i}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(i){this.uniforms.dashOffset.value=i}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(i){this.uniforms.gapSize.value=i}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(i){this.uniforms.opacity.value=i}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(i){this.uniforms.resolution.value.copy(i)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(i){!!i!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),i===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}const hT=new d.Pa4,XS=new d.Pa4;class dT extends d.Kj0{constructor(e=new cT,i=new uT({color:16777215*Math.random()})){super(e,i),this.isWireframe=!0,this.type="Wireframe"}computeLineDistances(){const e=this.geometry,i=e.attributes.instanceStart,s=e.attributes.instanceEnd,a=new Float32Array(2*i.count);for(let f=0,k=0,et=i.count;f<et;f++,k+=2)hT.fromBufferAttribute(i,f),XS.fromBufferAttribute(s,f),a[k]=k===0?0:a[k-1],a[k+1]=a[k]+hT.distanceTo(XS);const h=new d.$TI(a,2,1);return e.setAttribute("instanceDistanceStart",new d.kB5(h,1,0)),e.setAttribute("instanceDistanceEnd",new d.kB5(h,1,1)),this}}class KS extends d.ZAu{constructor(){super(),this.assetType="widget",this.modelObject=this,this._object=null,this.boundingScaleMultiplier=1,this.position.set(0,0,0),this.visible=!1,this.renderOrder=1,this.userData.bboxVisible=!1,this._updater=this._updater.bind(this)}_updater(){const e=this._object;if(e){const i=new sr().expandByObject(e,!1);i.getCenter(this.position);const s=i.getBoundingSphere(new d.aLr).radius;this.scale.setScalar(s*this.boundingScaleMultiplier),this.setVisible(!0)}else this.setVisible(!1)}_initGeometry(e){if(this._geometry)return;const i=new pP(e);this._geometry=i;const s=new uT({color:"#ff2222",transparent:!0,opacity:.9,linewidth:5,resolution:new d.FM8(1024,1024),dashed:!1,toneMapped:!1}),a=new dT(i,s);a.computeLineDistances(),a.scale.set(1,1,1),a.visible=!0,this.add(a)}setVisible(e){var i;e!==this.visible&&(this.visible=e,(i=this.setDirty)===null||i===void 0||i.call(this,{sceneUpdate:!1}))}attach(e){return this.detach(),e?(this._object=e,this._object.addEventListener("objectUpdate",this._updater),this._updater(),this):this}detach(){var e;return this._object?((e=this._object)===null||e===void 0||e.removeEventListener("objectUpdate",this._updater),this._object=null,this._updater(),this):this}get object(){return this._object}}class $S extends KS{constructor(){super(),this.boundingScaleMultiplier=1/1.7,this._initGeometry(new d.DvJ(2,2,2,1,1,1))}_updater(){super._updater();const e=this.object;e&&(new sr().expandByObject(e,!1).getSize(this.scale).multiplyScalar(this.boundingScaleMultiplier).clampScalar(.1,100),this.setVisible(!0))}}var Kw=function(c){return function(e){return 1-c(1-e)}},V1=function(c){return function(e){return e<=.5?c(2*e)/2:(2-c(2*(1-e)))/2}},pT=function(c){return function(e){return Math.pow(e,c)}},Q1=function(c){return function(e){return e*e*((c+1)*e-c)}},fT=function(c){var e=Q1(c);return function(i){return(i*=2)<1?.5*e(i):.5*(2-Math.pow(2,-10*(i-1)))}},$w=function(c){return c},VA=pT(2),mT=Kw(VA),JS=V1(VA),ZS=function(c){return 1-Math.sin(Math.acos(c))},G1=Kw(ZS),eC=V1(G1),H_=Q1(1.525),gT=Kw(H_),H1=V1(H_),tC=fT(1.525),Jw=function(c){if(c===1||c===0)return c;var e=c*c;return c<.36363636363636365?7.5625*e:c<.7272727272727273?9.075*e-9.9*c+3.4:c<.9?12.066481994459833*e-19.63545706371191*c+8.898060941828255:10.8*c*c-20.52*c+10.72},vT=Kw(Jw),_T=function(c){return c<.5?.5*(1-Jw(1-2*c)):.5*Jw(2*c-1)+.5},ou=function(){return ou=Object.assign||function(c){for(var e,i=1,s=arguments.length;i<s;i++)for(var a in e=arguments[i])Object.prototype.hasOwnProperty.call(e,a)&&(c[a]=e[a]);return c},ou.apply(this,arguments)};function nC(c,e){var i={};for(var s in c)Object.prototype.hasOwnProperty.call(c,s)&&e.indexOf(s)<0&&(i[s]=c[s]);if(c!=null&&typeof Object.getOwnPropertySymbols=="function"){var a=0;for(s=Object.getOwnPropertySymbols(c);a<s.length;a++)e.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(c,s[a])&&(i[s[a]]=c[s[a]])}return i}var Q0=function(c,e,i){return Math.min(Math.max(i,c),e)};function QA(c,e){return c*Math.sqrt(1-e*e)}var yT=["duration","bounce"],W1=["stiffness","damping","mass"];function Cp(c,e){return e.some(function(i){return c[i]!==void 0})}function r_(c){var e=c.from,i=e===void 0?0:e,s=c.to,a=s===void 0?1:s,h=c.restSpeed,f=h===void 0?2:h,k=c.restDelta,et=nC(c,["from","to","restSpeed","restDelta"]),tt={done:!1,value:i},rt=function(Rt){var Bt=ou({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},Rt);if(!Cp(Rt,W1)&&Cp(Rt,yT)){var Qt=function(Wt){var tn,pn,yn=Wt.duration,En=yn===void 0?800:yn,wn=Wt.bounce,In=wn===void 0?.25:wn,xn=Wt.velocity,Cn=xn===void 0?0:xn,Fn=Wt.mass,Tn=Fn===void 0?1:Fn,Wn=1-In;Wn=Q0(.05,1,Wn),En=Q0(.01,10,En/1e3),Wn<1?(tn=function(rr){var Ir=rr*Wn,kr=Ir*En;return .001-(Ir-Cn)/QA(rr,Wn)*Math.exp(-kr)},pn=function(rr){var Ir=rr*Wn*En,kr=Ir*Cn+Cn,Br=Math.pow(Wn,2)*Math.pow(rr,2)*En,Ur=Math.exp(-Ir),hs=QA(Math.pow(rr,2),Wn);return(.001-tn(rr)>0?-1:1)*((kr-Br)*Ur)/hs}):(tn=function(rr){return Math.exp(-rr*En)*((rr-Cn)*En+1)-.001},pn=function(rr){return Math.exp(-rr*En)*(En*En*(Cn-rr))});var or=function(rr,Ir,kr){for(var Br=kr,Ur=1;Ur<12;Ur++)Br-=rr(Br)/Ir(Br);return Br}(tn,pn,5/En);if(En*=1e3,isNaN(or))return{stiffness:100,damping:10,duration:En};var fr=Math.pow(or,2)*Tn;return{stiffness:fr,damping:2*Wn*Math.sqrt(Tn*fr),duration:En}}(Rt);(Bt=ou(ou(ou({},Bt),Qt),{velocity:0,mass:1})).isResolvedFromDuration=!0}return Bt}(et),lt=rt.stiffness,pt=rt.damping,ft=rt.mass,vt=rt.velocity,yt=rt.duration,Mt=rt.isResolvedFromDuration,xt=q1,Et=q1;function At(){var Rt=vt?-vt/1e3:0,Bt=a-i,Qt=pt/(2*Math.sqrt(lt*ft)),Wt=Math.sqrt(lt/ft)/1e3;if(k!=null||(k=Math.abs(a-i)<=1?.01:.4),Qt<1){var tn=QA(Wt,Qt);xt=function(yn){var En=Math.exp(-Qt*Wt*yn);return a-En*((Rt+Qt*Wt*Bt)/tn*Math.sin(tn*yn)+Bt*Math.cos(tn*yn))},Et=function(yn){var En=Math.exp(-Qt*Wt*yn);return Qt*Wt*En*(Math.sin(tn*yn)*(Rt+Qt*Wt*Bt)/tn+Bt*Math.cos(tn*yn))-En*(Math.cos(tn*yn)*(Rt+Qt*Wt*Bt)-tn*Bt*Math.sin(tn*yn))}}else if(Qt===1)xt=function(yn){return a-Math.exp(-Wt*yn)*(Bt+(Rt+Wt*Bt)*yn)};else{var pn=Wt*Math.sqrt(Qt*Qt-1);xt=function(yn){var En=Math.exp(-Qt*Wt*yn),wn=Math.min(pn*yn,300);return a-En*((Rt+Qt*Wt*Bt)*Math.sinh(wn)+pn*Bt*Math.cosh(wn))/pn}}}return At(),{next:function(Rt){var Bt=xt(Rt);if(Mt)tt.done=Rt>=yt;else{var Qt=1e3*Et(Rt),Wt=Math.abs(Qt)<=f,tn=Math.abs(a-Bt)<=k;tt.done=Wt&&tn}return tt.value=tt.done?a:Bt,tt},flipTarget:function(){var Rt;vt=-vt,i=(Rt=[a,i])[0],a=Rt[1],At()}}}r_.needsInterpolation=function(c,e){return typeof c=="string"||typeof e=="string"};var q1=function(c){return 0},G0=function(c,e,i){var s=e-c;return s===0?1:(i-c)/s},W_=function(c,e,i){return-i*c+i*e+c},Uy=function(c,e){return function(i){return Math.max(Math.min(i,e),c)}},i_=function(c){return c%1?Number(c.toFixed(5)):c},q_=/(-)?([\d]*\.?[\d])+/g,jy=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))/gi,AT=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i;function H0(c){return typeof c=="string"}var W0={test:function(c){return typeof c=="number"},parse:parseFloat,transform:function(c){return c}},Zw=ou(ou({},W0),{transform:Uy(0,1)}),Y1=(ou(ou({},W0),{default:1}),function(c,e){return function(i){return!!(H0(i)&&AT.test(i)&&i.startsWith(c)||e&&Object.prototype.hasOwnProperty.call(i,e))}}),X1=function(c,e,i){return function(s){var a;if(!H0(s))return s;var h=s.match(q_),f=h[0],k=h[1],et=h[2],tt=h[3];return(a={})[c]=parseFloat(f),a[e]=parseFloat(k),a[i]=parseFloat(et),a.alpha=tt!==void 0?parseFloat(tt):1,a}},wT=Uy(0,255),K1=ou(ou({},W0),{transform:function(c){return Math.round(wT(c))}}),Y_={test:Y1("rgb","red"),parse:X1("red","green","blue"),transform:function(c){var e=c.red,i=c.green,s=c.blue,a=c.alpha,h=a===void 0?1:a;return"rgba("+K1.transform(e)+", "+K1.transform(i)+", "+K1.transform(s)+", "+i_(Zw.transform(h))+")"}},GA={test:Y1("#"),parse:function(c){var e="",i="",s="",a="";return c.length>5?(e=c.substr(1,2),i=c.substr(3,2),s=c.substr(5,2),a=c.substr(7,2)):(e=c.substr(1,1),i=c.substr(2,1),s=c.substr(3,1),a=c.substr(4,1),e+=e,i+=i,s+=s,a+=a),{red:parseInt(e,16),green:parseInt(i,16),blue:parseInt(s,16),alpha:a?parseInt(a,16)/255:1}},transform:Y_.transform},xT=function(c){return{test:function(e){return H0(e)&&e.endsWith(c)&&e.split(" ").length===1},parse:parseFloat,transform:function(e){return""+e+c}}},HA=xT("%"),zy=(ou(ou({},HA),{parse:function(c){return HA.parse(c)/100},transform:function(c){return HA.transform(100*c)}}),{test:Y1("hsl","hue"),parse:X1("hue","saturation","lightness"),transform:function(c){var e=c.hue,i=c.saturation,s=c.lightness,a=c.alpha,h=a===void 0?1:a;return"hsla("+Math.round(e)+", "+HA.transform(i_(i))+", "+HA.transform(i_(s))+", "+i_(Zw.transform(h))+")"}}),bT=function(c,e,i){var s=c*c,a=e*e;return Math.sqrt(Math.max(0,i*(a-s)+s))},ET=[GA,Y_,zy],ST=function(c){return ET.find(function(e){return e.test(c)})},$1=function(c,e){var i=ST(c),s=ST(e);i.transform,s.transform;var a=i.parse(c),h=s.parse(e),f=ou({},a),k=i===zy?W_:bT;return function(et){for(var tt in f)tt!=="alpha"&&(f[tt]=k(a[tt],h[tt],et));return f.alpha=W_(a.alpha,h.alpha,et),i.transform(f)}},rC=function(c){return Y_.test(c)||GA.test(c)||zy.test(c)},iC=function(c){return Y_.test(c)?Y_.parse(c):zy.test(c)?zy.parse(c):GA.parse(c)},WA=function(c){return H0(c)?c:c.hasOwnProperty("red")?Y_.transform(c):zy.transform(c)},sC="${c}",CT="${n}";function ex(c){var e=[],i=0,s=c.match(jy);s&&(i=s.length,c=c.replace(jy,sC),e.push.apply(e,s.map(iC)));var a=c.match(q_);return a&&(c=c.replace(q_,CT),e.push.apply(e,a.map(W0.parse))),{values:e,numColors:i,tokenised:c}}function Vy(c){return ex(c).values}function oC(c){var e=ex(c),i=e.values,s=e.numColors,a=e.tokenised,h=i.length;return function(f){for(var k=a,et=0;et<h;et++)k=k.replace(et<s?sC:CT,et<s?WA(f[et]):i_(f[et]));return k}}var MT=function(c){return typeof c=="number"?0:c},tx={test:function(c){var e,i,s,a;return isNaN(c)&&H0(c)&&((i=(e=c.match(q_))===null||e===void 0?void 0:e.length)!==null&&i!==void 0?i:0)+((a=(s=c.match(jy))===null||s===void 0?void 0:s.length)!==null&&a!==void 0?a:0)>0},parse:Vy,createTransformer:oC,getAnimatableNone:function(c){var e=Vy(c);return oC(c)(e.map(MT))}},nx={x:0,y:0,z:0},J1=function(c){return typeof c=="number"},Np=function(c,e){return function(i){return e(c(i))}},Z1=function(){for(var c=[],e=0;e<arguments.length;e++)c[e]=arguments[e];return c.reduce(Np)};function aC(c,e){return J1(c)?function(i){return W_(c,e,i)}:rC(c)?$1(c,e):s_(c,e)}var lC=function(c,e){var i=function(h,f){for(var k=0,et=f.length,tt=h.length;k<et;k++,tt++)h[tt]=f[k];return h}([],c),s=i.length,a=c.map(function(h,f){return aC(h,e[f])});return function(h){for(var f=0;f<s;f++)i[f]=a[f](h);return i}},cC=function(c,e){var i=ou(ou({},c),e),s={};for(var a in i)c[a]!==void 0&&e[a]!==void 0&&(s[a]=aC(c[a],e[a]));return function(h){for(var f in s)i[f]=s[f](h);return i}};function rx(c){for(var e=tx.parse(c),i=e.length,s=0,a=0,h=0,f=0;f<i;f++)s||typeof e[f]=="number"?s++:e[f].hue!==void 0?h++:a++;return{parsed:e,numNumbers:s,numRGB:a,numHSL:h}}var s_=function(c,e){var i=tx.createTransformer(e),s=rx(c),a=rx(e);return Z1(lC(s.parsed,a.parsed),i)},TT=function(c,e){return function(i){return W_(c,e,i)}};function eE(c,e,i){var s=i===void 0?{}:i,a=s.clamp,h=a===void 0||a,f=s.ease,k=s.mixer,et=c.length;e.length,!f||!Array.isArray(f)||f.length,c[0]>c[et-1]&&(c=[].concat(c),e=[].concat(e),c.reverse(),e.reverse());var tt=function(lt,pt,ft){for(var vt=[],yt=ft||(typeof(Rt=lt[0])=="number"?TT:typeof Rt=="string"?rC(Rt)?$1:s_:Array.isArray(Rt)?lC:typeof Rt=="object"?cC:void 0),Mt=lt.length-1,xt=0;xt<Mt;xt++){var Et=yt(lt[xt],lt[xt+1]);if(pt){var At=Array.isArray(pt)?pt[xt]:pt;Et=Z1(At,Et)}vt.push(Et)}var Rt;return vt}(e,f,k),rt=et===2?function(lt,pt){var ft=lt[0],vt=lt[1],yt=pt[0];return function(Mt){return yt(G0(ft,vt,Mt))}}(c,tt):function(lt,pt){var ft=lt.length,vt=ft-1;return function(yt){var Mt=0,xt=!1;if(yt<=lt[0]?xt=!0:yt>=lt[vt]&&(Mt=vt-1,xt=!0),!xt){for(var Et=1;Et<ft&&!(lt[Et]>yt||Et===vt);Et++);Mt=Et-1}var At=G0(lt[Mt],lt[Mt+1],yt);return pt[Mt](At)}}(c,tt);return h?function(lt){return rt(Q0(c[0],c[et-1],lt))}:rt}function o_(c,e){return c.map(function(){return e||JS}).splice(0,c.length-1)}function qA(c){var e=c.from,i=e===void 0?0:e,s=c.to,a=s===void 0?1:s,h=c.ease,f=c.offset,k=c.duration,et=k===void 0?300:k,tt={done:!1,value:i},rt=Array.isArray(a)?a:[i,a],lt=function(vt,yt){return vt.map(function(Mt){return Mt*yt})}(f&&f.length===rt.length?f:function(vt){var yt=vt.length;return vt.map(function(Mt,xt){return xt!==0?xt/(yt-1):0})}(rt),et);function pt(){return eE(lt,rt,{ease:Array.isArray(h)?h:o_(rt,h)})}var ft=pt();return{next:function(vt){return tt.value=ft(vt),tt.done=vt>=et,tt},flipTarget:function(){rt.reverse(),ft=pt()}}}function tE(c){var e=c.velocity,i=e===void 0?0:e,s=c.from,a=s===void 0?0:s,h=c.power,f=h===void 0?.8:h,k=c.timeConstant,et=k===void 0?350:k,tt=c.restDelta,rt=tt===void 0?.5:tt,lt=c.modifyTarget,pt={done:!1,value:a},ft=f*i,vt=a+ft,yt=lt===void 0?vt:lt(vt);return yt!==vt&&(ft=yt-a),{next:function(Mt){var xt=-ft*Math.exp(-Mt/et);return pt.done=!(xt>rt||xt<-rt),pt.value=pt.done?yt:yt+xt,pt},flipTarget:function(){}}}var uC={keyframes:qA,spring:r_,decay:tE},nE=1/60*1e3,rE=typeof performance<"u"?function(){return performance.now()}:function(){return Date.now()},ix=typeof window<"u"?function(c){return window.requestAnimationFrame(c)}:function(c){return setTimeout(function(){return c(rE())},nE)},iE=!0,YA=!1,hC=!1,sx={delta:0,timestamp:0},ox=["read","update","preRender","render","postRender"],dC=ox.reduce(function(c,e){return c[e]=function(i){var s=[],a=[],h=0,f=!1,k=new WeakSet,et={schedule:function(tt,rt,lt){rt===void 0&&(rt=!1),lt===void 0&&(lt=!1);var pt=lt&&f,ft=pt?s:a;return rt&&k.add(tt),ft.indexOf(tt)===-1&&(ft.push(tt),pt&&f&&(h=s.length)),tt},cancel:function(tt){var rt=a.indexOf(tt);rt!==-1&&a.splice(rt,1),k.delete(tt)},process:function(tt){var rt;if(f=!0,s=(rt=[a,s])[0],(a=rt[1]).length=0,h=s.length)for(var lt=0;lt<h;lt++){var pt=s[lt];pt(tt),k.has(pt)&&(et.schedule(pt),i())}f=!1}};return et}(function(){return YA=!0}),c},{}),Mv=ox.reduce(function(c,e){var i=dC[e];return c[e]=function(s,a,h){return a===void 0&&(a=!1),h===void 0&&(h=!1),YA||aE(),i.schedule(s,a,h)},c},{}),sE=ox.reduce(function(c,e){return c[e]=dC[e].cancel,c},{}),IT=function(c){return dC[c].process(sx)},oE=function(c){YA=!1,sx.delta=iE?nE:Math.max(Math.min(c-sx.timestamp,40),1),sx.timestamp=c,hC=!0,ox.forEach(IT),hC=!1,YA&&(iE=!1,ix(oE))},aE=function(){YA=!0,iE=!0,hC||ix(oE)},lE=function(){return sx},pC=Mv;function cE(c,e,i){return i===void 0&&(i=0),c-e-i}var PT=function(c){var e=function(i){var s=i.delta;return c(s)};return{start:function(){return pC.update(e,!0)},stop:function(){return sE.update(e)}}};function XA(c){var e,i,s,a,h,f=c.from,k=c.autoplay,et=k===void 0||k,tt=c.driver,rt=tt===void 0?PT:tt,lt=c.elapsed,pt=lt===void 0?0:lt,ft=c.repeat,vt=ft===void 0?0:ft,yt=c.repeatType,Mt=yt===void 0?"loop":yt,xt=c.repeatDelay,Et=xt===void 0?0:xt,At=c.onPlay,Rt=c.onStop,Bt=c.onComplete,Qt=c.onRepeat,Wt=c.onUpdate,tn=nC(c,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]),pn=tn.to,yn=0,En=tn.duration,wn=!1,In=!0,xn=function(Fn){if(Array.isArray(Fn.to))return qA;if(uC[Fn.type])return uC[Fn.type];var Tn=new Set(Object.keys(Fn));return Tn.has("ease")||Tn.has("duration")&&!Tn.has("dampingRatio")?qA:Tn.has("dampingRatio")||Tn.has("stiffness")||Tn.has("mass")||Tn.has("damping")||Tn.has("restSpeed")||Tn.has("restDelta")?r_:qA}(tn);!((i=(e=xn).needsInterpolation)===null||i===void 0)&&i.call(e,f,pn)&&(h=eE([0,100],[f,pn],{clamp:!1}),f=0,pn=100);var Cn=xn(ou(ou({},tn),{from:f,to:pn}));return et&&(At==null||At(),(s=rt(function(Fn){if(In||(Fn=-Fn),pt+=Fn,!wn){var Tn=Cn.next(Math.max(0,pt));a=Tn.value,h&&(a=h(a)),wn=In?Tn.done:pt<=0}Wt==null||Wt(a),wn&&(yn===0&&(En!=null||(En=pt)),yn<vt?function(Wn,or,fr,rr){return rr?Wn>=or+fr:Wn<=-fr}(pt,En,Et,In)&&(yn++,Mt==="reverse"?pt=function(Wn,or,fr,rr){return fr===void 0&&(fr=0),rr===void 0&&(rr=!0),rr?cE(or+-Wn,or,fr):or-(Wn-or)+fr}(pt,En,Et,In=yn%2==0):(pt=cE(pt,En,Et),Mt==="mirror"&&Cn.flipTarget()),wn=!1,Qt&&Qt()):(s.stop(),Bt&&Bt()))})).start()),{stop:function(){Rt==null||Rt(),s.stop()}}}const Qy={linear:$w,easeIn:VA,easeOut:mT,easeInOut:JS,circIn:ZS,circOut:G1,circInOut:eC,backIn:H_,backOut:gT,backInOut:H1,anticipate:tC,bounceOut:Jw,bounceIn:vT,bounceInOut:_T,easeInOutSine:function(c){return-(Math.cos(Math.PI*c)-1)/2}};async function au(c){return new Promise(e=>setTimeout(e,Math.max(0,c)))}function ax(c,e,i){const s=c[e],a=()=>{typeof(c==null?void 0:c.setDirty)=="function"&&c.setDirty(),i==null||i()};return s.isVector3||s.isVector2||s.isVector4?h=>{s.copy(h),a()}:h=>{c[e]=h,a()}}function fC(c){return typeof c!="boolean"}async function lx(c,e,i){e in c||console.error("invalid key",e,c);const s=ax(c,e),a=c[e],h=f=>{var k;s(f),(k=i.onUpdate)===null||k===void 0||k.call(i,f)};if(fC(a))return typeof i.to=="function"&&(i={...i,to:i.to(a,c)}),mC({...i,from:a,onUpdate:h});{const{duration:f}=i;return au(f??0).then(()=>h(i.to))}}async function mC(c){return new Promise((e,i)=>{XA({onComplete:()=>{var s;(s=c.onComplete)===null||s===void 0||s.call(c),e()},onStop:()=>{var s;(s=c.onStop)===null||s===void 0||s.call(c),e()},...c})})}class X_ extends wv{constructor(){super(),this.passId="frameFade",this._fadeTime=0,this._fadeTimeState=0,this._toSaveFrame=!1,this._beforeFilters=["progressive","taa"],this._afterFilters=["render"],this._requiredFilters=["render","progressive"],this.dependencies=[dp],this.fadeOnActiveCameraChange=!0,this.fadeOnMaterialUpdate=!0,this.fadeOnSceneUpdate=!0,this.pointerEnabled=!0,this._fadeCam=e=>e.frameFade!==!1&&this.fadeOnActiveCameraChange&&this.startTransition(1e3),this._fadeMat=e=>{e.frameFade!==!1&&this.fadeOnMaterialUpdate&&this.startTransition(200)},this._fadeScene=e=>{e.frameFade!==!1&&this.fadeOnSceneUpdate&&this.startTransition(500)},this._onPointerMove=e=>{var i;const s=(i=this._viewer)===null||i===void 0?void 0:i.canvas;if(!s)return void(this.pointerEnabled=!1);if(!e.buttons||e.target!==s)return void(this.pointerEnabled=!0);const a=s.getBoundingClientRect(),h=(e.clientX-a.left)/a.width,f=(e.clientY-a.top)/a.height;this.pointerEnabled=h<0||h>1||f<0||f>1},this._disabledBy=[],this.startTransition=this.startTransition.bind(this),this.stopTransition=this.stopTransition.bind(this),this._fadeCam=this._fadeCam.bind(this),this._fadeMat=this._fadeMat.bind(this)}async startTransition(e){this._viewer&&this._pass&&!this.isDisabled()&&(this._target||(this._target=this._viewer.renderer.getTempTarget({sizeMultiplier:1,minFilter:d.wem,magFilter:d.wem,encoding:this._viewer.renderer.composerTarget.texture.encoding})),this._fadeTimeState=Math.max(e,this._fadeTimeState),this._fadeTime=this._fadeTimeState,this._toSaveFrame=!0,this.setDirty(),await au(e))}stopTransition(){this._fadeTimeState=0}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._fadeCam),e.scene.addEventListener("activeCameraUpdate",this.stopTransition),e.scene.addEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.addEventListener("sceneUpdate",this._fadeScene),window.addEventListener("pointermove",this._onPointerMove)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._fadeCam),e.scene.removeEventListener("activeCameraUpdate",this.stopTransition),e.scene.removeEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.removeEventListener("sceneUpdate",this._fadeScene),window.removeEventListener("pointermove",this._onPointerMove),super.onRemove(e)}passCtor(e){const i=this,s=e.getPlugin(dp),a=new class extends zS{constructor(){super(...arguments),this._lastTime=0,this.uiConfig=Yp("Frame Fade",this)}render(h,f,k,et,tt){this.needsSwap=!1;const rt=i._target;if(!rt||!i.pointerEnabled||!this.enabled||!i.dirty||i._fadeTimeState<.001)return;i._toSaveFrame&&s.lastFrame&&(e.renderer.blit(s.lastFrame.texture,rt),this._lastTime=0,i._toSaveFrame=!1),this.blendTexture=rt==null?void 0:rt.texture;const lt=i._fadeTimeState/i._fadeTime;this.weights2.setScalar(lt),this.weights2.w=1,this.weights1.setScalar(1-lt),this.weights1.w=1,super.render(h,f,k,et,tt),this.needsSwap=!0;const pt=mo();this._lastTime<10&&(this._lastTime=pt-10);const ft=pt-this._lastTime;this._lastTime=pt,i._fadeTimeState-=ft}};return a.enabled=!0,a}setDirty(){var e;this.enabled&&((e=this._viewer)===null||e===void 0||e.setDirty())}get dirty(){return this.enabled&&this._fadeTimeState>0}set dirty(e){console.warn("FrameFadePlugin.dirty is readonly")}_update(e){return!!super._update(e)&&(this.isDisabled()&&this.stopTransition(),this._fadeTimeState<.001&&(this._toSaveFrame=!1,this._target&&this._viewer&&(this._viewer.renderer.releaseTempTarget(this._target),this._target=void 0)),!0)}get uiConfig(){var e,i;return(i=(e=this.pass)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.uiConfig}disable(e){this._disabledBy.includes(e)||this._disabledBy.push(e)}enable(e){const i=this._disabledBy.indexOf(e);i>=0&&this._disabledBy.splice(i,1)}isDisabled(){return!this.pointerEnabled||this._disabledBy.length>0||!this.enabled}}X_.PluginType="FrameFade";var uE=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f},gC=d.M8C.degToRad;class Uo extends Js{constructor(e=$S,i=!1,s=!0,a=!1){super(),this.enabled=!0,this.autoFocus=!1,this._onObjectHit=h=>{this._viewer&&(this.enabled?this.dispatchEvent(h):h.intersects.selectedObject=null)},this._uiConfigChildren=[{label:"AutoFocus",type:"checkbox",property:[this,"autoFocus"],onChange:()=>{const h=this.getSelectedObject();this.autoFocus&&h&&this.setSelectedObject(h,!0)}}],e&&(this._widget=new e),this._controls=i,this._pickUi=s,this.autoFocus=a}get picker(){return this._picker}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}getSelectedObject(){var e;if(this.enabled)return((e=this._picker)===null||e===void 0?void 0:e.selectedObject)||void 0}setSelectedObject(e,i=!1){if(!this.enabled||!this._picker)return;const s=this.autoFocus;this.autoFocus=!1,this._picker.selectedObject=e||null,this.autoFocus=s,(s||i)&&this.focusObject(e)}async onAdded(e){await super.onAdded(e),this._picker=new JM(e.scene,e.canvas,void 0,i=>{var s,a;if(!i.material)return!1;let h=i,f=!1;for(;h;){if(!h.visible||(((s=h.userData.iModel)!==null&&s!==void 0?s:h).assetType==="model"&&(f=!0),((a=h.userData.iModel)!==null&&a!==void 0?a:h).assetType==="widget")||h.userData.userSelectable===!1||h.userData.bboxVisible===!1)return!1;h=h.parent}return f}),this._widget&&e.scene.addWidget(this._widget),this._transformControls=new vC(e),this._transformControls.enabled=this._controls,this._picker.addEventListener("selectedObjectChanged",i=>{var s,a,h,f;this.dispatchEvent(i);const k=((s=this._picker)===null||s===void 0?void 0:s.selectedObject)||void 0;if(this._pickUi){const rt=(a=k)===null||a===void 0?void 0:a.uiConfig,lt=this.uiConfig;lt.children=[...this._uiConfigChildren],rt&&lt.children.push(rt),(h=lt.uiRefresh)===null||h===void 0||h.call(lt)}const et=this._widget;et&&(k?et.attach(k):et.detach());const tt=this._transformControls;tt&&(!((f=this._viewer)===null||f===void 0)&&f.scene.activeCamera.controls)&&(k&&tt.enabled?tt.attach(k):tt.detach()),e.setDirty(),this.autoFocus&&this.focusObject(k)}),this._picker.addEventListener("hoverObjectChanged",this.dispatchEvent),this._picker.addEventListener("hitObject",this._onObjectHit),e.scene.addEventListener("select",i=>{i.value?this.setSelectedObject(i.value,this.autoFocus||i.focusCamera):console.warn("e.value must be set for picking")}),e.scene.addEventListener("addSceneObject",async i=>{var s,a,h;const f=i.object,k=this.getSelectedObject();if(k&&(f==null?void 0:f.assetType)==="material"&&typeof(k==null?void 0:k.setMaterial)=="function"&&(!((s=k==null?void 0:k.modelObject)===null||s===void 0)&&s.isMesh)&&await e.confirm("Applying material: Apply material to the selected object?")){const et=k.material;if(Array.isArray(et))console.warn("Dropping on material array not yet fully supported."),k.setMaterial(f);else{let tt=Array.from((a=et==null?void 0:et.userData.__appliedMeshes)!==null&&a!==void 0?a:[]);(tt.length>1?!await e.confirm("Applying material: Apply to all objects using this material?"):tt.length<1)&&(tt=[k]);for(const rt of tt)rt&&((h=rt.setMaterial)===null||h===void 0||h.call(rt,f))}}}),e.scene.addEventListener("sceneUpdate",i=>{if(!i.hierarchyChanged)return;const s=this.getSelectedObject();let a=!1;s==null||s.traverseAncestors(h=>{h===e.scene.modelObject&&(a=!0)}),a||this.setSelectedObject(void 0)})}async focusObject(e){var i,s,a,h;const f=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("CameraViews");await(f==null?void 0:f.animateToObject(e,4,1e3,"easeOut",{min:((h=(a=(s=this._viewer)===null||s===void 0?void 0:s.scene.activeCamera.getControls())===null||a===void 0?void 0:a.minDistance)!==null&&h!==void 0?h:.5)+.5,max:5}))}get uiConfig(){return this._pickUi?this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Picker",expanded:!0,children:[...this._uiConfigChildren]}:{}}get transformControls(){return this._transformControls}get widget(){return this._widget}}Uo.PluginType="Picking",uE([jn(),Jr()],Uo.prototype,"enabled",void 0),uE([jn()],Uo.prototype,"autoFocus",void 0);class vC extends uP{constructor(e){super(e.scene.activeCamera.cameraObject,e.canvas),this.modelObject=this,this.assetType="widget",this._activeCameraChange=this._activeCameraChange.bind(this),this._scene=e.scene,this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.visible=!1,this.userData.bboxVisible=!1,this.addEventListener("objectChange",()=>{var i;(i=this==null?void 0:this.object)===null||i===void 0||i.dispatchEvent({type:"objectUpdate",fadeFrame:!1})}),this.addEventListener("dragging-changed",i=>{const s=e==null?void 0:e.getPlugin(X_);s&&(s.enabled=!i.value),this._scene.activeCamera.interactionsEnabled=!i.value}),this._keyDownListener=this._keyDownListener.bind(this),window.addEventListener("keydown",this._keyDownListener),window.addEventListener("keyup",this._keyUpListener),this._scene.addWidget(this)}_keyDownListener(e){if(this.enabled&&this.object){switch(e.keyCode){case 81:this.setSpace(this.space==="local"?"world":"local");break;case 16:this.setTranslationSnap(100),this.setRotationSnap(gC(15)),this.setScaleSnap(.25);break;case 87:this.setMode("translate");break;case 69:this.setMode("rotate");break;case 82:this.setMode("scale");break;case 187:case 107:this.setSize(this.size+.1);break;case 189:case 109:this.setSize(Math.max(this.size-.1,.1));break;case 88:this.showX=!this.showX;break;case 89:this.showY=!this.showY;break;case 90:this.showZ=!this.showZ;break;case 32:this.enabled=!this.enabled;break;default:return}this._scene.setDirty({sceneUpdate:!0,frameFade:!0})}}_keyUpListener(e){this.enabled&&(e.keyCode===16&&(this.setTranslationSnap(null),this.setRotationSnap(null),this.setScaleSnap(null)),this.object&&e.keyCode)}_activeCameraChange(){this.camera=this._scene.activeCamera.cameraObject}dispose(){window.removeEventListener("keydown",this._keyDownListener),window.removeEventListener("keyup",this._keyUpListener),this._scene.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene.modelObject.remove(this),super.dispose()}}var KA=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};class Xl extends Js{constructor(){super(),this.offsetCache={},this.enabled=!0,this.envMap=null,this.forceSceneEnvMap=!1,this.getEnvMap=()=>{var e;return!this.forceSceneEnvMap&&this.envMap?this.envMap:((e=this._viewer)===null||e===void 0?void 0:e.scene.getEnvironment())||null},this._modelProcessor={forAssetType:"model",processAsync:async(e,i)=>{const s=[];return e.modelObject.traverse(a=>{var h,f,k,et;const tt=(f=(h=a.userData)===null||h===void 0?void 0:h.gltfExtensions)===null||f===void 0?void 0:f[Xl.DIAMOND_GLTF_EXTENSION];tt&&a.geometry&&(this.prepareDiamondMesh(a,tt),delete a.userData.gltfExtensions[Xl.DIAMOND_GLTF_EXTENSION]),a.material&&!s.includes(a.material)&&(!((et=(k=a.material.userData)===null||k===void 0?void 0:k.gltfExtensions)===null||et===void 0)&&et[Xl.DIAMOND_GLTF_EXTENSION])&&(a.material.materialObject||console.warn("material not processed",a.material),s.push(a.material))}),s.forEach(a=>{const h=a.userData.gltfExtensions[Xl.DIAMOND_GLTF_EXTENSION];h&&this._convertToDiamondMaterial(a,h)}),e}},this.uiConfig={type:"folder",label:"Diamonds",children:[{type:"toggle",label:"Use Scene Environment",property:[this,"forceSceneEnvironment"],limitedUi:!0},{type:"image",label:"Environment",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap"],limitedUi:!0},{type:"slider",bounds:[0,2*Math.PI],hidden:()=>this.forceSceneEnvMap,label:"Env Rotation",property:[this,"envMapRotation"],limitedUi:!0},{type:"button",label:"Make Diamond",hidden:()=>{var e,i,s;const a=(s=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(Uo))===null||i===void 0?void 0:i.getSelectedObject())===null||s===void 0?void 0:s.material;return!!Array.isArray(a)||(a==null?void 0:a.typeSlug)!==$u.TypeSlug},value:async()=>{var e,i,s,a,h,f;const k=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(Uo))===null||i===void 0?void 0:i.getSelectedObject();if(!(k!=null&&k.material))return;const et=await((s=this._viewer)===null||s===void 0?void 0:s.prompt("Cache key: Enter optional cache key unique to the diamond shape.","",!1));let tt=parseInt(await((a=this._viewer)===null||a===void 0?void 0:a.prompt("Cache size: Enter size of the cache [64-1024]","512",!1))||"512");isFinite(tt)||(tt=512),tt<64&&(tt=64),((h=k.material.userData)===null||h===void 0?void 0:h.__appliedMeshes.size)>1&&await((f=this._viewer)===null||f===void 0?void 0:f.confirm("Convert all: Apply diamond material to all the meshes with the same material?"))?this.makeDiamond(k.material,{cacheKey:et||void 0,normalMapRes:tt},{}):this.makeDiamondMesh(k,{cacheKey:et||void 0,normalMapRes:tt},{}),this.refreshUi()},limitedUi:!0},{type:"button",label:"Make Standard",hidden:()=>{var e,i,s;const a=(s=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(Uo))===null||i===void 0?void 0:i.getSelectedObject())===null||s===void 0?void 0:s.material;return!!Array.isArray(a)||(a==null?void 0:a.typeSlug)!==Ml.TypeSlug},value:async()=>{var e,i,s,a,h,f,k,et;const tt=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(Uo))===null||i===void 0?void 0:i.getSelectedObject(),rt=tt==null?void 0:tt.material;if(!rt)return;const lt=rt.userData._baseMaterial;let pt=(h=(a=(s=this._viewer)===null||s===void 0?void 0:s.getManager())===null||a===void 0?void 0:a.materials)===null||h===void 0?void 0:h.findMaterial(lt);if(pt&&!pt.isDiamondMaterial||(pt=(f=this._viewer)===null||f===void 0?void 0:f.createPhysicalMaterial({color:rt.color})),pt){const ft=rt.userData.__appliedMeshes.size>1&&await((k=this._viewer)===null||k===void 0?void 0:k.confirm("Convert all with this material?"))?Array.from(rt.userData.__appliedMeshes):[tt];for(const vt of ft)(et=vt==null?void 0:vt.setMaterial)===null||et===void 0||et.call(vt,pt)}this.refreshUi()},limitedUi:!0}]},this.refreshEnvMaps=this.refreshEnvMaps.bind(this),this.refreshUi=this.refreshUi.bind(this)}get envMapRotation(){var e,i;return(i=(e=this.envMap)===null||e===void 0?void 0:e.rotation)!==null&&i!==void 0?i:0}set envMapRotation(e){var i;const s=this.envMap;s&&(s.rotation=e,(i=this._viewer)===null||i===void 0||i.scene.setDirty())}refreshEnvMaps(){var e,i,s;if(!this._viewer)return;const a=this.getEnvMap(),h=((i=(e=this._viewer.getPlugin(Kr))===null||e===void 0?void 0:e.materials)===null||i===void 0?void 0:i.getMaterialsOfType(Ml.TypeSlug))||[];for(const f of h)f&&f.envMap!==a&&(f.envMap=a,f.needsUpdate=!0);(s=this._viewer)===null||s===void 0||s.scene.setDirty()}refreshUi(){var e,i,s;(e=this._viewer)===null||e===void 0||e.setDirty(),(s=(i=this.uiConfig)===null||i===void 0?void 0:i.uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)}async onAdded(e){var i,s,a,h,f,k;this._normalCapture=new qM(e.renderer),this.offsetCache={},e.scene.addEventListener("environmentChanged",this.refreshEnvMaps);const et=e.getPlugin(Kr);(i=et==null?void 0:et.importer)===null||i===void 0||i.processors.add("model",this._modelProcessor),(s=e.getPlugin(Uo))===null||s===void 0||s.addEventListener("selectedObjectChanged",this.refreshUi);const tt=this.getEnvMap,rt=new zl(class extends AA{async loadAsync(lt,pt){var ft;const vt=await super.loadAsync(lt,pt);return vt.type===Ml.TYPE||vt.isDiamondMaterialParameters?(vt.envMap=tt(),(ft=et==null?void 0:et.materials)===null||ft===void 0?void 0:ft.generateFromTemplate("diamond",vt)):(console.error("Invalid material type for Diamond Material.",vt),null)}},[Ml.TypeSlug],!1);return uo.Importers.push(rt),(f=(h=(a=et==null?void 0:et.exporter)===null||a===void 0?void 0:a.getExporter("gltf","glb"))===null||h===void 0?void 0:h.extensions)===null||f===void 0||f.push(cx),(k=et==null?void 0:et.materials)===null||k===void 0||k.registerMaterialTemplate({name:"diamond",materialType:Ml.TYPE,isDiamondMaterialParameters:!0,generator:(lt,pt)=>{const ft=new Ml(lt);return ft.envMap=tt(),pt&&pt!=={}&&ft.copyProps(pt),ft}}),super.onAdded(e)}async onRemove(e){var i,s,a,h;return(i=this._normalCapture)===null||i===void 0||i.dispose(),this._normalCapture=void 0,this.offsetCache={},(a=(s=e.getPlugin(Kr))===null||s===void 0?void 0:s.importer)===null||a===void 0||a.processors.remove("model",this._modelProcessor),(h=e.getPlugin(Uo))===null||h===void 0||h.removeEventListener("selectedObjectChanged",this.refreshUi),super.onRemove(e)}prepareDiamondMesh(e,{cacheKey:i,normalMapRes:s}){var a,h,f;e.userData._diamondCacheKey=i??e.userData._diamondCacheKey,e.userData._diamondNormalMapRes=s??e.userData._diamondNormalMapRes,i=i&&i.length>0?i.includes(";"+e.geometry.uuid)?i:i+";"+e.geometry.uuid:e.geometry.uuid,this._computeOffsets(e.geometry,e.geometry.uuid);const k=(h=(a=this._normalCapture)===null||a===void 0?void 0:a.captureNormalMap(e.geometry,i,s))!==null&&h!==void 0?h:[void 0,!1],et=(f=this._viewer)===null||f===void 0?void 0:f.getPluginByType("debug");et&&k&&(et.counters.normalsCapture||(et.counters.normalsCapture=0),et.counters.normalsCapture++,console.log("DEBUG: new normal map captured",et.counters.normalsCapture,i),et.addTexture("normal"+et.counters.normalsCapture,()=>{var tt;return(tt=e.geometry.userData._normalsCaptureMap)===null||tt===void 0?void 0:tt.texture},[40,110*et.counters.normalsCapture-100,200,100],void 0,void 0,"postRender",!0))}makeDiamond(e,i,s){var a,h;Array.from((a=e==null?void 0:e.userData.__appliedMeshes)!==null&&a!==void 0?a:[]).forEach(f=>{f!=null&&f.isMesh&&f.geometry&&this.prepareDiamondMesh(f,i)}),this._convertToDiamondMaterial(e,s),(h=this._viewer)===null||h===void 0||h.setDirty()}makeDiamondMesh(e,i,s){if(!e.modelObject.isMesh||!e.geometry||!e.setMaterial)return;this.prepareDiamondMesh(e.modelObject,i);const a=Array.isArray(e.material)?e.material[0]:e.material,h=this._convertToDiamondMaterial(a,s,!1);e.setMaterial(h)}_convertToDiamondMaterial(e,i={isDiamond:!0},s=!0){var a,h,f,k,et,tt,rt;let lt={...i??{}};lt.isDiamond||lt.isDiamondMaterialParameters?Array.isArray(lt.boostFactors)&&(lt.boostFactors=new d.Pa4().fromArray(lt.boostFactors)):lt={isDiamondMaterialParameters:!0},lt.color=(f=(a=lt.color)!==null&&a!==void 0?a:(h=e==null?void 0:e.materialObject)===null||h===void 0?void 0:h.color)!==null&&f!==void 0?f:new oo(1,1,1);const pt=(tt=(et=(k=this._viewer)===null||k===void 0?void 0:k.getManager())===null||et===void 0?void 0:et.materials)===null||tt===void 0?void 0:tt.generateFromTemplate("diamond",lt);if(pt&&e&&!e.isDiamondMaterial&&(pt.userData._baseMaterial=e.uuid),s){const ft=vt=>{var yt;return(yt=vt.setMaterial)!==null&&yt!==void 0?yt:Mt=>{vt.material=Mt.materialObject}};Array.from((rt=e==null?void 0:e.userData.__appliedMeshes)!==null&&rt!==void 0?rt:[]).forEach(vt=>{ft(vt)(pt),this.prepareDiamondMesh(vt,i)})}return pt}_computeOffsets(e,i,s=!1){const a=i.split(";").find(tt=>this.offsetCache[tt]);if(a&&!s){const tt=this.offsetCache[a];return i.split(";").forEach(rt=>rt!==a&&(this.offsetCache[rt]=tt)),e.userData._normalsCaptureOffsets=tt,tt}e.computeBoundingBox();const h=e.boundingBox.getCenter(new d.Pa4),f=KM(e),k=f.clone().invert(),et={center:h,offsetMatrix:f,offsetMatrixInv:k,radius:1,centerOffset:new d.Pa4().copy(h).applyMatrix4(k)};return i.split(";").forEach(tt=>this.offsetCache[tt]=et),e.userData._normalsCaptureOffsets=et,et}}Xl.PluginType="Diamond",Xl.DIAMOND_GLTF_EXTENSION="WEBGI_materials_diamond",KA([hn(Xl.prototype.refreshEnvMaps),jn()],Xl.prototype,"envMap",void 0),KA([hn(Xl.prototype.refreshEnvMaps),jn()],Xl.prototype,"forceSceneEnvMap",void 0);const cx=c=>({writeMaterial:(e,i)=>{e.isDiamondMaterial&&(i.extensions=i.extensions||{},i.extensions[Xl.DIAMOND_GLTF_EXTENSION]=e.toJSON(),c.extensionsUsed[Xl.DIAMOND_GLTF_EXTENSION]=!0)},writeMesh:(e,i)=>{var s,a;if(!(e!=null&&e.material.isDiamondMaterial))return;i.extensions=i.extensions||{};const h={};(a=(s=e.userData)===null||s===void 0?void 0:s.gltfExtensions)===null||a===void 0||delete a[Xl.DIAMOND_GLTF_EXTENSION],e.userData._diamondNormalMapRes&&(h.normalMapRes=e.userData._diamondNormalMapRes),e.userData._diamondCacheKey&&(h.cacheKey=e.userData._diamondCacheKey),i.extensions[Xl.DIAMOND_GLTF_EXTENSION]=h,c.extensionsUsed[Xl.DIAMOND_GLTF_EXTENSION]=!0}});var Tm,zu=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};let Rl=Tm=class extends Js{constructor(){super(),this.enabled=!0,this.animations=[],this.loopAnimations=!0,this.loopRepetitions=1/0,this.timeScale=0,this.animateOnScroll=!1,this.animationSpeed=1,this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this.dependencies=[Kr],this._lastFrameTime=0,this._fadeDisabled=!1,this._objectAdded=c=>{const e=c.object;e.assetType==="model"&&e.modelObject&&this._viewer&&e.modelObject.traverse(i=>{const s=i.animations;if(s.length<1)return;const a=Math.max(...s.map(k=>k.duration));s.forEach(k=>k.duration=a);const h=new d.Xcj(this._viewer.scene.modelRoot.modelObject),f=s.map(k=>h.clipAction(k).setLoop(this.loopAnimations?d.YKA:d.jAl,this.loopRepetitions));this.animations.push({mixer:h,clips:s,actions:f,duration:a}),this.onPropertyChange()})},this._animationTime=0,this._animationDuration=0,this._animationState="none",this.uiConfig=void 0,this._lastAnimId="",this.timelineMarkers=[],this._postFrame=this._postFrame.bind(this),this._wheel=this._wheel.bind(this),this.playClips=this.playClips.bind(this),this.playClip=this.playClip.bind(this),this.playAnimation=this.playAnimation.bind(this),this.playPauseAnimation=this.playPauseAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.stopAnimation=this.stopAnimation.bind(this),this.resetAnimation=this.resetAnimation.bind(this),this.onPropertyChange=this.onPropertyChange.bind(this),this._loaderCreate=this._loaderCreate.bind(this)}get animationState(){return this._animationState}get animationTime(){return this._animationTime}get animationDuration(){return this._animationDuration}_wheel({deltaY:c}){this.enabled&&Math.abs(c)>.001&&(this._scrollAnimationState=-1*Math.sign(c))}_postFrame(){var c,e;if(!this._viewer)return;const i=this._viewer,s=this.animateOnScroll;if(!this.enabled||this.animations.length<1||this._animationState!=="playing"&&!s)return this._lastFrameTime=0,void(this._fadeDisabled&&((c=this._viewer.getPluginByType("FrameFade"))===null||c===void 0||c.enable(Tm.PluginType),this._fadeDisabled=!1));const a=mo()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=a-1/30);let h=a-this._lastFrameTime;if(h*=this.animationSpeed,this._lastFrameTime=a,s&&(h*=this._scrollAnimationState),Math.abs(h)<1e-4)return;const f=(e=this._viewer.getPluginByType("Progressive"))===null||e===void 0?void 0:e.postFrameConvergedRecordingDelta();if(f&&f>0&&(h=f),f!==0&&(this.animations.map(k=>k.mixer.update(h)),this._animationTime+=h,this._animationTime>this._animationDuration&&(this._animationTime-=this._animationDuration),this._animationTime<0&&(this._animationTime+=this._animationDuration),this._scrollAnimationState<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,i.scene.activeCamera.cameraObject.userData.__animatingCamera&&i.scene.activeCamera.setDirty(),i.renderer.resetShadows(),i.setDirty(),!this._fadeDisabled)){const k=this._viewer.getPluginByType("FrameFade");k&&(k.disable(Tm.PluginType),this._fadeDisabled=!0)}}_loaderCreate({loader:c}){c.isGLTFLoader2&&c.register(e=>new K_(e,this))}async onAdded(c){var e,i,s,a,h,f;(i=(e=c.getPlugin(Kr))===null||e===void 0?void 0:e.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),c.scene.addEventListener("addSceneObject",this._objectAdded),(f=(h=(a=(s=c.getPlugin(Kr))===null||s===void 0?void 0:s.exporter)===null||a===void 0?void 0:a.getExporter("gltf","glb"))===null||h===void 0?void 0:h.extensions)===null||f===void 0||f.push(ux),c.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel);let k=-1;return Object.defineProperty(c.scene.modelRoot,"currentTimelineMarker",{get:()=>k,set:et=>c.scene.modelRoot.dispatchEvent({type:"animationTimelineMarker",marker:this.timelineMarkers[k=et]})}),c.scene.modelRoot.addEventListener("animationTimelineMarker",({marker:et})=>{var tt;if(!this._viewer)return;if(!et)return this._viewer.scene.activeCamera=(tt=this._viewer)===null||tt===void 0?void 0:tt.scene.defaultCamera,void this._viewer.setDirty();const rt=et.camera;rt&&(rt.userData.__animatingCamera=!0,this._viewer.scene.activeCamera=this._viewer.createCamera(rt))}),super.onAdded(c)}async onRemove(c){var e,i;return c.scene.removeEventListener("addSceneObject",this._objectAdded),(i=(e=c.getPlugin(Kr))===null||e===void 0?void 0:e.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),c.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),super.onRemove(c)}onPropertyChange(){this._animationState==="playing"&&this.playAnimation(),this._animationDuration=Math.max(...this.animations.map(({duration:c})=>c))}onStateChange(){var c,e;(e=(c=this.uiConfig)===null||c===void 0?void 0:c.children)===null||e===void 0||e.map(i=>i&&Ht(i)).flat(2).forEach(i=>{var s;return(s=i==null?void 0:i.uiRefresh)===null||s===void 0?void 0:s.call(i)})}playPauseAnimation(){this._animationState==="playing"?this.pauseAnimation():this.playAnimation()}async playClip(c,e=!1){return this.playClips([c],e)}async playClips(c,e=!1){const i=[];return this.animations.forEach(({actions:s})=>{s.forEach(a=>{c.includes(a.getClip().name)&&i.push(a)})}),this.playAnimation(e,i)}async playAnimation(c=!1,e){var i,s,a;if(!this.enabled)return;this._animationState==="playing"&&this.stopAnimation(!1),nn((s=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("Picking"))===null||s===void 0?void 0:s.transformControls,"enabled",!1);let h=0;e||(e=[],this.animations.forEach(({mixer:et,actions:tt,clips:rt})=>{e.push(...tt)}));const f=Ho();this._lastAnimId=f,this._animationState!=="paused"&&this.resetAnimation();for(const et of e)this.timeScale>0&&(et.timeScale=this.timeScale),et.setLoop(this.loopAnimations?d.YKA:d.jAl,this.loopRepetitions),et.play(),h=Math.max(h,et.getClip().duration/et.timeScale);if(this._animationState="playing",(a=this._viewer)===null||a===void 0||a.setDirty(),h*=this.loopAnimations?this.loopRepetitions:1,h/=this.animationSpeed,!isFinite(h))return;const k=1e3*h-this._animationTime/this.animationSpeed+.01;k>0&&await au(k),f===this._lastAnimId&&this.stopAnimation(c)}pauseAnimation(){var c,e,i;this._animationState="paused",nn((e=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Picking"))===null||e===void 0?void 0:e.transformControls,"enabled",!0),(i=this._viewer)===null||i===void 0||i.setDirty(),this._lastAnimId=""}stopAnimation(c=!1){var e,i,s;this._animationState="stopped",nn((e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("Picking"),"enabled",!0),c?this.resetAnimation():(i=this._viewer)===null||i===void 0||i.setDirty(),this._lastAnimId="",this._viewer&&this._fadeDisabled&&((s=this._viewer.getPluginByType("FrameFade"))===null||s===void 0||s.enable(Tm.PluginType),this._fadeDisabled=!1)}resetAnimation(){var c;this._animationState==="stopped"?(this.animations.forEach(({mixer:e,actions:i,clips:s})=>{e.stopAllAction(),e.setTime(0)}),this._animationTime=0,(c=this._viewer)===null||c===void 0||c.setDirty()):this.stopAnimation(!0)}};Rl.PluginType="GLTFAnimation",Rl.AnimationMarkersExtension="WEBGI_animation_markers",zu([qp()],Rl.prototype,"animationState",null),zu([qp()],Rl.prototype,"animationTime",null),zu([qp()],Rl.prototype,"animationDuration",null),zu([hn(Tm.prototype.onPropertyChange),Jr("Loop",{limitedUi:!0})],Rl.prototype,"loopAnimations",void 0),zu([hn(Tm.prototype.onPropertyChange)],Rl.prototype,"loopRepetitions",void 0),zu([hn(Tm.prototype.onPropertyChange)],Rl.prototype,"timeScale",void 0),zu([Jr(),jn()],Rl.prototype,"animateOnScroll",void 0),zu([Xr("Speed",[.1,4],.1,{limitedUi:!0}),jn()],Rl.prototype,"animationSpeed",void 0),zu([hn(Tm.prototype.onStateChange)],Rl.prototype,"_animationState",void 0),zu([Ao("Play/Pause",c=>({label:()=>c.animationState==="playing"?"Pause":"Play",limitedUi:!0}))],Rl.prototype,"playPauseAnimation",null),zu([Ao("Stop",{limitedUi:!0})],Rl.prototype,"stopAnimation",null),zu([Ao("Reset",{limitedUi:!0})],Rl.prototype,"resetAnimation",null),Rl=Tm=zu([Ws("GLTF Animations")],Rl);class K_{constructor(e,i){this.parser=e,this.name=Rl.AnimationMarkersExtension,this.plugin=i}async afterRoot(e){var i;let s=[];for(const pt of this.parser.json.scenes){if(!pt.extensions)continue;const ft=pt.extensions[this.name];for(const vt of(ft==null?void 0:ft.markers)||[]){const yt=vt.camera!==void 0?await this.parser.getDependency("camera",vt.camera):void 0;vt.time===void 0&&(vt.time=vt.frame/30,console.error("Update timeline markers plugin for correct times.")),s.push({name:vt.name,frame:vt.frame,time:vt.time,camera:yt})}}if(s.length<1)return;s=s.sort((pt,ft)=>pt.frame-ft.frame);const a=(i=e.scene)!==null&&i!==void 0?i:e.scenes[0];if(!a)return;a.userData.__markers=s;const h=this.plugin.timelineMarkers,f=s.map(pt=>pt.time);let k=h.length;const et=s.map(pt=>k++),tt=Math.max(...f)+.01;h.push(...s);const rt=new d.dUE(".currentTimelineMarker",f,et,2300),lt=new d.m7l("animationTimelineMarker",tt,[rt]);lt.__gltfExport=!1,e.animations.push(lt)}}const ux=c=>({afterParse(e){const i=c.json.scenes[c.json.scene||0];i.extensions=i.extensions||{};const s={markers:[]},a=[];if((Array.isArray(e)?e:[e]).forEach(h=>h.traverse(f=>{f.userData.__markers&&a.push(...f.userData.__markers)})),a.sort((h,f)=>h.frame-f.frame),!(a.length<1)){for(const h of a){const f=h.camera;if(f){const k=c.nodeMap.get(f);if(k===void 0){console.warn("Camera not found in gltf export",f,c.nodeMap);continue}const et=c.json.nodes[k].camera;h.camera=et,s.markers.push(h)}}i.extensions[Rl.AnimationMarkersExtension]=s,c.extensionsUsed[Rl.AnimationMarkersExtension]=!0}}});class Tv extends j{constructor(){super(...arguments),this.dirty=!1,this.counters={},this._generators=new Map,this._preRender=()=>this._showDebug("preRender"),this._postRender=()=>this._showDebug("postRender")}async onAdded(e){this._viewer=e,e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender)}addTexture(e,i,s,a,h,f="postRender",k=!1){var et;this._generators.has(f)||this._generators.set(f,[]),(et=this._generators.get(f))===null||et===void 0||et.push({key:e,fn:i,rect:s?[...s]:void 0,frag:h||a||k?new d.jyz({vertexShader:nt.vertexShader,uniforms:{tDiffuse:{value:null},opacity:{value:1}},fragmentShader:h??`
        #include <common>
        #include <packing>
        uniform float opacity;
		uniform ${k?"samplerCube":"sampler2D"} tDiffuse;
		varying vec2 vUv;
		void main() {
			vec4 texel = ${k?"textureCube( tDiffuse, vec3(cos(vUv.y * PI2) * cos(vUv.x * PI2), sin(vUv.y * PI2), cos(vUv.y * PI2) * sin(vUv.x * PI2)) )":"texture2D( tDiffuse, vUv )"};
			${a??""}
			gl_FragColor = opacity * texel;
		}
            `}):void 0})}removeTexture(e,i="postRender"){var s,a;this._generators.set(i,(a=(s=this._generators.get(i))===null||s===void 0?void 0:s.filter(h=>h.key!==e))!==null&&a!==void 0?a:[])}async onDispose(e){return Promise.resolve(void 0)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),this._viewer=void 0,Promise.resolve(void 0)}_showDebug(e){var i;const s=this._viewer,a=s==null?void 0:s.renderer;a&&s&&((i=this._generators.get(e))===null||i===void 0||i.forEach(({key:h,fn:f,rect:k,frag:et})=>{const tt=f(s);if(tt){if(tt.image&&k){const rt=tt.image.width/tt.image.height;k[2]<1&&k[3]<1&&(k[2]=200),k[2]<1&&(k[2]=k[3]*rt),k[3]<1&&(k[3]=k[2]/rt)}a.blit(tt,void 0,{viewport:k,clear:!1,material:et})}}))}}Tv.PluginType="debug";var $A=function(c,e){return $A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(i[a]=s[a])},$A(c,e)};function hx(c,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=c}$A(c,e),c.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var JA,hE=function(){function c(){}return c._xfnv1a=function(e){for(var i=2166136261,s=0;s<e.length;s++)i=Math.imul(i^e.charCodeAt(s),16777619);return function(){return i+=i<<13,i^=i>>>7,i+=i<<3,i^=i>>>17,(i+=i<<5)>>>0}},c}(),Gy=function(c){function e(i){var s=c.call(this)||this;return s.a=e._xfnv1a(i)(),s}return hx(e,c),e.prototype.next=function(){var i=this.a+=1831565813;return i=Math.imul(i^i>>>15,1|i),(((i^=i+Math.imul(i^i>>>7,61|i))^i>>>14)>>>0)/4294967296},e}(hE),DT=function(c){function e(i){var s=c.call(this)||this,a=e._xfnv1a(i);return s.a=a(),s.b=a(),s.c=a(),s.d=a(),s}return hx(e,c),e.prototype.next=function(){this.a>>>=0,this.b>>>=0,this.c>>>=0,this.d>>>=0;var i=this.a+this.b|0;return this.a=this.b^this.b>>>9,this.b=this.c+(this.c<<3)|0,this.c=this.c<<21|this.c>>>11,this.d=this.d+1|0,i=i+this.d|0,this.c=this.c+i|0,(i>>>0)/4294967296},e}(hE),q0=function(c){function e(i){var s=c.call(this)||this,a=e._xfnv1a(i);return s.a=a(),s.b=a(),s.c=a(),s.d=a(),s}return hx(e,c),e.prototype.next=function(){var i=this.b<<9,s=5*this.a;return s=s<<7|9*(s>>>25),this.c^=this.a,this.d^=this.b,this.b^=this.c,this.a^=this.d,this.c^=i,this.d=this.d<<11|this.d>>>21,(s>>>0)/4294967296},e}(hE);(function(c){c.sfc32="sfc32",c.mulberry32="mulberry32",c.xoshiro128ss="xoshiro128ss"})(JA||(JA={}));var dx=function(){function c(e,i){i===void 0&&(i=JA.sfc32),this.str=e,this.prng=i,this.generator=this._initializeGenerator()}return c.prototype.next=function(){return this.generator.next()},c.prototype._initializeGenerator=function(){if(function(i){return i===null}(e=this.str)||function(i){return i===void 0}(e))return this.wrap();var e;switch(this.prng){case"sfc32":return new DT(this.str);case"mulberry32":return new Gy(this.str);case"xoshiro128ss":return new q0(this.str);default:return this.wrap()}},c.prototype.wrap=function(){return{next:function(){return Math.random()}}},c}(),RT=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};class px extends n_{constructor(e,i,s,a){super(e,i),this._shadowParams={enabled:!0,radius:2,width:1024,height:1024,bias:-.001,normalBias:0,near:1.5,far:4,frustumSize:4},this._randomParams={focus:1,spread:.01,distanceScale:50,minDistanceScale:new d.Pa4(10,10,10),normalDirection:new d.Pa4(.01,.98,.01).normalize(),direction:new d.Pa4(-.9,.5,-1)},this.isRandomizedDirectionalLight=!0,this.shadowParams=s??{},this.randomParams=a??{},this.updateShadowParams=this.updateShadowParams.bind(this)}get shadowParams(){return this._shadowParams}set shadowParams(e){Object.keys(e).forEach(i=>e[i]===void 0&&delete e[i]),this._shadowParams={...this._shadowParams,...e},this.updateShadowParams()}get randomParams(){return this._randomParams}set randomParams(e){Object.keys(e).forEach(i=>e[i]===void 0&&delete e[i]),Object.assign(this._randomParams,e)}updateShadowParams(){this.castShadow=this._shadowParams.enabled,this.shadow.mapSize.x=this._shadowParams.width,this.shadow.mapSize.y=this._shadowParams.height,this.shadow.bias=this._shadowParams.bias,this.shadow.normalBias=this._shadowParams.normalBias,this.refreshShadowCamNearFar(),this.shadow.radius=this._shadowParams.radius,this.shadow.camera.right=this._shadowParams.frustumSize/2,this.shadow.camera.left=-this._shadowParams.frustumSize/2,this.shadow.camera.top=this._shadowParams.frustumSize/2,this.shadow.camera.bottom=-this._shadowParams.frustumSize/2,this.shadow.camera.updateProjectionMatrix(),this.matrixWorldNeedsUpdate=!0}randomizePosition(e,i=null,s=null){const a=new dx(e.toString()),h=new d.FM8(a.next()*Math.PI*2,Math.asin(2*a.next()-1));let f=new d.Pa4(Math.cos(h.x)*Math.cos(h.y),Math.sin(h.y),Math.sin(h.x)*Math.cos(h.y));const k=new d.FM8;for(let et=0;et<5;et++){k.set(a.next(),a.next()),f=kT(k,this._randomParams.normalDirection,.4),a.next()<Math.sqrt(i??this._randomParams.focus)&&(k.set(a.next(),a.next()),f=kT(k,this._randomParams.direction,Math.pow((s??this._randomParams.spread)/2,2)));const tt=f.dot(this._randomParams.normalDirection);if(tt>0&&tt<.4)break}f.normalize(),f.multiplyScalar(this._randomParams.distanceScale),this.position.set(0,0,0),this.target.position.copy(f.normalize().negate()),this.target.updateMatrixWorld(),this.refreshShadowCamNearFar(),this.updateMatrixWorld()}refreshShadowCamNearFar(){const e=new d.Pa4().subVectors(this.target.position,this.shadow.camera.position).length();this.shadow.camera.near=e-this._shadowParams.near*this._shadowParams.frustumSize/2,this.shadow.camera.far=e+this._shadowParams.far*this._shadowParams.frustumSize/2}dispose(){}get uiConfig(){if(this._uiConfig)return this._uiConfig}fromJSON(e,i){return super.fromJSON(e,i)?(this.updateShadowParams(),this):null}}function kT(c,e,i){e=e.clone().normalize();const s=new d.Pa4(0,-e.z,e.y).normalize(),a=new d.Pa4().crossVectors(e,s).normalize(),h=c;h.x=2*h.x*Math.PI,h.y=1-h.y*i;const f=Math.sqrt(1-h.y*h.y);return s.multiplyScalar(Math.cos(h.x)*f).add(a.multiplyScalar(Math.sin(h.x)*f)).add(e.multiplyScalar(h.y))}RT([jn("shadowParams")],px.prototype,"_shadowParams",void 0),RT([jn("randomParams")],px.prototype,"_randomParams",void 0);class _C extends d.Tn7{constructor(){super(...arguments),this.typeSlug="fsShadow",this.assetType="material",this._uniforms={},this.lastFrameTexture=null}get materialObject(){return this}onBeforeCompile(e,i){e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`
#include <project_vertex>
gl_Position = vec4(uv*2.-1., 0, 1.); 
        `),e.vertexShader=e.vertexShader.replace("void main() {",`
varying vec2 vUv;
void main() {
    vUv = uv;
        `),e.fragmentShader=e.fragmentShader.replace("void main() {",`
varying vec2 vUv;
uniform sampler2D tLastThis;
void main() {
        `),e.fragmentShader=e.fragmentShader.replace("gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );",Ut`
float shadow = getShadowMask();

//shift the color by dither_shift
shadow = clamp(shadow + mix(-1./512., 1./512., rand( gl_FragCoord.xy )), 0., 1.);

float last = unpackRGBAToDepth(texture2D(tLastThis, vUv));
gl_FragColor = packDepthToRGBA(mix(last, shadow, opacity));
//if not useMovingAverage:
//gl_FragColor = packDepthToRGBA(shadow * opacity + last);
        `),Object.assign(e.uniforms,this._uniforms),super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,i){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}(function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);h>3&&f&&Object.defineProperty(e,i,f)})([dn({propKey:"tLastThis"})],_C.prototype,"lastFrameTexture",void 0);var fx=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};class Iv{constructor(e){this.enabled=!0,this._lightLayer=5,this._frameNumber=0,this.maxFrameNumber=400,this.groundMapMode="aoMap",this.alphaVignette=!0,this.alphaVignetteAxis="xy",this.shadowAutoUpdate=!0,this.materialExtension={shaderExtender:(s,a,h)=>{this.groundMapMode==="aoMap"?s.fragmentShader=Ul(s.fragmentShader,"#include <aomap_fragment>",Ul(d.WdD.aomap_fragment,"float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;","float ambientOcclusion = ( unpackRGBAToDepth(texture2D( aoMap, vUv2 ) ) - 1.0) * aoMapIntensity + 1.0;")):this.groundMapMode==="map"?s.fragmentShader=Ul(s.fragmentShader,"#include <map_fragment>",Ul(d.WdD.map_fragment,"diffuseColor *= sampledDiffuseColor;","float groundShadow = unpackRGBAToDepth(sampledDiffuseColor); diffuseColor.rgb *= groundShadow; diffuseColor.a *= max(0., 1.-groundShadow);")):this.groundMapMode==="alphaMap"&&(s.fragmentShader=Ul(s.fragmentShader,"#include <alphamap_fragment>",Ul(d.WdD.alphamap_fragment,"texture2D( alphaMap, vUv ).g","1. - unpackRGBAToDepth( texture2D( alphaMap, vUv ) )",{replaceAll:!0}))),this.alphaVignette&&h.capabilities.isWebGL2&&(s.fragmentShader=Ul(s.fragmentShader,"#include <output_fragment>",Ut`#include <output_fragment>
                    #ifndef OPAQUE
                    float weight = 0.;
                    #ifdef USE_UV
                    weight = 2.*abs(length(0.5 - vUv.${this.alphaVignetteAxis}));
                    #endif
                    #if defined(USE_LIGHTMAP) || defined(USE_AOMAP)
                    weight = 2.*abs(length(0.5 - vUv2.${this.alphaVignetteAxis}));
                    #endif
                    weight = min(1., max(0., weight))-0.5;
                    weight = min(1., max(0., 1.0-2.*weight));
                    weight = pow(weight, 1.5);
                    gl_FragColor.a *= weight;
                    //gl_FragColor.rgb /= max(0.01, weight);
                    gl_FragColor = saturate(gl_FragColor);
                    //gl_FragColor.a = 0.5;
                    #endif
                    `))},computeCacheKey:()=>this.groundMapMode+"."+this.alphaVignette+"."+this.alphaVignetteAxis,onObjectRender:(s,a)=>{a.materialObject.userData.gMapMode!==this.groundMapMode&&(a.materialObject.userData.gMapMode=this.groundMapMode,a.materialObject.needsUpdate=!0)},isCompatible:s=>s.isMeshStandardMaterial2},this._viewer=e;const i=new px(16777215,10,{near:1.5,far:20,bias:0,frustumSize:4,width:1024,height:1024,enabled:!0,radius:10,normalBias:0},{direction:new d.Pa4(.2,1,.2).normalize(),spread:.9,focus:1,distanceScale:20,minDistanceScale:new d.Pa4(10,10,10),normalDirection:new d.Pa4(0,1,0)});i.shadow.camera.updateProjectionMatrix(),i.layers.disableAll(),i.layers.set(this._lightLayer),this._light=i,e.scene.addLight(this._light,{addToRoot:!0}),this._shadowMat=new _C({color:"#ffffff",toneMapped:!1,depthWrite:!1,depthTest:!1,premultipliedAlpha:!1,opacity:1,transparent:!1,blending:d.jFi})}get attachedMesh(){return this._attachedMesh}set attachedMesh(e){this._attachedMesh!==e&&(this._attachedMesh&&this.cleanupMaterial(),this._attachedMesh=e,this._attachedMesh&&this._updateMaterial())}get target(){return this._target}get light(){return this._light}dispose(){this._shadowMat.dispose(),this._target=void 0,this.reset()}cleanupMaterial(){this._updateMaterial(!0)}_groundMapModeChanged(){this._attachedMesh&&(this.cleanupMaterial(),this._updateMaterial(),this.groundMapMode==="alphaMap"?this._attachedMesh.material.transparent=!0:this._attachedMesh.material.transparent=!1),this.reset()}_alphaVignetteChanged(){var e,i,s;(i=(e=this.materialExtension)===null||e===void 0?void 0:e.setDirty)===null||i===void 0||i.call(e),(s=this._viewer)===null||s===void 0||s.setDirty()}fromJSON(e,i){return os(e,this,!0,i),this.reset(),this}reset(){this._frameNumber=0}autoUpdateShadow(){this.shadowAutoUpdate&&this.updateShadow()}updateShadow(){if(!this.enabled)return!1;const e=this._attachedMesh;if(++this._frameNumber>this.maxFrameNumber||!e)return!1;const i=1024;this._target||(this._target=this._viewer.renderer.createTarget({type:d.ywz,depthBuffer:!1,size:new d.FM8(i,i),sizeMultiplier:void 0,encoding:d.rnI,format:d.wk1})),this._frameNumber<3?this._light.randomizePosition(0,1,0):this._light.randomizePosition(this._frameNumber),e.castShadow=!1;const s=this._viewer.renderer.rendererObject,a=s.shadowMap,h=a.type,f=a.needsUpdate,k=a.autoUpdate;a.type=d._MY,a.needsUpdate=!0,a.autoUpdate=!1;const et=this._viewer.scene,tt=new d.S9g;tt.disableAll(),et.modelObject.traverse(vt=>{vt.isLight&&vt!==this._light.lightObject&&(vt.userData.__gp_layers=vt.layers,vt.layers=tt)});const rt=et.activeCamera.cameraObject;if(rt.layers.mask&1<<this._lightLayer)throw"Camera can render pseudo directional light, check layers";rt.layers.enable(this._lightLayer),e.layers.disable(this._lightLayer),Lr(s,{shadowMapRender:!0,backgroundRender:!1,sceneRender:!1},()=>this._viewer.renderer.renderScene(et)),rt.layers.disable(this._lightLayer);const lt=rt.layers.mask;rt.layers.set(this._lightLayer),e.layers.enable(this._lightLayer);const pt=this._viewer.renderer.getTempTarget({type:d.ywz,depthBuffer:!1,size:new d.FM8(i,i),encoding:d.rnI,format:d.wk1}),ft=pt.texture.encoding;pt.texture.encoding=d.rnI,this._viewer.renderer.blit(this._target.texture,pt,{clear:!0});{const vt=et.modelObject.environment,yt=et.modelObject.background,Mt=e.material,xt=e.frustumCulled,Et=s.getRenderTarget(),At=s.getActiveCubeFace(),Rt=s.getActiveMipmapLevel();et.modelObject.background=null,et.modelObject.environment=null,e.material=this._shadowMat,e.frustumCulled=!1,s.setRenderTarget(this._target),this._shadowMat.opacity=Math.max(1/this.maxFrameNumber,1/this._frameNumber),this._shadowMat.lastFrameTexture=pt.texture,this._shadowMat.needsUpdate=!0,Lr(s,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},()=>this._viewer.renderer.renderScene(et)),s.setRenderTarget(Et,At,Rt),e.frustumCulled=xt,e.material=Mt,et.modelObject.environment=vt,et.modelObject.background=yt}return pt.texture.encoding=ft,this._viewer.renderer.releaseTempTarget(pt),e.layers.disable(this._lightLayer),rt.layers.mask=lt,et.modelObject.traverse(vt=>{vt.isLight&&vt!==this._light.lightObject&&(vt.layers=vt.userData.__gp_layers,delete vt.userData.__gp_layers)}),a.type=h,a.needsUpdate=f,a.autoUpdate=k,e.castShadow=!0,(this._frameNumber<2||this._frameNumber>Math.min(30,this.maxFrameNumber)&&this._frameNumber%150==0)&&(this._updateMaterial(),this._viewer.setDirty(),e.dispatchEvent({type:"materialUpdate"})),!0}_updateMaterial(e=!1){var i,s,a;this._attachedMesh&&(e?(this._attachedMesh.material.alphaMap===((i=this._target)===null||i===void 0?void 0:i.texture)&&(this._attachedMesh.material.alphaMap=null),this._attachedMesh.material.aoMap===((s=this._target)===null||s===void 0?void 0:s.texture)&&(this._attachedMesh.material.aoMap=null),this._attachedMesh.material.map===((a=this._target)===null||a===void 0?void 0:a.texture)&&(this._attachedMesh.material.map=null)):this._target&&(this.groundMapMode==="alphaMap"&&(this._attachedMesh.material.alphaMap=this._target.texture),this.groundMapMode==="aoMap"&&(this._attachedMesh.material.aoMap=this._target.texture),this.groundMapMode==="map"&&(this._attachedMesh.material.map=this._target.texture)),this._attachedMesh.material&&(this._attachedMesh.material.userData.ALPHA_I_RGBA_PACKING=!e&&this.groundMapMode==="alphaMap",this._attachedMesh.material.alphaTest=e||this.groundMapMode!=="alphaMap"?0:.001,this._attachedMesh.material.needsUpdate=!0))}}fx([jn("randomizedLight")],Iv.prototype,"_light",void 0),fx([hn(Iv.prototype.reset),jn()],Iv.prototype,"maxFrameNumber",void 0),fx([hn(Iv.prototype._groundMapModeChanged),jn()],Iv.prototype,"groundMapMode",void 0),fx([jn(),hn(Iv.prototype._alphaVignetteChanged)],Iv.prototype,"alphaVignette",void 0),fx([jn(),hn(Iv.prototype._alphaVignetteChanged)],Iv.prototype,"alphaVignetteAxis",void 0);var BT="vec2 poisson_disk_samples[16];void setPds(){poisson_disk_samples[0]=vec2(-0.399691779231,0.728591545584);poisson_disk_samples[1]=vec2(-0.48622557676,-0.84016533712);poisson_disk_samples[2]=vec2(0.770309468987,-0.24906070432);poisson_disk_samples[3]=vec2(0.556596796154,0.820359876432);poisson_disk_samples[4]=vec2(-0.933902004071,0.0600539051593);poisson_disk_samples[5]=vec2(0.330144964342,0.207477293384);poisson_disk_samples[6]=vec2(0.289013230975,-0.686749271417);poisson_disk_samples[7]=vec2(-0.0832470893559,-0.187351643125);poisson_disk_samples[8]=vec2(-0.296314525615,0.254474834305);poisson_disk_samples[9]=vec2(-0.850977666059,0.484642744689);poisson_disk_samples[10]=vec2(0.829287915319,0.2345063545);poisson_disk_samples[11]=vec2(-0.773042143899,-0.543741521254);poisson_disk_samples[12]=vec2(0.0561133030864,0.928419742597);poisson_disk_samples[13]=vec2(-0.205799249508,-0.562072714492);poisson_disk_samples[14]=vec2(-0.526991665882,-0.193690188118);poisson_disk_samples[15]=vec2(-0.051789270667,-0.935374050821);}",dE=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};class Hy extends d.Kj0{constructor(e,i,s=0){super(e),this.type="Reflector",this.isReflector2=!0,this.enabled=!0,this.reflectorModePhysical=!0,this.reflectionTargetNeedsUpdate=!0,this.transparentReflectionBackground=!0,this.materialExtension={extraUniforms:{tRefDiffuse:{value:null},tRefDiffuseSize:{value:new d.FM8},refTextureMatrix:{value:null},frameCount:{value:0},sceneBoundingRadius:{value:0}},updaters:[],shaderExtender:(Mt,xt,Et)=>{if(this.enabled){Mt.vertexShader=Mt.vertexShader.replace("void main() {",`void main() {
vRefUv = refTextureMatrix * vec4( position, 1.0 );`);const At="#glMarker beforeModulation";Mt.fragmentShader=Mt.fragmentShader.replace(At,`
                    if(roughnessFactor < 0.95) {
                        float d = 0.;//textureProj(tRefDepth, vRefUv).r;
                        // d = min(2., max(0., (d-0.06) * ((7./3.-ior)) * sceneBoundingRadius));
                        vec4 refBaseColor = getReflectionColor(material.roughness, material.roughness * d);
                        // refBaseColor.rgb = vec3(refBaseColor.a);
                        // refBaseColor.a *= 1.0 - clamp(material.roughness * .3, 0., 1.);
                        `+(this.reflectorModePhysical?`
                        #if !defined(SSR_ENABLED) || SSR_ENABLED < 1 
                        vec3 specularColor = EnvironmentBRDF(geometry.normal, geometry.viewDir, material.specularColor.rgb, material.specularF90, material.roughness);
                        #endif
                        reflectedLight.indirectSpecular = mix(vec3(reflectedLight.indirectSpecular), saturate(specularColor.rgb * refBaseColor.rgb), refBaseColor.a);
                        `:`
                        reflectedLight.indirectSpecular = saturate(diffuseColor.rgb * refBaseColor.rgb);
                        diffuseColor.a *= refBaseColor.a;
                        `)+`}
`+At),Mt.vertexUvs=!0}},parsVertexSnippet:()=>this.enabled?`
		uniform mat4 refTextureMatrix;
		varying vec4 vRefUv;
`:"",parsFragmentSnippet:()=>this.enabled?BT+`
`+Ev+`
#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
varying vec4 vRefUv;uniform sampler2D tRefDiffuse;uniform vec2 tRefDiffuseSize;float getSpecularMIPLevel(const in float roughness,const in float maxMIPLevel){float sigma=PI*roughness*roughness/(1.+roughness);float desiredMIPLevel=maxMIPLevel+log2(sigma);return clamp(desiredMIPLevel,0.,maxMIPLevel);}vec4 getReflectionColor(const in float roughness,const in float depthModifier){float mip=getSpecularMIPLevel(roughness+depthModifier,5.);vec4 color=texture2D(tRefDiffuse,vRefUv.xy/vRefUv.w,mip);float blurDist=saturate(2./(1.+pow(abs(vViewPosition.z),0.25)))*mip*32.*color.a;float rnd=PI2*interleavedGradientNoise(vUv.xy,frameCount);vec4 rotationMatrix=vec4(cos(rnd),-sin(rnd),0.,0.);rotationMatrix.z=-rotationMatrix.y;rotationMatrix.w=rotationMatrix.x;vec3 colorSum=color.rgb*color.a;float weightSum=0.001+color.a;vec2 ofs;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));ofs=vRefUv.xy+vRefUv.w*blurDist*ofs/tRefDiffuseSize.xy;color=texture2D(tRefDiffuse,ofs/vRefUv.w,mip);colorSum+=color.rgb*color.a;weightSum+=color.a;}
#pragma unroll_loop_end
return vec4(colorSum/weightSum,1.);}`:"",computeCacheKey:Mt=>this.enabled+" "+Mt.materialObject.transparent+" "+this.reflectorModePhysical+" ",onObjectRender:(Mt,{materialObject:xt})=>{xt.userData.__lastTransparent!==xt.transparent&&(xt.needsUpdate=!0,xt.userData.__lastTransparent=xt.transparent)},isCompatible:Mt=>Mt.isMeshStandardMaterial2},this.material=void 0,this._renderTarget=i;const a=new d.JOQ,h=new d.Pa4,f=new d.Pa4,k=new d.Pa4,et=new d.yGw,tt=new d.Pa4(0,0,-1),rt=new d.Ltg,lt=new d.Pa4,pt=new d.Pa4,ft=new d.Ltg,vt=new d.yGw,yt=new d.cPb;d.M8C.isPowerOfTwo(i.texture.image.width)&&d.M8C.isPowerOfTwo(i.texture.image.height)||(this._renderTarget.texture.generateMipmaps=!1),this.onBeforeRender=(Mt,xt,Et)=>{if(!this.enabled||!Mt.userData.mainRenderPass||!this.reflectionTargetNeedsUpdate)return;const At=Et.view?Object.assign({},Et.view):null;if(At&&Et.clearViewOffset&&Et.clearViewOffset(),f.setFromMatrixPosition(this.matrixWorld),k.setFromMatrixPosition(Et.matrixWorld),et.extractRotation(this.matrixWorld),h.set(0,0,1),h.applyMatrix4(et),lt.subVectors(f,k),lt.dot(h)>0)return;lt.reflect(h).negate(),lt.add(f),et.extractRotation(Et.matrixWorld),tt.set(0,0,-1),tt.applyMatrix4(et),tt.add(k),pt.subVectors(f,tt),pt.reflect(h).negate(),pt.add(f),yt.position.copy(lt),yt.up.set(0,1,0),yt.up.applyMatrix4(et),yt.up.reflect(h),yt.lookAt(pt),yt.far=2,yt.near=0,yt.updateMatrixWorld(),yt.projectionMatrix.copy(Et.projectionMatrix),vt.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),vt.multiply(yt.projectionMatrix),vt.multiply(yt.matrixWorldInverse),vt.multiply(this.matrixWorld),a.setFromNormalAndCoplanarPoint(h,f),a.applyMatrix4(yt.matrixWorldInverse),rt.set(a.normal.x,a.normal.y,a.normal.z,a.constant);const Rt=yt.projectionMatrix;ft.x=(Math.sign(rt.x)+Rt.elements[8])/Rt.elements[0],ft.y=(Math.sign(rt.y)+Rt.elements[9])/Rt.elements[5],ft.z=-1,ft.w=(1+Rt.elements[10])/Rt.elements[14],rt.multiplyScalar(2/rt.dot(ft)),Rt.elements[2]=rt.x,Rt.elements[6]=rt.y,Rt.elements[10]=rt.z+1-s,Rt.elements[14]=rt.w,this.visible=!1;const Bt=Mt.getRenderTarget(),Qt=Mt.xr.enabled,Wt=Mt.shadowMap.autoUpdate;Mt.xr.enabled=!1,Mt.shadowMap.autoUpdate=!1,Mt.setRenderTarget(this._renderTarget),Mt.state.buffers.depth.setMask(!0),Mt.autoClear===!1&&Mt.clear();const tn=xt.background;this.transparentReflectionBackground&&(xt.background=null);const pn=!this.transparentReflectionBackground;tn&&pn&&(tn.userData.flipX=!tn.userData.flipX),Lr(Mt,{shadowMapRender:!1,backgroundRender:pn,opaqueRender:!0,transparentRender:!0,transmissionRender:!1,screenSpaceRendering:!1},()=>Mt.render(xt,yt)),tn&&pn&&(tn.userData.flipX=!tn.userData.flipX||void 0),this.transparentReflectionBackground&&(xt.background=tn),Mt.xr.enabled=Qt,Mt.shadowMap.autoUpdate=Wt,Mt.setRenderTarget(Bt),At!=null&&At.enabled&&Et.setViewOffset&&Et.setViewOffset(At.fullWidth,At.fullHeight,At.offsetX,At.offsetY,At.width,At.height);const yn=Et.viewport;yn!==void 0&&Mt.state.viewport(yn),this.visible=!0,this.reflectionTargetNeedsUpdate=!1},this.textureMatrix=vt,this.materialExtension.extraUniforms.tRefDiffuse.value=this._renderTarget.texture,this.materialExtension.extraUniforms.tRefDiffuseSize.value=new d.FM8(this._renderTarget.width,this._renderTarget.height),this.materialExtension.extraUniforms.refTextureMatrix.value=vt}_updateExtension(){var e,i;this.transparentReflectionBackground=this.reflectorModePhysical,(i=(e=this.materialExtension)===null||e===void 0?void 0:e.setDirty)===null||i===void 0||i.call(e)}getRenderTarget(){return this._renderTarget}}dE([hn(Hy.prototype._updateExtension)],Hy.prototype,"enabled",void 0),dE([hn(Hy.prototype._updateExtension)],Hy.prototype,"reflectorModePhysical",void 0),Hy.prototype.isReflector=!0;var Xm=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};class Mp extends Js{constructor(e={}){super(),this._transformNeedRefresh=!0,this.dependencies=[Kr],this.visible=!0,this.size=8,this.yOffset=0,this.renderToDepth=!0,this.tonemapGround=!0,this.limitCameraAboveGround=!1,this._cameraLimitsSet=!1,this._cameraLastMaxPolarAngle=Math.PI,this._refreshMaterial=this._refreshMaterial.bind(this),this._refreshTransform=this._refreshTransform.bind(this),this._refreshCameraLimits=this._refreshCameraLimits.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._refreshOptions2=this._refreshOptions2.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this._preRender=this._preRender.bind(this),this._postFrame=this._postFrame.bind(this),this._geometry=new d._12(1,1,1,1),this._geometry.attributes.uv2=this._geometry.attributes.uv.clone(),this._geometry.attributes.uv2.needsUpdate=!0,this._options={shape:"",up:[0,100,0],autoAdjustTransform:!0},this.setOptions(e)}get enabled(){return this.visible}set enabled(e){this.visible=e}get material(){return this._material}get mesh(){return this._iMesh}_createMesh(){return new d.Kj0(this._geometry)}async onAdded(e){var i,s;await super.onAdded(e),e.getPluginByType("TweakpaneUi")&&console.error("TweakpaneUiPlugin must be added after Ground Plugin"),this._manager=e.getPlugin(Kr);const a=this._createMesh();a.userData.physicsMass=0,this._iMesh=await((i=this._manager)===null||i===void 0?void 0:i.addImportedSingle(a,{pseudoCenter:!1,autoScale:!1,addToRoot:!0})),this._mesh=(s=this._iMesh)===null||s===void 0?void 0:s.modelObject,this._mesh&&(this._mesh.userData.userSelectable=!1,this._mesh.castShadow=!0,this._mesh.receiveShadow=!0,this._mesh.name="Ground Plane"),e.scene.addEventListener("sceneUpdate",this._onSceneUpdate),e.scene.addEventListener("addSceneObject",this._onSceneUpdate),e.addEventListener("preRender",this._preRender),e.addEventListener("postFrame",this._postFrame),this.refreshOptions()}_postFrame(){this._transformNeedRefresh&&this._refreshTransform(),this._viewer}_preRender(){this._viewer}async onDispose(e){var i,s;return this._geometry.dispose(),(s=(i=this._iMesh)===null||i===void 0?void 0:i.dispose)===null||s===void 0||s.call(i),super.onDispose(e)}async onRemove(e){return this._removeMaterial(),e.scene.removeEventListener("sceneUpdate",this._onSceneUpdate),e.scene.removeEventListener("addSceneObject",this._onSceneUpdate),e.removeEventListener("postFrame",this._postFrame),e.removeEventListener("preRender",this._preRender),this._manager=void 0,super.onRemove(e)}_removeMaterial(){var e,i;this._material&&((i=(e=this._manager)===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterial(this._material),this._material.userData.renderToDepth=this._material.userData.__renderToDepth,this._material.userData.__renderToDepth=void 0,this._material=void 0)}_onSceneUpdate(e){e.geometryChanged!==!1&&e.updateGround!==!1&&this.refreshTransform()}refreshTransform(){this._transformNeedRefresh=!0}_refreshOptions2(){this.refreshOptions()}refreshOptions(){this._viewer&&(this._refreshMaterial(),this.refreshTransform(),this._refreshCameraLimits())}_refreshCameraLimits(){var e;const i=(e=this._viewer)===null||e===void 0?void 0:e.scene.activeCamera.controls;i&&(i.maxPolarAngle!==void 0?this.limitCameraAboveGround?(this._cameraLimitsSet||(this._cameraLastMaxPolarAngle=i.maxPolarAngle),i.maxPolarAngle=Math.PI/2,this._cameraLimitsSet=!0):this._cameraLimitsSet&&(i.maxPolarAngle=this._cameraLastMaxPolarAngle,this._cameraLimitsSet=!1):console.warn("refreshCameraLimits only available with orbit controls."))}_refreshTransform(){var e,i,s;if(!this._mesh||!this._viewer)return;let a=!1;if(this.visible!==this._mesh.visible&&(this._mesh.visible=this.visible,a=!0),this.enabled){if(this._options.autoAdjustTransform){this._mesh.userData.bboxVisible=!1;const h=this._viewer.scene.getBounds(!0);this._mesh.userData.bboxVisible=!0;const f=h.getCenter(new d.Pa4).sub(new d.Pa4(0,h.getSize(new d.Pa4).y/2+this.yOffset,0));a=a||f.clone().sub(this._mesh.position).length()>1e-4,a&&this._mesh.position.copy(f)}a=a||Math.abs(this._mesh.scale.x-this.size)>1e-4,a&&(this._mesh.scale.setScalar(this.size),this._mesh.setRotationFromEuler(new d.USm(-Math.PI/2,0,0)),this._mesh.matrixWorldNeedsUpdate=!0,(s=(i=this._mesh).setDirty)===null||s===void 0||s.call(i)),this._transformNeedRefresh=!1}else a&&((e=this._viewer)===null||e===void 0||e.scene.setDirty())}_refreshMaterial(){var e,i,s,a,h,f,k,et;if(!this._viewer||!this.enabled)return!1;this._manager||console.error("GroundPlugin requires asset manager");const tt=(i=(e=this._manager)===null||e===void 0?void 0:e.materials)===null||i===void 0?void 0:i.findOrCreate((a=(s=this._material)===null||s===void 0?void 0:s.uuid)!==null&&a!==void 0?a:"standard",{name:"BaseGroundMaterial",runtimeMaterial:!0,color:16777215});let rt=!1;return(tt==null?void 0:tt.uuid)!==((h=this._material)===null||h===void 0?void 0:h.uuid)&&(this._removeMaterial(),tt&&(this._material=tt),!((f=this._material)===null||f===void 0)&&f.uuid||console.warn("No material found for ground"),this._viewer.scene.setDirty(),this._mesh&&this._material&&(this._material.roughness=.2,this._material.metalness=.5,((et=(k=this._mesh)===null||k===void 0?void 0:k.setMaterial)!==null&&et!==void 0?et:lt=>{this._mesh&&(this._mesh.material=lt.materialObject)})(this._material)),rt=!0),this._material&&(this._material.userData.__renderToDepth===void 0&&(this._material.userData.__renderToDepth=this._material.userData.renderToDepth),this._material.userData.renderToDepth!==this.renderToDepth&&(this._material.userData.renderToDepth=this.renderToDepth),this._material.userData.__postTonemap===void 0&&(this._material.userData.__postTonemap=this._material.userData.postTonemap),this._material.userData.postTonemap!==this.tonemapGround&&(this._material.userData.postTonemap=this.tonemapGround),this._material.materialObject.userData.ssaoDisabled=!0,this._material.materialObject.userData.sscsDisabled=!0),this._viewer.setDirty(this),rt}setOptions(e){Object.assign(this._options,e),this.refreshOptions()}fromJSON(e,i){return super.fromJSON(e,i)?(this.refreshOptions(),this):null}_extraUiConfig(){return[()=>{var e;return(e=this._material)===null||e===void 0?void 0:e.uiConfig}]}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ground",children:[{label:"Visible",type:"checkbox",property:[this,"visible"],limitedUi:!0},{label:"Size",type:"input",property:[this,"size"],limitedUi:!0},{label:"Render to Depth",type:"checkbox",property:[this,"renderToDepth"]},{label:"Limit Camera",type:"checkbox",property:[this,"limitCameraAboveGround"]},{label:"Tonemap",type:"checkbox",property:[this,"tonemapGround"]},{label:"Height",type:"slider",bounds:[-2,2],property:[this,"yOffset"]},...this._extraUiConfig()]}}}Xm([jn("material")],Mp.prototype,"_material",void 0),Xm([hn(Mp.prototype.refreshTransform),jn()],Mp.prototype,"visible",void 0),Xm([hn(Mp.prototype._onSceneUpdate),jn()],Mp.prototype,"size",void 0),Xm([hn(Mp.prototype._onSceneUpdate),jn()],Mp.prototype,"yOffset",void 0),Xm([hn(Mp.prototype._refreshOptions2),jn()],Mp.prototype,"renderToDepth",void 0),Xm([hn(Mp.prototype._refreshOptions2),jn()],Mp.prototype,"tonemapGround",void 0),Xm([hn(Mp.prototype._refreshCameraLimits),jn()],Mp.prototype,"limitCameraAboveGround",void 0);var Gl=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};class pm extends Mp{constructor(e={},i=!1){super(e),this.bakedShadows=!0,this.groundReflection=!1,this.physicalReflections=!1,this._showDebug=i,i&&this.dependencies.push(Tv),this._onSceneUpdate=this._onSceneUpdate.bind(this)}get shadowBaker(){return this._shadowBaker}_createMesh(){const e=new Hy(this._geometry,this._viewer.renderer.createTarget({type:d.ywz,format:d.wk1,encoding:d.rnI,size:{width:1024,height:1024},generateMipmaps:!0,depthBuffer:!0,minFilter:d.D1R,magFilter:d.wem})),i=e.onBeforeRender;return e.onBeforeRender=(...s)=>{var a,h,f,k,et;let tt=(h=(a=this._viewer)===null||a===void 0?void 0:a.getPluginByType("SSReflection"))===null||h===void 0?void 0:h.passes.ssr.passObject;tt&&!tt.enabled&&(tt=void 0),tt&&(tt.enabled=!1);let rt=(et=(k=(f=this._viewer)===null||f===void 0?void 0:f.getPluginByType("SSBevelPlugin"))===null||k===void 0?void 0:k.pass)===null||et===void 0?void 0:et.passObject;rt&&!rt.enabled&&(rt=void 0),rt&&(rt.enabled=!1),i(...s),tt&&(tt.enabled=!0),rt&&(rt.enabled=!0)},e}async onAdded(e){var i,s;await super.onAdded(e),this._showDebug&&((i=e.getPlugin(Tv))===null||i===void 0||i.addTexture("bake_ground_1",()=>{var a,h;return(h=(a=this._shadowBaker)===null||a===void 0?void 0:a.light.shadow.map)===null||h===void 0?void 0:h.texture},[100,100,200,200]),(s=e.getPlugin(Tv))===null||s===void 0||s.addTexture("bake_ground_2",()=>{var a,h;return(h=(a=this._shadowBaker)===null||a===void 0?void 0:a.target)===null||h===void 0?void 0:h.texture},[100,400,400,400],"texel = vec4(vec3(unpackRGBAToDepth(texel)), 1.0);"))}_postFrame(){var e;super._postFrame(),this._viewer&&this.enabled&&this.bakedShadows&&((e=this._shadowBaker)===null||e===void 0||e.autoUpdateShadow())}_preRender(){super._preRender(),this._viewer&&(this._mesh.reflectionTargetNeedsUpdate=this._viewer.renderer.frameCount<1)}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_removeMaterial(){var e,i,s,a;if(this._material){if(this._shadowBaker&&this._material.groundMatExtension&&((i=(e=this._material).unregisterMaterialExtensions)===null||i===void 0||i.call(e,[this._shadowBaker.materialExtension]),delete this._material.groundMatExtension),this._material.reflectorMatExtension){const h=this._mesh.materialExtension;h||console.warn("unable to find the extension to unregister"),(a=(s=this._material).unregisterMaterialExtensions)===null||a===void 0||a.call(s,[h]),delete this._material.reflectorMatExtension}super._removeMaterial()}}_onSceneUpdate(e){var i;super._onSceneUpdate(e),e.geometryChanged!==!1&&((i=this._shadowBaker)===null||i===void 0||i.reset())}refreshOptions(){if(!this._viewer)return;this.bakedShadows&&!this._shadowBaker?(this._shadowBaker=new Iv(this._viewer),this._shadowBaker.attachedMesh=this._mesh):!this.bakedShadows&&this._shadowBaker&&(this._shadowBaker.reset(),this._shadowBaker.cleanupMaterial());const e=this._mesh;e.isReflector2&&(e.enabled=this.groundReflection,e.reflectorModePhysical=this.physicalReflections),super.refreshOptions(),this._viewer.setDirty(this)}_refreshMaterial(){var e,i,s,a;if(!this._viewer)return!1;const h=super._refreshMaterial();if(!this._material)return h;if(this.groundReflection&&this._mesh.isReflector2&&!this._material.reflectorMatExtension){const f=this._mesh.materialExtension;f.updaters=[this._viewer.scene,this._viewer.renderer],(i=(e=this._material).registerMaterialExtensions)===null||i===void 0||i.call(e,[f]),this._material.reflectorMatExtension=!0}return this.bakedShadows&&this._shadowBaker&&!this._material.groundMatExtension&&((a=(s=this._material).registerMaterialExtensions)===null||a===void 0||a.call(s,[this._shadowBaker.materialExtension]),this._material.groundMatExtension=!0),this._material.materialObject.userData.ssreflDisabled=this.groundReflection,this._material.materialObject.userData.ssreflNonPhysical=!this.physicalReflections,this._viewer.setDirty(this),h}_extraUiConfig(){var e,i,s,a,h,f,k,et,tt,rt,lt,pt,ft,vt,yt,Mt,xt,Et,At,Rt,Bt,Qt,Wt,tn,pn,yn,En,wn,In,xn;return[{label:"Baked Shadows",type:"checkbox",property:[this,"bakedShadows"]},{label:"Shadow Frames",type:"input",hidden:()=>!this._shadowBaker,stepSize:1,bounds:[1,1e3],property:[this._shadowBaker,"maxFrameNumber"]},{label:"Alpha Vignette",type:"checkbox",hidden:()=>!this._material||this._material.transmission<1e-4&&!this._material.transparent,property:[this._shadowBaker,"alphaVignette"],limitedUi:!0,onChange:()=>{var Cn,Fn;return(Fn=(Cn=this._uiConfig)===null||Cn===void 0?void 0:Cn.uiRefresh)===null||Fn===void 0?void 0:Fn.call(Cn,"postFrame",!0)}},{label:"Alpha Vignette Axis",type:"dropdown",hidden:()=>{var Cn;return!(!((Cn=this._shadowBaker)===null||Cn===void 0)&&Cn.alphaVignette)||!this._material||this._material.transmission<1e-4&&!this._material.transparent},property:[this._shadowBaker,"alphaVignetteAxis"],children:["x","y","xy"].map(Cn=>({label:Cn,value:Cn})),limitedUi:!0},{label:"Planar Reflections",type:"checkbox",property:[this,"groundReflection"],limitedUi:!0},{label:"Physical Reflections",type:"checkbox",property:[this,"physicalReflections"],limitedUi:!0},{label:"Shadow type",type:"dropdown",hidden:()=>!this._shadowBaker,property:[this._shadowBaker,"groundMapMode"],children:[{label:"aoMap"},{label:"map"},{label:"alphaMap"}],limitedUi:!0},{type:"folder",label:"Randomized Light",hidden:()=>!this._shadowBaker,limitedUi:!0,children:[{type:"color",label:"Color",property:[(e=this._shadowBaker)===null||e===void 0?void 0:e.light,"color"]},{type:"slider",label:"Intensity",bounds:[0,100],property:[(i=this._shadowBaker)===null||i===void 0?void 0:i.light,"intensity"]},{type:"checkbox",label:"Shadow Enabled",property:[(a=(s=this._shadowBaker)===null||s===void 0?void 0:s.light)===null||a===void 0?void 0:a.shadowParams,"enabled"],onChange:[(f=(h=this._shadowBaker)===null||h===void 0?void 0:h.light)===null||f===void 0?void 0:f.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(et=(k=this._shadowBaker)===null||k===void 0?void 0:k.light)===null||et===void 0?void 0:et.randomParams,"focus"],onChange:[this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(rt=(tt=this._shadowBaker)===null||tt===void 0?void 0:tt.light)===null||rt===void 0?void 0:rt.randomParams,"spread"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,60],property:[(pt=(lt=this._shadowBaker)===null||lt===void 0?void 0:lt.light)===null||pt===void 0?void 0:pt.randomParams,"distanceScale"],onChange:[(vt=(ft=this._shadowBaker)===null||ft===void 0?void 0:ft.light)===null||vt===void 0?void 0:vt.updateShadowParams,this._onSceneUpdate]},{type:"vec3",bounds:[-1,1],property:[(Mt=(yt=this._shadowBaker)===null||yt===void 0?void 0:yt.light)===null||Mt===void 0?void 0:Mt.randomParams,"direction"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"vec3",bounds:[-1,1],property:[(Et=(xt=this._shadowBaker)===null||xt===void 0?void 0:xt.light)===null||Et===void 0?void 0:Et.randomParams,"normalDirection"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,10],property:[(Rt=(At=this._shadowBaker)===null||At===void 0?void 0:At.light)===null||Rt===void 0?void 0:Rt.shadowParams,"radius"],onChange:[(Qt=(Bt=this._shadowBaker)===null||Bt===void 0?void 0:Bt.light)===null||Qt===void 0?void 0:Qt.updateShadowParams,this._onSceneUpdate]},{type:"input",property:[(tn=(Wt=this._shadowBaker)===null||Wt===void 0?void 0:Wt.light)===null||tn===void 0?void 0:tn.shadowParams,"frustumSize"],onChange:[(yn=(pn=this._shadowBaker)===null||pn===void 0?void 0:pn.light)===null||yn===void 0?void 0:yn.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[-.1,.1],property:[(wn=(En=this._shadowBaker)===null||En===void 0?void 0:En.light)===null||wn===void 0?void 0:wn.shadowParams,"bias"],onChange:[(xn=(In=this._shadowBaker)===null||In===void 0?void 0:In.light)===null||xn===void 0?void 0:xn.updateShadowParams,this._onSceneUpdate]}]},...super._extraUiConfig()]}}pm.PluginType="Ground",Gl([hn(pm.prototype.refreshOptions),jn()],pm.prototype,"bakedShadows",void 0),Gl([hn(pm.prototype.refreshOptions),jn()],pm.prototype,"groundReflection",void 0),Gl([hn(pm.prototype.refreshOptions),jn()],pm.prototype,"physicalReflections",void 0),Gl([jn("shadowBaker")],pm.prototype,"_shadowBaker",void 0);var Y0,Km=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};let fm=Y0=class extends bu{constructor(){super({vertexShader:nt.vertexShader,defines:{PASS_STEP:1},uniforms:{tSource:{value:null},tDiffuse:{value:null},opacity:{value:1},tDiffuseSize:{value:new d.FM8},weight:{value:1},tNormalDepth:{value:null}},fragmentShader:Hv+`
uniform float intensity;uniform float opacity;uniform vec2 tDiffuseSize;varying vec2 vUv;uniform float weight;
#if PASS_STEP == 0
uniform vec4 prefilter;vec4 Prefilter(vec4 c){if(getDepth(vUv)>0.999){return vec4(0.);}float brightness=max(c.r,max(c.g,c.b));float soft=brightness+prefilter.x*(prefilter.y-1.);soft=clamp(soft,0.,prefilter.z);soft=soft*soft*prefilter.w;float contribution=max(soft,brightness-prefilter.x);contribution/=max(brightness,0.001);return vec4(c.rgb*contribution,c.a);}
#endif
vec4 Sample(vec2 uv){return tDiffuseTexelToLinear(texture2D(tDiffuse,uv));}vec4 SampleBox(vec2 uv,float delta){vec4 o=vec2(-delta,delta).xxyy/tDiffuseSize.xyxy;vec4 s=Sample(uv+o.xy)+Sample(uv+o.zy)+Sample(uv+o.xw)+Sample(uv+o.zw);return s*0.25;}void main(){
#if PASS_STEP == 0 
gl_FragColor=weight*Prefilter(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 1 
gl_FragColor=weight*(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 2 
gl_FragColor=(SampleBox(vUv,0.5));gl_FragColor.a=1.;
#elif PASS_STEP == 3 
vec4 texel=tSourceTexelToLinear(texture2D(tSource,vUv));vec4 bloom=intensity*SampleBox(vUv,0.5).rgba;float brightness=max(bloom.r,max(bloom.g,bloom.b));texel.rgb+=bloom.rgb;texel.a=min(1.,texel.a+brightness);gl_FragColor=texel;
#elif PASS_STEP == 4 
vec4 texel=vec4(0.);texel.rgb+=intensity*SampleBox(vUv,0.5).rgb;texel.a=1.;gl_FragColor=texel;
#endif
#include <encodings_fragment>
}`},"tDiffuse","tSource"),this.uiConfig=void 0,this.prefilter=new d.Ltg(2,.5,0,0),this.threshold=2,this.softThreshold=.5,this.intensity=.5,this.bloomIterations=4,this.radius=.6,this.power=1,this.bloomDebug=!1,this._weights=[],this._updateWeights=this._updateWeights.bind(this),this._thresholdsUpdated=this._thresholdsUpdated.bind(this),this._updateWeights(),this._thresholdsUpdated(),this.clear=!0,this.userData={setDirty:()=>{this.setDirty()}}}_thresholdsUpdated(){this.prefilter.x=this.threshold,this.prefilter.y=this.softThreshold,this.prefilter.z=2*this.prefilter.x*this.prefilter.y,this.prefilter.w=.125/(this.uniforms.prefilter.value.z+1e-5)}render(c,e,i,s,a){const h=c.baseRenderer;this.material.defines.PASS_STEP=0,this.clear=!0;const f=i;let k=.5,et=f.width*k,tt=f.height*k;const rt=[];let lt=h.getTempTarget({sizeMultiplier:.5,type:d.cLu});rt.push(lt);let pt=f;this.material.needsUpdate=!0,this.material.uniforms.weight.value=this._weights[0],super.render(c,lt,pt,s,a),pt=lt;let ft=1;for(;ft<this.bloomIterations&&(et/=2,tt/=2,k/=2,!(tt<2||et<2));ft++){lt=h.getTempTarget({sizeMultiplier:k,type:d.cLu}),rt.push(lt),this.material.defines.PASS_STEP=1;let yt=this._weights[ft];yt=this._weights[ft-1]!==0?this._weights[ft]/this._weights[ft-1]:this._weights[ft],this.material.uniforms.weight.value=yt,this.material.needsUpdate=!0,super.render(c,lt,pt,s,a),pt=lt}this.clear=!1;const vt=c.autoClear;for(c.autoClear=!1,ft-=2;ft>=0;ft--)lt=rt[ft],rt[ft]=void 0,this.material.defines.PASS_STEP=2,this.material.transparent=!0,this.material.blending=d.WMw,this.material.needsUpdate=!0,c.autoClear=!1,super.render(c,lt,pt,s,a),this.material.blending=d.jFi,h.releaseTempTarget(pt),pt=lt;this.clear=!0,c.autoClear=vt,c.autoClear=!0,this.bloomDebug?(this.material.defines.PASS_STEP=4,this.material.needsUpdate=!0,super.render(c,e,pt,s,a)):(this.uniforms.tSource.value=f.texture,this.material.defines.PASS_STEP=3,this.material.needsUpdate=!0,super.render(c,e,pt,s,a),this.uniforms.tSource.value=null),h.releaseTempTarget(pt)}_updateWeights(){if(!this._weights)return;const c=Math.max(Math.min(this.radius,1),0),e=1/(this.bloomIterations-1);for(let i=0;i<this.bloomIterations;i++){let s=i*e+.1,a=1.2-s;s=Math.pow(s,this.power),a=Math.pow(a,this.power),this._weights[i]=a*(1-c)+s*c}this.setDirty()}};Km([dn()],fm.prototype,"prefilter",void 0),Km([Xr("Threshold",[0,2]),hn(Y0.prototype._thresholdsUpdated),jn()],fm.prototype,"threshold",void 0),Km([Xr("Soft Threshold",[0,1]),hn(Y0.prototype._thresholdsUpdated),jn()],fm.prototype,"softThreshold",void 0),Km([Xr("Intensity",[0,3]),jn(),dn()],fm.prototype,"intensity",void 0),Km([Xr("Iterations",[0,7],1),hn(Y0.prototype._updateWeights),jn()],fm.prototype,"bloomIterations",void 0),Km([Xr("Radius",[0,1],.01),hn(Y0.prototype._updateWeights),jn()],fm.prototype,"radius",void 0),Km([Xr("Power",[.2,10],.01),hn(Y0.prototype._updateWeights),jn()],fm.prototype,"power",void 0),Km([Jr("Debug")],fm.prototype,"bloomDebug",void 0),fm=Y0=Km([Ws("Bloom")],fm);class X0 extends wv{constructor(){super(...arguments),this.passId="bloom",this._beforeFilters=["combinedPost","screen"],this._afterFilters=["render","progressive"],this._requiredFilters=["render"]}passCtor(e){return new fm}_update(e){var i,s;return(i=e.getPlugin(ba))===null||i===void 0||i.updateShaderProperties((s=this.pass)===null||s===void 0?void 0:s.passObject.material),super._update(e)}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}X0.PluginType="Bloom";var pE=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};let mm=class extends Js{constructor(){super(),this.enabled=!0,this.dependencies=[Kr],this._defines={ANISOTROPY_DEBUG:!1},this._uniforms={anisotropyFactor:{value:1},anisotropyNoise:{value:1},anisotropyDirection:{value:1},anisotropyDirectionMap:{value:null},frameCount:{value:0}},this.materialExtension={shaderExtender:(c,e,i)=>{var s;if(!this.enabled||!e.materialObject.userData._isAnisotropic)return;const a=(s=e.materialObject.userData)===null||s===void 0?void 0:s._anisotropyDirectionMap,h=Ut`
                #include <bsdfs>
                //#if ANISOTROPY_ENABLED
                ${Ev}
                ${`uniform float anisotropyFactor;uniform float anisotropyNoise;
#if ANISOTROPY_TEX_MODE == 0
uniform float anisotropyDirection;
#else
uniform sampler2D anisotropyDirectionMap;
#endif
const float MIN_ROUGHNESS=0.05;float D_GGX_Anisotropy(float at,float ab,float ToH,float BoH,float NoH){float a2=at*ab;highp vec3 d=vec3(ab*ToH,at*BoH,a2*NoH);highp float d2=dot(d,d);float b2=a2/d2;return a2*b2*b2*(1./PI);}float V_GGX_SmithCorrelated_Anisotropy(float at,float ab,float ToV,float BoV,float ToL,float BoL,float NoV,float NoL){float lambdaV=NoL*length(vec3(at*ToV,ab*BoV,NoV));float lambdaL=NoV*length(vec3(at*ToL,ab*BoL,NoL));float v=0.5/(lambdaV+lambdaL);return saturate(v);}vec3 indirectAnisotropyBentNormal(const in vec3 normal,const in vec3 viewDir,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){vec3 aDirection=anisotropyFactor>=0.?anisotropicB:anisotropicT;vec3 aTangent=cross(aDirection,viewDir);vec3 aNormal=cross(aTangent,aDirection);float bendFactor=abs(anisotropyFactor)*saturate(5.*max(roughness,MIN_ROUGHNESS));return normalize(mix(normal,aNormal,bendFactor));}vec3 BRDF_GGX_Anisotropy(const in vec3 lightDir,const in vec3 viewDir,const in vec3 normal,const in vec3 f0,const in float f90,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){float alpha=pow2(roughness);vec3 halfDir=normalize(lightDir+viewDir);float dotNL=saturate(dot(normal,lightDir));float dotNV=saturate(dot(normal,viewDir));float dotNH=saturate(dot(normal,halfDir));float dotVH=saturate(dot(viewDir,halfDir));float dotTV=dot(anisotropicT,viewDir);float dotBV=dot(anisotropicB,viewDir);float dotTL=dot(anisotropicT,lightDir);float dotBL=dot(anisotropicB,lightDir);float dotTH=dot(anisotropicT,halfDir);float dotBH=dot(anisotropicB,halfDir);float aspect=sqrt(1.-min(1.-MIN_ROUGHNESS,abs(anisotropyFactor)*0.9));if(anisotropyFactor>0.)aspect=1./aspect;float at=roughness*aspect;float ab=roughness/aspect;vec3 F=F_Schlick(f0,f90,dotVH);float V=V_GGX_SmithCorrelated_Anisotropy(at,ab,dotTV,dotBV,dotTL,dotBL,dotNV,dotNL);float D=D_GGX_Anisotropy(at,ab,dotTH,dotBH,dotNH);return F*(V*D);}`}
            `+(a?Kn("anisotropyDirectionMap",a,i.capabilities.isWebGL2):"");c.fragmentShader=c.fragmentShader.replace("#include <bsdfs>",h),c.fragmentShader=c.fragmentShader.replace("#include <lights_fragment_begin>",d.WdD.lights_fragment_begin),c.fragmentShader=c.fragmentShader.replace("IncidentLight directLight;",`float rnd=(random2(vUv.xy,frameCount)-0.5)*anisotropyNoise*material.roughness;
#if ANISOTROPY_TEX_MODE < 2
#if ANISOTROPY_TEX_MODE == 0 
float rot=saturate(anisotropyDirection);
#else 
float rot=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).r);
#endif
rot=rot*2.*PI+rnd;vec2 rot2=vec2(sin(rot),cos(rot));
#else 
vec2 rot2=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).rg*2.-1.)+vec2(rnd,rnd);rot2=normalize(rot2);const float anisoSpecMultiplier=0.25;float matSpecAniso=(length(material.specularColor.rgb))*2.*PI;rot2=mix(rot2,vec2(sin(matSpecAniso),cos(matSpecAniso)),anisoSpecMultiplier);rot2=normalize(rot2);
#endif
vec3 anisotropicT=(tangent*rot2.x+bitangent*rot2.y);anisotropicT=normalize(anisotropicT-normal*dot(anisotropicT,normal));vec3 anisotropicB=normalize(cross(normal,anisotropicT));IncidentLight directLight;`).replaceAll("RE_Direct( directLight, geometry, material, reflectedLight )","RE_Direct( directLight, geometry, material, reflectedLight, anisotropicT, anisotropicB )");const f=d.WdD.lights_physical_pars_fragment.replace("void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {","void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight, const in vec3 anisotropicT, const in vec3 anisotropicB ) {").replace("BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness )","BRDF_GGX_Anisotropy( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness, anisotropicT, anisotropicB )");c.fragmentShader=c.fragmentShader.replace("#include <lights_physical_pars_fragment>",f);const k=Ut`
                #if defined( USE_ENVMAP )
                vec3 anisotropyBentNormal = indirectAnisotropyBentNormal(geometry.normal, geometry.viewDir, material.roughness, anisotropicT, anisotropicB);
                #endif
            `+d.WdD.lights_fragment_maps.replace("getIBLIrradiance( geometry.normal )","getIBLIrradiance( anisotropyBentNormal )").replace("getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness )","getIBLRadiance( geometry.viewDir, anisotropyBentNormal, material.roughness )");c.fragmentShader=c.fragmentShader.replace("#include <lights_fragment_maps>",k),c.vertexUvs=!0,c.vertexTangents=!0},onObjectRender:(c,e)=>{var i;const s=e.materialObject.userData;if(!(s!=null&&s._isAnisotropic))return;const a=c;if(!a.isMesh||!a.geometry)return;if(!a.geometry.attributes.tangent)throw new Error("No tangents on the geometry");this._uniforms.anisotropyFactor.value=s._anisotropyFactor,this._uniforms.anisotropyNoise.value=s._anisotropyNoise,this._uniforms.anisotropyDirectionMap.value=!((i=s._anisotropyDirectionMap)===null||i===void 0)&&i.isTexture?s._anisotropyDirectionMap:null,this._uniforms.anisotropyDirection.value=s._anisotropyDirection;let h=this.enabled?1:0;e.materialObject.defines.ANISOTROPY_ENABLED!==h&&(e.materialObject.defines.ANISOTROPY_ENABLED=h,e.materialObject.needsUpdate=!0),h=+this._defines.ANISOTROPY_DEBUG,e.materialObject.defines.ANISOTROPY_DEBUG!==h&&(e.materialObject.defines.ANISOTROPY_DEBUG=h,e.materialObject.needsUpdate=!0),h=s._anisotropyDirectionMode,this._uniforms.anisotropyDirectionMap.value||(h="CONSTANT"),h=h==="DIRECTION"?2:h==="ROTATION"?1:0,e.materialObject.defines.ANISOTROPY_TEX_MODE!==h&&(e.materialObject.defines.ANISOTROPY_TEX_MODE=h,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:c=>{var e,i,s;return(this.enabled?"1":"0")+(!((e=c.materialObject.userData)===null||e===void 0)&&e._isAnisotropic?"1":"0")+((s=(i=c.materialObject.userData)===null||i===void 0?void 0:i._anisotropyDirectionMap)===null||s===void 0?void 0:s.uuid)},isCompatible:c=>c.isMeshStandardMaterial2,updaters:()=>{var c;return[(c=this._viewer)===null||c===void 0?void 0:c.renderer]},getUiConfig:c=>{const e=this._viewer,i=this.makeAnisotropic,s={type:"folder",label:"Anisotropy",children:[{type:"checkbox",label:"Enabled",get value(){return c.materialObject.userData._isAnisotropic||!1},set value(a){var h;a!==c.materialObject.userData._isAnisotropic&&(a?i(c)||e.alert("One or more geometries cannot be made anisotropic."):(c.materialObject.userData._isAnisotropic=!1,c.materialObject.needsUpdate=!0),(h=s.uiRefresh)===null||h===void 0||h.call(s,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Factor",bounds:[-2,2],hidden:()=>!c.materialObject.userData._isAnisotropic,property:[c.materialObject.userData,"_anisotropyFactor"],onChange:this.setDirty},{type:"slider",label:"Noise",bounds:[0,2],hidden:()=>!c.materialObject.userData._isAnisotropic,property:[c.materialObject.userData,"_anisotropyNoise"],onChange:this.setDirty},{type:"image",label:"Texture",hidden:()=>!c.materialObject.userData._isAnisotropic,property:[c.materialObject.userData,"_anisotropyDirectionMap"],onChange:()=>{c.materialObject.needsUpdate=!0,this.setDirty()}},{type:"dropdown",label:"Mode",hidden:()=>!c.materialObject.userData._isAnisotropic,property:[c.materialObject.userData,"_anisotropyDirectionMode"],children:["CONSTANT","ROTATION","DIRECTION"].map(a=>({label:a})),onChange:()=>{c.materialObject.needsUpdate=!0,this.setDirty()}}]};return s}},this.setDirty=()=>{var c;(c=this._viewer)===null||c===void 0||c.setDirty()},this.makeSelectedAnisotropic=()=>{var c,e,i;const s=(i=(e=(c=this._viewer)===null||c===void 0?void 0:c.getPlugin(Uo))===null||e===void 0?void 0:e.getSelectedObject())===null||i===void 0?void 0:i.material;return(s==null?void 0:s.assetType)==="material"&&this.makeAnisotropic(s)},this._loaderCreate=this._loaderCreate.bind(this)}makeAnisotropic(c){var e;const i=(e=c.materialObject)===null||e===void 0?void 0:e.userData;if(!i)return!1;if(i._isAnisotropic===void 0){const s=i.__appliedMeshes;let a=!0;if(s)for(const{geometry:h}of s)!h||h.index&&h.attributes.position&&h.attributes.normal&&h.attributes.uv||(a=!1),a&&!h.attributes.tangent&&h.computeTangents();if(!a)return!1}return i._isAnisotropic=!0,i._anisotropyFactor===void 0&&(i._anisotropyFactor=1),i._anisotropyNoise===void 0&&(i._anisotropyNoise=0),i._anisotropyDirectionMode===void 0&&(i._anisotropyDirectionMode="DIRECTION"),c.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:c}){c.isGLTFLoader2&&c.register(e=>new mx(e))}async onAdded(c){var e,i,s,a,h;await super.onAdded(c);const f=c.getPlugin(Kr);(e=f==null?void 0:f.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(i=f==null?void 0:f.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),(h=(a=(s=f==null?void 0:f.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||a===void 0?void 0:a.extensions)===null||h===void 0||h.push(yC)}async onRemove(c){var e,i,s,a;return(i=(e=c.getPlugin(Kr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this.materialExtension),(a=(s=c.getPlugin(Kr))===null||s===void 0?void 0:s.importer)===null||a===void 0||a.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(c)}};mm.PluginType="AnisotropyPlugin",mm.ANISOTROPY_GLTF_EXTENSION="WEBGI_materials_anisotropy",pE([Jr("Enabled",c=>({onChange:c.setDirty})),jn()],mm.prototype,"enabled",void 0),pE([Ao("Make Anisotropy",c=>({hidden:()=>{var e;return!(!((e=c._viewer)===null||e===void 0)&&e.getPlugin(Uo))}}))],mm.prototype,"makeSelectedAnisotropic",void 0),mm=pE([Ws("Anisotropy Materials")],mm);class mx{constructor(e){this.parser=e,this.name=mm.ANISOTROPY_GLTF_EXTENSION}async extendMaterialParams(e,i){var s,a,h;const f=this.parser,k=f.json.materials[e];if(!k.extensions||!k.extensions[this.name])return Promise.resolve();const et=[],tt=k.extensions[this.name];i.userData||(i.userData={}),i.userData._isAnisotropic=!0,i.userData._anisotropyFactor=(s=tt.anisotropyFactor)!==null&&s!==void 0?s:0,i.userData._anisotropyNoise=(h=(a=tt.anisotropyNoiseFactor)!==null&&a!==void 0?a:tt.anisotropyNoise)!==null&&h!==void 0?h:0;let{anisotropyDirectionMode:rt,anisotropyDirection:lt}=tt;return rt||(rt=tt.anisotropyTextureMode),lt||(lt=tt.anisotropyRotation),i.userData._anisotropyDirectionMode=rt&&typeof(lt==null?void 0:lt.index)=="number"?rt:"CONSTANT",rt==="ROTATION"||rt==="DIRECTION"?et.push(f.assignTexture(i.userData,"_anisotropyDirectionMap",lt).then(pt=>{pt.encoding=d.knz})):i.userData._anisotropyDirection=lt??0,Promise.all(et)}afterRoot(e){return e.scene.traverse(i=>{var s,a;if(!(!((a=(s=i.material)===null||s===void 0?void 0:s.userData)===null||a===void 0)&&a._isAnisotropic))return;const h=i.geometry;h.attributes.tangent||(h.computeTangents(),h.attributes.tangent.needsUpdate=!0)}),null}}const yC=c=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._isAnisotropic||(e.userData._anisotropyFactor||0)<.001)return;i.extensions=i.extensions||{};const s={};if(s.anisotropyFactor=e.userData._anisotropyFactor||1,s.anisotropyNoiseFactor=e.userData._anisotropyNoise||0,s.anisotropyDirectionMode=e.userData._anisotropyDirectionMode||"CONSTANT",e.userData._anisotropyDirectionMap&&s.anisotropyDirectionMode!=="CONSTANT"){const a={index:c.processTexture(e.userData._anisotropyDirectionMap)};c.applyTextureTransform(a,e.userData._anisotropyDirectionMap),s.anisotropyDirection=a}else s.anisotropyDirectionMode="CONSTANT",s.anisotropyDirection=e.userData._anisotropyDirection||0;i.extensions[mm.ANISOTROPY_GLTF_EXTENSION]=s,c.extensionsUsed[mm.ANISOTROPY_GLTF_EXTENSION]=!0}});var Pv=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};let Im=class extends Js{constructor(){super(),this.enabled=!0,this.dependencies=[Kr],this._defines={},this._uniforms={thinBaseLayerFactors:{value:new d.Ltg},thinNoiseLayerFactors:{value:new d.Ltg},thinColorNoiseParams:{value:new d.Ltg},thinFilmFactor:{value:.8}},this.materialExtension={parsFragmentSnippet:(c,e)=>{var i;return this.enabled&&(!((i=e==null?void 0:e.materialObject.userData._thinFilmLayer)===null||i===void 0)&&i.hasThinFilm)?Ev+`
#ifndef VORONOISE_HELPER
#define VORONOISE_HELPER 
float voronoise(in vec2 p,float u,float v){float k=1.+63.*pow(1.-v,6.);vec2 i=floor(p);vec2 f=fract(p);vec2 a=vec2(0.,0.);for(int y=-2;y<=2;y++)for(int x=-2;x<=2;x++){vec2 g=vec2(x,y);vec3 o=hash3(i+g)*vec3(u,u,1.);vec2 d=g-f+o.xy;float w=pow(1.-smoothstep(0.,1.414,length(d)),k);a+=vec2(o.z*w,w);}return a.x/a.y;}vec3 voronoise3(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),voronoise(p-vec2(0.83,0.45),u,v));}vec3 voronoiseNormal(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),1.);}
#endif

#ifndef HSV_HELPERS
#define HSV_HELPERS 
vec3 hsv2rgb(vec3 c){vec4 K=vec4(1.,2./3.,1./3.,3.);vec3 p=abs(fract(c.xxx+K.xyz)*6.-K.www);return c.z*mix(K.xxx,clamp(p-K.xxx,0.,1.),c.y);}vec3 rgb2hsv(vec3 c){vec4 K=vec4(0.,-1./3.,2./3.,-1.);vec4 p=c.g<c.b?vec4(c.bg,K.wz):vec4(c.gb,K.xy);vec4 q=c.r<p.x?vec4(p.xyw,c.r):vec4(c.r,p.yzx);float d=q.x-min(q.w,q.y);float e=1.0e-10;return vec3(abs(q.z+(q.w-q.y)/(6.*d+e)),d/(q.x+e),q.x);}
#endif 

uniform vec4 thinBaseLayerFactors;
uniform vec4 thinNoiseLayerFactors;
uniform vec4 thinColorNoiseParams;
uniform float thinFilmFactor;
        `:""},shaderExtender:(c,e,i)=>{var s;if(!this.enabled||!(!((s=e.materialObject.userData._thinFilmLayer)===null||s===void 0)&&s.hasThinFilm))return;const a="#glMarker beforeAccumulation";c.fragmentShader=c.fragmentShader.replace(a,"vec3 incident=normalize(vViewPosition.xyz);float hWeight=1.-dot(normal,incident);vec3 noiseV=voronoise3(vUv.xy*thinColorNoiseParams.xy*60.,thinColorNoiseParams.z,thinColorNoiseParams.w);float hWeight2=1.-dot(normalize(noiseV),incident);vec3 film=hsv2rgb(vec3(fract(hWeight+thinBaseLayerFactors.x),thinBaseLayerFactors.y,thinBaseLayerFactors.z))*thinBaseLayerFactors.a;vec3 film2=hsv2rgb(vec3(fract(hWeight2+thinNoiseLayerFactors.x),thinNoiseLayerFactors.y,thinNoiseLayerFactors.z))*thinNoiseLayerFactors.a;film=(film+film2)/(thinBaseLayerFactors.a+thinNoiseLayerFactors.a);diffuseColor.rgb=mix(diffuseColor.rgb,film,thinFilmFactor);"+a),c.vertexUvs=!0},onObjectRender:(c,e)=>{var i;const s=(i=e.materialObject.userData)===null||i===void 0?void 0:i._thinFilmLayer;if(!(s!=null&&s.hasThinFilm))return;this._uniforms.thinBaseLayerFactors.value.fromArray(s.baseLayerFactors),this._uniforms.thinNoiseLayerFactors.value.fromArray(s.noiseLayerFactors),this._uniforms.thinColorNoiseParams.value.fromArray(s.colorNoiseParams),this._uniforms.thinFilmFactor.value=s.filmFactor;const a=this.enabled?1:0;e.materialObject.defines.THIN_FILM_LAYER_ENABLED!==a&&(e.materialObject.defines.THIN_FILM_LAYER_ENABLED=a,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:c=>{var e,i;return(this.enabled?"1":"0")+(!((i=(e=c.materialObject.userData)===null||e===void 0?void 0:e._thinFilmLayer)===null||i===void 0)&&i.hasThinFilm?"1":"0")},isCompatible:c=>c.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:c=>{const e=this._viewer,i={type:"folder",label:"ThinFilmLayer",children:[{type:"checkbox",label:"Enabled",get value(){var s;return((s=c.materialObject.userData._thinFilmLayer)===null||s===void 0?void 0:s.hasThinFilm)||!1},set value(s){var a,h;s!==((a=c.materialObject.userData._thinFilmLayer)===null||a===void 0?void 0:a.hasThinFilm)&&(s?fE(c.materialObject)||e.alert("Cannot add thin film."):(c.materialObject.userData._thinFilmLayer.hasThinFilm=!1,c.materialObject.needsUpdate=!0),(h=i.uiRefresh)===null||h===void 0||h.call(i,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,1],label:"Intensity",hidden:()=>{var s;return!(!((s=c.materialObject.userData._thinFilmLayer)===null||s===void 0)&&s.hasThinFilm)},property:[c.materialObject.userData._thinFilmLayer,"filmFactor"],onChange:this.setDirty}),()=>({type:"vec4",label:"Base Layer",bounds:[0,1],hidden:()=>{var s;return!(!((s=c.materialObject.userData._thinFilmLayer)===null||s===void 0)&&s.hasThinFilm)},property:[c.materialObject.userData._thinFilmLayer,"baseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Layer",bounds:[0,1],hidden:()=>{var s;return!(!((s=c.materialObject.userData._thinFilmLayer)===null||s===void 0)&&s.hasThinFilm)},property:[c.materialObject.userData._thinFilmLayer,"noiseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Params",bounds:[0,1],hidden:()=>{var s;return!(!((s=c.materialObject.userData._thinFilmLayer)===null||s===void 0)&&s.hasThinFilm)},property:[c.materialObject.userData._thinFilmLayer,"colorNoiseParams"],onChange:this.setDirty})]};return i}},this.setDirty=()=>{var c;(c=this._viewer)===null||c===void 0||c.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}addThinFilmLayer(c){return fE(c.materialObject)}_loaderCreate({loader:c}){c.isGLTFLoader2&&c.register(e=>new gx(e))}async onAdded(c){var e,i,s,a,h;await super.onAdded(c);const f=c.getPlugin(Kr);(e=f==null?void 0:f.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(i=f==null?void 0:f.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),(h=(a=(s=f==null?void 0:f.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||a===void 0?void 0:a.extensions)===null||h===void 0||h.push(fP)}async onRemove(c){var e,i,s,a;return(i=(e=c.getPlugin(Kr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this.materialExtension),(a=(s=c.getPlugin(Kr))===null||s===void 0?void 0:s.importer)===null||a===void 0||a.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(c)}};function fE(c){const e=c==null?void 0:c.userData;if(!e)return!1;e._thinFilmLayer||(e._thinFilmLayer={});const i=e._thinFilmLayer;return i.hasThinFilm=!0,i.baseLayerFactors===void 0&&(i.baseLayerFactors=[.3,.6,1,.9]),i.noiseLayerFactors===void 0&&(i.noiseLayerFactors=[.7,.5,.9,.7]),i.colorNoiseParams===void 0&&(i.colorNoiseParams=[.5,.5,.5,.7]),i.filmFactor===void 0&&(i.filmFactor=.3),c.isMaterial&&(c.needsUpdate=!0),!0}Im.PluginType="ThinFilmLayerPlugin",Im.THIN_FILM_LAYER_GLTF_EXTENSION="WEBGI_materials_thin_film_layer",Pv([Jr("Enabled",c=>({onChange:c.setDirty})),jn()],Im.prototype,"enabled",void 0),Im=Pv([Ws("ThinFilmLayer Materials")],Im);class gx{constructor(e){this.parser=e,this.name=Im.THIN_FILM_LAYER_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name];return i.userData||(i.userData={}),fE(i),i.userData._thinFilmLayer=os(a,i.userData._thinFilmLayer,!1,{}),Promise.resolve()}}const fP=c=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._thinFilmLayer||!e.userData._thinFilmLayer.hasThinFilm)return;i.extensions=i.extensions||{};const s=Wr(e.userData._thinFilmLayer,!1);i.extensions[Im.THIN_FILM_LAYER_GLTF_EXTENSION]=s,c.extensionsUsed[Im.THIN_FILM_LAYER_GLTF_EXTENSION]=!0}});var ZA=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};let pp=class extends Js{constructor(){super(),this.enabled=!0,this.dependencies=[Kr],this._defines={},this._uniforms={noiseBumpParams:{value:new d.FM8},noiseBumpScale:{value:.05},noiseBumpFlakeScale:{value:1e3},noiseFlakeClamp:{value:1},noiseFlakeRadius:{value:.5},noiseFlakeRoughnessMod:{value:1}},this.materialExtension={parsFragmentSnippet:(c,e)=>{var i;return this.enabled&&(!((i=e==null?void 0:e.materialObject.userData._noiseBumpMat)===null||i===void 0)&&i.hasBump)?Ev+`
#ifndef VORONOI_HELPER
#define VORONOI_HELPER 
float voronoi_distance(vec2 a,vec2 b,float metric){return distance(a,b);}float voronoi_f1_2d(in vec2 coord,in float randomness,in float flakeClamp,in float flakeRadius,inout vec3 outColor){vec2 cellPosition=floor(coord);vec2 localPosition=coord-cellPosition;float minDistance=8.;vec2 targetOffset,targetPosition;for(int j=-1;j<=1;j++){for(int i=-1;i<=1;i++){vec2 cellOffset=vec2(i,j);vec2 pointPosition=cellOffset+hash3(cellPosition+cellOffset).xy*randomness;float distanceToPoint=voronoi_distance(pointPosition,localPosition,1.);if(distanceToPoint<minDistance){targetOffset=cellOffset;minDistance=distanceToPoint;targetPosition=pointPosition;}}}float outDistance=minDistance;float dist=step(flakeRadius,outDistance);outColor=hash3(cellPosition+hash3(cellPosition+targetOffset).xy*randomness+targetOffset);vec3 outColor1=minDistance<flakeRadius?outColor:vec3(0.5,0.5,1.);outDistance=mix(dist,minDistance,flakeClamp);outColor=mix(outColor1,outColor,flakeClamp);return outDistance;}
#endif

uniform vec2 noiseBumpParams;uniform float noiseBumpScale;uniform float noiseBumpFlakeScale;uniform float noiseFlakeClamp;uniform float noiseFlakeRadius;uniform float noiseFlakeRoughnessMod;vec3 perturbNormalArb_nb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
`:""},shaderExtender:(c,e,i)=>{var s;if(!this.enabled||!(!((s=e.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump))return;const a="#glMarker beforeAccumulation";c.fragmentShader=c.fragmentShader.replace(a,`
            vec3 outColor; 
            float voronoiDist = clamp(voronoi_f1_2d( noiseBumpFlakeScale * noiseBumpParams.xy * vUv, 1., noiseFlakeClamp, noiseFlakeRadius, outColor ), 0.0, 1.0);
            normal = perturbNormalArb_nb( - vViewPosition, normal, (2. * outColor.xy - 1.) * noiseBumpScale, faceDirection ); 
            float avg = (outColor.r + outColor.g)*0.5; 
            diffuseColor *= (clamp(avg+0.5, 0.3, 1.));
            float roughnessModifier = mix(1. - avg, 1., noiseFlakeRoughnessMod);
            roughnessFactor *= roughnessModifier;
            
`+a),c.vertexUvs=!0,c.extensionDerivatives=!0},onObjectRender:(c,e)=>{var i;const s=(i=e.materialObject.userData)===null||i===void 0?void 0:i._noiseBumpMat;if(!(s!=null&&s.hasBump))return;this._uniforms.noiseBumpParams.value.fromArray(s.bumpNoiseParams),this._uniforms.noiseBumpScale.value=s.bumpScale,this._uniforms.noiseBumpFlakeScale.value=s.flakeScale,this._uniforms.noiseFlakeClamp.value=s.flakeClamp,this._uniforms.noiseFlakeRadius.value=s.flakeRadius,this._uniforms.noiseFlakeRoughnessMod.value=s.flakeRoughnessMod;const a=this.enabled?1:0;e.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED!==a&&(e.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED=a,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:c=>{var e,i;return(this.enabled?"1":"0")+(!((i=(e=c.materialObject.userData)===null||e===void 0?void 0:e._noiseBumpMat)===null||i===void 0)&&i.hasBump?"1":"0")},isCompatible:c=>c.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:c=>{const e=this._viewer,i={type:"folder",label:"NoiseBumpMaterial",children:[{type:"checkbox",label:"Enabled",get value(){var s;return((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0?void 0:s.hasBump)||!1},set value(s){var a,h;s!==((a=c.materialObject.userData._noiseBumpMat)===null||a===void 0?void 0:a.hasBump)&&(s?Wy(c.materialObject)||e.alert("Cannot add noise bump."):(c.materialObject.userData._noiseBumpMat.hasBump=!1,c.materialObject.needsUpdate=!0),(h=i.uiRefresh)===null||h===void 0||h.call(i,"postFrame",!0))},onChange:this.setDirty},()=>({type:"vec4",label:"Bump Noise Params",bounds:[0,1],hidden:()=>{var s;return!(!((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump)},property:[c.materialObject.userData._noiseBumpMat,"bumpNoiseParams"],onChange:this.setDirty}),()=>({type:"slider",label:"Bump Scale",bounds:[0,.01],stepSize:1e-5,hidden:()=>{var s;return!(!((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump)},property:[c.materialObject.userData._noiseBumpMat,"bumpScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Scale",bounds:[100,1e4],stepSize:1e-4,hidden:()=>{var s;return!(!((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump)},property:[c.materialObject.userData._noiseBumpMat,"flakeScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Clamp",bounds:[0,1],stepSize:1,hidden:()=>{var s;return!(!((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump)},property:[c.materialObject.userData._noiseBumpMat,"flakeClamp"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Radius",bounds:[.1,1],stepSize:.01,hidden:()=>{var s;return!(!((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump)},property:[c.materialObject.userData._noiseBumpMat,"flakeRadius"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Roughness Modifier",bounds:[0,1],stepSize:1,hidden:()=>{var s;return!(!((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump)},property:[c.materialObject.userData._noiseBumpMat,"flakeRoughnessMod"],onChange:this.setDirty})]};return i}},this.setDirty=()=>{var c;(c=this._viewer)===null||c===void 0||c.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}addNoiseBumpMaterial(c){return Wy(c.materialObject)}_loaderCreate({loader:c}){c.isGLTFLoader2&&c.register(e=>new vx(e))}async onAdded(c){var e,i,s,a,h;await super.onAdded(c);const f=c.getPlugin(Kr);(e=f==null?void 0:f.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(i=f==null?void 0:f.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),(h=(a=(s=f==null?void 0:f.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||a===void 0?void 0:a.extensions)===null||h===void 0||h.push(ew)}async onRemove(c){var e,i,s,a;return(i=(e=c.getPlugin(Kr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this.materialExtension),(a=(s=c.getPlugin(Kr))===null||s===void 0?void 0:s.importer)===null||a===void 0||a.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(c)}};function Wy(c){const e=c==null?void 0:c.userData;if(!e)return!1;e._noiseBumpMat||(e._noiseBumpMat={});const i=e._noiseBumpMat;return i.hasBump=!0,i.bumpNoiseParams===void 0&&(i.bumpNoiseParams=[.5,.5]),i.bumpScale===void 0&&(i.bumpScale=.05),i.flakeScale===void 0&&(i.flakeScale=.05),i.flakeClamp===void 0&&(i.flakeClamp=1),i.flakeRadius===void 0&&(i.flakeRadius=.3),i.flakeRoughnessMod===void 0&&(i.flakeRoughnessMod=1),c.isMaterial&&(c.needsUpdate=!0),!0}pp.PluginType="NoiseBumpMaterialPlugin",pp.NOISE_BUMP_MATERIAL_GLTF_EXTENSION="WEBGI_materials_noise_bump",ZA([Jr("Enabled",c=>({onChange:c.setDirty})),jn()],pp.prototype,"enabled",void 0),pp=ZA([Ws("NoiseBumpMaterial Materials")],pp);class vx{constructor(e){this.parser=e,this.name=pp.NOISE_BUMP_MATERIAL_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name];return i.userData||(i.userData={}),Wy(i),i.userData._noiseBumpMat=os(a,i.userData._noiseBumpMat,!1,{}),Promise.resolve()}}const ew=c=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._noiseBumpMat||!e.userData._noiseBumpMat.hasBump)return;i.extensions=i.extensions||{};const s=Wr(e.userData._noiseBumpMat,!1);i.extensions[pp.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=s,c.extensionsUsed[pp.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=!0}});var qy,K0=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};let np=qy=class extends Js{constructor(){super(),this.enabled=!0,this.dependencies=[Kr],this.bicubicFiltering=!0,this._defines={CUSTOM_BUMP_MAP_DEBUG:!1,CUSTOM_BUMP_MAP_BICUBIC:!0},this._uniforms={customBumpUvTransform:{value:new d.Vkp},customBumpScale:{value:.001},customBumpMap:{value:null}},this.materialExtension={parsFragmentSnippet:(c,e)=>this.enabled&&(e!=null&&e.materialObject.userData._hasCustomBump)?`#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
#if CUSTOM_BUMP_MAP_BICUBIC > 0  
vec4 cubic(float v){vec4 n=vec4(1.,2.,3.,4.)-v;vec4 s=n*n*n;float x=s.x;float y=s.y-4.*s.x;float z=s.z-4.*s.y+6.*s.x;float w=6.-x-y-z;return vec4(x,y,z,w)*(1./6.);}vec4 textureBicubic(sampler2D sampler,vec2 texCoords){vec2 texSize=vec2(textureSize(sampler,0));vec2 invTexSize=1./texSize;texCoords=texCoords*texSize-0.5;vec2 fxy=fract(texCoords);texCoords-=fxy;vec4 xcubic=cubic(fxy.x);vec4 ycubic=cubic(fxy.y);vec4 c=texCoords.xxyy+vec2(-0.5,+1.5).xyxy;vec4 s=vec4(xcubic.xz+xcubic.yw,ycubic.xz+ycubic.yw);vec4 offset=c+vec4(xcubic.yw,ycubic.yw)/s;offset*=invTexSize.xxyy;vec4 sample0=texture(sampler,offset.xz);vec4 sample1=texture(sampler,offset.yz);vec4 sample2=texture(sampler,offset.xw);vec4 sample3=texture(sampler,offset.yw);float sx=s.x/(s.x+s.y);float sy=s.z/(s.z+s.w);return mix(mix(sample3,sample2,sx),mix(sample1,sample0,sx),sy);}
#endif
varying vec2 vCustomBumpUv;uniform sampler2D customBumpMap;uniform float customBumpScale;vec2 dHdxy_fwd_cb(){vec2 dSTdx=dFdx(vCustomBumpUv);vec2 dSTdy=dFdy(vCustomBumpUv);
#if CUSTOM_BUMP_MAP_BICUBIC > 0
float Hll=customBumpScale*textureBicubic(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*textureBicubic(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*textureBicubic(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#else
float Hll=customBumpScale*texture2D(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#endif
return vec2(dBx,dBy);}
#ifndef USE_BUMPMAP
vec3 perturbNormalArb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
#endif
#endif
`:"",shaderExtender:(c,e,i)=>{var s;this.enabled&&e.materialObject.userData._hasCustomBump&&(!((s=e.materialObject.userData)===null||s===void 0)&&s._customBumpMap)&&(c.fragmentShader=Ul(c.fragmentShader,"#glMarker beforeAccumulation",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
    normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd_cb(), faceDirection );
#endif
                `,{prepend:!0}),c.vertexShader=Ul(c.vertexShader,"#include <uv_pars_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                varying vec2 vCustomBumpUv;
                uniform mat3 customBumpUvTransform;
#endif
                `,{prepend:!0}),c.vertexShader=Ul(c.vertexShader,"#include <uv_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                vCustomBumpUv = ( customBumpUvTransform * vec3( uv, 1 ) ).xy;
#endif
                `,{prepend:!0}),c.vertexUvs=!0)},onObjectRender:(c,e)=>{var i;const s=e.materialObject.userData;if(!(s!=null&&s._hasCustomBump))return;const a=c;if(!a.isMesh||!a.geometry)return;const h=!((i=s._customBumpMap)===null||i===void 0)&&i.isTexture?s._customBumpMap:null;this._uniforms.customBumpMap.value=h,this._uniforms.customBumpScale.value=h?s._customBumpScale:0,h&&(h.updateMatrix(),this._uniforms.customBumpUvTransform.value.copy(h.matrix));let f=this.enabled&&h?1:0;e.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED!==f&&(e.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED=f,e.materialObject.needsUpdate=!0),f=+this._defines.CUSTOM_BUMP_MAP_DEBUG,e.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG!==f&&(e.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG=f,e.materialObject.needsUpdate=!0),f=+this._defines.CUSTOM_BUMP_MAP_BICUBIC,e.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC!==f&&(e.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC=f,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:c=>{var e,i,s;return(this.enabled?"1":"0")+(!((e=c.materialObject.userData)===null||e===void 0)&&e._hasCustomBump?"1":"0")+((s=(i=c.materialObject.userData)===null||i===void 0?void 0:i._customBumpMap)===null||s===void 0?void 0:s.uuid)},isCompatible:c=>c.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:c=>{const e=this._viewer,i=this.enableCustomBump,s={type:"folder",label:"CustomBumpMap",children:[{type:"checkbox",label:"Enabled",get value(){return c.materialObject.userData._hasCustomBump||!1},set value(a){var h;a!==c.materialObject.userData._hasCustomBump&&(a?i(c)||e.alert("One or more geometries cannot be made anisotropic."):(c.materialObject.userData._hasCustomBump=!1,c.materialObject.needsUpdate=!0),(h=s.uiRefresh)===null||h===void 0||h.call(s,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Bump Scale",hidden:()=>!c.materialObject.userData._hasCustomBump,property:[c.materialObject.userData,"_customBumpScale"],onChange:this.setDirty},{type:"image",label:"Bump Map",hidden:()=>!c.materialObject.userData._hasCustomBump,property:[c.materialObject.userData,"_customBumpMap"],onChange:()=>{c.materialObject.needsUpdate=!0,this.setDirty()}},To(c.materialObject.userData,"_customBumpMap")]};return s}},this.setDirty=()=>{var c,e,i;(e=(c=this.materialExtension).setDirty)===null||e===void 0||e.call(c),(i=this._viewer)===null||i===void 0||i.setDirty()},this.enableCustomBumpSelected=()=>{var c,e,i;const s=(i=(e=(c=this._viewer)===null||c===void 0?void 0:c.getPlugin(Uo))===null||e===void 0?void 0:e.getSelectedObject())===null||i===void 0?void 0:i.material;return(s==null?void 0:s.assetType)==="material"&&this.enableCustomBump(s)},this._loaderCreate=this._loaderCreate.bind(this)}enableCustomBump(c,e,i){var s,a;const h=(s=c.materialObject)===null||s===void 0?void 0:s.userData;if(!h)return!1;if(h._hasCustomBump===void 0){const f=h.__appliedMeshes;let k=!0;if(f)for(const{geometry:et}of f)!et||et.attributes.position&&et.attributes.normal&&et.attributes.uv||(k=!1);if(!k)return!1}return h._hasCustomBump=!0,h._customBumpScale=(a=i??h._customBumpScale)!==null&&a!==void 0?a:.001,h._customBumpMap=e??h._customBumpMap,c.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:c}){c.isGLTFLoader2&&c.register(e=>new _x(e))}async onAdded(c){var e,i,s,a,h;await super.onAdded(c);const f=c.getPlugin(Kr);(e=f==null?void 0:f.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(i=f==null?void 0:f.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),(h=(a=(s=f==null?void 0:f.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||a===void 0?void 0:a.extensions)===null||h===void 0||h.push(OT)}async onRemove(c){var e,i,s,a;return(i=(e=c.getPlugin(Kr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this.materialExtension),(a=(s=c.getPlugin(Kr))===null||s===void 0?void 0:s.importer)===null||a===void 0||a.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(c)}};np.PluginType="CustomBumpMapPlugin",np.CUSTOM_BUMP_MAP_GLTF_EXTENSION="WEBGI_materials_custom_bump_map",K0([Jr("Enabled",c=>({onChange:c.setDirty})),jn()],np.prototype,"enabled",void 0),K0([Jr("Bicubic",c=>({onChange:c.setDirty})),kn("CUSTOM_BUMP_MAP_BICUBIC",void 0,!0,qy.prototype.setDirty),jn()],np.prototype,"bicubicFiltering",void 0),K0([Ao("Enable CustomBumpMap",c=>({hidden:()=>{var e;return!(!((e=c._viewer)===null||e===void 0)&&e.getPlugin(Uo))}}))],np.prototype,"enableCustomBumpSelected",void 0),np=qy=K0([Ws("CustomBumpMap Materials")],np);class _x{constructor(e){this.parser=e,this.name=np.CUSTOM_BUMP_MAP_GLTF_EXTENSION}async extendMaterialParams(e,i){var s;const a=this.parser,h=a.json.materials[e];if(!h.extensions||!h.extensions[this.name])return Promise.resolve();const f=[],k=h.extensions[this.name];i.userData||(i.userData={}),i.userData._hasCustomBump=!0,i.userData._customBumpScale=(s=k.customBumpScale)!==null&&s!==void 0?s:0;const et=k.customBumpMap;return et&&f.push(a.assignTexture(i.userData,"_customBumpMap",et).then(tt=>{tt.encoding=d.knz})),Promise.all(f)}}const OT=c=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._hasCustomBump||(e.userData._customBumpScale||0)<.001)return;i.extensions=i.extensions||{};const s={};if(s.customBumpScale=e.userData._customBumpScale||1,e.userData._customBumpMap){const a={index:c.processTexture(e.userData._customBumpMap)};c.applyTextureTransform(a,e.userData._customBumpMap),s.customBumpMap=a}i.extensions[np.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=s,c.extensionsUsed[np.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=!0}});var AC=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};let $m=class extends Js{constructor(){super(),this.enabled=!0,this.dependencies=[Kr],this._defines={},this._uniforms={ccTintColor:{value:new oo},ccThickness:{value:0},ccIor:{value:0}},this.materialExtension={parsFragmentSnippet:(c,e)=>{var i;return this.enabled&&(!((i=e==null?void 0:e.materialObject.userData._clearcoatTint)===null||i===void 0)&&i.enableTint)&&e.materialObject.clearcoat>0?`
uniform vec3 ccTintColor;
uniform float ccThickness;
uniform float ccIor;
vec3 clearcoatTint(const in float dotNV, const in float dotNL, const in float clearcoat) {
    vec3 tint = ( ccThickness > 0. ? 1. - ccTintColor : ccTintColor); // Set thickness < 0 for glow.
    tint = exp(tint * -(ccThickness * ((dotNL + dotNV) / max(dotNL * dotNV, 1e-3)))); // beer's law
    return mix(vec3(1.0), tint, clearcoat);
}
        `:""},shaderExtender:(c,e,i)=>{var s;if(!(this.enabled&&(!((s=e==null?void 0:e.materialObject.userData._clearcoatTint)===null||s===void 0)&&s.enableTint)&&e.materialObject.clearcoat>0))return;const a="outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;",h="float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );";c.fragmentShader.includes(h)&&c.fragmentShader.includes(a)||console.error("ClearcoatTintPlugin: shaderExtender cannot patch shader, version changed?"),c.fragmentShader=c.fragmentShader.replace(h,`
            float dotNVcc = saturate( dot( geometry.clearcoatNormal, -refract(geometry.viewDir, geometry.clearcoatNormal, 1./ccIor) ) );
            `),c.fragmentShader=c.fragmentShader.replace(a,`
            outgoingLight *= clearcoatTint(dotNVcc, dotNVcc, material.clearcoat);
            `+a),c.vertexUvs=!0},onObjectRender:(c,e)=>{var i;const s=(i=e.materialObject.userData)===null||i===void 0?void 0:i._clearcoatTint;if(!(s!=null&&s.enableTint))return;this._uniforms.ccTintColor.value.set(s.tintColor),this._uniforms.ccThickness.value=s.thickness,this._uniforms.ccIor.value=s.ior;const a=this.enabled?1:0;e.materialObject.defines.CLEARCOAT_TINT_ENABLED!==a&&(e.materialObject.defines.CLEARCOAT_TINT_ENABLED=a,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:c=>{var e,i;return(this.enabled?"1":"0")+(!((i=(e=c.materialObject.userData)===null||e===void 0?void 0:e._clearcoatTint)===null||i===void 0)&&i.enableTint?"1":"0")+(c.materialObject.clearcoat>0?"1":"0")},isCompatible:c=>c.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:c=>{const e=this._viewer,i={type:"folder",label:"ClearcoatTint",children:[{type:"checkbox",label:"Enabled",get value(){var s;return((s=c.materialObject.userData._clearcoatTint)===null||s===void 0?void 0:s.enableTint)||!1},set value(s){var a,h;s!==((a=c.materialObject.userData._clearcoatTint)===null||a===void 0?void 0:a.enableTint)&&(s?mE(c.materialObject)||e.alert("Cannot add clearcoat tint."):(c.materialObject.userData._clearcoatTint.enableTint=!1,c.materialObject.needsUpdate=!0),(h=i.uiRefresh)===null||h===void 0||h.call(i,"postFrame",!0))},onChange:this.setDirty},()=>({type:"color",label:"Tint color",hidden:()=>{var s;return!(!((s=c.materialObject.userData._clearcoatTint)===null||s===void 0)&&s.enableTint)},property:[c.materialObject.userData._clearcoatTint,"tintColor"],onChange:this.setDirty}),()=>({type:"input",label:"Thickness",hidden:()=>{var s;return!(!((s=c.materialObject.userData._clearcoatTint)===null||s===void 0)&&s.enableTint)},property:[c.materialObject.userData._clearcoatTint,"thickness"],onChange:this.setDirty}),()=>({type:"slider",bounds:[.8,2.5],label:"IOR",hidden:()=>{var s;return!(!((s=c.materialObject.userData._clearcoatTint)===null||s===void 0)&&s.enableTint)},property:[c.materialObject.userData._clearcoatTint,"ior"],onChange:this.setDirty})]};return i}},this.setDirty=()=>{var c;(c=this._viewer)===null||c===void 0||c.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}addClearcoatTint(c){return mE(c.materialObject)}_loaderCreate({loader:c}){c.isGLTFLoader2&&c.register(e=>new LT(e))}async onAdded(c){var e,i,s,a,h;await super.onAdded(c);const f=c.getPlugin(Kr);(e=f==null?void 0:f.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(i=f==null?void 0:f.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),(h=(a=(s=f==null?void 0:f.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||a===void 0?void 0:a.extensions)===null||h===void 0||h.push(wC)}async onRemove(c){var e,i,s,a;return(i=(e=c.getPlugin(Kr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this.materialExtension),(a=(s=c.getPlugin(Kr))===null||s===void 0?void 0:s.importer)===null||a===void 0||a.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(c)}};function mE(c){const e=c==null?void 0:c.userData;if(!e)return!1;e._clearcoatTint||(e._clearcoatTint={});const i=e._clearcoatTint;return i.enableTint=!0,i.tintColor===void 0&&(i.tintColor=16777215),i.thickness===void 0&&(i.thickness=.1),i.ior===void 0&&(i.ior=1.5),c.isMaterial&&(c.needsUpdate=!0),!0}$m.PluginType="ClearcoatTintPlugin",$m.CLEARCOAT_TINT_GLTF_EXTENSION="WEBGI_materials_clearcoat_tint",AC([Jr("Enabled",c=>({onChange:c.setDirty})),jn()],$m.prototype,"enabled",void 0),$m=AC([Ws("ClearcoatTint Materials")],$m);class LT{constructor(e){this.parser=e,this.name=$m.CLEARCOAT_TINT_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name];return i.userData||(i.userData={}),mE(i),i.userData._clearcoatTint=os(a,i.userData._clearcoatTint,!1,{}),Promise.resolve()}}const wC=c=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._clearcoatTint||!e.userData._clearcoatTint.enableTint)return;i.extensions=i.extensions||{};const s=Wr(e.userData._clearcoatTint,!1);i.extensions[$m.CLEARCOAT_TINT_GLTF_EXTENSION]=s,c.extensionsUsed[$m.CLEARCOAT_TINT_GLTF_EXTENSION]=!0}});var xC=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};let yx=class extends Go{constructor(c,e,i){super(c,e,i??new NT,new oo(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(c,e,i,s,a){if(!this.enabled)return;const h=this.overrideMaterial;h.uniforms.currentProjectionViewMatrix.value.copy(this.camera.projectionMatrix).multiply(this.camera.matrixWorldInverse),this._firstCall&&(h.uniforms.lastProjectionViewMatrix.value.copy(h.uniforms.currentProjectionViewMatrix.value),this._firstCall=!1),super.render(c,e,i,s,a),h.uniforms.lastProjectionViewMatrix.value.copy(h.uniforms.currentProjectionViewMatrix.value)}};xC([Jr("Enabled")],yx.prototype,"enabled",void 0),yx=xC([Ws("Velocity Buffer (TAA)")],yx);class NT extends d.jyz{constructor(){super({vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 modelMatrixPrevious;void main(){
#include <uv_vertex>
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
vec4 mvPosition=vec4(transformed,1.);
#ifdef USE_INSTANCING
mvPosition=instanceMatrix*mvPosition;
#endif
vWorldPosition=(modelMatrix*mvPosition).xyz;vWorldPositionPrevious=(modelMatrixPrevious*mvPosition).xyz;mvPosition=modelViewMatrix*mvPosition;gl_Position=projectionMatrix*mvPosition;
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
}`,fragmentShader:"varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 currentProjectionViewMatrix;uniform mat4 lastProjectionViewMatrix;vec2 computeScreenSpaceVelocity2(){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(vWorldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(vWorldPositionPrevious,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}void main(){vec2 velocity=clamp(computeScreenSpaceVelocity2(),-1.,1.);velocity=sign(velocity)*pow(abs(velocity),vec2(1./4.));velocity=velocity*0.5+0.5;gl_FragColor=vec4(velocity.x,velocity.y,1.,1.);}",uniforms:{cameraNearFar:{value:new d.FM8(.1,1e3)},alphaMap:{value:null},alphaTest:{value:null},currentProjectionViewMatrix:{value:new d.yGw},lastProjectionViewMatrix:{value:new d.yGw}}}),this.extraUniformsToUpload={modelMatrixPrevious:{value:new d.yGw().identity()}},this._previousWorldMatrices={}}onBeforeRender(e,i,s,a,h){var f,k;const et=this._previousWorldMatrices[h.uuid];this.extraUniformsToUpload.modelMatrixPrevious.value.copy(et??h.matrixWorld),et?et.copy(h.matrixWorld):this._previousWorldMatrices[h.uuid]=h.matrixWorld.clone();let tt=h.material;Array.isArray(tt)&&(tt=tt[0]),this.uniforms.alphaMap.value=(f=tt==null?void 0:tt.alphaMap)!==null&&f!==void 0?f:null,this.uniforms.alphaTest.value=!tt||!tt.alphaTest||tt.alphaTest<1e-7?.001:tt.alphaTest;let rt=this.uniforms.alphaMap.value?1:void 0;rt!==this.defines.USE_ALPHAMAP&&(rt===void 0?delete this.defines.USE_ALPHAMAP:this.defines.USE_ALPHAMAP=rt,this.needsUpdate=!0),rt=tt.userData.ALPHA_I_RGBA_PACKING?1:void 0,rt!==this.defines.ALPHA_I_RGBA_PACKING&&(rt===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=rt,this.needsUpdate=!0),this.side=(k=tt.side)!==null&&k!==void 0?k:d.ehD}}class Ax extends wv{constructor(e=!0){super(),this.passId="velocityBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._velocityBuffers=[],this.enabled=e}passCtor(e){const i=e.renderer.createTarget({depthBuffer:!0,type:d.ywz});i.texture.name="velocityBuffer",this._velocityBuffers.push(i),e.getPluginByType("debug");const s=new Set,a=new Set;return new class extends yx{render(h,f,k,et,tt){if(e.renderer.frameCount>0)return;const rt=h.getRenderTarget(),lt=h.getActiveCubeFace(),pt=h.getActiveMipmapLevel();this.scene.traverse(({material:ft})=>{ft&&((ft.transparent&&ft.userData.renderToDepth||!ft.transparent&&ft.transmission===0&&ft.userData.renderToDepth===!1)&&(s.add(ft),ft.transparent=!ft.transparent),Math.abs(ft.transmission||0)>0&&ft.userData.renderToDepth&&(a.add([ft,ft.transmission]),ft.transmission=0))}),Lr(h,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(h,f,i,et,tt)),s.forEach(ft=>ft.transparent=!ft.transparent),s.clear(),a.forEach(([ft,vt])=>ft.transmission=vt),a.clear(),h.setRenderTarget(rt,lt,pt)}}}_update(e){if(!super._update(e)||e.renderer.frameCount>0)return!1;const i=this.pass.passObject;return i.scene=e.scene.modelObject,e.scene.activeCamera.updateShaderProperties(i.overrideMaterial),i.camera=e.scene.activeCamera.cameraObject,!0}getVelocityBuffer(){return this._velocityBuffers.length>0?this._velocityBuffers[0]:void 0}async onDispose(e){}async onRemove(e){return this._velocityBuffers.forEach(i=>{var s;return e.renderer.disposeTarget((s=i==null?void 0:i.dispose)===null||s===void 0?void 0:s.call(i))}),super.onRemove(e)}updateShaderProperties(e){var i,s;return e.uniforms.tVelocity?e.uniforms.tVelocity.value=this.enabled&&(s=(i=this.getVelocityBuffer())===null||i===void 0?void 0:i.texture)!==null&&s!==void 0?s:null:console.warn("BaseRenderer: no uniform: tVelocity"),this}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}Ax.PluginType="VelocityBuffer";class bC extends bu{constructor(e,i){super({vertexShader:nt.vertexShader,fragmentShader:i+`
`+Hw+`
#include <common>
varying vec2 vUv;uniform vec2 previousRTSize;uniform mat4 lastProjectionViewMatrix;uniform mat4 currentProjectionViewMatrix;uniform mat4 inverseViewMatrix;uniform vec2 jitterSample;uniform vec2 feedBack;uniform bool firstFrame;
#if HAS_VELOCITY_BUFFER == 1
uniform sampler2D tVelocity;
#endif
vec3 find_closest_fragment_3x3(const in vec2 uv){const vec3 offset=vec3(-1.,1.,0.);vec2 texelSize=1./previousRTSize;vec3 dtr=vec3(-1,1,getDepth(uv+offset.yx*texelSize));vec3 dtc=vec3(0,1,getDepth(uv+offset.zx*texelSize));vec3 dtl=vec3(1,1,getDepth(uv+offset.xx*texelSize));vec3 dml=vec3(-1,0,getDepth(uv+offset.yz*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dmr=vec3(1,0,getDepth(uv+offset.xz*texelSize));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.yy*texelSize));vec3 dbc=vec3(0,-1,getDepth(uv+offset.zy*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.xy*texelSize));vec3 dmin=dtl;if(dmin.z>dtc.z)dmin=dtc;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dml.z)dmin=dml;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dmr.z)dmin=dmr;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbc.z)dmin=dbc;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+texelSize.xy*dmin.xy,dmin.z);}vec3 find_closest_fragment_5tap(const in vec2 uv){vec2 texelSize=1./previousRTSize;vec2 offset=vec2(1.,-1.);vec3 dtl=vec3(-1,1,getDepth(uv+offset.yx*texelSize));vec3 dtr=vec3(1,1,getDepth(uv+offset.xx*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.yy*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.xy*texelSize));vec3 dmin=dtl;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+dmin.xy*texelSize,dmin.z);}vec4 clip_aabb(const in vec4 aabb_min,const in vec4 aabb_max,vec4 p){const float FLT_EPS=1e-8;vec4 p_clip=0.5*(aabb_max+aabb_min);vec4 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=p-p_clip;vec4 v_unit=abs(v_clip/e_clip);float ma_unit=max(v_unit.x,max(v_unit.y,v_unit.z));if(ma_unit>1.)return p_clip+v_clip/ma_unit;else return p;}
#if HAS_VELOCITY_BUFFER == 0
vec2 computeScreenSpaceVelocity(const in vec3 worldPosition){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(worldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(worldPosition,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}
#endif
vec4 computeTAA(const in vec2 uv,const in vec2 screenSpaceVelocity){vec2 jitterOffset=jitterSample/previousRTSize;vec2 uvUnJitter=uv;vec4 currentColor=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter));vec4 previousColor=previousRTTexelToLinear(texture2D(previousRT,uv-screenSpaceVelocity));const vec3 offset=vec3(1.,-1.,0.);vec2 texelSize=1./previousRTSize;float texelSpeed=length(screenSpaceVelocity);vec4 tl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yx*texelSize));vec4 tc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zx*texelSize));vec4 tr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xx*texelSize));vec4 ml=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yz*texelSize));vec4 mc=currentColor;vec4 mr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xz*texelSize));vec4 bl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yy*texelSize));vec4 bc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zy*texelSize));vec4 br=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xy*texelSize));vec4 corners=2.*(tr+bl+br+tl)-2.*mc;mc+=(mc-(corners*0.166667))*2.718282*0.3;mc=max(vec4(0.),mc);vec4 min5=min(tc,min(ml,min(mc,min(mr,bc))));vec4 max5=max(tc,max(ml,max(mc,max(mr,bc))));vec4 cmin=min(min5,min(tl,min(tr,min(bl,br))));vec4 cmax=max(min5,max(tl,max(tr,max(bl,br))));;cmin=0.5*(cmin+min5);cmax=0.5*(cmax+max5);previousColor=clip_aabb(cmin,cmax,previousColor);float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColor.rgb);float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedBack.x,feedBack.y,unbiased_weight_sqr);return mix(currentColor,previousColor,k_feedback);}vec3 getWorldPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return(inverseViewMatrix*vec4(xe,ye,viewDepth,1.)).xyz;}void main(){vec2 jitterOffset=jitterSample/previousRTSize;
#if QUALITY == 1
vec3 c_frag=find_closest_fragment_3x3(vUv);
#else
vec3 c_frag=find_closest_fragment_5tap(vUv);
#endif
if(c_frag.z>=0.999){gl_FragColor=currentRTTexelToLinear(texture2D(currentRT,vUv-jitterOffset));}else{float sampleViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,c_frag.z);vec3 worldPosition=getWorldPositionFromViewZ(c_frag.xy,sampleViewZ);
#if HAS_VELOCITY_BUFFER == 0
vec2 screenSpaceVelocity=computeScreenSpaceVelocity(worldPosition);
#else
vec2 screenSpaceVelocity=(texture2D(tVelocity,vUv).xy*2.-1.);screenSpaceVelocity=sign(screenSpaceVelocity)*pow(abs(screenSpaceVelocity),vec2(4.));
#endif
gl_FragColor=firstFrame?currentRTTexelToLinear(texture2D(currentRT,vUv)):computeTAA(vUv,screenSpaceVelocity);}
#include <encodings_fragment>
}`,uniforms:{currentRT:{value:null},previousRT:{value:null},previousRTSize:{value:new d.FM8},cameraNearFar:{value:new d.FM8},lastProjectionViewMatrix:{value:new d.yGw},currentProjectionViewMatrix:{value:new d.yGw},projection:{value:new d.yGw},inverseViewMatrix:{value:new d.yGw},jitterSample:{value:new d.FM8},firstFrame:{value:!0},tNormalDepth:{value:null},tVelocity:{value:null}},defines:{HAS_VELOCITY_BUFFER:0,QUALITY:1,UNJITTER:0}},"currentRT","previousRT"),this.taaEnabled=!0,this.feedBack=new d.FM8(.88,.97),this.uiConfig={type:"folder",label:"Temporal AA",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:()=>this.onSizeUpdate()},{type:"input",label:"Feedback",property:[this,"feedBack"],onChange:this.setDirty}]},this.onSizeUpdate=this.onSizeUpdate.bind(this),this.target=e,this.clear=!1,this.needsSwap=!0}render(e,i,s,a,h){if(!this.taaEnabled||!this.enabled)return void(this.needsSwap=!1);this.needsSwap=!0;const f=this.uniforms.tVelocity.value?1:0;f!==this.material.defines.HAS_VELOCITY_BUFFER&&(this.material.defines.HAS_VELOCITY_BUFFER=f,this.material.needsUpdate=!0),this.uniforms.previousRT.value=this.target.texture,super.render(e,i,s,a,h),this.uniforms.lastProjectionViewMatrix.value.copy(this.uniforms.currentProjectionViewMatrix.value),this.uniforms.firstFrame.value=!1}updateCameraProperties(e){e&&(this.uniforms.currentProjectionViewMatrix.value.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this.uniforms.inverseViewMatrix.value.copy(e.matrixWorld))}onSizeUpdate(){this.uniforms.firstFrame.value=!0,this.setDirty()}setSize(e,i){super.setSize(e,i),this.onSizeUpdate()}}(function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);h>3&&f&&Object.defineProperty(e,i,f)})([jn(),dn()],bC.prototype,"feedBack",void 0);class wx extends wv{constructor(){super(...arguments),this.passId="taa",this._beforeFilters=["progressive"],this._afterFilters=[],this._requiredFilters=["render","progressive"],this.dependencies=[ba]}passCtor(e){if(!e.getPlugin(dp))throw"Add ProgressivePlugin before TAA";const i=new bC(e.getPlugin(dp).lastFrame,e.getPlugin(ba).getUnpackSnippet());return e.renderer.addEventListener("resize",i.onSizeUpdate),i}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}async onDispose(e){return this.pass&&e.renderer.removeEventListener("resize",this.pass.passObject.onSizeUpdate),super.onDispose(e)}_update(e){if(!super._update(e))return!1;const i=e.renderer.frameCount,s=this._pass.passObject;if(s.taaEnabled=i<1,!s.taaEnabled)return!1;const a=e.scene.activeCamera;return s.updateShaderProperties([e.getPlugin(ba),a,e.getPluginByType("VelocityBuffer")]),s.target=e.getPlugin(dp).lastFrame,s.updateCameraProperties(a==null?void 0:a.cameraObject),!0}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}wx.PluginType="TAA";class EC{static async GetDataUrl(e,{mimeType:i="image/png",rect:s={x:0,y:0,width:e.width,height:e.height,assumeClientRect:!1},displayPixelRatio:a=1,scale:h=1}){var f,k,et;const tt=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");tt.width=s.width*h*a,tt.height=s.height*h*a,s.assumeClientRect&&(s.x*=e.width/(a*e.clientWidth),s.y*=e.height/(a*e.clientHeight),s.width*=e.width/(a*e.clientWidth),s.height*=e.height/(a*e.clientHeight));const rt=tt.getContext("2d");if(!rt)return console.error("snapshot: cannot create context"),"";const lt=e.style.background||((f=e.parentElement)===null||f===void 0?void 0:f.style.background)||"";if(lt.includes("url")){const ft=(k=/url\("(.*)"\)/gi.exec(lt))===null||k===void 0?void 0:k[1];if(ft){const vt=new Image;vt.src=ft,await new Promise((yt,Mt)=>{vt.onload=()=>yt(),vt.onerror=()=>Mt(),vt.complete&&yt()}),rt.drawImage(vt,vt.width*s.x*a/e.width,vt.height*s.y*a/e.height,vt.width*s.width*a/e.width,vt.height*s.height*a/e.height,0,0,tt.width,tt.height)}}else rt.fillStyle=e.style.background||((et=e.parentElement)===null||et===void 0?void 0:et.style.backgroundColor)||"#00000000",rt.fillRect(0,0,tt.width,tt.height);rt==null||rt.drawImage(e,s.x*a,s.y*a,s.width*a,s.height*a,0,0,tt.width,tt.height);const pt=rt.canvas.toDataURL(i);return tt.remove(),pt}static async GetImage(e,i={}){const s=await this.GetDataUrl(e,i);return new Promise((a,h)=>{const f=new Image;f.onload=()=>{a(f)},f.src=s})}static async GetBlob(e,i={}){return await(await fetch(await this.GetDataUrl(e,i))).blob()}static async GetFile(e,i="image.png",s={}){var a;return s.getDataUrl?await this.GetDataUrl(e,s):new File([await this.GetBlob(e,s)],i,{type:(a=s.mimeType)!==null&&a!==void 0?a:"image/png",lastModified:mo()})}}var Pm=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};let gm=class extends Js{constructor(){super(),this.enabled=!0,this.downloadSnapshot=this.downloadSnapshot.bind(this)}async getFile(c,e={}){return e.getDataUrl=!1,await this._getFile(c,e)}async getDataUrl(c={}){var e;return c.getDataUrl=!0,(e=await this._getFile("",c))!==null&&e!==void 0?e:""}async _getFile(c,e={}){var i,s,a;const h=(i=this._viewer)===null||i===void 0?void 0:i.canvas;if(h){const f=this._viewer.renderer.displayCanvasScaling;e.displayPixelRatio!==void 0&&e.displayPixelRatio!==f&&(this._viewer.renderer.displayCanvasScaling=e.displayPixelRatio);const k=(s=this._viewer)===null||s===void 0?void 0:s.getPlugin(dp);if(e.waitForProgressive&&k&&e.timeout===void 0)for(;!k.isConverged(!0);)await au(64);else await au((a=e.timeout)!==null&&a!==void 0?a:200);e.displayPixelRatio=1;const et=await EC.GetFile(h,c,e);return e.displayPixelRatio=this._viewer.renderer.displayCanvasScaling,this._viewer.renderer.displayCanvasScaling=f,et}}async downloadSnapshot(c="snapshot.png",e={}){const i=await this.getFile(c,e);i&&Xp(i)}};gm.PluginType="CanvasSnipper",Pm([Ao("Download .png",{limitedUi:!0})],gm.prototype,"downloadSnapshot",null),gm=Pm([Ws("Image Export")],gm);var tu=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};let FT=1,Fp=class{constructor(c,e,i,s,a){this.position=new d.Pa4,this.target=new d.Pa4,this.quaternion=new d._fP,this.up=new d.Pa4,this.name="Camera View",this.snap="",this.focusView=()=>{},this.deleteView=()=>{},this.uiConfig=Yp(this.name,this),c&&(this.position=c),e&&(this.target=e),i&&(this.up=i),s&&(this.quaternion=s),a&&(this.snap=a),this.name="Camera View"+FT++}_nameChanged(){var c,e;this.uiConfig&&(this.uiConfig.label=this.name,(e=(c=this.uiConfig).uiRefresh)===null||e===void 0||e.call(c))}};tu([jn(),Qo()],Fp.prototype,"position",void 0),tu([jn(),Qo()],Fp.prototype,"target",void 0),tu([jn(),Qo()],Fp.prototype,"quaternion",void 0),tu([jn(),Qo()],Fp.prototype,"up",void 0),tu([jn(),so()],Fp.prototype,"name",void 0),tu([Ku()],Fp.prototype,"snap",void 0),tu([Ao()],Fp.prototype,"focusView",void 0),tu([Ao()],Fp.prototype,"deleteView",void 0),Fp=tu([ss("CameraView")],Fp);class lu extends Js{constructor(){super(),this.enabled=!0,this._cameraViews=[],this.viewLooping=!1,this.viewPauseTime=200,this.animEase="easeInOutSine",this.animDuration=1e3,this.rotationOffset=.25,this.interpolateMode="spherical",this.animateOnScroll=!1,this.seekOnScroll=!1,this._animating=!1,this.dependencies=[],this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this._updaters=[],this._lastFrameTime=0,this._fadeDisabled=!1,this._viewQueue=[],this._animationLooping=!1,this._infiniteLooping=!0,this._driver=e=>({start:()=>this._updaters.push({u:e,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(i=>i.u===e),1)}),this.focusNext=(e=!0)=>{if(this._animating||this._cameraViews.length<2)return;let i=this._cameraViews.findIndex(s=>s===this._currentView);i<0&&(i=-1),i+=1,e?i%=this._cameraViews.length:i=Math.min(i,this._cameraViews.length-1),this.focusView(this._cameraViews[i])},this.focusPrevious=(e=!0)=>{if(this._animating||this._cameraViews.length<2||!this._currentView)return;let i=this._cameraViews.findIndex(s=>s===this._currentView);i<0&&(i=0),i-=1,i=e?(i+this._cameraViews.length)%this._cameraViews.length:Math.max(i,0),this.focusView(this._cameraViews[i])},this._popAnimations=[],this.uiConfig={type:"folder",label:"Camera Views",children:[()=>[...this._cameraViews.map(e=>e.uiConfig)],...Ap(this)]},this.addCurrentView=this.addCurrentView.bind(this),this.animateAllViews=this.animateAllViews.bind(this),this.recordAllViews=this.recordAllViews.bind(this),this.resetToFirstView=this.resetToFirstView.bind(this),this._wheel=this._wheel.bind(this),this._pointerMove=this._pointerMove.bind(this),this._postFrame=this._postFrame.bind(this)}get animationLooping(){return this._animationLooping}get animating(){return this._animating}get camViews(){return this._cameraViews}_wheel(e){this.enabled&&(this.seekOnScroll&&!this._animating||Math.abs(e.deltaY)>.001&&(this._scrollAnimationState=-1*Math.sign(e.deltaY)))}_pointerMove(e){var i;if(this.enabled&&!this._animating&&this.seekOnScroll){const s=(i=this._viewer)===null||i===void 0?void 0:i.scene.activeCamera;if(!s)return;const a=new d.$V,h=s.position,f=s.target,k=new d._fP().setFromUnitVectors(s.cameraObject.up,new d.Pa4(0,1,0)),et=k.clone().invert(),tt=h.clone().sub(f);tt.applyQuaternion(k),a.setFromVector3(tt),a.theta+=this.rotationOffset*e.movementX/this._viewer.canvas.clientWidth,a.phi+=this.rotationOffset*e.movementY/this._viewer.canvas.clientHeight,a.makeSafe(),tt.setFromSpherical(a),tt.applyQuaternion(et),h.copy(f).add(tt),s.positionUpdated(!1),s.targetUpdated()}}async onAdded(e){await super.onAdded(e);let i=!1;e.addEventListener("preFrame",s=>{this.seekOnScroll||this._animating?this._viewer.scene.activeCamera.interactionsEnabled&&(this._viewer.scene.activeCamera.interactionsEnabled=!1,i=!0):i&&(this._viewer.scene.activeCamera.interactionsEnabled=!0,i=!1)}),e.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),window.addEventListener("pointermove",this._pointerMove)}_postFrame(){var e,i;if(!this._viewer)return;if(!this.enabled||!this._animating)return this._lastFrameTime=0,void(this._fadeDisabled&&((e=this._viewer.getPluginByType("FrameFade"))===null||e===void 0||e.enable(lu.PluginType),this._fadeDisabled=!1));const s=mo()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=s-1/60);let a=s-this._lastFrameTime;this._lastFrameTime=s,a*=this.animateOnScroll?this._scrollAnimationState:1;const h=(i=this._viewer.getPluginByType("Progressive"))===null||i===void 0?void 0:i.postFrameConvergedRecordingDelta();if(h&&h>0&&(a=h),h!==0&&(a*=1e3,!(a<=0||(this._updaters.forEach(f=>{let k=a;f.time+k<0&&(k=-f.time),f.time+=k,Math.abs(k)>.001&&f.u(k)}),this._scrollAnimationState<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,this._fadeDisabled)))){const f=this._viewer.getPluginByType("FrameFade");f&&(f.disable(lu.PluginType),this._fadeDisabled=!0)}}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),window.removeEventListener("pointermove",this._pointerMove),super.onRemove(e)}async _animationLoop(){if(!this._animationLooping){for(this._animationLooping=!0;(this.viewLooping||!this._infiniteLooping)&&this.enabled&&!(this._cameraViews.length<1);){if(this._viewQueue.length===0){if(!this._infiniteLooping)break;this._viewQueue.push(...this._cameraViews)}await this.animateToView(this._viewQueue.shift()),await au(2+this.viewPauseTime)}this._animationLooping=!1}}async animateAllViews(){if(this.enabled&&!(this.viewLooping||this._cameraViews.length<2)){for(;this._viewQueue.length>0;)this._viewQueue.pop();this._viewQueue.push(...this._cameraViews),this._viewQueue.push(this._viewQueue.shift()),this._infiniteLooping=!1,await this._animationLoop(),this._infiniteLooping=!0}}async resetToFirstView(e=100){this.enabled&&(this._currentView=void 0,await this.animateToView(this._cameraViews[0],e),await au(2))}async recordAllViews(e){var i;if(!this.enabled)return;const s=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("CanvasRecorder");return s&&s.enabled&&(await this.resetToFirstView(),s.startRecording())?new Promise((a,h)=>{const f=()=>{s.removeEventListener("start",k),s.removeEventListener("stop",f),s.removeEventListener("error",et)},k=async()=>{f(),e==null||e(),await this.animateAllViews();const tt=await s.stopRecording();tt&&Du(tt,"recording.mp4"),a()},et=async()=>{f(),h()};s.addEventListener("start",k),s.addEventListener("stop",f),s.addEventListener("error",et)}):void 0}async addCurrentView(){var e,i,s,a,h;if(!this.enabled)return;const f=(e=this._viewer)===null||e===void 0?void 0:e.scene.activeCamera;if(!f)return;const k=this.getCurrentCameraView(f);k.snap=await((s=(i=this._viewer)===null||i===void 0?void 0:i.getPlugin(gm))===null||s===void 0?void 0:s.getDataUrl({displayPixelRatio:.25,mimeType:"image/jpg"}))||"",this._cameraViews.push(k),(h=(a=this.uiConfig).uiRefresh)===null||h===void 0||h.call(a)}getCurrentCameraView(e){var i;if(e||(e=(i=this._viewer)===null||i===void 0?void 0:i.scene.activeCamera),!e)return new Fp;const s=new d.Pa4,a=e.cameraObject.matrixWorld;s.x=a.elements[4],s.y=a.elements[5],s.z=a.elements[6];const h=new Fp(e.position.clone(),e.target.clone(),s.normalize(),e.cameraObject.quaternion.clone(),"");return h.focusView=async()=>this.focusView(h),h.deleteView=()=>this.deleteView(h),h}async focusView(e){return this.animateToView(e)}deleteView(e){var i,s;const a=this._cameraViews.indexOf(e);a>=0&&this._cameraViews.splice(a,1),(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i)}async stopAllAnimations(){for(this.viewLooping=!1,this._popAnimations.forEach(e=>{var i;return(i=e==null?void 0:e.stop)===null||i===void 0?void 0:i.call(e)}),this._popAnimations=[];this._animating||this._animationLooping;)await au(100)}async animateToView(e,i,s){var a;const h=(a=this._viewer)===null||a===void 0?void 0:a.scene.activeCamera;if(!h)return;if(this._animating&&(this._popAnimations.forEach(rt=>{var lt;return(lt=rt==null?void 0:rt.stop)===null||lt===void 0?void 0:lt.call(rt)}),await au(100),this._animating))return void console.warn("todo: still animating?");this._currentView=e,this._animating=!0,this.dispatchEvent({type:"startViewChange",view:e}),i===void 0&&(i=this.animDuration);const f=typeof s=="function"?s:Qy[s||this.animEase],k=this._driver,et=[];this._popAnimations=[];const tt=this._popAnimations;if(this.interpolateMode==="spherical")et.push(async function(rt,lt,pt,ft,vt,yt){const Mt=rt.target.clone(),xt=new d.Pa4,Et=new d.Pa4,At=Yy(rt.cameraObject,Mt),Rt=Yy(lt,lt.target),Bt=new d.$V;return xx({from:0,to:1,duration:pt,ease:ft,driver:vt,onUpdate:Qt=>{Bt.phi=gE(At.phi,Rt.phi,Qt),Bt.theta=gE(At.theta,Rt.theta,Qt),Bt.radius=Ll(At.radius,Rt.radius,Qt),xt.copy(Mt).lerp(lt.target,Qt),Et.setFromSpherical(Bt),Et.add(xt),rt.position=Et,rt.target=xt,rt.positionUpdated(!1),rt.targetUpdated()},onComplete:()=>{rt.position=lt.position,rt.target=lt.target,rt.positionUpdated(!1),rt.targetUpdated()}},yt)}(h,e,i,f,k,tt));else if(this.interpolateMode==="linear"){et.push(xx({from:h.position.clone(),to:e.position.clone(),duration:i,ease:f,driver:k,onUpdate:pt=>h.position=pt,onComplete:()=>h.position=e.position},tt)),et.push(xx({from:h.target.clone(),to:e.target.clone(),duration:i,ease:f,driver:k,onUpdate:pt=>{h.target=pt,h.targetUpdated()},onComplete:()=>{h.target=e.target,h.targetUpdated()}},tt));const rt=h.cameraObject.quaternion.clone(),lt=new d._fP;et.push(xx({from:0,to:1,duration:i,ease:f,driver:k,onUpdate:pt=>{lt.copy(rt).slerp(e.quaternion,pt),h.cameraObject.quaternion.copy(lt),h.cameraObject.updateProjectionMatrix()},onComplete:()=>{h.cameraObject.quaternion.copy(e.quaternion),h.cameraObject.updateProjectionMatrix()}},tt))}await Promise.all(et),this._animating=!1,this.dispatchEvent({type:"viewChange",view:e}),await au(10)}fromJSON(e,i){var s,a;return this._cameraViews.forEach(h=>this.deleteView(h)),super.fromJSON(e,i)?(this._cameraViews.forEach(h=>h.focusView=async()=>this.focusView(h)),this._cameraViews.forEach(h=>h.deleteView=()=>this.deleteView(h)),(a=(s=this.uiConfig).uiRefresh)===null||a===void 0||a.call(s),this):null}async animateToObject(e,i=4,s,a,h={min:.5,max:5}){if(!this._viewer)return;const f=new sr().expandByObject(e||this._viewer.scene.modelRoot.modelObject,!1,!0),k=f.getCenter(new d.Pa4),et=f.getSize(new d.Pa4).length()/2;await this.animateToTarget(Math.min(h.max,Math.max(h.min,et*i)),k,s,a)}async animateToTarget(e,i,s,a){const h=this.getCurrentCameraView();h.target.copy(i);const f=new d.Pa4().subVectors(h.target,h.position).normalize();h.position.copy(f.multiplyScalar(-e).add(h.target)),await this.animateToView(h,s,a)}}async function xx(c,e){const i=c.onComplete,s=c.onStop;return c={...c},new Promise((a,h)=>{c.onComplete=()=>{i==null||i(),a()},c.onStop=()=>{s==null||s(),a()};const f=XA(c);e.push(f)})}function Yy(c,e){const i=c.position.clone();i.sub(e);const s=new d.$V().setFromVector3(i);return s.makeSafe(),s}function gE(c,e,i){const s=e-c;return s>=Math.PI?c+(s-2*Math.PI)*i:s<=-Math.PI?c+(s+2*Math.PI)*i:c+s*i}function SC(c,e,i){const s=(1-i)*Math.cos(c)+i*Math.cos(e),a=(1-i)*Math.sin(c)+i*Math.sin(e);return Math.atan2(a,s)}lu.PluginType="CameraViews",tu([jn("cameraViews")],lu.prototype,"_cameraViews",void 0),tu([hn(lu.prototype._animationLoop),jn(),Jr("Loop All Views",{limitedUi:!0})],lu.prototype,"viewLooping",void 0),tu([jn(),so("View Pause Time")],lu.prototype,"viewPauseTime",void 0),tu([jn(),vu("Ease",Object.keys(Qy).map(c=>({label:c})))],lu.prototype,"animEase",void 0),tu([jn(),Xr("Duration",[10,1e4],10,{limitedUi:!0})],lu.prototype,"animDuration",void 0),tu([jn(),Xr("RotationOffset",[.2,.75],.01)],lu.prototype,"rotationOffset",void 0),tu([jn(),vu("Interpolation",["spherical","linear"].map(c=>({label:c})))],lu.prototype,"interpolateMode",void 0),tu([Jr(),jn()],lu.prototype,"seekOnScroll",void 0),tu([Ao("Animate All Views",{limitedUi:!0})],lu.prototype,"animateAllViews",null),tu([Ao("Record All Views")],lu.prototype,"recordAllViews",null),tu([Ao("Add Current View")],lu.prototype,"addCurrentView",null),tu([Ao("Focus Next")],lu.prototype,"focusNext",void 0),tu([Ao("Focus Previous")],lu.prototype,"focusPrevious",void 0);const CC=new d.Pa4;function Dv(c,e,i){let s=c.dot(e);s=Math.min(Math.max(s,-1),1);const a=Math.acos(s)*i;return CC.copy(c).multiplyScalar(s).sub(e).negate().normalize(),c.multiplyScalar(Math.cos(a)).add(CC.multiplyScalar(Math.sin(a)))}var $_=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};class J_ extends Js{constructor(e=!0){super(),this.enabled=!0,this.light=new px("#cceeff",1),this.lightLayers=1,this._preRender=()=>{var i,s,a;if(!this.enabled)return void(this.light.layers.mask=0);const h=(s=(i=this._viewer)===null||i===void 0?void 0:i.renderer.frameCount)!==null&&s!==void 0?s:0;(h<1||h>5)&&this.light.randomizePosition(h<5?0:h),this.light.layers.mask=this.lightLayers,this.light.updateShadowParams(),(a=this._cameraHelper)===null||a===void 0||a.update()},this._setDirty=this._setDirty.bind(this),this.enabled=e}get cameraHelper(){return this._cameraHelper}async onAdded(e){await super.onAdded(e),this._cameraHelper=new d.Rki(this.light.shadow.camera),this._cameraHelper.visible=!1,this._cameraHelper.userData.bboxVisible=!1,e.scene.add(this._cameraHelper),e.scene.addLight(this.light,{addToRoot:!0}),e.addEventListener("preRender",this._preRender)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),this.light.removeFromParent(),super.onRemove(e)}_setDirty(e=!1){var i,s;e?(i=this._viewer)===null||i===void 0||i.scene.setDirty():(s=this._viewer)===null||s===void 0||s.setDirty()}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Progressive Shadow",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:this._setDirty},{type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Visible",property:[this.light,"visible"],onChange:this._setDirty},{type:"slider",label:"Intensity",bounds:[0,10],property:[this.light,"intensity"],onChange:this._setDirty},{type:"color",label:"Color",property:[this.light,"color"],onChange:this._setDirty},{type:"checkbox",label:"Shadow Enabled",property:[this.light.shadowParams,"enabled"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"focus"],onChange:this._setDirty},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"spread"],onChange:this._setDirty},{type:"slider",bounds:[.01,60],property:[this.light.randomParams,"distanceScale"],onChange:this._setDirty},{type:"vec3",bounds:[-5,5],property:[this.light.randomParams,"direction"],onChange:this._setDirty},{type:"slider",bounds:[.01,10],property:[this.light.shadowParams,"radius"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[.01,30],property:[this.light.shadowParams,"frustumSize"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[-.01,.01],property:[this.light.shadowParams,"bias"],onChange:[this.light.updateShadowParams,this._setDirty]}]}]}}}J_.PluginType="RandomizedDirectionalLight",$_([jn()],J_.prototype,"enabled",void 0),$_([jn("rdLight")],J_.prototype,"light",void 0),$_([jn()],J_.prototype,"lightLayers",void 0);var Z_,bx=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};let vm=Z_=class extends Js{constructor(c=!1){super(),this.enabled=!1,this.worldRadius=100,this.tripodHeight=10,this._paramsChanged=this._paramsChanged.bind(this),this.enabled=c}_paramsChanged(){var c,e,i,s,a,h,f,k,et,tt,rt;const lt=(c=this._viewer)===null||c===void 0?void 0:c.getBackground(!0);if(this.enabled&&lt&&lt!==xv)if(lt.isDataTexture)lt.mapping=d.dSO;else if(confirm("Background must be same as environment, do you want to change it?")){const vt=(e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("SimpleBackgroundEnvUiPlugin1");vt?(vt.envmapBg=!0,(s=(i=vt.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)):(a=this._viewer)===null||a===void 0||a.setBackground(xv)}else this.enabled=!1;const pt=(et=(k=(f=(h=this._viewer)===null||h===void 0?void 0:h.renderer)===null||f===void 0?void 0:f.rendererObject)===null||k===void 0?void 0:k.background.getBoxMesh2())===null||et===void 0?void 0:et.material,ft=(tt=pt==null?void 0:pt.uniforms)!==null&&tt!==void 0?tt:d.Vj0.cube.uniforms;ft.tripodHeight||(ft.tripodHeight={value:1}),ft.worldRadius||(ft.worldRadius={value:1}),ft.tripodHeight.value=this.tripodHeight,ft.worldRadius.value=this.worldRadius,pt&&(!this.enabled&&pt.defines.HDRi_GROUND_PROJ?delete pt.defines.HDRi_GROUND_PROJ:this.enabled&&(pt.defines.HDRi_GROUND_PROJ="1"),pt.needsUpdate=!0),(rt=this._viewer)===null||rt===void 0||rt.setDirty()}async onAdded(c){var e,i,s;await super.onAdded(c),!((s=(i=(e=this._viewer)===null||e===void 0?void 0:e.renderer)===null||i===void 0?void 0:i.rendererObject)===null||s===void 0)&&s.background.getBoxMesh()&&console.error("HDRi Ground Plugin must be added before setting any cube or env map"),d.Vj0.cube.fragmentShader=d.Vj0.cube.fragmentShader.replace("void main() {",`
#ifdef HDRi_GROUND_PROJ
float intersectPlane1(const in vec3 r0,const in vec3 rd,const in vec3 n,const in vec3 p0){float t=dot(p0-r0,n)/(dot(n,rd)+1e-6);return t<0.?1000.:t;}float intersectSphere1(in vec3 ro,in vec3 rd,in vec3 sph,in float rad){vec3 oc=ro-sph;float b=dot(oc,rd);float c=dot(oc,oc)-rad*rad;float t=b*b-c;return t<0.?t:-b+sqrt(t);}
#define PI_HALF  1.5707963267948966
uniform float worldRadius;uniform float tripodHeight;vec3 hdriProject(){vec3 p=normalize(vWorldDirection);vec3 camPos=cameraPosition;camPos.y-=tripodHeight;float t=intersectSphere1(camPos,p,vec3(0.,0.,0.),worldRadius);if(t>0.){float t2=intersectPlane1(camPos,p,vec3(0,-1,0),vec3(0.,-tripodHeight,0.));p=(camPos+min(t,t2)*p)/worldRadius;}else p=vec3(0.,1.,0.);return p;}
#endif

void main() {`),d.Vj0.cube.fragmentShader=d.Vj0.cube.fragmentShader.replace("vec3 vReflect = vWorldDirection;",`
vec3 vReflect = 
#ifdef HDRi_GROUND_PROJ
hdriProject()
#else
vWorldDirection
#endif
;
`),c.scene.addEventListener("environmentChanged",this._paramsChanged)}};vm.PluginType="HDRiGroundPlugin",bx([jn(),hn(Z_.prototype._paramsChanged),Jr("Enabled")],vm.prototype,"enabled",void 0),bx([jn(),hn(Z_.prototype._paramsChanged),Xr("World Radius",[1,1e3])],vm.prototype,"worldRadius",void 0),bx([jn(),hn(Z_.prototype._paramsChanged),Xr("Tripod height",[0,50])],vm.prototype,"tripodHeight",void 0),vm=Z_=bx([Ws("HDRi Ground")],vm);var Jm=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};const tw={uniforms:{colorTexture:{value:null},tNormalDepth:{value:null},blurTexture:{value:null},cocTexture:{value:null},cocTextureSize:{value:new d.FM8},cameraNearFar:{value:new d.FM8}},vertexShader:bv,fragmentShader:Hv+`
#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cocTextureSize;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;uniform vec2 crossCenter;uniform float crossRadius;uniform float crossAlpha;uniform vec3 crossColor;float smoothBoundary(float d,float smooothFactor){smooothFactor*=0.5;float value=smoothstep(-smooothFactor,smooothFactor,d);return value;}float circle(vec2 p,float r){return min((length(p)-r),-(length(p)-r-0.01));}float computeCoc(){float depth=getDepth(vUv);if(depth>1.-0.01)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){vec4 blur=blurTextureTexelToLinear(texture2D(blurTexture,vUv));float scale=0.5;blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,-1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,-1.)/cocTextureSize));blur/=5.;vec2 uvNearest=(floor(vUv*cocTextureSize)+0.5)/cocTextureSize;float coc=abs(min(2.*cocTextureTexelToLinear(texture2D(cocTexture,uvNearest)).a-1.,computeCoc()));float cocLower=0.005;float cocHigher=0.3;vec4 outColor=vec4(mix(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,blur.rgb,smoothstep(cocLower,cocHigher,coc)),1.);vec2 d=vUv-crossCenter;if(length(d)>crossRadius+0.05){float dist=circle(d,crossRadius);gl_FragColor=outColor;}else{d.x*=cocTextureSize.x/cocTextureSize.y;float dist=circle(d,crossRadius);dist=smoothBoundary(dist,2.*fwidth(dist));vec4 color=outColor;vec3 dofCircleColor=mix(crossColor,color.rgb,1.-crossAlpha);gl_FragColor=vec4(mix(color.rgb,dofCircleColor,dist),color.a);}
#include <encodings_fragment>
}`},Ex=(wo({uniforms:{cocTexture:{value:null},colorTexture:{value:null},colorTextureSize:{value:new d.FM8},direction:{value:new d.FM8}},vertexShader:bv,fragmentShader:`#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;const float MAXIMUM_BLUR_SIZE=16.;const float SIGMA=5.;const int NUM_SAMPLES=4;float normpdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}vec3 weightedBlur(){float cocIn=2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv)).a-1.;float kernelRadius=MAXIMUM_BLUR_SIZE*cocIn;vec2 invSize=1./colorTextureSize;cocIn*=cocIn*cocIn;float centreSpaceWeight=normpdf(0.,SIGMA)*abs(cocIn);float weightSum=centreSpaceWeight;vec3 centreSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb;vec3 diffuseSum=centreSample*weightSum;vec2 delta=invSize*kernelRadius/float(NUM_SAMPLES);for(int i=1;i<=NUM_SAMPLES;i++){float spaceWeight=normpdf(float(i),SIGMA);vec2 texcoord=direction*delta*float(i);vec4 rightSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv+texcoord));vec4 leftSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv-texcoord));float leftCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv-texcoord)).a-1.);float rightCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv+texcoord)).a-1.);leftCocWeight*=leftCocWeight*leftCocWeight;rightCocWeight*=rightCocWeight*rightCocWeight;diffuseSum+=((leftSample.rgb*leftCocWeight)+(rightSample.rgb*rightCocWeight))*spaceWeight;weightSum+=(spaceWeight*(leftCocWeight+rightCocWeight));}return diffuseSum/weightSum;}void main(){gl_FragColor=vec4(weightedBlur(),1.);
#include <encodings_fragment>
}`},"colorTexture","cocTexture"),wo({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new d.FM8},direction:{value:new d.FM8},frameCount:{value:0},blurRadius:{value:16}},vertexShader:bv,fragmentShader:Ev+`
`+BT+`
#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform float blurRadius;vec4 CircularBlur(){vec4 color=colorTextureTexelToLinear(texture2D(colorTexture,vUv));
#ifdef DOF_MODE
float blurDist=blurRadius*(2.*color.a-1.);
#else
float blurDist=blurRadius*color.a;
#endif
float rnd=PI2*random3(vec3(vUv,frameCount*0.1));float costheta=cos(rnd);float sintheta=sin(rnd);vec4 rotationMatrix=vec4(costheta,-sintheta,sintheta,costheta);vec3 colorSum=vec3(0.);float weightSum=0.001;vec2 ofs;vec4 sampleColor;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));sampleColor=colorTextureTexelToLinear(texture2D(colorTexture,vUv+blurDist*ofs/colorTextureSize.xy));
#ifdef DOF_MODE
sampleColor.a=abs(sampleColor.a*2.-1.);sampleColor.a*=sampleColor.a*sampleColor.a;
#endif
colorSum+=sampleColor.rgb*sampleColor.a;weightSum+=sampleColor.a;}
#pragma unroll_loop_end
colorSum/=weightSum;return vec4(saturate(colorSum),1.);}void main(){gl_FragColor=CircularBlur();
#include <encodings_fragment>
}`,defines:{DOF_MODE:1}},"colorTexture"));class $0 extends bu{constructor(){super(tw,"colorTexture","cocTexture","blurTexture"),this.dofBlurMaterial=Ex,this.nearFarBlurScale=new d.FM8(.25,.25),this.focalDepthRange=new d.FM8(.5,1.5),this.crossCenter=new d.FM8(.5,.5),this.crossRadius=.04,this.crossAlpha=1,this.crossColor=new oo(16750848),this.uiConfig={type:"folder",label:"Depth of Field",children:[{type:"checkbox",label:"Enabled",limitedUi:!0,property:[this,"enabled"]},{type:"slider",label:"Depth Range",bounds:[.5,3],property:[this.focalDepthRange,"y"]},{type:"slider",label:"Near Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"x"]},{type:"slider",label:"Far Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"y"]}]},this.material.extensions.derivatives=!0,this.computeCocMaterial=wo({uniforms:{colorTexture:{value:null},tNormalDepth:this.uniforms.tNormalDepth,cameraNearFar:this.uniforms.cameraNearFar,nearFarBlurScale:this.uniforms.nearFarBlurScale,focalDepthRange:this.uniforms.focalDepthRange},vertexShader:bv,fragmentShader:Hv+`
#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;float computeCoc(){float depth=getDepth(vUv);if(depth==1.)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*computeCoc()+0.5);
#include <encodings_fragment>
}`},"colorTexture"),this.expandCocMaterial=wo({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new d.FM8},direction:{value:new d.FM8},tNormalDepth:this.uniforms.tNormalDepth,nearFarBlurScale:this.uniforms.nearFarBlurScale},vertexShader:bv,fragmentShader:Hv+`
#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;uniform vec2 nearFarBlurScale;const float MAXIMUM_BLUR_SIZE=4.;float expandNear(const in vec2 offset,const in bool isBackground){float coc=0.;vec2 sampleOffsets=MAXIMUM_BLUR_SIZE*offset/5.;float coc0=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv)).a-1.;float coc1=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-5.*sampleOffsets)).a-1.;float coc2=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-4.*sampleOffsets)).a-1.;float coc3=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-3.*sampleOffsets)).a-1.;float coc4=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-2.*sampleOffsets)).a-1.;float coc5=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-1.*sampleOffsets)).a-1.;float coc6=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+1.*sampleOffsets)).a-1.;float coc7=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+2.*sampleOffsets)).a-1.;float coc8=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+3.*sampleOffsets)).a-1.;float coc9=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+4.*sampleOffsets)).a-1.;float coc10=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+5.*sampleOffsets)).a-1.;if(isBackground){coc=abs(coc0)*0.095474+(abs(coc1)+abs(coc10))*0.084264+(abs(coc2)+abs(coc9))*0.088139+(abs(coc3)+abs(coc8))*0.091276+(abs(coc4)+abs(coc7))*0.093585+(abs(coc5)+abs(coc6))*0.094998;}else{coc=min(coc0,0.);coc=min(coc1*0.3,coc);coc=min(coc2*0.5,coc);coc=min(coc3*0.75,coc);coc=min(coc4*0.8,coc);coc=min(coc5*0.95,coc);coc=min(coc6*0.95,coc);coc=min(coc7*0.8,coc);coc=min(coc8*0.75,coc);coc=min(coc9*0.5,coc);coc=min(coc10*0.3,coc);if(abs(coc0)>abs(coc))coc=coc0;}return coc;}void main(){vec2 offset=2.*direction/colorTextureSize;bool isBackground=getDepth(vUv)>1.-0.001;float coc=expandNear(offset,isBackground);gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*coc+0.5);
#include <encodings_fragment>
}`},"colorTexture")}render(e,i,s,a,h){if(!this.enabled)return;const f=e.baseRenderer,k={minFilter:d.TyD,magFilter:d.TyD,type:d.cLu,encoding:d.rnI,sizeMultiplier:.5,isAntialiased:!1,format:d.wk1,depthBuffer:!1,generateMipmaps:!1},et=f.getTempTarget(k),tt=f.getTempTarget(k);if(this.computeCocMaterial.uniforms.colorTexture.value=s.texture,f.blit(void 0,et,{material:this.computeCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=et.texture,this.expandCocMaterial.uniforms.direction.value.set(1,0),f.blit(void 0,tt,{material:this.expandCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=tt.texture,this.expandCocMaterial.uniforms.direction.value.set(0,1),f.blit(void 0,et,{material:this.expandCocMaterial}),this.dofBlurMaterial.uniforms.frameCount)this.dofBlurMaterial.uniforms.colorTexture.value=et.texture,f.blit(void 0,tt,{material:this.dofBlurMaterial});else{const rt=f.getTempTarget(k);this.dofBlurMaterial.uniforms.cocTexture.value=et.texture,this.dofBlurMaterial.uniforms.colorTexture.value=et.texture,this.dofBlurMaterial.uniforms.direction.value.set(1,0),f.blit(void 0,rt,{material:this.dofBlurMaterial}),this.dofBlurMaterial.uniforms.colorTexture.value=rt.texture,this.dofBlurMaterial.uniforms.direction.value.set(0,1),f.blit(void 0,tt,{material:this.dofBlurMaterial}),f.releaseTempTarget(rt)}this.material.uniforms.blurTexture.value=tt.texture,this.material.uniforms.cocTexture.value=et.texture,super.render(e,i,s,a,h),f.releaseTempTarget(et),f.releaseTempTarget(tt)}}Jm([jn(),dn()],$0.prototype,"nearFarBlurScale",void 0),Jm([jn(),dn()],$0.prototype,"focalDepthRange",void 0),Jm([dn()],$0.prototype,"crossCenter",void 0),Jm([dn()],$0.prototype,"crossRadius",void 0),Jm([dn()],$0.prototype,"crossAlpha",void 0),Jm([dn()],$0.prototype,"crossColor",void 0);var e0=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};class t0 extends wv{constructor(e=!0,i=!1){super(),this.passId="depthOfField",this._beforeFilters=["progressive","tonemap","screen"],this._afterFilters=["render"],this._requiredFilters=["render"],this.dependencies=[ba],this.enableEdit=!1,this._focalPointHit=new d.Pa4(0,0,0),this.crossFadeTime=200,this._focalPointHitTime=0,this._tempVec=new d.Pa4,this.enabled=e,this.enableEdit=i,this._onObjectHit=this._onObjectHit.bind(this),this.setDirty=this.setDirty.bind(this)}passCtor(e){return new $0}setFocalPoint(e,i=!0,s=!1){var a,h;this._focalPointHit.copy(e),i&&((h=(a=this._viewer)===null||a===void 0?void 0:a.getPlugin(X_))===null||h===void 0||h.startTransition(this._frameFadeTime)),s&&(this._focalPointHitTime=mo()),this.setDirty()}getFocalPoint(){return this._focalPointHit}get depthRange(){var e,i;return(i=(e=this.pass)===null||e===void 0?void 0:e.passObject.focalDepthRange.y)!==null&&i!==void 0?i:0}set depthRange(e){this.pass&&(this.pass.passObject.focalDepthRange.y=e),this.setDirty()}get nearBlurScale(){var e,i;return(i=(e=this.pass)===null||e===void 0?void 0:e.passObject.nearFarBlurScale.x)!==null&&i!==void 0?i:0}set nearBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.x=e),this.setDirty()}get farBlurScale(){var e,i;return(i=(e=this.pass)===null||e===void 0?void 0:e.passObject.nearFarBlurScale.y)!==null&&i!==void 0?i:0}set farBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.y=e),this.setDirty()}get _frameFadeTime(){return 2.5*this.crossFadeTime}_onObjectHit(e){var i,s;this._pass&&e.intersects.intersect&&this.enabled&&this.enableEdit&&(this._focalPointHit.copy(e.intersects.intersect.point),this._focalPointHitTime=e.time,e.intersects.selectedObject=null,(s=(i=this._viewer)===null||i===void 0?void 0:i.getPlugin(X_))===null||s===void 0||s.startTransition(this._frameFadeTime),this.setDirty())}async onAdded(e){var i;await super.onAdded(e),(i=e.getPluginByType("Picking"))===null||i===void 0||i.addEventListener("hitObject",this._onObjectHit)}async onRemove(e){var i;return(i=e.getPluginByType("Picking"))===null||i===void 0||i.removeEventListener("hitObject",this._onObjectHit),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}_update(e){var i,s;if(!super._update(e))return!1;const a=(i=this.pass)===null||i===void 0?void 0:i.passObject;if(!a)return!1;const h=e.getPlugin(ba);h==null||h.updateShaderProperties(a.material),a.dofBlurMaterial.uniforms.frameCount&&((s=e.renderer)===null||s===void 0||s.updateShaderProperties(a.dofBlurMaterial));const f=e.scene.activeCamera;if(!f)return!1;f.cameraObject.updateMatrixWorld(!0),f.updateShaderProperties(a.material),this._tempVec.subVectors(this._focalPointHit,f.cameraObject.position),a.focalDepthRange.x=this._tempVec.length(),a.focalDepthRange.x*=f.cameraObject.getWorldDirection(new d.Pa4).dot(this._tempVec.normalize());let k=(mo()-this._focalPointHitTime)/this.crossFadeTime;if(k=1-Math.min(1,Math.max(0,k)),Math.abs(k-a.crossAlpha)>.01&&(a.crossAlpha=k,this.setDirty()),k>0){const et=this._tempVec.copy(this._focalPointHit).project(f.cameraObject).addScalar(1).divideScalar(2);a.crossCenter.set(et.x,et.y),a.computeCocMaterial.uniformsNeedUpdate=!0,a.expandCocMaterial.uniformsNeedUpdate=!0}return!0}get uiConfig(){var e,i,s,a,h;if(this._uiConfig)return this._uiConfig;const f=(i=(e=this._pass)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.uiConfig;return f?((a=(s=f.children)===null||s===void 0?void 0:s.map(k=>Ht(k)))===null||a===void 0||a.flat(2).forEach(k=>k&&(k.onChange=this.setDirty)),(h=f.children)===null||h===void 0||h.push({type:"checkbox",label:"Enable Edit",limitedUi:!0,property:[this,"enableEdit"]}),this._uiConfig=f,f):{}}}t0.PluginType="DepthOfField",e0([jn()],t0.prototype,"enableEdit",void 0),e0([jn("focalPoint")],t0.prototype,"_focalPointHit",void 0),e0([jn()],t0.prototype,"crossFadeTime",void 0);var Xy,Vu=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};let Cu=Xy=class extends Js{constructor(c=!0){super(),this.enabled=!0,this.radius=.015,this.intensity=1,this.tolerance=1.5,this._defines={},this.onlySSCSDebug=!1,this.stepCount=2,this.dependencies=[ba,Kr],this.materialExtension={shaderExtender:(e,i,s)=>{if(!e.defines.SSCS_ENABLED)return;const a=Ut`
                #ifndef D_sceneBoundingRadius
                #define D_sceneBoundingRadius
                uniform float sceneBoundingRadius;
                #endif
                float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, vec3 lightDirection ) {
                    vec3 ray_origin_view = -vViewPosition;
                    float rnd = interleavedGradientNoise(gl_FragCoord.xy, frameCount+34.);
                    float cameraDist = length(cameraPositionWorld);
//                    float radius = mix((cameraNearFar.y) + ray_origin_view.z, -ray_origin_view.z - cameraNearFar.x, rnd * 0.5 + 0.5)*sscsRadius;
                    float radius = mix((cameraDist + sceneBoundingRadius) + ray_origin_view.z, -ray_origin_view.z - max(0.0, cameraDist - sceneBoundingRadius), rnd * 0.5 + 0.5)*sscsRadius;
                    vec3 state = vec3(1.,(rnd+0.5)/float(SSCS_STEP_COUNT),2.);
                    traceRay(ray_origin_view, normalize(lightDirection) * radius, sscsTolerance * radius * 2., state, SSCS_STEP_COUNT);
                    state.z = state.z > 0.99 ? 1. : max(0.,min(state.z * state.z * (1.-sscsIntensity), 1.));
                    
                #if defined(SSCS_DEBUG) && SSCS_DEBUG > 0
                    return state.z;
                #endif
            `,h=`
#if SSCS_ENABLED

    uniform float sscsIntensity;
    uniform float sscsRadius;
    uniform float sscsTolerance;

    ${R1}
    
    #define THREE_PACKING_INCLUDED
    ${Hw}
    
    ${Hv}
    ${Ev}
    
    ${k1}

#endif
            
            `+d.WdD.shadowmap_pars_fragment.replace("float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {",`${a}
`).replace("return shadow;","return min(shadow, state.z);");e.fragmentShader=e.fragmentShader.replace("#include <shadowmap_pars_fragment>",h),e.fragmentShader=e.fragmentShader.replace("#include <lights_fragment_begin>",d.WdD.lights_fragment_begin),e.fragmentShader=e.fragmentShader.replace("directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;","directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ], directLight.direction ) : 1.0;").replace("directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;","directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ], directLight.direction ) : 1.0;")},onObjectRender:(e,i,s)=>{var a;const h=i.materialObject;let f=this.enabled&&s.userData.screenSpaceRendering!==!1&&!(!((a=h.userData)===null||a===void 0)&&a.sscsDisabled)?1:0;h.defines.SSCS_ENABLED!==f&&(h.defines.SSCS_ENABLED=f,h.needsUpdate=!0),f=this._defines.SSCS_STEP_COUNT,h.defines.SSCS_STEP_COUNT!==f&&(h.defines.SSCS_STEP_COUNT=f,h.needsUpdate=!0),f=+this._defines.SSCS_DEBUG,h.defines.SSCS_DEBUG!==f&&(h.defines.SSCS_DEBUG=f,h.needsUpdate=!0)},parsFragmentSnippet:()=>`
`,extraUniforms:{...Xy._uniforms},computeCacheKey:e=>this.enabled?"1":"0",isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>{var e,i,s,a,h;return[(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(ba),(i=this._viewer)===null||i===void 0?void 0:i.getPlugin(dp),(s=this._viewer)===null||s===void 0?void 0:s.scene.activeCamera,(a=this._viewer)===null||a===void 0?void 0:a.renderer,(h=this._viewer)===null||h===void 0?void 0:h.scene]}},this.enabled=c,this.userData={setDirty:()=>{var e;(e=this._viewer)===null||e===void 0||e.setDirty()}}}async onAdded(c){var e,i;await super.onAdded(c),(i=(e=c.getPlugin(Kr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.registerMaterialExtension(this.materialExtension)}async onRemove(c){var e,i;return(i=(e=c.getPlugin(Kr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this.materialExtension),super.onRemove(c)}};Cu.PluginType="SSContactShadows",Cu._uniforms={tNormalDepth:{value:null},frameCount:{value:0},projection:{value:new d.yGw},cameraPositionWorld:{value:new d.Pa4},cameraNearFar:{value:new d.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},Vu([Jr("Enabled"),jn()],Cu.prototype,"enabled",void 0),Vu([dn({uniforms:Xy._uniforms,propKey:"sscsRadius"}),Xr("Radius",[1e-4,.1],1e-4),jn()],Cu.prototype,"radius",void 0),Vu([dn({uniforms:Xy._uniforms,propKey:"sscsIntensity"}),Xr("Intensity",[1e-4,1],1e-4),jn()],Cu.prototype,"intensity",void 0),Vu([dn({uniforms:Xy._uniforms,propKey:"sscsTolerance"}),Xr("Tolerance",[.1,5]),jn()],Cu.prototype,"tolerance",void 0),Vu([kn("SSCS_DEBUG",void 0,!0),Jr("Debug only SSCS"),jn()],Cu.prototype,"onlySSCSDebug",void 0),Vu([kn("SSCS_STEP_COUNT",void 0,!0),Xr("Step count",[1,8],1),jn()],Cu.prototype,"stepCount",void 0),Cu=Xy=Vu([Ws("Screen Space Contact Shadows")],Cu);class mP{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const i=this.workerCreator();i.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=i}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,i){const s=this.workersResolve[e];if(s&&s(i),this.queue.length){const{resolve:a,msg:h,transfer:f}=this.queue.shift();this.workersResolve[e]=a,this.workers[e].postMessage(h,f)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,i){return new Promise(s=>{const a=this._getIdleWorker();a!==-1?(this._initWorker(a),this.workerStatus|=1<<a,this.workersResolve[a]=s,this.workers[a].postMessage(e,i)):this.queue.push({resolve:s,msg:e,transfer:i})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}class n0{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Sx{constructor(e,i,s,a){this._dataView=new DataView(e.buffer,e.byteOffset+i,s),this._littleEndian=a,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,i=0){const s=this._offset;let a=0;for(;this._dataView.getUint8(this._offset)!==i&&a<e;)a++,this._offset++;return a<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+s,a)}}const Up=[171,75,84,88,32,50,48,187,13,10,26,10];function nw(c){return typeof TextDecoder<"u"?new TextDecoder().decode(c):Buffer.from(c).toString("utf8")}let MC,r0,TC;const a_={env:{emscripten_notify_memory_growth:function(c){TC=new Uint8Array(r0.exports.memory.buffer)}}};class UT{init(){return MC||(MC=typeof fetch<"u"?fetch("data:application/wasm;base64,"+IC).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,a_)).then(this._init):WebAssembly.instantiate(Buffer.from(IC,"base64"),a_).then(this._init),MC)}_init(e){r0=e.instance,a_.env.emscripten_notify_memory_growth(0)}decode(e,i=0){if(!r0)throw new Error("ZSTDDecoder: Await .init() before decoding.");const s=e.byteLength,a=r0.exports.malloc(s);TC.set(e,a),i=i||Number(r0.exports.ZSTD_findDecompressedSize(a,s));const h=r0.exports.malloc(i),f=r0.exports.ZSTD_decompress(h,i,a,s),k=TC.slice(h,h+f);return r0.exports.free(a),r0.exports.free(h),k}}const IC="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",vE=new WeakMap;let _E,Cx=0;class l_ extends d.aNw{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new mP,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const e=new d.hH6(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const i=e.loadAsync("basis_transcoder.js"),s=new d.hH6(this.manager);s.setPath(this.transcoderPath),s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials);const a=s.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([i,a]).then(([h,f])=>{const k=l_.BasisWorker.toString(),et=["/* constants */","let _EngineFormat = "+JSON.stringify(l_.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(l_.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(l_.BasisFormat),"/* basis_transcoder.js */",h,"/* worker */",k.substring(k.indexOf("{")+1,k.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([et])),this.transcoderBinary=f,this.workerPool.setWorkerCreator(()=>{const tt=new Worker(this.workerSourceURL),rt=this.transcoderBinary.slice(0);return tt.postMessage({type:"init",config:this.workerConfig,transcoderBinary:rt},[rt]),tt})}),Cx>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),Cx++}return this.transcoderPending}load(e,i,s,a){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const h=new d.hH6(this.manager);h.setResponseType("arraybuffer"),h.setWithCredentials(this.withCredentials),h.load(e,f=>{if(vE.has(f))return vE.get(f).promise.then(i).catch(a);this.createTexture(f).then(k=>i?i(k):null).catch(a)},s,a)}_createTextureFrom(e){const{mipmaps:i,width:s,height:a,format:h,type:f,error:k,dfdTransferFn:et,dfdFlags:tt}=e;if(f==="error")return Promise.reject(k);const rt=new d.EB7(i,s,a,h,d.ywz);return rt.minFilter=i.length===1?d.wem:d.D1R,rt.magFilter=d.wem,rt.generateMipmaps=!1,rt.needsUpdate=!0,rt.encoding=et===2?d.knz:d.rnI,rt.premultiplyAlpha=!!(1&tt),rt}createTexture(e,i={}){const s=function(f){const k=new Uint8Array(f.buffer,f.byteOffset,Up.length);if(k[0]!==Up[0]||k[1]!==Up[1]||k[2]!==Up[2]||k[3]!==Up[3]||k[4]!==Up[4]||k[5]!==Up[5]||k[6]!==Up[6]||k[7]!==Up[7]||k[8]!==Up[8]||k[9]!==Up[9]||k[10]!==Up[10]||k[11]!==Up[11])throw new Error("Missing KTX 2.0 identifier.");const et=new n0,tt=17*Uint32Array.BYTES_PER_ELEMENT,rt=new Sx(f,Up.length,tt,!0);et.vkFormat=rt._nextUint32(),et.typeSize=rt._nextUint32(),et.pixelWidth=rt._nextUint32(),et.pixelHeight=rt._nextUint32(),et.pixelDepth=rt._nextUint32(),et.layerCount=rt._nextUint32(),et.faceCount=rt._nextUint32();const lt=rt._nextUint32();et.supercompressionScheme=rt._nextUint32();const pt=rt._nextUint32(),ft=rt._nextUint32(),vt=rt._nextUint32(),yt=rt._nextUint32(),Mt=rt._nextUint64(),xt=rt._nextUint64(),Et=new Sx(f,Up.length+tt,3*lt*8,!0);for(let kr=0;kr<lt;kr++)et.levels.push({levelData:new Uint8Array(f.buffer,f.byteOffset+Et._nextUint64(),Et._nextUint64()),uncompressedByteLength:Et._nextUint64()});const At=new Sx(f,pt,ft,!0),Rt={vendorId:At._skip(4)._nextUint16(),descriptorType:At._nextUint16(),versionNumber:At._nextUint16(),descriptorBlockSize:At._nextUint16(),colorModel:At._nextUint8(),colorPrimaries:At._nextUint8(),transferFunction:At._nextUint8(),flags:At._nextUint8(),texelBlockDimension:[At._nextUint8(),At._nextUint8(),At._nextUint8(),At._nextUint8()],bytesPlane:[At._nextUint8(),At._nextUint8(),At._nextUint8(),At._nextUint8(),At._nextUint8(),At._nextUint8(),At._nextUint8(),At._nextUint8()],samples:[]},Bt=(Rt.descriptorBlockSize/4-6)/4;for(let kr=0;kr<Bt;kr++){const Br={bitOffset:At._nextUint16(),bitLength:At._nextUint8(),channelType:At._nextUint8(),samplePosition:[At._nextUint8(),At._nextUint8(),At._nextUint8(),At._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&Br.channelType?(Br.sampleLower=At._nextInt32(),Br.sampleUpper=At._nextInt32()):(Br.sampleLower=At._nextUint32(),Br.sampleUpper=At._nextUint32()),Rt.samples[kr]=Br}et.dataFormatDescriptor.length=0,et.dataFormatDescriptor.push(Rt);const Qt=new Sx(f,vt,yt,!0);for(;Qt._offset<yt;){const kr=Qt._nextUint32(),Br=Qt._scan(kr),Ur=nw(Br),hs=Qt._scan(kr-Br.byteLength);et.keyValue[Ur]=Ur.match(/^ktx/i)?nw(hs):hs,Qt._offset%4&&Qt._skip(4-Qt._offset%4)}if(xt<=0)return et;const Wt=new Sx(f,Mt,xt,!0),tn=Wt._nextUint16(),pn=Wt._nextUint16(),yn=Wt._nextUint32(),En=Wt._nextUint32(),wn=Wt._nextUint32(),In=Wt._nextUint32(),xn=[];for(let kr=0;kr<lt;kr++)xn.push({imageFlags:Wt._nextUint32(),rgbSliceByteOffset:Wt._nextUint32(),rgbSliceByteLength:Wt._nextUint32(),alphaSliceByteOffset:Wt._nextUint32(),alphaSliceByteLength:Wt._nextUint32()});const Cn=Mt+Wt._offset,Fn=Cn+yn,Tn=Fn+En,Wn=Tn+wn,or=new Uint8Array(f.buffer,f.byteOffset+Cn,yn),fr=new Uint8Array(f.buffer,f.byteOffset+Fn,En),rr=new Uint8Array(f.buffer,f.byteOffset+Tn,wn),Ir=new Uint8Array(f.buffer,f.byteOffset+Wn,In);return et.globalData={endpointCount:tn,selectorCount:pn,imageDescs:xn,endpointsData:or,selectorsData:fr,tablesData:rr,extendedData:Ir},et}(new Uint8Array(e));if(s.vkFormat!==0)return async function(f){const{vkFormat:k,pixelWidth:et,pixelHeight:tt,pixelDepth:rt}=f;if(PC[k]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");const lt=f.levels[0];let pt,ft;if(f.supercompressionScheme===0)pt=lt.levelData;else{if(f.supercompressionScheme!==2)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");_E||(_E=new Promise(async yt=>{const Mt=new UT;await Mt.init(),yt(Mt)})),pt=(await _E).decode(lt.levelData,lt.uncompressedByteLength)}ft=yE[k]===d.VzW?new Float32Array(pt.buffer,pt.byteOffset,pt.byteLength/Float32Array.BYTES_PER_ELEMENT):yE[k]===d.cLu?new Uint16Array(pt.buffer,pt.byteOffset,pt.byteLength/Uint16Array.BYTES_PER_ELEMENT):pt;const vt=rt===0?new d.IEO(ft,et,tt):new d.JUT(ft,et,tt,rt);return vt.type=yE[k],vt.format=PC[k],vt.encoding=Mx[k]||d.rnI,vt.needsUpdate=!0,Promise.resolve(vt)}(s);const a=i,h=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:a},[e])).then(f=>this._createTextureFrom(f.data));return vE.set(e,{promise:h}),h}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),Cx--,this}}l_.BasisFormat={ETC1S:0,UASTC_4x4:1},l_.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},l_.EngineFormat={RGBAFormat:d.wk1,RGBA_ASTC_4x4_Format:d.ptH,RGBA_BPTC_Format:d.bsb,RGBA_ETC2_EAC_Format:d.ekQ,RGBA_PVRTC_4BPPV1_Format:d.eaV,RGBA_S3TC_DXT5_Format:d.ILR,RGB_ETC1_Format:d.fto,RGB_ETC2_Format:d.l0P,RGB_PVRTC_4BPPV1_Format:d._AM,RGB_S3TC_DXT1_Format:d.wuA},l_.BasisWorker=function(){let c,e,i;const s=_EngineFormat,a=_TranscoderFormat,h=_BasisFormat;self.addEventListener("message",function(rt){const lt=rt.data;switch(lt.type){case"init":c=lt.config,pt=lt.transcoderBinary,e=new Promise(ft=>{i={wasmBinary:pt,onRuntimeInitialized:ft},BASIS(i)}).then(()=>{i.initializeBasis(),i.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")});break;case"transcode":e.then(()=>{try{const{width:ft,height:vt,hasAlpha:yt,mipmaps:Mt,format:xt,dfdTransferFn:Et,dfdFlags:At}=function(Bt){const Qt=new i.KTX2File(new Uint8Array(Bt));function Wt(){Qt.close(),Qt.delete()}if(!Qt.isValid())throw Wt(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const tn=Qt.isUASTC()?h.UASTC_4x4:h.ETC1S,pn=Qt.getWidth(),yn=Qt.getHeight(),En=Qt.getLevels(),wn=Qt.getHasAlpha(),In=Qt.getDFDTransferFunc(),xn=Qt.getDFDFlags(),{transcoderFormat:Cn,engineFormat:Fn}=function(Wn,or,fr,rr){let Ir,kr;const Br=Wn===h.ETC1S?k:et;for(let Ur=0;Ur<Br.length;Ur++){const hs=Br[Ur];if(c[hs.if]&&hs.basisFormat.includes(Wn)&&!(rr&&hs.transcoderFormat.length<2)&&(!hs.needsPowerOfTwo||tt(or)&&tt(fr)))return Ir=hs.transcoderFormat[rr?1:0],kr=hs.engineFormat[rr?1:0],{transcoderFormat:Ir,engineFormat:kr}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),Ir=a.RGBA32,kr=s.RGBAFormat,{transcoderFormat:Ir,engineFormat:kr}}(tn,pn,yn,wn);if(!pn||!yn||!En)throw Wt(),new Error("THREE.KTX2Loader:	Invalid texture");if(!Qt.startTranscoding())throw Wt(),new Error("THREE.KTX2Loader: .startTranscoding failed");const Tn=[];for(let Wn=0;Wn<En;Wn++){const or=Qt.getImageLevelInfo(Wn,0,0),fr=or.origWidth,rr=or.origHeight,Ir=new Uint8Array(Qt.getImageTranscodedSizeInBytes(Wn,0,0,Cn));if(!Qt.transcodeImage(Ir,Wn,0,0,Cn,0,-1,-1))throw Wt(),new Error("THREE.KTX2Loader: .transcodeImage failed.");Tn.push({data:Ir,width:fr,height:rr})}return Wt(),{width:pn,height:yn,hasAlpha:wn,mipmaps:Tn,format:Fn,dfdTransferFn:In,dfdFlags:xn}}(lt.buffer),Rt=[];for(let Bt=0;Bt<Mt.length;++Bt)Rt.push(Mt[Bt].data.buffer);self.postMessage({type:"transcode",id:lt.id,width:ft,height:vt,hasAlpha:yt,mipmaps:Mt,format:xt,dfdTransferFn:Et,dfdFlags:At},Rt)}catch(ft){console.error(ft),self.postMessage({type:"error",id:lt.id,error:ft.message})}})}var pt});const f=[{if:"astcSupported",basisFormat:[h.UASTC_4x4],transcoderFormat:[a.ASTC_4x4,a.ASTC_4x4],engineFormat:[s.RGBA_ASTC_4x4_Format,s.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[h.ETC1S,h.UASTC_4x4],transcoderFormat:[a.BC7_M5,a.BC7_M5],engineFormat:[s.RGBA_BPTC_Format,s.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[h.ETC1S,h.UASTC_4x4],transcoderFormat:[a.BC1,a.BC3],engineFormat:[s.RGB_S3TC_DXT1_Format,s.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[h.ETC1S,h.UASTC_4x4],transcoderFormat:[a.ETC1,a.ETC2],engineFormat:[s.RGB_ETC2_Format,s.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[h.ETC1S,h.UASTC_4x4],transcoderFormat:[a.ETC1],engineFormat:[s.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[h.ETC1S,h.UASTC_4x4],transcoderFormat:[a.PVRTC1_4_RGB,a.PVRTC1_4_RGBA],engineFormat:[s.RGB_PVRTC_4BPPV1_Format,s.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],k=f.sort(function(rt,lt){return rt.priorityETC1S-lt.priorityETC1S}),et=f.sort(function(rt,lt){return rt.priorityUASTC-lt.priorityUASTC});function tt(rt){return rt<=2||(rt&rt-1)==0&&rt!==0}};const PC={109:d.wk1,97:d.wk1,37:d.wk1,43:d.wk1,103:d.av9,83:d.av9,16:d.av9,22:d.av9,100:d.hEm,76:d.hEm,15:d.hEm,9:d.hEm},yE={109:d.VzW,97:d.cLu,37:d.ywz,43:d.ywz,103:d.VzW,83:d.cLu,16:d.ywz,22:d.ywz,100:d.VzW,76:d.cLu,15:d.ywz,9:d.ywz},Mx={43:d.knz,22:d.knz,15:d.knz},Tx="KHR_texture_basisu";class DC extends j{constructor(){super(...arguments),this.dependencies=[Kr]}async onAdded(e){var i,s,a,h;this._importer||(this._importer=new zl(class extends l_{constructor(f){super(f),this.setTranscoderPath("https://cdn.jsdelivr.net/gh/BinomialLLC/basis_universal@master/webgl/transcoder/build/").detectSupport(e.renderer.rendererObject)}async createTexture(f,k){const et=f.map(rt=>new Uint8Array(rt.slice(0))),tt=await super.createTexture(f,k);return tt.source._sourceImgBuffer=et,tt.userData.mimeType="image/ktx2",tt}},["ktx2"],!1)),uo.Importers.push(this._importer),(h=(a=(s=(i=e.getManager())===null||i===void 0?void 0:i.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||a===void 0?void 0:a.extensions)===null||h===void 0||h.push(jT)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&uo.Importers.splice(uo.Importers.indexOf(this._importer),1),this._importer=void 0}}DC.PluginType="KTX2LoadPlugin";const jT=c=>({writeTexture:(e,i)=>{if(e.userData.mimeType!=="image/ktx2")return;if(i.source!==void 0)return void console.warn("ktx2 export: source already set");const s=e.source._sourceImgBuffer;if(!s||!s.length)return void console.warn("ktx2 export: no source buffer for ktx2");i.extensions=i.extensions||{};const a={},h=new Blob(Array.isArray(s)?s:[s],{type:"image/ktx2"});a.source=c.processImageBlob(h,e),i.extensions[Tx]=a,c.extensionsUsed[Tx]=!0}});class AE{constructor(e){this.presets=[],this.name="",this.selected=void 0,e&&(this.name=e)}async apply(e,i,s){var a,h;if(!i)return void(this.selected=void 0);let f=this.presets.find(k=>k.path===i.path);return f||(this.presets.push(i),f=i),this.selected=f,(h=(a=e.getManager())===null||a===void 0?void 0:a.importer)===null||h===void 0?void 0:h.importAsset(f,s)}}class zT extends AE{constructor(){super(...arguments),this.name="Background"}async apply(e,i){const s=await super.apply(e,i),a=s==null?void 0:s[0];return a&&(a.encoding=d.knz,await e.setBackground(a)),a}}class VT extends AE{constructor(){super(...arguments),this.name="Environment"}async apply(e,i){const s=await super.apply(e,i),a=s==null?void 0:s[0];return a&&await e.scene.setEnvironment(a),a}}class QT extends AE{constructor(){super(...arguments),this.name="GemEnvironment"}async apply(e,i){const s=await super.apply(e,i),a=s==null?void 0:s[0];return nn(e.getPluginByType("Diamond"),"envMap",a),a}}class Ix extends AE{async apply(e,i){var s,a;const h=await super.apply(e,i,{processImported:!1});return h?(a=(s=e.getManager())===null||s===void 0?void 0:s.importer)===null||a===void 0?void 0:a.processImported(h):void 0}}class wE extends Ix{constructor(){super(...arguments),this.name="MaterialLibraries"}async apply(e,i){const s=await super.apply(e,i);return s&&await e.alert("Material Library successfully imported."),s}}class i0 extends Js{constructor(){super(...arguments),this.toJSON=null,this.enabled=!0,this.presetGroups=[],this.uiConfig={type:"folder",label:"Presets",expanded:!0,limitedUi:!0,children:[()=>this.presetGroups.map(e=>({type:"dropdown",label:e.name,limitedUi:!0,children:[{value:"",label:"none"},...e.presets.map(i=>({label:i.path.split("/").pop(),value:i.path}))],getValue:()=>{var i;return((i=e.selected)===null||i===void 0?void 0:i.path)||""},setValue:i=>{e.apply(this._viewer,e.presets.find(s=>s.path===i))}})),{type:"button",label:"Download Selection",limitedUi:!0,value:()=>{const e=this.exportPresets();Xp(new File([JSON.stringify(e,null,2)],"preset.template.json",{type:"application/json"}))}},{type:"button",label:"Export Preset Groups",hidden:!0,limitedUi:!1,value:()=>{const e=this.exportPresetGroups();Xp(new File([JSON.stringify(e,null,2)],"presetGroups.json",{type:"application/json"}))}}]}}async onAdded(e){var i,s;await super.onAdded(e),this.presetGroups.push(new zT),this.presetGroups.push(new VT),this.presetGroups.push(new QT),this.presetGroups.push(new Ix("Ground")),this.presetGroups.push(new Ix("CameraViews")),this.presetGroups.push(new Ix("MaterialConfiguration")),this.presetGroups.push(new wE),(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)}exportPresets(){const e=Object.fromEntries(this.presetGroups.map(i=>{var s;return[i.name,((s=i.selected)===null||s===void 0?void 0:s.path)||void 0]}).filter(([,i])=>i));return e.type=i0.PluginType,e}async fromJSON(e,i){var s,a;if(!super.fromJSON(e,i))return null;const h={...e};delete h.type;const f=[];for(const[k,et]of Object.entries(h)){const tt=this.presetGroups.find(pt=>pt.name===k),rt=tt==null?void 0:tt.presets;if(!tt||!rt)continue;const lt=typeof et=="string"?{path:et}:et;f.push(tt.apply(this._viewer,lt))}return await Promise.all(f),(a=(s=this.uiConfig).uiRefresh)===null||a===void 0||a.call(s,"postFrame",!0),this}loadPresetGroups(e){var i;for(const[s,a]of Object.entries(e)){const h=(i=this.presetGroups.find(f=>f.name===s))===null||i===void 0?void 0:i.presets;h==null||h.push(...a)}}exportPresetGroups(){return Object.fromEntries(this.presetGroups.map(e=>[e.name,e.presets.map(i=>i.path)]).filter(([,e])=>e.length>0))}}i0.PluginType="PresetLibraryPlugin";var c_=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};let _m=class extends Js{constructor(){super(),this.enabled=!0,this.dependencies=[Kr],this.scenes=[],this.assets={},this.toJSON=void 0,this._isPlaying=!1,this._isPlayingLoop=!1,this._options={},this.minSceneTime=2e3,this.loadScenes=this.loadScenes.bind(this),this.play=this.play.bind(this),this.stop=this.stop.bind(this),this.downloadScenes=this.downloadScenes.bind(this),this.promptLoadScenes=this.promptLoadScenes.bind(this)}get loadedScenes(){return this.scenes.length}async promptLoadScenes(){const c=await E_(!0,!1,"model/gltf");await this.loadScenes(c)}async loadScenes(c){var e,i;const s=await Promise.all(c.map(async a=>await a.arrayBuffer()));for(let a=0;a<c.length;a++){const h=c[a];this.scenes.push({[h.name]:new Uint8Array(s[a])}),this.assets[h.name]={path:h.name,file:h}}(i=(e=this.uiConfig)===null||e===void 0?void 0:e.uiRefresh)===null||i===void 0||i.call(e)}async play(){var c;if(!this._viewer||this._isPlaying||this._isPlayingLoop)return;this._isPlaying=!0,this._isPlayingLoop=!0;const e=this._viewer.getPluginByType("AssetManagerBasicPopupPlugin");e==null||e.enabled,e&&(e.enabled=!1);const i=this._viewer.getPluginByType("FrameFade"),s=this._viewer.getPluginByType("GLTFAnimation"),a=this._viewer.getPluginByType("CameraViews");for(;this._isPlaying;)for(const h of this.scenes){if(!this._isPlaying)break;const f=Object.keys(h);s==null||s.stopAnimation(!1),await(a==null?void 0:a.stopAllAnimations()),this._viewer.scene.removeSceneModels(),this._viewer.renderEnabled=!1;for(const et of f){let tt=this.assets[et];tt||(tt={path:et,file:new File([h[et]],et)},this.assets[et]=tt),await((c=this._viewer.getManager())===null||c===void 0?void 0:c.addAssetSingle(tt,this._options))}if(!this._isPlaying)break;this._viewer.renderEnabled=!0,e&&(e.enabled=!1),i&&(i.enabled=!0,await i.startTransition(1e3));const k=[au(this.minSceneTime)];s&&k.push(s.playAnimation()),a&&k.push(a.animateAllViews()),await Promise.all(k)}this._isPlayingLoop=!1}stop(){this._isPlaying=!1}async downloadScenes(){const c={};for(const i of this.scenes)for(const s of Object.keys(i)){const a=c[s]?s+"_":s;c[a]=i[a]}const e=OM(c);Du(new Blob([e],{type:"application/zip"}),"scenes.glbloop")}async onAdded(c){await super.onAdded(c);const e=this;uo.Importers.push(new zl(class extends M1{load(i,s,a,h){super.load(i,f=>{e.loadScenes([...f.values()]),s==null||s(null),au(100).then(e.play)},a,h)}},["glbloop"],!0))}};_m.PluginType="SceneLoopPlugin",c_([qp("Loaded scenes")],_m.prototype,"loadedScenes",null),c_([Ao("Load Scenes")],_m.prototype,"promptLoadScenes",null),c_([qp("Playing")],_m.prototype,"_isPlaying",void 0),c_([so("Min Scene Time")],_m.prototype,"minSceneTime",void 0),c_([Ao("Play")],_m.prototype,"play",null),c_([Ao("Stop")],_m.prototype,"stop",null),c_([Ao("Download Scenes")],_m.prototype,"downloadScenes",null),_m=c_([Ws("Scene Loop")],_m);var GT=__webpackgi_require__(701),RC=__webpackgi_require__.n(GT),gP=__webpackgi_require__(236),xE=__webpackgi_require__.n(gP),HT=__webpackgi_require__(850),kC=__webpackgi_require__.n(HT),bE=__webpackgi_require__(182),Px=__webpackgi_require__.n(bE),vP=__webpackgi_require__(213),BC=__webpackgi_require__.n(vP),EE=__webpackgi_require__(798),rw={};EE.Z&&EE.Z.locals&&(rw.locals=EE.Z.locals);var SE,s0=0,Ky={};Ky.styleTagTransform=BC(),Ky.setAttributes=kC(),Ky.insert=function(c,e){(e.target||document.head).appendChild(c)},Ky.domAPI=xE(),Ky.insertStyleElement=Px(),rw.use=function(c){return Ky.options=c||{},s0++||(SE=RC()(EE.Z,Ky)),rw},rw.unuse=function(){s0>0&&!--s0&&(SE(),SE=null)};var CE,WT=rw,J0=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};let o0=CE=class extends Js{constructor(){super(),this.enabled=!0,this.dependencies=[Kr],this._popupDiv=El({id:"assetManagerPopup",addToBody:!1,innerHTML:""});const c=El({id:"assetManagerPopupClose",addToBody:!1,innerHTML:"&#10005"});c.addEventListener("click",()=>{this._popupDiv.style.display="none"}),this._popupContent=El({id:"assetManagerPopupContent",addToBody:!1,innerHTML:""}),this.enabled||(this._popupDiv.style.display="none"),this._popupDiv.appendChild(c),this._popupDiv.appendChild(this._popupContent)}_onEnabledChange(){this.enabled||(this._popupDiv.style.display="none")}_updatePopupDiv(c){if(!this._popupContent)return;if(!this.enabled)return void(this._popupDiv.style.display="none");let e="";c.forEach((i,s)=>{e+=`<span class="processState">${i.state}</span>: ${s.split("/").pop()} ${i.progress?" - "+i.progress:""}<br>`}),this._popupContent.innerHTML=e,c.size===0?this._popupDiv.style.display="none":this._popupDiv.style.display="block"}async onAdded(c){var e,i,s,a;await super.onAdded(c),WT.use({target:c.container}),c.container.appendChild(this._popupDiv);const h=new Map;(i=(e=c.getManager())===null||e===void 0?void 0:e.importer)===null||i===void 0||i.addEventListener("importFile",f=>{f.state!=="done"?h.set(f.path,{state:f.state,progress:f.progress?(100*f.progress).toFixed(0)+"%":void 0}):h.delete(f.path),this._updatePopupDiv(h)}),(a=(s=c.getManager())===null||s===void 0?void 0:s.exporter)===null||a===void 0||a.addEventListener("exportFile",f=>{f.state!=="done"?h.set(f.obj.name,{state:f.state,progress:f.progress?(100*f.progress).toFixed(0)+"%":void 0}):h.delete(f.obj.name),this._updatePopupDiv(h)})}};o0.PluginType="AssetManagerBasicPopupPlugin",J0([Jr("Enabled"),hn(CE.prototype._onEnabledChange),jn()],o0.prototype,"enabled",void 0),o0=CE=J0([Ws("Asset manager popup")],o0);class _P extends bu{constructor(e){super({vertexShader:nt.vertexShader,uniforms:{tDiffuse:{value:null}},defines:{},fragmentShader:`
                varying vec2 vUv;
                ${e[0]}
                void main() {
                    gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                    #glMarker
                    ${e[1]}
                }
                `},"tDiffuse"),this.uiConfig=void 0,this.customMaterial=new M_}render(e,i,s,a,h){super.render(e,i,s,a,h),this.needsSwap=!0}}class Tp extends wv{constructor(e=!0,i=!0){super(),this.depthTonemap=e,this.passId="combinedPost",this.dependencies=[ba],this.toJSON=void 0,this._beforeFilters=[],this._afterFilters=["render"],this._requiredFilters=["render"],this._renderToScreen=!0,this._setDirty=this._setDirty.bind(this),this._renderToScreen=i}get renderToScreen(){return this._renderToScreen}async onAdded(e){var i,s;return!((s=(i=this._viewer)===null||i===void 0?void 0:i.screenShader)===null||s===void 0)&&s.isShaderPass2&&(this._renderToScreen=!1),this._renderToScreen&&nn(e.renderer.passes.find(a=>a.passId==="screen"),"enabled",!1,!0,!0),super.onAdded(e)}passCtor(e){var i,s,a,h;const f=e.screenShader,k=["",""];this._renderToScreen&&!f.isShaderPass2&&(k[0]=Array.isArray(f)?f[0]:((i=f)===null||i===void 0?void 0:i.pars)||"",k[1]=Array.isArray(f)?f[1]:typeof f=="string"?f:((s=f)===null||s===void 0?void 0:s.main)||"");const et=new _P(k);return nn((h=(a=et.uiConfig)===null||a===void 0?void 0:a.children)===null||h===void 0?void 0:h.find(tt=>{var rt;return((rt=tt)===null||rt===void 0?void 0:rt.label)==="Enabled"}),"hidden",!0,!0),et}_update(e){var i;return!!super._update(e)&&(this._pass.passObject.updateShaderProperties((i=this._viewer)===null||i===void 0?void 0:i.getPlugin(ba)),!0)}_setDirty(){this.pass&&(this.pass.dirty=!0)}get uiConfig(){var e,i,s;return(s=(i=(e=this.pass)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.uiConfig)!==null&&s!==void 0?s:{}}addExtension(e){this.pass.passObject.material.registerMaterialExtensions([e])}}Tp.PluginType="CombinedPostPlugin";var qT=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};class a0 extends Js{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[Tp]}get uiConfig(){var e;return(e=this._extension)===null||e===void 0?void 0:e.uiConfig}get config(){return this._extension}disposeExtension(){}async onAdded(e){var i;await super.onAdded(e),this._extension=this.generateExtension(e),(i=e.getPlugin(Tp))===null||i===void 0||i.addExtension(this._extension)}async onRemove(e){this.disposeExtension(),this._extension=void 0,await super.onRemove(e)}}qT([jn("extension")],a0.prototype,"_extension",void 0),qT([jn()],a0.prototype,"enabled",void 0);class Z0{constructor(){this.uiConfig=void 0,this.enabled=!0}shaderExtender(e,i,s){this.enabled&&(e.fragmentShader=Ul(e.fragmentShader,"#glMarker",` 
            gl_FragColor = LinearTosRGB(gl_FragColor);
            #glMarker
        `))}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}}class ME extends a0{generateExtension(e){return new Z0}}ME.PluginType="GammaCorrection";var Dx,Rv=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};const YT=d.dZ3;let ey=Dx=class{constructor(c,e=!0,i=!0){this.depthTonemap=e,this.toneMapping=d.LY2,this.tonemapBackground=!0,this.clipBackground=!1,this.exposure=1,this._renderToScreen=!0,this.enabled=!0,this._rendererState={},this.extraUniforms={tNormalDepth:{value:null},tGBufferFlags:{value:null},opacity:{value:1}},this.parsFragmentSnippet=(s,a)=>this.enabled?Ut`
            ${this.depthTonemap?Hv:""}
            #define USE_DEPTH_TONEMAP ${this.depthTonemap?"1":"0"}
            uniform float opacity;
            ${`vec4 ToneMapping(in vec4 color){vec4 outColor=opacity*color;
#if USE_DEPTH_TONEMAP > 0
bool doTonemap=getGBufferFlags(vUv).x>0.5;float depth=getDepth(vUv);
#if TONEMAP_BACKGROUND < 1 || TRANSPARENT_BACKGROUND > 0
bool isBackground=depth>0.9999;if(isBackground)doTonemap=false;
#endif
if(doTonemap){
#endif
#if defined( TONE_MAPPING )
outColor.rgb=toneMapping(outColor.rgb);
#endif
#if USE_DEPTH_TONEMAP > 0
}else{
#if TRANSPARENT_BACKGROUND > 0
if(isBackground)outColor.a=0.;
#endif
}if(depth<0.00001)outColor.a=0.;
#endif
return outColor;}`}
        `:"",this._combinedPostPlugin=c.getPlugin(Tp),this._setDirty=this._setDirty.bind(this),this._renderToScreen=i,this.depthTonemap=e}shaderExtender(c,e,i){this.enabled&&(c.fragmentShader=Ul(c.fragmentShader,"#glMarker",` 
            gl_FragColor = ToneMapping(gl_FragColor);
            #glMarker
        `))}onObjectRender(c,e,i){if(!this.enabled)return;const{toneMapping:s,toneMappingExposure:a,outputEncoding:h}=i;this._rendererState.toneMapping=s,this._rendererState.toneMappingExposure=a,this._rendererState.outputEncoding=h;let f=this.tonemapBackground?"1":"0";e.materialObject.defines.TONEMAP_BACKGROUND!==f&&(e.materialObject.defines.TONEMAP_BACKGROUND=f,e.materialObject.needsUpdate=!0),f=this.clipBackground?"1":"0",e.materialObject.defines.TRANSPARENT_BACKGROUND!==f&&(e.materialObject.defines.TRANSPARENT_BACKGROUND=f,e.materialObject.needsUpdate=!0),i.toneMapping=this.toneMapping,i.toneMappingExposure=this.exposure,i.outputEncoding=d.knz,e.materialObject.toneMapped=!0,e.materialObject.needsUpdate=!0}onAfterRender(c,e,i){i.toneMapping=this._rendererState.toneMapping,i.toneMappingExposure=this._rendererState.toneMappingExposure,i.outputEncoding=this._rendererState.outputEncoding}getUiConfig(){return this.uiConfig}computeCacheKey(c){return this.enabled?"1":"0"}isCompatible(c){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};ey.PluginType="Tonemap",Rv([vu("Mode",[["Linear",d.EoG],["Reinhard",d.CdI],["Cineon",d.YGz],["ACESFilmic",d.LY2],["Uncharted2",YT]].map(c=>({label:c[0],value:c[1]})),{limitedUi:!0}),hn(Dx.prototype._setDirty),jn()],ey.prototype,"toneMapping",void 0),Rv([Jr("Tonemap Background",{limitedUi:!0}),jn()],ey.prototype,"tonemapBackground",void 0),Rv([hn(Dx.prototype._setDirty),Jr("Clip Background"),jn()],ey.prototype,"clipBackground",void 0),Rv([hn(Dx.prototype._setDirty),Xr("Exposure",[0,2*Math.PI],.01,{limitedUi:!0}),jn()],ey.prototype,"exposure",void 0),ey=Dx=Rv([Ws("Tonemapping")],ey);class Rx extends a0{constructor(e=!0){super(),this.depthTonemap=e,this.depthTonemap=e}fromJSON(e,i){return e.pass&&((e={...e}).extension={...e.pass},delete e.extension.enabled,delete e.pass),super.fromJSON(e,i)}generateExtension(e){return new ey(e,this.depthTonemap)}get exposure(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.exposure)!==null&&i!==void 0?i:1}set exposure(e){this._extension&&(this._extension.exposure=e,this._extension.setDirty())}get toneMapping(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.toneMapping)!==null&&i!==void 0?i:d.EoG}set toneMapping(e){this._extension&&(this._extension.toneMapping=e,this._extension.setDirty())}}Rx.PluginType="Tonemap",d.WdD.tonemapping_pars_fragment=d.WdD.tonemapping_pars_fragment.replace("vec3 CustomToneMapping( vec3 color ) { return color; }",`

// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/
#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )
vec3 Uncharted2ToneMapping( vec3 color ) {

	// John Hable's filmic operator from Uncharted 2 video game
	color *= toneMappingExposure;
	return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( 1.0 ) ) );

}

vec3 CustomToneMapping( vec3 color ) { return Uncharted2ToneMapping( color ); }

`);var kx,iw=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};let sw=kx=class{constructor(c){this.enabled=!1,this.intensity=1,this.lutMap=void 0,this.extraUniforms={intensity:{value:1},lutSize:{value:1}},this.parsFragmentSnippet=(e,i)=>this.enabled?`#if USE_LUT == 1
uniform float lutSize;uniform float intensity;
#if USE_3DTEXTURE == 1
precision highp sampler3D;uniform sampler3D lut3d;
#else
uniform sampler2D lut;vec3 lutLookup(sampler2D tex,float size,vec3 rgb){float sliceHeight=1./size;float yPixelHeight=1./(size*size);float slice=rgb.b*size;float interp=fract(slice);float slice0=slice-interp;float centeredInterp=interp-0.5;float slice1=slice0+sign(centeredInterp);float greenOffset=clamp(rgb.g*sliceHeight,yPixelHeight*0.5,sliceHeight-yPixelHeight*0.5);vec2 uv0=vec2(rgb.r,slice0*sliceHeight+greenOffset);vec2 uv1=vec2(rgb.r,slice1*sliceHeight+greenOffset);vec3 sample0=texture2D(tex,uv0).rgb;vec3 sample1=texture2D(tex,uv1).rgb;return mix(sample0,sample1,abs(centeredInterp));}
#endif
vec4 colorLookUp(in vec4 color){vec4 outColor;float pixelWidth=1./lutSize;float halfPixelWidth=0.5/lutSize;vec3 uvw=vec3(halfPixelWidth)+color.rgb*(1.-pixelWidth);float lutFac=step(0.0001,getGBufferFlags(vUv).a);
#if USE_3DTEXTURE == 1
outColor=vec4(texture(lut3d,uvw).rgb,color.a);
#else
outColor=vec4(lutLookup(lut,lutSize,uvw),color.a);
#endif
outColor=mix(color,outColor,lutFac);return vec4(mix(color,outColor,intensity));}
#endif
`:"",this._combinedPostPlugin=c.getPlugin(Tp),this._setDirty=this._setDirty.bind(this)}shaderExtender(c,e,i){this.enabled&&(c.fragmentShader=Ul(c.fragmentShader,"#glMarker",` 
            #if USE_LUT == 1
                gl_FragColor = colorLookUp(gl_FragColor);
            #endif
            #glMarker
        `))}onObjectRender(c,e,i){if(this.enabled)if(this.lutMap){const s=this.lutMap.texture3D?1:0;e.materialObject.defines.USE_3DTEXTURE!==s&&(e.materialObject.defines.USE_3DTEXTURE=s,e.materialObject.needsUpdate=!0);let a=1;this.lutMap.texture3D?(e.materialObject.uniforms.lut3d={value:this.lutMap.texture3D},e.materialObject.uniforms.lut3d.value.needsUpdate=!0,a=this.lutMap.texture3D.image.width):this.lutMap.texture&&(e.materialObject.uniforms.lut={value:this.lutMap.texture},e.materialObject.uniforms.lut.value.needsUpdate=!0,a=this.lutMap.texture.image.width),e.materialObject.uniforms.lutSize.value=a,e.materialObject.uniforms.intensity.value=this.intensity,e.materialObject.defines.USE_LUT=1}else e.materialObject.defines.USE_3DTEXTURE=0,e.materialObject.defines.USE_LUT=0,e.materialObject.needsUpdate=!0}getUiConfig(){return this.uiConfig}computeCacheKey(c){return this.enabled?"1":"0"}isCompatible(c){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}};iw([jn(),hn(kx.prototype._setDirty),Jr("Enable")],sw.prototype,"enabled",void 0),iw([jn(),hn(kx.prototype._setDirty),Xr("Intensity")],sw.prototype,"intensity",void 0),iw([hn(kx.prototype._setDirty),Ku("LUT"),jn()],sw.prototype,"lutMap",void 0),sw=kx=iw([Ws("LUT")],sw);class TE extends a0{generateExtension(e){return new sw(e)}}TE.PluginType="LUT";var Bx,Po=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};let $y=Bx=class{constructor(c){this.enabled=!1,this.power=.5,this.bgcolor=new d.Ilk(0),this.extraUniforms={power:{value:1},bgcolor:{value:new d.Ilk}},this.parsFragmentSnippet=(e,i)=>this.enabled?Ut`
            uniform float power;
            uniform vec3 bgcolor;
            ${"vec4 Vignette(in vec4 color){vec2 uv=vUv*(1.-vUv);float vig=uv.x*uv.y*16.;vig=pow(vig,power);return vec4(mix(color.rgb,vec3(bgcolor),1.-vig),color.a);}"}
        `:"",this._combinedPostPlugin=c.getPlugin(Tp),this._setDirty=this._setDirty.bind(this)}shaderExtender(c,e,i){this.enabled&&(c.fragmentShader=Ul(c.fragmentShader,"#glMarker",` 
            gl_FragColor = Vignette(gl_FragColor);
            #glMarker
        `))}onObjectRender(c,e,i){this.enabled&&(e.materialObject.uniforms.power.value=this.power,e.materialObject.uniforms.bgcolor.value.copy(this.bgcolor))}getUiConfig(){return this.uiConfig}computeCacheKey(c){return this.enabled?"1":"0"}isCompatible(c){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};$y.PluginType="Vignette",Po([hn(Bx.prototype._setDirty),Jr("Enable"),jn()],$y.prototype,"enabled",void 0),Po([hn(Bx.prototype._setDirty),Xr("Power",[.1,4],.01,{limitedUi:!0}),jn()],$y.prototype,"power",void 0),Po([hn(Bx.prototype._setDirty),op("Color"),jn()],$y.prototype,"bgcolor",void 0),$y=Bx=Po([Ws("Vignette")],$y);class IE extends a0{constructor(){super()}generateExtension(e){return new $y(e)}get power(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.power)!==null&&i!==void 0?i:1}set power(e){this._extension&&(this._extension.power=e,this._extension.setDirty())}get color(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.bgcolor)!==null&&i!==void 0?i:new d.Ilk}set color(e){this._extension&&(this._extension.bgcolor.copy(e),this._extension.setDirty())}}IE.PluginType="Vignette";var PE,OC=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};let ty=PE=class{constructor(c){this.enabled=!1,this.aberrationIntensity=.01,this.extraUniforms={aberrationIntensity:{value:1}},this.parsFragmentSnippet=(e,i)=>this.enabled?Ut`
            uniform float aberrationIntensity;
            ${"vec4 chromaticAberration(){vec2 distFromCenter=vUv-0.5;vec2 aberrated=aberrationIntensity*pow(distFromCenter,vec2(2.));vec4 color=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 outColor=vec4(tDiffuseTexelToLinear(texture2D(tDiffuse,vUv+aberrated)).r,color.g,tDiffuseTexelToLinear(texture2D(tDiffuse,vUv-aberrated)).b,color.a);return outColor;}"}
        `:"",this._combinedPostPlugin=c.getPlugin(Tp),this._setDirty=this._setDirty.bind(this)}shaderExtender(c,e,i){this.enabled&&(c.fragmentShader=Ul(c.fragmentShader,"#glMarker",` 
            gl_FragColor = chromaticAberration();
            #glMarker
        `))}onObjectRender(c,e,i){this.enabled&&(e.materialObject.uniforms.aberrationIntensity.value=this.aberrationIntensity)}getUiConfig(){return this.uiConfig}computeCacheKey(c){return this.enabled?"1":"0"}isCompatible(c){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};ty.PluginType="ChromaticAberration",OC([hn(PE.prototype._setDirty),Jr("Enable"),jn()],ty.prototype,"enabled",void 0),OC([hn(PE.prototype._setDirty),Xr("Intensity",[0,.1],.001,{limitedUi:!0}),jn()],ty.prototype,"aberrationIntensity",void 0),ty=PE=OC([Ws("ChromaticAberration")],ty);class DE extends a0{constructor(){super()}generateExtension(e){return new ty(e)}get intensity(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.aberrationIntensity)!==null&&i!==void 0?i:1}set intensity(e){this._extension&&(this._extension.aberrationIntensity=e,this._extension.setDirty())}}DE.PluginType="ChromaticAberration";var Ox,RE=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};let ow=Ox=class{constructor(c){this.enabled=!1,this.grainMultiply=!1,this.grainIntensity=10,this.extraUniforms={grainIntensity:{value:1},grainMultiply:{value:1}},this.parsFragmentSnippet=(e,i)=>this.enabled?Ut`
            uniform float grainIntensity;
            uniform bool grainMultiply;
            ${"vec4 grain(in vec4 color){float x=(vUv.x+4.)*(vUv.y+4.)*(10.);vec4 grain=vec4(mod((mod(x,13.)+1.)*(mod(x,123.)+1.),0.01)-0.005)*grainIntensity;vec4 outColor=color;if(grainMultiply){grain=1.-grain;outColor.rgb=color.rgb*vec3(grain);}else{outColor.rgb=color.rgb+vec3(grain);}return outColor;}"}
        `:"",this._combinedPostPlugin=c.getPlugin(Tp),this._setDirty=this._setDirty.bind(this)}shaderExtender(c,e,i){this.enabled&&(c.fragmentShader=Ul(c.fragmentShader,"#glMarker",` 
            gl_FragColor = grain(gl_FragColor);
            #glMarker
        `))}onObjectRender(c,e,i){this.enabled&&(e.materialObject.uniforms.grainIntensity.value=this.grainIntensity,e.materialObject.uniforms.grainMultiply.value=this.grainMultiply)}getUiConfig(){return this.uiConfig}computeCacheKey(c){return this.enabled?"1":"0"}isCompatible(c){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};RE([hn(Ox.prototype._setDirty),Jr("Enable"),jn()],ow.prototype,"enabled",void 0),RE([hn(Ox.prototype._setDirty),Jr("Multiply"),jn()],ow.prototype,"grainMultiply",void 0),RE([hn(Ox.prototype._setDirty),Xr("Intensity",[0,20],.01,{limitedUi:!0}),jn()],ow.prototype,"grainIntensity",void 0),ow=Ox=RE([Ws("FilmicGrain")],ow);class kE extends a0{constructor(){super()}generateExtension(e){return new ow(e)}get intensity(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.grainIntensity)!==null&&i!==void 0?i:1}set intensity(e){this._extension&&(this._extension.grainIntensity=e,this._extension.setDirty())}get multiply(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.grainMultiply)!==null&&i!==void 0&&i}set multiply(e){this._extension&&(this._extension.grainMultiply=e,this._extension.setDirty())}}async function BE(c,{ground:e=!0,bloom:i=!0,depthTonemap:s=!0,enableDrop:a=!1}={}){await c.addPlugin(ba),await c.addPlugin(su),a&&await c.addPlugin(Qw),await c.addPlugin(new dp(32)),await c.addPlugin(new Tp),await c.addPlugin(new DE),await c.addPlugin(new Rx(s||!c.useRgbm)),await c.addPlugin(new TE),await c.addPlugin(new IE),await c.addPlugin(new kE),await c.addPlugin(new ME),await c.addPlugin(O1),await c.addPlugin(N1),await c.addPlugin(Xl),await c.addPlugin(X_),await c.addPlugin(Rl),e&&await c.addPlugin(pm),i&&await c.addPlugin(X0),await c.addPlugin(mm),await c.addPlugin(Im),await c.addPlugin(pp),await c.addPlugin(np),await c.addPlugin($m),await c.addPlugin(Ax,!1),await c.addPlugin(wx),await c.addPlugin(lu),await c.addPlugin(J_,!1),await c.addPlugin(vm,!1),await c.addPlugin(t0,!1),await c.addPlugin(Cu,!1),await c.addPlugin(DC),await c.addPlugin(i0),await c.addPlugin(_m)}async function OE(c,{debug:e=!1,ground:i=!0,bloom:s=!0,depthTonemap:a=!1,importPopup:h=!0,enableDrop:f=!1}={}){var k;const et=new Ym(c);e&&await et.addPlugin(Tv);const tt=await et.addPlugin(Kr,void 0,void 0,{storage:caches?await caches.open("webgi-cache-storage"):void 0});return h&&await et.addPlugin(o0),await BE(et,{ground:i,bloom:s,depthTonemap:a,enableDrop:f}),et.renderer.refreshPipeline(),(k=tt.importer)===null||k===void 0||k.processors.add("model",{forAssetType:"model",process:(rt,lt)=>rt}),et}kE.PluginType="FilmicGrain";let yP=0;class XT extends HTMLElement{constructor(){super(),this._initialized=!1,this._state={src:"",environment:""},this._models={},this._refreshingModels=!1,this._refreshingEnvironment=!1,this.viewerIndex=yP++,this.canvasId="webgi-viewer-"+this.viewerIndex,this.attachShadow({mode:"open"}),this.wrapper=document.createElement("div"),this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.display="block",this.canvas=b_(),this.canvas.setAttribute("id",this.canvasId);const e=document.createElement("style");e.textContent=Gt`
            #${this.canvasId}{
              width: 100%; height: 100%; z-index: 1;
              display: block;
            }
        `,this.wrapper.append(this.canvas),this.shadowRoot.append(e,this.wrapper),this._initialize().then(async()=>this.refreshAll())}async refreshAll(){await Promise.all([this.refreshModelSource(),this.refreshEnvironment()])}async _initialize(){this._initialized||(this.viewer=await OE({canvas:this.canvas,useRgbm:this._getAttr("rgbm","true")==="true",useGBufferDepth:this._getAttr("depth-prepass","true")==="true"},{debug:this._getAttr("debug","false")==="true",ground:this._getAttr("ground","baked")==="baked",bloom:this._getAttr("bloom","true")==="true",depthTonemap:!0}),this._initialized=!0,this.dispatchEvent(new Event("initialized")))}connectedCallback(){console.log("WebGiViewerElement added to page."),this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0)}disconnectedCallback(){console.log("WebGiViewerElement removed from page."),this.viewer&&(this.viewer.enabled=!1)}adoptedCallback(){console.log("WebGiViewerElement moved to new page."),this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0)}static get observedAttributes(){return["src","environment"]}attributeChangedCallback(e,i,s){console.log("WebGiViewerElement attributes changed.",e,i,s),this.refreshAll()}clearModels(){}async refreshModelSource(){if(!this.viewer)return;const e=this._getAttr("src","");if(e===this._state.src||this._refreshingModels)return;this._refreshingModels=!0;const i=[e],s=[],a=[];for(const h of i)!this._models[h]&&h&&(this._models[h]=this.viewer.getManager().importer.importPath(h,{autoScale:this._getAttr("auto-scale","true")==="true",autoCenter:this._getAttr("auto-center","true")==="true",processImported:!1}));for(const[h,f]of Object.entries(this._models))i.includes(h)?s.push(f):a.push(f);await Promise.all([Promise.all(s).then(async h=>Promise.all(h.map(async f=>this.viewer.getManager().importer.processImported(f)))).then(h=>{for(const f of h)for(const k of f)k&&k.assetType==="model"&&this.viewer.scene.addSceneObject(k)}),Promise.all(a).then(h=>{for(const f of h)for(const k of f)k&&k.assetType==="model"&&k.modelObject.removeFromParent()})]),this._state.src=e,this._refreshingModels=!1}async refreshEnvironment(){if(!this.viewer)return;if(!this.hasAttribute("environment"))return void(this._state.environment=null);const e=this._getAttr("environment","");if(e===this._state.src||this._refreshingEnvironment)return;this._refreshingEnvironment=!0;const i=this.viewer.scene.getEnvironment(),s=e?await this.viewer.getManager().importer.importSinglePath(e):void 0;s&&s.assetType!=="texture"||await this.viewer.scene.setEnvironment(s),i==null||i.dispose(),this._state.environment=e,this._refreshingEnvironment=!1}_getAttr(e,i){return this.hasAttribute(e)?this.getAttribute(e):i}}window&&window.customElements&&!window.customElements.get("webgi-viewer")&&window.customElements.define("webgi-viewer",XT);class KT{constructor(e){var i,s,a;this._basePath=(i=e==null?void 0:e.basePath)!==null&&i!==void 0?i:"",this._assets=(a=(s=e==null?void 0:e.assets)===null||s===void 0?void 0:s.map(h=>this._resolveAsset(h)))!==null&&a!==void 0?a:[]}get basePath(){return this._basePath}get assets(){return this._assets}find(e){const i=this._assets.find(e);return i??void 0}_resolveAsset(e){return{...e,path:w0([this._basePath,e.path])}}}class AP extends j{constructor(...e){super(),this._assets=e}addAssetList(e){this._assets.push(e)}removeAssetList(e){const i=this._assets.indexOf(e);i>=0&&this._assets.splice(i,1)}async findAssetRegex(e){for(const i of this._assets){const s=i.find(a=>{var h,f;return a&&(e.test(a.path)||e.test((f=(h=a.file)===null||h===void 0?void 0:h.name)!==null&&f!==void 0?f:""))});if(s)return s}console.warn("Asset not found:",e)}async findAsset(e){return this.findAssetRegex(e.query)}async findAssetSimple(e,i=!1){return this.findAssetRegex(new RegExp(e,i?"i":""))}}var LC={},aw=function(c){return URL.createObjectURL(new Blob([c],{type:"text/javascript"}))},$T=function(c){return new Worker(c)};try{URL.revokeObjectURL(aw(""))}catch{aw=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},$T=function(e){return new Worker(e,{type:"module"})}}var Co=Uint8Array,rp=Uint16Array,Ip=Uint32Array,l0=new Co([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ny=new Co([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Lx=new Co([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),NC=function(c,e){for(var i=new rp(31),s=0;s<31;++s)i[s]=e+=1<<c[s-1];var a=new Ip(i[30]);for(s=1;s<30;++s)for(var h=i[s];h<i[s+1];++h)a[h]=h-i[s]<<5|s;return[i,a]},JT=NC(l0,2),FC=JT[0],Nx=JT[1];FC[28]=258,Nx[258]=28;for(var UC=NC(ny,0),ZT=UC[0],jC=UC[1],Fx=new rp(32768),Hl=0;Hl<32768;++Hl){var u_=(43690&Hl)>>>1|(21845&Hl)<<1;u_=(61680&(u_=(52428&u_)>>>2|(13107&u_)<<2))>>>4|(3855&u_)<<4,Fx[Hl]=((65280&u_)>>>8|(255&u_)<<8)>>>1}var Dm=function(c,e,i){for(var s=c.length,a=0,h=new rp(e);a<s;++a)++h[c[a]-1];var f,k=new rp(e);for(a=0;a<e;++a)k[a]=k[a-1]+h[a-1]<<1;if(i){f=new rp(1<<e);var et=15-e;for(a=0;a<s;++a)if(c[a])for(var tt=a<<4|c[a],rt=e-c[a],lt=k[c[a]-1]++<<rt,pt=lt|(1<<rt)-1;lt<=pt;++lt)f[Fx[lt]>>>et]=tt}else for(f=new rp(s),a=0;a<s;++a)c[a]&&(f[a]=Fx[k[c[a]-1]++]>>>15-c[a]);return f},c0=new Co(288);for(Hl=0;Hl<144;++Hl)c0[Hl]=8;for(Hl=144;Hl<256;++Hl)c0[Hl]=9;for(Hl=256;Hl<280;++Hl)c0[Hl]=7;for(Hl=280;Hl<288;++Hl)c0[Hl]=8;var u0=new Co(32);for(Hl=0;Hl<32;++Hl)u0[Hl]=5;var cu=Dm(c0,9,0),eI=Dm(c0,9,1),mu=Dm(u0,5,0),Ux=Dm(u0,5,1),LE=function(c){for(var e=c[0],i=1;i<c.length;++i)c[i]>e&&(e=c[i]);return e},Zm=function(c,e,i){var s=e/8|0;return(c[s]|c[s+1]<<8)>>(7&e)&i},NE=function(c,e){var i=e/8|0;return(c[i]|c[i+1]<<8|c[i+2]<<16)>>(7&e)},lw=function(c){return(c/8|0)+(7&c&&1)},jp=function(c,e,i){(e==null||e<0)&&(e=0),(i==null||i>c.length)&&(i=c.length);var s=new(c instanceof rp?rp:c instanceof Ip?Ip:Co)(i-e);return s.set(c.subarray(e,i)),s},Jy=function(c,e,i){var s=c.length;if(!s||i&&!i.l&&s<5)return e||new Co(0);var a=!e||i,h=!i||i.i;i||(i={}),e||(e=new Co(3*s));var f=function(hs){var _r=e.length;if(hs>_r){var Ys=new Co(Math.max(2*_r,hs));Ys.set(e),e=Ys}},k=i.f||0,et=i.p||0,tt=i.b||0,rt=i.l,lt=i.d,pt=i.m,ft=i.n,vt=8*s;do{if(!rt){i.f=k=Zm(c,et,1);var yt=Zm(c,et+1,3);if(et+=3,!yt){var Mt=c[(En=lw(et)+4)-4]|c[En-3]<<8,xt=En+Mt;if(xt>s){if(h)throw"unexpected EOF";break}a&&f(tt+Mt),e.set(c.subarray(En,xt),tt),i.b=tt+=Mt,i.p=et=8*xt;continue}if(yt==1)rt=eI,lt=Ux,pt=9,ft=5;else{if(yt!=2)throw"invalid block type";var Et=Zm(c,et,31)+257,At=Zm(c,et+10,15)+4,Rt=Et+Zm(c,et+5,31)+1;et+=14;for(var Bt=new Co(Rt),Qt=new Co(19),Wt=0;Wt<At;++Wt)Qt[Lx[Wt]]=Zm(c,et+3*Wt,7);et+=3*At;var tn=LE(Qt),pn=(1<<tn)-1,yn=Dm(Qt,tn,1);for(Wt=0;Wt<Rt;){var En,wn=yn[Zm(c,et,pn)];if(et+=15&wn,(En=wn>>>4)<16)Bt[Wt++]=En;else{var In=0,xn=0;for(En==16?(xn=3+Zm(c,et,3),et+=2,In=Bt[Wt-1]):En==17?(xn=3+Zm(c,et,7),et+=3):En==18&&(xn=11+Zm(c,et,127),et+=7);xn--;)Bt[Wt++]=In}}var Cn=Bt.subarray(0,Et),Fn=Bt.subarray(Et);pt=LE(Cn),ft=LE(Fn),rt=Dm(Cn,pt,1),lt=Dm(Fn,ft,1)}if(et>vt){if(h)throw"unexpected EOF";break}}a&&f(tt+131072);for(var Tn=(1<<pt)-1,Wn=(1<<ft)-1,or=et;;or=et){var fr=(In=rt[NE(c,et)&Tn])>>>4;if((et+=15&In)>vt){if(h)throw"unexpected EOF";break}if(!In)throw"invalid length/literal";if(fr<256)e[tt++]=fr;else{if(fr==256){or=et,rt=null;break}var rr=fr-254;if(fr>264){var Ir=l0[Wt=fr-257];rr=Zm(c,et,(1<<Ir)-1)+FC[Wt],et+=Ir}var kr=lt[NE(c,et)&Wn],Br=kr>>>4;if(!kr)throw"invalid distance";if(et+=15&kr,Fn=ZT[Br],Br>3&&(Ir=ny[Br],Fn+=NE(c,et)&(1<<Ir)-1,et+=Ir),et>vt){if(h)throw"unexpected EOF";break}a&&f(tt+131072);for(var Ur=tt+rr;tt<Ur;tt+=4)e[tt]=e[tt-Fn],e[tt+1]=e[tt+1-Fn],e[tt+2]=e[tt+2-Fn],e[tt+3]=e[tt+3-Fn];tt=Ur}}i.l=rt,i.p=or,i.b=tt,rt&&(k=1,i.m=pt,i.d=lt,i.n=ft)}while(!k);return tt==e.length?e:jp(e,0,tt)},h_=function(c,e,i){i<<=7&e;var s=e/8|0;c[s]|=i,c[s+1]|=i>>>8},cw=function(c,e,i){i<<=7&e;var s=e/8|0;c[s]|=i,c[s+1]|=i>>>8,c[s+2]|=i>>>16},FE=function(c,e){for(var i=[],s=0;s<c.length;++s)c[s]&&i.push({s,f:c[s]});var a=i.length,h=i.slice();if(!a)return[h0,0];if(a==1){var f=new Co(i[0].s+1);return f[i[0].s]=1,[f,1]}i.sort(function(Bt,Qt){return Bt.f-Qt.f}),i.push({s:-1,f:25001});var k=i[0],et=i[1],tt=0,rt=1,lt=2;for(i[0]={s:-1,f:k.f+et.f,l:k,r:et};rt!=a-1;)k=i[i[tt].f<i[lt].f?tt++:lt++],et=i[tt!=rt&&i[tt].f<i[lt].f?tt++:lt++],i[rt++]={s:-1,f:k.f+et.f,l:k,r:et};var pt=h[0].s;for(s=1;s<a;++s)h[s].s>pt&&(pt=h[s].s);var ft=new rp(pt+1),vt=_g(i[rt-1],ft,0);if(vt>e){s=0;var yt=0,Mt=vt-e,xt=1<<Mt;for(h.sort(function(Bt,Qt){return ft[Qt.s]-ft[Bt.s]||Bt.f-Qt.f});s<a;++s){var Et=h[s].s;if(!(ft[Et]>e))break;yt+=xt-(1<<vt-ft[Et]),ft[Et]=e}for(yt>>>=Mt;yt>0;){var At=h[s].s;ft[At]<e?yt-=1<<e-ft[At]++-1:++s}for(;s>=0&&yt;--s){var Rt=h[s].s;ft[Rt]==e&&(--ft[Rt],++yt)}vt=e}return[new Co(ft),vt]},_g=function(c,e,i){return c.s==-1?Math.max(_g(c.l,e,i+1),_g(c.r,e,i+1)):e[c.s]=i},zC=function(c){for(var e=c.length;e&&!c[--e];);for(var i=new rp(++e),s=0,a=c[0],h=1,f=function(et){i[s++]=et},k=1;k<=e;++k)if(c[k]==a&&k!=e)++h;else{if(!a&&h>2){for(;h>138;h-=138)f(32754);h>2&&(f(h>10?h-11<<5|28690:h-3<<5|12305),h=0)}else if(h>3){for(f(a),--h;h>6;h-=6)f(8304);h>2&&(f(h-3<<5|8208),h=0)}for(;h--;)f(a);h=1,a=c[k]}return[i.subarray(0,s),e]},uw=function(c,e){for(var i=0,s=0;s<e.length;++s)i+=c[s]*e[s];return i},jx=function(c,e,i){var s=i.length,a=lw(e+2);c[a]=255&s,c[a+1]=s>>>8,c[a+2]=255^c[a],c[a+3]=255^c[a+1];for(var h=0;h<s;++h)c[a+h+4]=i[h];return 8*(a+4+s)},VC=function(c,e,i,s,a,h,f,k,et,tt,rt){h_(e,rt++,i),++a[256];for(var lt=FE(a,15),pt=lt[0],ft=lt[1],vt=FE(h,15),yt=vt[0],Mt=vt[1],xt=zC(pt),Et=xt[0],At=xt[1],Rt=zC(yt),Bt=Rt[0],Qt=Rt[1],Wt=new rp(19),tn=0;tn<Et.length;++tn)Wt[31&Et[tn]]++;for(tn=0;tn<Bt.length;++tn)Wt[31&Bt[tn]]++;for(var pn=FE(Wt,7),yn=pn[0],En=pn[1],wn=19;wn>4&&!yn[Lx[wn-1]];--wn);var In,xn,Cn,Fn,Tn=tt+5<<3,Wn=uw(a,c0)+uw(h,u0)+f,or=uw(a,pt)+uw(h,yt)+f+14+3*wn+uw(Wt,yn)+(2*Wt[16]+3*Wt[17]+7*Wt[18]);if(Tn<=Wn&&Tn<=or)return jx(e,rt,c.subarray(et,et+tt));if(h_(e,rt,1+(or<Wn)),rt+=2,or<Wn){In=Dm(pt,ft,0),xn=pt,Cn=Dm(yt,Mt,0),Fn=yt;var fr=Dm(yn,En,0);for(h_(e,rt,At-257),h_(e,rt+5,Qt-1),h_(e,rt+10,wn-4),rt+=14,tn=0;tn<wn;++tn)h_(e,rt+3*tn,yn[Lx[tn]]);rt+=3*wn;for(var rr=[Et,Bt],Ir=0;Ir<2;++Ir){var kr=rr[Ir];for(tn=0;tn<kr.length;++tn){var Br=31&kr[tn];h_(e,rt,fr[Br]),rt+=yn[Br],Br>15&&(h_(e,rt,kr[tn]>>>5&127),rt+=kr[tn]>>>12)}}}else In=cu,xn=c0,Cn=mu,Fn=u0;for(tn=0;tn<k;++tn)if(s[tn]>255){Br=s[tn]>>>18&31,cw(e,rt,In[Br+257]),rt+=xn[Br+257],Br>7&&(h_(e,rt,s[tn]>>>23&31),rt+=l0[Br]);var Ur=31&s[tn];cw(e,rt,Cn[Ur]),rt+=Fn[Ur],Ur>3&&(cw(e,rt,s[tn]>>>5&8191),rt+=ny[Ur])}else cw(e,rt,In[s[tn]]),rt+=xn[s[tn]];return cw(e,rt,In[256]),rt+xn[256]},tI=new Ip([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),h0=new Co(0),nI=function(c,e,i,s,a,h){var f=c.length,k=new Co(s+f+5*(1+Math.ceil(f/7e3))+a),et=k.subarray(s,k.length-a),tt=0;if(!e||f<8)for(var rt=0;rt<=f;rt+=65535){var lt=rt+65535;lt<f?tt=jx(et,tt,c.subarray(rt,lt)):(et[rt]=h,tt=jx(et,tt,c.subarray(rt,f)))}else{for(var pt=tI[e-1],ft=pt>>>13,vt=8191&pt,yt=(1<<i)-1,Mt=new rp(32768),xt=new rp(yt+1),Et=Math.ceil(i/3),At=2*Et,Rt=function(Jo){return(c[Jo]^c[Jo+1]<<Et^c[Jo+2]<<At)&yt},Bt=new Ip(25e3),Qt=new rp(288),Wt=new rp(32),tn=0,pn=0,yn=(rt=0,0),En=0,wn=0;rt<f;++rt){var In=Rt(rt),xn=32767&rt,Cn=xt[In];if(Mt[xn]=Cn,xt[In]=xn,En<=rt){var Fn=f-rt;if((tn>7e3||yn>24576)&&Fn>423){tt=VC(c,et,0,Bt,Qt,Wt,pn,yn,wn,rt-wn,tt),yn=tn=pn=0,wn=rt;for(var Tn=0;Tn<286;++Tn)Qt[Tn]=0;for(Tn=0;Tn<30;++Tn)Wt[Tn]=0}var Wn=2,or=0,fr=vt,rr=xn-Cn&32767;if(Fn>2&&In==Rt(rt-rr))for(var Ir=Math.min(ft,Fn)-1,kr=Math.min(32767,rt),Br=Math.min(258,Fn);rr<=kr&&--fr&&xn!=Cn;){if(c[rt+Wn]==c[rt+Wn-rr]){for(var Ur=0;Ur<Br&&c[rt+Ur]==c[rt+Ur-rr];++Ur);if(Ur>Wn){if(Wn=Ur,or=rr,Ur>Ir)break;var hs=Math.min(rr,Ur-2),_r=0;for(Tn=0;Tn<hs;++Tn){var Ys=rt-rr+Tn+32768&32767,po=Ys-Mt[Ys]+32768&32767;po>_r&&(_r=po,Cn=Ys)}}}rr+=(xn=Cn)-(Cn=Mt[xn])+32768&32767}if(or){Bt[yn++]=268435456|Nx[Wn]<<18|jC[or];var Xs=31&Nx[Wn],ko=31&jC[or];pn+=l0[Xs]+ny[ko],++Qt[257+Xs],++Wt[ko],En=rt+Wn,++tn}else Bt[yn++]=c[rt],++Qt[c[rt]]}}tt=VC(c,et,h,Bt,Qt,Wt,pn,yn,wn,rt-wn,tt),!h&&7&tt&&(tt=jx(et,tt+1,h0))}return jp(k,0,s+lw(tt)+a)},rI=function(){for(var c=new Ip(256),e=0;e<256;++e){for(var i=e,s=9;--s;)i=(1&i&&3988292384)^i>>>1;c[e]=i}return c}(),hw=function(){var c=-1;return{p:function(e){for(var i=c,s=0;s<e.length;++s)i=rI[255&i^e[s]]^i>>>8;c=i},d:function(){return~c}}},QC=function(){var c=1,e=0;return{p:function(i){for(var s=c,a=e,h=i.length,f=0;f!=h;){for(var k=Math.min(f+2655,h);f<k;++f)a+=s+=i[f];s=(65535&s)+15*(s>>16),a=(65535&a)+15*(a>>16)}c=s,e=a},d:function(){return(255&(c%=65521))<<24|c>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},Zy=function(c,e,i,s,a){return nI(c,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(c.length)))):12+e.mem,i,s,!a)},zx=function(c,e){var i={};for(var s in c)i[s]=c[s];for(var s in e)i[s]=e[s];return i},iI=function(c,e,i){for(var s=c(),a=c.toString(),h=a.slice(a.indexOf("[")+1,a.lastIndexOf("]")).replace(/ /g,"").split(","),f=0;f<s.length;++f){var k=s[f],et=h[f];if(typeof k=="function"){e+=";"+et+"=";var tt=k.toString();if(k.prototype)if(tt.indexOf("[native code]")!=-1){var rt=tt.indexOf(" ",8)+1;e+=tt.slice(rt,tt.indexOf("(",rt))}else for(var lt in e+=tt,k.prototype)e+=";"+et+".prototype."+lt+"="+k.prototype[lt].toString();else e+=tt}else i[et]=k}return[e,i]},UE=[],sI=function(c,e,i,s){var a;if(!UE[i]){for(var h="",f={},k=c.length-1,et=0;et<k;++et)h=(a=iI(c[et],h,f))[0],f=a[1];UE[i]=iI(c[k],h,f)}var tt=zx({},UE[i][1]);return function(rt,lt,pt,ft,vt){var yt=$T(LC[lt]||(LC[lt]=aw(rt)));return yt.onerror=function(Mt){return vt(Mt.error,null)},yt.onmessage=function(Mt){return vt(null,Mt.data)},yt.postMessage(pt,ft),yt}(UE[i][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",i,tt,function(rt){var lt=[];for(var pt in rt)(rt[pt]instanceof Co||rt[pt]instanceof rp||rt[pt]instanceof Ip)&&lt.push((rt[pt]=new rt[pt].constructor(rt[pt])).buffer);return lt}(tt),s)},dw=function(){return[Co,rp,Ip,l0,ny,Lx,FC,ZT,eI,Ux,Fx,Dm,LE,Zm,NE,lw,jp,Jy,an,ry,GC]},pw=function(){return[Co,rp,Ip,l0,ny,Lx,Nx,jC,cu,c0,mu,u0,Fx,tI,h0,Dm,h_,cw,FE,_g,zC,uw,jx,VC,lw,jp,nI,Zy,Dt,ry]},oI=function(){return[it,mt,_e,hw,rI]},aI=function(){return[ot,ct]},lI=function(){return[gt,_e,QC]},cI=function(){return[St]},ry=function(c){return postMessage(c,[c.buffer])},GC=function(c){return c&&c.size&&new Co(c.size)},fw=function(c,e,i,s,a,h){var f=sI(i,s,a,function(k,et){f.terminate(),h(k,et)});return f.postMessage([c,e],e.consume?[c.buffer]:[]),function(){f.terminate()}},ev=function(c){return c.ondata=function(e,i){return postMessage([e,i],[e.buffer])},function(e){return c.push(e.data[0],e.data[1])}},ut=function(c,e,i,s,a){var h,f=sI(c,s,a,function(k,et){k?(f.terminate(),e.ondata.call(e,k)):(et[1]&&f.terminate(),e.ondata.call(e,k,et[0],et[1]))});f.postMessage(i),e.push=function(k,et){if(h)throw"stream finished";if(!e.ondata)throw"no stream handler";f.postMessage([k,h=et],[k.buffer])},e.terminate=function(){f.terminate()}},o=function(c,e){return c[e]|c[e+1]<<8},_=function(c,e){return(c[e]|c[e+1]<<8|c[e+2]<<16|c[e+3]<<24)>>>0},$=function(c,e){return _(c,e)+4294967296*_(c,e+4)},_e=function(c,e,i){for(;i;++e)c[e]=i,i>>>=8},it=function(c,e){var i=e.filename;if(c[0]=31,c[1]=139,c[2]=8,c[8]=e.level<2?4:e.level==9?2:0,c[9]=3,e.mtime!=0&&_e(c,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),i){c[3]=8;for(var s=0;s<=i.length;++s)c[s+10]=i.charCodeAt(s)}},ot=function(c){if(c[0]!=31||c[1]!=139||c[2]!=8)throw"invalid gzip data";var e=c[3],i=10;4&e&&(i+=c[10]|2+(c[11]<<8));for(var s=(e>>3&1)+(e>>4&1);s>0;s-=!c[i++]);return i+(2&e)},ct=function(c){var e=c.length;return(c[e-4]|c[e-3]<<8|c[e-2]<<16|c[e-1]<<24)>>>0},mt=function(c){return 10+(c.filename&&c.filename.length+1||0)},gt=function(c,e){var i=e.level,s=i==0?0:i<6?1:i==9?3:2;c[0]=120,c[1]=s<<6|(s?32-2*s:1)},St=function(c){if((15&c[0])!=8||c[0]>>>4>7||(c[0]<<8|c[1])%31)throw"invalid zlib data";if(32&c[1])throw"invalid zlib data: preset dictionaries not supported"};function Tt(c,e){return e||typeof c!="function"||(e=c,c={}),this.ondata=e,c}var Ct=function(){function c(e,i){i||typeof e!="function"||(i=e,e={}),this.ondata=i,this.o=e||{}}return c.prototype.p=function(e,i){this.ondata(Zy(e,this.o,0,0,!i),i)},c.prototype.push=function(e,i){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=i,this.p(e,i||!1)},c}(),Pt=function(){return function(c,e){ut([pw,function(){return[ev,Ct]}],this,Tt.call(this,c,e),function(i){var s=new Ct(i.data);onmessage=ev(s)},6)}}();function Ot(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return fw(c,e,[pw],function(s){return ry(Dt(s.data[0],s.data[1]))},0,i)}function Dt(c,e){return Zy(c,e||{},0,0)}var Yt=function(){function c(e){this.s={},this.p=new Co(0),this.ondata=e}return c.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var i=this.p.length,s=new Co(i+e.length);s.set(this.p),s.set(e,i),this.p=s},c.prototype.c=function(e){this.d=this.s.i=e||!1;var i=this.s.b,s=Jy(this.p,this.o,this.s);this.ondata(jp(s,i,this.s.b),this.d),this.o=jp(s,this.s.b-32768),this.s.b=this.o.length,this.p=jp(this.p,this.s.p/8|0),this.s.p&=7},c.prototype.push=function(e,i){this.e(e),this.c(i)},c}(),Xt=function(){return function(c){this.ondata=c,ut([dw,function(){return[ev,Yt]}],this,0,function(){var e=new Yt;onmessage=ev(e)},7)}}();function Jt(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return fw(c,e,[dw],function(s){return ry(an(s.data[0],GC(s.data[1])))},1,i)}function an(c,e){return Jy(c,e)}var fn=function(){function c(e,i){this.c=hw(),this.l=0,this.v=1,Ct.call(this,e,i)}return c.prototype.push=function(e,i){Ct.prototype.push.call(this,e,i)},c.prototype.p=function(e,i){this.c.p(e),this.l+=e.length;var s=Zy(e,this.o,this.v&&mt(this.o),i&&8,!i);this.v&&(it(s,this.o),this.v=0),i&&(_e(s,s.length-8,this.c.d()),_e(s,s.length-4,this.l)),this.ondata(s,i)},c}(),gn=function(){return function(c,e){ut([pw,oI,function(){return[ev,Ct,fn]}],this,Tt.call(this,c,e),function(i){var s=new fn(i.data);onmessage=ev(s)},8)}}();function _n(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return fw(c,e,[pw,oI,function(){return[On]}],function(s){return ry(On(s.data[0],s.data[1]))},2,i)}function On(c,e){e||(e={});var i=hw(),s=c.length;i.p(c);var a=Zy(c,e,mt(e),8),h=a.length;return it(a,e),_e(a,h-8,i.d()),_e(a,h-4,s),a}var Ln=function(){function c(e){this.v=1,Yt.call(this,e)}return c.prototype.push=function(e,i){if(Yt.prototype.e.call(this,e),this.v){var s=this.p.length>3?ot(this.p):4;if(s>=this.p.length&&!i)return;this.p=this.p.subarray(s),this.v=0}if(i){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Yt.prototype.c.call(this,i)},c}(),$n=function(){return function(c){this.ondata=c,ut([dw,aI,function(){return[ev,Yt,Ln]}],this,0,function(){var e=new Ln;onmessage=ev(e)},9)}}();function Jn(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return fw(c,e,[dw,aI,function(){return[Un]}],function(s){return ry(Un(s.data[0]))},3,i)}function Un(c,e){return Jy(c.subarray(ot(c),-8),e||new Co(ct(c)))}var Er=function(){function c(e,i){this.c=QC(),this.v=1,Ct.call(this,e,i)}return c.prototype.push=function(e,i){Ct.prototype.push.call(this,e,i)},c.prototype.p=function(e,i){this.c.p(e);var s=Zy(e,this.o,this.v&&2,i&&4,!i);this.v&&(gt(s,this.o),this.v=0),i&&_e(s,s.length-4,this.c.d()),this.ondata(s,i)},c}(),Or=function(){return function(c,e){ut([pw,lI,function(){return[ev,Ct,Er]}],this,Tt.call(this,c,e),function(i){var s=new Er(i.data);onmessage=ev(s)},10)}}();function xr(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return fw(c,e,[pw,lI,function(){return[Gr]}],function(s){return ry(Gr(s.data[0],s.data[1]))},4,i)}function Gr(c,e){e||(e={});var i=QC();i.p(c);var s=Zy(c,e,2,4);return gt(s,e),_e(s,s.length-4,i.d()),s}var Hr=function(){function c(e){this.v=1,Yt.call(this,e)}return c.prototype.push=function(e,i){if(Yt.prototype.e.call(this,e),this.v){if(this.p.length<2&&!i)return;this.p=this.p.subarray(2),this.v=0}if(i){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Yt.prototype.c.call(this,i)},c}(),pr=function(){return function(c){this.ondata=c,ut([dw,cI,function(){return[ev,Yt,Hr]}],this,0,function(){var e=new Hr;onmessage=ev(e)},11)}}();function vr(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return fw(c,e,[dw,cI,function(){return[jr]}],function(s){return ry(jr(s.data[0],GC(s.data[1])))},5,i)}function jr(c,e){return Jy((St(c),c.subarray(2,-4)),e)}var Sr=function(){function c(e){this.G=Ln,this.I=Yt,this.Z=Hr,this.ondata=e}return c.prototype.push=function(e,i){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,i);else{if(this.p&&this.p.length){var s=new Co(this.p.length+e.length);s.set(this.p),s.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var a=this,h=function(){a.ondata.apply(a,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(h):(15&this.p[0])!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(h):new this.Z(h),this.s.push(this.p,i),this.p=null}}},c}(),Qr=function(){function c(e){this.G=$n,this.I=Xt,this.Z=pr,this.ondata=e}return c.prototype.push=function(e,i){Sr.prototype.push.call(this,e,i)},c}();function As(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return c[0]==31&&c[1]==139&&c[2]==8?Jn(c,e,i):(15&c[0])!=8||c[0]>>4>7||(c[0]<<8|c[1])%31?Jt(c,e,i):vr(c,e,i)}function go(c,e){return c[0]==31&&c[1]==139&&c[2]==8?Un(c,e):(15&c[0])!=8||c[0]>>4>7||(c[0]<<8|c[1])%31?an(c,e):jr(c,e)}var bs=function(c,e,i,s){for(var a in c){var h=c[a],f=e+a;h instanceof Co?i[f]=[h,s]:Array.isArray(h)?i[f]=[h[0],zx(s,h[1])]:bs(h,f+"/",i,s)}},lo=typeof TextEncoder<"u"&&new TextEncoder,Pn=typeof TextDecoder<"u"&&new TextDecoder,Sn=0;try{Pn.decode(h0,{stream:!0}),Sn=1}catch{}var ir=function(c){for(var e="",i=0;;){var s=c[i++],a=(s>127)+(s>223)+(s>239);if(i+a>c.length)return[e,jp(c,i-1)];a?a==3?(s=((15&s)<<18|(63&c[i++])<<12|(63&c[i++])<<6|63&c[i++])-65536,e+=String.fromCharCode(55296|s>>10,56320|1023&s)):e+=1&a?String.fromCharCode((31&s)<<6|63&c[i++]):String.fromCharCode((15&s)<<12|(63&c[i++])<<6|63&c[i++]):e+=String.fromCharCode(s)}},Xn=function(){function c(e){this.ondata=e,Sn?this.t=new TextDecoder:this.p=h0}return c.prototype.push=function(e,i){if(!this.ondata)throw"no callback";if(i=!!i,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),i),i){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var s=new Co(this.p.length+e.length);s.set(this.p),s.set(e,this.p.length);var a=ir(s),h=a[0],f=a[1];if(i){if(f.length)throw"invalid utf-8 data";this.p=null}else this.p=f;this.ondata(h,i)}},c}(),Dn=function(){function c(e){this.ondata=e}return c.prototype.push=function(e,i){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(Hn(e),this.d=i||!1)},c}();function Hn(c,e){if(e){for(var i=new Co(c.length),s=0;s<c.length;++s)i[s]=c.charCodeAt(s);return i}if(lo)return lo.encode(c);var a=c.length,h=new Co(c.length+(c.length>>1)),f=0,k=function(rt){h[f++]=rt};for(s=0;s<a;++s){if(f+5>h.length){var et=new Co(f+8+(a-s<<1));et.set(h),h=et}var tt=c.charCodeAt(s);tt<128||e?k(tt):tt<2048?(k(192|tt>>6),k(128|63&tt)):tt>55295&&tt<57344?(k(240|(tt=65536+(1047552&tt)|1023&c.charCodeAt(++s))>>18),k(128|tt>>12&63),k(128|tt>>6&63),k(128|63&tt)):(k(224|tt>>12),k(128|tt>>6&63),k(128|63&tt))}return jp(h,0,f)}function mr(c,e){if(e){for(var i="",s=0;s<c.length;s+=16384)i+=String.fromCharCode.apply(null,c.subarray(s,s+16384));return i}if(Pn)return Pn.decode(c);var a=ir(c),h=a[0];if(a[1].length)throw"invalid utf-8 data";return h}var ln=function(c){return c==1?3:c<6?2:c==9?1:0},gr=function(c,e){return e+30+o(c,e+26)+o(c,e+28)},tr=function(c,e,i){var s=o(c,e+28),a=mr(c.subarray(e+46,e+46+s),!(2048&o(c,e+8))),h=e+46+s,f=_(c,e+20),k=i&&f==4294967295?br(c,h):[f,_(c,e+24),_(c,e+42)],et=k[0],tt=k[1],rt=k[2];return[o(c,e+10),et,tt,a,h+o(c,e+30)+o(c,e+32),rt]},br=function(c,e){for(;o(c,e)!=1;e+=4+o(c,e+2));return[$(c,e+12),$(c,e+4),$(c,e+20)]},Tr=function(c){var e=0;if(c)for(var i in c){var s=c[i].length;if(s>65535)throw"extra field too long";e+=s+4}return e},$r=function(c,e,i,s,a,h,f,k){var et=s.length,tt=i.extra,rt=k&&k.length,lt=Tr(tt);_e(c,e,f!=null?33639248:67324752),e+=4,f!=null&&(c[e++]=20,c[e++]=i.os),c[e]=20,e+=2,c[e++]=i.flag<<1|(h==null&&8),c[e++]=a&&8,c[e++]=255&i.compression,c[e++]=i.compression>>8;var pt=new Date(i.mtime==null?Date.now():i.mtime),ft=pt.getFullYear()-1980;if(ft<0||ft>119)throw"date not in range 1980-2099";if(_e(c,e,ft<<25|pt.getMonth()+1<<21|pt.getDate()<<16|pt.getHours()<<11|pt.getMinutes()<<5|pt.getSeconds()>>>1),e+=4,h!=null&&(_e(c,e,i.crc),_e(c,e+4,h),_e(c,e+8,i.size)),_e(c,e+12,et),_e(c,e+14,lt),e+=16,f!=null&&(_e(c,e,rt),_e(c,e+6,i.attrs),_e(c,e+10,f),e+=14),c.set(s,e),e+=et,lt)for(var vt in tt){var yt=tt[vt],Mt=yt.length;_e(c,e,+vt),_e(c,e+2,Mt),c.set(yt,e+4),e+=4+Mt}return rt&&(c.set(k,e),e+=rt),e},Es=function(c,e,i,s,a){_e(c,e,101010256),_e(c,e+8,i),_e(c,e+10,i),_e(c,e+12,s),_e(c,e+16,a)},Os=function(){function c(e){this.filename=e,this.c=hw(),this.size=0,this.compression=0}return c.prototype.process=function(e,i){this.ondata(null,e,i)},c.prototype.push=function(e,i){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,i&&(this.crc=this.c.d()),this.process(e,i||!1)},c}(),ro=function(){function c(e,i){var s=this;i||(i={}),Os.call(this,e),this.d=new Ct(i,function(a,h){s.ondata(null,a,h)}),this.compression=8,this.flag=ln(i.level)}return c.prototype.process=function(e,i){try{this.d.push(e,i)}catch(s){this.ondata(s,null,i)}},c.prototype.push=function(e,i){Os.prototype.push.call(this,e,i)},c}(),Ps=function(){function c(e,i){var s=this;i||(i={}),Os.call(this,e),this.d=new Pt(i,function(a,h,f){s.ondata(a,h,f)}),this.compression=8,this.flag=ln(i.level),this.terminate=this.d.terminate}return c.prototype.process=function(e,i){this.d.push(e,i)},c.prototype.push=function(e,i){Os.prototype.push.call(this,e,i)},c}(),Ns=function(){function c(e){this.ondata=e,this.u=[],this.d=1}return c.prototype.add=function(e){var i=this;if(2&this.d)throw"stream finished";var s=Hn(e.filename),a=s.length,h=e.comment,f=h&&Hn(h),k=a!=e.filename.length||f&&h.length!=f.length,et=a+Tr(e.extra)+30;if(a>65535)throw"filename too long";var tt=new Co(et);$r(tt,0,e,s,k);var rt=[tt],lt=function(){for(var Mt=0,xt=rt;Mt<xt.length;Mt++){var Et=xt[Mt];i.ondata(null,Et,!1)}rt=[]},pt=this.d;this.d=0;var ft=this.u.length,vt=zx(e,{f:s,u:k,o:f,t:function(){e.terminate&&e.terminate()},r:function(){if(lt(),pt){var Mt=i.u[ft+1];Mt?Mt.r():i.d=1}pt=1}}),yt=0;e.ondata=function(Mt,xt,Et){if(Mt)i.ondata(Mt,xt,Et),i.terminate();else if(yt+=xt.length,rt.push(xt),Et){var At=new Co(16);_e(At,0,134695760),_e(At,4,e.crc),_e(At,8,yt),_e(At,12,e.size),rt.push(At),vt.c=yt,vt.b=et+yt+16,vt.crc=e.crc,vt.size=e.size,pt&&vt.r(),pt=1}else pt&&lt()},this.u.push(vt)},c.prototype.end=function(){var e=this;if(2&this.d)throw 1&this.d?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},c.prototype.e=function(){for(var e=0,i=0,s=0,a=0,h=this.u;a<h.length;a++)s+=46+(tt=h[a]).f.length+Tr(tt.extra)+(tt.o?tt.o.length:0);for(var f=new Co(s+22),k=0,et=this.u;k<et.length;k++){var tt=et[k];$r(f,e,tt,tt.f,tt.u,tt.c,i,tt.o),e+=46+tt.f.length+Tr(tt.extra)+(tt.o?tt.o.length:0),i+=tt.b}Es(f,e,this.u.length,s,i),this.ondata(null,f,!0),this.d=2},c.prototype.terminate=function(){for(var e=0,i=this.u;e<i.length;e++)i[e].t();this.d=2},c}();function Yo(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";var s={};bs(c,"",s,e);var a=Object.keys(s),h=a.length,f=0,k=0,et=h,tt=new Array(h),rt=[],lt=function(){for(var yt=0;yt<rt.length;++yt)rt[yt]()},pt=function(){var yt=new Co(k+22),Mt=f,xt=k-f;k=0;for(var Et=0;Et<et;++Et){var At=tt[Et];try{var Rt=At.c.length;$r(yt,k,At,At.f,At.u,Rt);var Bt=30+At.f.length+Tr(At.extra),Qt=k+Bt;yt.set(At.c,Qt),$r(yt,f,At,At.f,At.u,Rt,k,At.m),f+=16+Bt+(At.m?At.m.length:0),k=Qt+Rt}catch(Wt){return i(Wt,null)}}Es(yt,f,tt.length,xt,Mt),i(null,yt)};h||pt();for(var ft=function(yt){var Mt=a[yt],xt=s[Mt],Et=xt[0],At=xt[1],Rt=hw(),Bt=Et.length;Rt.p(Et);var Qt=Hn(Mt),Wt=Qt.length,tn=At.comment,pn=tn&&Hn(tn),yn=pn&&pn.length,En=Tr(At.extra),wn=At.level==0?0:8,In=function(xn,Cn){if(xn)lt(),i(xn,null);else{var Fn=Cn.length;tt[yt]=zx(At,{size:Bt,crc:Rt.d(),c:Cn,f:Qt,m:pn,u:Wt!=Mt.length||pn&&tn.length!=yn,compression:wn}),f+=30+Wt+En+Fn,k+=76+2*(Wt+En)+(yn||0)+Fn,--h||pt()}};if(Wt>65535&&In("filename too long",null),wn)if(Bt<16e4)try{In(null,Dt(Et,At))}catch(xn){In(xn,null)}else rt.push(Ot(Et,At,In));else In(null,Et)},vt=0;vt<et;++vt)ft(vt);return lt}function Rm(c,e){e||(e={});var i={},s=[];bs(c,"",i,e);var a=0,h=0;for(var f in i){var k=i[f],et=k[0],tt=k[1],rt=tt.level==0?0:8,lt=(Wt=Hn(f)).length,pt=tt.comment,ft=pt&&Hn(pt),vt=ft&&ft.length,yt=Tr(tt.extra);if(lt>65535)throw"filename too long";var Mt=rt?Dt(et,tt):et,xt=Mt.length,Et=hw();Et.p(et),s.push(zx(tt,{size:et.length,crc:Et.d(),c:Mt,f:Wt,m:ft,u:lt!=f.length||ft&&pt.length!=vt,o:a,compression:rt})),a+=30+lt+yt+xt,h+=76+2*(lt+yt)+(vt||0)+xt}for(var At=new Co(h+22),Rt=a,Bt=h-a,Qt=0;Qt<s.length;++Qt){var Wt=s[Qt];$r(At,Wt.o,Wt,Wt.f,Wt.u,Wt.c.length);var tn=30+Wt.f.length+Tr(Wt.extra);At.set(Wt.c,Wt.o+tn),$r(At,a,Wt,Wt.f,Wt.u,Wt.c.length,Wt.o,Wt.m),a+=16+tn+(Wt.m?Wt.m.length:0)}return Es(At,a,s.length,Bt,Rt),At}var Zs=function(){function c(){}return c.prototype.push=function(e,i){this.ondata(null,e,i)},c.compression=0,c}(),na=function(){function c(){var e=this;this.i=new Yt(function(i,s){e.ondata(null,i,s)})}return c.prototype.push=function(e,i){try{this.i.push(e,i)}catch(s){this.ondata(s,e,i)}},c.compression=8,c}(),ga=function(){function c(e,i){var s=this;i<32e4?this.i=new Yt(function(a,h){s.ondata(null,a,h)}):(this.i=new Xt(function(a,h,f){s.ondata(a,h,f)}),this.terminate=this.i.terminate)}return c.prototype.push=function(e,i){this.i.terminate&&(e=jp(e,0)),this.i.push(e,i)},c.compression=8,c}(),jE=function(){function c(e){this.onfile=e,this.k=[],this.o={0:Zs},this.p=h0}return c.prototype.push=function(e,i){var s=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var a=Math.min(this.c,e.length),h=e.subarray(0,a);if(this.c-=a,this.d?this.d.push(h,!this.c):this.k[0].push(h),(e=e.subarray(a)).length)return this.push(e,i)}else{var f=0,k=0,et=void 0,tt=void 0;this.p.length?e.length?((tt=new Co(this.p.length+e.length)).set(this.p),tt.set(e,this.p.length)):tt=this.p:tt=e;for(var rt=tt.length,lt=this.c,pt=lt&&this.d,ft=function(){var Mt,xt=_(tt,k);if(xt==67324752){f=1,et=k,vt.d=null,vt.c=0;var Et=o(tt,k+6),At=o(tt,k+8),Rt=2048&Et,Bt=8&Et,Qt=o(tt,k+26),Wt=o(tt,k+28);if(rt>k+30+Qt+Wt){var tn=[];vt.k.unshift(tn),f=2;var pn,yn=_(tt,k+18),En=_(tt,k+22),wn=mr(tt.subarray(k+30,k+=30+Qt),!Rt);yn==4294967295?(Mt=Bt?[-2]:br(tt,k),yn=Mt[0],En=Mt[1]):Bt&&(yn=-1),k+=Wt,vt.c=yn;var In={name:wn,compression:At,start:function(){if(!In.ondata)throw"no callback";if(yn){var xn=s.o[At];if(!xn)throw"unknown compression type "+At;(pn=yn<0?new xn(wn):new xn(wn,yn,En)).ondata=function(Wn,or,fr){In.ondata(Wn,or,fr)};for(var Cn=0,Fn=tn;Cn<Fn.length;Cn++){var Tn=Fn[Cn];pn.push(Tn,!1)}s.k[0]==tn&&s.c?s.d=pn:pn.push(h0,!0)}else In.ondata(null,h0,!0)},terminate:function(){pn&&pn.terminate&&pn.terminate()}};yn>=0&&(In.size=yn,In.originalSize=En),vt.onfile(In)}return"break"}if(lt){if(xt==134695760)return et=k+=12+(lt==-2&&8),f=3,vt.c=0,"break";if(xt==33639248)return et=k-=4,f=3,vt.c=0,"break"}},vt=this;k<rt-4&&ft()!=="break";++k);if(this.p=h0,lt<0){var yt=f?tt.subarray(0,et-12-(lt==-2&&8)-(_(tt,et-16)==134695760&&4)):tt.subarray(0,k);pt?pt.push(yt,!!f):this.k[+(f==2)].push(yt)}if(2&f)return this.push(tt.subarray(k),i);this.p=tt.subarray(k)}if(i){if(this.c)throw"invalid zip file";this.p=null}},c.prototype.register=function(e){this.o[e.compression]=e},c}();function ns(c,e){if(typeof e!="function")throw"no callback";for(var i=[],s=function(){for(var pt=0;pt<i.length;++pt)i[pt]()},a={},h=c.length-22;_(c,h)!=101010256;--h)if(!h||c.length-h>65558)return void e("invalid zip file",null);var f=o(c,h+8);f||e(null,{});var k=f,et=_(c,h+16),tt=et==4294967295;if(tt){if(h=_(c,h-12),_(c,h)!=101075792)return void e("invalid zip file",null);k=f=_(c,h+32),et=_(c,h+48)}for(var rt=function(pt){var ft=tr(c,et,tt),vt=ft[0],yt=ft[1],Mt=ft[2],xt=ft[3],Et=ft[4],At=ft[5],Rt=gr(c,At);et=Et;var Bt=function(Wt,tn){Wt?(s(),e(Wt,null)):(a[xt]=tn,--f||e(null,a))};if(vt)if(vt==8){var Qt=c.subarray(Rt,Rt+yt);if(yt<32e4)try{Bt(null,an(Qt,new Co(Mt)))}catch(Wt){Bt(Wt,null)}else i.push(Jt(Qt,{size:Mt},Bt))}else Bt("unknown compression type "+vt,null);else Bt(null,jp(c,Rt,Rt+yt))},lt=0;lt<k;++lt)rt();return s}function uI(c){for(var e={},i=c.length-22;_(c,i)!=101010256;--i)if(!i||c.length-i>65558)throw"invalid zip file";var s=o(c,i+8);if(!s)return{};var a=_(c,i+16),h=a==4294967295;if(h){if(i=_(c,i-12),_(c,i)!=101075792)throw"invalid zip file";s=_(c,i+32),a=_(c,i+48)}for(var f=0;f<s;++f){var k=tr(c,a,h),et=k[0],tt=k[1],rt=k[2],lt=k[3],pt=k[4],ft=k[5],vt=gr(c,ft);if(a=pt,et){if(et!=8)throw"unknown compression type "+et;e[lt]=an(c.subarray(vt,vt+tt),new Co(rt))}else e[lt]=jp(c,vt,vt+tt)}return e}class hI extends d.yxD{constructor(e){super(e),this.type=d.cLu}parse(e){const h=Math.pow(2.7182818,2.2),f={l:0,c:0,lc:0};function k(mn,Nn,vn,Qn,Zn){for(;vn<mn;)Nn=Nn<<8|Ir(Qn,Zn),vn+=8;vn-=mn,f.l=Nn>>vn&(1<<mn)-1,f.c=Nn,f.lc=vn}const et=new Array(59);function tt(mn){return 63&mn}function rt(mn){return mn>>6}const lt={c:0,lc:0};function pt(mn,Nn,vn,Qn){mn=mn<<8|Ir(vn,Qn),Nn+=8,lt.c=mn,lt.lc=Nn}const ft={c:0,lc:0};function vt(mn,Nn,vn,Qn,Zn,Vn,lr,Vr,es){if(mn==Nn){Qn<8&&(pt(vn,Qn,Zn,Vn),vn=lt.c,Qn=lt.lc);let cs=vn>>(Qn-=8);if(cs=new Uint8Array([cs])[0],Vr.value+cs>es)return!1;const as=lr[Vr.value-1];for(;cs-- >0;)lr[Vr.value++]=as}else{if(!(Vr.value<es))return!1;lr[Vr.value++]=mn}ft.c=vn,ft.lc=Qn}function yt(mn){return 65535&mn}function Mt(mn){const Nn=yt(mn);return Nn>32767?Nn-65536:Nn}const xt={a:0,b:0};function Et(mn,Nn){const vn=Mt(mn),Qn=Mt(Nn),Zn=vn+(1&Qn)+(Qn>>1),Vn=Zn,lr=Zn-Qn;xt.a=Vn,xt.b=lr}function At(mn,Nn){const vn=yt(mn),Qn=yt(Nn),Zn=vn-(Qn>>1)&65535,Vn=Qn+Zn-32768&65535;xt.a=Vn,xt.b=Zn}function Rt(mn,Nn,vn,Qn,Zn,Vn,lr){const Vr=lr<16384,es=vn>Zn?Zn:vn;let cs,as,ds=1;for(;ds<=es;)ds<<=1;for(ds>>=1,cs=ds,ds>>=1;ds>=1;){as=0;const rs=as+Vn*(Zn-cs),ts=Vn*ds,xs=Vn*cs,qr=Qn*ds,Ss=Qn*cs;let Is,zs,$l,Il;for(;as<=rs;as+=xs){let Cs=as;const $s=as+Qn*(vn-cs);for(;Cs<=$s;Cs+=Ss){const Eo=Cs+qr,yp=Cs+ts,uv=yp+qr;Vr?(Et(mn[Cs+Nn],mn[yp+Nn]),Is=xt.a,$l=xt.b,Et(mn[Eo+Nn],mn[uv+Nn]),zs=xt.a,Il=xt.b,Et(Is,zs),mn[Cs+Nn]=xt.a,mn[Eo+Nn]=xt.b,Et($l,Il),mn[yp+Nn]=xt.a,mn[uv+Nn]=xt.b):(At(mn[Cs+Nn],mn[yp+Nn]),Is=xt.a,$l=xt.b,At(mn[Eo+Nn],mn[uv+Nn]),zs=xt.a,Il=xt.b,At(Is,zs),mn[Cs+Nn]=xt.a,mn[Eo+Nn]=xt.b,At($l,Il),mn[yp+Nn]=xt.a,mn[uv+Nn]=xt.b)}if(vn&ds){const Eo=Cs+ts;Vr?Et(mn[Cs+Nn],mn[Eo+Nn]):At(mn[Cs+Nn],mn[Eo+Nn]),Is=xt.a,mn[Eo+Nn]=xt.b,mn[Cs+Nn]=Is}}if(Zn&ds){let Cs=as;const $s=as+Qn*(vn-cs);for(;Cs<=$s;Cs+=Ss){const Eo=Cs+qr;Vr?Et(mn[Cs+Nn],mn[Eo+Nn]):At(mn[Cs+Nn],mn[Eo+Nn]),Is=xt.a,mn[Eo+Nn]=xt.b,mn[Cs+Nn]=Is}}cs=ds,ds>>=1}return as}function Bt(mn,Nn,vn,Qn,Zn,Vn){const lr=vn.value,Vr=rr(Nn,vn),es=rr(Nn,vn);vn.value+=4;const cs=rr(Nn,vn);if(vn.value+=4,Vr<0||Vr>=65537||es<0||es>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const as=new Array(65537),ds=new Array(16384);if(function(rs){for(let ts=0;ts<16384;ts++)rs[ts]={},rs[ts].len=0,rs[ts].lit=0,rs[ts].p=null}(ds),function(rs,ts,xs,qr,Ss,Is){const zs=ts;let $l=0,Il=0;for(;qr<=Ss;qr++){if(zs.value-ts.value>xs)return!1;k(6,$l,Il,rs,zs);const Cs=f.l;if($l=f.c,Il=f.lc,Is[qr]=Cs,Cs==63){if(zs.value-ts.value>xs)throw new Error("Something wrong with hufUnpackEncTable");k(8,$l,Il,rs,zs);let $s=f.l+6;if($l=f.c,Il=f.lc,qr+$s>Ss+1)throw new Error("Something wrong with hufUnpackEncTable");for(;$s--;)Is[qr++]=0;qr--}else if(Cs>=59){let $s=Cs-59+2;if(qr+$s>Ss+1)throw new Error("Something wrong with hufUnpackEncTable");for(;$s--;)Is[qr++]=0;qr--}}(function(Cs){for(let Eo=0;Eo<=58;++Eo)et[Eo]=0;for(let Eo=0;Eo<65537;++Eo)et[Cs[Eo]]+=1;let $s=0;for(let Eo=58;Eo>0;--Eo){const yp=$s+et[Eo]>>1;et[Eo]=$s,$s=yp}for(let Eo=0;Eo<65537;++Eo){const yp=Cs[Eo];yp>0&&(Cs[Eo]=yp|et[yp]++<<6)}})(Is)}(mn,vn,Qn-(vn.value-lr),Vr,es,as),cs>8*(Qn-(vn.value-lr)))throw new Error("Something wrong with hufUncompress");(function(rs,ts,xs,qr){for(;ts<=xs;ts++){const Ss=rt(rs[ts]),Is=tt(rs[ts]);if(Ss>>Is)throw new Error("Invalid table entry");if(Is>14){const zs=qr[Ss>>Is-14];if(zs.len)throw new Error("Invalid table entry");if(zs.lit++,zs.p){const $l=zs.p;zs.p=new Array(zs.lit);for(let Il=0;Il<zs.lit-1;++Il)zs.p[Il]=$l[Il]}else zs.p=new Array(1);zs.p[zs.lit-1]=ts}else if(Is){let zs=0;for(let $l=1<<14-Is;$l>0;$l--){const Il=qr[(Ss<<14-Is)+zs];if(Il.len||Il.p)throw new Error("Invalid table entry");Il.len=Is,Il.lit=ts,zs++}}}})(as,Vr,es,ds),function(rs,ts,xs,qr,Ss,Is,zs,$l,Il){let Cs=0,$s=0;const Eo=zs,yp=Math.trunc(qr.value+(Ss+7)/8);for(;qr.value<yp;)for(pt(Cs,$s,xs,qr),Cs=lt.c,$s=lt.lc;$s>=14;){const Pp=ts[Cs>>$s-14&16383];if(Pp.len)$s-=Pp.len,vt(Pp.lit,Is,Cs,$s,xs,qr,$l,Il,Eo),Cs=ft.c,$s=ft.lc;else{if(!Pp.p)throw new Error("hufDecode issues");let dA;for(dA=0;dA<Pp.lit;dA++){const g1=tt(rs[Pp.p[dA]]);for(;$s<g1&&qr.value<yp;)pt(Cs,$s,xs,qr),Cs=lt.c,$s=lt.lc;if($s>=g1&&rt(rs[Pp.p[dA]])==(Cs>>$s-g1&(1<<g1)-1)){$s-=g1,vt(Pp.p[dA],Is,Cs,$s,xs,qr,$l,Il,Eo),Cs=ft.c,$s=ft.lc;break}}if(dA==Pp.lit)throw new Error("hufDecode issues")}}const uv=8-Ss&7;for(Cs>>=uv,$s-=uv;$s>0;){const Pp=ts[Cs<<14-$s&16383];if(!Pp.len)throw new Error("hufDecode issues");$s-=Pp.len,vt(Pp.lit,Is,Cs,$s,xs,qr,$l,Il,Eo),Cs=ft.c,$s=ft.lc}}(as,ds,mn,vn,cs,es,Vn,Zn,{value:0})}function Qt(mn){for(let Nn=1;Nn<mn.length;Nn++){const vn=mn[Nn-1]+mn[Nn]-128;mn[Nn]=vn}}function Wt(mn,Nn){let vn=0,Qn=Math.floor((mn.length+1)/2),Zn=0;const Vn=mn.length-1;for(;!(Zn>Vn||(Nn[Zn++]=mn[vn++],Zn>Vn));)Nn[Zn++]=mn[Qn++]}function tn(mn){let Nn=mn.byteLength;const vn=new Array;let Qn=0;const Zn=new DataView(mn);for(;Nn>0;){const Vn=Zn.getInt8(Qn++);if(Vn<0){const lr=-Vn;Nn-=lr+1;for(let Vr=0;Vr<lr;Vr++)vn.push(Zn.getUint8(Qn++))}else{const lr=Vn;Nn-=2;const Vr=Zn.getUint8(Qn++);for(let es=0;es<lr+1;es++)vn.push(Vr)}}return vn}function pn(mn,Nn,vn){let Qn,Zn=1;for(;Zn<64;)Qn=Nn[mn.value],Qn==65280?Zn=64:Qn>>8==255?Zn+=255&Qn:(vn[Zn]=Qn,Zn++),mn.value++}function yn(mn){const Nn=.5*Math.cos(.7853975),vn=.5*Math.cos(3.14159/16),Qn=.5*Math.cos(3.14159/8),Zn=.5*Math.cos(3*3.14159/16),Vn=.5*Math.cos(.981746875),lr=.5*Math.cos(3*3.14159/8),Vr=.5*Math.cos(1.374445625),es=new Array(4),cs=new Array(4),as=new Array(4),ds=new Array(4);for(let rs=0;rs<8;++rs){const ts=8*rs;es[0]=Qn*mn[ts+2],es[1]=lr*mn[ts+2],es[2]=Qn*mn[ts+6],es[3]=lr*mn[ts+6],cs[0]=vn*mn[ts+1]+Zn*mn[ts+3]+Vn*mn[ts+5]+Vr*mn[ts+7],cs[1]=Zn*mn[ts+1]-Vr*mn[ts+3]-vn*mn[ts+5]-Vn*mn[ts+7],cs[2]=Vn*mn[ts+1]-vn*mn[ts+3]+Vr*mn[ts+5]+Zn*mn[ts+7],cs[3]=Vr*mn[ts+1]-Vn*mn[ts+3]+Zn*mn[ts+5]-vn*mn[ts+7],as[0]=Nn*(mn[ts+0]+mn[ts+4]),as[3]=Nn*(mn[ts+0]-mn[ts+4]),as[1]=es[0]+es[3],as[2]=es[1]-es[2],ds[0]=as[0]+as[1],ds[1]=as[3]+as[2],ds[2]=as[3]-as[2],ds[3]=as[0]-as[1],mn[ts+0]=ds[0]+cs[0],mn[ts+1]=ds[1]+cs[1],mn[ts+2]=ds[2]+cs[2],mn[ts+3]=ds[3]+cs[3],mn[ts+4]=ds[3]-cs[3],mn[ts+5]=ds[2]-cs[2],mn[ts+6]=ds[1]-cs[1],mn[ts+7]=ds[0]-cs[0]}for(let rs=0;rs<8;++rs)es[0]=Qn*mn[16+rs],es[1]=lr*mn[16+rs],es[2]=Qn*mn[48+rs],es[3]=lr*mn[48+rs],cs[0]=vn*mn[8+rs]+Zn*mn[24+rs]+Vn*mn[40+rs]+Vr*mn[56+rs],cs[1]=Zn*mn[8+rs]-Vr*mn[24+rs]-vn*mn[40+rs]-Vn*mn[56+rs],cs[2]=Vn*mn[8+rs]-vn*mn[24+rs]+Vr*mn[40+rs]+Zn*mn[56+rs],cs[3]=Vr*mn[8+rs]-Vn*mn[24+rs]+Zn*mn[40+rs]-vn*mn[56+rs],as[0]=Nn*(mn[rs]+mn[32+rs]),as[3]=Nn*(mn[rs]-mn[32+rs]),as[1]=es[0]+es[3],as[2]=es[1]-es[2],ds[0]=as[0]+as[1],ds[1]=as[3]+as[2],ds[2]=as[3]-as[2],ds[3]=as[0]-as[1],mn[0+rs]=ds[0]+cs[0],mn[8+rs]=ds[1]+cs[1],mn[16+rs]=ds[2]+cs[2],mn[24+rs]=ds[3]+cs[3],mn[32+rs]=ds[3]-cs[3],mn[40+rs]=ds[2]-cs[2],mn[48+rs]=ds[1]-cs[1],mn[56+rs]=ds[0]-cs[0]}function En(mn){for(let Nn=0;Nn<64;++Nn){const vn=mn[0][Nn],Qn=mn[1][Nn],Zn=mn[2][Nn];mn[0][Nn]=vn+1.5747*Zn,mn[1][Nn]=vn-.1873*Qn-.4682*Zn,mn[2][Nn]=vn+1.8556*Qn}}function wn(mn,Nn,vn){for(let Zn=0;Zn<64;++Zn)Nn[vn+Zn]=d.A5E.toHalfFloat((Qn=mn[Zn])<=1?Math.sign(Qn)*Math.pow(Math.abs(Qn),2.2):Math.sign(Qn)*Math.pow(h,Math.abs(Qn)-1));var Qn}function In(mn){return new DataView(mn.array.buffer,mn.offset.value,mn.size)}function xn(mn){const Nn=mn.viewer.buffer.slice(mn.offset.value,mn.offset.value+mn.size),vn=new Uint8Array(tn(Nn)),Qn=new Uint8Array(vn.length);return Qt(vn),Wt(vn,Qn),new DataView(Qn.buffer)}function Cn(mn){const Nn=mn.array.slice(mn.offset.value,mn.offset.value+mn.size);g===void 0&&console.error("THREE.EXRLoader: External library fflate.min.js required.");const vn=jr(Nn),Qn=new Uint8Array(vn.length);return Qt(vn),Wt(vn,Qn),new DataView(Qn.buffer)}function Fn(mn){const Nn=mn.viewer,vn={value:mn.offset.value},Qn=new Uint16Array(mn.width*mn.scanlineBlockSize*(mn.channels*mn.type)),Zn=new Uint8Array(8192);let Vn=0;const lr=new Array(mn.channels);for(let xs=0;xs<mn.channels;xs++)lr[xs]={},lr[xs].start=Vn,lr[xs].end=lr[xs].start,lr[xs].nx=mn.width,lr[xs].ny=mn.lines,lr[xs].size=mn.type,Vn+=lr[xs].nx*lr[xs].ny*lr[xs].size;const Vr=Ys(Nn,vn),es=Ys(Nn,vn);if(es>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(Vr<=es)for(let xs=0;xs<es-Vr+1;xs++)Zn[xs+Vr]=kr(Nn,vn);const cs=new Uint16Array(65536),as=function(xs,qr){let Ss=0;for(let zs=0;zs<65536;++zs)(zs==0||xs[zs>>3]&1<<(7&zs))&&(qr[Ss++]=zs);const Is=Ss-1;for(;Ss<65536;)qr[Ss++]=0;return Is}(Zn,cs),ds=rr(Nn,vn);Bt(mn.array,Nn,vn,ds,Qn,Vn);for(let xs=0;xs<mn.channels;++xs){const qr=lr[xs];for(let Ss=0;Ss<lr[xs].size;++Ss)Rt(Qn,qr.start+Ss,qr.nx,qr.size,qr.ny,qr.nx*qr.size,as)}(function(xs,qr,Ss){for(let Is=0;Is<Ss;++Is)qr[Is]=xs[qr[Is]]})(cs,Qn,Vn);let rs=0;const ts=new Uint8Array(Qn.buffer.byteLength);for(let xs=0;xs<mn.lines;xs++)for(let qr=0;qr<mn.channels;qr++){const Ss=lr[qr],Is=Ss.nx*Ss.size,zs=new Uint8Array(Qn.buffer,2*Ss.end,2*Is);ts.set(zs,rs),rs+=2*Is,Ss.end+=Is}return new DataView(ts.buffer)}function Tn(mn){const Nn=mn.array.slice(mn.offset.value,mn.offset.value+mn.size);g===void 0&&console.error("THREE.EXRLoader: External library fflate.min.js required.");const vn=jr(Nn),Qn=mn.lines*mn.channels*mn.width,Zn=mn.type==1?new Uint16Array(Qn):new Uint32Array(Qn);let Vn=0,lr=0;const Vr=new Array(4);for(let es=0;es<mn.lines;es++)for(let cs=0;cs<mn.channels;cs++){let as=0;switch(mn.type){case 1:Vr[0]=Vn,Vr[1]=Vr[0]+mn.width,Vn=Vr[1]+mn.width;for(let ds=0;ds<mn.width;++ds)as+=vn[Vr[0]++]<<8|vn[Vr[1]++],Zn[lr]=as,lr++;break;case 2:Vr[0]=Vn,Vr[1]=Vr[0]+mn.width,Vr[2]=Vr[1]+mn.width,Vn=Vr[2]+mn.width;for(let ds=0;ds<mn.width;++ds)as+=vn[Vr[0]++]<<24|vn[Vr[1]++]<<16|vn[Vr[2]++]<<8,Zn[lr]=as,lr++}}return new DataView(Zn.buffer)}function Wn(mn){const Nn=mn.viewer,vn={value:mn.offset.value},Qn=new Uint8Array(mn.width*mn.lines*(mn.channels*mn.type*2)),Zn={version:Br(Nn,vn),unknownUncompressedSize:Br(Nn,vn),unknownCompressedSize:Br(Nn,vn),acCompressedSize:Br(Nn,vn),dcCompressedSize:Br(Nn,vn),rleCompressedSize:Br(Nn,vn),rleUncompressedSize:Br(Nn,vn),rleRawSize:Br(Nn,vn),totalAcUncompressedCount:Br(Nn,vn),totalDcUncompressedCount:Br(Nn,vn),acCompression:Br(Nn,vn)};if(Zn.version<2)throw new Error("EXRLoader.parse: "+Nr.compression+" version "+Zn.version+" is unsupported");const Vn=new Array;let lr=Ys(Nn,vn)-2;for(;lr>0;){const qr=or(Nn.buffer,vn),Ss=kr(Nn,vn),Is=Ss>>2&3,zs=new Int8Array([(Ss>>4)-1])[0],$l=kr(Nn,vn);Vn.push({name:qr,index:zs,type:$l,compression:Is}),lr-=qr.length+3}const Vr=Nr.channels,es=new Array(mn.channels);for(let qr=0;qr<mn.channels;++qr){const Ss=es[qr]={},Is=Vr[qr];Ss.name=Is.name,Ss.compression=0,Ss.decoded=!1,Ss.type=Is.pixelType,Ss.pLinear=Is.pLinear,Ss.width=mn.width,Ss.height=mn.lines}const cs={idx:new Array(3)};for(let qr=0;qr<mn.channels;++qr){const Ss=es[qr];for(let Is=0;Is<Vn.length;++Is){const zs=Vn[Is];Ss.name==zs.name&&(Ss.compression=zs.compression,zs.index>=0&&(cs.idx[zs.index]=qr),Ss.offset=qr)}}let as,ds,rs;if(Zn.acCompressedSize>0)switch(Zn.acCompression){case 0:as=new Uint16Array(Zn.totalAcUncompressedCount),Bt(mn.array,Nn,vn,Zn.acCompressedSize,as,Zn.totalAcUncompressedCount);break;case 1:const qr=jr(mn.array.slice(vn.value,vn.value+Zn.totalAcUncompressedCount));as=new Uint16Array(qr.buffer),vn.value+=Zn.totalAcUncompressedCount}if(Zn.dcCompressedSize>0){const qr={array:mn.array,offset:vn,size:Zn.dcCompressedSize};ds=new Uint16Array(Cn(qr).buffer),vn.value+=Zn.dcCompressedSize}Zn.rleRawSize>0&&(rs=tn(jr(mn.array.slice(vn.value,vn.value+Zn.rleCompressedSize)).buffer),vn.value+=Zn.rleCompressedSize);let ts=0;const xs=new Array(es.length);for(let qr=0;qr<xs.length;++qr)xs[qr]=new Array;for(let qr=0;qr<mn.lines;++qr)for(let Ss=0;Ss<es.length;++Ss)xs[Ss].push(ts),ts+=es[Ss].width*mn.type*2;(function(qr,Ss,Is,zs,$l,Il){let Cs=new DataView(Il.buffer);const $s=Is[qr.idx[0]].width,Eo=Is[qr.idx[0]].height,yp=Math.floor($s/8),uv=Math.ceil($s/8),Pp=Math.ceil(Eo/8),dA=$s-8*(uv-1),g1=Eo-8*(Pp-1),zF={value:0},_R=new Array(3),PM=new Array(3),DM=new Array(3),A0=new Array(3),rP=new Array(3);for(let du=0;du<3;++du)rP[du]=Ss[qr.idx[du]],_R[du]=du<1?0:_R[du-1]+uv*Pp,PM[du]=new Float32Array(64),DM[du]=new Uint16Array(64),A0[du]=new Uint16Array(64*uv);for(let du=0;du<Pp;++du){let MS=8;du==Pp-1&&(MS=g1);let TS=8;for(let Ol=0;Ol<uv;++Ol){Ol==uv-1&&(TS=dA);for(let nu=0;nu<3;++nu)DM[nu].fill(0),DM[nu][0]=$l[_R[nu]++],pn(zF,zs,DM[nu]),gs=DM[nu],(_s=PM[nu])[0]=_r(gs[0]),_s[1]=_r(gs[1]),_s[2]=_r(gs[5]),_s[3]=_r(gs[6]),_s[4]=_r(gs[14]),_s[5]=_r(gs[15]),_s[6]=_r(gs[27]),_s[7]=_r(gs[28]),_s[8]=_r(gs[2]),_s[9]=_r(gs[4]),_s[10]=_r(gs[7]),_s[11]=_r(gs[13]),_s[12]=_r(gs[16]),_s[13]=_r(gs[26]),_s[14]=_r(gs[29]),_s[15]=_r(gs[42]),_s[16]=_r(gs[3]),_s[17]=_r(gs[8]),_s[18]=_r(gs[12]),_s[19]=_r(gs[17]),_s[20]=_r(gs[25]),_s[21]=_r(gs[30]),_s[22]=_r(gs[41]),_s[23]=_r(gs[43]),_s[24]=_r(gs[9]),_s[25]=_r(gs[11]),_s[26]=_r(gs[18]),_s[27]=_r(gs[24]),_s[28]=_r(gs[31]),_s[29]=_r(gs[40]),_s[30]=_r(gs[44]),_s[31]=_r(gs[53]),_s[32]=_r(gs[10]),_s[33]=_r(gs[19]),_s[34]=_r(gs[23]),_s[35]=_r(gs[32]),_s[36]=_r(gs[39]),_s[37]=_r(gs[45]),_s[38]=_r(gs[52]),_s[39]=_r(gs[54]),_s[40]=_r(gs[20]),_s[41]=_r(gs[22]),_s[42]=_r(gs[33]),_s[43]=_r(gs[38]),_s[44]=_r(gs[46]),_s[45]=_r(gs[51]),_s[46]=_r(gs[55]),_s[47]=_r(gs[60]),_s[48]=_r(gs[21]),_s[49]=_r(gs[34]),_s[50]=_r(gs[37]),_s[51]=_r(gs[47]),_s[52]=_r(gs[50]),_s[53]=_r(gs[56]),_s[54]=_r(gs[59]),_s[55]=_r(gs[61]),_s[56]=_r(gs[35]),_s[57]=_r(gs[36]),_s[58]=_r(gs[48]),_s[59]=_r(gs[49]),_s[60]=_r(gs[57]),_s[61]=_r(gs[58]),_s[62]=_r(gs[62]),_s[63]=_r(gs[63]),yn(PM[nu]);En(PM);for(let nu=0;nu<3;++nu)wn(PM[nu],A0[nu],64*Ol)}let zv=0;for(let Ol=0;Ol<3;++Ol){const nu=Is[qr.idx[Ol]].type;for(let pA=8*du;pA<8*du+MS;++pA){zv=rP[Ol][pA];for(let RM=0;RM<yp;++RM){const by=64*RM+8*(7&pA);Cs.setUint16(zv+0*nu,A0[Ol][by+0],!0),Cs.setUint16(zv+2*nu,A0[Ol][by+1],!0),Cs.setUint16(zv+4*nu,A0[Ol][by+2],!0),Cs.setUint16(zv+6*nu,A0[Ol][by+3],!0),Cs.setUint16(zv+8*nu,A0[Ol][by+4],!0),Cs.setUint16(zv+10*nu,A0[Ol][by+5],!0),Cs.setUint16(zv+12*nu,A0[Ol][by+6],!0),Cs.setUint16(zv+14*nu,A0[Ol][by+7],!0),zv+=16*nu}}if(yp!=uv)for(let pA=8*du;pA<8*du+MS;++pA){const RM=rP[Ol][pA]+8*yp*2*nu,by=64*yp+8*(7&pA);for(let iP=0;iP<TS;++iP)Cs.setUint16(RM+2*iP*nu,A0[Ol][by+iP],!0)}}}var gs,_s;const YO=new Uint16Array($s);Cs=new DataView(Il.buffer);for(let du=0;du<3;++du){Is[qr.idx[du]].decoded=!0;const MS=Is[qr.idx[du]].type;if(Is[du].type==2)for(let TS=0;TS<Eo;++TS){const zv=rP[du][TS];for(let Ol=0;Ol<$s;++Ol)YO[Ol]=Cs.getUint16(zv+2*Ol*MS,!0);for(let Ol=0;Ol<$s;++Ol)Cs.setFloat32(zv+2*Ol*MS,_r(YO[Ol]),!0)}}})(cs,xs,es,as,ds,Qn);for(let qr=0;qr<es.length;++qr){const Ss=es[qr];if(!Ss.decoded){if(Ss.compression!==2)throw new Error("EXRLoader.parse: unsupported channel compression");{let Is=0,zs=0;for(let $l=0;$l<mn.lines;++$l){let Il=xs[qr][Is];for(let Cs=0;Cs<Ss.width;++Cs){for(let $s=0;$s<2*Ss.type;++$s)Qn[Il++]=rs[zs+$s*Ss.width*Ss.height];zs++}Is++}}}}return new DataView(Qn.buffer)}function or(mn,Nn){const vn=new Uint8Array(mn);let Qn=0;for(;vn[Nn.value+Qn]!=0;)Qn+=1;const Zn=new TextDecoder().decode(vn.slice(Nn.value,Nn.value+Qn));return Nn.value=Nn.value+Qn+1,Zn}function fr(mn,Nn){const vn=mn.getInt32(Nn.value,!0);return Nn.value=Nn.value+4,vn}function rr(mn,Nn){const vn=mn.getUint32(Nn.value,!0);return Nn.value=Nn.value+4,vn}function Ir(mn,Nn){const vn=mn[Nn.value];return Nn.value=Nn.value+1,vn}function kr(mn,Nn){const vn=mn.getUint8(Nn.value);return Nn.value=Nn.value+1,vn}const Br=function(mn,Nn){const vn=Number(mn.getBigInt64(Nn.value,!0));return Nn.value+=8,vn};function Ur(mn,Nn){const vn=mn.getFloat32(Nn.value,!0);return Nn.value+=4,vn}function hs(mn,Nn){return d.A5E.toHalfFloat(Ur(mn,Nn))}function _r(mn){const Nn=(31744&mn)>>10,vn=1023&mn;return(mn>>15?-1:1)*(Nn?Nn===31?vn?NaN:1/0:Math.pow(2,Nn-15)*(1+vn/1024):vn/1024*6103515625e-14)}function Ys(mn,Nn){const vn=mn.getUint16(Nn.value,!0);return Nn.value+=2,vn}function po(mn,Nn){return _r(Ys(mn,Nn))}function Xs(mn,Nn,vn,Qn,Zn){return Qn==="string"||Qn==="stringvector"||Qn==="iccProfile"?function(Vn,lr,Vr){const es=new TextDecoder().decode(new Uint8Array(Vn).slice(lr.value,lr.value+Vr));return lr.value=lr.value+Vr,es}(Nn,vn,Zn):Qn==="chlist"?function(Vn,lr,Vr,es){const cs=Vr.value,as=[];for(;Vr.value<cs+es-1;){const ds=or(lr,Vr),rs=fr(Vn,Vr),ts=kr(Vn,Vr);Vr.value+=3;const xs=fr(Vn,Vr),qr=fr(Vn,Vr);as.push({name:ds,pixelType:rs,pLinear:ts,xSampling:xs,ySampling:qr})}return Vr.value+=1,as}(mn,Nn,vn,Zn):Qn==="chromaticities"?function(Vn,lr){return{redX:Ur(Vn,lr),redY:Ur(Vn,lr),greenX:Ur(Vn,lr),greenY:Ur(Vn,lr),blueX:Ur(Vn,lr),blueY:Ur(Vn,lr),whiteX:Ur(Vn,lr),whiteY:Ur(Vn,lr)}}(mn,vn):Qn==="compression"?function(Vn,lr){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][kr(Vn,lr)]}(mn,vn):Qn==="box2i"?function(Vn,lr){return{xMin:rr(Vn,lr),yMin:rr(Vn,lr),xMax:rr(Vn,lr),yMax:rr(Vn,lr)}}(mn,vn):Qn==="lineOrder"?function(Vn,lr){return["INCREASING_Y"][kr(Vn,lr)]}(mn,vn):Qn==="float"?Ur(mn,vn):Qn==="v2f"?function(Vn,lr){return[Ur(Vn,lr),Ur(Vn,lr)]}(mn,vn):Qn==="v3f"?function(Vn,lr){return[Ur(Vn,lr),Ur(Vn,lr),Ur(Vn,lr)]}(mn,vn):Qn==="int"?fr(mn,vn):Qn==="rational"?function(Vn,lr){return[fr(Vn,lr),rr(Vn,lr)]}(mn,vn):Qn==="timecode"?function(Vn,lr){return[rr(Vn,lr),rr(Vn,lr)]}(mn,vn):Qn==="preview"?(vn.value+=Zn,"skipped"):void(vn.value+=Zn)}const ko=new DataView(e),Jo=new Uint8Array(e),cr={value:0},Nr=function(mn,Nn,vn){const Qn={};if(mn.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.");Qn.version=mn.getUint8(4);const Zn=mn.getUint8(5);Qn.spec={singleTile:!!(2&Zn),longName:!!(4&Zn),deepFormat:!!(8&Zn),multiPart:!!(16&Zn)},vn.value=8;let Vn=!0;for(;Vn;){const lr=or(Nn,vn);if(lr==0)Vn=!1;else{const Vr=or(Nn,vn),es=Xs(mn,Nn,vn,Vr,rr(mn,vn));es===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${Vr}'.`):Qn[lr]=es}}if(-5&Zn)throw console.error("EXRHeader:",Qn),new Error("THREE.EXRLoader: provided file is currently unsupported.");return Qn}(ko,e,cr),Fr=function(mn,Nn,vn,Qn,Zn){const Vn={size:0,viewer:Nn,array:vn,offset:Qn,width:mn.dataWindow.xMax-mn.dataWindow.xMin+1,height:mn.dataWindow.yMax-mn.dataWindow.yMin+1,channels:mn.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:mn.channels[0].pixelType,uncompress:null,getter:null,format:null,encoding:null};switch(mn.compression){case"NO_COMPRESSION":Vn.lines=1,Vn.uncompress=In;break;case"RLE_COMPRESSION":Vn.lines=1,Vn.uncompress=xn;break;case"ZIPS_COMPRESSION":Vn.lines=1,Vn.uncompress=Cn;break;case"ZIP_COMPRESSION":Vn.lines=16,Vn.uncompress=Cn;break;case"PIZ_COMPRESSION":Vn.lines=32,Vn.uncompress=Fn;break;case"PXR24_COMPRESSION":Vn.lines=16,Vn.uncompress=Tn;break;case"DWAA_COMPRESSION":Vn.lines=32,Vn.uncompress=Wn;break;case"DWAB_COMPRESSION":Vn.lines=256,Vn.uncompress=Wn;break;default:throw new Error("EXRLoader.parse: "+mn.compression+" is unsupported")}if(Vn.scanlineBlockSize=Vn.lines,Vn.type==1)switch(Zn){case d.VzW:Vn.getter=po,Vn.inputSize=2;break;case d.cLu:Vn.getter=Ys,Vn.inputSize=2}else{if(Vn.type!=2)throw new Error("EXRLoader.parse: unsupported pixelType "+Vn.type+" for "+mn.compression+".");switch(Zn){case d.VzW:Vn.getter=Ur,Vn.inputSize=4;break;case d.cLu:Vn.getter=hs,Vn.inputSize=4}}Vn.blockCount=(mn.dataWindow.yMax+1)/Vn.scanlineBlockSize;for(let Vr=0;Vr<Vn.blockCount;Vr++)Br(Nn,Qn);Vn.outputChannels=Vn.channels==3?4:Vn.channels;const lr=Vn.width*Vn.height*Vn.outputChannels;switch(Zn){case d.VzW:Vn.byteArray=new Float32Array(lr),Vn.channels<Vn.outputChannels&&Vn.byteArray.fill(1,0,lr);break;case d.cLu:Vn.byteArray=new Uint16Array(lr),Vn.channels<Vn.outputChannels&&Vn.byteArray.fill(15360,0,lr);break;default:console.error("THREE.EXRLoader: unsupported type: ",Zn)}return Vn.bytesPerLine=Vn.width*Vn.inputSize*Vn.channels,Vn.outputChannels==4?(Vn.format=d.wk1,Vn.encoding=d.rnI):(Vn.format=d.hEm,Vn.encoding=d.rnI),Vn}(Nr,ko,Jo,cr,this.type),Ks={value:0},Xo={R:0,G:1,B:2,A:3,Y:0};for(let mn=0;mn<Fr.height/Fr.scanlineBlockSize;mn++){const Nn=rr(ko,cr);Fr.size=rr(ko,cr),Fr.lines=Nn+Fr.scanlineBlockSize>Fr.height?Fr.height-Nn:Fr.scanlineBlockSize;const vn=Fr.size<Fr.lines*Fr.bytesPerLine?Fr.uncompress(Fr):In(Fr);cr.value+=Fr.size;for(let Qn=0;Qn<Fr.scanlineBlockSize;Qn++){const Zn=Qn+mn*Fr.scanlineBlockSize;if(Zn>=Fr.height)break;for(let Vn=0;Vn<Fr.channels;Vn++){const lr=Xo[Nr.channels[Vn].name];for(let Vr=0;Vr<Fr.width;Vr++){Ks.value=(Qn*(Fr.channels*Fr.width)+Vn*Fr.width+Vr)*Fr.inputSize;const es=(Fr.height-1-Zn)*(Fr.width*Fr.outputChannels)+Vr*Fr.outputChannels+lr;Fr.byteArray[es]=Fr.getter(vn,Ks)}}}}return{header:Nr,width:Fr.width,height:Fr.height,data:Fr.byteArray,format:Fr.format,encoding:Fr.encoding,type:this.type}}setDataType(e){return this.type=e,this}load(e,i,s,a){return super.load(e,function(h,f){h.encoding=f.encoding,h.minFilter=d.wem,h.magFilter=d.wem,h.generateMipmaps=!1,h.flipY=!1,i&&i(h,f)},s,a)}}class zp extends j{constructor(){super(...arguments),this.dependencies=[Kr]}async onAdded(e){this._importer||(this._importer=new zl(class extends hI{constructor(i){super(i),this.setDataType(P1(e.renderer.rendererObject))}},["exr"],!1)),uo.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&uo.Importers.splice(uo.Importers.indexOf(this._importer),1),this._importer=void 0}}function HC(c,e,i){const s=i.length-c-1;if(e>=i[s])return s-1;if(e<=i[c])return c;let a=c,h=s,f=Math.floor((a+h)/2);for(;e<i[f]||e>=i[f+1];)e<i[f]?h=f:a=f,f=Math.floor((a+h)/2);return f}function dI(c,e){let i=1;for(let a=2;a<=c;++a)i*=a;let s=1;for(let a=2;a<=e;++a)s*=a;for(let a=2;a<=c-e;++a)s*=a;return i/s}zp.PluginType="EXRLoadPlugin";class WC extends d.Hyl{constructor(e,i,s,a,h){super(),this.degree=e,this.knots=i,this.controlPoints=[],this.startKnot=a||0,this.endKnot=h||this.knots.length-1;for(let f=0;f<s.length;++f){const k=s[f];this.controlPoints[f]=new d.Ltg(k.x,k.y,k.z,k.w)}}getPoint(e,i=new d.Pa4){const s=i,a=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),h=function(f,k,et,tt){const rt=HC(f,tt,k),lt=function(ft,vt,yt,Mt){const xt=[],Et=[],At=[];xt[0]=1;for(let Rt=1;Rt<=yt;++Rt){Et[Rt]=vt-Mt[ft+1-Rt],At[Rt]=Mt[ft+Rt]-vt;let Bt=0;for(let Qt=0;Qt<Rt;++Qt){const Wt=At[Qt+1],tn=Et[Rt-Qt],pn=xt[Qt]/(Wt+tn);xt[Qt]=Bt+Wt*pn,Bt=tn*pn}xt[Rt]=Bt}return xt}(rt,tt,f,k),pt=new d.Ltg(0,0,0,0);for(let ft=0;ft<=f;++ft){const vt=et[rt-f+ft],yt=lt[ft],Mt=vt.w*yt;pt.x+=vt.x*Mt,pt.y+=vt.y*Mt,pt.z+=vt.z*Mt,pt.w+=vt.w*yt}return pt}(this.degree,this.knots,this.controlPoints,a);return h.w!==1&&h.divideScalar(h.w),s.set(h.x,h.y,h.z)}getTangent(e,i=new d.Pa4){const s=i,a=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),h=function(f,k,et,tt,rt){const lt=function(pt,ft,vt,yt,Mt){const xt=Mt<pt?Mt:pt,Et=[],At=HC(pt,yt,ft),Rt=function(Qt,Wt,tn,pn,yn){const En=[];for(let Tn=0;Tn<=tn;++Tn)En[Tn]=0;const wn=[];for(let Tn=0;Tn<=pn;++Tn)wn[Tn]=En.slice(0);const In=[];for(let Tn=0;Tn<=tn;++Tn)In[Tn]=En.slice(0);In[0][0]=1;const xn=En.slice(0),Cn=En.slice(0);for(let Tn=1;Tn<=tn;++Tn){xn[Tn]=Wt-yn[Qt+1-Tn],Cn[Tn]=yn[Qt+Tn]-Wt;let Wn=0;for(let or=0;or<Tn;++or){const fr=Cn[or+1],rr=xn[Tn-or];In[Tn][or]=fr+rr;const Ir=In[or][Tn-1]/In[Tn][or];In[or][Tn]=Wn+fr*Ir,Wn=rr*Ir}In[Tn][Tn]=Wn}for(let Tn=0;Tn<=tn;++Tn)wn[0][Tn]=In[Tn][tn];for(let Tn=0;Tn<=tn;++Tn){let Wn=0,or=1;const fr=[];for(let rr=0;rr<=tn;++rr)fr[rr]=En.slice(0);fr[0][0]=1;for(let rr=1;rr<=pn;++rr){let Ir=0;const kr=Tn-rr,Br=tn-rr;Tn>=rr&&(fr[or][0]=fr[Wn][0]/In[Br+1][kr],Ir=fr[or][0]*In[kr][Br]);const Ur=Tn-1<=Br?rr-1:tn-Tn;for(let _r=kr>=-1?1:-kr;_r<=Ur;++_r)fr[or][_r]=(fr[Wn][_r]-fr[Wn][_r-1])/In[Br+1][kr+_r],Ir+=fr[or][_r]*In[kr+_r][Br];Tn<=Br&&(fr[or][rr]=-fr[Wn][rr-1]/In[Br+1][Tn],Ir+=fr[or][rr]*In[Tn][Br]),wn[rr][Tn]=Ir;const hs=Wn;Wn=or,or=hs}}let Fn=tn;for(let Tn=1;Tn<=pn;++Tn){for(let Wn=0;Wn<=tn;++Wn)wn[Tn][Wn]*=Fn;Fn*=tn-Tn}return wn}(At,yt,pt,xt,ft),Bt=[];for(let Qt=0;Qt<vt.length;++Qt){const Wt=vt[Qt].clone(),tn=Wt.w;Wt.x*=tn,Wt.y*=tn,Wt.z*=tn,Bt[Qt]=Wt}for(let Qt=0;Qt<=xt;++Qt){const Wt=Bt[At-pt].clone().multiplyScalar(Rt[Qt][0]);for(let tn=1;tn<=pt;++tn)Wt.add(Bt[At-pt+tn].clone().multiplyScalar(Rt[Qt][tn]));Et[Qt]=Wt}for(let Qt=xt+1;Qt<=Mt+1;++Qt)Et[Qt]=new d.Ltg(0,0,0);return Et}(f,k,et,tt,rt);return function(pt){const ft=pt.length,vt=[],yt=[];for(let xt=0;xt<ft;++xt){const Et=pt[xt];vt[xt]=new d.Pa4(Et.x,Et.y,Et.z),yt[xt]=Et.w}const Mt=[];for(let xt=0;xt<ft;++xt){const Et=vt[xt].clone();for(let At=1;At<=xt;++At)Et.sub(Mt[xt-At].clone().multiplyScalar(dI(xt,At)*yt[At]));Mt[xt]=Et.divideScalar(yt[0])}return Mt}(lt)}(this.degree,this.knots,this.controlPoints,a,1);return s.copy(h[1]).normalize(),s}}let bo,uu,Vp;class pI extends d.aNw{constructor(e){super(e)}load(e,i,s,a){const h=this,f=h.path===""?d.Zp0.extractUrlBase(e):h.path,k=new d.hH6(this.manager);k.setPath(h.path),k.setResponseType("arraybuffer"),k.setRequestHeader(h.requestHeader),k.setWithCredentials(h.withCredentials),k.load(e,function(et){try{i(h.parse(et,f))}catch(tt){a?a(tt):console.error(tt),h.manager.itemError(e)}},s,a)}parse(e,i){if(function(a){const h="Kaydara FBX Binary  \0";return a.byteLength>=h.length&&h===Kl(a,0,h.length)}(e))bo=new wP().parse(e);else{const a=Kl(e);if(!function(h){const f=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let k=0;function et(tt){const rt=h[tt-1];return h=h.slice(k+tt),k++,rt}for(let tt=0;tt<f.length;++tt)if(et(1)===f[tt])return!1;return!0}(a))throw new Error("THREE.FBXLoader: Unknown format.");if(Mn(a)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Mn(a));bo=new zE().parse(a)}const s=new d.dpR(this.manager).setPath(this.resourcePath||i).setCrossOrigin(this.crossOrigin);return new eA(s,this.manager).parse(bo)}}class eA{constructor(e,i){this.textureLoader=e,this.manager=i}parse(){uu=this.parseConnections();const e=this.parseImages(),i=this.parseTextures(e),s=this.parseMaterials(i),a=this.parseDeformers(),h=new fI().parse(a);return this.parseScene(a,h,s),Vp}parseConnections(){const e=new Map;return"Connections"in bo&&bo.Connections.connections.forEach(function(i){const s=i[0],a=i[1],h=i[2];e.has(s)||e.set(s,{parents:[],children:[]});const f={ID:a,relationship:h};e.get(s).parents.push(f),e.has(a)||e.set(a,{parents:[],children:[]});const k={ID:s,relationship:h};e.get(a).children.push(k)}),e}parseImages(){const e={},i={};if("Video"in bo.Objects){const s=bo.Objects.Video;for(const a in s){const h=s[a];if(e[parseInt(a)]=h.RelativeFilename||h.Filename,"Content"in h){const f=h.Content instanceof ArrayBuffer&&h.Content.byteLength>0,k=typeof h.Content=="string"&&h.Content!=="";if(f||k){const et=this.parseImage(s[a]);i[h.RelativeFilename||h.Filename]=et}}}}for(const s in e){const a=e[s];i[a]!==void 0?e[s]=i[a]:e[s]=e[s].split("\\").pop()}return e}parseImage(e){const i=e.Content,s=e.RelativeFilename||e.Filename,a=s.slice(s.lastIndexOf(".")+1).toLowerCase();let h;switch(a){case"bmp":h="image/bmp";break;case"jpg":case"jpeg":h="image/jpeg";break;case"png":h="image/png";break;case"tif":h="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",s),h="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+a+'" is not supported.')}if(typeof i=="string")return"data:"+h+";base64,"+i;{const f=new Uint8Array(i);return window.URL.createObjectURL(new Blob([f],{type:h}))}}parseTextures(e){const i=new Map;if("Texture"in bo.Objects){const s=bo.Objects.Texture;for(const a in s){const h=this.parseTexture(s[a],e);i.set(parseInt(a),h)}}return i}parseTexture(e,i){const s=this.loadTexture(e,i);s.ID=e.id,s.name=e.attrName;const a=e.WrapModeU,h=e.WrapModeV,f=a!==void 0?a.value:0,k=h!==void 0?h.value:0;if(s.wrapS=f===0?d.rpg:d.uWy,s.wrapT=k===0?d.rpg:d.uWy,"Scaling"in e){const et=e.Scaling.value;s.repeat.x=et[0],s.repeat.y=et[1]}if("Translation"in e){const et=e.Translation.value;s.offset.x=et[0],s.offset.y=et[1]}return s}loadTexture(e,i){let s;const a=this.textureLoader.path,h=uu.get(e.id).children;let f;h!==void 0&&h.length>0&&i[h[0].ID]!==void 0&&(s=i[h[0].ID],s.indexOf("blob:")!==0&&s.indexOf("data:")!==0||this.textureLoader.setPath(void 0));const k=e.FileName.slice(-3).toLowerCase();if(k==="tga"){const et=this.manager.getHandler(".tga");et===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),f=new d.xEZ):(et.setPath(this.textureLoader.path),f=et.load(s))}else k==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),f=new d.xEZ):f=this.textureLoader.load(s);return this.textureLoader.setPath(a),f}parseMaterials(e){const i=new Map;if("Material"in bo.Objects){const s=bo.Objects.Material;for(const a in s){const h=this.parseMaterial(s[a],e);h!==null&&i.set(parseInt(a),h)}}return i}parseMaterial(e,i){const s=e.id,a=e.attrName;let h=e.ShadingModel;if(typeof h=="object"&&(h=h.value),!uu.has(s))return null;const f=this.parseParameters(e,i,s);let k;switch(h.toLowerCase()){case"phong":k=new d.xoR;break;case"lambert":k=new d.YBo;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',h),k=new d.xoR}return k.setValues(f),k.name=a,k}parseParameters(e,i,s){const a={};e.BumpFactor&&(a.bumpScale=e.BumpFactor.value),e.Diffuse?a.color=new d.Ilk().fromArray(e.Diffuse.value):!e.DiffuseColor||e.DiffuseColor.type!=="Color"&&e.DiffuseColor.type!=="ColorRGB"||(a.color=new d.Ilk().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(a.displacementScale=e.DisplacementFactor.value),e.Emissive?a.emissive=new d.Ilk().fromArray(e.Emissive.value):!e.EmissiveColor||e.EmissiveColor.type!=="Color"&&e.EmissiveColor.type!=="ColorRGB"||(a.emissive=new d.Ilk().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(a.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(a.opacity=parseFloat(e.Opacity.value)),a.opacity<1&&(a.transparent=!0),e.ReflectionFactor&&(a.reflectivity=e.ReflectionFactor.value),e.Shininess&&(a.shininess=e.Shininess.value),e.Specular?a.specular=new d.Ilk().fromArray(e.Specular.value):e.SpecularColor&&e.SpecularColor.type==="Color"&&(a.specular=new d.Ilk().fromArray(e.SpecularColor.value));const h=this;return uu.get(s).children.forEach(function(f){const k=f.relationship;switch(k){case"Bump":a.bumpMap=h.getTexture(i,f.ID);break;case"Maya|TEX_ao_map":a.aoMap=h.getTexture(i,f.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":a.map=h.getTexture(i,f.ID),a.map!==void 0&&(a.map.encoding=d.knz);break;case"DisplacementColor":a.displacementMap=h.getTexture(i,f.ID);break;case"EmissiveColor":a.emissiveMap=h.getTexture(i,f.ID),a.emissiveMap!==void 0&&(a.emissiveMap.encoding=d.knz);break;case"NormalMap":case"Maya|TEX_normal_map":a.normalMap=h.getTexture(i,f.ID);break;case"ReflectionColor":a.envMap=h.getTexture(i,f.ID),a.envMap!==void 0&&(a.envMap.mapping=d.dSO,a.envMap.encoding=d.knz);break;case"SpecularColor":a.specularMap=h.getTexture(i,f.ID),a.specularMap!==void 0&&(a.specularMap.encoding=d.knz);break;case"TransparentColor":case"TransparencyFactor":a.alphaMap=h.getTexture(i,f.ID),a.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",k)}}),a}getTexture(e,i){return"LayeredTexture"in bo.Objects&&i in bo.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),i=uu.get(i).children[0].ID),e.get(i)}parseDeformers(){const e={},i={};if("Deformer"in bo.Objects){const s=bo.Objects.Deformer;for(const a in s){const h=s[a],f=uu.get(parseInt(a));if(h.attrType==="Skin"){const k=this.parseSkeleton(f,s);k.ID=a,f.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),k.geometryID=f.parents[0].ID,e[a]=k}else if(h.attrType==="BlendShape"){const k={id:a};k.rawTargets=this.parseMorphTargets(f,s),k.id=a,f.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),i[a]=k}}}return{skeletons:e,morphTargets:i}}parseSkeleton(e,i){const s=[];return e.children.forEach(function(a){const h=i[a.ID];if(h.attrType!=="Cluster")return;const f={ID:a.ID,indices:[],weights:[],transformLink:new d.yGw().fromArray(h.TransformLink.a)};"Indexes"in h&&(f.indices=h.Indexes.a,f.weights=h.Weights.a),s.push(f)}),{rawBones:s,bones:[]}}parseMorphTargets(e,i){const s=[];for(let a=0;a<e.children.length;a++){const h=e.children[a],f=i[h.ID],k={name:f.attrName,initialWeight:f.DeformPercent,id:f.id,fullWeights:f.FullWeights.a};if(f.attrType!=="BlendShapeChannel")return;k.geoID=uu.get(parseInt(h.ID)).children.filter(function(et){return et.relationship===void 0})[0].ID,s.push(k)}return s}parseScene(e,i,s){Vp=new d.ZAu;const a=this.parseModels(e.skeletons,i,s),h=bo.Objects.Model,f=this;a.forEach(function(et){const tt=h[et.ID];f.setLookAtProperties(et,tt),uu.get(et.ID).parents.forEach(function(rt){const lt=a.get(rt.ID);lt!==void 0&&lt.add(et)}),et.parent===null&&Vp.add(et)}),this.bindSkeleton(e.skeletons,i,a),this.createAmbientLight(),Vp.traverse(function(et){if(et.userData.transformData){et.parent&&(et.userData.transformData.parentMatrix=et.parent.matrix,et.userData.transformData.parentMatrixWorld=et.parent.matrixWorld);const tt=Do(et.userData.transformData);et.applyMatrix4(tt),et.updateWorldMatrix()}});const k=new mI().parse();Vp.children.length===1&&Vp.children[0].isGroup&&(Vp.children[0].animations=k,Vp=Vp.children[0]),Vp.animations=k}parseModels(e,i,s){const a=new Map,h=bo.Objects.Model;for(const f in h){const k=parseInt(f),et=h[f],tt=uu.get(k);let rt=this.buildSkeleton(tt,e,k,et.attrName);if(!rt){switch(et.attrType){case"Camera":rt=this.createCamera(tt);break;case"Light":rt=this.createLight(tt);break;case"Mesh":rt=this.createMesh(tt,i,s);break;case"NurbsCurve":rt=this.createCurve(tt,i);break;case"LimbNode":case"Root":rt=new d.N$j;break;default:rt=new d.ZAu}rt.name=et.attrName?d.iUV.sanitizeNodeName(et.attrName):"",rt.ID=k}this.getTransformData(rt,et),a.set(k,rt)}return a}buildSkeleton(e,i,s,a){let h=null;return e.parents.forEach(function(f){for(const k in i){const et=i[k];et.rawBones.forEach(function(tt,rt){if(tt.ID===f.ID){const lt=h;h=new d.N$j,h.matrixWorld.copy(tt.transformLink),h.name=a?d.iUV.sanitizeNodeName(a):"",h.ID=s,et.bones[rt]=h,lt!==null&&h.add(lt)}})}}),h}createCamera(e){let i,s;if(e.children.forEach(function(a){const h=bo.Objects.NodeAttribute[a.ID];h!==void 0&&(s=h)}),s===void 0)i=new d.Tme;else{let a=0;s.CameraProjectionType!==void 0&&s.CameraProjectionType.value===1&&(a=1);let h=1;s.NearPlane!==void 0&&(h=s.NearPlane.value/1e3);let f=1e3;s.FarPlane!==void 0&&(f=s.FarPlane.value/1e3);let k=window.innerWidth,et=window.innerHeight;s.AspectWidth!==void 0&&s.AspectHeight!==void 0&&(k=s.AspectWidth.value,et=s.AspectHeight.value);const tt=k/et;let rt=45;s.FieldOfView!==void 0&&(rt=s.FieldOfView.value);const lt=s.FocalLength?s.FocalLength.value:null;switch(a){case 0:i=new d.cPb(rt,tt,h,f),lt!==null&&i.setFocalLength(lt);break;case 1:i=new d.iKG(-k/2,k/2,et/2,-et/2,h,f);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+a+"."),i=new d.Tme}}return i}createLight(e){let i,s;if(e.children.forEach(function(a){const h=bo.Objects.NodeAttribute[a.ID];h!==void 0&&(s=h)}),s===void 0)i=new d.Tme;else{let a;a=s.LightType===void 0?0:s.LightType.value;let h=16777215;s.Color!==void 0&&(h=new d.Ilk().fromArray(s.Color.value));let f=s.Intensity===void 0?1:s.Intensity.value/100;s.CastLightOnObject!==void 0&&s.CastLightOnObject.value===0&&(f=0);let k=0;s.FarAttenuationEnd!==void 0&&(k=s.EnableFarAttenuation!==void 0&&s.EnableFarAttenuation.value===0?0:s.FarAttenuationEnd.value);const et=1;switch(a){case 0:i=new d.cek(h,f,k,et);break;case 1:i=new d.Ox3(h,f);break;case 2:let tt=Math.PI/3;s.InnerAngle!==void 0&&(tt=d.M8C.degToRad(s.InnerAngle.value));let rt=0;s.OuterAngle!==void 0&&(rt=d.M8C.degToRad(s.OuterAngle.value),rt=Math.max(rt,1)),i=new d.PMe(h,f,k,tt,rt,et);break;default:console.warn("THREE.FBXLoader: Unknown light type "+s.LightType.value+", defaulting to a PointLight."),i=new d.cek(h,f)}s.CastShadows!==void 0&&s.CastShadows.value===1&&(i.castShadow=!0)}return i}createMesh(e,i,s){let a,h=null,f=null;const k=[];return e.children.forEach(function(et){i.has(et.ID)&&(h=i.get(et.ID)),s.has(et.ID)&&k.push(s.get(et.ID))}),k.length>1?f=k:k.length>0?f=k[0]:(f=new d.xoR({color:13421772}),k.push(f)),"color"in h.attributes&&k.forEach(function(et){et.vertexColors=!0}),h.FBX_Deformer?(a=new d.TUv(h,f),a.normalizeSkinWeights()):a=new d.Kj0(h,f),a}createCurve(e,i){const s=e.children.reduce(function(h,f){return i.has(f.ID)&&(h=i.get(f.ID)),h},null),a=new d.nls({color:3342591,linewidth:1});return new d.x12(s,a)}getTransformData(e,i){const s={};"InheritType"in i&&(s.inheritType=parseInt(i.InheritType.value)),s.eulerOrder="RotationOrder"in i?Bs(i.RotationOrder.value):"ZYX","Lcl_Translation"in i&&(s.translation=i.Lcl_Translation.value),"PreRotation"in i&&(s.preRotation=i.PreRotation.value),"Lcl_Rotation"in i&&(s.rotation=i.Lcl_Rotation.value),"PostRotation"in i&&(s.postRotation=i.PostRotation.value),"Lcl_Scaling"in i&&(s.scale=i.Lcl_Scaling.value),"ScalingOffset"in i&&(s.scalingOffset=i.ScalingOffset.value),"ScalingPivot"in i&&(s.scalingPivot=i.ScalingPivot.value),"RotationOffset"in i&&(s.rotationOffset=i.RotationOffset.value),"RotationPivot"in i&&(s.rotationPivot=i.RotationPivot.value),e.userData.transformData=s}setLookAtProperties(e,i){"LookAtProperty"in i&&uu.get(e.ID).children.forEach(function(s){if(s.relationship==="LookAtProperty"){const a=bo.Objects.Model[s.ID];if("Lcl_Translation"in a){const h=a.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(h),Vp.add(e.target)):e.lookAt(new d.Pa4().fromArray(h))}}})}bindSkeleton(e,i,s){const a=this.parsePoseNodes();for(const h in e){const f=e[h];uu.get(parseInt(f.ID)).parents.forEach(function(k){if(i.has(k.ID)){const et=k.ID;uu.get(et).parents.forEach(function(tt){s.has(tt.ID)&&s.get(tt.ID).bind(new d.OdW(f.bones),a[tt.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in bo.Objects){const i=bo.Objects.Pose;for(const s in i)if(i[s].attrType==="BindPose"&&i[s].NbPoseNodes>0){const a=i[s].PoseNode;Array.isArray(a)?a.forEach(function(h){e[h.Node]=new d.yGw().fromArray(h.Matrix.a)}):e[a.Node]=new d.yGw().fromArray(a.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in bo&&"AmbientColor"in bo.GlobalSettings){const e=bo.GlobalSettings.AmbientColor.value,i=e[0],s=e[1],a=e[2];if(i!==0||s!==0||a!==0){const h=new d.Ilk(i,s,a);Vp.add(new d.Mig(h,1))}}}}class fI{parse(e){const i=new Map;if("Geometry"in bo.Objects){const s=bo.Objects.Geometry;for(const a in s){const h=uu.get(parseInt(a)),f=this.parseGeometry(h,s[a],e);i.set(parseInt(a),f)}}return i}parseGeometry(e,i,s){switch(i.attrType){case"Mesh":return this.parseMeshGeometry(e,i,s);case"NurbsCurve":return this.parseNurbsGeometry(i)}}parseMeshGeometry(e,i,s){const a=s.skeletons,h=[],f=e.parents.map(function(lt){return bo.Objects.Model[lt.ID]});if(f.length===0)return;const k=e.children.reduce(function(lt,pt){return a[pt.ID]!==void 0&&(lt=a[pt.ID]),lt},null);e.children.forEach(function(lt){s.morphTargets[lt.ID]!==void 0&&h.push(s.morphTargets[lt.ID])});const et=f[0],tt={};"RotationOrder"in et&&(tt.eulerOrder=Bs(et.RotationOrder.value)),"InheritType"in et&&(tt.inheritType=parseInt(et.InheritType.value)),"GeometricTranslation"in et&&(tt.translation=et.GeometricTranslation.value),"GeometricRotation"in et&&(tt.rotation=et.GeometricRotation.value),"GeometricScaling"in et&&(tt.scale=et.GeometricScaling.value);const rt=Do(tt);return this.genGeometry(i,k,h,rt)}genGeometry(e,i,s,a){const h=new d.u9r;e.attrName&&(h.name=e.attrName);const f=this.parseGeoNode(e,i),k=this.genBuffers(f),et=new d.a$l(k.vertex,3);if(et.applyMatrix4(a),h.setAttribute("position",et),k.colors.length>0&&h.setAttribute("color",new d.a$l(k.colors,3)),i&&(h.setAttribute("skinIndex",new d.qlB(k.weightsIndices,4)),h.setAttribute("skinWeight",new d.a$l(k.vertexWeights,4)),h.FBX_Deformer=i),k.normal.length>0){const tt=new d.Vkp().getNormalMatrix(a),rt=new d.a$l(k.normal,3);rt.applyNormalMatrix(tt),h.setAttribute("normal",rt)}if(k.uvs.forEach(function(tt,rt){let lt="uv"+(rt+1).toString();rt===0&&(lt="uv"),h.setAttribute(lt,new d.a$l(k.uvs[rt],2))}),f.material&&f.material.mappingType!=="AllSame"){let tt=k.materialIndex[0],rt=0;if(k.materialIndex.forEach(function(lt,pt){lt!==tt&&(h.addGroup(rt,pt-rt,tt),tt=lt,rt=pt)}),h.groups.length>0){const lt=h.groups[h.groups.length-1],pt=lt.start+lt.count;pt!==k.materialIndex.length&&h.addGroup(pt,k.materialIndex.length-pt,tt)}h.groups.length===0&&h.addGroup(0,k.materialIndex.length,k.materialIndex[0])}return this.addMorphTargets(h,e,s,a),h}parseGeoNode(e,i){const s={};if(s.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],s.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(s.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(s.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(s.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){s.uv=[];let a=0;for(;e.LayerElementUV[a];)e.LayerElementUV[a].UV&&s.uv.push(this.parseUVs(e.LayerElementUV[a])),a++}return s.weightTable={},i!==null&&(s.skeleton=i,i.rawBones.forEach(function(a,h){a.indices.forEach(function(f,k){s.weightTable[f]===void 0&&(s.weightTable[f]=[]),s.weightTable[f].push({id:h,weight:a.weights[k]})})})),s}genBuffers(e){const i={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let s=0,a=0,h=!1,f=[],k=[],et=[],tt=[],rt=[],lt=[];const pt=this;return e.vertexIndices.forEach(function(ft,vt){let yt,Mt=!1;ft<0&&(ft^=-1,Mt=!0);let xt=[],Et=[];if(f.push(3*ft,3*ft+1,3*ft+2),e.color){const At=Mr(vt,s,ft,e.color);et.push(At[0],At[1],At[2])}if(e.skeleton){if(e.weightTable[ft]!==void 0&&e.weightTable[ft].forEach(function(At){Et.push(At.weight),xt.push(At.id)}),Et.length>4){h||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),h=!0);const At=[0,0,0,0],Rt=[0,0,0,0];Et.forEach(function(Bt,Qt){let Wt=Bt,tn=xt[Qt];Rt.forEach(function(pn,yn,En){if(Wt>pn){En[yn]=Wt,Wt=pn;const wn=At[yn];At[yn]=tn,tn=wn}})}),xt=At,Et=Rt}for(;Et.length<4;)Et.push(0),xt.push(0);for(let At=0;At<4;++At)rt.push(Et[At]),lt.push(xt[At])}if(e.normal){const At=Mr(vt,s,ft,e.normal);k.push(At[0],At[1],At[2])}e.material&&e.material.mappingType!=="AllSame"&&(yt=Mr(vt,s,ft,e.material)[0],yt<0&&(console.warn("THREE.FBXLoader: Invalid material index:",yt),yt=0)),e.uv&&e.uv.forEach(function(At,Rt){const Bt=Mr(vt,s,ft,At);tt[Rt]===void 0&&(tt[Rt]=[]),tt[Rt].push(Bt[0]),tt[Rt].push(Bt[1])}),a++,Mt&&(pt.genFace(i,e,f,yt,k,et,tt,rt,lt,a),s++,a=0,f=[],k=[],et=[],tt=[],rt=[],lt=[])}),i}genFace(e,i,s,a,h,f,k,et,tt,rt){for(let lt=2;lt<rt;lt++)e.vertex.push(i.vertexPositions[s[0]]),e.vertex.push(i.vertexPositions[s[1]]),e.vertex.push(i.vertexPositions[s[2]]),e.vertex.push(i.vertexPositions[s[3*(lt-1)]]),e.vertex.push(i.vertexPositions[s[3*(lt-1)+1]]),e.vertex.push(i.vertexPositions[s[3*(lt-1)+2]]),e.vertex.push(i.vertexPositions[s[3*lt]]),e.vertex.push(i.vertexPositions[s[3*lt+1]]),e.vertex.push(i.vertexPositions[s[3*lt+2]]),i.skeleton&&(e.vertexWeights.push(et[0]),e.vertexWeights.push(et[1]),e.vertexWeights.push(et[2]),e.vertexWeights.push(et[3]),e.vertexWeights.push(et[4*(lt-1)]),e.vertexWeights.push(et[4*(lt-1)+1]),e.vertexWeights.push(et[4*(lt-1)+2]),e.vertexWeights.push(et[4*(lt-1)+3]),e.vertexWeights.push(et[4*lt]),e.vertexWeights.push(et[4*lt+1]),e.vertexWeights.push(et[4*lt+2]),e.vertexWeights.push(et[4*lt+3]),e.weightsIndices.push(tt[0]),e.weightsIndices.push(tt[1]),e.weightsIndices.push(tt[2]),e.weightsIndices.push(tt[3]),e.weightsIndices.push(tt[4*(lt-1)]),e.weightsIndices.push(tt[4*(lt-1)+1]),e.weightsIndices.push(tt[4*(lt-1)+2]),e.weightsIndices.push(tt[4*(lt-1)+3]),e.weightsIndices.push(tt[4*lt]),e.weightsIndices.push(tt[4*lt+1]),e.weightsIndices.push(tt[4*lt+2]),e.weightsIndices.push(tt[4*lt+3])),i.color&&(e.colors.push(f[0]),e.colors.push(f[1]),e.colors.push(f[2]),e.colors.push(f[3*(lt-1)]),e.colors.push(f[3*(lt-1)+1]),e.colors.push(f[3*(lt-1)+2]),e.colors.push(f[3*lt]),e.colors.push(f[3*lt+1]),e.colors.push(f[3*lt+2])),i.material&&i.material.mappingType!=="AllSame"&&(e.materialIndex.push(a),e.materialIndex.push(a),e.materialIndex.push(a)),i.normal&&(e.normal.push(h[0]),e.normal.push(h[1]),e.normal.push(h[2]),e.normal.push(h[3*(lt-1)]),e.normal.push(h[3*(lt-1)+1]),e.normal.push(h[3*(lt-1)+2]),e.normal.push(h[3*lt]),e.normal.push(h[3*lt+1]),e.normal.push(h[3*lt+2])),i.uv&&i.uv.forEach(function(pt,ft){e.uvs[ft]===void 0&&(e.uvs[ft]=[]),e.uvs[ft].push(k[ft][0]),e.uvs[ft].push(k[ft][1]),e.uvs[ft].push(k[ft][2*(lt-1)]),e.uvs[ft].push(k[ft][2*(lt-1)+1]),e.uvs[ft].push(k[ft][2*lt]),e.uvs[ft].push(k[ft][2*lt+1])})}addMorphTargets(e,i,s,a){if(s.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const h=this;s.forEach(function(f){f.rawTargets.forEach(function(k){const et=bo.Objects.Geometry[k.geoID];et!==void 0&&h.genMorphGeometry(e,i,et,a,k.name)})})}genMorphGeometry(e,i,s,a,h){const f=i.PolygonVertexIndex!==void 0?i.PolygonVertexIndex.a:[],k=s.Vertices!==void 0?s.Vertices.a:[],et=s.Indexes!==void 0?s.Indexes.a:[],tt=3*e.attributes.position.count,rt=new Float32Array(tt);for(let vt=0;vt<et.length;vt++){const yt=3*et[vt];rt[yt]=k[3*vt],rt[yt+1]=k[3*vt+1],rt[yt+2]=k[3*vt+2]}const lt={vertexIndices:f,vertexPositions:rt},pt=this.genBuffers(lt),ft=new d.a$l(pt.vertex,3);ft.name=h||s.attrName,ft.applyMatrix4(a),e.morphAttributes.position.push(ft)}parseNormals(e){const i=e.MappingInformationType,s=e.ReferenceInformationType,a=e.Normals.a;let h=[];return s==="IndexToDirect"&&("NormalIndex"in e?h=e.NormalIndex.a:"NormalsIndex"in e&&(h=e.NormalsIndex.a)),{dataSize:3,buffer:a,indices:h,mappingType:i,referenceType:s}}parseUVs(e){const i=e.MappingInformationType,s=e.ReferenceInformationType,a=e.UV.a;let h=[];return s==="IndexToDirect"&&(h=e.UVIndex.a),{dataSize:2,buffer:a,indices:h,mappingType:i,referenceType:s}}parseVertexColors(e){const i=e.MappingInformationType,s=e.ReferenceInformationType,a=e.Colors.a;let h=[];return s==="IndexToDirect"&&(h=e.ColorIndex.a),{dataSize:4,buffer:a,indices:h,mappingType:i,referenceType:s}}parseMaterialIndices(e){const i=e.MappingInformationType,s=e.ReferenceInformationType;if(i==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:s};const a=e.Materials.a,h=[];for(let f=0;f<a.length;++f)h.push(f);return{dataSize:1,buffer:a,indices:h,mappingType:i,referenceType:s}}parseNurbsGeometry(e){if(WC===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new d.u9r;const i=parseInt(e.Order);if(isNaN(i))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new d.u9r;const s=i-1,a=e.KnotVector.a,h=[],f=e.Points.a;for(let rt=0,lt=f.length;rt<lt;rt+=4)h.push(new d.Ltg().fromArray(f,rt));let k,et;if(e.Form==="Closed")h.push(h[0]);else if(e.Form==="Periodic"){k=s,et=a.length-1-k;for(let rt=0;rt<s;++rt)h.push(h[rt])}const tt=new WC(s,a,h,k,et).getPoints(12*h.length);return new d.u9r().setFromPoints(tt)}}class mI{parse(){const e=[],i=this.parseClips();if(i!==void 0)for(const s in i){const a=i[s],h=this.addClip(a);e.push(h)}return e}parseClips(){if(bo.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const i=this.parseAnimationLayers(e);return this.parseAnimStacks(i)}parseAnimationCurveNodes(){const e=bo.Objects.AnimationCurveNode,i=new Map;for(const s in e){const a=e[s];if(a.attrName.match(/S|R|T|DeformPercent/)!==null){const h={id:a.id,attr:a.attrName,curves:{}};i.set(h.id,h)}}return i}parseAnimationCurves(e){const i=bo.Objects.AnimationCurve;for(const s in i){const a={id:i[s].id,times:i[s].KeyTime.a.map(yr),values:i[s].KeyValueFloat.a},h=uu.get(a.id);if(h!==void 0){const f=h.parents[0].ID,k=h.parents[0].relationship;k.match(/X/)?e.get(f).curves.x=a:k.match(/Y/)?e.get(f).curves.y=a:k.match(/Z/)?e.get(f).curves.z=a:k.match(/d|DeformPercent/)&&e.has(f)&&(e.get(f).curves.morph=a)}}}parseAnimationLayers(e){const i=bo.Objects.AnimationLayer,s=new Map;for(const a in i){const h=[],f=uu.get(parseInt(a));f!==void 0&&(f.children.forEach(function(k,et){if(e.has(k.ID)){const tt=e.get(k.ID);if(tt.curves.x!==void 0||tt.curves.y!==void 0||tt.curves.z!==void 0){if(h[et]===void 0){const rt=uu.get(k.ID).parents.filter(function(lt){return lt.relationship!==void 0})[0].ID;if(rt!==void 0){const lt=bo.Objects.Model[rt.toString()];if(lt===void 0)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",k);const pt={modelName:lt.attrName?d.iUV.sanitizeNodeName(lt.attrName):"",ID:lt.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Vp.traverse(function(ft){ft.ID===lt.id&&(pt.transform=ft.matrix,ft.userData.transformData&&(pt.eulerOrder=ft.userData.transformData.eulerOrder))}),pt.transform||(pt.transform=new d.yGw),"PreRotation"in lt&&(pt.preRotation=lt.PreRotation.value),"PostRotation"in lt&&(pt.postRotation=lt.PostRotation.value),h[et]=pt}}h[et]&&(h[et][tt.attr]=tt)}else if(tt.curves.morph!==void 0){if(h[et]===void 0){const rt=uu.get(k.ID).parents.filter(function(Mt){return Mt.relationship!==void 0})[0].ID,lt=uu.get(rt).parents[0].ID,pt=uu.get(lt).parents[0].ID,ft=uu.get(pt).parents[0].ID,vt=bo.Objects.Model[ft],yt={modelName:vt.attrName?d.iUV.sanitizeNodeName(vt.attrName):"",morphName:bo.Objects.Deformer[rt].attrName};h[et]=yt}h[et][tt.attr]=tt}}}),s.set(parseInt(a),h))}return s}parseAnimStacks(e){const i=bo.Objects.AnimationStack,s={};for(const a in i){const h=uu.get(parseInt(a)).children;h.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const f=e.get(h[0].ID);s[a]={name:i[a].attrName,layer:f}}return s}addClip(e){let i=[];const s=this;return e.layer.forEach(function(a){i=i.concat(s.generateTracks(a))}),new d.m7l(e.name,-1,i)}generateTracks(e){const i=[];let s=new d.Pa4,a=new d._fP,h=new d.Pa4;if(e.transform&&e.transform.decompose(s,a,h),s=s.toArray(),a=new d.USm().setFromQuaternion(a,e.eulerOrder).toArray(),h=h.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const f=this.generateVectorTrack(e.modelName,e.T.curves,s,"position");f!==void 0&&i.push(f)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const f=this.generateRotationTrack(e.modelName,e.R.curves,a,e.preRotation,e.postRotation,e.eulerOrder);f!==void 0&&i.push(f)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const f=this.generateVectorTrack(e.modelName,e.S.curves,h,"scale");f!==void 0&&i.push(f)}if(e.DeformPercent!==void 0){const f=this.generateMorphTrack(e);f!==void 0&&i.push(f)}return i}generateVectorTrack(e,i,s,a){const h=this.getTimesForAllAxes(i),f=this.getKeyframeTrackValues(h,i,s);return new d.yC1(e+"."+a,h,f)}generateRotationTrack(e,i,s,a,h,f){i.x!==void 0&&(this.interpolateRotations(i.x),i.x.values=i.x.values.map(d.M8C.degToRad)),i.y!==void 0&&(this.interpolateRotations(i.y),i.y.values=i.y.values.map(d.M8C.degToRad)),i.z!==void 0&&(this.interpolateRotations(i.z),i.z.values=i.z.values.map(d.M8C.degToRad));const k=this.getTimesForAllAxes(i),et=this.getKeyframeTrackValues(k,i,s);a!==void 0&&((a=a.map(d.M8C.degToRad)).push(f),a=new d.USm().fromArray(a),a=new d._fP().setFromEuler(a)),h!==void 0&&((h=h.map(d.M8C.degToRad)).push(f),h=new d.USm().fromArray(h),h=new d._fP().setFromEuler(h).invert());const tt=new d._fP,rt=new d.USm,lt=[];for(let pt=0;pt<et.length;pt+=3)rt.set(et[pt],et[pt+1],et[pt+2],f),tt.setFromEuler(rt),a!==void 0&&tt.premultiply(a),h!==void 0&&tt.multiply(h),tt.toArray(lt,pt/3*4);return new d.iLg(e+".quaternion",k,lt)}generateMorphTrack(e){const i=e.DeformPercent.curves.morph,s=i.values.map(function(h){return h/100}),a=Vp.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new d.dUE(e.modelName+".morphTargetInfluences["+a+"]",i.times,s)}getTimesForAllAxes(e){let i=[];if(e.x!==void 0&&(i=i.concat(e.x.times)),e.y!==void 0&&(i=i.concat(e.y.times)),e.z!==void 0&&(i=i.concat(e.z.times)),i=i.sort(function(s,a){return s-a}),i.length>1){let s=1,a=i[0];for(let h=1;h<i.length;h++){const f=i[h];f!==a&&(i[s]=f,a=f,s++)}i=i.slice(0,s)}return i}getKeyframeTrackValues(e,i,s){const a=s,h=[];let f=-1,k=-1,et=-1;return e.forEach(function(tt){if(i.x&&(f=i.x.times.indexOf(tt)),i.y&&(k=i.y.times.indexOf(tt)),i.z&&(et=i.z.times.indexOf(tt)),f!==-1){const rt=i.x.values[f];h.push(rt),a[0]=rt}else h.push(a[0]);if(k!==-1){const rt=i.y.values[k];h.push(rt),a[1]=rt}else h.push(a[1]);if(et!==-1){const rt=i.z.values[et];h.push(rt),a[2]=rt}else h.push(a[2])}),h}interpolateRotations(e){for(let i=1;i<e.values.length;i++){const s=e.values[i-1],a=e.values[i]-s,h=Math.abs(a);if(h>=180){const f=h/180,k=a/f;let et=s+k;const tt=e.times[i-1],rt=(e.times[i]-tt)/f;let lt=tt+rt;const pt=[],ft=[];for(;lt<e.times[i];)pt.push(lt),lt+=rt,ft.push(et),et+=k;e.times=Ro(e.times,i,pt),e.values=Ro(e.values,i,ft)}}}}class zE{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,i){this.currentProp=e,this.currentPropName=i}parse(e){this.currentIndent=0,this.allNodes=new qC,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const i=this,s=e.split(/[\r\n]+/);return s.forEach(function(a,h){const f=a.match(/^[\s\t]*;/),k=a.match(/^[\s\t]*$/);if(f||k)return;const et=a.match("^\\t{"+i.currentIndent+"}(\\w+):(.*){",""),tt=a.match("^\\t{"+i.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),rt=a.match("^\\t{"+(i.currentIndent-1)+"}}");et?i.parseNodeBegin(a,et):tt?i.parseNodeProperty(a,tt,s[++h]):rt?i.popStack():a.match(/^[^\s\t}]/)&&i.parseNodePropertyContinued(a)}),this.allNodes}parseNodeBegin(e,i){const s=i[1].trim().replace(/^"/,"").replace(/"$/,""),a=i[2].split(",").map(function(et){return et.trim().replace(/^"/,"").replace(/"$/,"")}),h={name:s},f=this.parseNodeAttr(a),k=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(s,h):s in k?(s==="PoseNode"?k.PoseNode.push(h):k[s].id!==void 0&&(k[s]={},k[s][k[s].id]=k[s]),f.id!==""&&(k[s][f.id]=h)):typeof f.id=="number"?(k[s]={},k[s][f.id]=h):s!=="Properties70"&&(k[s]=s==="PoseNode"?[h]:h),typeof f.id=="number"&&(h.id=f.id),f.name!==""&&(h.attrName=f.name),f.type!==""&&(h.attrType=f.type),this.pushStack(h)}parseNodeAttr(e){let i=e[0];e[0]!==""&&(i=parseInt(e[0]),isNaN(i)&&(i=e[0]));let s="",a="";return e.length>1&&(s=e[1].replace(/^(\w+)::/,""),a=e[2]),{id:i,name:s,type:a}}parseNodeProperty(e,i,s){let a=i[1].replace(/^"/,"").replace(/"$/,"").trim(),h=i[2].replace(/^"/,"").replace(/"$/,"").trim();a==="Content"&&h===","&&(h=s.replace(/"/g,"").replace(/,$/,"").trim());const f=this.getCurrentNode();if(f.name!=="Properties70"){if(a==="C"){const k=h.split(",").slice(1),et=parseInt(k[0]),tt=parseInt(k[1]);let rt=h.split(",").slice(3);rt=rt.map(function(lt){return lt.trim().replace(/^"/,"")}),a="connections",h=[et,tt],function(lt,pt){for(let ft=0,vt=lt.length,yt=pt.length;ft<yt;ft++,vt++)lt[vt]=pt[ft]}(h,rt),f[a]===void 0&&(f[a]=[])}a==="Node"&&(f.id=h),a in f&&Array.isArray(f[a])?f[a].push(h):a!=="a"?f[a]=h:f.a=h,this.setCurrentProp(f,a),a==="a"&&h.slice(-1)!==","&&(f.a=vo(h))}else this.parseNodeSpecialProperty(e,a,h)}parseNodePropertyContinued(e){const i=this.getCurrentNode();i.a+=e,e.slice(-1)!==","&&(i.a=vo(i.a))}parseNodeSpecialProperty(e,i,s){const a=s.split('",').map(function(rt){return rt.trim().replace(/^\"/,"").replace(/\s/,"_")}),h=a[0],f=a[1],k=a[2],et=a[3];let tt=a[4];switch(f){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":tt=parseFloat(tt);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":tt=vo(tt)}this.getPrevNode()[h]={type:f,type2:k,flag:et,value:tt},this.setCurrentProp(this.getPrevNode(),h)}}class wP{parse(e){const i=new Vx(e);i.skip(23);const s=i.getUint32();if(s<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+s);const a=new qC;for(;!this.endOfContent(i);){const h=this.parseNode(i,s);h!==null&&a.add(h.name,h)}return a}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,i){const s={},a=i>=7500?e.getUint64():e.getUint32(),h=i>=7500?e.getUint64():e.getUint32();i>=7500?e.getUint64():e.getUint32();const f=e.getUint8(),k=e.getString(f);if(a===0)return null;const et=[];for(let pt=0;pt<h;pt++)et.push(this.parseProperty(e));const tt=et.length>0?et[0]:"",rt=et.length>1?et[1]:"",lt=et.length>2?et[2]:"";for(s.singleProperty=h===1&&e.getOffset()===a;a>e.getOffset();){const pt=this.parseNode(e,i);pt!==null&&this.parseSubNode(k,s,pt)}return s.propertyList=et,typeof tt=="number"&&(s.id=tt),rt!==""&&(s.attrName=rt),lt!==""&&(s.attrType=lt),k!==""&&(s.name=k),s}parseSubNode(e,i,s){if(s.singleProperty===!0){const a=s.propertyList[0];Array.isArray(a)?(i[s.name]=s,s.a=a):i[s.name]=a}else if(e==="Connections"&&s.name==="C"){const a=[];s.propertyList.forEach(function(h,f){f!==0&&a.push(h)}),i.connections===void 0&&(i.connections=[]),i.connections.push(a)}else if(s.name==="Properties70")Object.keys(s).forEach(function(a){i[a]=s[a]});else if(e==="Properties70"&&s.name==="P"){let a=s.propertyList[0],h=s.propertyList[1];const f=s.propertyList[2],k=s.propertyList[3];let et;a.indexOf("Lcl ")===0&&(a=a.replace("Lcl ","Lcl_")),h.indexOf("Lcl ")===0&&(h=h.replace("Lcl ","Lcl_")),et=h==="Color"||h==="ColorRGB"||h==="Vector"||h==="Vector3D"||h.indexOf("Lcl_")===0?[s.propertyList[4],s.propertyList[5],s.propertyList[6]]:s.propertyList[4],i[a]={type:h,type2:f,flag:k,value:et}}else i[s.name]===void 0?typeof s.id=="number"?(i[s.name]={},i[s.name][s.id]=s):i[s.name]=s:s.name==="PoseNode"?(Array.isArray(i[s.name])||(i[s.name]=[i[s.name]]),i[s.name].push(s)):i[s.name][s.id]===void 0&&(i[s.name][s.id]=s)}parseProperty(e){const i=e.getString(1);let s;switch(i){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return s=e.getUint32(),e.getArrayBuffer(s);case"S":return s=e.getUint32(),e.getString(s);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const a=e.getUint32(),h=e.getUint32(),f=e.getUint32();if(h===0)switch(i){case"b":case"c":return e.getBooleanArray(a);case"d":return e.getFloat64Array(a);case"f":return e.getFloat32Array(a);case"i":return e.getInt32Array(a);case"l":return e.getInt64Array(a)}g===void 0&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const k=jr(new Uint8Array(e.getArrayBuffer(f))),et=new Vx(k.buffer);switch(i){case"b":case"c":return et.getBooleanArray(a);case"d":return et.getFloat64Array(a);case"f":return et.getFloat32Array(a);case"i":return et.getInt32Array(a);case"l":return et.getInt64Array(a)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+i)}}}class Vx{constructor(e,i){this.dv=new DataView(e),this.offset=0,this.littleEndian=i===void 0||i}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(1&this.getUint8())==1}getBooleanArray(e){const i=[];for(let s=0;s<e;s++)i.push(this.getBoolean());return i}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getInt32());return i}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,i;return this.littleEndian?(e=this.getUint32(),i=this.getUint32()):(i=this.getUint32(),e=this.getUint32()),2147483648&i?(i=4294967295&~i,e=4294967295&~e,e===4294967295&&(i=i+1&4294967295),e=e+1&4294967295,-(4294967296*i+e)):4294967296*i+e}getInt64Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getInt64());return i}getUint64(){let e,i;return this.littleEndian?(e=this.getUint32(),i=this.getUint32()):(i=this.getUint32(),e=this.getUint32()),4294967296*i+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getFloat32());return i}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getFloat64());return i}getArrayBuffer(e){const i=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,i}getString(e){let i=[];for(let a=0;a<e;a++)i[a]=this.getUint8();const s=i.indexOf(0);return s>=0&&(i=i.slice(0,s)),d.Zp0.decodeText(new Uint8Array(i))}}class qC{add(e,i){this[e]=i}}function Mn(c){const e=c.match(/FBXVersion: (\d+)/);if(e)return parseInt(e[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function yr(c){return c/46186158e3}const Pr=[];function Mr(c,e,i,s){let a;switch(s.mappingType){case"ByPolygonVertex":a=c;break;case"ByPolygon":a=e;break;case"ByVertice":a=i;break;case"AllSame":a=s.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+s.mappingType)}s.referenceType==="IndexToDirect"&&(a=s.indices[a]);const h=a*s.dataSize,f=h+s.dataSize;return function(k,et,tt,rt){for(let lt=tt,pt=0;lt<rt;lt++,pt++)k[pt]=et[lt];return k}(Pr,s.buffer,h,f)}const zr=new d.USm,fs=new d.Pa4;function Do(c){const e=new d.yGw,i=new d.yGw,s=new d.yGw,a=new d.yGw,h=new d.yGw,f=new d.yGw,k=new d.yGw,et=new d.yGw,tt=new d.yGw,rt=new d.yGw,lt=new d.yGw,pt=new d.yGw,ft=c.inheritType?c.inheritType:0;if(c.translation&&e.setPosition(fs.fromArray(c.translation)),c.preRotation){const yn=c.preRotation.map(d.M8C.degToRad);yn.push(c.eulerOrder||d.USm.DefaultOrder),i.makeRotationFromEuler(zr.fromArray(yn))}if(c.rotation){const yn=c.rotation.map(d.M8C.degToRad);yn.push(c.eulerOrder||d.USm.DefaultOrder),s.makeRotationFromEuler(zr.fromArray(yn))}if(c.postRotation){const yn=c.postRotation.map(d.M8C.degToRad);yn.push(c.eulerOrder||d.USm.DefaultOrder),a.makeRotationFromEuler(zr.fromArray(yn)),a.invert()}c.scale&&h.scale(fs.fromArray(c.scale)),c.scalingOffset&&k.setPosition(fs.fromArray(c.scalingOffset)),c.scalingPivot&&f.setPosition(fs.fromArray(c.scalingPivot)),c.rotationOffset&&et.setPosition(fs.fromArray(c.rotationOffset)),c.rotationPivot&&tt.setPosition(fs.fromArray(c.rotationPivot)),c.parentMatrixWorld&&(lt.copy(c.parentMatrix),rt.copy(c.parentMatrixWorld));const vt=i.clone().multiply(s).multiply(a),yt=new d.yGw;yt.extractRotation(rt);const Mt=new d.yGw;Mt.copyPosition(rt);const xt=Mt.clone().invert().multiply(rt),Et=yt.clone().invert().multiply(xt),At=h,Rt=new d.yGw;if(ft===0)Rt.copy(yt).multiply(vt).multiply(Et).multiply(At);else if(ft===1)Rt.copy(yt).multiply(Et).multiply(vt).multiply(At);else{const yn=new d.yGw().scale(new d.Pa4().setFromMatrixScale(lt)).clone().invert(),En=Et.clone().multiply(yn);Rt.copy(yt).multiply(vt).multiply(En).multiply(At)}const Bt=tt.clone().invert(),Qt=f.clone().invert();let Wt=e.clone().multiply(et).multiply(tt).multiply(i).multiply(s).multiply(a).multiply(Bt).multiply(k).multiply(f).multiply(h).multiply(Qt);const tn=new d.yGw().copyPosition(Wt),pn=rt.clone().multiply(tn);return pt.copyPosition(pn),Wt=pt.clone().multiply(Rt),Wt.premultiply(rt.invert()),Wt}function Bs(c){const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return(c=c||0)===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[c]}function vo(c){return c.split(",").map(function(e){return parseFloat(e)})}function Kl(c,e,i){return e===void 0&&(e=0),i===void 0&&(i=c.byteLength),d.Zp0.decodeText(new Uint8Array(c,e,i))}function Ro(c,e,i){return c.slice(0,e).concat(i).concat(c.slice(e))}class ho extends j{constructor(){super(...arguments),this.dependencies=[Kr],this._importer=new zl(pI,["fbx"],!0)}async onAdded(e){uo.Importers.push(this._importer)}async onDispose(e){}async onRemove(e){uo.Importers.splice(uo.Importers.indexOf(this._importer),1)}}ho.PluginType="FBXLoadPlugin";const Mu=new WeakMap;class Qx extends d.aNw{constructor(e){super(e),this.libraryPath="",this.libraryPending=null,this.libraryBinary=null,this.libraryConfig={},this.url="",this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={},this.materials=[],this.warnings=[]}setLibraryPath(e){return this.libraryPath=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,i,s,a){const h=new d.hH6(this.manager);h.setPath(this.path),h.setResponseType("arraybuffer"),h.setRequestHeader(this.requestHeader),this.url=e,h.load(e,f=>{if(Mu.has(f))return Mu.get(f).promise.then(i).catch(a);this.decodeObjects(f,e).then(k=>{k.userData.warnings=this.warnings,i(k)}).catch(k=>a(k))},s,a)}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}decodeObjects(e,i){let s,a;const h=e.byteLength,f=this._getWorker(h).then(k=>(s=k,a=this.workerNextTaskID++,new Promise((et,tt)=>{s._callbacks[a]={resolve:et,reject:tt},s.postMessage({type:"decode",id:a,buffer:e},[e])}))).then(k=>this._createGeometry(k.data)).catch(k=>{throw k});return f.catch(()=>!0).then(()=>{s&&a&&this._releaseTask(s,a)}),Mu.set(e,{url:i,promise:f}),f}parse(e,i,s){this.decodeObjects(e,"").then(a=>{a.userData.warnings=this.warnings,i(a)}).catch(a=>s(a))}_compareMaterials(e){const i={};i.name=e.name,i.color={},i.color.r=e.color.r,i.color.g=e.color.g,i.color.b=e.color.b,i.type=e.type;for(let s=0;s<this.materials.length;s++){const a=this.materials[s],h={};if(h.name=a.name,h.color={},h.color.r=a.color.r,h.color.g=a.color.g,h.color.b=a.color.b,h.type=a.type,JSON.stringify(i)===JSON.stringify(h))return a}return this.materials.push(e),e}_createMaterial(e){if(e===void 0)return new d.Wid({color:new d.Ilk(1,1,1),metalness:.8,name:"default",side:2});const i=e.diffuseColor,s=new d.Ilk(i.r/255,i.g/255,i.b/255);i.r===0&&i.g===0&&i.b===0&&(s.r=1,s.g=1,s.b=1);const a=new d.Wid({color:s,name:e.name,side:2,transparent:e.transparency>0,opacity:1-e.transparency}),h=new d.dpR;for(let f=0;f<e.textures.length;f++){const k=e.textures[f];if(k.image!==null){const et=h.load(k.image);switch(k.type){case"Diffuse":a.map=et;break;case"Bump":a.bumpMap=et;break;case"Transparency":a.alphaMap=et,a.transparent=!0;break;case"Emap":a.envMap=et}et.wrapS=k.wrapU===0?d.rpg:d.uWy,et.wrapT=k.wrapV===0?d.rpg:d.uWy,et.repeat.set(k.repeat[0],k.repeat[1])}}return a}_createGeometry(e){const i=new d.Tme,s=[],a=[],h=[];i.userData.layers=e.layers,i.userData.groups=e.groups,i.userData.settings=e.settings,i.userData.objectType="File3dm",i.userData.materials=null,i.name=this.url;let f=e.objects;const k=e.materials;for(let et=0;et<f.length;et++){const tt=f[et],rt=tt.attributes;switch(tt.objectType){case"InstanceDefinition":a.push(tt);break;case"InstanceReference":h.push(tt);break;default:let lt;if(rt.materialIndex>=0){const ft=k[rt.materialIndex];let vt=this._createMaterial(ft);vt=this._compareMaterials(vt),lt=this._createObject(tt,vt)}else{const ft=this._createMaterial();lt=this._createObject(tt,ft)}if(lt===void 0)continue;const pt=e.layers[rt.layerIndex];lt.visible=!pt||e.layers[rt.layerIndex].visible,rt.isInstanceDefinitionObject?s.push(lt):i.add(lt)}}for(let et=0;et<a.length;et++){const tt=a[et];f=[];for(let rt=0;rt<tt.attributes.objectIds.length;rt++){const lt=tt.attributes.objectIds[rt];for(let pt=0;pt<s.length;pt++)lt===s[pt].userData.attributes.id&&f.push(s[pt])}for(let rt=0;rt<h.length;rt++){const lt=h[rt];if(lt.geometry.parentIdefId===tt.attributes.id){const pt=new d.Tme,ft=lt.geometry.xform.array,vt=new d.yGw;vt.set(ft[0],ft[1],ft[2],ft[3],ft[4],ft[5],ft[6],ft[7],ft[8],ft[9],ft[10],ft[11],ft[12],ft[13],ft[14],ft[15]),pt.applyMatrix4(vt);for(let yt=0;yt<f.length;yt++)pt.add(f[yt].clone(!0));i.add(pt)}}}return i.userData.materials=this.materials,i}_createObject(e,i){const s=new d.s4_,a=e.attributes;let h,f,k,et;switch(e.objectType){case"Point":case"PointSet":h=s.parse(e.geometry),h.attributes.hasOwnProperty("color")?f=new d.UY4({vertexColors:!0,sizeAttenuation:!1,size:2}):(k=a.drawColor,et=new d.Ilk(k.r/255,k.g/255,k.b/255),f=new d.UY4({color:et,sizeAttenuation:!1,size:2})),f=this._compareMaterials(f);const tt=new d.woe(h,f);return tt.userData.attributes=a,tt.userData.objectType=e.objectType,a.name&&(tt.name=a.name),tt;case"Mesh":case"Extrusion":case"SubD":case"Brep":if(e.geometry===null)return;h=s.parse(e.geometry),h.attributes.hasOwnProperty("color")&&(i.vertexColors=!0),i===null&&(i=this._createMaterial(),i=this._compareMaterials(i));const rt=new d.Kj0(h,i);return rt.castShadow=a.castsShadows,rt.receiveShadow=a.receivesShadows,rt.userData.attributes=a,rt.userData.objectType=e.objectType,a.name&&(rt.name=a.name),rt;case"Curve":h=s.parse(e.geometry),k=a.drawColor,et=new d.Ilk(k.r/255,k.g/255,k.b/255),f=new d.nls({color:et}),f=this._compareMaterials(f);const lt=new d.x12(h,f);return lt.userData.attributes=a,lt.userData.objectType=e.objectType,a.name&&(lt.name=a.name),lt;case"TextDot":h=e.geometry;const pt=document.createElement("canvas").getContext("2d"),ft=`${h.fontHeight}px ${h.fontFace}`;pt.font=ft;const vt=pt.measureText(h.text).width+10,yt=h.fontHeight+10,Mt=window.devicePixelRatio;pt.canvas.width=vt*Mt,pt.canvas.height=yt*Mt,pt.canvas.style.width=vt+"px",pt.canvas.style.height=yt+"px",pt.setTransform(Mt,0,0,Mt,0,0),pt.font=ft,pt.textBaseline="middle",pt.textAlign="center",et=a.drawColor,pt.fillStyle=`rgba(${et.r},${et.g},${et.b},${et.a})`,pt.fillRect(0,0,vt,yt),pt.fillStyle="white",pt.fillText(h.text,vt/2,yt/2);const xt=new d.ROQ(pt.canvas);xt.minFilter=d.wem,xt.wrapS=d.uWy,xt.wrapT=d.uWy,f=new d.xeV({map:xt,depthTest:!1});const Et=new d.jyi(f);return Et.position.set(h.point[0],h.point[1],h.point[2]),Et.scale.set(vt/10,yt/10,1),Et.userData.attributes=a,Et.userData.objectType=e.objectType,a.name&&(Et.name=a.name),Et;case"Light":let At;switch(h=e.geometry,h.lightStyle.name){case"LightStyle_WorldPoint":At=new d.cek,At.castShadow=a.castsShadows,At.position.set(h.location[0],h.location[1],h.location[2]),At.shadow.normalBias=.1;break;case"LightStyle_WorldSpot":At=new d.PMe,At.castShadow=a.castsShadows,At.position.set(h.location[0],h.location[1],h.location[2]),At.target.position.set(h.direction[0],h.direction[1],h.direction[2]),At.angle=h.spotAngleRadians,At.shadow.normalBias=.1;break;case"LightStyle_WorldRectangular":At=new d.T_f;const Rt=Math.abs(h.width[2]),Bt=Math.abs(h.length[0]);At.position.set(h.location[0]-Bt/2,h.location[1],h.location[2]-Rt/2),At.height=Bt,At.width=Rt,At.lookAt(new d.Pa4(h.direction[0],h.direction[1],h.direction[2]));break;case"LightStyle_WorldDirectional":At=new d.Ox3,At.castShadow=a.castsShadows,At.position.set(h.location[0],h.location[1],h.location[2]),At.target.position.set(h.direction[0],h.direction[1],h.direction[2]),At.shadow.normalBias=.1}return At&&(At.intensity=h.intensity,k=h.diffuse,et=new d.Ilk(k.r/255,k.g/255,k.b/255),At.color=et,At.userData.attributes=a,At.userData.objectType=e.objectType),At}}_initLibrary(){if(!this.libraryPending){const e=new d.hH6(this.manager);e.setPath(this.libraryPath);const i=new Promise((h,f)=>{e.load("rhino3dm.js",h,void 0,f)}),s=new d.hH6(this.manager);s.setPath(this.libraryPath),s.setResponseType("arraybuffer");const a=new Promise((h,f)=>{s.load("rhino3dm.wasm",h,void 0,f)});this.libraryPending=Promise.all([i,a]).then(([h,f])=>{this.libraryConfig.wasmBinary=f;const k=tv.toString(),et=["/* rhino3dm.js */",h,"/* worker */",k.substring(k.indexOf("{")+1,k.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([et]))})}return this.libraryPending}_getWorker(e){return this._initLibrary().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",libraryConfig:this.libraryConfig}),s.onmessage=a=>{const h=a.data;switch(h.type){case"warning":this.warnings.push(h.data),console.warn(h.data);break;case"decode":s._callbacks[h.id].resolve(h);break;case"error":s._callbacks[h.id].reject(h);break;default:console.error('THREE.Rhino3dmLoader: Unexpected message, "'+h.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,a){return s._taskLoad>a._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskLoad+=e,i})}_releaseTask(e,i){e._taskLoad-=e._taskCosts[i],delete e._callbacks[i],delete e._taskCosts[i]}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function tv(){let c,e,i,s;function a(k,et){const tt=k.geometry(),rt=k.attributes();let lt,pt,ft,vt,yt,Mt=tt.objectType;switch(Mt){case i.ObjectType.Curve:const xt=f(tt,100);ft={},pt={},vt={},ft.itemSize=3,ft.type="Float32Array",ft.array=[];for(let Qt=0;Qt<xt.length;Qt++)ft.array.push(xt[Qt][0]),ft.array.push(xt[Qt][1]),ft.array.push(xt[Qt][2]);pt.position=ft,vt.attributes=pt,lt={data:vt};break;case i.ObjectType.Point:const Et=tt.location;ft={};const At={};pt={},vt={},ft.itemSize=3,ft.type="Float32Array",ft.array=[Et[0],Et[1],Et[2]];const Rt=rt.drawColor(et);At.itemSize=3,At.type="Float32Array",At.array=[Rt.r/255,Rt.g/255,Rt.b/255],pt.position=ft,pt.color=At,vt.attributes=pt,lt={data:vt};break;case i.ObjectType.PointSet:case i.ObjectType.Mesh:lt=tt.toThreejsJSON();break;case i.ObjectType.Brep:const Bt=tt.faces();yt=new i.Mesh;for(let Qt=0;Qt<Bt.count;Qt++){const Wt=Bt.get(Qt),tn=Wt.getMesh(i.MeshType.Any);tn&&(yt.append(tn),tn.delete()),Wt.delete()}yt.faces().count>0&&(yt.compact(),lt=yt.toThreejsJSON(),Bt.delete()),yt.delete();break;case i.ObjectType.Extrusion:yt=tt.getMesh(i.MeshType.Any),yt&&(lt=yt.toThreejsJSON(),yt.delete());break;case i.ObjectType.TextDot:lt=h(tt);break;case i.ObjectType.Light:lt=h(tt),lt.lightStyle.name==="LightStyle_WorldLinear"&&self.postMessage({type:"warning",id:s,data:{message:`THREE.3DMLoader: No conversion exists for ${Mt.constructor.name} ${lt.lightStyle.name}`,type:"no conversion",guid:rt.id}});break;case i.ObjectType.InstanceReference:lt=h(tt),lt.xform=h(tt.xform),lt.xform.array=tt.xform.toFloatArray(!0);break;case i.ObjectType.SubD:tt.subdivide(3),yt=i.Mesh.createFromSubDControlNet(tt),yt&&(lt=yt.toThreejsJSON(),yt.delete());break;default:self.postMessage({type:"warning",id:s,data:{message:`THREE.3DMLoader: Conversion not implemented for ${Mt.constructor.name}`,type:"not implemented",guid:rt.id}})}if(lt)return pt=h(rt),pt.geometry=h(tt),rt.groupCount>0&&(pt.groupIds=rt.getGroupList()),rt.userStringCount>0&&(pt.userStrings=rt.getUserStrings()),tt.userStringCount>0&&(pt.geometry.userStrings=tt.getUserStrings()),pt.drawColor=rt.drawColor(et),Mt=Mt.constructor.name,Mt=Mt.substring(11,Mt.length),{geometry:lt,attributes:pt,objectType:Mt};self.postMessage({type:"warning",id:s,data:{message:`THREE.3DMLoader: ${Mt.constructor.name} has no associated mesh geometry.`,type:"missing mesh",guid:rt.id}})}function h(k){const et={};for(const tt in k){const rt=k[tt];typeof rt!="function"&&(typeof rt=="object"&&rt!==null&&rt.hasOwnProperty("constructor")?et[tt]={name:rt.constructor.name,value:rt.value}:et[tt]=rt)}return et}function f(k,et){let tt=et,rt=[];const lt=[];if(k instanceof i.LineCurve)return[k.pointAtStart,k.pointAtEnd];if(k instanceof i.PolylineCurve){tt=k.pointCount;for(let vt=0;vt<tt;vt++)rt.push(k.point(vt));return rt}if(k instanceof i.PolyCurve){const vt=k.segmentCount;for(let yt=0;yt<vt;yt++){const Mt=k.segmentCurve(yt),xt=f(Mt,tt);rt=rt.concat(xt),Mt.delete()}return rt}if(k instanceof i.ArcCurve&&(tt=Math.floor(k.angleDegrees/5),tt=tt<2?2:tt),k instanceof i.NurbsCurve&&k.degree===1){const vt=k.tryGetPolyline();for(let yt=0;yt<vt.count;yt++)rt.push(vt.get(yt));return vt.delete(),rt}const pt=k.domain,ft=tt-1;for(let vt=0;vt<tt;vt++){const yt=pt[0]+vt/ft*(pt[1]-pt[0]);if(yt===pt[0]||yt===pt[1]){lt.push(yt);continue}const Mt=k.tangentAt(yt),xt=k.tangentAt(lt.slice(-1)[0]),Et=Mt[0]*Mt[0]+Mt[1]*Mt[1]+Mt[2]*Mt[2],At=xt[0]*xt[0]+xt[1]*xt[1]+xt[2]*xt[2],Rt=Math.sqrt(Et*At);let Bt;if(Rt===0)Bt=Math.PI/2;else{const Qt=(Mt.x*xt.x+Mt.y*xt.y+Mt.z*xt.z)/Rt;Bt=Math.acos(Math.max(-1,Math.min(1,Qt)))}Bt<.1||lt.push(yt)}return rt=lt.map(vt=>k.pointAt(vt)),rt}onmessage=function(k){const et=k.data;switch(et.type){case"init":e=et.libraryConfig;const tt=e.wasmBinary;let rt;c=new Promise(function(pt){rt={wasmBinary:tt,onRuntimeInitialized:pt},rhino3dm(rt)}).then(()=>{i=rt});break;case"decode":s=et.id;const lt=et.buffer;c.then(()=>{try{const pt=function(ft,vt){const yt=new Uint8Array(vt),Mt=ft.File3dm.fromByteArray(yt),xt=[],Et=[],At=[],Rt=[],Bt=[],Qt=[],Wt=[],tn=Mt.objects(),pn=tn.count;for(let xn=0;xn<pn;xn++){const Cn=tn.get(xn),Fn=a(Cn,Mt);Cn.delete(),Fn&&xt.push(Fn)}for(let xn=0;xn<Mt.instanceDefinitions().count();xn++){const Cn=Mt.instanceDefinitions().get(xn),Fn=h(Cn);Fn.objectIds=Cn.getObjectIds(),xt.push({geometry:null,attributes:Fn,objectType:"InstanceDefinition"})}const yn=[ft.TextureType.Diffuse,ft.TextureType.Bump,ft.TextureType.Transparency,ft.TextureType.Opacity,ft.TextureType.Emap],En=[ft.TextureType.PBR_BaseColor,ft.TextureType.PBR_Subsurface,ft.TextureType.PBR_SubsurfaceScattering,ft.TextureType.PBR_SubsurfaceScatteringRadius,ft.TextureType.PBR_Metallic,ft.TextureType.PBR_Specular,ft.TextureType.PBR_SpecularTint,ft.TextureType.PBR_Roughness,ft.TextureType.PBR_Anisotropic,ft.TextureType.PBR_Anisotropic_Rotation,ft.TextureType.PBR_Sheen,ft.TextureType.PBR_SheenTint,ft.TextureType.PBR_Clearcoat,ft.TextureType.PBR_ClearcoatBump,ft.TextureType.PBR_ClearcoatRoughness,ft.TextureType.PBR_OpacityIor,ft.TextureType.PBR_OpacityRoughness,ft.TextureType.PBR_Emission,ft.TextureType.PBR_AmbientOcclusion,ft.TextureType.PBR_Displacement];for(let xn=0;xn<Mt.materials().count();xn++){const Cn=Mt.materials().get(xn),Fn=Cn.physicallyBased();let Tn=h(Cn);const Wn=[];for(let or=0;or<yn.length;or++){const fr=Cn.getTexture(yn[or]);if(fr){let rr=yn[or].constructor.name;rr=rr.substring(12,rr.length);const Ir={type:rr},kr=Mt.getEmbeddedFileAsBase64(fr.fileName);Ir.wrapU=fr.wrapU,Ir.wrapV=fr.wrapV,Ir.wrapW=fr.wrapW;const Br=fr.uvwTransform.toFloatArray(!0);Ir.repeat=[Br[0],Br[5]],kr?Ir.image="data:image/png;base64,"+kr:(self.postMessage({type:"warning",id:s,data:{message:`THREE.3DMLoader: Image for ${rr} texture not embedded in file.`,type:"missing resource"}}),Ir.image=null),Wn.push(Ir),fr.delete()}}if(Tn.textures=Wn,Fn.supported){for(let fr=0;fr<En.length;fr++){const rr=Cn.getTexture(En[fr]);if(rr){const Ir=Mt.getEmbeddedFileAsBase64(rr.fileName);let kr=En[fr].constructor.name;kr=kr.substring(12,kr.length);const Br={type:kr,image:"data:image/png;base64,"+Ir};Wn.push(Br),rr.delete()}}const or=h(Cn.physicallyBased());Tn=Object.assign(or,Tn)}Et.push(Tn),Cn.delete(),Fn.delete()}for(let xn=0;xn<Mt.layers().count();xn++){const Cn=Mt.layers().get(xn),Fn=h(Cn);At.push(Fn),Cn.delete()}for(let xn=0;xn<Mt.views().count();xn++){const Cn=Mt.views().get(xn),Fn=h(Cn);Rt.push(Fn),Cn.delete()}for(let xn=0;xn<Mt.namedViews().count();xn++){const Cn=Mt.namedViews().get(xn),Fn=h(Cn);Bt.push(Fn),Cn.delete()}for(let xn=0;xn<Mt.groups().count();xn++){const Cn=Mt.groups().get(xn),Fn=h(Cn);Qt.push(Fn),Cn.delete()}const wn=h(Mt.settings()),In=Mt.strings().count();for(let xn=0;xn<In;xn++)Wt.push(Mt.strings().get(xn));return Mt.delete(),{objects:xt,materials:Et,layers:At,views:Rt,namedViews:Bt,groups:Qt,strings:Wt,settings:wn}}(i,lt);self.postMessage({type:"decode",id:et.id,data:pt})}catch(pt){self.postMessage({type:"error",id:et.id,error:pt})}})}}}class VE extends Qx{constructor(e){super(e),this.setLibraryPath("https://cdn.jsdelivr.net/npm/rhino3dm@7.11.1/")}async loadAsync(e,i){return await super.loadAsync(e,i)}}class d_ extends j{constructor(){super(...arguments),this.dependencies=[Kr],this._importer=new zl(VE,["3dm"],!0)}async onAdded(e){uo.Importers.push(this._importer)}async onDispose(e){}async onRemove(e){uo.Importers.splice(uo.Importers.indexOf(this._importer),1)}}d_.PluginType="Rhino3dmLoadPlugin";class YC extends j{constructor(){super(...arguments),this.dependencies=[Kr]}async onAdded(e){const i=document.createElement("script");i.type="module",i.innerHTML=`
import { MeshoptDecoder } from 'https://cdn.jsdelivr.net/gh/zeux/meshoptimizer@master/js/meshopt_decoder.module.js'
window.MeshoptDecoder = MeshoptDecoder
`,document.head.appendChild(i),this._script=i}async onDispose(e){}async onRemove(e){this._script&&(document.head.removeChild(this._script),this._script=void 0)}}YC.PluginType="GLTFMeshOptPlugin";class QE extends d.aNw{constructor(e){super(e)}load(e,i,s,a){const h=this,f=new d.hH6(this.manager);f.setPath(this.path),f.setResponseType("arraybuffer"),f.setRequestHeader(this.requestHeader),f.setWithCredentials(this.withCredentials),f.load(e,function(k){try{i(h.parse(k))}catch(et){a?a(et):console.error(et),h.manager.itemError(e)}},s,a)}parse(e){function i(h,f,k){for(let et=0,tt=h.length;et<tt;et++)if(h[et]!==f.getUint8(k+et))return!1;return!0}const s=function(h){if(typeof h=="string"){const f=new Uint8Array(h.length);for(let k=0;k<h.length;k++)f[k]=255&h.charCodeAt(k);return f.buffer||f}return h}(e);return function(h){const f=new DataView(h);if(84+50*f.getUint32(80,!0)===f.byteLength)return!0;const k=[115,111,108,105,100];for(let et=0;et<5;et++)if(i(k,f,et))return!1;return!0}(s)?function(h){const f=new DataView(h),k=f.getUint32(80,!0);let et,tt,rt,lt,pt,ft,vt,yt,Mt=!1;for(let Rt=0;Rt<70;Rt++)f.getUint32(Rt,!1)==1129270351&&f.getUint8(Rt+4)==82&&f.getUint8(Rt+5)==61&&(Mt=!0,lt=new Float32Array(3*k*3),pt=f.getUint8(Rt+6)/255,ft=f.getUint8(Rt+7)/255,vt=f.getUint8(Rt+8)/255,yt=f.getUint8(Rt+9)/255);const xt=new d.u9r,Et=new Float32Array(3*k*3),At=new Float32Array(3*k*3);for(let Rt=0;Rt<k;Rt++){const Bt=84+50*Rt,Qt=f.getFloat32(Bt,!0),Wt=f.getFloat32(Bt+4,!0),tn=f.getFloat32(Bt+8,!0);if(Mt){const pn=f.getUint16(Bt+48,!0);32768&pn?(et=pt,tt=ft,rt=vt):(et=(31&pn)/31,tt=(pn>>5&31)/31,rt=(pn>>10&31)/31)}for(let pn=1;pn<=3;pn++){const yn=Bt+12*pn,En=3*Rt*3+3*(pn-1);Et[En]=f.getFloat32(yn,!0),Et[En+1]=f.getFloat32(yn+4,!0),Et[En+2]=f.getFloat32(yn+8,!0),At[En]=Qt,At[En+1]=Wt,At[En+2]=tn,Mt&&(lt[En]=et,lt[En+1]=tt,lt[En+2]=rt)}}return xt.setAttribute("position",new d.TlE(Et,3)),xt.setAttribute("normal",new d.TlE(At,3)),Mt&&(xt.setAttribute("color",new d.TlE(lt,3)),xt.hasColors=!0,xt.alpha=yt),xt}(s):function(h){const f=new d.u9r,k=/solid([\s\S]*?)endsolid/g,et=/facet([\s\S]*?)endfacet/g;let tt=0;const rt=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,lt=new RegExp("vertex"+rt+rt+rt,"g"),pt=new RegExp("normal"+rt+rt+rt,"g"),ft=[],vt=[],yt=new d.Pa4;let Mt,xt=0,Et=0,At=0;for(;(Mt=k.exec(h))!==null;){Et=At;const Rt=Mt[0];for(;(Mt=et.exec(Rt))!==null;){let Wt=0,tn=0;const pn=Mt[0];for(;(Mt=pt.exec(pn))!==null;)yt.x=parseFloat(Mt[1]),yt.y=parseFloat(Mt[2]),yt.z=parseFloat(Mt[3]),tn++;for(;(Mt=lt.exec(pn))!==null;)ft.push(parseFloat(Mt[1]),parseFloat(Mt[2]),parseFloat(Mt[3])),vt.push(yt.x,yt.y,yt.z),Wt++,At++;tn!==1&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+tt),Wt!==3&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+tt),tt++}const Bt=Et,Qt=At-Et;f.addGroup(Bt,Qt,xt),xt++}return f.setAttribute("position",new d.a$l(ft,3)),f.setAttribute("normal",new d.a$l(vt,3)),f}(typeof(a=e)!="string"?d.Zp0.decodeText(new Uint8Array(a)):a);var a}}class XC extends j{constructor(){super(...arguments),this.dependencies=[Kr]}async onAdded(e){this._importer||(this._importer=new zl(QE,["stl"],!0)),uo.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&uo.Importers.splice(uo.Importers.indexOf(this._importer),1),this._importer=void 0}}XC.PluginType="STLLoadPlugin";class Gx extends d.aNw{constructor(e){super(e)}load(e,i,s,a){const h=this,f=this.path===""?d.Zp0.extractUrlBase(e):this.path,k=new d.hH6(this.manager);k.setPath(this.path),k.setRequestHeader(this.requestHeader),k.setWithCredentials(this.withCredentials),k.load(e,function(et){try{i(h.parse(et,f))}catch(tt){a?a(tt):console.error(tt),h.manager.itemError(e)}},s,a)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,i){const s=e.split(`
`);let a={};const h=/\s+/,f={};for(let et=0;et<s.length;et++){let tt=s[et];if(tt=tt.trim(),tt.length===0||tt.charAt(0)==="#")continue;const rt=tt.indexOf(" ");let lt=rt>=0?tt.substring(0,rt):tt;lt=lt.toLowerCase();let pt=rt>=0?tt.substring(rt+1):"";if(pt=pt.trim(),lt==="newmtl")a={name:pt},f[pt]=a;else if(lt==="ka"||lt==="kd"||lt==="ks"||lt==="ke"){const ft=pt.split(h,3);a[lt]=[parseFloat(ft[0]),parseFloat(ft[1]),parseFloat(ft[2])]}else a[lt]=pt}const k=new fp(this.resourcePath||i,this.materialOptions);return k.setCrossOrigin(this.crossOrigin),k.setManager(this.manager),k.setMaterials(f),k}}class fp{constructor(e="",i={}){this.baseUrl=e,this.options=i,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:d.Wl3,this.wrap=this.options.wrap!==void 0?this.options.wrap:d.rpg}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const i={};for(const s in e){const a=e[s],h={};i[s]=h;for(const f in a){let k=!0,et=a[f];const tt=f.toLowerCase();switch(tt){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(et=[et[0]/255,et[1]/255,et[2]/255]),this.options&&this.options.ignoreZeroRGBs&&et[0]===0&&et[1]===0&&et[2]===0&&(k=!1)}k&&(h[tt]=et)}}return i}async preload(){for(const e in this.materialsInfo)await this.create(e)}getIndex(e){return this.nameLookup[e]}async getAsArray(){let e=0;for(const i in this.materialsInfo)this.materialsArray[e]=await this.create(i),this.nameLookup[i]=e,e++;return this.materialsArray}async create(e){return this.materials[e]===void 0&&await this.createMaterial_(e),this.materials[e]}async createMaterial_(e){const i=this,s=this.materialsInfo[e],a={name:e,side:this.side};async function h(et,tt){if(a[et])return;const rt=i.getTextureParams(tt,a);return new Promise((lt,pt)=>{let ft=!1,vt=()=>!ft&&(ft=!0)&&lt();const yt=i.loadTexture((Mt=i.baseUrl,typeof(xt=rt.url)!="string"||xt===""?"":/^https?:\/\//i.test(xt)?xt:Mt+xt),void 0,Et=>{a[et]=Et,vt()},void 0,vt);var Mt,xt;setTimeout(vt,50),yt.repeat.copy(rt.scale),yt.offset.copy(rt.offset),yt.wrapS=i.wrap,yt.wrapT=i.wrap})}const f=Array.from(Object.keys(s||{}));let k=f.includes("d")||f.includes("D");for(const et of f){const tt=s[et];let rt;if(tt!=="")switch(et.toLowerCase()){case"kd":a.color=new d.Ilk().fromArray(tt);break;case"ks":a.specular=new d.Ilk().fromArray(tt);break;case"ke":a.emissive=new d.Ilk().fromArray(tt);break;case"map_kd":await h("map",tt);break;case"map_ks":await h("specularMap",tt);break;case"map_ke":await h("emissiveMap",tt);break;case"norm":await h("normalMap",tt);break;case"map_bump":case"bump":await h("bumpMap",tt);break;case"map_d":await h("alphaMap",tt),a.transparent=!0;break;case"ns":a.shininess=parseFloat(tt);break;case"d":rt=parseFloat(tt),rt<1&&(a.opacity=rt,a.transparent=!0);break;case"tr":if(k)break;rt=parseFloat(tt),this.options&&this.options.invertTrProperty&&(rt=1-rt),rt>0&&(a.opacity=1-rt,a.transparent=!0)}}return this.materials[e]=new d.xoR(a),this.materials[e]}getTextureParams(e,i){const s={scale:new d.FM8(1,1),offset:new d.FM8(0,0)},a=e.split(/\s+/);let h;return h=a.indexOf("-bm"),h>=0&&(i.bumpScale=parseFloat(a[h+1]),a.splice(h,2)),h=a.indexOf("-s"),h>=0&&(s.scale.set(parseFloat(a[h+1]),parseFloat(a[h+2])),a.splice(h,4)),h=a.indexOf("-o"),h>=0&&(s.offset.set(parseFloat(a[h+1]),parseFloat(a[h+2])),a.splice(h,4)),s.url=a.join(" ").trim(),s}loadTexture(e,i,s,a,h){const f=this.manager!==void 0?this.manager:d.tEQ;let k=f.getHandler(e);k===null&&(k=new d.dpR(f)),k.setCrossOrigin&&k.setCrossOrigin(this.crossOrigin);const et=k.load(e,s,a,h);return i!==void 0&&(et.mapping=i),et}}const Hx=/^[og]\s*(.+)?/,kv=/^mtllib /,qs=/^usemtl /,ip=/^usemap /,GE=new d.Pa4,KC=new d.Pa4,gI=new d.Pa4,Wx=new d.Pa4,nv=new d.Pa4;function xP(){const c={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,i){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=e,void(this.object.fromDeclaration=i!==!1);const s=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:i!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(a,h){const f=this._finalize(!1);f&&(f.inherited||f.groupCount<=0)&&this.materials.splice(f.index,1);const k={index:this.materials.length,name:a||"",mtllib:Array.isArray(h)&&h.length>0?h[h.length-1]:"",smooth:f!==void 0?f.smooth:this.smooth,groupStart:f!==void 0?f.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(et){const tt={index:typeof et=="number"?et:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return tt.clone=this.clone.bind(tt),tt}};return this.materials.push(k),k},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(a){const h=this.currentMaterial();if(h&&h.groupEnd===-1&&(h.groupEnd=this.geometry.vertices.length/3,h.groupCount=h.groupEnd-h.groupStart,h.inherited=!1),a&&this.materials.length>1)for(let f=this.materials.length-1;f>=0;f--)this.materials[f].groupCount<=0&&this.materials.splice(f,1);return a&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),h}},s&&s.name&&typeof s.clone=="function"){const a=s.clone(0);a.inherited=!0,this.object.materials.push(a)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,i){const s=parseInt(e,10);return 3*(s>=0?s-1:s+i/3)},parseNormalIndex:function(e,i){const s=parseInt(e,10);return 3*(s>=0?s-1:s+i/3)},parseUVIndex:function(e,i){const s=parseInt(e,10);return 2*(s>=0?s-1:s+i/2)},addVertex:function(e,i,s){const a=this.vertices,h=this.object.geometry.vertices;h.push(a[e+0],a[e+1],a[e+2]),h.push(a[i+0],a[i+1],a[i+2]),h.push(a[s+0],a[s+1],a[s+2])},addVertexPoint:function(e){const i=this.vertices;this.object.geometry.vertices.push(i[e+0],i[e+1],i[e+2])},addVertexLine:function(e){const i=this.vertices;this.object.geometry.vertices.push(i[e+0],i[e+1],i[e+2])},addNormal:function(e,i,s){const a=this.normals,h=this.object.geometry.normals;h.push(a[e+0],a[e+1],a[e+2]),h.push(a[i+0],a[i+1],a[i+2]),h.push(a[s+0],a[s+1],a[s+2])},addFaceNormal:function(e,i,s){const a=this.vertices,h=this.object.geometry.normals;GE.fromArray(a,e),KC.fromArray(a,i),gI.fromArray(a,s),nv.subVectors(gI,KC),Wx.subVectors(GE,KC),nv.cross(Wx),nv.normalize(),h.push(nv.x,nv.y,nv.z),h.push(nv.x,nv.y,nv.z),h.push(nv.x,nv.y,nv.z)},addColor:function(e,i,s){const a=this.colors,h=this.object.geometry.colors;a[e]!==void 0&&h.push(a[e+0],a[e+1],a[e+2]),a[i]!==void 0&&h.push(a[i+0],a[i+1],a[i+2]),a[s]!==void 0&&h.push(a[s+0],a[s+1],a[s+2])},addUV:function(e,i,s){const a=this.uvs,h=this.object.geometry.uvs;h.push(a[e+0],a[e+1]),h.push(a[i+0],a[i+1]),h.push(a[s+0],a[s+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const i=this.uvs;this.object.geometry.uvs.push(i[e+0],i[e+1])},addFace:function(e,i,s,a,h,f,k,et,tt){const rt=this.vertices.length;let lt=this.parseVertexIndex(e,rt),pt=this.parseVertexIndex(i,rt),ft=this.parseVertexIndex(s,rt);if(this.addVertex(lt,pt,ft),this.addColor(lt,pt,ft),k!==void 0&&k!==""){const vt=this.normals.length;lt=this.parseNormalIndex(k,vt),pt=this.parseNormalIndex(et,vt),ft=this.parseNormalIndex(tt,vt),this.addNormal(lt,pt,ft)}else this.addFaceNormal(lt,pt,ft);if(a!==void 0&&a!==""){const vt=this.uvs.length;lt=this.parseUVIndex(a,vt),pt=this.parseUVIndex(h,vt),ft=this.parseUVIndex(f,vt),this.addUV(lt,pt,ft),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const i=this.vertices.length;for(let s=0,a=e.length;s<a;s++){const h=this.parseVertexIndex(e[s],i);this.addVertexPoint(h),this.addColor(h)}},addLineGeometry:function(e,i){this.object.geometry.type="Line";const s=this.vertices.length,a=this.uvs.length;for(let h=0,f=e.length;h<f;h++)this.addVertexLine(this.parseVertexIndex(e[h],s));for(let h=0,f=i.length;h<f;h++)this.addUVLine(this.parseUVIndex(i[h],a))}};return c.startObject("",!1),c}class vI extends d.aNw{constructor(e){super(e),this.materials=null}load(e,i,s,a){const h=this,f=new d.hH6(this.manager);f.setPath(this.path),f.setRequestHeader(this.requestHeader),f.setWithCredentials(this.withCredentials),f.load(e,async function(k){try{i(await h.parse(k))}catch(et){a?a(et):console.error(et),h.manager.itemError(e)}},s,a)}setMaterials(e){return this.materials=e,this}async parse(e){const i=new xP;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const s=e.split(`
`);let a="",h="",f=0,k=[];const et=typeof"".trimLeft=="function";for(let rt=0,lt=s.length;rt<lt;rt++)if(a=s[rt],a=et?a.trimLeft():a.trim(),f=a.length,f!==0&&(h=a.charAt(0),h!=="#"))if(h==="v"){const pt=a.split(/\s+/);switch(pt[0]){case"v":i.vertices.push(parseFloat(pt[1]),parseFloat(pt[2]),parseFloat(pt[3])),pt.length>=7?i.colors.push(parseFloat(pt[4]),parseFloat(pt[5]),parseFloat(pt[6])):i.colors.push(void 0,void 0,void 0);break;case"vn":i.normals.push(parseFloat(pt[1]),parseFloat(pt[2]),parseFloat(pt[3]));break;case"vt":i.uvs.push(parseFloat(pt[1]),parseFloat(pt[2]))}}else if(h==="f"){const pt=a.substr(1).trim().split(/\s+/),ft=[];for(let yt=0,Mt=pt.length;yt<Mt;yt++){const xt=pt[yt];if(xt.length>0){const Et=xt.split("/");ft.push(Et)}}const vt=ft[0];for(let yt=1,Mt=ft.length-1;yt<Mt;yt++){const xt=ft[yt],Et=ft[yt+1];i.addFace(vt[0],xt[0],Et[0],vt[1],xt[1],Et[1],vt[2],xt[2],Et[2])}}else if(h==="l"){const pt=a.substring(1).trim().split(" ");let ft=[];const vt=[];if(a.indexOf("/")===-1)ft=pt;else for(let yt=0,Mt=pt.length;yt<Mt;yt++){const xt=pt[yt].split("/");xt[0]!==""&&ft.push(xt[0]),xt[1]!==""&&vt.push(xt[1])}i.addLineGeometry(ft,vt)}else if(h==="p"){const pt=a.substr(1).trim().split(" ");i.addPointGeometry(pt)}else if((k=Hx.exec(a))!==null){const pt=(" "+k[0].substr(1).trim()).substr(1);i.startObject(pt)}else if(qs.test(a))i.object.startMaterial(a.substring(7).trim(),i.materialLibraries);else if(kv.test(a)){i.materialLibraries.push(a.substring(7).trim());const pt=a.substring(7).trim(),ft=this.manager.getHandler(pt);if(ft){const vt=await ft.loadAsync(pt).catch(yt=>{console.warn(yt)});vt&&this.setMaterials(vt)}else console.warn("OBJLoader2: Set MTLLoader to loading manager to load materials.")}else if(ip.test(a))console.warn('OBJLoader2: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(h==="s"){if(k=a.split(" "),k.length>1){const ft=k[1].trim().toLowerCase();i.object.smooth=ft!=="0"&&ft!=="off"}else i.object.smooth=!0;const pt=i.object.currentMaterial();pt&&(pt.smooth=i.object.smooth)}else{if(a==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+a+'"')}i.finalize();const tt=new d.ZAu;if(tt.materialLibraries=[].concat(i.materialLibraries),!(i.objects.length===1&&i.objects[0].geometry.vertices.length===0))for(let rt=0,lt=i.objects.length;rt<lt;rt++){const pt=i.objects[rt],ft=pt.geometry,vt=pt.materials,yt=ft.type==="Line",Mt=ft.type==="Points";let xt=!1;if(ft.vertices.length===0)continue;const Et=new d.u9r;Et.setAttribute("position",new d.a$l(ft.vertices,3)),ft.normals.length>0&&Et.setAttribute("normal",new d.a$l(ft.normals,3)),ft.colors.length>0&&(xt=!0,Et.setAttribute("color",new d.a$l(ft.colors,3))),ft.hasUVIndices===!0&&Et.setAttribute("uv",new d.a$l(ft.uvs,2));const At=[];for(let Bt=0,Qt=vt.length;Bt<Qt;Bt++){const Wt=vt[Bt],tn=Wt.name+"_"+Wt.smooth+"_"+xt;let pn=i.materials[tn];if(this.materials!==null)if(pn=await this.materials.create(Wt.name),!yt||!pn||pn instanceof d.nls){if(Mt&&pn&&!(pn instanceof d.UY4)){const yn=new d.UY4({size:10,sizeAttenuation:!1});d.F5T.prototype.copy.call(yn,pn),yn.color.copy(pn.color),yn.map=pn.map,pn=yn}}else{const yn=new d.nls;d.F5T.prototype.copy.call(yn,pn),yn.color.copy(pn.color),pn=yn}pn===void 0&&(pn=yt?new d.nls:Mt?new d.UY4({size:1,sizeAttenuation:!1}):new d.xoR,pn.name=Wt.name,pn.flatShading=!Wt.smooth,pn.vertexColors=xt,i.materials[tn]=pn),At.push(pn)}let Rt;if(At.length>1){for(let Bt=0,Qt=vt.length;Bt<Qt;Bt++){const Wt=vt[Bt];Et.addGroup(Wt.groupStart,Wt.groupCount,Bt)}Rt=yt?new d.ejS(Et,At):Mt?new d.woe(Et,At):new d.Kj0(Et,At)}else Rt=yt?new d.ejS(Et,At[0]):Mt?new d.woe(Et,At[0]):new d.Kj0(Et,At[0]);Rt.name=pt.name,tt.add(Rt)}else if(i.vertices.length>0){const rt=new d.UY4({size:1,sizeAttenuation:!1}),lt=new d.u9r;lt.setAttribute("position",new d.a$l(i.vertices,3)),i.colors.length>0&&i.colors[0]!==void 0&&(lt.setAttribute("color",new d.a$l(i.colors,3)),rt.vertexColors=!0);const pt=new d.woe(lt,rt);tt.add(pt)}return tt}}class $C extends j{constructor(){super(...arguments),this.dependencies=[Kr],this._importer1=new zl(vI,["obj"],!0),this._importer2=new zl(Gx,["mtl"],!1)}async onAdded(e){uo.Importers.push(this._importer1),uo.Importers.push(this._importer2)}async onDispose(e){}async onRemove(e){uo.Importers.splice(uo.Importers.indexOf(this._importer1),1),uo.Importers.splice(uo.Importers.indexOf(this._importer2),1)}}$C.PluginType="ObjMtlLoadPlugin";class bP extends d.DqL{constructor(e){super(e)}parse(e,i){const s=new EP(e,1);return{mipmaps:s.mipmaps(i),width:s.pixelWidth,height:s.pixelHeight,format:s.glInternalFormat,isCubemap:s.numberOfFaces===6,mipmapCount:s.numberOfMipmapLevels}}}class EP{constructor(e,i){this.arrayBuffer=e;const s=new Uint8Array(this.arrayBuffer,0,12);if(s[0]!==171||s[1]!==75||s[2]!==84||s[3]!==88||s[4]!==32||s[5]!==49||s[6]!==49||s[7]!==187||s[8]!==13||s[9]!==10||s[10]!==26||s[11]!==10)return void console.error("texture missing KTX identifier");const a=Uint32Array.BYTES_PER_ELEMENT,h=new DataView(this.arrayBuffer,12,13*a),f=h.getUint32(0,!0)===67305985;this.glType=h.getUint32(1*a,f),this.glTypeSize=h.getUint32(2*a,f),this.glFormat=h.getUint32(3*a,f),this.glInternalFormat=h.getUint32(4*a,f),this.glBaseInternalFormat=h.getUint32(5*a,f),this.pixelWidth=h.getUint32(6*a,f),this.pixelHeight=h.getUint32(7*a,f),this.pixelDepth=h.getUint32(8*a,f),this.numberOfArrayElements=h.getUint32(9*a,f),this.numberOfFaces=h.getUint32(10*a,f),this.numberOfMipmapLevels=h.getUint32(11*a,f),this.bytesOfKeyValueData=h.getUint32(12*a,f),this.glType===0?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),this.pixelHeight!==0&&this.pixelDepth===0?this.numberOfArrayElements===0?this.numberOfFaces===i?this.loadType=0:console.warn("number of faces expected"+i+", but found "+this.numberOfFaces):console.warn("texture arrays not currently supported"):console.warn("only 2D textures currently supported")):console.warn("only compressed formats currently supported")}mipmaps(e){const i=[];let s=64+this.bytesOfKeyValueData,a=this.pixelWidth,h=this.pixelHeight;const f=e?this.numberOfMipmapLevels:1;for(let k=0;k<f;k++){const et=new Int32Array(this.arrayBuffer,s,1)[0];s+=4;for(let tt=0;tt<this.numberOfFaces;tt++){const rt=new Uint8Array(this.arrayBuffer,s,et);i.push({data:rt,width:a,height:h}),s+=et,s+=3-(et+3)%4}a=Math.max(1,.5*a),h=Math.max(1,.5*h)}return i}}class HE extends j{constructor(){super(...arguments),this.dependencies=[Kr]}async onAdded(e){this._importer||(this._importer=new zl(bP,["ktx"],!1)),uo.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&uo.Importers.splice(uo.Importers.indexOf(this._importer),1),this._importer=void 0}}HE.PluginType="KTXLoadPlugin";class SP extends d.hH6{constructor(e){super(e),this.responseType="blob"}}class $a extends d.hH6{constructor(e){super(e),this.responseType="blob"}load(e,i,s,a){return super.load(e,h=>{try{i==null||i(_u(h))}catch(f){a==null||a(f)}},s,a)}}class _I{async parseAsync(e,i){var s;return new Blob([JSON.stringify(e,null,(s=i.jsonSpaces)!==null&&s!==void 0?s:2)],{type:"application/json"})}}class p_{async parseAsync(e,i){return new Blob([e],{type:"text/plain"})}}class f_{constructor(){this.pluginCallbacks=[],this.register(function(e){return new Gp(e)}),this.register(function(e){return new qx(e)}),this.register(function(e){return new CP(e)}),this.register(function(e){return new KO(e)}),this.register(function(e){return new $O(e)}),this.register(function(e){return new yI(e)}),this.register(function(e){return new JO(e)}),this.register(function(e){return new XO(e)}),this.register(function(e){return new ZO(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,i,s,a,h){const f=h||new JC,k=[];for(let et=0,tt=this.pluginCallbacks.length;et<tt;et++)k.push(this.pluginCallbacks[et](f));f.setPlugins(k),f.write(e,i,a).catch(s)}parseAsync(e,i){const s=this;return new Promise(function(a,h){s.parse(e,a,h,i)})}}const WE=5121,tA=5123,Qp={};Qp[d.TyD]=9728,Qp[d.YLQ]=9984,Qp[d.aH4]=9986,Qp[d.wem]=9729,Qp[d.qyh]=9985,Qp[d.D1R]=9987,Qp[d.uWy]=33071,Qp[d.rpg]=10497,Qp[d.OoA]=33648;const mp={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"};function Bv(c,e){return c.length===e.length&&c.every(function(i,s){return i===e[s]})}function qE(c){return 4*Math.ceil(c/4)}function rv(c,e=0){const i=qE(c.byteLength);if(i!==c.byteLength){const s=new Uint8Array(i);if(s.set(new Uint8Array(c)),e!==0)for(let a=c.byteLength;a<i;a++)s[a]=e;return s.buffer}return c}function iv(c,e){if(c.toBlob!==void 0)return new Promise(s=>c.toBlob(s,e));let i;return e==="image/jpeg"?i=.92:e==="image/webp"&&(i=.8),c.convertToBlob({type:e,quality:i})}class JC{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,i,s){this.options=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},s),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const a=this,h=a.buffers,f=a.json;s=a.options;const k=a.extensionsUsed,et=new Blob(h,{type:"application/octet-stream"}),tt=Object.keys(k);if(tt.length>0&&(f.extensionsUsed=tt),f.buffers&&f.buffers.length>0&&(f.buffers[0].byteLength=et.size),s.binary===!0){const rt=new FileReader;rt.readAsArrayBuffer(et),rt.onloadend=function(){const lt=rv(rt.result),pt=new DataView(new ArrayBuffer(8));pt.setUint32(0,lt.byteLength,!0),pt.setUint32(4,5130562,!0);const ft=rv((vt=JSON.stringify(f),new TextEncoder().encode(vt).buffer),32);var vt;const yt=new DataView(new ArrayBuffer(8));yt.setUint32(0,ft.byteLength,!0),yt.setUint32(4,1313821514,!0);const Mt=new ArrayBuffer(12),xt=new DataView(Mt);xt.setUint32(0,1179937895,!0),xt.setUint32(4,2,!0);const Et=12+yt.byteLength+ft.byteLength+pt.byteLength+lt.byteLength;xt.setUint32(8,Et,!0);const At=new Blob([Mt,yt,ft,pt,lt],{type:"application/octet-stream"}),Rt=new FileReader;Rt.readAsArrayBuffer(At),Rt.onloadend=function(){i(Rt.result)}}}else if(f.buffers&&f.buffers.length>0){const rt=new FileReader;rt.readAsDataURL(et),rt.onloadend=function(){const lt=rt.result;f.buffers[0].uri=lt,i(f)}}else i(f)}serializeUserData(e,i){if(Object.keys(e.userData).length===0)return;const s=this.options,a=this.extensionsUsed;try{const h=JSON.parse(JSON.stringify(e.userData));if(s.includeCustomExtensions&&h.gltfExtensions){i.extensions===void 0&&(i.extensions={});for(const f in h.gltfExtensions)i.extensions[f]=h.gltfExtensions[f],a[f]=!0;delete h.gltfExtensions}Object.keys(h).length>0&&(i.extras=h)}catch(h){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+h.message),console.warn({...e.userData})}}getUID(e,i=!1){if(this.uids.has(e)===!1){const s=new Map;s.set(!0,this.uid++),s.set(!1,this.uid++),this.uids.set(e,s)}return this.uids.get(e).get(i)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const i=new d.Pa4;for(let s=0,a=e.count;s<a;s++)if(Math.abs(i.fromBufferAttribute(e,s).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const i=this.cache;if(i.attributesNormalized.has(e))return i.attributesNormalized.get(e);const s=e.clone(),a=new d.Pa4;for(let h=0,f=s.count;h<f;h++)a.fromBufferAttribute(s,h),a.x===0&&a.y===0&&a.z===0?a.setX(1):a.normalize(),s.setXYZ(h,a.x,a.y,a.z);return i.attributesNormalized.set(e,s),s}applyTextureTransform(e,i){let s=!1;const a={};i.offset.x===0&&i.offset.y===0||(a.offset=i.offset.toArray(),s=!0),i.rotation!==0&&(a.rotation=i.rotation,s=!0),i.repeat.x===1&&i.repeat.y===1||(a.scale=i.repeat.toArray(),s=!0),s&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=a,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,i){if(e===i)return e;function s(pt){return pt.encoding===d.knz?function(ft){return ft<.04045?.0773993808*ft:Math.pow(.9478672986*ft+.0521327014,2.4)}:function(ft){return ft}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures.");const a=e?e.image:void 0,h=i?i.image:void 0,f=Math.max(a?a.width:0,h?h.width:0),k=Math.max(a?a.height:0,h?h.height:0),et=document.createElement("canvas");et.width=f,et.height=k;const tt=et.getContext("2d");tt.fillStyle="#00ffff",tt.fillRect(0,0,f,k);const rt=tt.getImageData(0,0,f,k);if(a){tt.drawImage(a,0,0,f,k);const pt=s(e),ft=tt.getImageData(0,0,f,k).data;for(let vt=2;vt<ft.length;vt+=4)rt.data[vt]=256*pt(ft[vt]/256)}if(h){tt.drawImage(h,0,0,f,k);const pt=s(i),ft=tt.getImageData(0,0,f,k).data;for(let vt=1;vt<ft.length;vt+=4)rt.data[vt]=256*pt(ft[vt]/256)}tt.putImageData(rt,0,0);const lt=(e||i).clone();return lt.source=new d.Hw6(et),lt.encoding=d.rnI,lt}processBuffer(e){const i=this.json,s=this.buffers;return i.buffers||(i.buffers=[{byteLength:0}]),s.push(e),0}processBufferView(e,i,s,a,h){const f=this.json;let k;f.bufferViews||(f.bufferViews=[]),k=i===WE?1:i===tA?2:4;const et=qE(a*e.itemSize*k),tt=new DataView(new ArrayBuffer(et));let rt=0;for(let pt=s;pt<s+a;pt++)for(let ft=0;ft<e.itemSize;ft++){let vt;e.itemSize>4?vt=e.array[pt*e.itemSize+ft]:ft===0?vt=e.getX(pt):ft===1?vt=e.getY(pt):ft===2?vt=e.getZ(pt):ft===3&&(vt=e.getW(pt)),i===5126?tt.setFloat32(rt,vt,!0):i===5125?tt.setUint32(rt,vt,!0):i===tA?tt.setUint16(rt,vt,!0):i===WE&&tt.setUint8(rt,vt),rt+=k}const lt={buffer:this.processBuffer(tt.buffer),byteOffset:this.byteOffset,byteLength:et};return h!==void 0&&(lt.target=h),h===34962&&(lt.byteStride=e.itemSize*k),this.byteOffset+=et,f.bufferViews.push(lt),{id:f.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const i=this,s=i.json;return s.bufferViews||(s.bufferViews=[]),new Promise(function(a){const h=new FileReader;h.readAsArrayBuffer(e),h.onloadend=function(){const f=rv(h.result),k={buffer:i.processBuffer(f),byteOffset:i.byteOffset,byteLength:f.byteLength};i.byteOffset+=f.byteLength,a(s.bufferViews.push(k)-1)}})}processAccessor(e,i,s,a){const h=this.options,f=this.json;let k;if(e.array.constructor===Float32Array)k=5126;else if(e.array.constructor===Uint32Array)k=5125;else if(e.array.constructor===Uint16Array)k=tA;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");k=WE}if(s===void 0&&(s=0),a===void 0&&(a=e.count),h.truncateDrawRange&&i!==void 0&&i.index===null){const pt=s+a,ft=i.drawRange.count===1/0?e.count:i.drawRange.start+i.drawRange.count;s=Math.max(s,i.drawRange.start),a=Math.min(pt,ft)-s,a<0&&(a=0)}if(a===0)return null;const et=function(pt,ft,vt){const yt={min:new Array(pt.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(pt.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let Mt=ft;Mt<ft+vt;Mt++)for(let xt=0;xt<pt.itemSize;xt++){let Et;pt.itemSize>4?Et=pt.array[Mt*pt.itemSize+xt]:xt===0?Et=pt.getX(Mt):xt===1?Et=pt.getY(Mt):xt===2?Et=pt.getZ(Mt):xt===3&&(Et=pt.getW(Mt)),yt.min[xt]=Math.min(yt.min[xt],Et),yt.max[xt]=Math.max(yt.max[xt],Et)}return yt}(e,s,a);let tt;i!==void 0&&(tt=e===i.index?34963:34962);const rt=this.processBufferView(e,k,s,a,tt),lt={bufferView:rt.id,byteOffset:rt.byteOffset,componentType:k,count:a,max:et.max,min:et.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[e.itemSize]};return f.accessors||(f.accessors=[]),f.accessors.push(lt)-1}processImage(e,i,s,a="image/png"){const h=this,f=h.cache,k=h.json,et=h.options,tt=h.pending;f.images.has(e)||f.images.set(e,{});const rt=f.images.get(e),lt=a+":flipY/"+s.toString();if(rt[lt]!==void 0)return rt[lt];k.images||(k.images=[]);const pt={mimeType:a},ft=typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas");ft.width=Math.min(e.width,et.maxTextureSize),ft.height=Math.min(e.height,et.maxTextureSize);const vt=ft.getContext("2d");if(s===!0&&(vt.translate(0,ft.height),vt.scale(1,-1)),e.data!==void 0){i!==d.wk1&&console.error("GLTFExporter: Only RGBAFormat is supported."),(e.width>et.maxTextureSize||e.height>et.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const Mt=new Uint8ClampedArray(e.height*e.width*4);for(let xt=0;xt<Mt.length;xt+=4)Mt[xt+0]=e.data[xt+0],Mt[xt+1]=e.data[xt+1],Mt[xt+2]=e.data[xt+2],Mt[xt+3]=e.data[xt+3];vt.putImageData(new ImageData(Mt,e.width,e.height),0,0)}else vt.drawImage(e,0,0,ft.width,ft.height);et.binary===!0?tt.push(iv(ft,a).then(Mt=>h.processBufferViewImage(Mt)).then(Mt=>{pt.bufferView=Mt})):ft.toDataURL!==void 0?pt.uri=ft.toDataURL(a):tt.push(iv(ft,a).then(Mt=>new FileReader().readAsDataURL(Mt)).then(Mt=>{pt.uri=Mt}));const yt=k.images.push(pt)-1;return rt[lt]=yt,yt}processSampler(e){const i=this.json;i.samplers||(i.samplers=[]);const s={magFilter:Qp[e.magFilter],minFilter:Qp[e.minFilter],wrapS:Qp[e.wrapS],wrapT:Qp[e.wrapT]};return i.samplers.push(s)-1}processTexture(e){const i=this.cache,s=this.json;if(i.textures.has(e))return i.textures.get(e);s.textures||(s.textures=[]);let a=e.userData.mimeType;a==="image/webp"&&(a="image/png"),a==="image/jpg"&&(a="image/jpeg");const h=["image/jpeg","image/png"];a&&!h.includes(a)&&console.error("GLTFExporter: Unsupported mime type: "+a+". Cannot export texture.",e);const f={sampler:this.processSampler(e),source:!a||h.includes(a)?this.processImage(e.image,e.format,e.flipY,a):null};e.name&&(f.name=e.name),this._invokeAll(function(et){et.writeTexture&&et.writeTexture(e,f)});const k=s.textures.push(f)-1;return i.textures.set(e,k),k}processMaterial(e){const i=this.cache,s=this.json;if(i.materials.has(e))return i.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;s.materials||(s.materials=[]);const a={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const h=e.color.toArray().concat([e.opacity]);if(Bv(h,[1,1,1,1])||(a.pbrMetallicRoughness.baseColorFactor=h),e.isMeshStandardMaterial?(a.pbrMetallicRoughness.metallicFactor=e.metalness,a.pbrMetallicRoughness.roughnessFactor=e.roughness):(a.pbrMetallicRoughness.metallicFactor=.5,a.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const k=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),et={index:this.processTexture(k)};this.applyTextureTransform(et,k),a.pbrMetallicRoughness.metallicRoughnessTexture=et}if(e.map){const k={index:this.processTexture(e.map)};this.applyTextureTransform(k,e.map),a.pbrMetallicRoughness.baseColorTexture=k}if(e.emissive){const k=e.emissive.clone().multiplyScalar(e.emissiveIntensity),et=Math.max(k.r,k.g,k.b);if(et>1&&(k.multiplyScalar(1/et),console.warn("THREE.GLTFExporter: Some emissive components exceed 1; emissive has been limited")),et>0&&(a.emissiveFactor=k.toArray()),e.emissiveMap){const tt={index:this.processTexture(e.emissiveMap)};this.applyTextureTransform(tt,e.emissiveMap),a.emissiveTexture=tt}}if(e.normalMap){const k={index:this.processTexture(e.normalMap)};e.normalScale&&e.normalScale.x!==1&&(k.scale=e.normalScale.x),this.applyTextureTransform(k,e.normalMap),a.normalTexture=k}if(e.aoMap){const k={index:this.processTexture(e.aoMap),texCoord:1};e.aoMapIntensity!==1&&(k.strength=e.aoMapIntensity),this.applyTextureTransform(k,e.aoMap),a.occlusionTexture=k}e.transparent?a.alphaMode="BLEND":e.alphaTest>0&&(a.alphaMode="MASK",a.alphaCutoff=e.alphaTest),e.side===d.ehD&&(a.doubleSided=!0),e.name!==""&&(a.name=e.name),this.serializeUserData(e,a),this._invokeAll(function(k){k.writeMaterial&&k.writeMaterial(e,a)});const f=s.materials.push(a)-1;return i.materials.set(e,f),f}processMesh(e){const i=this.cache,s=this.json,a=[e.geometry.uuid];if(Array.isArray(e.material))for(let At=0,Rt=e.material.length;At<Rt;At++)a.push(e.material[At].uuid);else a.push(e.material.uuid);const h=a.join(":");if(i.meshes.has(h))return i.meshes.get(h);const f=e.geometry;let k;k=e.isLineSegments?1:e.isLineLoop?2:e.isLine?3:e.isPoints?0:e.material.wireframe?1:4;const et={},tt={},rt=[],lt=[],pt={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},ft=f.getAttribute("normal");ft===void 0||this.isNormalizedNormalAttribute(ft)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),f.setAttribute("normal",this.createNormalizedNormalAttribute(ft)));let vt=null;for(let At in f.attributes){if(At.slice(0,5)==="morph")continue;const Rt=f.attributes[At];if(At=pt[At]||At.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(At)||(At="_"+At),i.attributes.has(this.getUID(Rt))){tt[At]=i.attributes.get(this.getUID(Rt));continue}vt=null;const Bt=Rt.array;At!=="JOINTS_0"||Bt instanceof Uint16Array||Bt instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),vt=new d.TlE(new Uint16Array(Bt),Rt.itemSize,Rt.normalized));const Qt=this.processAccessor(vt||Rt,f);Qt!==null&&(tt[At]=Qt,i.attributes.set(this.getUID(Rt),Qt))}if(ft!==void 0&&f.setAttribute("normal",ft),Object.keys(tt).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const At=[],Rt=[],Bt={};if(e.morphTargetDictionary!==void 0)for(const Qt in e.morphTargetDictionary)Bt[e.morphTargetDictionary[Qt]]=Qt;for(let Qt=0;Qt<e.morphTargetInfluences.length;++Qt){const Wt={};let tn=!1;for(const pn in f.morphAttributes){if(pn!=="position"&&pn!=="normal"){tn||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),tn=!0);continue}const yn=f.morphAttributes[pn][Qt],En=pn.toUpperCase(),wn=f.attributes[pn];if(i.attributes.has(this.getUID(yn,!0))){Wt[En]=i.attributes.get(this.getUID(yn,!0));continue}const In=yn.clone();if(!f.morphTargetsRelative)for(let xn=0,Cn=yn.count;xn<Cn;xn++)In.setXYZ(xn,yn.getX(xn)-wn.getX(xn),yn.getY(xn)-wn.getY(xn),yn.getZ(xn)-wn.getZ(xn));Wt[En]=this.processAccessor(In,f),i.attributes.set(this.getUID(wn,!0),Wt[En])}lt.push(Wt),At.push(e.morphTargetInfluences[Qt]),e.morphTargetDictionary!==void 0&&Rt.push(Bt[Qt])}et.weights=At,Rt.length>0&&(et.extras={},et.extras.targetNames=Rt)}const yt=Array.isArray(e.material);if(yt&&f.groups.length===0)return null;const Mt=yt?e.material:[e.material],xt=yt?f.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let At=0,Rt=xt.length;At<Rt;At++){const Bt={mode:k,attributes:tt};if(this.serializeUserData(f,Bt),lt.length>0&&(Bt.targets=lt),f.index!==null){let Wt=this.getUID(f.index);xt[At].start===void 0&&xt[At].count===void 0||(Wt+=":"+xt[At].start+":"+xt[At].count),i.attributes.has(Wt)?Bt.indices=i.attributes.get(Wt):(Bt.indices=this.processAccessor(f.index,f,xt[At].start,xt[At].count),i.attributes.set(Wt,Bt.indices)),Bt.indices===null&&delete Bt.indices}const Qt=this.processMaterial(Mt[xt[At].materialIndex]);Qt!==null&&(Bt.material=Qt),rt.push(Bt)}et.primitives=rt,s.meshes||(s.meshes=[]),this._invokeAll(function(At){At.writeMesh&&At.writeMesh(e,et)});const Et=s.meshes.push(et)-1;return i.meshes.set(h,Et),Et}processCamera(e){const i=this.json;i.cameras||(i.cameras=[]);const s=e.isOrthographicCamera,a={type:s?"orthographic":"perspective"};return s?a.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:a.perspective={aspectRatio:e.aspect,yfov:d.M8C.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(a.name=e.type),i.cameras.push(a)-1}processAnimation(e,i){const s=this.json,a=this.nodeMap;s.animations||(s.animations=[]);const h=(e=f_.Utils.mergeMorphTargetTracks(e.clone(),i)).tracks,f=[],k=[];for(let et=0;et<h.length;++et){const tt=h[et],rt=d.iUV.parseTrackName(tt.name);let lt=d.iUV.findNode(i,rt.nodeName);const pt=mp[rt.propertyName];if(rt.objectName==="bones"&&(lt=lt.isSkinnedMesh===!0?lt.skeleton.getBoneByName(rt.objectIndex):void 0),!lt||!pt)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',tt.name),null;const ft=1;let vt,yt=tt.values.length/tt.times.length;pt===mp.morphTargetInfluences&&(yt/=lt.morphTargetInfluences.length),tt.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(vt="CUBICSPLINE",yt/=3):vt=tt.getInterpolation()===d.Syv?"STEP":"LINEAR",k.push({input:this.processAccessor(new d.TlE(tt.times,ft)),output:this.processAccessor(new d.TlE(tt.values,yt)),interpolation:vt}),f.push({sampler:k.length-1,target:{node:a.get(lt),path:pt}})}return s.animations.push({name:e.name||"clip_"+s.animations.length,samplers:k,channels:f}),s.animations.length-1}processSkin(e){const i=this.json,s=this.nodeMap,a=i.nodes[s.get(e)],h=e.skeleton;if(h===void 0)return null;const f=e.skeleton.bones[0];if(f===void 0)return null;const k=[],et=new Float32Array(16*h.bones.length),tt=new d.yGw;for(let rt=0;rt<h.bones.length;++rt)k.push(s.get(h.bones[rt])),tt.copy(h.boneInverses[rt]),tt.multiply(e.bindMatrix).toArray(et,16*rt);return i.skins===void 0&&(i.skins=[]),i.skins.push({inverseBindMatrices:this.processAccessor(new d.TlE(et,16)),joints:k,skeleton:s.get(f)}),a.skin=i.skins.length-1}processNode(e){const i=this.json,s=this.options,a=this.nodeMap;i.nodes||(i.nodes=[]);const h={};if(s.trs){const k=e.quaternion.toArray(),et=e.position.toArray(),tt=e.scale.toArray();Bv(k,[0,0,0,1])||(h.rotation=k),Bv(et,[0,0,0])||(h.translation=et),Bv(tt,[1,1,1])||(h.scale=tt)}else e.matrixAutoUpdate&&e.updateMatrix(),Bv(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])===!1&&(h.matrix=e.matrix.elements);if(e.name!==""&&(h.name=String(e.name)),this.serializeUserData(e,h),e.isMesh||e.isLine||e.isPoints){const k=this.processMesh(e);k!==null&&(h.mesh=k)}else e.isCamera&&(h.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const k=[];for(let et=0,tt=e.children.length;et<tt;et++){const rt=e.children[et];if(rt.visible||s.onlyVisible===!1){const lt=this.processNode(rt);lt!==null&&k.push(lt)}}k.length>0&&(h.children=k)}this._invokeAll(function(k){k.writeNode&&k.writeNode(e,h)});const f=i.nodes.push(h)-1;return a.set(e,f),f}processScene(e){const i=this.json,s=this.options;i.scenes||(i.scenes=[],i.scene=0);const a={};e.name!==""&&(a.name=e.name),i.scenes.push(a);const h=[];for(let f=0,k=e.children.length;f<k;f++){const et=e.children[f];if(et.visible||s.onlyVisible===!1){const tt=this.processNode(et);tt!==null&&h.push(tt)}}h.length>0&&(a.nodes=h),this.serializeUserData(e,a)}processObjects(e){const i=new d.xsS;i.name="AuxScene";for(let s=0;s<e.length;s++)i.children.push(e[s]);this.processScene(i)}processInput(e){const i=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(a){a.beforeParse&&a.beforeParse(e)});const s=[];for(let a=0;a<e.length;a++)e[a]instanceof d.xsS?this.processScene(e[a]):s.push(e[a]);s.length>0&&this.processObjects(s);for(let a=0;a<this.skins.length;++a)this.processSkin(this.skins[a]);for(let a=0;a<i.animations.length;++a)this.processAnimation(i.animations[a],e[0]);this._invokeAll(function(a){a.afterParse&&a.afterParse(e)})}_invokeAll(e){for(let i=0,s=this.plugins.length;i<s;i++)e(this.plugins[i])}}class Gp{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,i){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);const s=this.writer,a=s.json,h=s.extensionsUsed,f={};e.name&&(f.name=e.name),f.color=e.color.toArray(),f.intensity=e.intensity,e.isDirectionalLight?f.type="directional":e.isPointLight?(f.type="point",e.distance>0&&(f.range=e.distance)):e.isSpotLight&&(f.type="spot",e.distance>0&&(f.range=e.distance),f.spot={},f.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,f.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&e.target.position.x===0&&e.target.position.y===0&&e.target.position.z===-1||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),h[this.name]||(a.extensions=a.extensions||{},a.extensions[this.name]={lights:[]},h[this.name]=!0);const k=a.extensions[this.name].lights;k.push(f),i.extensions=i.extensions||{},i.extensions[this.name]={light:k.length-1}}}class qx{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,i){if(!e.isMeshBasicMaterial)return;const s=this.writer.extensionsUsed;i.extensions=i.extensions||{},i.extensions[this.name]={},s[this.name]=!0,i.pbrMetallicRoughness.metallicFactor=0,i.pbrMetallicRoughness.roughnessFactor=.9}}class CP{constructor(e){this.writer=e,this.name="KHR_materials_pbrSpecularGlossiness"}writeMaterial(e,i){if(!e.isGLTFSpecularGlossinessMaterial)return;const s=this.writer,a=s.extensionsUsed,h={};i.pbrMetallicRoughness.baseColorFactor&&(h.diffuseFactor=i.pbrMetallicRoughness.baseColorFactor);const f=[1,1,1];if(e.specular.toArray(f,0),h.specularFactor=f,h.glossinessFactor=e.glossiness,i.pbrMetallicRoughness.baseColorTexture&&(h.diffuseTexture=i.pbrMetallicRoughness.baseColorTexture),e.specularMap){const k={index:s.processTexture(e.specularMap)};s.applyTextureTransform(k,e.specularMap),h.specularGlossinessTexture=k}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class yI{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.clearcoatFactor=e.clearcoat,e.clearcoatMap){const f={index:s.processTexture(e.clearcoatMap)};s.applyTextureTransform(f,e.clearcoatMap),h.clearcoatTexture=f}if(h.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const f={index:s.processTexture(e.clearcoatRoughnessMap)};s.applyTextureTransform(f,e.clearcoatRoughnessMap),h.clearcoatRoughnessTexture=f}if(e.clearcoatNormalMap){const f={index:s.processTexture(e.clearcoatNormalMap)};s.applyTextureTransform(f,e.clearcoatNormalMap),h.clearcoatNormalTexture=f}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class XO{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.iridescenceFactor=e.iridescence,e.iridescenceMap){const f={index:s.processTexture(e.iridescenceMap)};s.applyTextureTransform(f,e.iridescenceMap),h.iridescenceTexture=f}if(h.iridescenceIor=e.iridescenceIOR,h.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],h.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const f={index:s.processTexture(e.iridescenceThicknessMap)};s.applyTextureTransform(f,e.iridescenceThicknessMap),h.iridescenceThicknessTexture=f}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class KO{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.transmissionFactor=e.transmission,e.transmissionMap){const f={index:s.processTexture(e.transmissionMap)};s.applyTextureTransform(f,e.transmissionMap),h.transmissionTexture=f}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class $O{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.thicknessFactor=e.thickness,e.thicknessMap){const f={index:s.processTexture(e.thicknessMap)};s.applyTextureTransform(f,e.thicknessMap),h.thicknessTexture=f}h.attenuationDistance=e.attenuationDistance,h.attenuationColor=e.attenuationColor.toArray(),i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class JO{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.sheen<.01)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.sheenColorFactor=e.sheenColor.toArray(),e.sheenColorMap){const f={index:s.processTexture(e.sheenColorMap)};s.applyTextureTransform(f,e.sheenColorMap),h.sheenColorTexture=f}if(h.sheenRoughnessFactor=e.sheenRoughness,e.sheenRoughnessMap){const f={index:s.processTexture(e.sheenRoughnessMap)};s.applyTextureTransform(f,e.sheenRoughnessMap),h.sheenRoughnessTexture=f}i.extensions=i.extensions||{},i.extensions[this.name]=h,i.extras=i.extras||{},i.extras.sheenFactor=e.sheen,a[this.name]=!0}}class ZO{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial)return;const s=this.writer.extensionsUsed,a={};a.ior=e.ior,i.extensions=i.extensions||{},i.extensions[this.name]=a,s[this.name]=!0}}f_.Utils={GLTFWriter:JC,insertKeyframe:function(c,e){const s=c.getValueSize(),a=new c.TimeBufferType(c.times.length+1),h=new c.ValueBufferType(c.values.length+s),f=c.createInterpolant(new c.ValueBufferType(s));let k;if(c.times.length===0){a[0]=e;for(let et=0;et<s;et++)h[et]=0;k=0}else if(e<c.times[0]){if(Math.abs(c.times[0]-e)<.001)return 0;a[0]=e,a.set(c.times,1),h.set(f.evaluate(e),0),h.set(c.values,s),k=0}else if(e>c.times[c.times.length-1]){if(Math.abs(c.times[c.times.length-1]-e)<.001)return c.times.length-1;a[a.length-1]=e,a.set(c.times,0),h.set(c.values,0),h.set(f.evaluate(e),c.values.length),k=a.length-1}else for(let et=0;et<c.times.length;et++){if(Math.abs(c.times[et]-e)<.001)return et;if(c.times[et]<e&&c.times[et+1]>e){a.set(c.times.slice(0,et+1),0),a[et+1]=e,a.set(c.times.slice(et+1),et+2),h.set(c.values.slice(0,(et+1)*s),0),h.set(f.evaluate(e),(et+1)*s),h.set(c.values.slice((et+1)*s),(et+2)*s),k=et+1;break}}return c.times=a,c.values=h,k},mergeMorphTargetTracks:function(c,e){const i=[],s={},a=c.tracks;for(let h=0;h<a.length;++h){let f=a[h];const k=d.iUV.parseTrackName(f.name),et=d.iUV.findNode(e,k.nodeName);if(k.propertyName!=="morphTargetInfluences"||k.propertyIndex===void 0){i.push(f);continue}if(f.createInterpolant!==f.InterpolantFactoryMethodDiscrete&&f.createInterpolant!==f.InterpolantFactoryMethodLinear){if(f.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),f=f.clone(),f.setInterpolation(d.NMF)}const tt=et.morphTargetInfluences.length,rt=et.morphTargetDictionary[k.propertyIndex];if(rt===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+k.propertyIndex);let lt;if(s[et.uuid]===void 0){lt=f.clone();const ft=new lt.ValueBufferType(tt*lt.times.length);for(let vt=0;vt<lt.times.length;vt++)ft[vt*tt+rt]=lt.values[vt];lt.name=(k.nodeName||"")+".morphTargetInfluences",lt.values=ft,s[et.uuid]=lt,i.push(lt);continue}const pt=f.createInterpolant(new f.ValueBufferType(1));lt=s[et.uuid];for(let ft=0;ft<lt.times.length;ft++)lt.values[ft*tt+rt]=pt.evaluate(lt.times[ft]);for(let ft=0;ft<f.times.length;ft++){const vt=this.insertKeyframe(lt,f.times[ft]);lt.values[vt*tt+rt]=f.values[ft]}}return c.tracks=i,c}};class yR extends f_.Utils.GLTFWriter{constructor(){super(...arguments),this._defaultMaterial=new d.Wid}serializeUserData(e,i){const s=e.userData,a={};s.__disposed&&console.error("Serializing a disposed object",e),Object.entries(s).forEach(([h,f])=>{(!f||typeof f=="function"||f.isObject3D||f.isTexture||f.isMaterial||f.assetType!=null||h.startsWith("_")||h!=="uuid"&&(to.includes(h)||xa.includes(h)||Gs.includes(h)))&&(a[h]=f,delete s[h])}),super.serializeUserData(e,i),Object.entries(a).forEach(([h,f])=>{s[h]=f,delete a[h]})}processObjects(e){var i;e.length===1&&(!((i=e[0])===null||i===void 0)&&i.userData.rootSceneModelRoot)?this.processScene(e[0]):super.processObjects(e)}processMaterial(e){if(this.cache.materials.has(e))return this.cache.materials.get(e);let i=e;i&&!i.isShaderMaterial||(i=this._defaultMaterial);const s=super.processMaterial(i);if(!e||i===e)return s;const a=JSON.stringify(this.json.materials[s]),h=JSON.parse(a);this.serializeUserData(e,h),this._invokeAll(k=>{k.writeMaterial&&k.writeMaterial(e,h)});const f=this.json.materials.push(h)-1;return this.cache.materials.set(e,f),f}processImageBlob(e,i){if(!e)return-1;const s=this.cache,a=this.options,h=this.pending,f=this.json,k=i.image;s.images.has(k)||s.images.set(k,{});const et=s.images.get(k),tt=e.type+":flipY/"+i.flipY.toString();if(et[tt]!==void 0)return et[tt];f.images||(f.images=[]);const rt={mimeType:e.type};a.binary===!0?h.push(new Promise(pt=>{this.processBufferViewImage(e).then(ft=>{rt.bufferView=ft,pt()})})):h.push(_u(e).then(pt=>{rt.uri=pt}));const lt=f.images.push(rt)-1;return et[tt]=lt,lt}processSampler(e){return super.processSampler(e)}processTexture(e){const i=this.cache,s=this.json;if(i.textures.has(e))return i.textures.get(e);const a=e.source.data,h=e.userData.mimeType;e.userData.rootPath&&!this.options.embedUrlImages&&(e.source.data=null,delete e.userData.mimeType);const f=super.processTexture(e),k=s.textures[f];if(!k)return console.error("No texture def",f,e),f;const et=s.images?s.images[k.source]:null;if(et&&(et.extras||(et.extras={}),e.source&&(et.extras.uuid=e.source.uuid),et.extras.t_uuid=e.uuid),e.userData.rootPath&&!this.options.embedUrlImages){if(e.source.data=a,e.userData.mimeType=h,!k)return console.error("textureDef is null",f,e),f;k.source>=0?console.warn("textureDef.source is already set",f,e):k.source=this.processImageUri(e.image,e.userData.rootPath,e.flipY,h)}return k.source<0&&console.error("textureDef.source cannot be saved",k,e),f}processImage(e,i,s,a="image/png"){return e?super.processImage(e,i,s,a):-1}processImageUri(e,i,s,a="image/png"){const h=this.cache,f=this.json;h.images.has(e)||h.images.set(e,{});const k=h.images.get(e),et=a+":flipY/"+s.toString();if(k[et]!==void 0)return k[et];f.images||(f.images=[]);const tt={mimeType:a,uri:i,extras:{flipY:s}},rt=f.images.push(tt)-1;return k[et]=rt,rt}}class MP extends f_{register(e){return super.register(e)}async parseAsync(e,i){var s;if(!e)throw new Error("No object to export");const a=e.__isGLTFOutput||!Array.isArray(e)&&!e.isObject3D?e:await new Promise((h,f)=>this.parse(e,h,f,i));if(a&&typeof a=="object"&&!a.byteLength)return new Blob([JSON.stringify(a,(h,f)=>h.startsWith("__")?void 0:f,(s=i.jsonSpaces)!==null&&s!==void 0?s:2)],{type:"model/gltf+json"});if(a)return new Blob([a],{type:"model/gltf+binary"});throw new Error("GLTFExporter2.parse() failed")}parse(e,i,s,a={}){var h;const f={binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,externalImagesInExtras:!a.embedUrlImages&&a.externalImagesInExtras||!1,embedUrlImages:(h=a.embedUrlImages)!==null&&h!==void 0&&h,maxTextureSize:1/0,animations:[],includeCustomExtensions:!0};return a.exportExt==="glb"&&(f.binary=!0),a.preserveUUIDs!==!1&&(Array.isArray(e)?e:[e]).forEach(k=>k.traverse(et=>{et.uuid&&(et.userData.gltfUUID=et.uuid)})),(Array.isArray(e)?e:[e]).forEach(k=>k.traverse(et=>{if(et.animations)for(const tt of et.animations)tt.__gltfExport===!1||f.animations.includes(tt)||f.animations.push(...et.animations)})),super.parse(e,k=>{a.preserveUUIDs!==!1&&(Array.isArray(e)?e:[e]).forEach(et=>et.traverse(tt=>{delete tt.userData.gltfUUID})),i(Object.assign(k,{__isGLTFOutput:!0}))},s,f,new yR)}}function AR(c,e){const i=c.getPlugin(Kr).exportViewerConfig();e.json.textures&&e.json.samplers&&e.json.images&&i.resources.textures&&Object.entries(i.resources.textures).forEach(([a,h])=>{e.json.textures.find(k=>{var et,tt,rt,lt,pt;return((et=k.extras)===null||et===void 0?void 0:et.uuid)===a||((rt=(tt=e.json.samplers[k.sampler])===null||tt===void 0?void 0:tt.extras)===null||rt===void 0?void 0:rt.uuid)===a||((pt=(lt=e.json.images[k.source])===null||lt===void 0?void 0:lt.extras)===null||pt===void 0?void 0:pt.t_uuid)===a})&&(h.image&&i.resources.images&&i.resources.images[h.image]&&delete i.resources.images[h.image],i.resources.textures[a]={})}),e.json.materials&&i.resources.materials&&Object.entries(i.resources.materials).forEach(([a,h])=>{e.json.materials.find(k=>{var et;return((et=k.extras)===null||et===void 0?void 0:et.uuid)===a})&&(i.resources.materials[a]={})});const s=[];Object.values(i.resources).forEach(a=>{Object.values(a).forEach(h=>{h.url&&(h.url.type==="Uint16Array"&&h.url.data&&(h.url.data instanceof Uint16Array||(h.url.data=new Uint16Array(h.url.data)),s.push(h.url)),h.url.type==="Uint8Array"&&h.url.data&&(h.url.data instanceof Uint8Array||(h.url.data=new Uint8Array(h.url.data)),s.push(h.url)))})});for(const a of s){let h="application/octet-stream";if(a.type==="Uint16Array"){const tt=eL(a.data,4),rt=new ImageData(tt,a.width,a.height),lt=d.PpQ.getDataURL(rt,!0).split(",")[1];h="image/png",a.data=atob(lt),a.encoding="rgbe"}const f=new Blob([a.data],{type:h});e.json.images||(e.json.images=[]);const k={mimeType:h},et=e.json.images.push(k)-1;a.data={image:et},e.pending.push(e.processBufferViewImage(f).then(tt=>{k.bufferView=tt}))}return i}function eL(c,e=3,i){let s,a,h,f,k;const et=c.byteLength/(2*e)|0;i=i||new Uint8ClampedArray(4*et);for(let tt=0;tt<et;tt++){s=c[tt*e],a=c[tt*e+1],h=c[tt*e+2],f=Math.max(Math.max(s,a),h);const rt=Math.ceil(Math.log2(f));k=Math.pow(2,rt-8),i[4*tt]=s/k|0,i[4*tt+1]=a/k|0,i[4*tt+2]=h/k|0,i[4*tt+3]=rt+128}return i}function TP(c,e=MP,i){var s;if(!c)return;const a=iy.Exporters.findIndex(f=>f.ext.includes("gltf")||f.ext.includes("glb")),h=[];a>=0?(h.push(...(s=iy.Exporters[a].extensions)!==null&&s!==void 0?s:[]),iy.Exporters.splice(a,1)):(h.push(rL),h.push(nL),h.push(tL),h.push(f=>new iL(f)),h.push(f=>new sL(f)),h.push(f=>new oL(f)),h.push(f=>new aL(f))),iy.Exporters.push({ctor:()=>{const f=new e;return h.forEach(k=>f.register(k)),f.register(k=>({afterParse:et=>{var tt,rt;if(!(!((tt=(et=Array.isArray(et)?et[0]:et)==null?void 0:et.userData)===null||tt===void 0)&&tt.rootSceneModelRoot)||((rt=et==null?void 0:et.userData)===null||rt===void 0?void 0:rt.__exportViewerConfig)===!1)return;const lt=k.json.scenes[k.json.scene||0];lt.extensions||(lt.extensions={}),lt.extensions[_f]=AR(c,k),k.extensionsUsed[_f]=!0}})),i==null||i(f),f},ext:["gltf","glb"],extensions:h})}const tL=c=>({writeNode:(e,i)=>{if(!(e!=null&&e.isLight))return;i.extensions||(i.extensions={});const s={};e.shadow&&(s.shadow=e.shadow.toJSON()),Object.keys(s).length>0&&(i.extensions[An]=s,c.extensionsUsed[An]=!0)}}),nL=c=>({writeNode:(e,i)=>{if(!(e!=null&&e.isObject3D))return;i.extensions||(i.extensions={});const s={};e.castShadow!==void 0&&(s.castShadow=e.castShadow),e.receiveShadow!==void 0&&(s.receiveShadow=e.receiveShadow),e.visible===!1&&(s.visible=!1),e.frustumCulled===!1&&(s.frustumCulled=!1),e.renderOrder!==0&&(s.renderOrder=e.renderOrder),e.layers.mask!==1&&(s.layers=e.layers.mask),e.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),Object.keys(s).length>0&&(i.extensions[mv]=s,c.extensionsUsed[mv]=!0)}}),rL=c=>({writeMaterial(e,i){var s;if(!(e!=null&&e.isMaterial))return;i.extensions||(i.extensions={});const a={};if(e.emissiveIntensity!==void 0&&(!((s=e.emissive)===null||s===void 0)&&s.isColor)){const f=e.emissive.clone().multiplyScalar(e.emissiveIntensity),k=Math.max(f.r,f.g,f.b);k>1&&(a.emissiveIntensity=k)}e.fog!==void 0&&(a.fog=e.fog),e.flatShading!==void 0&&(a.flatShading=e.flatShading),e.blending!==void 0&&(a.blending=e.blending),e.side!==void 0&&e.side!==d.ehD&&(a.side=e.side),e.shadowSide!==void 0&&(a.shadowSide=e.shadowSide),e.depthFunc!==void 0&&(a.depthFunc=e.depthFunc),e.depthTest!==void 0&&(a.depthTest=e.depthTest),e.depthWrite!==void 0&&(a.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(a.colorWrite=e.colorWrite),e.wireframe!==void 0&&(a.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(a.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(a.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(a.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(a.rotation=e.rotation),e.polygonOffset!==void 0&&(a.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(a.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(a.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(a.dithering=e.dithering),e.alphaToCoverage!==void 0&&(a.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(a.premultipliedAlpha=e.premultipliedAlpha),e.toneMapped!==void 0&&(a.toneMapped=e.toneMapped);const h=this.materialExternalResources[e.uuid];h&&Object.entries(h).forEach(([f,k])=>{f.startsWith("_")||(a[f]=Wr(k,!1,this.serializedMeta))}),Object.keys(a).length>0&&(i.extensions[em]=a,c.extensionsUsed[em]=!0)},materialExternalResources:{},serializedMeta:{images:{},textures:{}},beforeParse(e){if(this.materialExternalResources={},!c.options.externalImagesInExtras)return;const i=[];(Array.isArray(e)?e:[e]).forEach(s=>{s==null||s.traverse(a=>{var h;a&&(!((h=a.material)===null||h===void 0)&&h.isMaterial)&&i.push(a.material)})}),i.forEach(s=>{s&&(this.materialExternalResources[s.uuid]||(this.materialExternalResources[s.uuid]={}),this.materialExternalResources[s.uuid].__materialRef=s,Object.entries(s).forEach(([a,h])=>{a.startsWith("_")||h&&h.isTexture&&h.userData.rootPath&&(s[a]=null,this.materialExternalResources[s.uuid][a]=h)}))})},afterParse(e){const i=Object.values(this.materialExternalResources);if(i.length<1)return;i.forEach(a=>{const h=a.__materialRef;h&&(Object.entries(a).forEach(([f,k])=>{f.startsWith("_")||k&&(h[f]=k)}),delete this.materialExternalResources[h.uuid])});const s=c.json.scenes[c.json.scene||0];s.extensions||(s.extensions={}),s.extensions[em]={resources:this.serializedMeta},c.extensionsUsed[em]=!0}});class iL{constructor(e){this.writer=e,this.name=xm}writeMaterial(e,i){if(!e.isMeshStandardMaterial||e.bumpScale===0)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.bumpScale=e.bumpScale,e.bumpMap){const f={index:s.processTexture(e.bumpMap)};s.applyTextureTransform(f,e.bumpMap),h.bumpTexture=f}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class sL{constructor(e){this.writer=e,this.name=Yv}writeMaterial(e,i){if(!e.isMeshStandardMaterial||e.displacementScale===0)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.displacementScale=e.displacementScale,h.displacementBias=e.displacementBias,e.displacementMap){const f={index:s.processTexture(e.displacementMap)};s.applyTextureTransform(f,e.displacementMap),h.displacementTexture=f}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class oL{constructor(e){this.writer=e,this.name=bm}writeMaterial(e,i){if(!e.isMeshStandardMaterial||e.lightMapIntensity===0)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.lightMapIntensity=e.lightMapIntensity,e.lightMap){const f={index:s.processTexture(e.lightMap)};s.applyTextureTransform(f,e.lightMap),h.lightMapTexture=f}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class aL{constructor(e){this.writer=e,this.name=vv}writeMaterial(e,i){if(!e.isMeshStandardMaterial||!e.alphaMap)return;const s=this.writer,a=s.extensionsUsed,h={};if(e.alphaMap){const f={index:s.processTexture(e.alphaMap)};s.applyTextureTransform(f,e.alphaMap),h.alphaTexture=f}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class iy extends j{constructor(e,i={}){super(),this._processors=new E0,this._cachedParsers=[],TP(e)}get processors(){return this._processors}getExporter(...e){return iy.Exporters.find(i=>i.ext.some(s=>e.includes(s)))}async exportObject(e,i={}){var s,a,h,f;if(!(e!=null&&e.assetType))return void console.error("Object has no asset type");!((a=(s=e)===null||s===void 0?void 0:s.userData)===null||a===void 0)&&a.rootSceneModelRoot&&i.viewerConfig===!1&&(e.userData.__exportViewerConfig=!1);const k=await this._exportFile(e,i);return!((f=(h=e)===null||h===void 0?void 0:h.userData)===null||f===void 0)&&f.rootSceneModelRoot&&i.viewerConfig===!1&&delete e.userData.__exportViewerConfig,k}async _exportFile(e,i={}){var s,a,h;let f;this.dispatchEvent({type:"exportFile",obj:e,state:"processing"});try{const k=await this.processBeforeExport(e,i),et=(a=(s=i.exportExt)!==null&&s!==void 0?s:k==null?void 0:k.typeExt)!==null&&a!==void 0?a:k==null?void 0:k.ext;if(!k||!et)throw new Error(`Unable to preprocess before export ${et}`);const tt=this._getParser(et);this.dispatchEvent({type:"exportFile",obj:e,state:"exporting"});const rt=await tt.parseAsync(k.obj,{exportExt:(h=k.ext)!==null&&h!==void 0?h:et,...i});rt.ext=k.ext,f=rt}catch(k){return console.error("AssetExporter: Unable to Export file",e),console.error(k),void this.dispatchEvent({type:"exportFile",obj:e,state:"error",error:k})}return this.dispatchEvent({type:"exportFile",obj:e,state:"done"}),f}_createParser(e){const i=iy.Exporters.find(a=>a.ext.includes(e));if(!i)throw new Error(`No exporter found for extension ${e}`);const s=i==null?void 0:i.ctor(this);if(!s)throw new Error(`Unable to create parser for extension ${e}`);return this._cachedParsers.push({ext:i.ext,parser:s}),this.dispatchEvent({type:"exporterCreate",exporter:i,parser:s}),s}_getParser(e){var i,s;return(s=(i=this._cachedParsers.find(a=>a.ext.includes(e)))===null||i===void 0?void 0:i.parser)!==null&&s!==void 0?s:this._createParser(e)}async processBeforeExport(e,i={}){switch(e.assetType!=null&&(e=await this._processors.process(e.assetType,e,i)),e.assetType){case"light":return void console.error("AssetExporter: light export not implemented");case"model":return{obj:e,ext:"glb"};case"material":return{obj:e.toJSON(),ext:e.typeSlug||"json",typeExt:"json"};case"texture":return{obj:e.toJSON(),ext:"json"};default:console.error("AssetExporter: unknown asset type",e.assetType)}}dispose(){var e;(e=this._processors)===null||e===void 0||e.dispose()}}iy.Exporters=[{ctor:()=>new _I,ext:["json"]},{ctor:()=>new p_,ext:["txt","text"]}];class ZC extends Js{constructor(e){super(),this.enabled=!0,this.exportOptions={compress:!1,name:"scene",viewerConfig:!0,convertMeshToIndexed:!1,embedUrlImages:!1},this.exporter=e,this.exportScene=this.exportScene.bind(this)}async onAdded(e){await super.onAdded(e),this.exporter||(this.exporter=new iy(e)),this.exporter.processors.add("model",{forAssetType:"model",processAsync:async(i,s)=>{var a;return s.convertMeshToIndexed&&((a=i.modelObject)===null||a===void 0||a.traverse(h=>{var f;h.geometry&&(h.geometry.attributes.index||(f=h.setGeometry)===null||f===void 0||f.call(h,us(h.geometry)))})),i}})}async onRemove(e){return super.onRemove(e)}async exportScene(e){var i,s;return(i=this.exporter)===null||i===void 0?void 0:i.exportObject((s=this._viewer)===null||s===void 0?void 0:s.scene.modelRoot,e||{...this.exportOptions})}get uiConfig(){if(this._uiConfig)return this._uiConfig;const e=this._viewer;e.addEventListener("addPlugin",s=>{var a;typeof((a=s.plugin)===null||a===void 0?void 0:a.toJSON)=="function"&&console.error("Add all plugins before setting up the export UI, or use `toJSON: any = null` in the plugin ")});const i=Object.entries(e.plugins).filter(([s,a])=>typeof(a==null?void 0:a.toJSON)=="function").map(([s,a])=>({label:s,type:"checkbox",value:!0}));return this._uiConfig={type:"folder",label:"Asset Export",limitedUi:!0,children:[{type:"input",property:[this.exportOptions,"name"],limitedUi:!0},{type:"folder",label:"GLB Export",limitedUi:!0,children:[{type:"checkbox",label:"DRACO Compress",property:[this.exportOptions,"compress"],limitedUi:!0},{type:"checkbox",label:"Scene Settings",property:[this.exportOptions,"viewerConfig"],limitedUi:!0},{type:"checkbox",label:"Indexed meshes only",property:[this.exportOptions,"convertMeshToIndexed"]},{type:"button",label:"Export GLB",limitedUi:!0,value:async()=>{const s=await this.exportScene(this.exportOptions);s&&Du(s,this.exportOptions.name+"."+s.ext)}}]},{type:"folder",label:"Preset/Config export",children:[{type:"folder",label:"Plugins",children:i},{type:"button",label:"Select none",value:()=>{i.forEach(s=>{var a;s.value=!1,(a=s.uiRefresh)===null||a===void 0||a.call(s)})}},{type:"button",label:"Select all",value:()=>{i.forEach(s=>{var a;s.value=!0,(a=s.uiRefresh)===null||a===void 0||a.call(s)})}},{type:"button",label:"Export Plugins",limitedUi:!0,value:async()=>{const s=new Blob([JSON.stringify(e.getPlugin(Kr).exportPluginPresets(i.filter(a=>!!a.value).map(a=>Ht(a.label)||"")),null,2)],{type:"application/json"});s&&Du(s,this.exportOptions.name+"."+Kr.ViewerTypeSlug)}},{type:"button",label:"Export All Viewer Config",limitedUi:!0,value:async()=>{const s=new Blob([JSON.stringify(e.getPlugin(Kr).exportViewerConfig(),null,2)],{type:"application/json"});s&&Du(s,this.exportOptions.name+"."+Kr.ViewerTypeSlug)}}]}]}}}ZC.PluginType="AssetExporterPlugin";class IP{constructor(){this._listeners={}}addEventListener(e,i){const s=this._listeners;return s[e]===void 0&&(s[e]=[]),s[e].indexOf(i)===-1&&s[e].push(i),this}removeEventListener(e,i){if(this._listeners===void 0)return this;const s=this._listeners[e];if(s!==void 0){const a=s.indexOf(i);a!==-1&&s.splice(a,1)}return this}dispatchEvent(e){if(this._listeners===void 0)return this;const i=this._listeners[e.type];if(i!==void 0){const s=i.slice(0);for(let a=0,h=s.length;a<h;a++)s[a].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class sy extends IP{constructor(e,i,s,a={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=i,this._child=s,this._attributes=a,!i.isOnGraph(s))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class lL extends IP{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map(i=>i.getParent())}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map(i=>i.getChild())}disconnectParents(e,i){let s=this.listParentEdges(e);return i&&(s=s.filter(a=>i(a.getParent()))),s.forEach(a=>a.dispose()),this}createEdge(e,i,s,a){return this._registerEdge(new sy(e,i,s,a))}_registerEdge(e){this._edges.add(e);const i=e.getParent();this._parentEdges.has(i)||this._parentEdges.set(i,new Set),this._parentEdges.get(i).add(e);const s=e.getChild();return this._childEdges.has(s)||this._childEdges.set(s,new Set),this._childEdges.get(s).add(e),e.addEventListener("dispose",()=>this._removeEdge(e)),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function eM(){return eM=Object.assign||function(c){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(c[s]=i[s])}return c},eM.apply(this,arguments)}function PP(c){return c instanceof sy}function DP(c){return Array.isArray(c)&&c[0]instanceof sy}function RP(c){return!!(c&&typeof c=="object"&&Object.values(c)[0]instanceof sy)}const Bl=Symbol("attributes"),YE=Symbol("immutableKeys");class kP extends IP{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[Bl]=void 0,this[YE]=void 0,this.graph=e,this[YE]=new Set,this[Bl]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),i={};for(const s in e){const a=e[s];if(a instanceof kP){const h=this.graph.createEdge(s,this,a);h.addEventListener("dispose",()=>a.dispose()),this[YE].add(s),i[s]=h}else i[s]=a}return i}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,i){for(const s in this[Bl]){const a=this[Bl][s];if(PP(a)){const h=a;h.getChild()===e&&this.setRef(s,i,h.getAttributes())}else if(DP(a)){const h=a.find(f=>f.getChild()===e);if(h){const f=h.getAttributes();this.removeRef(s,e).addRef(s,i,f)}}else if(RP(a)){const h=a;for(const f in h){const k=h[f];k.getChild()===e&&this.setRefMap(s,f,i,k.getAttributes())}}}return this}get(e){return this[Bl][e]}set(e,i){return this[Bl][e]=i,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const i=this[Bl][e];return i?i.getChild():null}setRef(e,i,s){if(this[YE].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const a=this[Bl][e];if(a&&a.dispose(),!i)return this;const h=this.graph.createEdge(e,this,i,s);return h.addEventListener("dispose",()=>{delete this[Bl][e],this.dispatchEvent({type:"change",attribute:e})}),this[Bl][e]=h,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[Bl][e].map(i=>i.getChild())}addRef(e,i,s){const a=this.graph.createEdge(e,this,i,s),h=this[Bl][e];return h.push(a),a.addEventListener("dispose",()=>{const f=h.filter(k=>k!==a);h.length=0;for(const k of f)h.push(k);this.dispatchEvent({type:"change",attribute:e})}),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,i){return this[Bl][e].filter(s=>s.getChild()===i).forEach(s=>s.dispose()),this}listRefMapKeys(e){return Object.keys(this[Bl][e])}listRefMapValues(e){return Object.values(this[Bl][e]).map(i=>i.getChild())}getRefMap(e,i){const s=this[Bl][e];return s[i]?s[i].getChild():null}setRefMap(e,i,s,a){const h=this[Bl][e],f=h[i];if(f&&f.dispose(),!s)return this;a=Object.assign(a||{},{key:i});const k=this.graph.createEdge(e,this,s,eM({},a,{key:i}));return k.addEventListener("dispose",()=>{delete h[i],this.dispatchEvent({type:"change",attribute:e,key:i})}),h[i]=k,this.dispatchEvent({type:"change",attribute:e,key:i})}dispatchEvent(e){return super.dispatchEvent(eM({},e,{target:this})),this.graph.dispatchEvent(eM({},e,{target:this,type:`node:${e.type}`})),this}}var AI,Yr,wI,d0,Qu,m_,BP=typeof Float32Array<"u"?Float32Array:Array;function OP(c){var e=c[0],i=c[1],s=c[2];return Math.hypot(e,i,s)}function cL(c,e,i){var s=e[0],a=e[1],h=e[2],f=i[3]*s+i[7]*a+i[11]*h+i[15];return f=f||1,c[0]=(i[0]*s+i[4]*a+i[8]*h+i[12])/f,c[1]=(i[1]*s+i[5]*a+i[9]*h+i[13])/f,c[2]=(i[2]*s+i[6]*a+i[10]*h+i[14])/f,c}function uL(c,e,i){var s=e[0],a=e[1],h=e[2],f=e[3],k=e[4],et=e[5],tt=e[6],rt=e[7],lt=e[8],pt=e[9],ft=e[10],vt=e[11],yt=e[12],Mt=e[13],xt=e[14],Et=e[15],At=i[0],Rt=i[1],Bt=i[2],Qt=i[3];return c[0]=At*s+Rt*k+Bt*lt+Qt*yt,c[1]=At*a+Rt*et+Bt*pt+Qt*Mt,c[2]=At*h+Rt*tt+Bt*ft+Qt*xt,c[3]=At*f+Rt*rt+Bt*vt+Qt*Et,At=i[4],Rt=i[5],Bt=i[6],Qt=i[7],c[4]=At*s+Rt*k+Bt*lt+Qt*yt,c[5]=At*a+Rt*et+Bt*pt+Qt*Mt,c[6]=At*h+Rt*tt+Bt*ft+Qt*xt,c[7]=At*f+Rt*rt+Bt*vt+Qt*Et,At=i[8],Rt=i[9],Bt=i[10],Qt=i[11],c[8]=At*s+Rt*k+Bt*lt+Qt*yt,c[9]=At*a+Rt*et+Bt*pt+Qt*Mt,c[10]=At*h+Rt*tt+Bt*ft+Qt*xt,c[11]=At*f+Rt*rt+Bt*vt+Qt*Et,At=i[12],Rt=i[13],Bt=i[14],Qt=i[15],c[12]=At*s+Rt*k+Bt*lt+Qt*yt,c[13]=At*a+Rt*et+Bt*pt+Qt*Mt,c[14]=At*h+Rt*tt+Bt*ft+Qt*xt,c[15]=At*f+Rt*rt+Bt*vt+Qt*Et,c}function hL(c,e){const i={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};for(const s of c.listPrimitives()){const a=s.getAttribute("POSITION");if(!a)continue;let h=[0,0,0],f=[0,0,0];for(let k=0;k<a.getCount();k++)h=a.getElement(k,h),f=cL(f,h,e),LP(f,i)}return i}function LP(c,e){for(let i=0;i<3;i++)e.min[i]=Math.min(c[i],e.min[i]),e.max[i]=Math.max(c[i],e.max[i])}Math.hypot||(Math.hypot=function(){for(var c=0,e=arguments.length;e--;)c+=arguments[e]*arguments[e];return Math.sqrt(c)}),AI=new BP(3),BP!=Float32Array&&(AI[0]=0,AI[1]=0,AI[2]=0),function(c){c.ACCESSOR="Accessor",c.ANIMATION="Animation",c.ANIMATION_CHANNEL="AnimationChannel",c.ANIMATION_SAMPLER="AnimationSampler",c.BUFFER="Buffer",c.CAMERA="Camera",c.MATERIAL="Material",c.MESH="Mesh",c.PRIMITIVE="Primitive",c.PRIMITIVE_TARGET="PrimitiveTarget",c.NODE="Node",c.ROOT="Root",c.SCENE="Scene",c.SKIN="Skin",c.TEXTURE="Texture",c.TEXTURE_INFO="TextureInfo"}(Yr||(Yr={})),function(c){c.INTERLEAVED="interleaved",c.SEPARATE="separate"}(wI||(wI={})),function(c){c.ARRAY_BUFFER="ARRAY_BUFFER",c.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",c.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",c.OTHER="OTHER"}(d0||(d0={})),function(c){c[c.R=4096]="R",c[c.G=256]="G",c[c.B=16]="B",c[c.A=1]="A"}(Qu||(Qu={})),function(c){c.GLTF="GLTF",c.GLB="GLB"}(m_||(m_={}));class jo{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const i=atob(e.split(",")[1]),s=new Uint8Array(i.length);for(let a=0;a<i.length;a++)s[a]=i.charCodeAt(a);return s}{const i=e.split(",")[1],s=e.indexOf("base64")>=0;return Buffer.from(i,s?"base64":"utf8")}}static encodeText(e){return typeof TextEncoder<"u"?new TextEncoder().encode(e):Buffer.from(e)}static decodeText(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):Buffer.from(e).toString("utf8")}static concat(e){let i=0;for(const h of e)i+=h.byteLength;const s=new Uint8Array(i);let a=0;for(const h of e)s.set(h,a),a+=h.byteLength;return s}static pad(e,i=0){const s=this.padNumber(e.byteLength);if(s===e.byteLength)return e;const a=new Uint8Array(s);if(a.set(e),i!==0)for(let h=e.byteLength;h<s;h++)a[h]=i;return a}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,i){if(e===i)return!0;if(e.byteLength!==i.byteLength)return!1;let s=e.byteLength;for(;s--;)if(e[s]!==i[s])return!1;return!0}static toView(e,i=0,s=1/0){return new Uint8Array(e.buffer,e.byteOffset+i,Math.min(e.byteLength,s))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class sv{static hexToFactor(e,i){e=Math.floor(e);const s=i;return s[0]=(e>>16&255)/255,s[1]=(e>>8&255)/255,s[2]=(255&e)/255,this.convertSRGBToLinear(i,i)}static factorToHex(e){const i=[...e],[s,a,h]=this.convertLinearToSRGB(e,i);return 255*s<<16^255*a<<8^255*h<<0}static convertSRGBToLinear(e,i){const s=e,a=i;for(let h=0;h<3;h++)a[h]=s[h]<.04045?.0773993808*s[h]:Math.pow(.9478672986*s[h]+.0521327014,2.4);return i}static convertLinearToSRGB(e,i){const s=e,a=i;for(let h=0;h<3;h++)a[h]=s[h]<.0031308?12.92*s[h]:1.055*Math.pow(s[h],.41666)-.055;return i}}class xI{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const i=new DataView(e.buffer,e.byteOffset);return jo.decodeText(e.slice(12,16))===xI.PNG_FRIED_CHUNK_NAME?[i.getUint32(32,!1),i.getUint32(36,!1)]:[i.getUint32(16,!1),i.getUint32(20,!1)]}getChannels(e){return 4}}xI.PNG_FRIED_CHUNK_NAME="CgBI";class nA{static registerFormat(e,i){this.impls[e]=i}static getMimeType(e){for(const i in this.impls)if(this.impls[i].match(e))return i;return null}static getSize(e,i){return this.impls[i]?this.impls[i].getSize(e):null}static getChannels(e,i){return this.impls[i]?this.impls[i].getChannels(e):null}static getMemSize(e,i){if(!this.impls[i])return null;if(this.impls[i].getGPUByteLength)return this.impls[i].getGPUByteLength(e);let s=0;const a=this.getSize(e,i);if(!a)return null;for(;a[0]>1||a[1]>1;)s+=a[0]*a[1]*4,a[0]=Math.max(Math.floor(a[0]/2),1),a[1]=Math.max(Math.floor(a[1]/2),1);return s+=4,s}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":`image/${e}`}}function dL(c,e){if(e>c.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(c.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return c}nA.impls={"image/jpeg":new class{match(c){return c.length>=3&&c[0]===255&&c[1]===216&&c[2]===255}getSize(c){let e,i,s=new DataView(c.buffer,c.byteOffset+4);for(;s.byteLength;){if(e=s.getUint16(0,!1),dL(s,e),i=s.getUint8(e+1),i===192||i===193||i===194)return[s.getUint16(e+7,!1),s.getUint16(e+5,!1)];s=new DataView(c.buffer,s.byteOffset+e+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(c){return 3}},"image/png":new xI};class Yx{static basename(e){const i=e.split(/[\\/]/).pop();return i.substring(0,i.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const i=e.match(/data:(image\/\w+)/)[1];return nA.mimeTypeToExtension(i)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}}function wR(c){return Object.prototype.toString.call(c)==="[object Object]"}function rA(c){if(wR(c)===!1)return!1;const e=c.constructor;if(e===void 0)return!0;const i=e.prototype;return wR(i)!==!1&&Object.prototype.hasOwnProperty.call(i,"isPrototypeOf")!==!1}class Ov{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=Ov.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=Ov.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=Ov.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=Ov.Verbosity.ERROR&&console.error(e)}}Ov.Verbosity={SILENT:4,ERROR:3,WARN:2,INFO:1,DEBUG:0},Ov.DEFAULT_INSTANCE=new Ov(Ov.Verbosity.INFO);class Tu{static identity(e){return e}static eq(e,i){if(e.length!==i.length)return!1;for(let s=0;s<e.length;s++)if(Math.abs(e[s]-i[s])>1e-5)return!1;return!0}static denormalize(e,i){switch(i){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static normalize(e,i){switch(i){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static decompose(e,i,s,a){let h=OP([e[0],e[1],e[2]]);const f=OP([e[4],e[5],e[6]]),k=OP([e[8],e[9],e[10]]);(function(pt){var ft=pt[0],vt=pt[1],yt=pt[2],Mt=pt[3],xt=pt[4],Et=pt[5],At=pt[6],Rt=pt[7],Bt=pt[8],Qt=pt[9],Wt=pt[10],tn=pt[11],pn=pt[12],yn=pt[13],En=pt[14],wn=pt[15];return(ft*Et-vt*xt)*(Wt*wn-tn*En)-(ft*At-yt*xt)*(Qt*wn-tn*yn)+(ft*Rt-Mt*xt)*(Qt*En-Wt*yn)+(vt*At-yt*Et)*(Bt*wn-tn*pn)-(vt*Rt-Mt*Et)*(Bt*En-Wt*pn)+(yt*Rt-Mt*At)*(Bt*yn-Qt*pn)})(e)<0&&(h=-h),i[0]=e[12],i[1]=e[13],i[2]=e[14];const et=e.slice(),tt=1/h,rt=1/f,lt=1/k;et[0]*=tt,et[1]*=tt,et[2]*=tt,et[4]*=rt,et[5]*=rt,et[6]*=rt,et[8]*=lt,et[9]*=lt,et[10]*=lt,function(pt,ft){var vt=new BP(3);(function(In,xn){var Cn=xn[0],Fn=xn[1],Tn=xn[2],Wn=xn[4],or=xn[5],fr=xn[6],rr=xn[8],Ir=xn[9],kr=xn[10];In[0]=Math.hypot(Cn,Fn,Tn),In[1]=Math.hypot(Wn,or,fr),In[2]=Math.hypot(rr,Ir,kr)})(vt,ft);var yt=1/vt[0],Mt=1/vt[1],xt=1/vt[2],Et=ft[0]*yt,At=ft[1]*Mt,Rt=ft[2]*xt,Bt=ft[4]*yt,Qt=ft[5]*Mt,Wt=ft[6]*xt,tn=ft[8]*yt,pn=ft[9]*Mt,yn=ft[10]*xt,En=Et+Qt+yn,wn=0;En>0?(wn=2*Math.sqrt(En+1),pt[3]=.25*wn,pt[0]=(Wt-pn)/wn,pt[1]=(tn-Rt)/wn,pt[2]=(At-Bt)/wn):Et>Qt&&Et>yn?(wn=2*Math.sqrt(1+Et-Qt-yn),pt[3]=(Wt-pn)/wn,pt[0]=.25*wn,pt[1]=(At+Bt)/wn,pt[2]=(tn+Rt)/wn):Qt>yn?(wn=2*Math.sqrt(1+Qt-Et-yn),pt[3]=(tn-Rt)/wn,pt[0]=(At+Bt)/wn,pt[1]=.25*wn,pt[2]=(Wt+pn)/wn):(wn=2*Math.sqrt(1+yn-Et-Qt),pt[3]=(At-Bt)/wn,pt[0]=(tn+Rt)/wn,pt[1]=(Wt+pn)/wn,pt[2]=.25*wn)}(s,et),a[0]=h,a[1]=f,a[2]=k}static compose(e,i,s,a){const h=a,f=i[0],k=i[1],et=i[2],tt=i[3],rt=f+f,lt=k+k,pt=et+et,ft=f*rt,vt=f*lt,yt=f*pt,Mt=k*lt,xt=k*pt,Et=et*pt,At=tt*rt,Rt=tt*lt,Bt=tt*pt,Qt=s[0],Wt=s[1],tn=s[2];return h[0]=(1-(Mt+Et))*Qt,h[1]=(vt+Bt)*Qt,h[2]=(yt-Rt)*Qt,h[3]=0,h[4]=(vt-Bt)*Wt,h[5]=(1-(ft+Et))*Wt,h[6]=(xt+At)*Wt,h[7]=0,h[8]=(yt+Rt)*tn,h[9]=(xt-At)*tn,h[10]=(1-(ft+Mt))*tn,h[11]=0,h[12]=e[0],h[13]=e[1],h[14]=e[2],h[15]=1,h}}function pL(c,e){if(!!c!=!!e)return!1;const i=c.getChild(),s=e.getChild();return i===s||i.equals(s)}function fL(c,e){if(!!c!=!!e||c.length!==e.length)return!1;for(let i=0;i<c.length;i++){const s=c[i],a=e[i];if(s.getChild()!==a.getChild()&&!s.getChild().equals(a.getChild()))return!1}return!0}function mL(c,e){if(!!c!=!!e)return!1;const i=Object.keys(c),s=Object.keys(e);if(i.length!==s.length)return!1;for(const a in c){const h=c[a],f=e[a];if(!!h!=!!f)return!1;const k=h.getChild(),et=f.getChild();if(k!==et&&!k.equals(et))return!1}return!0}function xR(c,e){if(c===e)return!0;if(!!c!=!!e||!c||!e||c.length!==e.length)return!1;for(let i=0;i<c.length;i++)if(c[i]!==e[i])return!1;return!0}function bR(c,e){if(c===e)return!0;if(!!c!=!!e)return!1;if(!rA(c)||!rA(e))return c===e;const i=c,s=e;let a,h=0,f=0;for(a in i)h++;for(a in s)f++;if(h!==f)return!1;for(a in i){const k=i[a],et=s[a];if(bI(k)&&bI(et)){if(!xR(k,et))return!1}else if(rA(k)&&rA(et)){if(!bR(k,et))return!1}else if(k!==et)return!1}return!0}function bI(c){return Array.isArray(c)||ArrayBuffer.isView(c)}const ER="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",SR=new Set,gL=function(){let c="";for(let e=0;e<6;e++)c+=ER.charAt(Math.floor(Math.random()*ER.length));return c};class mw{static dirname(e){const i=e.lastIndexOf("/");return i===-1?"./":e.substring(0,i+1)}static basename(e){return Yx.basename(new URL(e,"https://null.example").pathname)}static extension(e){return Yx.extension(new URL(e,"https://null.example").pathname)}static resolve(e,i){if(!this.isRelativePath(i))return i;const s=e.split("/"),a=i.split("/");s.pop();for(let h=0;h<a.length;h++)a[h]!=="."&&(a[h]===".."?s.pop():s.push(a[h]));return s.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}mw.DEFAULT_INIT={},mw.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const oy=c=>c,vL=new Set;class NP extends kP{constructor(e,i=""){super(e),this[Bl].name=i,this.init(),this.dispatchEvent({type:"create"})}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new this.constructor(this.graph).copy(this,oy)}copy(e,i=oy){for(const s in this[Bl]){const a=this[Bl][s];if(a instanceof sy)this[YE].has(s)||a.dispose();else if(Array.isArray(a)&&a[0]instanceof sy)for(const h of a)h.dispose();else if(rA(a)&&Object.values(a)[0]instanceof sy)for(const h in a)a[h].dispose()}for(const s in e[Bl]){const a=this[Bl][s],h=e[Bl][s];if(h instanceof sy)this[YE].has(s)?a.getChild().copy(i(h.getChild()),i):this.setRef(s,i(h.getChild()),h.getAttributes());else if(Array.isArray(h)&&h[0]instanceof sy)for(const f of h)this.addRef(s,i(f.getChild()),f.getAttributes());else if(rA(h)&&Object.values(h)[0]instanceof sy)for(const f in h){const k=h[f];this.setRefMap(s,f,i(k.getChild()),k.getAttributes())}else this[Bl][s]=rA(h)?JSON.parse(JSON.stringify(h)):Array.isArray(h)||h instanceof ArrayBuffer||ArrayBuffer.isView(h)?h.slice():h}return this}equals(e,i=vL){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const s in this[Bl]){if(i.has(s))continue;const a=this[Bl][s],h=e[Bl][s];if(PP(a)||PP(h)){if(!pL(a,h))return!1}else if(DP(a)||DP(h)){if(!fL(a,h))return!1}else if(RP(a)||RP(h)){if(!mL(a,h))return!1}else if(rA(a)||rA(h)){if(!bR(a,h))return!1}else if(bI(a)||bI(h)){if(!xR(a,h))return!1}else if(a!==h)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class km extends NP{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,i){return i&&i.t(this),this.setRefMap("extensions",e,i)}listExtensions(){return this.listRefMapValues("extensions")}}class ms extends km{constructor(...e){super(...e),this.i=Tu.identity,this.o=Tu.identity}init(){this.propertyType=Yr.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:ms.Type.SCALAR,componentType:ms.ComponentType.FLOAT,normalized:!1,buffer:null})}copy(e,i=oy){return super.copy(e,i),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case ms.Type.SCALAR:return 1;case ms.Type.VEC2:return 2;case ms.Type.VEC3:return 3;case ms.Type.VEC4:case ms.Type.MAT2:return 4;case ms.Type.MAT3:return 9;case ms.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case ms.ComponentType.BYTE:case ms.ComponentType.UNSIGNED_BYTE:return 1;case ms.ComponentType.SHORT:case ms.ComponentType.UNSIGNED_SHORT:return 2;case ms.ComponentType.UNSIGNED_INT:case ms.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const i=this.getElementSize();this.getMin(e);for(let s=0;s<i;s++)e[s]=this.o(e[s]);return e}getMin(e){const i=this.get("array"),s=this.getCount(),a=this.getElementSize();for(let h=0;h<a;h++)e[h]=1/0;for(let h=0;h<s*a;h+=a)for(let f=0;f<a;f++){const k=i[h+f];Number.isFinite(k)&&(e[f]=Math.min(e[f],k))}return e}getMaxNormalized(e){const i=this.getElementSize();this.getMax(e);for(let s=0;s<i;s++)e[s]=this.o(e[s]);return e}getMax(e){const i=this.get("array"),s=this.getCount(),a=this.getElementSize();for(let h=0;h<a;h++)e[h]=-1/0;for(let h=0;h<s*a;h+=a)for(let f=0;f<a;f++){const k=i[h+f];Number.isFinite(k)&&(e[f]=Math.max(e[f],k))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return ms.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=i=>Tu.denormalize(i,this.get("componentType")),this.i=i=>Tu.normalize(i,this.get("componentType"))):(this.o=Tu.identity,this.i=Tu.identity),this}getScalar(e){const i=this.getElementSize();return this.o(this.get("array")[e*i])}setScalar(e,i){return this.get("array")[e*this.getElementSize()]=this.i(i),this}getElement(e,i){const s=this.getElementSize(),a=this.get("array");for(let h=0;h<s;h++)i[h]=this.o(a[e*s+h]);return i}setElement(e,i){const s=this.getElementSize(),a=this.get("array");for(let h=0;h<s;h++)a[e*s+h]=this.i(i[h]);return this}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(i){switch(i.constructor){case Float32Array:return ms.ComponentType.FLOAT;case Uint32Array:return ms.ComponentType.UNSIGNED_INT;case Uint16Array:return ms.ComponentType.UNSIGNED_SHORT;case Uint8Array:return ms.ComponentType.UNSIGNED_BYTE;case Int16Array:return ms.ComponentType.SHORT;case Int8Array:return ms.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):ms.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}ms.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},ms.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class CR extends km{init(){this.propertyType=Yr.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class FP extends km{init(){this.propertyType=Yr.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}FP.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class XE extends km{init(){this.propertyType=Yr.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:XE.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:d0.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:d0.OTHER})}}XE.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class MR extends km{init(){this.propertyType=Yr.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class Xx extends km{init(){this.propertyType=Yr.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:Xx.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}Xx.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class Gu extends NP{t(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}Gu.EXTENSION_NAME=void 0;class hu extends km{init(){this.propertyType=Yr.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:hu.WrapMode.REPEAT,wrapT:hu.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}hu.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},hu.MagFilter={NEAREST:9728,LINEAR:9729},hu.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:EI,G:SI,B:CI,A:_L}=Qu;class Kx extends km{init(){this.propertyType=Yr.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:Kx.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new hu(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new hu(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new hu(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new hu(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new hu(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const i=this.get("baseColorFactor").slice();return i[3]=e,this.set("baseColorFactor",i)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return sv.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const i=this.get("baseColorFactor").slice();return this.set("baseColorFactor",sv.hexToFactor(e,i))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:EI|SI|CI|_L})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return sv.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const i=this.get("emissiveFactor").slice();return this.set("emissiveFactor",sv.hexToFactor(e,i))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:EI|SI|CI})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:EI|SI|CI})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:EI})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:SI|CI})}}Kx.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class TR extends km{init(){this.propertyType=Yr.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class MI extends km{constructor(...e){super(...e),this.u=null}init(){this.propertyType=Yr.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(e,i=oy){if(i===oy)throw new Error("Node cannot be copied.");return super.copy(e,i)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return Tu.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const i=this.get("translation").slice(),s=this.get("rotation").slice(),a=this.get("scale").slice();return Tu.decompose(e,i,s,a),this.set("translation",i).set("rotation",s).set("scale",a)}getWorldTranslation(){const e=[0,0,0];return Tu.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return Tu.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return Tu.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let a=this;a instanceof MI;a=a.u)e.push(a);let i;const s=e.pop().getMatrix();for(;i=e.pop();)uL(s,s,i.getMatrix());return s}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const i=this[Bl].children;return i[i.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const i of this.listChildren())i.traverse(e);return this}}class $x extends km{init(){this.propertyType=Yr.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:$x.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:d0.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,i){return this.setRefMap("attributes",e,i,{usage:d0.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}$x.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class yL extends NP{init(){this.propertyType=Yr.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,i){return this.setRefMap("attributes",e,i,{usage:d0.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function ov(){return(ov=Object.assign||function(c){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(c[s]=i[s])}return c}).apply(this,arguments)}class IR extends km{init(){this.propertyType=Yr.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(e,i=oy){if(i===oy)throw new Error("Scene cannot be copied.");return super.copy(e,i)}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const i=this[Bl].children;return i[i.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const i of this.listChildren())i.traverse(e);return this}}class PR extends km{init(){this.propertyType=Yr.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:d0.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class DR extends km{init(){this.propertyType=Yr.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||nA.extensionToMimeType(Yx.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e),this.set("mimeType",nA.extensionToMimeType(Yx.extension(e))),this}getImage(){return this.get("image")}setImage(e){return this.set("image",jo.assertView(e))}getSize(){const e=this.get("image");return e?nA.getSize(e,this.getMimeType()):null}}class RR extends km{init(){this.propertyType=Yr.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:"glTF-Transform v2.2.3",version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.h=new Set,e.addEventListener("node:create",i=>{this.l(i.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,i=oy){if(i===oy)throw new Error("Root cannot be copied.");this.set("asset",ov({},e.get("asset"))),this.setName(e.getName()),this.setExtras(ov({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?i(e.getDefaultScene()):null);for(const s of e.listRefMapKeys("extensions")){const a=e.getExtension(s);this.setExtension(s,i(a))}return this}l(e){return e instanceof IR?this.addRef("scenes",e):e instanceof MI?this.addRef("nodes",e):e instanceof Xx?this.addRef("cameras",e):e instanceof PR?this.addRef("skins",e):e instanceof TR?this.addRef("meshes",e):e instanceof Kx?this.addRef("materials",e):e instanceof DR?this.addRef("textures",e):e instanceof CR?this.addRef("animations",e):e instanceof ms?this.addRef("accessors",e):e instanceof MR&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.h)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}g(e){return this.h.add(e),this}p(e){return this.h.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class UP{constructor(){this.m=new lL,this.T=new RR(this.m),this.v=Ov.DEFAULT_INSTANCE}getRoot(){return this.T}getGraph(){return this.m}getLogger(){return this.v}setLogger(e){return this.v=e,this}clone(){return new UP().setLogger(this.v).merge(this)}merge(e){for(const h of e.getRoot().listExtensionsUsed()){const f=this.createExtension(h.constructor);h.isRequired()&&f.setRequired(!0)}const i=new Set,s=new Map;i.add(e.T),s.set(e.T,this.T);for(const h of e.m.listEdges())for(const f of[h.getParent(),h.getChild()]){if(i.has(f))continue;let k;k=f.propertyType===Yr.TEXTURE_INFO?f:new f.constructor(this.m),s.set(f,k),i.add(f)}const a=h=>{const f=s.get(h);if(!f)throw new Error("Could resolve property.");return f};for(const h of i){const f=s.get(h);if(!f)throw new Error("Could resolve property.");f.propertyType!==Yr.TEXTURE_INFO&&f.copy(h,a)}return this}async transform(...e){const i=e.map(s=>s.name);for(const s of e)await s(this,{stack:i});return this}createExtension(e){const i=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(s=>s.extensionName===i)||new e(this)}createScene(e=""){return new IR(this.m,e)}createNode(e=""){return new MI(this.m,e)}createCamera(e=""){return new Xx(this.m,e)}createSkin(e=""){return new PR(this.m,e)}createMesh(e=""){return new TR(this.m,e)}createPrimitive(){return new $x(this.m)}createPrimitiveTarget(e=""){return new yL(this.m,e)}createMaterial(e=""){return new Kx(this.m,e)}createTexture(e=""){return new DR(this.m,e)}createAnimation(e=""){return new CR(this.m,e)}createAnimationChannel(e=""){return new FP(this.m,e)}createAnimationSampler(e=""){return new XE(this.m,e)}createAccessor(e="",i=null){return i||(i=this.getRoot().listBuffers()[0]),new ms(this.m,e).setBuffer(i)}createBuffer(e=""){return new MR(this.m,e)}}class Au{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this.S=void 0,this.document=e,e.getRoot().g(this),this.S=s=>{const a=s,h=a.target;h instanceof Gu&&h.extensionName===this.extensionName&&(a.type==="node:create"&&this.M(h),a.type==="node:dispose"&&this.I(h))};const i=e.getGraph();i.addEventListener("node:create",this.S),i.addEventListener("node:dispose",this.S)}dispose(){this.document.getRoot().p(this);const e=this.document.getGraph();e.removeEventListener("node:create",this.S),e.removeEventListener("node:dispose",this.S);for(const i of this.properties)i.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}M(e){return this.properties.add(e),this}I(e){return this.properties.delete(e),this}install(e,i){return this}preread(e,i){return this}prewrite(e,i){return this}}Au.EXTENSION_NAME=void 0;class AL{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,i){this.textureInfos.set(e,i),i.texCoord!==void 0&&e.setTexCoord(i.texCoord);const s=this.jsonDoc.json.textures[i.index];if(s.sampler===void 0)return;const a=this.jsonDoc.json.samplers[s.sampler];a.magFilter!==void 0&&e.setMagFilter(a.magFilter),a.minFilter!==void 0&&e.setMinFilter(a.minFilter),a.wrapS!==void 0&&e.setWrapS(a.wrapS),a.wrapT!==void 0&&e.setWrapT(a.wrapT)}}const jP={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},kR={logger:Ov.DEFAULT_INSTANCE,extensions:[],dependencies:{}};function TI(c,e){const i=e.bufferViews[c.bufferView],s=e.jsonDoc.json.bufferViews[c.bufferView],a=jP[c.componentType],h=ms.getElementSize(c.type),f=a.BYTES_PER_ELEMENT;if(s.byteStride!==void 0&&s.byteStride!==h*f)return function(et,tt){const rt=tt.bufferViews[et.bufferView],lt=tt.jsonDoc.json.bufferViews[et.bufferView],pt=jP[et.componentType],ft=ms.getElementSize(et.type),vt=pt.BYTES_PER_ELEMENT,yt=et.byteOffset||0,Mt=new pt(et.count*ft),xt=new DataView(rt.buffer,rt.byteOffset,rt.byteLength),Et=lt.byteStride;for(let At=0;At<et.count;At++)for(let Rt=0;Rt<ft;Rt++){const Bt=yt+At*Et+Rt*vt;let Qt;switch(et.componentType){case ms.ComponentType.FLOAT:Qt=xt.getFloat32(Bt,!0);break;case ms.ComponentType.UNSIGNED_INT:Qt=xt.getUint32(Bt,!0);break;case ms.ComponentType.UNSIGNED_SHORT:Qt=xt.getUint16(Bt,!0);break;case ms.ComponentType.UNSIGNED_BYTE:Qt=xt.getUint8(Bt);break;case ms.ComponentType.SHORT:Qt=xt.getInt16(Bt,!0);break;case ms.ComponentType.BYTE:Qt=xt.getInt8(Bt);break;default:throw new Error(`Unexpected componentType "${et.componentType}".`)}Mt[At*ft+Rt]=Qt}return Mt}(c,e);const k=i.byteOffset+(c.byteOffset||0);return new a(i.buffer.slice(k,k+c.count*h*f))}var tM;(function(c){c[c.ARRAY_BUFFER=34962]="ARRAY_BUFFER",c[c.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(tM||(tM={}));class g_{constructor(e,i,s){this.N=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.O=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.N=e,this.jsonDoc=i,this.options=s;const a=e.getRoot(),h=a.listBuffers().length,f=a.listTextures().length;this.bufferURIGenerator=new BR(h>1,s.basename),this.imageURIGenerator=new BR(f>1,s.basename),this.logger=e.getLogger()}createTextureInfoDef(e,i){const s={magFilter:i.getMagFilter()||void 0,minFilter:i.getMinFilter()||void 0,wrapS:i.getWrapS(),wrapT:i.getWrapT()},a=JSON.stringify(s);this.samplerDefIndexMap.has(a)||(this.samplerDefIndexMap.set(a,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(s));const h={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(a)},f=JSON.stringify(h);this.textureDefIndexMap.has(f)||(this.textureDefIndexMap.set(f,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(h));const k={index:this.textureDefIndexMap.get(f)};return i.getTexCoord()!==0&&(k.texCoord=i.getTexCoord()),this.textureInfoDefMap.set(i,k),k}createPropertyDef(e){const i={};return e.getName()&&(i.name=e.getName()),Object.keys(e.getExtras()).length>0&&(i.extras=e.getExtras()),i}createAccessorDef(e){const i=this.createPropertyDef(e);return i.type=e.getType(),i.componentType=e.getComponentType(),i.count=e.getCount(),this.N.getGraph().listParentEdges(e).some(s=>s.getName()==="attributes"&&s.getAttributes().key==="POSITION"||s.getName()==="input")&&(i.max=e.getMax([]).map(Math.fround),i.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(i.normalized=e.getNormalized()),i}createImageData(e,i,s){if(this.options.format===m_.GLB)this.imageBufferViews.push(i),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:i.byteLength});else{const a=nA.mimeTypeToExtension(s.getMimeType());e.uri=this.imageURIGenerator.createURI(s,a),this.jsonDoc.resources[e.uri]=i}}getAccessorUsage(e){const i=this.O.get(e);if(i)return i;for(const s of this.N.getGraph().listParentEdges(e)){const{usage:a}=s.getAttributes();if(a)return a;s.getParent().propertyType!==Yr.ROOT&&this.N.getLogger().warn(`Missing attribute ".usage" on edge, "${s.getName()}".`)}return g_.BufferViewUsage.OTHER}addAccessorToUsageGroup(e,i){const s=this.O.get(e);if(s&&s!==i)throw new Error(`Accessor with usage "${s}" cannot be reused as "${i}".`);return this.O.set(e,i),this}listAccessorUsageGroups(){const e={};for(const[i,s]of Array.from(this.O.entries()))e[s]=e[s]||[],e[s].push(i);return e}}g_.BufferViewTarget=tM,g_.BufferViewUsage=d0,g_.USAGE_TO_TARGET={[d0.ARRAY_BUFFER]:tM.ARRAY_BUFFER,[d0.ELEMENT_ARRAY_BUFFER]:tM.ELEMENT_ARRAY_BUFFER};class BR{constructor(e,i){this.multiple=void 0,this.basename=void 0,this.counter=1,this.multiple=e,this.basename=i}createURI(e,i){return e.getURI()?e.getURI():this.multiple?`${this.basename}_${this.counter++}.${i}`:`${this.basename}.${i}`}}const{BufferViewUsage:zP}=g_;var II;(function(c){c[c.JSON=1313821514]="JSON",c[c.BIN=5130562]="BIN"})(II||(II={}));class wL extends class{constructor(){this.v=Ov.DEFAULT_INSTANCE,this.h=new Set,this.C={},this.F=wI.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this.v=e,this}registerExtensions(e){for(const i of e)this.h.add(i),i.register();return this}registerDependencies(e){return Object.assign(this.C,e),this}setVertexLayout(e){return this.F=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){return e.match(/^data:application\/octet-stream;/)||this.detectFormat(e)===m_.GLB?this.U(e):this.P(e)}async readJSON(e){return e=this.j(e),this.L(e),(class{static read(i,s=kR){const a=ov({},kR,s),{json:h}=i,f=new UP;this.validate(i,a);const k=new AL(i),et=h.asset,tt=f.getRoot().getAsset();et.copyright&&(tt.copyright=et.copyright),et.extras&&(tt.extras=et.extras),h.extras!==void 0&&f.getRoot().setExtras(ov({},h.extras));const rt=h.extensionsUsed||[],lt=h.extensionsRequired||[];for(const Et of a.extensions)if(rt.includes(Et.EXTENSION_NAME)){const At=f.createExtension(Et).setRequired(lt.includes(Et.EXTENSION_NAME));for(const Rt of At.readDependencies)At.install(Rt,a.dependencies[Rt])}const pt=h.buffers||[];f.getRoot().listExtensionsUsed().filter(Et=>Et.prereadTypes.includes(Yr.BUFFER)).forEach(Et=>Et.preread(k,Yr.BUFFER)),k.buffers=pt.map(Et=>{const At=f.createBuffer(Et.name);return Et.extras&&At.setExtras(Et.extras),Et.uri&&Et.uri.indexOf("__")!==0&&At.setURI(Et.uri),At}),k.bufferViewBuffers=(h.bufferViews||[]).map((Et,At)=>{if(!k.bufferViews[At]){const Rt=i.json.buffers[Et.buffer];k.bufferViews[At]=jo.toView(Rt.uri?i.resources[Rt.uri]:i.resources["@glb.bin"],Et.byteOffset||0,Et.byteLength)}return k.buffers[Et.buffer]}),k.accessors=(h.accessors||[]).map(Et=>{const At=f.createAccessor(Et.name,k.bufferViewBuffers[Et.bufferView]).setType(Et.type);if(Et.extras&&At.setExtras(Et.extras),Et.normalized!==void 0&&At.setNormalized(Et.normalized),Et.bufferView===void 0&&!Et.sparse)return At;let Rt;return Rt=Et.sparse!==void 0?function(Bt,Qt){const Wt=jP[Bt.componentType],tn=ms.getElementSize(Bt.type);let pn;pn=Bt.bufferView!==void 0?TI(Bt,Qt):new Wt(Bt.count*tn);const yn=Bt.sparse,En=yn.count,wn=ov({},Bt,yn.indices,{count:En,type:"SCALAR"}),In=ov({},Bt,yn.values,{count:En}),xn=TI(wn,Qt),Cn=TI(In,Qt);for(let Fn=0;Fn<wn.count;Fn++)for(let Tn=0;Tn<tn;Tn++)pn[xn[Fn]*tn+Tn]=Cn[Fn*tn+Tn];return pn}(Et,k):TI(Et,k),At.setArray(Rt),At});const ft=h.images||[],vt=h.textures||[];f.getRoot().listExtensionsUsed().filter(Et=>Et.prereadTypes.includes(Yr.TEXTURE)).forEach(Et=>Et.preread(k,Yr.TEXTURE)),k.textures=ft.map(Et=>{const At=f.createTexture(Et.name);if(Et.extras&&At.setExtras(Et.extras),Et.bufferView!==void 0){const Rt=h.bufferViews[Et.bufferView],Bt=i.json.buffers[Rt.buffer],Qt=Rt.byteOffset||0,Wt=(Bt.uri?i.resources[Bt.uri]:i.resources["@glb.bin"]).slice(Qt,Qt+Rt.byteLength);At.setImage(Wt)}else Et.uri!==void 0&&(At.setImage(i.resources[Et.uri]),Et.uri.indexOf("__")!==0&&At.setURI(Et.uri));if(Et.mimeType!==void 0)At.setMimeType(Et.mimeType);else if(Et.uri){const Rt=Yx.extension(Et.uri);At.setMimeType(nA.extensionToMimeType(Rt))}return At}),k.materials=(h.materials||[]).map(Et=>{const At=f.createMaterial(Et.name);Et.extras&&At.setExtras(Et.extras),Et.alphaMode!==void 0&&At.setAlphaMode(Et.alphaMode),Et.alphaCutoff!==void 0&&At.setAlphaCutoff(Et.alphaCutoff),Et.doubleSided!==void 0&&At.setDoubleSided(Et.doubleSided);const Rt=Et.pbrMetallicRoughness||{};if(Rt.baseColorFactor!==void 0&&At.setBaseColorFactor(Rt.baseColorFactor),Et.emissiveFactor!==void 0&&At.setEmissiveFactor(Et.emissiveFactor),Rt.metallicFactor!==void 0&&At.setMetallicFactor(Rt.metallicFactor),Rt.roughnessFactor!==void 0&&At.setRoughnessFactor(Rt.roughnessFactor),Rt.baseColorTexture!==void 0){const Bt=Rt.baseColorTexture;At.setBaseColorTexture(k.textures[vt[Bt.index].source]),k.setTextureInfo(At.getBaseColorTextureInfo(),Bt)}if(Et.emissiveTexture!==void 0){const Bt=Et.emissiveTexture;At.setEmissiveTexture(k.textures[vt[Bt.index].source]),k.setTextureInfo(At.getEmissiveTextureInfo(),Bt)}if(Et.normalTexture!==void 0){const Bt=Et.normalTexture;At.setNormalTexture(k.textures[vt[Bt.index].source]),k.setTextureInfo(At.getNormalTextureInfo(),Bt),Et.normalTexture.scale!==void 0&&At.setNormalScale(Et.normalTexture.scale)}if(Et.occlusionTexture!==void 0){const Bt=Et.occlusionTexture;At.setOcclusionTexture(k.textures[vt[Bt.index].source]),k.setTextureInfo(At.getOcclusionTextureInfo(),Bt),Et.occlusionTexture.strength!==void 0&&At.setOcclusionStrength(Et.occlusionTexture.strength)}if(Rt.metallicRoughnessTexture!==void 0){const Bt=Rt.metallicRoughnessTexture;At.setMetallicRoughnessTexture(k.textures[vt[Bt.index].source]),k.setTextureInfo(At.getMetallicRoughnessTextureInfo(),Bt)}return At});const yt=h.meshes||[];f.getRoot().listExtensionsUsed().filter(Et=>Et.prereadTypes.includes(Yr.PRIMITIVE)).forEach(Et=>Et.preread(k,Yr.PRIMITIVE)),k.meshes=yt.map(Et=>{const At=f.createMesh(Et.name);return Et.extras&&At.setExtras(Et.extras),Et.weights!==void 0&&At.setWeights(Et.weights),(Et.primitives||[]).forEach(Rt=>{const Bt=f.createPrimitive();Rt.extras&&Bt.setExtras(Rt.extras),Rt.material!==void 0&&Bt.setMaterial(k.materials[Rt.material]),Rt.mode!==void 0&&Bt.setMode(Rt.mode);for(const[Wt,tn]of Object.entries(Rt.attributes||{}))Bt.setAttribute(Wt,k.accessors[tn]);Rt.indices!==void 0&&Bt.setIndices(k.accessors[Rt.indices]);const Qt=Et.extras&&Et.extras.targetNames||[];(Rt.targets||[]).forEach((Wt,tn)=>{const pn=Qt[tn]||tn.toString(),yn=f.createPrimitiveTarget(pn);for(const[En,wn]of Object.entries(Wt))yn.setAttribute(En,k.accessors[wn]);Bt.addTarget(yn)}),At.addPrimitive(Bt)}),At}),k.cameras=(h.cameras||[]).map(Et=>{const At=f.createCamera(Et.name).setType(Et.type);if(Et.extras&&At.setExtras(Et.extras),Et.type===Xx.Type.PERSPECTIVE){const Rt=Et.perspective;At.setYFov(Rt.yfov),At.setZNear(Rt.znear),Rt.zfar!==void 0&&At.setZFar(Rt.zfar),Rt.aspectRatio!==void 0&&At.setAspectRatio(Rt.aspectRatio)}else{const Rt=Et.orthographic;At.setZNear(Rt.znear).setZFar(Rt.zfar).setXMag(Rt.xmag).setYMag(Rt.ymag)}return At});const Mt=h.nodes||[];f.getRoot().listExtensionsUsed().filter(Et=>Et.prereadTypes.includes(Yr.NODE)).forEach(Et=>Et.preread(k,Yr.NODE)),k.nodes=Mt.map(Et=>{const At=f.createNode(Et.name);if(Et.extras&&At.setExtras(Et.extras),Et.translation!==void 0&&At.setTranslation(Et.translation),Et.rotation!==void 0&&At.setRotation(Et.rotation),Et.scale!==void 0&&At.setScale(Et.scale),Et.matrix!==void 0){const Rt=[0,0,0],Bt=[0,0,0,1],Qt=[1,1,1];Tu.decompose(Et.matrix,Rt,Bt,Qt),At.setTranslation(Rt),At.setRotation(Bt),At.setScale(Qt)}return Et.weights!==void 0&&At.setWeights(Et.weights),At}),k.skins=(h.skins||[]).map(Et=>{const At=f.createSkin(Et.name);Et.extras&&At.setExtras(Et.extras),Et.inverseBindMatrices!==void 0&&At.setInverseBindMatrices(k.accessors[Et.inverseBindMatrices]),Et.skeleton!==void 0&&At.setSkeleton(k.nodes[Et.skeleton]);for(const Rt of Et.joints)At.addJoint(k.nodes[Rt]);return At}),Mt.map((Et,At)=>{const Rt=k.nodes[At];(Et.children||[]).forEach(Bt=>Rt.addChild(k.nodes[Bt])),Et.mesh!==void 0&&Rt.setMesh(k.meshes[Et.mesh]),Et.camera!==void 0&&Rt.setCamera(k.cameras[Et.camera]),Et.skin!==void 0&&Rt.setSkin(k.skins[Et.skin])}),k.animations=(h.animations||[]).map(Et=>{const At=f.createAnimation(Et.name);Et.extras&&At.setExtras(Et.extras);const Rt=(Et.samplers||[]).map(Bt=>{const Qt=f.createAnimationSampler().setInput(k.accessors[Bt.input]).setOutput(k.accessors[Bt.output]).setInterpolation(Bt.interpolation||XE.Interpolation.LINEAR);return Bt.extras&&Qt.setExtras(Bt.extras),At.addSampler(Qt),Qt});return(Et.channels||[]).forEach(Bt=>{const Qt=f.createAnimationChannel().setSampler(Rt[Bt.sampler]).setTargetPath(Bt.target.path);Bt.target.node!==void 0&&Qt.setTargetNode(k.nodes[Bt.target.node]),Bt.extras&&Qt.setExtras(Bt.extras),At.addChannel(Qt)}),At});const xt=h.scenes||[];return f.getRoot().listExtensionsUsed().filter(Et=>Et.prereadTypes.includes(Yr.SCENE)).forEach(Et=>Et.preread(k,Yr.SCENE)),k.scenes=xt.map(Et=>{const At=f.createScene(Et.name);return Et.extras&&At.setExtras(Et.extras),(Et.nodes||[]).map(Rt=>k.nodes[Rt]).forEach(Rt=>At.addChild(Rt)),At}),h.scene!==void 0&&f.getRoot().setDefaultScene(k.scenes[h.scene]),f.getRoot().listExtensionsUsed().forEach(Et=>Et.read(k)),f}static validate(i,s){const a=i.json;if(a.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${a.asset.version}".`);if(a.extensionsRequired){for(const h of a.extensionsRequired)if(!s.extensions.find(f=>f.EXTENSION_NAME===h))throw new Error(`Missing required extension, "${h}".`)}if(a.extensionsUsed)for(const h of a.extensionsUsed)s.extensions.find(f=>f.EXTENSION_NAME===h)||s.logger.warn(`Missing optional extension, "${h}".`)}}).read(e,{extensions:Array.from(this.h),dependencies:this.C,logger:this.v})}async binaryToJSON(e){const i=this._(jo.assertView(e));this.L(i);const s=i.json;if(s.buffers&&s.buffers.some(a=>function(h,f){return f.uri!==void 0&&!(f.uri in h.resources)}(i,a)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(s.images&&s.images.some(a=>function(h,f){return f.uri!==void 0&&!(f.uri in h.resources)&&f.bufferView===void 0}(i,a)))throw new Error("Cannot resolve external images with binaryToJSON().");return i}async readBinary(e){return this.readJSON(await this.binaryToJSON(jo.assertView(e)))}async writeJSON(e,i={}){if(i.format===m_.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 01 buffers.");return(class{static write(s,a){const h=s.getRoot(),f={asset:ov({generator:"glTF-Transform v2.2.3"},h.getAsset()),extras:ov({},h.getExtras())},k={json:f,resources:{}},et=new g_(s,k,a),tt=a.logger||Ov.DEFAULT_INSTANCE,rt=new Set(a.extensions.map(xt=>xt.EXTENSION_NAME)),lt=s.getRoot().listExtensionsUsed().filter(xt=>rt.has(xt.extensionName)),pt=s.getRoot().listExtensionsRequired().filter(xt=>rt.has(xt.extensionName));lt.length<s.getRoot().listExtensionsUsed().length&&tt.debug("Some extensions were not registered for I/O, and will not be written.");for(const xt of lt)for(const Et of xt.writeDependencies)xt.install(Et,a.dependencies[Et]);function ft(xt,Et,At,Rt){const Bt=[];let Qt=0;for(const tn of xt){const pn=et.createAccessorDef(tn);pn.bufferView=f.bufferViews.length;const yn=tn.getArray(),En=jo.pad(jo.toView(yn));pn.byteOffset=Qt,Qt+=En.byteLength,Bt.push(En),et.accessorIndexMap.set(tn,f.accessors.length),f.accessors.push(pn)}const Wt={buffer:Et,byteOffset:At,byteLength:jo.concat(Bt).byteLength};return Rt&&(Wt.target=Rt),f.bufferViews.push(Wt),{buffers:Bt,byteLength:Qt}}function vt(xt,Et,At){const Rt=xt[0].getCount();let Bt=0;for(const pn of xt){const yn=et.createAccessorDef(pn);yn.bufferView=f.bufferViews.length,yn.byteOffset=Bt;const En=pn.getElementSize(),wn=pn.getComponentSize();Bt+=jo.padNumber(En*wn),et.accessorIndexMap.set(pn,f.accessors.length),f.accessors.push(yn)}const Qt=Rt*Bt,Wt=new ArrayBuffer(Qt),tn=new DataView(Wt);for(let pn=0;pn<Rt;pn++){let yn=0;for(const En of xt){const wn=En.getElementSize(),In=En.getComponentSize(),xn=En.getComponentType(),Cn=En.getArray();for(let Fn=0;Fn<wn;Fn++){const Tn=pn*Bt+yn+Fn*In,Wn=Cn[pn*wn+Fn];switch(xn){case ms.ComponentType.FLOAT:tn.setFloat32(Tn,Wn,!0);break;case ms.ComponentType.BYTE:tn.setInt8(Tn,Wn);break;case ms.ComponentType.SHORT:tn.setInt16(Tn,Wn,!0);break;case ms.ComponentType.UNSIGNED_BYTE:tn.setUint8(Tn,Wn);break;case ms.ComponentType.UNSIGNED_SHORT:tn.setUint16(Tn,Wn,!0);break;case ms.ComponentType.UNSIGNED_INT:tn.setUint32(Tn,Wn,!0);break;default:throw new Error("Unexpected component type: "+xn)}}yn+=jo.padNumber(wn*In)}}return f.bufferViews.push({buffer:Et,byteOffset:At,byteLength:Qt,byteStride:Bt,target:g_.BufferViewTarget.ARRAY_BUFFER}),{byteLength:Qt,buffers:[new Uint8Array(Wt)]}}const yt=new Map;for(const xt of s.getGraph().listEdges()){if(xt.getParent()===h)continue;const Et=xt.getChild();if(Et instanceof ms){const At=yt.get(Et)||[];At.push(xt),yt.set(Et,At)}}if(f.accessors=[],f.bufferViews=[],f.samplers=[],f.textures=[],f.images=h.listTextures().map((xt,Et)=>{const At=et.createPropertyDef(xt);xt.getMimeType()&&(At.mimeType=xt.getMimeType());const Rt=xt.getImage();return Rt&&et.createImageData(At,Rt,xt),et.imageIndexMap.set(xt,Et),At}),lt.filter(xt=>xt.prewriteTypes.includes(Yr.ACCESSOR)).forEach(xt=>xt.prewrite(et,Yr.ACCESSOR)),h.listAccessors().forEach(xt=>{const Et=et.accessorUsageGroupedByParent,At=et.accessorParents;if(et.accessorIndexMap.has(xt))return;const Rt=yt.get(xt)||[],Bt=et.getAccessorUsage(xt);if(et.addAccessorToUsageGroup(xt,Bt),Et.has(Bt)){const Qt=Rt[0].getParent(),Wt=At.get(Qt)||new Set;Wt.add(xt),At.set(Qt,Wt)}}),lt.filter(xt=>xt.prewriteTypes.includes(Yr.BUFFER)).forEach(xt=>xt.prewrite(et,Yr.BUFFER)),(h.listAccessors().length>0||h.listTextures().length>0||et.otherBufferViews.size>0)&&h.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");f.buffers=[],h.listBuffers().forEach((xt,Et)=>{const At=et.createPropertyDef(xt),Rt=et.accessorUsageGroupedByParent,Bt=et.accessorParents,Qt=xt.listParents().filter(wn=>wn instanceof ms),Wt=new Set(Qt),tn=[],pn=f.buffers.length;let yn=0;const En=et.listAccessorUsageGroups();for(const wn in En)if(Rt.has(wn))for(const In of Array.from(Bt.values())){const xn=Array.from(In).filter(Cn=>Wt.has(Cn)).filter(Cn=>et.getAccessorUsage(Cn)===wn);if(xn.length)if(wn!==zP.ARRAY_BUFFER||a.vertexLayout===wI.INTERLEAVED){const Cn=wn===zP.ARRAY_BUFFER?vt(xn,pn,yn):ft(xn,pn,yn);yn+=Cn.byteLength,tn.push(...Cn.buffers)}else for(const Cn of xn){const Fn=vt([Cn],pn,yn);yn+=Fn.byteLength,tn.push(...Fn.buffers)}}else{const In=En[wn].filter(Cn=>Wt.has(Cn));if(!In.length)continue;const xn=ft(In,pn,yn,wn===zP.ELEMENT_ARRAY_BUFFER?g_.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0);yn+=xn.byteLength,tn.push(...xn.buffers)}if(et.imageBufferViews.length&&Et===0){for(let wn=0;wn<et.imageBufferViews.length;wn++)if(f.bufferViews[f.images[wn].bufferView].byteOffset=yn,yn+=et.imageBufferViews[wn].byteLength,tn.push(et.imageBufferViews[wn]),yn%8){const In=8-yn%8;yn+=In,tn.push(new Uint8Array(In))}}if(et.otherBufferViews.has(xt))for(const wn of et.otherBufferViews.get(xt))f.bufferViews.push({buffer:pn,byteOffset:yn,byteLength:wn.byteLength}),et.otherBufferViewsIndexMap.set(wn,f.bufferViews.length-1),yn+=wn.byteLength,tn.push(wn);if(yn){let wn;a.format===m_.GLB?wn="@glb.bin":(wn=et.bufferURIGenerator.createURI(xt,"bin"),At.uri=wn),At.byteLength=yn,k.resources[wn]=jo.concat(tn)}f.buffers.push(At),et.bufferIndexMap.set(xt,Et)}),h.listAccessors().find(xt=>!xt.getBuffer())&&tt.warn("Skipped writing one or more Accessors: no Buffer assigned."),f.materials=h.listMaterials().map((xt,Et)=>{const At=et.createPropertyDef(xt);if(xt.getAlphaMode()!==Kx.AlphaMode.OPAQUE&&(At.alphaMode=xt.getAlphaMode()),xt.getAlphaMode()===Kx.AlphaMode.MASK&&(At.alphaCutoff=xt.getAlphaCutoff()),xt.getDoubleSided()&&(At.doubleSided=!0),At.pbrMetallicRoughness={},Tu.eq(xt.getBaseColorFactor(),[1,1,1,1])||(At.pbrMetallicRoughness.baseColorFactor=xt.getBaseColorFactor()),Tu.eq(xt.getEmissiveFactor(),[0,0,0])||(At.emissiveFactor=xt.getEmissiveFactor()),xt.getRoughnessFactor()!==1&&(At.pbrMetallicRoughness.roughnessFactor=xt.getRoughnessFactor()),xt.getMetallicFactor()!==1&&(At.pbrMetallicRoughness.metallicFactor=xt.getMetallicFactor()),xt.getBaseColorTexture()){const Rt=xt.getBaseColorTexture(),Bt=xt.getBaseColorTextureInfo();At.pbrMetallicRoughness.baseColorTexture=et.createTextureInfoDef(Rt,Bt)}if(xt.getEmissiveTexture()){const Rt=xt.getEmissiveTexture(),Bt=xt.getEmissiveTextureInfo();At.emissiveTexture=et.createTextureInfoDef(Rt,Bt)}if(xt.getNormalTexture()){const Rt=xt.getNormalTexture(),Bt=xt.getNormalTextureInfo(),Qt=et.createTextureInfoDef(Rt,Bt);xt.getNormalScale()!==1&&(Qt.scale=xt.getNormalScale()),At.normalTexture=Qt}if(xt.getOcclusionTexture()){const Rt=xt.getOcclusionTexture(),Bt=xt.getOcclusionTextureInfo(),Qt=et.createTextureInfoDef(Rt,Bt);xt.getOcclusionStrength()!==1&&(Qt.strength=xt.getOcclusionStrength()),At.occlusionTexture=Qt}if(xt.getMetallicRoughnessTexture()){const Rt=xt.getMetallicRoughnessTexture(),Bt=xt.getMetallicRoughnessTextureInfo();At.pbrMetallicRoughness.metallicRoughnessTexture=et.createTextureInfoDef(Rt,Bt)}return et.materialIndexMap.set(xt,Et),At}),f.meshes=h.listMeshes().map((xt,Et)=>{const At=et.createPropertyDef(xt);let Rt=null;return At.primitives=xt.listPrimitives().map(Bt=>{const Qt={attributes:{}};Qt.mode=Bt.getMode();const Wt=Bt.getMaterial();Wt&&(Qt.material=et.materialIndexMap.get(Wt)),Object.keys(Bt.getExtras()).length&&(Qt.extras=Bt.getExtras());const tn=Bt.getIndices();tn&&(Qt.indices=et.accessorIndexMap.get(tn));for(const pn of Bt.listSemantics())Qt.attributes[pn]=et.accessorIndexMap.get(Bt.getAttribute(pn));for(const pn of Bt.listTargets()){const yn={};for(const En of pn.listSemantics())yn[En]=et.accessorIndexMap.get(pn.getAttribute(En));Qt.targets=Qt.targets||[],Qt.targets.push(yn)}return Bt.listTargets().length&&!Rt&&(Rt=Bt.listTargets().map(pn=>pn.getName())),Qt}),xt.getWeights().length&&(At.weights=xt.getWeights()),Rt&&(At.extras=At.extras||{},At.extras.targetNames=Rt),et.meshIndexMap.set(xt,Et),At}),f.cameras=h.listCameras().map((xt,Et)=>{const At=et.createPropertyDef(xt);if(At.type=xt.getType(),At.type===Xx.Type.PERSPECTIVE){At.perspective={znear:xt.getZNear(),zfar:xt.getZFar(),yfov:xt.getYFov()};const Rt=xt.getAspectRatio();Rt!==null&&(At.perspective.aspectRatio=Rt)}else At.orthographic={znear:xt.getZNear(),zfar:xt.getZFar(),xmag:xt.getXMag(),ymag:xt.getYMag()};return et.cameraIndexMap.set(xt,Et),At}),f.nodes=h.listNodes().map((xt,Et)=>{const At=et.createPropertyDef(xt);return Tu.eq(xt.getTranslation(),[0,0,0])||(At.translation=xt.getTranslation()),Tu.eq(xt.getRotation(),[0,0,0,1])||(At.rotation=xt.getRotation()),Tu.eq(xt.getScale(),[1,1,1])||(At.scale=xt.getScale()),xt.getWeights().length&&(At.weights=xt.getWeights()),et.nodeIndexMap.set(xt,Et),At}),f.skins=h.listSkins().map((xt,Et)=>{const At=et.createPropertyDef(xt),Rt=xt.getInverseBindMatrices();Rt&&(At.inverseBindMatrices=et.accessorIndexMap.get(Rt));const Bt=xt.getSkeleton();return Bt&&(At.skeleton=et.nodeIndexMap.get(Bt)),At.joints=xt.listJoints().map(Qt=>et.nodeIndexMap.get(Qt)),et.skinIndexMap.set(xt,Et),At}),h.listNodes().forEach((xt,Et)=>{const At=f.nodes[Et],Rt=xt.getMesh();Rt&&(At.mesh=et.meshIndexMap.get(Rt));const Bt=xt.getCamera();Bt&&(At.camera=et.cameraIndexMap.get(Bt));const Qt=xt.getSkin();Qt&&(At.skin=et.skinIndexMap.get(Qt)),xt.listChildren().length>0&&(At.children=xt.listChildren().map(Wt=>et.nodeIndexMap.get(Wt)))}),f.animations=h.listAnimations().map((xt,Et)=>{const At=et.createPropertyDef(xt),Rt=new Map;return At.samplers=xt.listSamplers().map((Bt,Qt)=>{const Wt=et.createPropertyDef(Bt);return Wt.input=et.accessorIndexMap.get(Bt.getInput()),Wt.output=et.accessorIndexMap.get(Bt.getOutput()),Wt.interpolation=Bt.getInterpolation(),Rt.set(Bt,Qt),Wt}),At.channels=xt.listChannels().map(Bt=>{const Qt=et.createPropertyDef(Bt);return Qt.sampler=Rt.get(Bt.getSampler()),Qt.target={node:et.nodeIndexMap.get(Bt.getTargetNode()),path:Bt.getTargetPath()},Qt}),et.animationIndexMap.set(xt,Et),At}),f.scenes=h.listScenes().map((xt,Et)=>{const At=et.createPropertyDef(xt);return At.nodes=xt.listChildren().map(Rt=>et.nodeIndexMap.get(Rt)),et.sceneIndexMap.set(xt,Et),At});const Mt=h.getDefaultScene();return Mt&&(f.scene=h.listScenes().indexOf(Mt)),f.extensionsUsed=lt.map(xt=>xt.extensionName),f.extensionsRequired=pt.map(xt=>xt.extensionName),lt.forEach(xt=>xt.write(et)),function(xt){const Et=[];for(const At in xt){const Rt=xt[At];(Array.isArray(Rt)&&Rt.length===0||Rt===null||Rt===""||Rt&&typeof Rt=="object"&&Object.keys(Rt).length===0)&&Et.push(At)}for(const At of Et)delete xt[At]}(f),k}}).write(e,{format:i.format||m_.GLTF,basename:i.basename||"",logger:this.v,vertexLayout:this.F,dependencies:ov({},this.C),extensions:Array.from(this.h)})}async writeBinary(e){const{json:i,resources:s}=await this.writeJSON(e,{format:m_.GLB}),a=new Uint32Array([1179937895,2,12]),h=JSON.stringify(i),f=jo.pad(jo.encodeText(h),32),k=jo.toView(new Uint32Array([f.byteLength,1313821514])),et=jo.concat([k,f]);a[a.length-1]+=et.byteLength;const tt=Object.values(s)[0];if(!tt||!tt.byteLength)return jo.concat([jo.toView(a),et]);const rt=jo.pad(tt,0),lt=jo.toView(new Uint32Array([rt.byteLength,5130562])),pt=jo.concat([lt,rt]);return a[a.length-1]+=pt.byteLength,jo.concat([jo.toView(a),et,pt])}detectFormat(e){return(mw.isAbsoluteURL(e)?mw.extension(e):Yx.extension(e))==="glb"?m_.GLB:m_.GLTF}async P(e){this.lastReadBytes=0;const i=await this.readURI(e,"text");this.lastReadBytes+=i.length;const s={json:JSON.parse(i),resources:{}};return await this.D(s,this.dirname(e)),this.L(s),s}async U(e){const i=await this.readURI(e,"view");this.lastReadBytes=i.byteLength;const s=this._(i);return await this.D(s,this.dirname(e)),this.L(s),s}async D(e,i){var s=this;const a=[...e.json.images||[],...e.json.buffers||[]].map(async function(h){const f=h.uri;if(!f||f.match(/data:/))return Promise.resolve();e.resources[f]=await s.readURI(s.resolve(i,f),"view"),s.lastReadBytes+=e.resources[f].byteLength});await Promise.all(a)}L(e){function i(s){if(s.uri){if(s.uri in e.resources)jo.assertView(e.resources[s.uri]);else if(s.uri.match(/data:/)){const a=`__${function(){for(let h=0;h<999;h++){const f=gL();if(!SR.has(f))return SR.add(f),f}return""}()}.${Yx.extension(s.uri)}`;e.resources[a]=jo.createBufferFromDataURI(s.uri),s.uri=a}}}(e.json.images||[]).forEach(s=>{if(s.bufferView===void 0&&s.uri===void 0)throw new Error("Missing resource URI or buffer view.");i(s)}),(e.json.buffers||[]).forEach(i)}j(e){const{images:i,buffers:s}=e.json;return e={json:ov({},e.json),resources:ov({},e.resources)},i&&(e.json.images=i.map(a=>ov({},a))),s&&(e.json.buffers=s.map(a=>ov({},a))),e}_(e){const i=new Uint32Array(e.buffer,e.byteOffset,3);if(i[0]!==1179937895)throw new Error("Invalid glTF asset.");if(i[1]!==2)throw new Error(`Unsupported glTF binary version, "${i[1]}".`);const s=new Uint32Array(e.buffer,e.byteOffset+12,2);if(s[1]!==II.JSON)throw new Error("Missing required GLB JSON chunk.");const a=s[0],h=jo.decodeText(jo.toView(e,20,a)),f=JSON.parse(h),k=20+a;if(e.byteLength<=k)return{json:f,resources:{}};const et=new Uint32Array(e.buffer,e.byteOffset+k,2);if(et[1]!==II.BIN)throw new Error("Expected GLB BIN in second chunk.");return{json:f,resources:{"@glb.bin":jo.toView(e,k+8,et[0])}}}}{constructor(e=mw.DEFAULT_INIT){super(),this.V=void 0,this.V=e}async readURI(e,i){const s=await fetch(e,this.V);switch(i){case"view":return new Uint8Array(await s.arrayBuffer());case"text":return s.text()}}resolve(e,i){return mw.resolve(e,i)}dirname(e){return mw.dirname(e)}detectFormat(e){return mw.extension(e)==="glb"?m_.GLB:m_.GLTF}}class xL{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class nM{constructor(e,i,s,a){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+i,s),this._littleEndian=a,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,i=0){const s=this._offset;let a=0;for(;this._dataView.getUint8(this._offset)!==i&&a<e;)a++,this._offset++;return a<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+s,a)}}const Bm=[171,75,84,88,32,50,48,187,13,10,26,10];function OR(c){return typeof TextDecoder<"u"?new TextDecoder().decode(c):Buffer.from(c).toString("utf8")}function VP(c){const e=new Uint8Array(c.buffer,c.byteOffset,Bm.length);if(e[0]!==Bm[0]||e[1]!==Bm[1]||e[2]!==Bm[2]||e[3]!==Bm[3]||e[4]!==Bm[4]||e[5]!==Bm[5]||e[6]!==Bm[6]||e[7]!==Bm[7]||e[8]!==Bm[8]||e[9]!==Bm[9]||e[10]!==Bm[10]||e[11]!==Bm[11])throw new Error("Missing KTX 2.0 identifier.");const i=new xL,s=17*Uint32Array.BYTES_PER_ELEMENT,a=new nM(c,Bm.length,s,!0);i.vkFormat=a._nextUint32(),i.typeSize=a._nextUint32(),i.pixelWidth=a._nextUint32(),i.pixelHeight=a._nextUint32(),i.pixelDepth=a._nextUint32(),i.layerCount=a._nextUint32(),i.faceCount=a._nextUint32();const h=a._nextUint32();i.supercompressionScheme=a._nextUint32();const f=a._nextUint32(),k=a._nextUint32(),et=a._nextUint32(),tt=a._nextUint32(),rt=a._nextUint64(),lt=a._nextUint64(),pt=new nM(c,Bm.length+s,3*h*8,!0);for(let Tn=0;Tn<h;Tn++)i.levels.push({levelData:new Uint8Array(c.buffer,c.byteOffset+pt._nextUint64(),pt._nextUint64()),uncompressedByteLength:pt._nextUint64()});const ft=new nM(c,f,k,!0),vt={vendorId:ft._skip(4)._nextUint16(),descriptorType:ft._nextUint16(),versionNumber:ft._nextUint16(),descriptorBlockSize:ft._nextUint16(),colorModel:ft._nextUint8(),colorPrimaries:ft._nextUint8(),transferFunction:ft._nextUint8(),flags:ft._nextUint8(),texelBlockDimension:[ft._nextUint8(),ft._nextUint8(),ft._nextUint8(),ft._nextUint8()],bytesPlane:[ft._nextUint8(),ft._nextUint8(),ft._nextUint8(),ft._nextUint8(),ft._nextUint8(),ft._nextUint8(),ft._nextUint8(),ft._nextUint8()],samples:[]},yt=(vt.descriptorBlockSize/4-6)/4;for(let Tn=0;Tn<yt;Tn++){const Wn={bitOffset:ft._nextUint16(),bitLength:ft._nextUint8(),channelType:ft._nextUint8(),samplePosition:[ft._nextUint8(),ft._nextUint8(),ft._nextUint8(),ft._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&Wn.channelType?(Wn.sampleLower=ft._nextInt32(),Wn.sampleUpper=ft._nextInt32()):(Wn.sampleLower=ft._nextUint32(),Wn.sampleUpper=ft._nextUint32()),vt.samples[Tn]=Wn}i.dataFormatDescriptor.length=0,i.dataFormatDescriptor.push(vt);const Mt=new nM(c,et,tt,!0);for(;Mt._offset<tt;){const Tn=Mt._nextUint32(),Wn=Mt._scan(Tn),or=OR(Wn),fr=Mt._scan(Tn-Wn.byteLength);i.keyValue[or]=or.match(/^ktx/i)?OR(fr):fr,Mt._offset%4&&Mt._skip(4-Mt._offset%4)}if(lt<=0)return i;const xt=new nM(c,rt,lt,!0),Et=xt._nextUint16(),At=xt._nextUint16(),Rt=xt._nextUint32(),Bt=xt._nextUint32(),Qt=xt._nextUint32(),Wt=xt._nextUint32(),tn=[];for(let Tn=0;Tn<h;Tn++)tn.push({imageFlags:xt._nextUint32(),rgbSliceByteOffset:xt._nextUint32(),rgbSliceByteLength:xt._nextUint32(),alphaSliceByteOffset:xt._nextUint32(),alphaSliceByteLength:xt._nextUint32()});const pn=rt+xt._offset,yn=pn+Rt,En=yn+Bt,wn=En+Qt,In=new Uint8Array(c.buffer,c.byteOffset+pn,Rt),xn=new Uint8Array(c.buffer,c.byteOffset+yn,Bt),Cn=new Uint8Array(c.buffer,c.byteOffset+En,Qt),Fn=new Uint8Array(c.buffer,c.byteOffset+wn,Wt);return i.globalData={endpointCount:Et,selectorCount:At,imageDescs:tn,endpointsData:In,selectorsData:xn,tablesData:Cn,extendedData:Fn},i}class LR extends Gu{init(){this.extensionName="EXT_mesh_gpu_instancing",this.propertyType="InstancedMesh",this.parentTypes=[Yr.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,i){return this.setRefMap("attributes",e,i,{usage:"INSTANCE_ATTRIBUTE"})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}LR.EXTENSION_NAME="EXT_mesh_gpu_instancing";const Jx="EXT_mesh_gpu_instancing";function gw(){return(gw=Object.assign||function(c){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(c[s]=i[s])}return c}).apply(this,arguments)}var rM,KE,Hu;(class extends Au{constructor(...c){super(...c),this.extensionName=Jx,this.provideTypes=[Yr.NODE],this.prewriteTypes=[Yr.ACCESSOR]}createInstancedMesh(){return new LR(this.document.getGraph())}read(c){return(c.jsonDoc.json.nodes||[]).forEach((e,i)=>{if(!e.extensions||!e.extensions[Jx])return;const s=e.extensions[Jx],a=this.createInstancedMesh();for(const h in s.attributes)a.setAttribute(h,c.accessors[s.attributes[h]]);c.nodes[i].setExtension(Jx,a)}),this}prewrite(c){c.accessorUsageGroupedByParent.add("INSTANCE_ATTRIBUTE");for(const e of this.properties)for(const i of e.listAttributes())c.addAccessorToUsageGroup(i,"INSTANCE_ATTRIBUTE");return this}write(c){const e=c.jsonDoc;return this.document.getRoot().listNodes().forEach(i=>{const s=i.getExtension(Jx);if(s){const a=c.nodeIndexMap.get(i),h=e.json.nodes[a],f={attributes:{}};s.listSemantics().forEach(k=>{const et=s.getAttribute(k);f.attributes[k]=c.accessorIndexMap.get(et)}),h.extensions=h.extensions||{},h.extensions[Jx]=f}}),this}}).EXTENSION_NAME=Jx,function(c){c.QUANTIZE="quantize",c.FILTER="filter"}(rM||(rM={})),function(c){c.ATTRIBUTES="ATTRIBUTES",c.TRIANGLES="TRIANGLES",c.INDICES="INDICES"}(KE||(KE={})),function(c){c.NONE="NONE",c.OCTAHEDRAL="OCTAHEDRAL",c.QUATERNION="QUATERNION",c.EXPONENTIAL="EXPONENTIAL"}(Hu||(Hu={}));const{BYTE:bL,SHORT:NR,FLOAT:EL}=ms.ComponentType,{normalize:FR,denormalize:QP}=Tu;function SL(c,e,i,s){const{filter:a,bits:h}=s,f={array:c.getArray(),byteStride:c.getElementSize()*c.getComponentSize(),componentType:c.getComponentType(),normalized:c.getNormalized()};if(i!==KE.ATTRIBUTES)return f;if(a!==Hu.NONE){let k=c.getNormalized()?function(et){const tt=et.getComponentType(),rt=et.getArray(),lt=new Float32Array(rt.length);for(let pt=0;pt<rt.length;pt++)lt[pt]=QP(rt[pt],tt);return lt}(c):new Float32Array(f.array);switch(a){case Hu.EXPONENTIAL:f.byteStride=4*c.getElementSize(),f.componentType=EL,f.normalized=!1,f.array=e.encodeFilterExp(k,c.getCount(),f.byteStride,h);break;case Hu.OCTAHEDRAL:f.byteStride=h>8?8:4,f.componentType=h>8?NR:bL,f.normalized=!0,k=c.getElementSize()===3?function(et){const tt=new Float32Array(4*et.length/3);for(let rt=0,lt=et.length/3;rt<lt;rt++)tt[4*rt]=et[3*rt],tt[4*rt+1]=et[3*rt+1],tt[4*rt+2]=et[3*rt+2];return tt}(k):k,f.array=e.encodeFilterOct(k,c.getCount(),f.byteStride,h);break;case Hu.QUATERNION:f.byteStride=8,f.componentType=NR,f.normalized=!0,f.array=e.encodeFilterQuat(k,c.getCount(),f.byteStride,h);break;default:throw new Error("Invalid filter.")}f.min=c.getMin([]),f.max=c.getMax([]),c.getNormalized()&&(f.min=f.min.map(et=>QP(et,c.getComponentType())),f.max=f.max.map(et=>QP(et,c.getComponentType()))),f.normalized&&(f.min=f.min.map(et=>FR(et,f.componentType)),f.max=f.max.map(et=>FR(et,f.componentType)))}else f.byteStride%4&&(f.array=function(k,et){const tt=jo.padNumber(k.BYTES_PER_ELEMENT*et)/k.BYTES_PER_ELEMENT,rt=new k.constructor(k.length/et*tt);for(let lt=0;lt*et<k.length;lt++)for(let pt=0;pt<et;pt++)rt[lt*tt+pt]=k[lt*et+pt];return rt}(f.array,c.getElementSize()),f.byteStride=f.array.byteLength/c.getCount());return f}function CL(c,e){return e===g_.BufferViewUsage.ELEMENT_ARRAY_BUFFER?c.listParents().some(i=>i instanceof $x&&i.getMode()===$x.Mode.TRIANGLES)?KE.TRIANGLES:KE.INDICES:KE.ATTRIBUTES}function ML(c,e){const i=e.getGraph().listParentEdges(c).filter(s=>!(s.getParent()instanceof RR));for(const s of i){const a=s.getName(),h=s.getAttributes().key||"";if(a==="indices")return{filter:Hu.NONE};if(a==="attributes"){if(h==="POSITION")return{filter:Hu.NONE};if(h==="TEXCOORD_0")return{filter:Hu.NONE};if(h==="NORMAL")return{filter:Hu.OCTAHEDRAL,bits:8};if(h==="TANGENT")return{filter:Hu.OCTAHEDRAL,bits:8};if(h.startsWith("JOINTS_"))return{filter:Hu.NONE};if(h.startsWith("WEIGHTS_"))return{filter:Hu.NONE}}if(a==="output"){const f=UR(c);return f==="rotation"?{filter:Hu.QUATERNION,bits:16}:f==="translation"||f==="scale"?{filter:Hu.EXPONENTIAL,bits:12}:{filter:Hu.NONE}}if(a==="input")return{filter:Hu.NONE};if(a==="inverseBindMatrices")return{filter:Hu.NONE}}return{filter:Hu.NONE}}function UR(c){for(const e of c.listParents())if(e instanceof XE){for(const i of e.listParents())if(i instanceof FP)return i.getTargetPath()}return null}const Om="EXT_meshopt_compression",jR={method:rM.QUANTIZE};class zR extends Au{constructor(...e){super(...e),this.extensionName=Om,this.prereadTypes=[Yr.BUFFER,Yr.PRIMITIVE],this.prewriteTypes=[Yr.BUFFER,Yr.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=jR,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,i){return e==="meshopt.decoder"&&(this._decoder=i),e==="meshopt.encoder"&&(this._encoder=i),this}setEncoderOptions(e){return this._encoderOptions=gw({},jR,e),this}preread(e,i){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${Om}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${Om}]: Missing WASM support.`)}return i===Yr.BUFFER?this._prereadBuffers(e):i===Yr.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const i=e.jsonDoc;(i.json.bufferViews||[]).forEach((s,a)=>{if(!s.extensions||!s.extensions[Om])return;const h=s.extensions[Om],f=h.byteOffset||0,k=h.byteLength||0,et=h.count,tt=h.byteStride,rt=new Uint8Array(et*tt),lt=i.json.buffers[s.buffer],pt=jo.toView(lt.uri?i.resources[lt.uri]:i.resources["@glb.bin"],f,k);this._decoder.decodeGltfBuffer(rt,et,tt,pt,h.mode,h.filter),e.bufferViews[a]=rt})}_prereadPrimitives(e){const i=e.jsonDoc;(i.json.bufferViews||[]).forEach(s=>{var a;s.extensions&&s.extensions[Om]&&(a=i.json.buffers[s.buffer]).extensions&&a.extensions.EXT_meshopt_compression&&a.extensions.EXT_meshopt_compression.fallback&&this._decoderFallbackBufferMap.set(e.buffers[s.buffer],e.buffers[s.extensions[Om].buffer])})}read(e){if(!this.isRequired())return this;for(const[i,s]of this._decoderFallbackBufferMap){for(const a of i.listParents())a instanceof ms&&a.swap(i,s);i.dispose()}return this}prewrite(e,i){return i===Yr.ACCESSOR?this._prewriteAccessors(e):i===Yr.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const i=e.jsonDoc.json,s=this._encoder,a=this._encoderOptions,h=this.document.createBuffer(),f=this.document.getRoot().listBuffers().indexOf(h);this._encoderFallbackBuffer=h,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const k of this.document.getRoot().listAccessors()){if(UR(k)==="weights")continue;const et=e.getAccessorUsage(k),tt=CL(k,et),rt=a.method===rM.FILTER?ML(k,this.document):{filter:Hu.NONE},lt=SL(k,s,tt,rt),{array:pt,byteStride:ft}=lt,vt=k.getBuffer();if(!vt)throw new Error(`${Om}: Missing buffer for accessor.`);const yt=this.document.getRoot().listBuffers().indexOf(vt),Mt=[et,tt,rt.filter,ft,yt].join(":");let xt=this._encoderBufferViews[Mt],Et=this._encoderBufferViewData[Mt],At=this._encoderBufferViewAccessors[Mt];xt&&Et||(At=this._encoderBufferViewAccessors[Mt]=[],Et=this._encoderBufferViewData[Mt]=[],xt=this._encoderBufferViews[Mt]={buffer:f,target:g_.USAGE_TO_TARGET[et],byteOffset:0,byteLength:0,byteStride:et===g_.BufferViewUsage.ARRAY_BUFFER?ft:void 0,extensions:{[Om]:{buffer:yt,byteOffset:0,byteLength:0,mode:tt,filter:rt.filter!==Hu.NONE?rt.filter:void 0,byteStride:ft,count:0}}});const Rt=e.createAccessorDef(k);Rt.componentType=lt.componentType,Rt.normalized=lt.normalized,Rt.byteOffset=xt.byteLength,Rt.min&&lt.min&&(Rt.min=lt.min),Rt.max&&lt.max&&(Rt.max=lt.max),e.accessorIndexMap.set(k,i.accessors.length),i.accessors.push(Rt),At.push(Rt),Et.push(new Uint8Array(pt.buffer,pt.byteOffset,pt.byteLength)),xt.byteLength+=pt.byteLength,xt.extensions.EXT_meshopt_compression.count+=k.getCount()}}_prewriteBuffers(e){const i=this._encoder;for(const s in this._encoderBufferViews){const a=this._encoderBufferViews[s],h=this._encoderBufferViewData[s],f=this.document.getRoot().listBuffers()[a.extensions[Om].buffer],k=e.otherBufferViews.get(f)||[],{count:et,byteStride:tt,mode:rt}=a.extensions[Om],lt=jo.concat(h),pt=i.encodeGltfBuffer(lt,et,tt,rt),ft=jo.pad(pt);a.extensions[Om].byteLength=pt.byteLength,h.length=0,h.push(ft),k.push(ft),e.otherBufferViews.set(f,k)}}write(e){let i=0;for(const f in this._encoderBufferViews){const k=this._encoderBufferViews[f],et=e.otherBufferViewsIndexMap.get(this._encoderBufferViewData[f][0]),tt=this._encoderBufferViewAccessors[f];for(const pt of tt)pt.bufferView=et;const rt=e.jsonDoc.json.bufferViews[et],lt=rt.byteOffset||0;Object.assign(rt,k),rt.byteOffset=i,rt.extensions[Om].byteOffset=lt,i+=jo.padNumber(k.byteLength)}const s=this._encoderFallbackBuffer,a=e.bufferIndexMap.get(s),h=e.jsonDoc.json.buffers[a];return h.byteLength=i,h.extensions={[Om]:{fallback:!0}},s.dispose(),this}}zR.EXTENSION_NAME=Om,zR.EncoderMethod=rM;const VR="EXT_texture_webp";class TL{match(e){return e.length>=12&&e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80}getSize(e){const i=jo.decodeText(e.slice(0,4)),s=jo.decodeText(e.slice(8,12));if(i!=="RIFF"||s!=="WEBP")return null;const a=new DataView(e.buffer,e.byteOffset);let h=12;for(;h<a.byteLength;){const f=jo.decodeText(new Uint8Array([a.getUint8(h),a.getUint8(h+1),a.getUint8(h+2),a.getUint8(h+3)])),k=a.getUint32(h+4,!0);if(f==="VP8 ")return[16383&a.getInt16(h+14,!0),16383&a.getInt16(h+16,!0)];if(f==="VP8L"){const et=a.getUint8(h+9),tt=a.getUint8(h+10),rt=a.getUint8(h+11);return[1+((63&tt)<<8|et),1+((15&a.getUint8(h+12))<<10|rt<<2|(192&tt)>>6)]}h+=8+k+k%2}return null}getChannels(e){return 4}}(class extends Au{constructor(...c){super(...c),this.extensionName=VR,this.prereadTypes=[Yr.TEXTURE]}static register(){nA.registerFormat("image/webp",new TL)}preread(c){return(c.jsonDoc.json.textures||[]).forEach(e=>{e.extensions&&e.extensions.EXT_texture_webp&&(e.source=e.extensions.EXT_texture_webp.source)}),this}read(c){return this}write(c){const e=c.jsonDoc;return this.document.getRoot().listTextures().forEach(i=>{if(i.getMimeType()==="image/webp"){const s=c.imageIndexMap.get(i);(e.json.textures||[]).forEach(a=>{a.source===s&&(a.extensions=a.extensions||{},a.extensions.EXT_texture_webp={source:a.source},delete a.source)})}}),this}}).EXTENSION_NAME=VR;const QR="KHR_draco_mesh_compression";let gp,GR,HR,av;function IL(c,e){const i=new gp.DecoderBuffer;try{if(i.Init(e,e.length),c.GetEncodedGeometryType(i)!==gp.TRIANGULAR_MESH)throw new Error(`[${QR}] Unknown geometry type.`);const s=new gp.Mesh;if(!c.DecodeBufferToMesh(i,s).ok()||s.ptr===0)throw new Error(`[${QR}] Decoding failure.`);return s}finally{gp.destroy(i)}}function PL(c,e){const i=3*e.num_faces();let s,a;if(e.num_points()<=65534){const h=i*Uint16Array.BYTES_PER_ELEMENT;s=gp._malloc(h),c.GetTrianglesUInt16Array(e,h,s),a=new Uint16Array(gp.HEAPU16.buffer,s,i).slice()}else{const h=i*Uint32Array.BYTES_PER_ELEMENT;s=gp._malloc(h),c.GetTrianglesUInt32Array(e,h,s),a=new Uint32Array(gp.HEAPU32.buffer,s,i).slice()}return gp._free(s),a}function DL(c,e,i,s){const a=HR[s.componentType],h=GR[s.componentType],f=i.num_components(),k=e.num_points()*f,et=k*h.BYTES_PER_ELEMENT,tt=gp._malloc(et);c.GetAttributeDataArrayForAllPoints(e,i,a,et,tt);const rt=new h(gp.HEAPF32.buffer,tt,k).slice();return gp._free(tt),rt}var iM,v_;(function(c){c[c.EDGEBREAKER=1]="EDGEBREAKER",c[c.SEQUENTIAL=0]="SEQUENTIAL"})(iM||(iM={})),function(c){c.POSITION="POSITION",c.NORMAL="NORMAL",c.COLOR="COLOR",c.TEX_COORD="TEX_COORD",c.GENERIC="GENERIC"}(v_||(v_={}));const WR={[v_.POSITION]:14,[v_.NORMAL]:10,[v_.COLOR]:8,[v_.TEX_COORD]:12,[v_.GENERIC]:12},qR={decodeSpeed:5,encodeSpeed:5,method:iM.EDGEBREAKER,quantizationBits:WR,quantizationVolume:"mesh"};function RL(c,e=qR){const i=gw({},qR,e);i.quantizationBits=gw({},WR,e.quantizationBits);const s=new av.Encoder,a=new av.MeshBuilder,h=new av.Mesh,f={},k=new av.DracoInt8Array;for(const vt of c.listSemantics()){const yt=c.getAttribute(vt),Mt=kL(vt),xt=BL(a,yt.getComponentType(),h,av[Mt],yt.getCount(),yt.getElementSize(),yt.getArray());if(xt===-1)throw new Error(`Error compressing "${vt}" attribute.`);if(f[vt]=xt,i.quantizationVolume==="mesh"||vt!=="POSITION")s.SetAttributeQuantization(av[Mt],i.quantizationBits[Mt]);else{if(typeof i.quantizationVolume!="object")throw new Error("Invalid quantization volume state.");{const{quantizationVolume:Et}=i,At=Math.max(Et.max[0]-Et.min[0],Et.max[1]-Et.min[1],Et.max[2]-Et.min[2]);s.SetAttributeExplicitQuantization(av[Mt],i.quantizationBits[Mt],yt.getElementSize(),Et.min,At)}}}const et=c.getIndices();if(!et)throw new Error("Primitive must have indices.");a.AddFacesToMesh(h,et.getCount()/3,et.getArray()),s.SetSpeedOptions(i.encodeSpeed,i.decodeSpeed),s.SetTrackEncodedProperties(!0),i.method===iM.SEQUENTIAL||c.listTargets().length>0?s.SetEncodingMethod(av.MESH_SEQUENTIAL_ENCODING):s.SetEncodingMethod(av.MESH_EDGEBREAKER_ENCODING);const tt=s.EncodeMeshToDracoBuffer(h,k);if(tt<=0)throw new Error("Error applying Draco compression.");const rt=new Uint8Array(tt);for(let vt=0;vt<tt;++vt)rt[vt]=k.GetValue(vt);const lt=c.getAttribute("POSITION").getCount(),pt=s.GetNumberOfEncodedPoints(),ft=3*s.GetNumberOfEncodedFaces();if(c.listTargets().length>0&&pt!==lt)throw new Error('Compression reduced vertex count unexpectedly, corrupting morph targets. Applying the "weld" function before compression may resolve the issue.');return av.destroy(k),av.destroy(h),av.destroy(a),av.destroy(s),{numVertices:pt,numIndices:ft,data:rt,attributeIDs:f}}function kL(c){return c==="POSITION"?v_.POSITION:c==="NORMAL"?v_.NORMAL:c.startsWith("COLOR_")?v_.COLOR:c.startsWith("TEXCOORD_")?v_.TEX_COORD:v_.GENERIC}function BL(c,e,i,s,a,h,f){switch(e){case ms.ComponentType.UNSIGNED_BYTE:return c.AddUInt8Attribute(i,s,a,h,f);case ms.ComponentType.BYTE:return c.AddInt8Attribute(i,s,a,h,f);case ms.ComponentType.UNSIGNED_SHORT:return c.AddUInt16Attribute(i,s,a,h,f);case ms.ComponentType.SHORT:return c.AddInt16Attribute(i,s,a,h,f);case ms.ComponentType.UNSIGNED_INT:return c.AddUInt32Attribute(i,s,a,h,f);case ms.ComponentType.FLOAT:return c.AddFloatAttribute(i,s,a,h,f);default:throw new Error(`Unexpected component type, "${e}".`)}}const sp="KHR_draco_mesh_compression";class sM extends Au{constructor(...e){super(...e),this.extensionName=sp,this.prereadTypes=[Yr.PRIMITIVE],this.prewriteTypes=[Yr.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,i){return e==="draco3d.decoder"&&(this._decoderModule=i,gp=this._decoderModule,GR={[ms.ComponentType.FLOAT]:Float32Array,[ms.ComponentType.UNSIGNED_INT]:Uint32Array,[ms.ComponentType.UNSIGNED_SHORT]:Uint16Array,[ms.ComponentType.UNSIGNED_BYTE]:Uint8Array,[ms.ComponentType.SHORT]:Int16Array,[ms.ComponentType.BYTE]:Int8Array},HR={[ms.ComponentType.FLOAT]:gp.DT_FLOAT32,[ms.ComponentType.UNSIGNED_INT]:gp.DT_UINT32,[ms.ComponentType.UNSIGNED_SHORT]:gp.DT_UINT16,[ms.ComponentType.UNSIGNED_BYTE]:gp.DT_UINT8,[ms.ComponentType.SHORT]:gp.DT_INT16,[ms.ComponentType.BYTE]:gp.DT_INT8}),e==="draco3d.encoder"&&(this._encoderModule=i,av=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${sp}] Please install extension dependency, "draco3d.decoder".`);const i=this.document.getLogger(),s=e.jsonDoc,a=new Map;try{const h=s.json.meshes||[];for(const f of h)for(const k of f.primitives){if(!k.extensions||!k.extensions[sp])continue;const et=k.extensions[sp];let[tt,rt]=a.get(et.bufferView)||[];if(!rt||!tt){const lt=s.json.bufferViews[et.bufferView],pt=s.json.buffers[lt.buffer],ft=jo.toView(pt.uri?s.resources[pt.uri]:s.resources["@glb.bin"],lt.byteOffset||0,lt.byteLength);tt=new this._decoderModule.Decoder,rt=IL(tt,ft),a.set(et.bufferView,[tt,rt]),i.debug(`[${sp}] Decompressed ${ft.byteLength} bytes.`)}for(const lt in k.attributes){const pt=e.jsonDoc.json.accessors[k.attributes[lt]],ft=tt.GetAttributeByUniqueId(rt,et.attributes[lt]),vt=DL(tt,rt,ft,pt);e.accessors[k.attributes[lt]].setArray(vt)}k.indices!==void 0&&e.accessors[k.indices].setArray(PL(tt,rt))}}finally{for(const[h,f]of Array.from(a.values()))this._decoderModule.destroy(h),this._decoderModule.destroy(f)}return this}read(e){return this}prewrite(e,i){if(!this._encoderModule)throw new Error(`[${sp}] Please install extension dependency, "draco3d.encoder".`);const s=this.document.getLogger();s.debug(`[${sp}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const a=function(k){const et=k.getLogger(),tt=new Set,rt=new Set;for(const Mt of k.getRoot().listMeshes())for(const xt of Mt.listPrimitives())xt.getIndices()?xt.getMode()!==$x.Mode.TRIANGLES?(rt.add(xt),et.warn(`[${sp}] Skipping Draco compression on non-TRIANGLES primitive.`)):tt.add(xt):(rt.add(xt),et.warn(`[${sp}] Skipping Draco compression on non-indexed primitive.`));const lt=k.getRoot().listAccessors(),pt=new Map;for(let Mt=0;Mt<lt.length;Mt++)pt.set(lt[Mt],Mt);const ft=new Map,vt=new Set,yt=new Map;for(const Mt of Array.from(tt)){let xt=YR(Mt,pt);if(vt.has(xt))yt.set(Mt,xt);else{if(ft.has(Mt.getIndices())){const Et=Mt.getIndices(),At=Et.clone();pt.set(At,k.getRoot().listAccessors().length-1),Mt.swap(Et,At)}for(const Et of Mt.listAttributes())if(ft.has(Et)){const At=Et.clone();pt.set(At,k.getRoot().listAccessors().length-1),Mt.swap(Et,At)}xt=YR(Mt,pt),vt.add(xt),yt.set(Mt,xt),ft.set(Mt.getIndices(),xt);for(const Et of Mt.listAttributes())ft.set(Et,xt)}}for(const Mt of Array.from(ft.keys())){const xt=new Set(Mt.listParents().map(Et=>Et.propertyType));if(xt.size!==2||!xt.has(Yr.PRIMITIVE)||!xt.has(Yr.ROOT))throw new Error(`[${sp}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const Mt of Array.from(tt)){const xt=yt.get(Mt),Et=Mt.getIndices();if(ft.get(Et)!==xt||Mt.listAttributes().some(At=>ft.get(At)!==xt))throw new Error(`[${sp}] Draco primitives must share all, or no, accessors.`)}for(const Mt of Array.from(rt)){const xt=Mt.getIndices();if(ft.has(xt)||Mt.listAttributes().some(Et=>ft.has(Et)))throw new Error(`[${sp}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return yt}(this.document),h=new Map;let f="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?s.warn(`[${sp}]: quantizationVolume=scene requires exactly 1 scene.`):f=function(k){const et={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},tt=k.propertyType===Yr.NODE?[k]:k.listChildren();for(const rt of tt)rt.traverse(lt=>{const pt=lt.getMesh();if(!pt)return;const ft=hL(pt,lt.getWorldMatrix());LP(ft.min,et),LP(ft.max,et)});return et}(this.document.getRoot().listScenes().pop()));for(const k of Array.from(a.keys())){const et=a.get(k);if(!et)throw new Error("Unexpected primitive.");if(h.has(et)){h.set(et,h.get(et));continue}const tt=k.getIndices(),rt=e.jsonDoc.json.accessors,lt=RL(k,gw({},this._encoderOptions,{quantizationVolume:f}));h.set(et,lt);const pt=e.createAccessorDef(tt);pt.count=lt.numIndices,e.accessorIndexMap.set(tt,rt.length),rt.push(pt);for(const vt of k.listSemantics()){const yt=k.getAttribute(vt),Mt=e.createAccessorDef(yt);Mt.count=lt.numVertices,e.accessorIndexMap.set(yt,rt.length),rt.push(Mt)}const ft=k.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(ft)||e.otherBufferViews.set(ft,[]),e.otherBufferViews.get(ft).push(lt.data)}return s.debug(`[${sp}] Compressed ${a.size} primitives.`),e.extensionData[sp]={primitiveHashMap:a,primitiveEncodingMap:h},this}write(e){const i=e.extensionData[sp];for(const s of this.document.getRoot().listMeshes()){const a=e.jsonDoc.json.meshes[e.meshIndexMap.get(s)];for(let h=0;h<s.listPrimitives().length;h++){const f=s.listPrimitives()[h],k=a.primitives[h],et=i.primitiveHashMap.get(f);if(!et)continue;const tt=i.primitiveEncodingMap.get(et);k.extensions=k.extensions||{},k.extensions[sp]={bufferView:e.otherBufferViewsIndexMap.get(tt.data),attributes:tt.attributeIDs}}}if(!i.primitiveHashMap.size){const s=e.jsonDoc.json;s.extensionsUsed=(s.extensionsUsed||[]).filter(a=>a!==sp),s.extensionsRequired=(s.extensionsRequired||[]).filter(a=>a!==sp)}return this}}function YR(c,e){const i=[],s=c.getIndices();i.push(e.get(s));for(const a of c.listAttributes())i.push(e.get(a));return i.sort().join("|")}sM.EXTENSION_NAME=sp,sM.EncoderMethod=iM;class $E extends Gu{init(){this.extensionName="KHR_lights_punctual",this.propertyType="Light",this.parentTypes=[Yr.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:$E.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getColorHex(){return sv.factorToHex(this.getColor())}setColorHex(e){const i=this.getColor().slice();return sv.hexToFactor(e,i),this.setColor(i)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}$E.EXTENSION_NAME="KHR_lights_punctual",$E.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const PI="KHR_lights_punctual";class XR extends Au{constructor(...e){super(...e),this.extensionName=PI}createLight(e=""){return new $E(this.document.getGraph(),e)}read(e){const i=e.jsonDoc;if(!i.json.extensions||!i.json.extensions.KHR_lights_punctual)return this;const s=(i.json.extensions.KHR_lights_punctual.lights||[]).map(a=>{var h,f;const k=this.createLight().setName(a.name||"").setType(a.type);return a.color!==void 0&&k.setColor(a.color),a.intensity!==void 0&&k.setIntensity(a.intensity),a.range!==void 0&&k.setRange(a.range),((h=a.spot)==null?void 0:h.innerConeAngle)!==void 0&&k.setInnerConeAngle(a.spot.innerConeAngle),((f=a.spot)==null?void 0:f.outerConeAngle)!==void 0&&k.setOuterConeAngle(a.spot.outerConeAngle),k});return i.json.nodes.forEach((a,h)=>{a.extensions&&a.extensions.KHR_lights_punctual&&e.nodes[h].setExtension(PI,s[a.extensions.KHR_lights_punctual.light])}),this}write(e){const i=e.jsonDoc;if(this.properties.size===0)return this;const s=[],a=new Map;for(const h of this.properties){const f=h,k={type:f.getType()};Tu.eq(f.getColor(),[1,1,1])||(k.color=f.getColor()),f.getIntensity()!==1&&(k.intensity=f.getIntensity()),f.getRange()!=null&&(k.range=f.getRange()),f.getName()&&(k.name=f.getName()),f.getType()===$E.Type.SPOT&&(k.spot={innerConeAngle:f.getInnerConeAngle(),outerConeAngle:f.getOuterConeAngle()}),s.push(k),a.set(f,s.length-1)}return this.document.getRoot().listNodes().forEach(h=>{const f=h.getExtension(PI);if(f){const k=e.nodeIndexMap.get(h),et=i.json.nodes[k];et.extensions=et.extensions||{},et.extensions.KHR_lights_punctual={light:a.get(f)}}}),i.json.extensions=i.json.extensions||{},i.json.extensions.KHR_lights_punctual={lights:s},this}}XR.EXTENSION_NAME=PI;const{R:KR,G:$R,B:OL}=Qu;class JR extends Gu{init(){this.extensionName="KHR_materials_clearcoat",this.propertyType="Clearcoat",this.parentTypes=[Yr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new hu(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new hu(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new hu(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:KR})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:$R})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:KR|$R|OL})}}JR.EXTENSION_NAME="KHR_materials_clearcoat";const Zx="KHR_materials_clearcoat";class ZR extends Au{constructor(...e){super(...e),this.extensionName=Zx}createClearcoat(){return new JR(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions[Zx]){const f=this.createClearcoat();e.materials[h].setExtension(Zx,f);const k=a.extensions[Zx];if(k.clearcoatFactor!==void 0&&f.setClearcoatFactor(k.clearcoatFactor),k.clearcoatRoughnessFactor!==void 0&&f.setClearcoatRoughnessFactor(k.clearcoatRoughnessFactor),k.clearcoatTexture!==void 0){const et=k.clearcoatTexture;f.setClearcoatTexture(e.textures[s[et.index].source]),e.setTextureInfo(f.getClearcoatTextureInfo(),et)}if(k.clearcoatRoughnessTexture!==void 0){const et=k.clearcoatRoughnessTexture;f.setClearcoatRoughnessTexture(e.textures[s[et.index].source]),e.setTextureInfo(f.getClearcoatRoughnessTextureInfo(),et)}if(k.clearcoatNormalTexture!==void 0){const et=k.clearcoatNormalTexture;f.setClearcoatNormalTexture(e.textures[s[et.index].source]),e.setTextureInfo(f.getClearcoatNormalTextureInfo(),et),et.scale!==void 0&&f.setClearcoatNormalScale(et.scale)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(Zx);if(a){const h=e.materialIndexMap.get(s),f=i.json.materials[h];f.extensions=f.extensions||{};const k=f.extensions[Zx]={clearcoatFactor:a.getClearcoatFactor(),clearcoatRoughnessFactor:a.getClearcoatRoughnessFactor()};if(a.getClearcoatTexture()){const et=a.getClearcoatTexture(),tt=a.getClearcoatTextureInfo();k.clearcoatTexture=e.createTextureInfoDef(et,tt)}if(a.getClearcoatRoughnessTexture()){const et=a.getClearcoatRoughnessTexture(),tt=a.getClearcoatRoughnessTextureInfo();k.clearcoatRoughnessTexture=e.createTextureInfoDef(et,tt)}if(a.getClearcoatNormalTexture()){const et=a.getClearcoatNormalTexture(),tt=a.getClearcoatNormalTextureInfo();k.clearcoatNormalTexture=e.createTextureInfoDef(et,tt),a.getClearcoatNormalScale()!==1&&(k.clearcoatNormalTexture.scale=a.getClearcoatNormalScale())}}}),this}}ZR.EXTENSION_NAME=Zx;class _k extends Gu{init(){this.extensionName="KHR_materials_emissive_strength",this.propertyType="EmissiveStrength",this.parentTypes=[Yr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}_k.EXTENSION_NAME="KHR_materials_emissive_strength";const _b="KHR_materials_emissive_strength";class eB extends Au{constructor(...e){super(...e),this.extensionName=_b}createEmissiveStrength(){return new _k(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((i,s)=>{if(i.extensions&&i.extensions[_b]){const a=this.createEmissiveStrength();e.materials[s].setExtension(_b,a);const h=i.extensions[_b];h.emissiveStrength!==void 0&&a.setEmissiveStrength(h.emissiveStrength)}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(_b);if(a){const h=e.materialIndexMap.get(s),f=i.json.materials[h];f.extensions=f.extensions||{},f.extensions[_b]={emissiveStrength:a.getEmissiveStrength()}}}),this}}eB.EXTENSION_NAME=_b;class tB extends Gu{init(){this.extensionName="KHR_materials_ior",this.propertyType="IOR",this.parentTypes=[Yr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:0})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}tB.EXTENSION_NAME="KHR_materials_ior";const DI="KHR_materials_ior";class nB extends Au{constructor(...e){super(...e),this.extensionName=DI}createIOR(){return new tB(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((i,s)=>{if(i.extensions&&i.extensions.KHR_materials_ior){const a=this.createIOR();e.materials[s].setExtension(DI,a);const h=i.extensions.KHR_materials_ior;h.ior!==void 0&&a.setIOR(h.ior)}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(DI);if(a){const h=e.materialIndexMap.get(s),f=i.json.materials[h];f.extensions=f.extensions||{},f.extensions.KHR_materials_ior={ior:a.getIOR()}}}),this}}nB.EXTENSION_NAME=DI;const{R:LL,G:NL}=Qu;class rB extends Gu{init(){this.extensionName="KHR_materials_iridescence",this.propertyType="Iridescence",this.parentTypes=[Yr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new hu(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new hu(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:LL})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:NL})}}rB.EXTENSION_NAME="KHR_materials_iridescence";const e1="KHR_materials_iridescence";class iB extends Au{constructor(...e){super(...e),this.extensionName=e1}createIridescence(){return new rB(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions[e1]){const f=this.createIridescence();e.materials[h].setExtension(e1,f);const k=a.extensions[e1];if(k.iridescenceFactor!==void 0&&f.setIridescenceFactor(k.iridescenceFactor),k.iridescenceIor!==void 0&&f.setIridescenceIOR(k.iridescenceIor),k.iridescenceThicknessMinimum!==void 0&&f.setIridescenceThicknessMinimum(k.iridescenceThicknessMinimum),k.iridescenceThicknessMaximum!==void 0&&f.setIridescenceThicknessMaximum(k.iridescenceThicknessMaximum),k.iridescenceTexture!==void 0){const et=k.iridescenceTexture;f.setIridescenceTexture(e.textures[s[et.index].source]),e.setTextureInfo(f.getIridescenceTextureInfo(),et)}if(k.iridescenceThicknessTexture!==void 0){const et=k.iridescenceThicknessTexture;f.setIridescenceThicknessTexture(e.textures[s[et.index].source]),e.setTextureInfo(f.getIridescenceThicknessTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(e1);if(a){const h=e.materialIndexMap.get(s),f=i.json.materials[h];f.extensions=f.extensions||{};const k=f.extensions[e1]={};if(a.getIridescenceFactor()>0&&(k.iridescenceFactor=a.getIridescenceFactor()),a.getIridescenceIOR()!==1.3&&(k.iridescenceIor=a.getIridescenceIOR()),a.getIridescenceThicknessMinimum()!==100&&(k.iridescenceThicknessMinimum=a.getIridescenceThicknessMinimum()),a.getIridescenceThicknessMaximum()!==400&&(k.iridescenceThicknessMaximum=a.getIridescenceThicknessMaximum()),a.getIridescenceTexture()){const et=a.getIridescenceTexture(),tt=a.getIridescenceTextureInfo();k.iridescenceTexture=e.createTextureInfoDef(et,tt)}if(a.getIridescenceThicknessTexture()){const et=a.getIridescenceThicknessTexture(),tt=a.getIridescenceThicknessTextureInfo();k.iridescenceThicknessTexture=e.createTextureInfoDef(et,tt)}}}),this}}iB.EXTENSION_NAME=e1;const{R:sB,G:oB,B:aB,A:lB}=Qu;class cB extends Gu{init(){this.extensionName="KHR_materials_pbrSpecularGlossiness",this.propertyType="PBRSpecularGlossiness",this.parentTypes=[Yr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new hu(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new hu(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseHex(){return sv.factorToHex(this.getDiffuseFactor())}setDiffuseHex(e){const i=this.getDiffuseFactor().slice();return this.setDiffuseFactor(sv.hexToFactor(e,i))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:sB|oB|aB|lB})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:sB|oB|aB|lB})}}cB.EXTENSION_NAME="KHR_materials_pbrSpecularGlossiness";const t1="KHR_materials_pbrSpecularGlossiness";class uB extends Au{constructor(...e){super(...e),this.extensionName=t1}createPBRSpecularGlossiness(){return new cB(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions[t1]){const f=this.createPBRSpecularGlossiness();e.materials[h].setExtension(t1,f);const k=a.extensions[t1];if(k.diffuseFactor!==void 0&&f.setDiffuseFactor(k.diffuseFactor),k.specularFactor!==void 0&&f.setSpecularFactor(k.specularFactor),k.glossinessFactor!==void 0&&f.setGlossinessFactor(k.glossinessFactor),k.diffuseTexture!==void 0){const et=k.diffuseTexture;f.setDiffuseTexture(e.textures[s[et.index].source]),e.setTextureInfo(f.getDiffuseTextureInfo(),et)}if(k.specularGlossinessTexture!==void 0){const et=k.specularGlossinessTexture;f.setSpecularGlossinessTexture(e.textures[s[et.index].source]),e.setTextureInfo(f.getSpecularGlossinessTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(t1);if(a){const h=e.materialIndexMap.get(s),f=i.json.materials[h];f.extensions=f.extensions||{};const k=f.extensions[t1]={diffuseFactor:a.getDiffuseFactor(),specularFactor:a.getSpecularFactor(),glossinessFactor:a.getGlossinessFactor()};if(a.getDiffuseTexture()){const et=a.getDiffuseTexture(),tt=a.getDiffuseTextureInfo();k.diffuseTexture=e.createTextureInfoDef(et,tt)}if(a.getSpecularGlossinessTexture()){const et=a.getSpecularGlossinessTexture(),tt=a.getSpecularGlossinessTextureInfo();k.specularGlossinessTexture=e.createTextureInfoDef(et,tt)}}}),this}}uB.EXTENSION_NAME=t1;const{R:FL,G:UL,B:jL,A:zL}=Qu;class hB extends Gu{init(){this.extensionName="KHR_materials_sheen",this.propertyType="Sheen",this.parentTypes=[Yr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new hu(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new hu(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return sv.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}setSheenColorHex(e){const i=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",sv.hexToFactor(e,i))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:FL|UL|jL})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:zL})}}hB.EXTENSION_NAME="KHR_materials_sheen";const RI="KHR_materials_sheen";class dB extends Au{constructor(...e){super(...e),this.extensionName=RI}createSheen(){return new hB(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions.KHR_materials_sheen){const f=this.createSheen();e.materials[h].setExtension(RI,f);const k=a.extensions.KHR_materials_sheen;if(k.sheenColorFactor!==void 0&&f.setSheenColorFactor(k.sheenColorFactor),k.sheenRoughnessFactor!==void 0&&f.setSheenRoughnessFactor(k.sheenRoughnessFactor),k.sheenColorTexture!==void 0){const et=k.sheenColorTexture;f.setSheenColorTexture(e.textures[s[et.index].source]),e.setTextureInfo(f.getSheenColorTextureInfo(),et)}if(k.sheenRoughnessTexture!==void 0){const et=k.sheenRoughnessTexture;f.setSheenRoughnessTexture(e.textures[s[et.index].source]),e.setTextureInfo(f.getSheenRoughnessTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(RI);if(a){const h=e.materialIndexMap.get(s),f=i.json.materials[h];f.extensions=f.extensions||{};const k=f.extensions.KHR_materials_sheen={sheenColorFactor:a.getSheenColorFactor(),sheenRoughnessFactor:a.getSheenRoughnessFactor()};if(a.getSheenColorTexture()){const et=a.getSheenColorTexture(),tt=a.getSheenColorTextureInfo();k.sheenColorTexture=e.createTextureInfoDef(et,tt)}if(a.getSheenRoughnessTexture()){const et=a.getSheenRoughnessTexture(),tt=a.getSheenRoughnessTextureInfo();k.sheenRoughnessTexture=e.createTextureInfoDef(et,tt)}}}),this}}dB.EXTENSION_NAME=RI;const{R:VL,G:QL,B:GL,A:HL}=Qu;class pB extends Gu{init(){this.extensionName="KHR_materials_specular",this.propertyType="Specular",this.parentTypes=[Yr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new hu(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new hu(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularColorHex(){return sv.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(e){const i=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",sv.hexToFactor(e,i))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:HL})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:VL|QL|GL})}}pB.EXTENSION_NAME="KHR_materials_specular";const n1="KHR_materials_specular";class fB extends Au{constructor(...e){super(...e),this.extensionName=n1}createSpecular(){return new pB(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions[n1]){const f=this.createSpecular();e.materials[h].setExtension(n1,f);const k=a.extensions[n1];if(k.specularFactor!==void 0&&f.setSpecularFactor(k.specularFactor),k.specularColorFactor!==void 0&&f.setSpecularColorFactor(k.specularColorFactor),k.specularTexture!==void 0){const et=k.specularTexture;f.setSpecularTexture(e.textures[s[et.index].source]),e.setTextureInfo(f.getSpecularTextureInfo(),et)}if(k.specularColorTexture!==void 0){const et=k.specularColorTexture;f.setSpecularColorTexture(e.textures[s[et.index].source]),e.setTextureInfo(f.getSpecularColorTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(n1);if(a){const h=e.materialIndexMap.get(s),f=i.json.materials[h];f.extensions=f.extensions||{};const k=f.extensions[n1]={};if(a.getSpecularFactor()!==1&&(k.specularFactor=a.getSpecularFactor()),Tu.eq(a.getSpecularColorFactor(),[1,1,1])||(k.specularColorFactor=a.getSpecularColorFactor()),a.getSpecularTexture()){const et=a.getSpecularTexture(),tt=a.getSpecularTextureInfo();k.specularTexture=e.createTextureInfoDef(et,tt)}if(a.getSpecularColorTexture()){const et=a.getSpecularColorTexture(),tt=a.getSpecularColorTextureInfo();k.specularColorTexture=e.createTextureInfoDef(et,tt)}}}),this}}fB.EXTENSION_NAME=n1;const{R:WL}=Qu;class mB extends Gu{init(){this.extensionName="KHR_materials_transmission",this.propertyType="Transmission",this.parentTypes=[Yr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new hu(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:WL})}}mB.EXTENSION_NAME="KHR_materials_transmission";const r1="KHR_materials_transmission";class gB extends Au{constructor(...e){super(...e),this.extensionName=r1}createTransmission(){return new mB(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions[r1]){const f=this.createTransmission();e.materials[h].setExtension(r1,f);const k=a.extensions[r1];if(k.transmissionFactor!==void 0&&f.setTransmissionFactor(k.transmissionFactor),k.transmissionTexture!==void 0){const et=k.transmissionTexture;f.setTransmissionTexture(e.textures[s[et.index].source]),e.setTextureInfo(f.getTransmissionTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(r1);if(a){const h=e.materialIndexMap.get(s),f=i.json.materials[h];f.extensions=f.extensions||{};const k=f.extensions[r1]={transmissionFactor:a.getTransmissionFactor()};if(a.getTransmissionTexture()){const et=a.getTransmissionTexture(),tt=a.getTransmissionTextureInfo();k.transmissionTexture=e.createTextureInfoDef(et,tt)}}}),this}}gB.EXTENSION_NAME=r1;class vB extends Gu{init(){this.extensionName="KHR_materials_unlit",this.propertyType="Unlit",this.parentTypes=[Yr.MATERIAL]}}vB.EXTENSION_NAME="KHR_materials_unlit";const kI="KHR_materials_unlit";class _B extends Au{constructor(...e){super(...e),this.extensionName=kI}createUnlit(){return new vB(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((i,s)=>{i.extensions&&i.extensions.KHR_materials_unlit&&e.materials[s].setExtension(kI,this.createUnlit())}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{if(s.getExtension(kI)){const a=e.materialIndexMap.get(s),h=i.json.materials[a];h.extensions=h.extensions||{},h.extensions.KHR_materials_unlit={}}}),this}}_B.EXTENSION_NAME=kI;class yB extends Gu{init(){this.extensionName="KHR_materials_variants",this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}yB.EXTENSION_NAME="KHR_materials_variants";class AB extends Gu{init(){this.extensionName="KHR_materials_variants",this.propertyType="MappingList",this.parentTypes=[Yr.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}AB.EXTENSION_NAME="KHR_materials_variants";class GP extends Gu{init(){this.extensionName="KHR_materials_variants",this.propertyType="Variant",this.parentTypes=["MappingList"]}}GP.EXTENSION_NAME="KHR_materials_variants";const ay="KHR_materials_variants";class wB extends Au{constructor(...e){super(...e),this.extensionName=ay}createMappingList(){return new AB(this.document.getGraph())}createVariant(e=""){return new GP(this.document.getGraph(),e)}createMapping(){return new yB(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(e=>e instanceof GP)}read(e){const i=e.jsonDoc;if(!i.json.extensions||!i.json.extensions[ay])return this;const s=(i.json.extensions[ay].variants||[]).map(a=>this.createVariant().setName(a.name||""));return(i.json.meshes||[]).forEach((a,h)=>{const f=e.meshes[h];(a.primitives||[]).forEach((k,et)=>{if(!k.extensions||!k.extensions[ay])return;const tt=this.createMappingList(),rt=k.extensions[ay];for(const lt of rt.mappings){const pt=this.createMapping();lt.material!==void 0&&pt.setMaterial(e.materials[lt.material]);for(const ft of lt.variants||[])pt.addVariant(s[ft]);tt.addMapping(pt)}f.listPrimitives()[et].setExtension(ay,tt)})}),this}write(e){const i=e.jsonDoc,s=this.listVariants();if(!s.length)return this;const a=[],h=new Map;for(const f of s)h.set(f,a.length),a.push(e.createPropertyDef(f));for(const f of this.document.getRoot().listMeshes()){const k=e.meshIndexMap.get(f);f.listPrimitives().forEach((et,tt)=>{const rt=et.getExtension(ay);if(!rt)return;const lt=e.jsonDoc.json.meshes[k].primitives[tt],pt=rt.listMappings().map(ft=>{const vt=e.createPropertyDef(ft),yt=ft.getMaterial();return yt&&(vt.material=e.materialIndexMap.get(yt)),vt.variants=ft.listVariants().map(Mt=>h.get(Mt)),vt});lt.extensions=lt.extensions||{},lt.extensions[ay]={mappings:pt}})}return i.json.extensions=i.json.extensions||{},i.json.extensions[ay]={variants:a},this}}wB.EXTENSION_NAME=ay;const{G:qL}=Qu;class xB extends Gu{init(){this.extensionName="KHR_materials_volume",this.propertyType="Volume",this.parentTypes=[Yr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new hu(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:qL})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}getAttenuationColorHex(){return sv.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(e){const i=this.getAttenuationColor().slice();return this.set("attenuationColor",sv.hexToFactor(e,i))}}xB.EXTENSION_NAME="KHR_materials_volume";const BI="KHR_materials_volume";class bB extends Au{constructor(...e){super(...e),this.extensionName=BI}createVolume(){return new xB(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions.KHR_materials_volume){const f=this.createVolume();e.materials[h].setExtension(BI,f);const k=a.extensions.KHR_materials_volume;if(k.thicknessFactor!==void 0&&f.setThicknessFactor(k.thicknessFactor),k.attenuationDistance!==void 0&&f.setAttenuationDistance(k.attenuationDistance),k.attenuationColor!==void 0&&f.setAttenuationColor(k.attenuationColor),k.thicknessTexture!==void 0){const et=k.thicknessTexture;f.setThicknessTexture(e.textures[s[et.index].source]),e.setTextureInfo(f.getThicknessTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(BI);if(a){const h=e.materialIndexMap.get(s),f=i.json.materials[h];f.extensions=f.extensions||{};const k=f.extensions.KHR_materials_volume={};if(a.getThicknessFactor()>0&&(k.thicknessFactor=a.getThicknessFactor()),Number.isFinite(a.getAttenuationDistance())&&(k.attenuationDistance=a.getAttenuationDistance()),Tu.eq(a.getAttenuationColor(),[1,1,1])||(k.attenuationColor=a.getAttenuationColor()),a.getThicknessTexture()){const et=a.getThicknessTexture(),tt=a.getThicknessTextureInfo();k.thicknessTexture=e.createTextureInfoDef(et,tt)}}}),this}}bB.EXTENSION_NAME=BI;const EB="KHR_mesh_quantization";class SB extends Au{constructor(...e){super(...e),this.extensionName=EB}read(e){return this}write(e){return this}}SB.EXTENSION_NAME=EB;const CB="KHR_texture_basisu";class YL{match(e){return e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10}getSize(e){const i=VP(e);return[i.pixelWidth,i.pixelHeight]}getChannels(e){const i=VP(e).dataFormatDescriptor[0];if(i.colorModel===163)return i.samples.length===2&&(15&i.samples[1].channelType)==15?4:3;if(i.colorModel===166)return(15&i.samples[0].channelType)==3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${i.colorModel}".`)}getGPUByteLength(e){const i=VP(e),s=this.getChannels(e)>3;let a=0;for(let h=0;h<i.levels.length;h++){const f=i.levels[h];a+=f.uncompressedByteLength?f.uncompressedByteLength:Math.max(1,Math.floor(i.pixelWidth/Math.pow(2,h)))/4*(Math.max(1,Math.floor(i.pixelHeight/Math.pow(2,h)))/4)*(s?16:8)}return a}}class MB extends Au{constructor(...e){super(...e),this.extensionName=CB,this.prereadTypes=[Yr.TEXTURE]}static register(){nA.registerFormat("image/ktx2",new YL)}preread(e){return e.jsonDoc.json.textures.forEach(i=>{i.extensions&&i.extensions.KHR_texture_basisu&&(i.source=i.extensions.KHR_texture_basisu.source)}),this}read(e){return this}write(e){const i=e.jsonDoc;return this.document.getRoot().listTextures().forEach(s=>{if(s.getMimeType()==="image/ktx2"){const a=e.imageIndexMap.get(s);i.json.textures.forEach(h=>{h.source===a&&(h.extensions=h.extensions||{},h.extensions.KHR_texture_basisu={source:h.source},delete h.source)})}}),this}}MB.EXTENSION_NAME=CB;class TB extends Gu{init(){this.extensionName="KHR_texture_transform",this.propertyType="Transform",this.parentTypes=[Yr.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}TB.EXTENSION_NAME="KHR_texture_transform";const OI="KHR_texture_transform";class IB extends Au{constructor(...e){super(...e),this.extensionName=OI}createTransform(){return new TB(this.document.getGraph())}read(e){for(const[i,s]of Array.from(e.textureInfos.entries())){if(!s.extensions||!s.extensions.KHR_texture_transform)continue;const a=this.createTransform(),h=s.extensions.KHR_texture_transform;h.offset!==void 0&&a.setOffset(h.offset),h.rotation!==void 0&&a.setRotation(h.rotation),h.scale!==void 0&&a.setScale(h.scale),h.texCoord!==void 0&&a.setTexCoord(h.texCoord),i.setExtension(OI,a)}return this}write(e){const i=Array.from(e.textureInfoDefMap.entries());for(const[s,a]of i){const h=s.getExtension(OI);if(!h)continue;a.extensions=a.extensions||{};const f={},k=Tu.eq;k(h.getOffset(),[0,0])||(f.offset=h.getOffset()),h.getRotation()!==0&&(f.rotation=h.getRotation()),k(h.getScale(),[1,1])||(f.scale=h.getScale()),h.getTexCoord()!=null&&(f.texCoord=h.getTexCoord()),a.extensions.KHR_texture_transform=f}return this}}IB.EXTENSION_NAME=OI;const XL=[Yr.ROOT,Yr.SCENE,Yr.NODE,Yr.MESH,Yr.MATERIAL,Yr.TEXTURE,Yr.ANIMATION];class PB extends Gu{init(){this.extensionName="KHR_xmp_json_ld",this.propertyType="Packet",this.parentTypes=XL}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",gw({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const i=this.get("properties");return e in i?i[e]:null}setProperty(e,i){this._assertContext(e);const s=gw({},this.get("properties"));return i?s[e]=i:delete s[e],this.set("properties",s)}toJSONLD(){return gw({"@context":HP(this.get("context"))},HP(this.get("properties")))}fromJSONLD(e){const i=(e=HP(e))["@context"];return i&&this.set("context",i),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`KHR_xmp_json_ld: Missing context for term, "${e}".`)}}function HP(c){return JSON.parse(JSON.stringify(c))}PB.EXTENSION_NAME="KHR_xmp_json_ld";const WP="KHR_xmp_json_ld";class DB extends Au{constructor(...e){super(...e),this.extensionName=WP}createPacket(){return new PB(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var i;const s=(i=e.jsonDoc.json.extensions)==null?void 0:i.KHR_xmp_json_ld;if(!s||!s.packets)return this;const a=e.jsonDoc.json,h=this.document.getRoot(),f=s.packets.map(tt=>this.createPacket().fromJSONLD(tt)),k=[[a.asset],a.scenes,a.nodes,a.meshes,a.materials,a.images,a.animations],et=[[h],h.listScenes(),h.listNodes(),h.listMeshes(),h.listMaterials(),h.listTextures(),h.listAnimations()];for(let tt=0;tt<k.length;tt++){const rt=k[tt]||[];for(let lt=0;lt<rt.length;lt++){const pt=rt[lt];pt.extensions&&pt.extensions.KHR_xmp_json_ld&&et[tt][lt].setExtension(WP,f[pt.extensions.KHR_xmp_json_ld.packet])}}return this}write(e){const{json:i}=e.jsonDoc,s=[];for(const a of this.properties){s.push(a.toJSONLD());for(const h of a.listParents()){let f;switch(h.propertyType){case Yr.ROOT:f=i.asset;break;case Yr.SCENE:f=i.scenes[e.sceneIndexMap.get(h)];break;case Yr.NODE:f=i.nodes[e.nodeIndexMap.get(h)];break;case Yr.MESH:f=i.meshes[e.meshIndexMap.get(h)];break;case Yr.MATERIAL:f=i.materials[e.materialIndexMap.get(h)];break;case Yr.TEXTURE:f=i.images[e.imageIndexMap.get(h)];break;case Yr.ANIMATION:f=i.animations[e.animationIndexMap.get(h)];break;default:f=null,this.document.getLogger().warn(`[KHR_xmp_json_ld]: Unsupported parent property, "${h.propertyType}"`)}f&&(f.extensions=f.extensions||{},f.extensions.KHR_xmp_json_ld={packet:s.length-1})}}return s.length>0&&(i.extensions=i.extensions||{},i.extensions.KHR_xmp_json_ld={packets:s}),this}}DB.EXTENSION_NAME=WP;const KL=[sM,XR,ZR,eB,nB,iB,uB,fB,dB,gB,_B,wB,bB,SB,MB,IB,DB];let qP=class extends Go{constructor(c,e,i){super(c,e,i??new $L,new oo(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(c,e,i,s,a){this.enabled&&super.render(c,e,i,s,a)}};qP=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f}([Ws("High precision Normal Buffer")],qP);class $L extends d.RSm{constructor(){super()}onBeforeRender(e,i,s,a,h){var f,k;let et=h.material;Array.isArray(et)&&(et=et[0]),this.normalMap=(f=et==null?void 0:et.normalMap)!==null&&f!==void 0?f:null,this.needsUpdate=!0,this.side=(k=et.side)!==null&&k!==void 0?k:d.ehD}}class JE extends wv{constructor(e=!0){super(),this.passId="normalBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this.enabled=e}passCtor(e){this._normalTarget=e.renderer.createTarget({depthBuffer:!0,type:d.cLu,minFilter:d.TyD,magFilter:d.TyD,generateMipmaps:!1}),this._normalTarget.texture.name="normalBuffer",this._normalTarget.texture.generateMipmaps=!1;const i=this._normalTarget,s=new Set,a=new Set;return new class extends qP{render(h,f,k,et,tt){const rt=h.getRenderTarget(),lt=h.getActiveCubeFace(),pt=h.getActiveMipmapLevel();this.scene&&(this.scene.traverse(({material:ft})=>{ft&&((ft.transparent&&ft.userData.renderToDepth||!ft.transparent&&ft.transmission===0&&ft.userData.renderToDepth===!1)&&(s.add(ft),ft.transparent=!ft.transparent),Math.abs(ft.transmission||0)>0&&ft.userData.renderToDepth&&(a.add([ft,ft.transmission]),ft.transmission=0))}),Lr(h,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(h,f,i,et,tt)),s.forEach(ft=>ft.transparent=!ft.transparent),s.clear(),a.forEach(([ft,vt])=>ft.transmission=vt),a.clear(),h.setRenderTarget(rt,lt,pt))}}}_update(e){if(!super._update(e))return!1;const i=this.pass.passObject;return i.scene=e.scene.modelObject,i.camera=e.scene.activeCamera.cameraObject,!0}getNormalBuffer(){return this._normalTarget}async onDispose(e){}async onRemove(e){var i,s;return e.renderer.disposeTarget((s=(i=this._normalTarget)===null||i===void 0?void 0:i.dispose)===null||s===void 0?void 0:s.call(i)),super.onRemove(e)}updateShaderProperties(e){var i,s;return e.uniforms.tNormalBuffer?e.uniforms.tNormalBuffer.value=this.enabled&&(s=(i=this.getNormalBuffer())===null||i===void 0?void 0:i.texture)!==null&&s!==void 0?s:null:console.warn("BaseRenderer: no uniform: tNormalBuffer"),this}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}JE.PluginType="NormalBufferPlugin";function RB(c){const e=c==null?void 0:c.userData;if(!e)return!1;e._ssBevel||(e._ssBevel={});const i=e._ssBevel;return i.hasSSBevel=!0,i.radius===void 0&&(i.radius=0),c.isMaterial&&(c.needsUpdate=!0),!0}let YP=class extends bu{constructor(c,e,i,s){super({defines:{NUM_SAMPLES:16},uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},edgeMaskBuffer:{value:null},screenSize:{value:new d.FM8},radius:{value:1},samples:{value:null},frameCount:{value:0},cameraPositionWorld:{value:new d.Pa4(1,1,1)}},vertexShader:bv,fragmentShader:`

            ${i}

            ${Ev}

            uniform sampler2D tNormalBuffer;uniform sampler2D edgeMaskBuffer;uniform vec2 screenSize;const float depthStep=0.02;uniform vec2 samples[NUM_SAMPLES];uniform vec3 cameraPositionWorld;varying vec2 vUv;
#include <common>
vec3 smoothNormal(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 texel=texture2D(tNormalDepth,uv);vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 avgNormal=2.*texture2D(tNormalBuffer,uv).rgb-1.;float depth=pow(unpack16(texel.xy),2.);vec2 invScreenSize=vec2(1.)/screenSize;vec4 mask=texture2D(tGBufferFlags,uv);float weightSum=0.;float radius=mask.g*255.*2.;float randomAngle=6.2*random(frameCount*0.1);float theta=randomAngle;float snTheta=sin(theta);float csTheta=cos(theta);mat2 randomRotationMatrix=mat2(csTheta,snTheta,-snTheta,csTheta);float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(1./(1.+pow(d_,0.5)),0.,1.);for(int i=0;i<5;i++){float x=float(i)-2.;for(int j=0;j<5;j++){float y=float(j)-2.;vec2 offset=randomRotationMatrix*vec2(x,y)*radius*radiusModifier*invScreenSize;vec4 texel=texture2D(tNormalDepth,uv+offset);float offsetDepth=pow(unpack16(texel.xy),2.);float depthWeight=abs(offsetDepth-depth);depthWeight=(1.-step(depthStep,depthWeight));vec3 offsetNormal=2.*texture2D(tNormalBuffer,uv+offset).rgb-1.;if(dot(offsetNormal,offsetNormal)>0.){avgNormal+=offsetNormal*depthWeight;}}}return normalize(avgNormal);}void main(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 normal=vec3(0.);if(edgeMask.x>0.){normal=smoothNormal();}else{normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}gl_FragColor=vec4(vec3(0.5*normal+0.5),1.);}
            
            `},"tDiffuse"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(a,h,f)=>{var k,et;this.enabled&&(!((et=(k=h.materialObject.userData)===null||k===void 0?void 0:k._ssBevel)===null||et===void 0)&&et.hasSSBevel)&&(a.fragmentShader=Ul(a.fragmentShader,"#include <normal_fragment_maps>",` 
                normal = 2. * texture2D(tSSBevelMap, viewToScreen(vViewPosition.xyz).xy).rgb - 1.;
                normal = normalize(normal);
                //geometryNormal = normal;
            `))},onObjectRender:(a,h,f)=>{var k,et;if(!this.enabled||!(!((et=(k=h.materialObject.userData)===null||k===void 0?void 0:k._ssBevel)===null||et===void 0)&&et.hasSSBevel))return;const tt=h.materialObject,rt=this._target.texture;this.materialExtension.extraUniforms.tSSBevelMap.value!==rt&&(this.materialExtension.extraUniforms.tSSBevelMap.value=rt,tt.needsUpdate=!0)},getUiConfig:a=>{const h={type:"folder",label:"SSBevel (Dev)",children:[{type:"checkbox",label:"Enabled",get value(){var f;return((f=a.materialObject.userData._ssBevel)===null||f===void 0?void 0:f.hasSSBevel)||!1},set value(f){var k,et;f!==((k=a.materialObject.userData._ssBevel)===null||k===void 0?void 0:k.hasSSBevel)&&(f?RB(a.materialObject)||alert("Cannot add screen space bevel."):(a.materialObject.userData._ssBevel.hasSSBevel=!1,a.materialObject.needsUpdate=!0),(et=h.uiRefresh)===null||et===void 0||et.call(h,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,8],label:"radius",hidden:()=>{var f;return!(!((f=a.materialObject.userData._ssBevel)===null||f===void 0)&&f.hasSSBevel)},property:[a.materialObject.userData._ssBevel,"radius"],onChange:this.setDirty})]};return h},parsFragmentSnippet:(a,h)=>{var f,k;return this.enabled&&(!((k=(f=h==null?void 0:h.materialObject.userData)===null||f===void 0?void 0:f._ssBevel)===null||k===void 0)&&k.hasSSBevel)?Ut`
            uniform sampler2D tSSBevelMap;
            ${B1}
            `:""},extraUniforms:{tSSBevelMap:{value:null}},computeCacheKey:a=>{var h,f;return(this.enabled?"1":"0")+(!((f=(h=a.materialObject.userData)===null||h===void 0?void 0:h._ssBevel)===null||f===void 0)&&f.hasSSBevel?"1":"0")},isCompatible:a=>a.isMeshStandardMaterial2},this._target=e,this.needsSwap=!1,this.clear=!0,this._viewerApp=s,this._edgeMaterial=new M_({uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},screenSize:{value:null},radius:{value:10},cameraNearFar:{value:new d.FM8(1,1)},cameraPositionWorld:{value:new d.Pa4(1,1,1)}},vertexShader:bv,fragmentShader:"uniform vec2 screenSize;uniform sampler2D tNormalDepth;uniform sampler2D tNormalBuffer;uniform sampler2D tGBufferFlags;uniform float radius;uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;const float depthStep=0.2;const float normalThreshold=0.9;float unpack16(vec2 value){return(value.x*0.996108949416342426275150501169264316558837890625+value.y*0.00389105058365758760263730664519243873655796051025390625);}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}void lookupNormalDepth(out float depth,out vec3 normal,vec2 off){vec2 uv=(gl_FragCoord.st+off)/screenSize;vec4 texel=texture2D(tNormalDepth,uv);depth=mix(cameraNearFar.x,cameraNearFar.y,pow(unpack16(texel.xy),2.));normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}float getBorderWeight(){float depth1,depth2,depth3,depth4;vec3 normal1,normal2,normal3,normal4;float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(3./(1.+pow(d_,0.5)),0.,1.);float modRad=radius;lookupNormalDepth(depth1,normal1,vec2(0.,modRad));lookupNormalDepth(depth2,normal2,vec2(0.,-modRad));lookupNormalDepth(depth3,normal3,vec2(modRad,0.));lookupNormalDepth(depth4,normal4,vec2(-modRad,0.));vec2 uv=(gl_FragCoord.st)/screenSize;float mask=step(0.0001,texture2D(tGBufferFlags,uv).g);float mask1=texture2D(tGBufferFlags,uv+vec2(0.,modRad)/screenSize).b*255.;float mask2=texture2D(tGBufferFlags,uv+vec2(0.,-modRad)/screenSize).b*255.;float mask3=texture2D(tGBufferFlags,uv+vec2(modRad,0.)/screenSize).b*255.;float mask4=texture2D(tGBufferFlags,uv+vec2(-modRad,0.)/screenSize).b*255.;float maskWeight=max(abs(mask1-mask2),abs(mask3-mask4))*255.;maskWeight=(step(maskWeight,0.01));float a1=dot(normal1,normal2);float a2=dot(normal3,normal4);float normalWeight=min(abs(a1),abs(a2));normalWeight=1.-step(normalThreshold,normalWeight);float depthWeight=max(abs(depth1-depth2),abs(depth3-depth4));depthWeight=(step(depthWeight,depthStep));return normalWeight*depthWeight*maskWeight*mask;}void main(){float weight=getBorderWeight();vec2 uv=gl_FragCoord.st/screenSize;vec4 texel=texture2D(tNormalDepth,uv);float depth=pow(unpack16(texel.xy),2.);vec3 outColor=vec3(0.);if(depth>0.999){weight=0.;}else{outColor=vec3(weight);}gl_FragColor=vec4(outColor,1.);}"}),this._separableBlurMaterial=new M_({defines:{KERNEL_RADIUS:3,SIGMA:3},uniforms:{colorTexture:{value:null},maskTexture:{value:null},texSize:{value:new d.FM8(.5,.5)},direction:{value:new d.FM8(.5,.5)}},vertexShader:bv,fragmentShader:"varying vec2 vUv;uniform sampler2D colorTexture;uniform sampler2D maskTexture;uniform vec2 texSize;uniform vec2 direction;float gaussianPdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}void main(){vec2 invSize=1./texSize;float fSigma=float(SIGMA);float weightSum=gaussianPdf(0.,fSigma);vec4 mask=texture2D(maskTexture,vUv);vec3 diffuseSum=texture2D(colorTexture,vUv).rgb*weightSum;for(int i=1;i<KERNEL_RADIUS;i++){float x=float(i);float w=gaussianPdf(x,fSigma);vec2 uvOffset=direction*invSize*x;vec3 sample1=texture2D(colorTexture,vUv+uvOffset).rgb;vec3 sample2=texture2D(colorTexture,vUv-uvOffset).rgb;diffuseSum+=(sample1+sample2)*w;weightSum+=2.*w;}gl_FragColor=vec4(diffuseSum/weightSum,1.);}"})}render(c,e,i,s,a){var h,f;if(!this.enabled)return;const k=c.baseRenderer,et={minFilter:d.wem,magFilter:d.wem,isAntialiased:!1,format:d.wk1,depthBuffer:!1,generateMipmaps:!1},tt=k.getTempTarget(et);this._renderEdges(k,tt),this._blurEdges(k,tt),this._viewerApp.scene.activeCamera.updateShaderProperties(this.material),(h=this._viewerApp.getPlugin(ba))===null||h===void 0||h.updateShaderProperties(this.material),(f=this._viewerApp.getPlugin(JE))===null||f===void 0||f.updateShaderProperties(this.material),this._viewerApp.renderer.updateShaderProperties(this.material),this.uniforms.edgeMaskBuffer.value=tt.texture,super.render(c,this._target,tt,s,a),k.releaseTempTarget(tt)}_initsamples(){const c=[];return c.push(new d.FM8(-8,0).multiplyScalar(.125)),c.push(new d.FM8(-6,-4).multiplyScalar(.125)),c.push(new d.FM8(-3,-2).multiplyScalar(.125)),c.push(new d.FM8(-2,-6).multiplyScalar(.125)),c.push(new d.FM8(1,-1).multiplyScalar(.125)),c.push(new d.FM8(2,-5).multiplyScalar(.125)),c.push(new d.FM8(6,-7).multiplyScalar(.125)),c.push(new d.FM8(5,-3).multiplyScalar(.125)),c.push(new d.FM8(4,1).multiplyScalar(.125)),c.push(new d.FM8(7,4).multiplyScalar(.125)),c.push(new d.FM8(3,5).multiplyScalar(.125)),c.push(new d.FM8(0,7).multiplyScalar(.125)),c.push(new d.FM8(-1,3).multiplyScalar(.125)),c.push(new d.FM8(-4,6).multiplyScalar(.125)),c.push(new d.FM8(-7,8).multiplyScalar(.125)),c.push(new d.FM8(-5,2).multiplyScalar(.125)),c}_blurEdges(c,e){var i,s;const a={minFilter:d.wem,magFilter:d.wem,isAntialiased:!1,format:d.wk1,depthBuffer:!1,generateMipmaps:!1,sizeMultiplier:.5},h=c.getTempTarget(a),f=((i=e.texture.image)===null||i===void 0?void 0:i.width)||1,k=((s=e.texture.image)===null||s===void 0?void 0:s.height)||1;this._separableBlurMaterial.uniforms.texSize.value=new d.FM8(f,k),this._separableBlurMaterial.uniforms.colorTexture.value=e.texture,this._separableBlurMaterial.uniforms.direction.value=new d.FM8(1,0),c.blit(void 0,h,{material:this._separableBlurMaterial}),this._separableBlurMaterial.uniforms.texSize.value=new d.FM8(f/2,k/2),this._separableBlurMaterial.uniforms.colorTexture.value=h.texture,this._separableBlurMaterial.uniforms.direction.value=new d.FM8(0,1),c.blit(void 0,e,{material:this._separableBlurMaterial}),c.releaseTempTarget(h)}_renderEdges(c,e){var i,s,a,h;const f=((i=e.texture.image)===null||i===void 0?void 0:i.width)||1,k=((s=e.texture.image)===null||s===void 0?void 0:s.height)||1;this._edgeMaterial.uniforms.screenSize.value=new d.FM8(f,k),this._viewerApp.scene.activeCamera.updateShaderProperties(this._edgeMaterial),(a=this._viewerApp.getPlugin(ba))===null||a===void 0||a.updateShaderProperties(this._edgeMaterial),(h=this._viewerApp.getPlugin(JE))===null||h===void 0||h.updateShaderProperties(this._edgeMaterial),c.blit(void 0,e,{material:this._edgeMaterial})}};YP=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f}([Ws("SSBevel")],YP);class vw extends wv{constructor(e=!0){super(),this.passId="ssBevel",this._beforeFilters=["render"],this._afterFilters=["gbuffer","normalBuffer"],this._requiredFilters=["render","gbuffer","normalBuffer"],this._lastEnabled=!1,this.dependencies=[Kr,ba,JE],this.enabled=e,this.setDirty=this.setDirty.bind(this),this._loaderCreate=this._loaderCreate.bind(this)}get bevelTarget(){return this._bevelTarget}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register(i=>new JL(i))}passCtor(e){var i,s;this._bevelTarget=e.renderer.createTarget({depthBuffer:!0,type:d.cLu,minFilter:d.TyD,magFilter:d.TyD,generateMipmaps:!1}),this._bevelTarget.texture.name="bevelBuffer",this._bevelTarget.texture.generateMipmaps=!1;const a=e.getPluginByType("debug");return a&&a.addTexture("tempBuffer",()=>this._bevelTarget.texture,[440,50,400,200]),new YP(e.renderer,this._bevelTarget,(s=(i=e.getPlugin(ba))===null||i===void 0?void 0:i.getUnpackSnippet())!==null&&s!==void 0?s:"",e)}async onAdded(e){var i,s,a,h,f,k,et;await super.onAdded(e);const tt=e.getPlugin(Kr);return!((i=this.pass)===null||i===void 0)&&i.passObject.materialExtension&&((s=tt==null?void 0:tt.materials)===null||s===void 0||s.registerMaterialExtension((a=this.pass)===null||a===void 0?void 0:a.passObject.materialExtension)),(h=tt==null?void 0:tt.importer)===null||h===void 0||h.addEventListener("loaderCreate",this._loaderCreate),(et=(k=(f=tt==null?void 0:tt.exporter)===null||f===void 0?void 0:f.getExporter("gltf","glb"))===null||k===void 0?void 0:k.extensions)===null||et===void 0||et.push(ZL),super.onAdded(e)}async onRemove(e){return e.renderer.disposeTarget(this._bevelTarget),super.onRemove(e)}setDirty(){var e,i,s,a;(e=this._viewer)===null||e===void 0||e.setDirty(),(a=(i=this.pass)===null||i===void 0?void 0:(s=i.passObject.materialExtension).setDirty)===null||a===void 0||a.call(s)}_update(e){var i;let s=this.enabled;if(s&&!this._lastEnabled){const a=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("NormalBufferPlugin");confirm("SS Bevel Plugin needs to enable NormalBufferPlugin. Enable now?")?a.enabled=!0:(this.enabled=!1,a.enabled=!1,s=!1)}return this._lastEnabled=s,s}get uiConfig(){var e,i,s,a,h;const f=(s=(i=(e=this.pass)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.uiConfig)!==null&&s!==void 0?s:{};return(h=(a=f.children)===null||a===void 0?void 0:a.map(k=>Ht(k)))===null||h===void 0||h.flat(2).forEach(k=>k&&(k.onChange=this.setDirty)),f}}vw.PluginType="SSBevelPlugin",vw.SSBEVEL_GLTF_EXTENSION="WEBGI_materials_ssbevel";class JL{constructor(e){this.parser=e,this.name=vw.SSBEVEL_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name];return i.userData||(i.userData={}),RB(i),i.userData._ssBevel=os(a,i.userData._ssBevel,!1,{}),Promise.resolve()}}const ZL=c=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._ssBevel||!e.userData._ssBevel.hasSSBevel)return;i.extensions=i.extensions||{};const s=Wr(e.userData._ssBevel,!1);i.extensions[vw.SSBEVEL_GLTF_EXTENSION]=s,c.extensionsUsed[vw.SSBEVEL_GLTF_EXTENSION]=!0}});class kB extends MP{constructor(e){super(),this._loadedLibs=!1,e=e||{method:sM.EncoderMethod.EDGEBREAKER,encodeSpeed:5},this._io=new wL().registerExtensions(KL).registerExtensions([BB,jI,NI,FI,UI,zI,VI,QI,GI,HI,WI,qI,YI,XI,KI]),this._encoderOptions=e}preload(){return this._loadLibs(),this}async _loadLibs(){if(this._loadedLibs||!this.loader)return;const e=await Promise.all([this.loader.initEncoder(),this.loader.initDecoder()]);this._io.registerDependencies({"draco3d.encoder":e[0],"draco3d.decoder":e[1]}),this._loadedLibs=!0}async parseAsync(e,{compress:i=!1,...s}){if(!this.loader)return console.error("GLTFDracoExporter: No DRACOLoader2 instance provided"),super.parseAsync(e,s);await this._loadLibs();const a={...s};i&&(a.externalImagesInExtras=!0);const h=await new Promise((lt,pt)=>this.parse(e,lt,pt,a)),f=await super.parseAsync(h,a);if(!i)return f;if(!h)throw new Error("GLTFDracoExporter: gltf is null");let k=h;const et=k.byteLength||1/0,tt=await(typeof k!="object"||k.byteLength?this._io.readBinary(new Uint8Array(k)):this._io.readJSON({json:k,resources:{}}));if(tt.createExtension(sM).setRequired(!0).setEncoderOptions(this._encoderOptions),a.exportExt==="glb")k=await this._io.writeBinary(tt),isFinite(et)&&console.log("DRACO Compression ratio: "+(k.byteLength/et).toFixed(5));else{const lt=await this._io.writeJSON(tt);k=lt.json,Object.values(lt.resources).filter(pt=>pt).length>0&&(console.warn("DRACOExporter: extra resources in resources not supported properly"),k.resources=lt.resources)}k.__isGLTFOutput=!0;const rt=await super.parseAsync(k,a);return rt.__uncompressed=f,rt}}class XP extends Js{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[Kr,ZC]}async onAdded(e){await super.onAdded(e);const i=e.getManager().importer;if(!i)throw new Error("GLTFDracoExportPlugin: AssetImporter not found");(function(s,a){TP(s,kB,h=>{const f=Ho()+".drc",k=h;k.loader=a.registerFile(f),k.loader.setDecoderConfig({type:"js"}),k.loader.preload(!0,!0)})})(e,i)}}XP.PluginType="GLTFDracoExportPlugin";class eN extends Gu{constructor(){super(...arguments),this.extensionName=_f,this.parentTypes=[Yr.SCENE],this.propertyType="ViewerJSON"}init(){}}class BB extends Au{constructor(){super(...arguments),this.extensionName=_f,this._viewerConfig={},this._texturesRef=[],this.required=!0}read(e){var i;return this._viewerConfig={},(i=e.jsonDoc.json.scenes)===null||i===void 0||i.forEach((s,a)=>{if(s.extensions&&s.extensions[_f]){const h=new eN(this.document.getGraph());e.scenes[a].setExtension(_f,h);const f=s.extensions[_f];this._viewerConfig=f}}),this}write(e){return this.document.getRoot().listScenes().forEach(i=>{var s;if(i.getExtension(_f)){const a=(s=e.jsonDoc.json.scenes)===null||s===void 0?void 0:s[e.jsonDoc.json.scene||0];a&&this._viewerConfig!=={}&&(a.extensions=a.extensions||{},a.extensions[_f]=this._viewerConfig,this._texturesRef=[],this._viewerConfig={})}}),this}}BB.EXTENSION_NAME=_f;class LI extends Gu{constructor(e,i,s){super(e,i),this.parentTypes=[Yr.MATERIAL,Yr.MESH,Yr.NODE,Yr.SCENE],this.propertyType="GenericExtension",this.textures={},this.extensionName=s}addTexture(e,i,s,a=4369){this.setRef(e,s,{channels:a}),this.textures[e]=[i,s]}copy(e,i=oy){return super.copy(e,i),this}dispose(){Object.values(this.textures).forEach(([e,i])=>{e==null||e.dispose()}),super.dispose()}init(){}}class lv extends Au{constructor(){super(...arguments),this.textureChannels={}}read(e){const i=e.jsonDoc,s=i.json.materials||[],a=i.json.textures||[];return s.forEach((h,f)=>{var k,et;if(h.extensions&&h.extensions[this.extensionName]){const tt=new LI(this.document.getGraph(),"",this.extensionName);e.materials[f].setExtension(this.extensionName,tt);const rt={...h.extensions[this.extensionName]};for(const[lt,pt]of Object.entries(rt))if(typeof(pt==null?void 0:pt.index)=="number"){const ft=pt,vt=(k=a[ft.index])===null||k===void 0?void 0:k.source;if(typeof vt!="number"){console.warn("GLTF Pipeline: source texture not found for texture info",ft);continue}const yt=e.textures[vt],Mt=new hu(this.document.getGraph()),xt=(et=this.textureChannels[lt])!==null&&et!==void 0?et:4369;tt.addTexture(lt,Mt,yt,xt),e.setTextureInfo(Mt,ft),delete rt[lt]}tt.setExtras(rt)}}),(i.json.meshes||[]).forEach((h,f)=>{if(h.extensions&&h.extensions[this.extensionName]){const k=new LI(this.document.getGraph(),"",this.extensionName);e.meshes[f].setExtension(this.extensionName,k);const et=h.extensions[this.extensionName];k.setExtras(et)}}),(i.json.nodes||[]).forEach((h,f)=>{if(h.extensions&&h.extensions[this.extensionName]){const k=new LI(this.document.getGraph(),"",this.extensionName);e.nodes[f].setExtension(this.extensionName,k);const et=h.extensions[this.extensionName];k.setExtras(et)}}),(i.json.scenes||[]).forEach((h,f)=>{if(h.extensions&&h.extensions[this.extensionName]){const k=new LI(this.document.getGraph(),"",this.extensionName);e.scenes[f].setExtension(this.extensionName,k);const et=h.extensions[this.extensionName];k.setExtras(et)}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(this.extensionName);if(a){const h=e.materialIndexMap.get(s),f=i.json.materials[h];f.extensions=f.extensions||{};const k={...a.getExtras()};for(const[et,tt]of Object.entries(a.textures)){const rt=tt[0],lt=tt[1];lt&&(k[et]=e.createTextureInfoDef(lt,rt))}f.extensions[this.extensionName]=k}}),this.document.getRoot().listMeshes().forEach(s=>{const a=s.getExtension(this.extensionName);if(a){const h=e.meshIndexMap.get(s),f=i.json.meshes[h];f.extensions=f.extensions||{},f.extensions[this.extensionName]=a.getExtras()}}),this.document.getRoot().listNodes().forEach(s=>{const a=s.getExtension(this.extensionName);if(a){const h=e.nodeIndexMap.get(s),f=i.json.nodes[h];f.extensions=f.extensions||{},f.extensions[this.extensionName]=a.getExtras()}}),this.document.getRoot().listScenes().forEach(s=>{const a=s.getExtension(this.extensionName);if(a){const h=e.jsonDoc.json.scene||0,f=i.json.scenes[h];if(!f)return;f.extensions=f.extensions||{},f.extensions[this.extensionName]=a.getExtras()}}),this}}class NI extends lv{constructor(){super(...arguments),this.extensionName=NI.EXTENSION_NAME,this.textureChannels={bumpTexture:Qu.R}}}NI.EXTENSION_NAME=xm;class FI extends lv{constructor(){super(...arguments),this.extensionName=FI.EXTENSION_NAME,this.textureChannels={lightMapTexture:Qu.R|Qu.G|Qu.B}}}FI.EXTENSION_NAME=bm;class UI extends lv{constructor(){super(...arguments),this.extensionName=UI.EXTENSION_NAME,this.textureChannels={alphaTexture:Qu.G}}}UI.EXTENSION_NAME=vv;class jI extends lv{constructor(){super(...arguments),this.extensionName=jI.EXTENSION_NAME}}jI.EXTENSION_NAME=Xl.DIAMOND_GLTF_EXTENSION;class zI extends lv{constructor(){super(...arguments),this.extensionName=zI.EXTENSION_NAME}}zI.EXTENSION_NAME=Rl.AnimationMarkersExtension;class VI extends lv{constructor(){super(...arguments),this.extensionName=VI.EXTENSION_NAME,this.textureChannels={anisotropyDirection:Qu.R|Qu.G|Qu.B}}}VI.EXTENSION_NAME=mm.ANISOTROPY_GLTF_EXTENSION;class QI extends lv{constructor(){super(...arguments),this.extensionName=QI.EXTENSION_NAME,this.textureChannels={anisotropyDirection:Qu.R|Qu.G|Qu.B}}}QI.EXTENSION_NAME=np.CUSTOM_BUMP_MAP_GLTF_EXTENSION;class GI extends lv{constructor(){super(...arguments),this.extensionName=GI.EXTENSION_NAME}}GI.EXTENSION_NAME=An;class HI extends lv{constructor(){super(...arguments),this.extensionName=HI.EXTENSION_NAME}}HI.EXTENSION_NAME=mv;class WI extends lv{constructor(){super(...arguments),this.extensionName=WI.EXTENSION_NAME}}WI.EXTENSION_NAME=em;class qI extends lv{constructor(){super(...arguments),this.extensionName=qI.EXTENSION_NAME}}qI.EXTENSION_NAME=$m.CLEARCOAT_TINT_GLTF_EXTENSION;class YI extends lv{constructor(){super(...arguments),this.extensionName=YI.EXTENSION_NAME}}YI.EXTENSION_NAME=Im.THIN_FILM_LAYER_GLTF_EXTENSION;class XI extends lv{constructor(){super(...arguments),this.extensionName=XI.EXTENSION_NAME}}XI.EXTENSION_NAME=vw.SSBEVEL_GLTF_EXTENSION;class KI extends lv{constructor(){super(...arguments),this.extensionName=KI.EXTENSION_NAME}}KI.EXTENSION_NAME=pp.NOISE_BUMP_MATERIAL_GLTF_EXTENSION;class OB extends j{constructor(){super(...arguments),this.processor={forAssetType:"texture",process:(e,i)=>e}}async onAdded(e){}async onDispose(e){}async onRemove(e){this._pmrem=void 0}}OB.PluginType="PMREMGenerator";const LB=new d.Pa4,tN=new d._fP,NB=new d.Pa4;class nN extends d.Tme{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(i){i.element instanceof Element&&i.element.parentNode!==null&&i.element.parentNode.removeChild(i.element)})})}copy(e,i){return super.copy(e,i),this.element=e.element.cloneNode(!0),this}}const ly=new d.yGw,rN=new d.yGw;class iN{constructor(e={}){const i=this;let s,a,h,f;const k={camera:{fov:0,style:""},objects:new WeakMap},et=e.element!==void 0?e.element:document.createElement("div");et.style.overflow="hidden",this.domElement=et;const tt=document.createElement("div");function rt(vt){return Math.abs(vt)<1e-10?0:vt}function lt(vt){const yt=vt.elements;return"matrix3d("+rt(yt[0])+","+rt(-yt[1])+","+rt(yt[2])+","+rt(yt[3])+","+rt(yt[4])+","+rt(-yt[5])+","+rt(yt[6])+","+rt(yt[7])+","+rt(yt[8])+","+rt(-yt[9])+","+rt(yt[10])+","+rt(yt[11])+","+rt(yt[12])+","+rt(-yt[13])+","+rt(yt[14])+","+rt(yt[15])+")"}function pt(vt){const yt=vt.elements;return"translate(-50%,-50%)matrix3d("+rt(yt[0])+","+rt(yt[1])+","+rt(yt[2])+","+rt(yt[3])+","+rt(-yt[4])+","+rt(-yt[5])+","+rt(-yt[6])+","+rt(-yt[7])+","+rt(yt[8])+","+rt(yt[9])+","+rt(yt[10])+","+rt(yt[11])+","+rt(yt[12])+","+rt(yt[13])+","+rt(yt[14])+","+rt(yt[15])+")"}function ft(vt,yt,Mt,xt){if(vt.isCSS3DObject){const Et=vt.visible===!0&&vt.layers.test(Mt.layers)===!0;if(vt.element.style.display=Et===!0?"":"none",Et===!0){let At;vt.onBeforeRender(i,yt,Mt),vt.isCSS3DSprite?(ly.copy(Mt.matrixWorldInverse),ly.transpose(),vt.rotation2D!==0&&ly.multiply(rN.makeRotationZ(vt.rotation2D)),vt.matrixWorld.decompose(LB,tN,NB),ly.setPosition(LB),ly.scale(NB),ly.elements[3]=0,ly.elements[7]=0,ly.elements[11]=0,ly.elements[15]=1,At=pt(ly)):At=pt(vt.matrixWorld);const Rt=vt.element,Bt=k.objects.get(vt);if(Bt===void 0||Bt.style!==At){Rt.style.transform=At;const Qt={style:At};k.objects.set(vt,Qt)}Rt.parentNode!==tt&&tt.appendChild(Rt),vt.onAfterRender(i,yt,Mt)}}for(let Et=0,At=vt.children.length;Et<At;Et++)ft(vt.children[Et],yt,Mt)}tt.style.transformStyle="preserve-3d",tt.style.pointerEvents="none",et.appendChild(tt),this.getSize=function(){return{width:s,height:a}},this.render=function(vt,yt){const Mt=yt.projectionMatrix.elements[5]*f;let xt,Et;k.camera.fov!==Mt&&(et.style.perspective=yt.isPerspectiveCamera?Mt+"px":"",k.camera.fov=Mt),vt.matrixWorldAutoUpdate===!0&&vt.updateMatrixWorld(),yt.parent===null&&yt.matrixWorldAutoUpdate===!0&&yt.updateMatrixWorld(),yt.isOrthographicCamera&&(xt=-(yt.right+yt.left)/2,Et=(yt.top+yt.bottom)/2);const At=yt.isOrthographicCamera?"scale("+Mt+")translate("+rt(xt)+"px,"+rt(Et)+"px)"+lt(yt.matrixWorldInverse):"translateZ("+Mt+"px)"+lt(yt.matrixWorldInverse),Rt=At+"translate("+h+"px,"+f+"px)";k.camera.style!==Rt&&(tt.style.transform=Rt,k.camera.style=Rt),ft(vt,vt,yt)},this.setSize=function(vt,yt){s=vt,a=yt,h=s/2,f=a/2,et.style.width=vt+"px",et.style.height=yt+"px",tt.style.width=vt+"px",tt.style.height=yt+"px"}}}var $I,JI=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};let iA=$I=class extends Js{constructor(c=!0){super(),this._scene=new d.xsS,this.overCanvas=!0,this._trackers=[],this.attachIFrameToSelected=async()=>{var e,i,s,a,h;const f=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(Uo))===null||i===void 0?void 0:i.getSelectedObject();if(!(f!=null&&f.geometry))return void await((s=this._viewer)===null||s===void 0?void 0:s.alert("No Geometry: Selected object must have a geometry to apply the iframe to"));const k=await((a=this._viewer)===null||a===void 0?void 0:a.prompt("URL: Enter the url for the webpage. (Make sure its allowed to be embedded in an iframe.)","https://webgi.xyz/",!1))||"https://webgi.pixotronics.com/";if(!k)return;const et=await((h=this._viewer)===null||h===void 0?void 0:h.prompt("Width: Enter the width for the object.","512",!1))||"512";et&&this.attachIFrame(f,k,parseInt(et))},this._resizeObserver=new ResizeObserver(()=>{var e;this.enabled&&((e=this._viewer)===null||e===void 0||e.scene.setDirty({sceneUpdate:!0}))}),this.enabled=c,this._refreshCanvasInDOM=this._refreshCanvasInDOM.bind(this),this._refreshEnabled=this._refreshEnabled.bind(this)}_refreshEnabled(){}_refreshCanvasInDOM(){const c=this._viewer;c&&this._renderer&&(c.canvas.remove(),this.overCanvas?this._renderer.domElement.insertAdjacentElement("afterbegin",c.canvas):this._renderer.domElement.appendChild(c.canvas))}_initialize(){if(this._renderer||!this._viewer)return;this._renderer=new iN;const c=this._viewer.renderer.rendererObject.getSize(new d.FM8);this._renderer.setSize(c.width,c.height);const e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.zIndex="0",e.appendChild(this._renderer.domElement),this._viewer.canvas.style.position="absolute",this._viewer.canvas.style.top="0",this._viewer.canvas.style.left="0",this._viewer.canvas.style.zIndex="0",this._viewer.container.appendChild(e),this._refreshCanvasInDOM(),this._viewer.renderer.addEventListener("resize",()=>{if(!this._viewer||!this._renderer)return;const i=this._viewer.renderer.rendererObject.getSize(new d.FM8);this._renderer.setSize(i.width,i.height)})}async onAdded(c){await super.onAdded(c);let e=!0,i=!0;c.addEventListener("postFrame",h=>{var f,k;e&&this.enabled&&(this._renderer||this._initialize(),this._renderer&&(i&&this._trackers.forEach(et=>{var tt,rt;let lt=!0;const pt=et.modelObj.material.side;if(pt!==d.ehD){const ft=new d.Pa4(0,0,1).applyQuaternion(et.cssObj.quaternion),vt=(rt=(tt=this._viewer)===null||tt===void 0?void 0:tt.scene.activeCamera)===null||rt===void 0?void 0:rt.cameraObject,yt=ft.dot(vt.getWorldDirection(new d.Pa4));lt=pt===d._Li?yt>0:yt<0}et.cssObj.element.style.visibility=lt?"visible":"hidden"}),this._trackers.filter(et=>et.dirty).forEach(et=>this._syncProperties(et)),(f=this._renderer)===null||f===void 0||f.render(this._scene,(k=c.scene.activeCamera)===null||k===void 0?void 0:k.cameraObject),e=!1))}),c.addEventListener("update",h=>{this.enabled&&(e=this._trackers.length>0)}),c.scene.addEventListener("sceneUpdate",h=>{this.enabled&&(this._trackers.forEach(f=>f.dirty=!0),e=this._trackers.length>0)}),c.scene.addEventListener("activeCameraUpdate",h=>{this.enabled&&(e=this._trackers.length>0,i=!0)});let s=!1;const a=new d.iMs;c.container.addEventListener("mousemove",h=>{if(!this.enabled||!this._viewer||this.overCanvas)return;const f=this._viewer.canvas.getBoundingClientRect(),k=(h.clientX-f.x)/f.width*2-1,et=-(h.clientY-f.y)/f.height*2+1;a.setFromCamera({x:k,y:et},this._viewer.scene.activeCamera.cameraObject);const tt=this._trackers.map(lt=>lt.modelObj),rt=a.intersectObjects(tt,!1);if(console.log(rt),rt.length)return this._viewer.canvas.style.pointerEvents="none",s=!0,void console.log(this._viewer.canvas.style.pointerEvents);s&&(this._viewer.canvas.style.pointerEvents="auto",s=!1)})}attachIFrame(c,e,i){const s=e2(c.modelObject),a=FB(e,i,i*s.y/s.x,()=>{var h;return(h=c.setDirty)===null||h===void 0?void 0:h.call(c)});return this.attachCSS3DObject(a,c),a}attachCSS3DObject(c,e){var i,s,a,h,f;if(this._trackers.push({cssObj:c,modelObj:e.modelObject,dirty:!0}),c.element&&(this._resizeObserver.observe(c.element),c.element.__isCSS3DObjectElement=!0,console.log(c.element,c.element.__isCSS3DObjectElement)),e.userData.__oldMaterial=e.material,!e.setMaterial)throw"model not processed?";const k=(i=this._viewer)===null||i===void 0?void 0:i.createMaterial("basic",{opacity:0,color:new d.Ilk("black"),blending:d.jFi,side:d.Wl3});if(!k)throw"cannot create mat";k.userData.forcedLinearDepth=0,(s=e.setMaterial)===null||s===void 0||s.call(e,k),ZI(e.modelObject),KP(e.modelObject),e2(e.modelObject),this._scene.add(c),(h=(a=this.uiConfig)===null||a===void 0?void 0:a.uiRefresh)===null||h===void 0||h.call(a),(f=e.setDirty)===null||f===void 0||f.call(e)}_syncProperties(c){const e=c.modelObj,i=c.cssObj;e.updateMatrixWorld();const s=c.cssObj.element.clientWidth<1.5?0:(c.cssObj.element.clientWidth-1.5)/e2(e).x,a=ZI(e);i.quaternion.setFromUnitVectors(new d.Pa4(0,0,1),a),i.position.copy(KP(e)),i.scale.set(1,1,1).multiplyScalar(1/s),i.updateMatrixWorld(),i.applyMatrix4(e.matrixWorld),c.dirty=!1}async onDispose(c){return this._resizeObserver.disconnect(),super.onDispose(c)}};function FB(c,e,i,s){const a=document.createElement("div");a.style.width=e.toString()+"px",a.style.height=i.toString()+"px",a.style.backgroundColor="transparent";const h=document.createElement("iframe",{is:"x-frame-bypass"});h.style.width="100%",h.style.height="100%",h.style.border="0px";const f=()=>{var k,et;try{h.contentWindow.name}catch(tt){(typeof tt=="string"?tt:(et=(k=tt==null?void 0:tt.toString)===null||k===void 0?void 0:k.call(tt))!==null&&et!==void 0?et:"").includes("cross-origin")?console.warn("Trying to load cross-origin scripts, Install chrome extension if not able to load: https://chrome.google.com/webstore/detail/ignore-x-frame-headers/gleekbfjekiniecknbkamfmkohkpodhe"):console.error(tt)}s(),h.removeEventListener("load",f)};return h.addEventListener("load",f),h.src=c,a.appendChild(h),new nN(a)}function ZI(c){if(c.geometry.userData.geometryNormal)return c.geometry.userData.geometryNormal;const e=c.geometry.attributes.normal,i=new d.Pa4,s=new d.Pa4;for(let a=0,h=e.count;a<h;a++)i.fromBufferAttribute(e,a),s.add(i);return s.normalize(),c.geometry.userData.geometryNormal=s,s}function KP(c){if(c.geometry.userData.geometryCenter)return c.geometry.userData.geometryCenter;const e=c.geometry;if(!e)return new d.Pa4(0,0,0);e.boundingBox||e.computeBoundingBox();const i=e.boundingBox.getCenter(new d.Pa4);return c.geometry.userData.geometryCenter=i,i}function e2(c,e=new d.Pa4(0,0,1)){if(c.geometry.userData.geometrySize)return c.geometry.userData.geometrySize;const i=c.geometry;if(!i)return new d.Pa4(0,0,0);const s=i.clone();s.applyMatrix4(new d.yGw().makeRotationFromQuaternion(new d._fP().setFromUnitVectors(e,ZI(c)).invert())),s.computeBoundingBox();const a=s.boundingBox.getSize(new d.Pa4);return c.geometry.userData.geometrySize=a,s.dispose(),a}iA.PluginType="CSS3DRenderer",JI([Jr("Enabled"),hn($I.prototype._refreshEnabled),jn()],iA.prototype,"enabled",void 0),JI([Jr("Over canvas"),hn($I.prototype._refreshCanvasInDOM),jn()],iA.prototype,"overCanvas",void 0),JI([Ao("Attach iframe")],iA.prototype,"attachIFrameToSelected",void 0),iA=$I=JI([Ws("CSS3D Renderer")],iA);const sN=1e4,UB=50;class ZE{constructor(e=UB){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(e)}setDecayTime(e){this.naturalFrequency=1/Math.max(.001,e)}update(e,i,s,a){const h=2e-4*this.naturalFrequency;if(e==null||a===0||e===i&&this.velocity===0)return i;if(s<0)return e;const f=e-i,k=this.velocity+this.naturalFrequency*f,et=f+s*k,tt=Math.exp(-this.naturalFrequency*s),rt=(k-this.naturalFrequency*et)*tt,lt=-this.naturalFrequency*(rt+k*tt);return Math.abs(rt)<h*Math.abs(a)&&lt*f>=0?(this.velocity=0,i):(this.velocity=rt,i+et*tt)}}const $P=new d.Pa4;class jB{constructor(){this.inputSource=null,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new d.Pa4,this.firstRatio=0,this.lastAngle=0,this.goalPosition=new d.Pa4,this.goalYaw=0,this.goalScale=1,this.presentedScene=null,this.placementBox=null,this.placeOnWall=!1,this.placementComplete=!1,this.xr=null,this.session=null,this._hitPosition=new d.Pa4,this._hitMatrix=new d.yGw,this.xDamper=new ZE,this.yDamper=new ZE,this.zDamper=new ZE,this.yawDamper=new ZE,this.scaleDamper=new ZE,this.onSelectStart=e=>{const i=this.transientHitTestSource;if(i==null)return;const s=this.frame.getHitTestResultsForTransientInput(i),a=this.presentedScene,h=this.placementBox;if(s.length===1){this.inputSource=e.inputSource;const{axes:f}=this.inputSource.gamepad||{axes:[0,0]},k=h.getHit(a,f[0],f[1]);h.show=!0,k!=null?(this.isTranslating=!0,this.lastDragPosition.copy(k)):this.placeOnWall||(this.isRotating=!0,this.lastAngle=1.5*f[0])}else if(s.length===2){h.show=!0,this.isTwoFingering=!0;const{separation:f}=this.fingerPolar(s);this.firstRatio=f/a.scale.x}},this.onSelectEnd=()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1}}async setSession(e,i,s,a){var h;this.transientHitTestSource=await((h=e.requestHitTestSourceForTransientInput)===null||h===void 0?void 0:h.call(e,{profile:"generic-touchscreen"})),this.presentedScene=i,this.placementBox=a,this.xr=s,this.session=e,this.placementComplete=!1,this.goalPosition.copy(i.position),this.goalYaw=i.rotation.y,this.goalScale=i.scale.x,e.addEventListener("selectstart",this.onSelectStart),e.addEventListener("selectend",this.onSelectEnd)}cancel(){this.transientHitTestSource&&(this.transientHitTestSource.cancel(),this.transientHitTestSource=void 0),this.presentedScene=null,this.placeOnWall=!1,this.frame=void 0,this.xr=null,this.placementBox&&(this.placementBox.show=!1,this.placementBox=null),this.session&&(this.session.removeEventListener("selectstart",this.onSelectStart),this.session.removeEventListener("selectend",this.onSelectEnd),this.session=null)}getHitPoint(e){var i;const s=(i=this.xr)===null||i===void 0?void 0:i.getReferenceSpace(),a=s?e.getPose(s):null;return a?(this._hitMatrix.fromArray(a.transform.matrix),this.placeOnWall&&(this.goalYaw=Math.atan2(this._hitMatrix.elements[4],this._hitMatrix.elements[6])),this._hitMatrix.elements[5]>.75!==this.placeOnWall?this._hitPosition.setFromMatrixPosition(this._hitMatrix):null):null}moveScene(e){if(!this.session)return;const i=this.presentedScene,s=i.position,a=i.rotation.y,h=this.placementBox,f=Math.max(h.boundingSize.x,h.boundingSize.y,h.boundingSize.z)/2,k=this.goalPosition,et=i.scale.x;if(!k.equals(s)||this.goalScale!==et){let{x:tt,y:rt,z:lt}=s;tt=this.xDamper.update(tt,k.x,e,f),rt=this.yDamper.update(rt,k.y,e,f),lt=this.zDamper.update(lt,k.z,e,f),s.set(tt,rt,lt);const pt=this.scaleDamper.update(et,this.goalScale,e,1);if(i.scale.set(pt,pt,pt),!this.isTranslating){const ft=k.y-rt;this.placementComplete&&!this.placeOnWall?h.offsetHeight=ft/pt:ft===0&&(this.placementComplete=!0,h.show=!1)}}h.updateOpacity(e),i.rotation.y=this.yawDamper.update(a,this.goalYaw,e,Math.PI)}processInput(e){var i;this.frame=e;const s=this.transientHitTestSource;if(!s||!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;const a=e.getHitTestResultsForTransientInput(s),h=this.presentedScene,f=h.scale.x;if(this.isTwoFingering)if(a.length<2)this.isTwoFingering=!1;else{const{separation:k,deltaYaw:et}=this.fingerPolar(a);if(this.placeOnWall||(this.goalYaw+=et),!h.userData.__scaleDisabled){const tt=k/this.firstRatio;this.goalScale=tt<1.3&&tt>.7692307692307692?1:tt}}else if(a.length!==2)if(this.isRotating&&(!((i=this.inputSource)===null||i===void 0)&&i.gamepad)){const k=1.5*this.inputSource.gamepad.axes[0];this.goalYaw+=k-this.lastAngle,this.lastAngle=k}else this.isTranslating&&(console.log("translating"),a.forEach(k=>{if(k.inputSource!==this.inputSource)return;let et=null;if(k.results.length>0&&(et=this.getHitPoint(k.results[0])),et==null&&(et=this.getTouchLocation()),et!=null){if(this.goalPosition.sub(this.lastDragPosition),!this.placeOnWall){const tt=et.y-this.lastDragPosition.y;if(tt<0){this.placementBox.offsetHeight=tt/f;const rt=$P.copy(this.xr.getCamera().position),lt=-tt/(rt.y-et.y);rt.multiplyScalar(lt),et.multiplyScalar(1-lt).add(rt)}}this.goalPosition.add(et),this.lastDragPosition.copy(et)}}));else{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;const{separation:k}=this.fingerPolar(a);this.firstRatio=k/f}}getTouchLocation(){var e,i;const{axes:s}=(e=this.inputSource.gamepad)!==null&&e!==void 0?e:{axes:[0,0]},a=this.placementBox.getExpandedHit(this.presentedScene,s[0],s[1]);return a!=null&&($P.copy(a).sub((i=this.xr)===null||i===void 0?void 0:i.getCamera().position),$P.length()>10)?null:a}fingerPolar(e){var i,s,a,h,f,k;const et=(a=(s=(i=e[0].inputSource)===null||i===void 0?void 0:i.gamepad)===null||s===void 0?void 0:s.axes)!==null&&a!==void 0?a:[0,0],tt=(k=(f=(h=e[1].inputSource)===null||h===void 0?void 0:h.gamepad)===null||f===void 0?void 0:f.axes)!==null&&k!==void 0?k:[0,0],rt=tt[0]-et[0],lt=tt[1]-et[1],pt=Math.atan2(lt,rt);let ft=this.lastAngle-pt;return ft>Math.PI?ft-=2*Math.PI:ft<-Math.PI&&(ft+=2*Math.PI),this.lastAngle=pt,{separation:Math.sqrt(rt*rt+lt*lt),deltaYaw:ft}}}const t2=.2,oN=Math.PI/24,zB=new d.FM8,n2=(c,e,i)=>{let s=e>0?i>0?0:-Math.PI/2:i>0?Math.PI/2:Math.PI;for(let a=0;a<=12;++a)c.push(e+.17*Math.cos(s),i+.17*Math.sin(s),0,e+t2*Math.cos(s),i+t2*Math.sin(s),0),s+=oN};class VB extends d.Kj0{constructor(e,i,s=!1){super(((et,tt)=>{const rt=new d.u9r,lt=[],pt=[],ft=et.getSize(new d.Pa4),vt=ft.x/2,yt=(tt?ft.y:ft.z)/2;n2(pt,vt,yt),n2(pt,-vt,yt),n2(pt,-vt,-yt),n2(pt,vt,-yt);const Mt=pt.length/3;for(let Et=0;Et<Mt-2;Et+=2)lt.push(Et,Et+1,Et+3,Et,Et+3,Et+2);const xt=Mt-2;return lt.push(xt,xt+1,1,xt,1,0),rt.setAttribute("position",new d.a$l(pt,3)),rt.setIndex(lt),rt})(e,s)),this.boundingSize=new d.Pa4,this._raycaster=new d.iMs,this._camera=i,this._placeOnWall=s;const a=this.material;a.side=d.Wl3,a.color=new oo(16711935),a.opacity=0,this.userData.bboxVisible=!1;const h=e.getSize(this.boundingSize);console.log(e,s,h,this);const f=h.x/2,k=(s?h.y:h.z)/2;this.hitPlane=new d.Kj0(new d._12(2*(f+t2),2*(k+t2))),this.hitPlane.visible=!1,this.add(this.hitPlane),e.getCenter(this.position),s?(this.shadowHeight=e.min.z,this.position.z=this.shadowHeight):(this.rotateX(-Math.PI/2),this.shadowHeight=e.min.y,this.position.y=this.shadowHeight),this.offsetHeight=0}getHit(e,i,s){zB.set(i,-s),this.hitPlane.visible=!0;const a=this._positionAndNormalFromPoint(zB,this.hitPlane);return this.hitPlane.visible=!1,a==null?null:a.position}getExpandedHit(e,i,s){this.hitPlane.scale.set(1e3,1e3,1e3);const a=this.getHit(e,i,s);return this.hitPlane.scale.set(1,1,1),a}set offsetHeight(e){e-=.001,this._placeOnWall?this.position.z=this.shadowHeight+e:this.position.y=this.shadowHeight+e}get offsetHeight(){return this._placeOnWall?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(e){this.material.opacity=e?.75:0}get show(){return this.material.opacity>.01}updateOpacity(e){const i=this.material;this.visible=i.opacity>0}dispose(){var e;const{geometry:i,material:s}=this.hitPlane;i.dispose(),s.dispose(),this.geometry.dispose(),this.material.dispose(),(e=this.parent)===null||e===void 0||e.remove(this)}_positionAndNormalFromPoint(e,i){if(!this._camera)return null;this._raycaster.setFromCamera(e,this._camera);const s=this._raycaster.intersectObject(i,!0);if(s.length===0)return null;const a=s[0];return a.face==null?null:a.uv==null?{position:a.point,normal:a.face.normal,uv:null}:(a.face.normal.applyNormalMatrix(new d.Vkp().getNormalMatrix(a.object.matrixWorld)),{position:a.point,normal:a.face.normal,uv:a.uv})}}class QB extends Js{constructor(){super(...arguments),this.enabled=!0,this._touchInputHelper=new jB,this._preRender=()=>{if(!(this._dirty&&this._viewer&&this._xrManager&&this._xrSession))return;this._viewer.renderer.composer.renderToScreen=!1,this._xrManager.enabled=!1;const e=this._xrManager.getCamera(),i=e.cameras[0]||e,s=this._viewer.scene.activeCamera;s.cameraObject.projectionMatrix.copy(i.projectionMatrix),s.cameraObject.projectionMatrixInverse.copy(s.cameraObject.projectionMatrix).invert()},this._postRender=()=>{var e,i;if(!this._dirty||!this._viewer||!this._xrSession)return;this._viewer.scene.activeCamera.cameraObject.updateProjectionMatrix();const s=this._viewer.renderer,a=(i=(e=this._xrManager)===null||e===void 0?void 0:e.getCamera())===null||i===void 0?void 0:i.cameras[0].viewport;a?s.rendererObject.setViewport(a):console.warn("no viewport for ar camera"),Lr(s.rendererObject,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!1,transmissionRender:!1,screenSpaceRendering:!1},()=>{r2.render(s.rendererObject,null,s.composer.readBuffer,0,!1)}),this._xrManager.enabled=!0,this._viewer.renderer.composer.renderToScreen=!0},this._frameCount=0,this._lastTime=0,this._preFrame=({xrFrame:e,deltaTime:i})=>{var s,a;if(this.dirty=!!e&&((s=this._xrManager)===null||s===void 0?void 0:s.isPresenting)||!1,this._viewer.scene.activeCamera.interactionsEnabled=!this._dirty,this._viewer.scene.activeCamera.autoLookAtTarget=!this._dirty,!this._dirty||!e)return void(this._xrSession&&this._xrSessionEnd());if(!this._xrSession&&!this._xrManager.getSession())return console.error("no xr session found, shouldn't happen"),void(this.dirty=!1);this._xrSession||console.log("webxr: AR session init"),this._frameCount++;const h=this._xrManager.getReferenceSpace(),f=e.getViewerPose(h);if(f==null&&this._frameCount,f==null||((a=this._viewer)===null||a===void 0?void 0:a.scene.modelRoot.children.length)===0)return this.dirty=!1,void console.log("no pose or no model");if(!this._xrSession){if(this._xrSession=this._xrManager.getSession()||void 0,!this._xrSession)return;this._frameCount=0,this._cancelHitSources(),this._savePreXRState(),this._preSetupModel(),this._xrSessionStart()}const k=this._viewer.scene.activeCamera;this._xrManager.updateCamera(k.cameraObject),k.setDirty(),this.moveToFloor(e),this._touchInputHelper.processInput(e),this._touchInputHelper.moveScene(i),this._updateShadow()},this.placeOnWall=!1,this._preXRState={viewerBg:null,modelScale:new d.Pa4(1,1,1),modelPosition:new d.Pa4,modelRotation:new d._fP,cameraPosition:new d.Pa4(0,0,5),cameraTarget:new d.Pa4,cameraUp:new d.Pa4(0,1,0),cameraAspect:1,cameraFov:50,cameraZoom:1,cameraNear:.01,cameraFar:100,groundOffset:new d.Pa4,groundScale:1},this._savePreXRState=()=>{if(!this._viewer)return;this._preXRState.viewerBg=this._viewer.getBackground(!0);const e=this._viewer.scene.modelRoot,i=this._viewer.scene.activeCamera;e.updateMatrix(),e.updateMatrixWorld(!0),this._preXRState.modelScale.copy(e.scale),this._preXRState.modelPosition.copy(e.position),this._preXRState.modelRotation.copy(e.quaternion),this._preXRState.cameraPosition.copy(i.position),this._preXRState.cameraTarget.copy(i.target),this._preXRState.cameraUp.copy(i.cameraObject.up),i.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov=i.cameraObject.fov,this._preXRState.cameraAspect=i.cameraObject.aspect),this._preXRState.cameraZoom=i.cameraObject.zoom,this._preXRState.cameraNear=i.cameraObject.near,this._preXRState.cameraFar=i.cameraObject.far;const s=this._viewer.getPluginByType("Ground");s!=null&&s.mesh&&(this._preXRState.groundOffset.subVectors(e.position,s.mesh.modelObject.position),this._preXRState.groundScale=s.mesh.modelObject.scale.x,console.log("ground offset",this._preXRState.groundOffset,this._preXRState.groundScale),s.shadowBaker.enabled=!1)},this._xrSessionStart=()=>{if(!this._xrSession||!this._viewer)return;console.log("webxr: AR session start");const e=20*Math.PI/180,i=this.placeOnWall?void 0:new window.XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(e),z:-Math.cos(e)});this._touchInputHelper.placeOnWall=this.placeOnWall,this._viewer.resize(),(async()=>{var s,a;if(this._xrSession){const h=await this._xrSession.requestReferenceSpace("viewer");this._hitTestSource=await((a=(s=this._xrSession).requestHitTestSource)===null||a===void 0?void 0:a.call(s,{space:h,offsetRay:i}))}this._xrSession&&await this._touchInputHelper.setSession(this._xrSession,this._viewer.scene.modelRoot,this._xrManager,this._placementBox)})()},this._xrSessionEnd=()=>{var e;console.log("webxr: AR session end"),this._frameCount=0,(e=this._xrSession)===null||e===void 0||e.removeEventListener("end",this._xrSessionEnd),this._xrSession=void 0,this._cancelHitSources(),this._viewer&&(this._restorePreXRState(),this._viewer.resize())}}async onAdded(e){await super.onAdded(e);const i=e.renderer.rendererObject.xr;i.enabled=!0,i.cameraAutoUpdate=!1,this._xrManager=i;const s=document.getElementById("tweakpaneUiContainer"),a=s?{root:s}:void 0;document.body.appendChild((class{static createButton(h,f={}){const k=document.createElement("button");function et(){k.style.display="",k.style.cursor="auto",k.style.left="calc(50% - 75px)",k.style.width="150px",k.onmouseenter=null,k.onmouseleave=null,k.onclick=null}function tt(rt){rt.style.position="absolute",rt.style.bottom="20px",rt.style.padding="12px 6px",rt.style.border="1px solid #fff",rt.style.borderRadius="4px",rt.style.background="rgba(0,0,0,0.1)",rt.style.color="#fff",rt.style.font="normal 13px sans-serif",rt.style.textAlign="center",rt.style.opacity="0.5",rt.style.outline="none",rt.style.zIndex="999"}if("xr"in navigator)return k.id="ARButton",k.style.display="none",tt(k),navigator.xr.isSessionSupported("immersive-ar").then(function(rt){rt?function(){if(f.domOverlay===void 0){const vt=document.createElement("div");vt.style.display="none",document.body.appendChild(vt);const yt=document.createElementNS("http://www.w3.org/2000/svg","svg");yt.setAttribute("width",38),yt.setAttribute("height",38),yt.style.position="absolute",yt.style.right="20px",yt.style.top="20px",yt.addEventListener("click",function(){lt.end()}),vt.appendChild(yt);const Mt=document.createElementNS("http://www.w3.org/2000/svg","path");Mt.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),Mt.setAttribute("stroke","#fff"),Mt.setAttribute("stroke-width",2),yt.appendChild(Mt),f.optionalFeatures===void 0&&(f.optionalFeatures=[]),f.optionalFeatures.push("dom-overlay"),f.domOverlay={root:vt}}let lt=null;async function pt(vt){vt.addEventListener("end",ft),h.xr.setReferenceSpaceType("local"),await h.xr.setSession(vt),k.textContent="STOP AR",f.domOverlay.root.style.display="",lt=vt}function ft(){lt.removeEventListener("end",ft),k.textContent="START AR",f.domOverlay.root.style.display="none",lt=null}k.style.display="",k.style.cursor="pointer",k.style.left="calc(50% - 50px)",k.style.width="100px",k.textContent="START AR",k.onmouseenter=function(){k.style.opacity="1.0"},k.onmouseleave=function(){k.style.opacity="0.5"},k.onclick=function(){lt===null?navigator.xr.requestSession("immersive-ar",f).then(pt):lt.end()}}():(et(),k.textContent="AR NOT SUPPORTED")}).catch(function(rt){et(),console.warn("Exception when trying to call xr.isSessionSupported",rt),k.textContent="AR NOT ALLOWED"}),k;{const rt=document.createElement("a");return window.isSecureContext===!1?(rt.href=document.location.href.replace(/^http:/,"https:"),rt.innerHTML="WEBXR NEEDS HTTPS"):(rt.href="https://immersiveweb.dev/",rt.innerHTML="WEBXR NOT AVAILABLE"),rt.style.left="calc(50% - 90px)",rt.style.width="180px",rt.style.textDecoration="none",tt(rt),rt}}}).createButton(e.renderer.rendererObject,{requiredFeatures:["hit-test"],optionalFeatures:["dom-overlay"],domOverlay:a})),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.addEventListener("preFrame",this._preFrame)}_updateShadow(){if(!this._viewer)return;const e=this._viewer.scene.modelRoot,i=this._viewer.getPluginByType("Ground");i&&(i.groundReflection=!1,i.mesh.modelObject.position.copy(this._preXRState.groundOffset).multiplyScalar(e.modelObject.scale.x).sub(e.modelObject.position).negate(),i.mesh.modelObject.scale.setScalar(e.modelObject.scale.x*this._preXRState.groundScale))}moveToFloor(e){if(!this._dirty||!this._hitTestSource||!this._xrManager)return;const i=e.getHitTestResults(this._hitTestSource);if(!i.length)return;const s=i[0],a=this._touchInputHelper.getHitPoint(s);a&&(this._placementBox.show=!0,this._viewer.scene.modelRoot,this.placeOnWall?this._touchInputHelper.goalPosition.copy(a):this._touchInputHelper.goalPosition.y=a.y,this._hitTestSource.cancel(),this._hitTestSource=void 0,console.log("move to initial hit point",a))}_removePlacementBox(){this._placementBox&&(this._placementBox.dispose(),this._placementBox=void 0)}_preSetupModel(){var e;const i=this._viewer.scene.modelRoot,s=this._viewer.scene.activeCamera,a=(e=this._xrManager)===null||e===void 0?void 0:e.getCamera(),h=a.cameras[0]||a;this._removePlacementBox();const f=this._viewer.scene.getBounds(!0,!0);f.getSize(new d.Pa4).length()>.01&&(this._placementBox=new VB(f,a,this.placeOnWall),i.add(this._placementBox),this._placementBox.show=!1);const k=a.getWorldDirection(new d.Pa4);i.rotation.y=Math.atan2(-k.x,-k.z)-0,s.cameraObject.zoom=h.zoom,s.cameraObject.near=h.near,s.cameraObject.far=h.far,s.cameraObject.isPerspectiveCamera?(s.cameraObject.fov=h.fov,s.cameraObject.aspect=h.viewport.width/h.viewport.height):console.warn("Perspective camera required."),s.cameraObject.updateProjectionMatrix(),i.position.set(0,0,0);const et=i.userData.arScale||1;i.scale.set(et,et,et),i.position.copy(a.position).add(k.multiplyScalar(5)),i.visible=!0,this._viewer.setBackground(null)}_restorePreXRState(){if(!this._viewer)return;this._viewer.setBackground(this._preXRState.viewerBg),this._preXRState.viewerBg=null;const e=this._viewer.scene.modelRoot;e.scale.copy(this._preXRState.modelScale),e.position.copy(this._preXRState.modelPosition),e.quaternion.copy(this._preXRState.modelRotation),e.updateMatrix(),e.updateMatrixWorld(!0),e.visible=!0;const i=this._viewer.scene.activeCamera;i.position.copy(this._preXRState.cameraPosition),i.target.copy(this._preXRState.cameraTarget),i.cameraObject.up.copy(this._preXRState.cameraUp),i.cameraObject.near=this._preXRState.cameraNear,i.cameraObject.far=this._preXRState.cameraFar,i.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov!==void 0&&(i.cameraObject.fov=this._preXRState.cameraFov),this._preXRState.cameraAspect!==void 0&&(i.cameraObject.aspect=this._preXRState.cameraAspect)),i.positionUpdated(!1),i.targetUpdated(!0),i.cameraObject.updateMatrixWorld(!0),i.cameraObject.updateProjectionMatrix()}_cancelHitSources(){this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0),this._touchInputHelper.cancel()}}QB.PluginType="WEBXR_ARPlugin";const r2=new kt({vertexShader:nt.vertexShader,fragmentShader:`
    uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			// gl_FragColor = vec4(1,0,1,1);
			gl_FragColor = texel;

		}
		`,uniforms:nt.uniforms});async function GB(c,e){if(c.createWriter){const s=await c.createWriter();return await s.write(0,e),void await s.close()}const i=await c.createWritable();await i.write(e),await i.close()}async function aN(c,e){const i={};return e&&(i.writable=!0,i.mode="readwrite"),await c.queryPermission(i)==="granted"||await c.requestPermission(i)==="granted"}r2.renderToScreen=!1,r2.useExistingRenderTarget=!0,r2.clear=!1;class oM extends j{constructor(e,i){super(),this._state="stopped",this._console=console,this._currentRecording=[],this._currentImages=[],this.stepMode=!1,this._resumeSyncTime=0,this._frameCount=0,this._onstop=a=>{var h;if(this._state="stopped",this._recorder&&this._currentRecording.length>0){const f=new Blob(this._currentRecording,{type:this._options.mimeType});(h=this._recordingCallback)===null||h===void 0||h.call(this,f)}else this._currentImages.length>0&&(this._writeImages([...this._currentImages]),this._currentImages=[]);this._recorder=void 0,this.dispatchEvent({type:"stop"})},this._onstart=a=>{var h;this._state="recording",this._frameCount=0,this.dispatchEvent({type:"start"}),this.stepMode&&((h=this._recorder)===null||h===void 0||h.pause())},this._onresume=a=>{if(!this.stepMode)return;const h=()=>{var k;this._state==="recording"&&((k=this._recorder)===null||k===void 0||k.pause())},f=Math.min(this._resumeSyncTime-mo(),0)+1e3/this._options.frameRate;f>0?au(f).then(h):h()},this._onpause=a=>{},this._ondataavailable=a=>{a.data&&a.data.size>0&&this._currentRecording.push(a.data)},this._onerror=a=>{this._state="error",this._console.error(a),this.dispatchEvent({type:"error",error:a}),this._recorder=void 0},this._canvas=e;const s=i==null?void 0:i.mimeType;this._options={mimeType:s||"auto",frameRate:30},this._setOptions(i||this._options)}_setOptions(e){var i,s;Object.assign(this._options,e),this._options.mimeType&&this._options.mimeType!=="auto"||(this._options.mimeType=(i=oM.GetSupportedMimeTypes([],["h264"],!0))!==null&&i!==void 0?i:oM.GetSupportedMimeTypes(void 0,void 0,!0)),this._options.mimeType&&!(!((s=this._options.mimeType)===null||s===void 0)&&s.startsWith("video/"))||window.MediaRecorder||(this._console.warn("MediaRecorder is not supported, switching to png"),this._options.mimeType="image/png"),this._options.mimeType||console.warn(new Error("No supported mimetype found"))}setOptions(e){this._setOptions(e)}isRecording(){return this._state==="recording"}start(){var e,i,s;if(this._state==="recording")return void this._console.log("Already recording canvas");if(this._state==="error"&&(this._recorder=void 0,this._console.warn("Resetting from error state.")),this._recorder)return this._state==="paused"?(this.dispatchEvent({type:"starting"}),void this._recorder.resume()):void this._console.warn("Canvas recorder unknown state",this._state);if(this._state==="paused")return this.dispatchEvent({type:"starting"}),void(this._state="recording");const a={mimeType:this._options.mimeType,videoBitsPerSecond:this._options.videoBitsPerSecond};if(this._currentRecording=[],this._currentImages=[],this._frameCount=0,(e=a.mimeType)===null||e===void 0?void 0:e.startsWith("video")){if(!window.MediaRecorder)return this._console.error("MediaRecorder not supported, use image sequence"),void(this._state="error");{const h=this._canvas.captureStream(this.stepMode?0:this._options.frameRate),f=(i=h.getVideoTracks())===null||i===void 0?void 0:i[0];this._track=f,this._recorder=new window.MediaRecorder(h,a),this._recorder.onstop=this._onstop,this._recorder.ondataavailable=this._ondataavailable,this._recorder.onerror=this._onerror,this._recorder.onresume=this._onresume,this._recorder.onstart=this._onstart}}this.dispatchEvent({type:"starting"}),this._recorder?(this._state="recording",(s=this._recorder)===null||s===void 0||s.start()):window.showDirectoryPicker&&window.showDirectoryPicker().then(async h=>{const f=await(h==null?void 0:h.getDirectoryHandle("i-"+Math.floor(Date.now()),{create:!0}));this._imgDirectory=f,this._state="recording",this._onstart({})}).catch(h=>{this._onerror({detail:h})})}async requestFrame(){if(this._state!=="recording")return;this._frameCount++;const e=this._options.mimeType;if(!this._recorder&&e.startsWith("image/")){const i=this._canvas.toDataURL(e,90);this._currentImages.push(["frame_"+String(this._frameCount).padStart(5,"0")+(e.includes("png")?".png":".jpg"),i]),this._currentImages.length>60&&(this._writeImages([...this._currentImages]),this._currentImages=[])}this._recorder&&this._track&&this.stepMode&&(this._resumeSyncTime=mo(),this._track.requestFrame(),this._recorder.resume())}pause(){this._state!=="paused"&&this._state!=="stopped"&&(this._recorder?this._recorder.pause():this._state="paused")}stop(e){this._state!=="stopped"&&(this._state!=="error"?(this._recordingCallback=e,this.dispatchEvent({type:"stopping"}),this._recorder?this._recorder.stop():this._onstop({})):this._console.error("Recorder in error state, cannot stop, call start again."))}get state(){return this._state}dispose(){this._recorder&&this._state!=="error"?this.stop(e=>{this._console.warn("disposed with blob",e),this.dispose()}):this._recorder=void 0}async _writeImages(e){if(!this._imgDirectory)return;const i=await Promise.all(e.map(async([a,h])=>await(await fetch(h)).blob())),s=[];for(let a=0;a<e.length;a++){const h=await this._imgDirectory.getFileHandle(e[a][0],{create:!0});s.push(GB(h,i[a]))}await Promise.all(s)}static GetSupportedMimeTypes(e,i,s=!1){if(!window.MediaRecorder)return s?void 0:[];const a=["webm","ogg","mp4","x-matroska"].filter(k=>!e||e.length<1||e.includes(k)),h=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h.265","h264","h.264","opus"].filter(k=>!i||i.length<1||i.includes(k)),f=[];return a.forEach(k=>{const et=`video/${k}`;h.forEach(tt=>{[`${et};codecs=${tt}`,`${et};codecs:${tt}`,`${et};codecs=${tt.toUpperCase()}`,`${et};codecs:${tt.toUpperCase()}`,`${et}`].forEach(rt=>{MediaRecorder.isTypeSupported(rt)&&f.push(rt)})})}),s?f.length>0?f[0]:void 0:f}}var JP=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};class cy extends Js{constructor(){super(...arguments),this.enabled=!0,this.convergeMode=!1,this.mimeType="auto",this.videoFrameRate=30,this._renderToScreenDisabled=!1,this._preRender=()=>{var e,i,s;if(this.convergeMode&&(!((e=this._recorder)===null||e===void 0)&&e.isRecording())){const a=this._viewer.renderer.composer.renderToScreen;this._viewer.renderer.composer.renderToScreen=((s=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("Progressive"))===null||s===void 0?void 0:s.isConverged())||!1,a&&!this._viewer.renderer.composer.renderToScreen&&(this._renderToScreenDisabled=!0)}},this._postRender=()=>{var e,i,s;if(!((e=this._recorder)===null||e===void 0)&&e.isRecording()&&(!this.convergeMode||!((s=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("Progressive"))===null||s===void 0)&&s.isConverged(!0))){const a=()=>{var h;return(h=this._recorder)===null||h===void 0?void 0:h.requestFrame()};this.convergeMode?au(1).then(a):a()}this._renderToScreenDisabled&&(this._viewer.renderer.composer.renderToScreen=!0)}}get recorder(){return this._recorder}isRecording(){var e,i;return(i=(e=this._recorder)===null||e===void 0?void 0:e.isRecording())!==null&&i!==void 0&&i}refreshRecorderOptions(){this._recorder&&(this._recorder.setOptions({frameRate:this.videoFrameRate,mimeType:this.mimeType}),this._recorder.stepMode=this.convergeMode)}async onAdded(e){await super.onAdded(e),this._recorder=new oM(e.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),this._recorder.addEventListener("starting",()=>this._stateChange(!1)),this._recorder.addEventListener("start",()=>{this.dispatchEvent({type:"start"}),this._stateChange(!this.convergeMode)}),this._recorder.addEventListener("error",()=>{this.dispatchEvent({type:"error"})}),this._recorder.addEventListener("pause",()=>this._stateChange(!1)),this._recorder.addEventListener("resume",()=>this._stateChange(!this.convergeMode)),this._recorder.addEventListener("stop",()=>{this.dispatchEvent({type:"stop"}),this._stateChange(!1)})}_stateChange(e){var i,s,a;this.dirty=e,(i=this._viewer)===null||i===void 0||i.setDirty(),(a=(s=this._uiConfig)===null||s===void 0?void 0:s.children)===null||a===void 0||a.map(h=>Ht(h)).flat(2).forEach(h=>{var f;return(f=h==null?void 0:h.uiRefresh)===null||f===void 0?void 0:f.call(h)})}async onRemove(e){var i;return e.removeEventListener("preRender",this._preRender),e.removeEventListener("preRender",this._postRender),(i=this._recorder)===null||i===void 0||i.dispose(),super.onRemove(e)}startRecording(){var e;return!!this.enabled&&((e=this.recorder)===null||e===void 0?void 0:e.isRecording())===!1&&(this.recorder.stepMode=this.convergeMode,this.recorder.start(),!0)}async stopRecording(){var e;if(!((e=this.recorder)===null||e===void 0)&&e.isRecording())return new Promise((i,s)=>{var a;return(a=this.recorder)===null||a===void 0?void 0:a.stop(i)})}get uiConfig(){if(this._uiConfig)return this._uiConfig;const e=this;return this._uiConfig={type:"folder",label:"Video Export",children:[{type:"slider",label:"Frame Rate",bounds:[1,60],stepSize:1,property:[this,"videoFrameRate"]},{type:"checkbox",limitedUi:!0,property:[this,"convergeMode"]},{type:"dropdown",label:"Mime type",limitedUi:!0,property:[this,"mimeType"],children:[["Auto Video (x264)","auto"],["PNG sequence","image/png"],["JPEG sequence","image/jpeg"]].map(i=>({label:i[0],value:i[1]}))},{type:"input",disabled:!0,label:"State",limitedUi:!0,get value(){var i,s;return(s=(i=e.recorder)===null||i===void 0?void 0:i.state)!==null&&s!==void 0?s:"not initialized"},set value(i){}},{type:"button",get label(){var i;return!((i=e.recorder)===null||i===void 0)&&i.isRecording()?"Stop":"Start"},value:()=>{var i;!((i=e.recorder)===null||i===void 0)&&i.isRecording()?this.stopRecording().then(s=>{if(s){console.log(s);const a=s.type.split(";")[0].split("/").pop()||"mp4";Du(s,"test."+a)}}):this.startRecording()}},{type:"button",limitedUi:!0,label:"Record Camera Views",hidden:()=>{var i,s;return!!(!((i=e.recorder)===null||i===void 0)&&i.isRecording())||!(!((s=this._viewer)===null||s===void 0)&&s.getPluginByType("CameraViews"))},value:()=>{var i,s;(s=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("CameraViews"))===null||s===void 0||s.recordAllViews()}},{type:"button",limitedUi:!0,label:"Record Camera Views + GLTF Anim",hidden:()=>{var i,s,a,h;return!!(!((i=e.recorder)===null||i===void 0)&&i.isRecording())||!(!((s=this._viewer)===null||s===void 0)&&s.getPluginByType("CameraViews"))||!(!((h=(a=this._viewer)===null||a===void 0?void 0:a.getPluginByType("GLTFAnimation"))===null||h===void 0)&&h.animations.length)},value:()=>{var i,s,a,h;const f=((s=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("GLTFAnimation"))===null||s===void 0?void 0:s.animationState)==="playing";(h=(a=this._viewer)===null||a===void 0?void 0:a.getPluginByType("CameraViews"))===null||h===void 0||h.recordAllViews(()=>{var k,et;(et=(k=this._viewer)===null||k===void 0?void 0:k.getPluginByType("GLTFAnimation"))===null||et===void 0||et.playAnimation()}).then(()=>{var k,et;f||(et=(k=this._viewer)===null||k===void 0?void 0:k.getPluginByType("GLTFAnimation"))===null||et===void 0||et.stopAnimation()})}}]}}}cy.PluginType="CanvasRecorder",JP([hn(cy.prototype.refreshRecorderOptions),jn()],cy.prototype,"convergeMode",void 0),JP([hn(cy.prototype.refreshRecorderOptions),jn()],cy.prototype,"mimeType",void 0),JP([hn(cy.prototype.refreshRecorderOptions),jn()],cy.prototype,"videoFrameRate",void 0);var i2=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};const ZP=new d.jyz({uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`});ZP.depthTest=!1;const eD=new d.jyz({uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`});eD.depthTest=!1;class uy extends Mp{constructor(e={},i=!1){super(e),this.contactShadows=!0,this.blurAmount=1,this.shadowScale=1,this.shadowHeight=5,this.shadowCamera=new d.iKG(-1,1,1,-1,.001,this.shadowHeight),this._refreshShadowCameraFrustum=this._refreshShadowCameraFrustum.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._showDebug=i,i&&this.dependencies.push(Tv)}async onAdded(e){const i=e.renderer.createTarget({type:d.ywz,format:d.wk1,encoding:d.rnI,size:{width:512,height:512},generateMipmaps:!1,depthBuffer:!0,minFilter:d.wem,magFilter:d.wem});i.texture.name="groundContactDepthTexture";const s=new d.lRF({depthPacking:d.z81});s.onBeforeCompile=function(h){h.uniforms.opacity.value=1,h.fragmentShader=`
						${h.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), 1.0 );")}
					`};const a=new jM(i,s);this._depthPass=a,await super.onAdded(e)}_postFrame(){super._postFrame(),this._viewer}_preRender(){if(super._preRender(),!this._viewer||!this._depthPass)return;this._depthPass.scene=this._viewer.scene.modelObject,this._depthPass.camera=this.shadowCamera,this._depthPass.render(this._viewer.renderer.rendererObject);const e=this._viewer.renderer.getTempTarget({type:d.ywz,format:d.wk1,encoding:d.rnI,size:{width:1024,height:1024},generateMipmaps:!1,depthBuffer:!1,minFilter:d.wem,magFilter:d.wem});this._blurShadow(e),this._blurShadow(e,.4),this._viewer.renderer.releaseTempTarget(e)}_blurShadow(e,i=1){this._viewer&&this._depthPass&&(ZP.uniforms.h.value=i*this.blurAmount/256,eD.uniforms.v.value=i*this.blurAmount/256,this._viewer.renderer.blit(this._depthPass.target.texture,e,{material:ZP,clear:!0}),this._viewer.renderer.blit(e.texture,this._depthPass.target,{material:eD,clear:!0}))}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_refreshTransform(){super._refreshTransform(),this._mesh&&this._viewer&&(this.shadowCamera.position.copy(this._mesh.getWorldPosition(new d.Pa4)),this.shadowCamera.setRotationFromEuler(new d.USm(Math.PI/2,0,0)),this.shadowCamera.updateMatrixWorld(),this._refreshShadowCameraFrustum(),this._mesh.scale.y=-this.size)}_refreshShadowCameraFrustum(){this.shadowCamera&&(this.shadowCamera.left=-this.size/(2*this.shadowScale),this.shadowCamera.right=this.size/(2*this.shadowScale),this.shadowCamera.top=this.size/(2*this.shadowScale),this.shadowCamera.bottom=-this.size/(2*this.shadowScale),this.shadowCamera.far=this.shadowHeight,this.shadowCamera.updateProjectionMatrix(),this._setDirty())}_setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}_removeMaterial(){this._material&&super._removeMaterial()}refreshOptions(){this._viewer&&super.refreshOptions()}_refreshMaterial(){var e;if(!this._viewer)return!1;const i=super._refreshMaterial();return this._material&&(this._material.alphaMap=((e=this._depthPass)===null||e===void 0?void 0:e.target.texture)||null,i&&(this._material.roughness=1,this._material.metalness=0,this._material.color.set(1118481),this._material.transparent=!0,this._material.materialObject.userData.ssreflDisabled=!0,this._material.materialObject.userData.ssreflNonPhysical=!1)),i}_extraUiConfig(){return[{label:"Contact Shadows",type:"checkbox",property:[this,"contactShadows"]},{label:"Shadow Scale",type:"slider",bounds:[0,2],property:[this,"shadowScale"]},{label:"Shadow Height",type:"slider",bounds:[0,20],property:[this,"shadowHeight"]},{label:"Blur Amount",type:"slider",bounds:[0,10],property:[this,"blurAmount"]},...super._extraUiConfig()]}}uy.PluginType="ContactShadowGroundPlugin",i2([hn(uy.prototype.refreshOptions),jn()],uy.prototype,"contactShadows",void 0),i2([jn(),hn(uy.prototype._setDirty)],uy.prototype,"blurAmount",void 0),i2([jn(),hn(uy.prototype._refreshShadowCameraFrustum)],uy.prototype,"shadowScale",void 0),i2([jn(),hn(uy.prototype._refreshShadowCameraFrustum)],uy.prototype,"shadowHeight",void 0);const eS=new d.cPb(45,1,.1,1e3);function tD(c,e,i,s=7,a=new d.Pa4(0,0,1.5)){i=i??c.scene.modelObject;const h=new sr().expandByObject(i??e,!0,!0),f=h.getCenter(new d.Pa4),k=h.getSize(new d.Pa4);eS.position.copy(f).add(a.clone().multiplyScalar(Math.max(k.x,k.y,k.z))),eS.lookAt(f),e&&e.traverseVisible(rt=>{rt.layers.enable(s)}),s>0?eS.layers.set(s):eS.layers.enableAll();const et=e==null?void 0:e.visible;e&&(e.visible=!0),c.renderer.rendererObject.setRenderTarget(null),c.renderer.rendererObject.render(i,eS);const tt=c.renderer.rendererObject.domElement.toDataURL("image/png");return e&&(e.visible=et,e.traverseVisible(rt=>{rt.layers.disable(s)}),eS.layers.enableAll()),c.setDirty(),tt}class nD{constructor(e){this.viewer=e,this._lights=[],this.shapes={sphere:new d.Kj0(new d.xo$(1)),cube:new d.Kj0(new d.DvJ(1,1,1)),cylinder:new d.Kj0(new d.fHI(.5,.5,1))};const i=new d.xsS;this._channel=7;const s=new d.vmT(16777215,4473924,1);s.position.set(0,10,0),s.layers.set(this._channel),i.add(s),this._lights.push(s),this._scene=i}dispose(){[...this._lights].forEach(e=>e.dispose()),Object.values(this.shapes).forEach(e=>{e.geometry&&e.geometry.dispose()})}generate(e,i="sphere"){const s=this.shapes[i]||new d.Kj0(new d.xo$(1));s.material=e.materialObject,s.geometry.attributes.tangent||s.geometry.computeTangents(),this._scene.add(s),this._scene.environment=this.viewer.scene.getEnvironment();const a=s.material.envMapIntensity;typeof a=="number"&&(s.material.envMapIntensity=Math.max(a,2));const h=tD(this.viewer,s,this._scene,this._channel,new d.Pa4(0,0,1.5));return typeof a=="number"&&(s.material.envMapIntensity=a),this._scene.remove(s),s.material=void 0,h}}class s2 extends Js{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{var e,i;this.enabled&&((i=(e=this.uiConfig).uiRefresh)===null||i===void 0||i.call(e))},this.dependencies=[Kr],this.variations=[],this._selectedMaterial=()=>{var e,i;return((i=(e=this._picking)===null||e===void 0?void 0:e.getSelectedObject())===null||i===void 0?void 0:i.material)||void 0},this.uiConfig={label:"Material Configurator",type:"folder",children:[()=>{var e;return[{type:"input",label:"uuid",property:[this._selectedMaterial(),"uuid"],hidden:()=>!this._selectedMaterial(),disabled:!0},{type:"input",label:"title",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"title"],onChange:async()=>this.refreshUi()},{type:"dropdown",label:"Preview Type",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"preview"],onChange:async()=>this.refreshUi(),children:["generate:sphere","generate:cube","color","map","emissive",...Object.keys(Iw).filter(i=>i.endsWith("Map"))].map(i=>({label:i,value:i}))},...((e=this.getSelectedVariation())===null||e===void 0?void 0:e.materials.map(i=>i.uiConfig?Object.assign(i.uiConfig,{expanded:!1}):{}))||[],{type:"button",label:"Remove All",hidden:()=>!this._selectedMaterial(),value:async()=>{const i=this.getSelectedVariation();i&&await this._viewer.confirm("Material configurator: Remove all variations for this material?")&&(i.materials=[]),this.refreshUi()}},{type:"button",label:"Remove Variation",hidden:()=>!this._selectedMaterial(),value:async()=>{const i=this.getSelectedVariation();i&&await this._viewer.confirm("Material configurator: Remove this variation?")&&this.removeVariation(i)}},{type:"button",label:"Add Variation",hidden:()=>!this._selectedMaterial(),value:()=>this.addVariation(this._selectedMaterial())},{type:"button",label:"Refresh Ui",value:()=>this.refreshUi()}]}]}}async onAdded(e){var i,s;await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("Picking"),this._previewGenerator=new nD(this._viewer),(s=this._picking)===null||s===void 0||s.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}fromJSON(e,i){return this.variations=[],super.fromJSON(e,i)}async onRemove(e){var i,s;return(i=this._previewGenerator)===null||i===void 0||i.dispose(),this._previewGenerator=void 0,(s=this._picking)===null||s===void 0||s.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}findVariation(e){return e?this.variations.find(i=>i.uuid===e):void 0}getSelectedVariation(){var e,i;return this.findVariation((e=this._selectedMaterial())===null||e===void 0?void 0:e.uuid)||this.findVariation((i=this._selectedMaterial())===null||i===void 0?void 0:i.name)}applyVariation(e,i){var s,a;const h=e.materials.find(f=>f.uuid===i);if(h){const f=(a=(s=this._viewer)===null||s===void 0?void 0:s.getManager())===null||a===void 0?void 0:a.materials;let k=f==null?void 0:f.findMaterialsByName(e.uuid);(!k||k.length<1)&&(k=[f==null?void 0:f.findMaterial(e.uuid)]),k.forEach(et=>{if(!et)return;const tt=et.name;et.copyProps(h),et.name=tt})}}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return!(!this.enabled||!this._viewer||!this._uiNeedRefresh||(this._uiNeedRefresh=!1,this._refreshUiConfig(),0))}removeVariationForMaterial(e){let i=this.findVariation(e.uuid);!i&&e.name.length>0&&(i=this.findVariation(e.name)),i&&this.removeVariation(i)}removeVariation(e){e&&(this.variations.splice(this.variations.indexOf(e),1),this.refreshUi())}addVariation(e){var i;const s=(i=e==null?void 0:e.clone)===null||i===void 0?void 0:i.call(e);if(e&&s){let a=this.findVariation(e.uuid);!a&&e.name.length>0&&(a=this.findVariation(e.name)),a||this.variations.push(a={uuid:e.name.length>0?e.name:e.uuid,title:"Name",preview:"generate:sphere",materials:[]}),a.materials.push(s),this.refreshUi()}}}s2.PluginType="MaterialConfiguratorBasePlugin",function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);h>3&&f&&Object.defineProperty(e,i,f)}([jn()],s2.prototype,"variations",void 0);const HB=(c,e=!0)=>{const i=new oo().set(c);return e&&i.convertLinearToSRGB(),`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='16' height='16' fill='%23${i.getHexString()}'/%3E%3C/svg%3E%0A`},WB=(c,e=!0)=>{const i=new oo().set(c);return e&&i.convertLinearToSRGB(),`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='8' cy='8' r='7' fill='%23${i.getHexString()}'/%3E%3C/svg%3E%0A`},aM=c=>`data:image/svg+xml,%3Csvg viewBox='0 0 80 14' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext style='font: 8px "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace; fill: white;' x='9' y='9'%3E${c}%3C/text%3E%3C/svg%3E%0A`,rD=async(c,e)=>Ru(await gA(c),e),qB=async(c,e)=>await rD(c,e).then(i=>i.toDataURL("image/png"));class p0{static _initialize(){this._inited=!0,Gv(Gt`
  .customContextGrid {
    background: #28223C;
    //backdrop-filter: blur(8px);
    border: 0.5px solid rgba(220, 220, 220, 0.3);
    width: auto;
    height: auto;
    position: absolute;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    z-index: 200;
    padding: 0.35rem 0.35rem;
    border-radius: 0.375rem;
    min-width: 5rem;
    pointer-events: auto;
    box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);

    color: white;
    font-size: 0.65rem;
    font-family: Inter, "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
  }
  .customContextGridItems {
    background-color: transparent;
    cursor: pointer;
    border-radius: 0.25rem;
    line-height: 1rem;
    font-weight: 500;
    overflow: hidden;
    margin: 0.12rem;
  }
  .customContextGridItems:hover {
    color: white;
    background-color: #017AFF;
  }
  .customContextGridItemImage{
    width: 100%;
    height: 100%;
  }
  .customContextGridHeading{
    width: 100%;
    padding: 0.12rem;
    font-size: 0.85rem;
  }

        `)}static Create(e,i,s,a,h,f,k){var et;this._inited||this._initialize();const tt=Tw(),rt=tt?.15:.25,lt=tt?1.5:2.5,pt=El({classList:["customContextGrid"],addToBody:!1,innerHTML:`
            <div class="customContextGridHeading"> ${i} </div>
            `});pt.style.top=h+"px",pt.style.left=a+"px",pt.style.gap=rt+"rem",pt.style.width=(lt+rt)*s-rt+"rem",pt.dataset.tag=e;for(const ft of f){const vt=El({classList:["customContextGridItems"],addToBody:!1,innerHTML:`
            <img src="${ft.image}" class="customContextGridItemImage">
            `});vt.style.width=lt+"rem",vt.style.height=lt+"rem",pt.appendChild(vt),vt.onclick=()=>{var yt;return(yt=ft.onClick)===null||yt===void 0?void 0:yt.call(ft,ft.id)},k(vt,ft)}return(et=this.Elements)===null||et===void 0||et.push(pt),pt}static RemoveAll(e){if(e){const i=this.Elements.filter(s=>s.dataset.tag===e);for(const s of i)s.remove();this.Elements=this.Elements.filter(s=>s.dataset.tag!==e)}else{for(const i of this.Elements)i.remove();this.Elements=[]}}static RebuildUi(e){if(this.Elements.length===0)return;e||(e=document.body);for(const s of this.Elements)s.remove();let i=20;for(const s of this.Elements)s.style.top=i+"px",e.appendChild(s),i+=s.clientHeight+20}}function f0(c){if(c==null)return window;if(c.toString()!=="[object Window]"){var e=c.ownerDocument;return e&&e.defaultView||window}return c}function tS(c){return c instanceof f0(c).Element||c instanceof Element}function __(c){return c instanceof f0(c).HTMLElement||c instanceof HTMLElement}function iD(c){return typeof ShadowRoot<"u"&&(c instanceof f0(c).ShadowRoot||c instanceof ShadowRoot)}p0.Elements=[],p0._inited=!1;var i1=Math.max,o2=Math.min,nS=Math.round;function rS(c,e){e===void 0&&(e=!1);var i=c.getBoundingClientRect(),s=1,a=1;if(__(c)&&e){var h=c.offsetHeight,f=c.offsetWidth;f>0&&(s=nS(i.width)/f||1),h>0&&(a=nS(i.height)/h||1)}return{width:i.width/s,height:i.height/a,top:i.top/a,right:i.right/s,bottom:i.bottom/a,left:i.left/s,x:i.left/s,y:i.top/a}}function sD(c){var e=f0(c);return{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function hy(c){return c?(c.nodeName||"").toLowerCase():null}function _w(c){return((tS(c)?c.ownerDocument:c.document)||window.document).documentElement}function oD(c){return rS(_w(c)).left+sD(c).scrollLeft}function sA(c){return f0(c).getComputedStyle(c)}function aD(c){var e=sA(c),i=e.overflow,s=e.overflowX,a=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+a+s)}function lN(c,e,i){i===void 0&&(i=!1);var s,a,h=__(e),f=__(e)&&function(lt){var pt=lt.getBoundingClientRect(),ft=nS(pt.width)/lt.offsetWidth||1,vt=nS(pt.height)/lt.offsetHeight||1;return ft!==1||vt!==1}(e),k=_w(e),et=rS(c,f),tt={scrollLeft:0,scrollTop:0},rt={x:0,y:0};return(h||!h&&!i)&&((hy(e)!=="body"||aD(k))&&(tt=(s=e)!==f0(s)&&__(s)?{scrollLeft:(a=s).scrollLeft,scrollTop:a.scrollTop}:sD(s)),__(e)?((rt=rS(e,!0)).x+=e.clientLeft,rt.y+=e.clientTop):k&&(rt.x=oD(k))),{x:et.left+tt.scrollLeft-rt.x,y:et.top+tt.scrollTop-rt.y,width:et.width,height:et.height}}function lD(c){var e=rS(c),i=c.offsetWidth,s=c.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-s)<=1&&(s=e.height),{x:c.offsetLeft,y:c.offsetTop,width:i,height:s}}function a2(c){return hy(c)==="html"?c:c.assignedSlot||c.parentNode||(iD(c)?c.host:null)||_w(c)}function YB(c){return["html","body","#document"].indexOf(hy(c))>=0?c.ownerDocument.body:__(c)&&aD(c)?c:YB(a2(c))}function lM(c,e){var i;e===void 0&&(e=[]);var s=YB(c),a=s===((i=c.ownerDocument)==null?void 0:i.body),h=f0(s),f=a?[h].concat(h.visualViewport||[],aD(s)?s:[]):s,k=e.concat(f);return a?k:k.concat(lM(a2(f)))}function cN(c){return["table","td","th"].indexOf(hy(c))>=0}function XB(c){return __(c)&&sA(c).position!=="fixed"?c.offsetParent:null}function cM(c){for(var e=f0(c),i=XB(c);i&&cN(i)&&sA(i).position==="static";)i=XB(i);return i&&(hy(i)==="html"||hy(i)==="body"&&sA(i).position==="static")?e:i||function(s){var a=navigator.userAgent.toLowerCase().indexOf("firefox")!==-1;if(navigator.userAgent.indexOf("Trident")!==-1&&__(s)&&sA(s).position==="fixed")return null;var h=a2(s);for(iD(h)&&(h=h.host);__(h)&&["html","body"].indexOf(hy(h))<0;){var f=sA(h);if(f.transform!=="none"||f.perspective!=="none"||f.contain==="paint"||["transform","perspective"].indexOf(f.willChange)!==-1||a&&f.willChange==="filter"||a&&f.filter&&f.filter!=="none")return h;h=h.parentNode}return null}(c)||e}var Lm="top",Lv="bottom",Nv="right",Nm="left",l2="auto",iS=[Lm,Lv,Nv,Nm],s1="start",sS="end",KB="clippingParents",cD="viewport",oS="popper",$B="reference",uD=iS.reduce(function(c,e){return c.concat([e+"-"+s1,e+"-"+sS])},[]),hD=[].concat(iS,[l2]).reduce(function(c,e){return c.concat([e,e+"-"+s1,e+"-"+sS])},[]),JB="beforeRead",ZB="read",e3="afterRead",t3="beforeMain",n3="main",r3="afterMain",i3="beforeWrite",s3="write",o3="afterWrite",a3=[JB,ZB,e3,t3,n3,r3,i3,s3,o3];function uN(c){var e=new Map,i=new Set,s=[];function a(h){i.add(h.name),[].concat(h.requires||[],h.requiresIfExists||[]).forEach(function(f){if(!i.has(f)){var k=e.get(f);k&&a(k)}}),s.push(h)}return c.forEach(function(h){e.set(h.name,h)}),c.forEach(function(h){i.has(h.name)||a(h)}),s}var l3={placement:"bottom",modifiers:[],strategy:"absolute"};function c3(){for(var c=arguments.length,e=new Array(c),i=0;i<c;i++)e[i]=arguments[i];return!e.some(function(s){return!(s&&typeof s.getBoundingClientRect=="function")})}function c2(c){c===void 0&&(c={});var e=c,i=e.defaultModifiers,s=i===void 0?[]:i,a=e.defaultOptions,h=a===void 0?l3:a;return function(f,k,et){et===void 0&&(et=h);var tt,rt,lt={placement:"bottom",orderedModifiers:[],options:Object.assign({},l3,h),modifiersData:{},elements:{reference:f,popper:k},attributes:{},styles:{}},pt=[],ft=!1,vt={state:lt,setOptions:function(Mt){var xt=typeof Mt=="function"?Mt(lt.options):Mt;yt(),lt.options=Object.assign({},h,lt.options,xt),lt.scrollParents={reference:tS(f)?lM(f):f.contextElement?lM(f.contextElement):[],popper:lM(k)};var Et,At,Rt=function(Bt){var Qt=uN(Bt);return a3.reduce(function(Wt,tn){return Wt.concat(Qt.filter(function(pn){return pn.phase===tn}))},[])}((Et=[].concat(s,lt.options.modifiers),At=Et.reduce(function(Bt,Qt){var Wt=Bt[Qt.name];return Bt[Qt.name]=Wt?Object.assign({},Wt,Qt,{options:Object.assign({},Wt.options,Qt.options),data:Object.assign({},Wt.data,Qt.data)}):Qt,Bt},{}),Object.keys(At).map(function(Bt){return At[Bt]})));return lt.orderedModifiers=Rt.filter(function(Bt){return Bt.enabled}),lt.orderedModifiers.forEach(function(Bt){var Qt=Bt.name,Wt=Bt.options,tn=Wt===void 0?{}:Wt,pn=Bt.effect;if(typeof pn=="function"){var yn=pn({state:lt,name:Qt,instance:vt,options:tn});pt.push(yn||function(){})}}),vt.update()},forceUpdate:function(){if(!ft){var Mt=lt.elements,xt=Mt.reference,Et=Mt.popper;if(c3(xt,Et)){lt.rects={reference:lN(xt,cM(Et),lt.options.strategy==="fixed"),popper:lD(Et)},lt.reset=!1,lt.placement=lt.options.placement,lt.orderedModifiers.forEach(function(pn){return lt.modifiersData[pn.name]=Object.assign({},pn.data)});for(var At=0;At<lt.orderedModifiers.length;At++)if(lt.reset!==!0){var Rt=lt.orderedModifiers[At],Bt=Rt.fn,Qt=Rt.options,Wt=Qt===void 0?{}:Qt,tn=Rt.name;typeof Bt=="function"&&(lt=Bt({state:lt,options:Wt,name:tn,instance:vt})||lt)}else lt.reset=!1,At=-1}}},update:(tt=function(){return new Promise(function(Mt){vt.forceUpdate(),Mt(lt)})},function(){return rt||(rt=new Promise(function(Mt){Promise.resolve().then(function(){rt=void 0,Mt(tt())})})),rt}),destroy:function(){yt(),ft=!0}};if(!c3(f,k))return vt;function yt(){pt.forEach(function(Mt){return Mt()}),pt=[]}return vt.setOptions(et).then(function(Mt){!ft&&et.onFirstUpdate&&et.onFirstUpdate(Mt)}),vt}}var hN=c2(),u2={passive:!0},dD={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(c){var e=c.state,i=c.instance,s=c.options,a=s.scroll,h=a===void 0||a,f=s.resize,k=f===void 0||f,et=f0(e.elements.popper),tt=[].concat(e.scrollParents.reference,e.scrollParents.popper);return h&&tt.forEach(function(rt){rt.addEventListener("scroll",i.update,u2)}),k&&et.addEventListener("resize",i.update,u2),function(){h&&tt.forEach(function(rt){rt.removeEventListener("scroll",i.update,u2)}),k&&et.removeEventListener("resize",i.update,u2)}},data:{}};function dy(c){return c.split("-")[0]}function aS(c){return c.split("-")[1]}function pD(c){return["top","bottom"].indexOf(c)>=0?"x":"y"}function u3(c){var e,i=c.reference,s=c.element,a=c.placement,h=a?dy(a):null,f=a?aS(a):null,k=i.x+i.width/2-s.width/2,et=i.y+i.height/2-s.height/2;switch(h){case Lm:e={x:k,y:i.y-s.height};break;case Lv:e={x:k,y:i.y+i.height};break;case Nv:e={x:i.x+i.width,y:et};break;case Nm:e={x:i.x-s.width,y:et};break;default:e={x:i.x,y:i.y}}var tt=h?pD(h):null;if(tt!=null){var rt=tt==="y"?"height":"width";switch(f){case s1:e[tt]=e[tt]-(i[rt]/2-s[rt]/2);break;case sS:e[tt]=e[tt]+(i[rt]/2-s[rt]/2)}}return e}var fD={name:"popperOffsets",enabled:!0,phase:"read",fn:function(c){var e=c.state,i=c.name;e.modifiersData[i]=u3({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})},data:{}},dN={top:"auto",right:"auto",bottom:"auto",left:"auto"};function h3(c){var e,i=c.popper,s=c.popperRect,a=c.placement,h=c.variation,f=c.offsets,k=c.position,et=c.gpuAcceleration,tt=c.adaptive,rt=c.roundOffsets,lt=c.isFixed,pt=f.x,ft=pt===void 0?0:pt,vt=f.y,yt=vt===void 0?0:vt,Mt=typeof rt=="function"?rt({x:ft,y:yt}):{x:ft,y:yt};ft=Mt.x,yt=Mt.y;var xt=f.hasOwnProperty("x"),Et=f.hasOwnProperty("y"),At=Nm,Rt=Lm,Bt=window;if(tt){var Qt=cM(i),Wt="clientHeight",tn="clientWidth";Qt===f0(i)&&sA(Qt=_w(i)).position!=="static"&&k==="absolute"&&(Wt="scrollHeight",tn="scrollWidth"),(a===Lm||(a===Nm||a===Nv)&&h===sS)&&(Rt=Lv,yt-=(lt&&Qt===Bt&&Bt.visualViewport?Bt.visualViewport.height:Qt[Wt])-s.height,yt*=et?1:-1),a!==Nm&&(a!==Lm&&a!==Lv||h!==sS)||(At=Nv,ft-=(lt&&Qt===Bt&&Bt.visualViewport?Bt.visualViewport.width:Qt[tn])-s.width,ft*=et?1:-1)}var pn,yn=Object.assign({position:k},tt&&dN),En=rt===!0?function(wn){var In=wn.x,xn=wn.y,Cn=window.devicePixelRatio||1;return{x:nS(In*Cn)/Cn||0,y:nS(xn*Cn)/Cn||0}}({x:ft,y:yt}):{x:ft,y:yt};return ft=En.x,yt=En.y,et?Object.assign({},yn,((pn={})[Rt]=Et?"0":"",pn[At]=xt?"0":"",pn.transform=(Bt.devicePixelRatio||1)<=1?"translate("+ft+"px, "+yt+"px)":"translate3d("+ft+"px, "+yt+"px, 0)",pn)):Object.assign({},yn,((e={})[Rt]=Et?yt+"px":"",e[At]=xt?ft+"px":"",e.transform="",e))}var mD={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(c){var e=c.state,i=c.options,s=i.gpuAcceleration,a=s===void 0||s,h=i.adaptive,f=h===void 0||h,k=i.roundOffsets,et=k===void 0||k,tt={placement:dy(e.placement),variation:aS(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:a,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,h3(Object.assign({},tt,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:f,roundOffsets:et})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,h3(Object.assign({},tt,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:et})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})},data:{}},h2={name:"applyStyles",enabled:!0,phase:"write",fn:function(c){var e=c.state;Object.keys(e.elements).forEach(function(i){var s=e.styles[i]||{},a=e.attributes[i]||{},h=e.elements[i];__(h)&&hy(h)&&(Object.assign(h.style,s),Object.keys(a).forEach(function(f){var k=a[f];k===!1?h.removeAttribute(f):h.setAttribute(f,k===!0?"":k)}))})},effect:function(c){var e=c.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(s){var a=e.elements[s],h=e.attributes[s]||{},f=Object.keys(e.styles.hasOwnProperty(s)?e.styles[s]:i[s]).reduce(function(k,et){return k[et]="",k},{});__(a)&&hy(a)&&(Object.assign(a.style,f),Object.keys(h).forEach(function(k){a.removeAttribute(k)}))})}},requires:["computeStyles"]},d3={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(c){var e=c.state,i=c.options,s=c.name,a=i.offset,h=a===void 0?[0,0]:a,f=hD.reduce(function(rt,lt){return rt[lt]=function(pt,ft,vt){var yt=dy(pt),Mt=[Nm,Lm].indexOf(yt)>=0?-1:1,xt=typeof vt=="function"?vt(Object.assign({},ft,{placement:pt})):vt,Et=xt[0],At=xt[1];return Et=Et||0,At=(At||0)*Mt,[Nm,Nv].indexOf(yt)>=0?{x:At,y:Et}:{x:Et,y:At}}(lt,e.rects,h),rt},{}),k=f[e.placement],et=k.x,tt=k.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=et,e.modifiersData.popperOffsets.y+=tt),e.modifiersData[s]=f}},pN={left:"right",right:"left",bottom:"top",top:"bottom"};function d2(c){return c.replace(/left|right|bottom|top/g,function(e){return pN[e]})}var fN={start:"end",end:"start"};function p3(c){return c.replace(/start|end/g,function(e){return fN[e]})}function f3(c,e){var i=e.getRootNode&&e.getRootNode();if(c.contains(e))return!0;if(i&&iD(i)){var s=e;do{if(s&&c.isSameNode(s))return!0;s=s.parentNode||s.host}while(s)}return!1}function gD(c){return Object.assign({},c,{left:c.x,top:c.y,right:c.x+c.width,bottom:c.y+c.height})}function m3(c,e){return e===cD?gD(function(i){var s=f0(i),a=_w(i),h=s.visualViewport,f=a.clientWidth,k=a.clientHeight,et=0,tt=0;return h&&(f=h.width,k=h.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(et=h.offsetLeft,tt=h.offsetTop)),{width:f,height:k,x:et+oD(i),y:tt}}(c)):tS(e)?function(i){var s=rS(i);return s.top=s.top+i.clientTop,s.left=s.left+i.clientLeft,s.bottom=s.top+i.clientHeight,s.right=s.left+i.clientWidth,s.width=i.clientWidth,s.height=i.clientHeight,s.x=s.left,s.y=s.top,s}(e):gD(function(i){var s,a=_w(i),h=sD(i),f=(s=i.ownerDocument)==null?void 0:s.body,k=i1(a.scrollWidth,a.clientWidth,f?f.scrollWidth:0,f?f.clientWidth:0),et=i1(a.scrollHeight,a.clientHeight,f?f.scrollHeight:0,f?f.clientHeight:0),tt=-h.scrollLeft+oD(i),rt=-h.scrollTop;return sA(f||a).direction==="rtl"&&(tt+=i1(a.clientWidth,f?f.clientWidth:0)-k),{width:k,height:et,x:tt,y:rt}}(_w(c)))}function g3(c){return Object.assign({},{top:0,right:0,bottom:0,left:0},c)}function v3(c,e){return e.reduce(function(i,s){return i[s]=c,i},{})}function lS(c,e){e===void 0&&(e={});var i=e,s=i.placement,a=s===void 0?c.placement:s,h=i.boundary,f=h===void 0?KB:h,k=i.rootBoundary,et=k===void 0?cD:k,tt=i.elementContext,rt=tt===void 0?oS:tt,lt=i.altBoundary,pt=lt!==void 0&&lt,ft=i.padding,vt=ft===void 0?0:ft,yt=g3(typeof vt!="number"?vt:v3(vt,iS)),Mt=rt===oS?$B:oS,xt=c.rects.popper,Et=c.elements[pt?Mt:rt],At=function(En,wn,In){var xn=wn==="clippingParents"?function(Wn){var or=lM(a2(Wn)),fr=["absolute","fixed"].indexOf(sA(Wn).position)>=0&&__(Wn)?cM(Wn):Wn;return tS(fr)?or.filter(function(rr){return tS(rr)&&f3(rr,fr)&&hy(rr)!=="body"}):[]}(En):[].concat(wn),Cn=[].concat(xn,[In]),Fn=Cn[0],Tn=Cn.reduce(function(Wn,or){var fr=m3(En,or);return Wn.top=i1(fr.top,Wn.top),Wn.right=o2(fr.right,Wn.right),Wn.bottom=o2(fr.bottom,Wn.bottom),Wn.left=i1(fr.left,Wn.left),Wn},m3(En,Fn));return Tn.width=Tn.right-Tn.left,Tn.height=Tn.bottom-Tn.top,Tn.x=Tn.left,Tn.y=Tn.top,Tn}(tS(Et)?Et:Et.contextElement||_w(c.elements.popper),f,et),Rt=rS(c.elements.reference),Bt=u3({reference:Rt,element:xt,strategy:"absolute",placement:a}),Qt=gD(Object.assign({},xt,Bt)),Wt=rt===oS?Qt:Rt,tn={top:At.top-Wt.top+yt.top,bottom:Wt.bottom-At.bottom+yt.bottom,left:At.left-Wt.left+yt.left,right:Wt.right-At.right+yt.right},pn=c.modifiersData.offset;if(rt===oS&&pn){var yn=pn[a];Object.keys(tn).forEach(function(En){var wn=[Nv,Lv].indexOf(En)>=0?1:-1,In=[Lm,Lv].indexOf(En)>=0?"y":"x";tn[En]+=yn[In]*wn})}return tn}var _3={name:"flip",enabled:!0,phase:"main",fn:function(c){var e=c.state,i=c.options,s=c.name;if(!e.modifiersData[s]._skip){for(var a=i.mainAxis,h=a===void 0||a,f=i.altAxis,k=f===void 0||f,et=i.fallbackPlacements,tt=i.padding,rt=i.boundary,lt=i.rootBoundary,pt=i.altBoundary,ft=i.flipVariations,vt=ft===void 0||ft,yt=i.allowedAutoPlacements,Mt=e.options.placement,xt=dy(Mt),Et=et||(xt!==Mt&&vt?function(rr){if(dy(rr)===l2)return[];var Ir=d2(rr);return[p3(rr),Ir,p3(Ir)]}(Mt):[d2(Mt)]),At=[Mt].concat(Et).reduce(function(rr,Ir){return rr.concat(dy(Ir)===l2?function(kr,Br){Br===void 0&&(Br={});var Ur=Br,hs=Ur.placement,_r=Ur.boundary,Ys=Ur.rootBoundary,po=Ur.padding,Xs=Ur.flipVariations,ko=Ur.allowedAutoPlacements,Jo=ko===void 0?hD:ko,cr=aS(hs),Nr=cr?Xs?uD:uD.filter(function(Xo){return aS(Xo)===cr}):iS,Fr=Nr.filter(function(Xo){return Jo.indexOf(Xo)>=0});Fr.length===0&&(Fr=Nr);var Ks=Fr.reduce(function(Xo,mn){return Xo[mn]=lS(kr,{placement:mn,boundary:_r,rootBoundary:Ys,padding:po})[dy(mn)],Xo},{});return Object.keys(Ks).sort(function(Xo,mn){return Ks[Xo]-Ks[mn]})}(e,{placement:Ir,boundary:rt,rootBoundary:lt,padding:tt,flipVariations:vt,allowedAutoPlacements:yt}):Ir)},[]),Rt=e.rects.reference,Bt=e.rects.popper,Qt=new Map,Wt=!0,tn=At[0],pn=0;pn<At.length;pn++){var yn=At[pn],En=dy(yn),wn=aS(yn)===s1,In=[Lm,Lv].indexOf(En)>=0,xn=In?"width":"height",Cn=lS(e,{placement:yn,boundary:rt,rootBoundary:lt,altBoundary:pt,padding:tt}),Fn=In?wn?Nv:Nm:wn?Lv:Lm;Rt[xn]>Bt[xn]&&(Fn=d2(Fn));var Tn=d2(Fn),Wn=[];if(h&&Wn.push(Cn[En]<=0),k&&Wn.push(Cn[Fn]<=0,Cn[Tn]<=0),Wn.every(function(rr){return rr})){tn=yn,Wt=!1;break}Qt.set(yn,Wn)}if(Wt)for(var or=function(rr){var Ir=At.find(function(kr){var Br=Qt.get(kr);if(Br)return Br.slice(0,rr).every(function(Ur){return Ur})});if(Ir)return tn=Ir,"break"},fr=vt?3:1;fr>0&&or(fr)!=="break";fr--);e.placement!==tn&&(e.modifiersData[s]._skip=!0,e.placement=tn,e.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function uM(c,e,i){return i1(c,o2(e,i))}var y3={name:"preventOverflow",enabled:!0,phase:"main",fn:function(c){var e=c.state,i=c.options,s=c.name,a=i.mainAxis,h=a===void 0||a,f=i.altAxis,k=f!==void 0&&f,et=i.boundary,tt=i.rootBoundary,rt=i.altBoundary,lt=i.padding,pt=i.tether,ft=pt===void 0||pt,vt=i.tetherOffset,yt=vt===void 0?0:vt,Mt=lS(e,{boundary:et,rootBoundary:tt,padding:lt,altBoundary:rt}),xt=dy(e.placement),Et=aS(e.placement),At=!Et,Rt=pD(xt),Bt=Rt==="x"?"y":"x",Qt=e.modifiersData.popperOffsets,Wt=e.rects.reference,tn=e.rects.popper,pn=typeof yt=="function"?yt(Object.assign({},e.rects,{placement:e.placement})):yt,yn=typeof pn=="number"?{mainAxis:pn,altAxis:pn}:Object.assign({mainAxis:0,altAxis:0},pn),En=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,wn={x:0,y:0};if(Qt){if(h){var In,xn=Rt==="y"?Lm:Nm,Cn=Rt==="y"?Lv:Nv,Fn=Rt==="y"?"height":"width",Tn=Qt[Rt],Wn=Tn+Mt[xn],or=Tn-Mt[Cn],fr=ft?-tn[Fn]/2:0,rr=Et===s1?Wt[Fn]:tn[Fn],Ir=Et===s1?-tn[Fn]:-Wt[Fn],kr=e.elements.arrow,Br=ft&&kr?lD(kr):{width:0,height:0},Ur=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},hs=Ur[xn],_r=Ur[Cn],Ys=uM(0,Wt[Fn],Br[Fn]),po=At?Wt[Fn]/2-fr-Ys-hs-yn.mainAxis:rr-Ys-hs-yn.mainAxis,Xs=At?-Wt[Fn]/2+fr+Ys+_r+yn.mainAxis:Ir+Ys+_r+yn.mainAxis,ko=e.elements.arrow&&cM(e.elements.arrow),Jo=ko?Rt==="y"?ko.clientTop||0:ko.clientLeft||0:0,cr=(In=En==null?void 0:En[Rt])!=null?In:0,Nr=Tn+Xs-cr,Fr=uM(ft?o2(Wn,Tn+po-cr-Jo):Wn,Tn,ft?i1(or,Nr):or);Qt[Rt]=Fr,wn[Rt]=Fr-Tn}if(k){var Ks,Xo=Rt==="x"?Lm:Nm,mn=Rt==="x"?Lv:Nv,Nn=Qt[Bt],vn=Bt==="y"?"height":"width",Qn=Nn+Mt[Xo],Zn=Nn-Mt[mn],Vn=[Lm,Nm].indexOf(xt)!==-1,lr=(Ks=En==null?void 0:En[Bt])!=null?Ks:0,Vr=Vn?Qn:Nn-Wt[vn]-tn[vn]-lr+yn.altAxis,es=Vn?Nn+Wt[vn]+tn[vn]-lr-yn.altAxis:Zn,cs=ft&&Vn?function(as,ds,rs){var ts=uM(as,ds,rs);return ts>rs?rs:ts}(Vr,Nn,es):uM(ft?Vr:Qn,Nn,ft?es:Zn);Qt[Bt]=cs,wn[Bt]=cs-Nn}e.modifiersData[s]=wn}},requiresIfExists:["offset"]},A3={name:"arrow",enabled:!0,phase:"main",fn:function(c){var e,i=c.state,s=c.name,a=c.options,h=i.elements.arrow,f=i.modifiersData.popperOffsets,k=dy(i.placement),et=pD(k),tt=[Nm,Nv].indexOf(k)>=0?"height":"width";if(h&&f){var rt=function(tn,pn){return g3(typeof(tn=typeof tn=="function"?tn(Object.assign({},pn.rects,{placement:pn.placement})):tn)!="number"?tn:v3(tn,iS))}(a.padding,i),lt=lD(h),pt=et==="y"?Lm:Nm,ft=et==="y"?Lv:Nv,vt=i.rects.reference[tt]+i.rects.reference[et]-f[et]-i.rects.popper[tt],yt=f[et]-i.rects.reference[et],Mt=cM(h),xt=Mt?et==="y"?Mt.clientHeight||0:Mt.clientWidth||0:0,Et=vt/2-yt/2,At=rt[pt],Rt=xt-lt[tt]-rt[ft],Bt=xt/2-lt[tt]/2+Et,Qt=uM(At,Bt,Rt),Wt=et;i.modifiersData[s]=((e={})[Wt]=Qt,e.centerOffset=Qt-Bt,e)}},effect:function(c){var e=c.state,i=c.options.element,s=i===void 0?"[data-popper-arrow]":i;s!=null&&(typeof s!="string"||(s=e.elements.popper.querySelector(s)))&&f3(e.elements.popper,s)&&(e.elements.arrow=s)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function w3(c,e,i){return i===void 0&&(i={x:0,y:0}),{top:c.top-e.height-i.y,right:c.right-e.width+i.x,bottom:c.bottom-e.height+i.y,left:c.left-e.width-i.x}}function x3(c){return[Lm,Nv,Lv,Nm].some(function(e){return c[e]>=0})}var b3={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(c){var e=c.state,i=c.name,s=e.rects.reference,a=e.rects.popper,h=e.modifiersData.preventOverflow,f=lS(e,{elementContext:"reference"}),k=lS(e,{altBoundary:!0}),et=w3(f,s),tt=w3(k,a,h),rt=x3(et),lt=x3(tt);e.modifiersData[i]={referenceClippingOffsets:et,popperEscapeOffsets:tt,isReferenceHidden:rt,hasPopperEscaped:lt},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":rt,"data-popper-escaped":lt})}},E3=c2({defaultModifiers:[dD,fD,mD,h2,d3,_3,y3,A3,b3]}),S3="tippy-content",C3="tippy-arrow",M3="tippy-svg-arrow",o1={passive:!0,capture:!0},T3=function(){return document.body};function vD(c,e,i){if(Array.isArray(c)){var s=c[e];return s??(Array.isArray(i)?i[e]:i)}return c}function _D(c,e){var i={}.toString.call(c);return i.indexOf("[object")===0&&i.indexOf(e+"]")>-1}function I3(c,e){return typeof c=="function"?c.apply(void 0,e):c}function P3(c,e){return e===0?c:function(s){clearTimeout(i),i=setTimeout(function(){c(s)},e)};var i}function cS(c){return[].concat(c)}function D3(c,e){c.indexOf(e)===-1&&c.push(e)}function p2(c){return[].slice.call(c)}function R3(c){return Object.keys(c).reduce(function(e,i){return c[i]!==void 0&&(e[i]=c[i]),e},{})}function hM(){return document.createElement("div")}function f2(c){return["Element","Fragment"].some(function(e){return _D(c,e)})}function yD(c,e){c.forEach(function(i){i&&(i.style.transitionDuration=e+"ms")})}function k3(c,e){c.forEach(function(i){i&&i.setAttribute("data-state",e)})}function AD(c,e,i){var s=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(a){c[s](a,i)})}function B3(c,e){for(var i=e;i;){var s;if(c.contains(i))return!0;i=i.getRootNode==null||(s=i.getRootNode())==null?void 0:s.host}return!1}var py={isTouch:!1},O3=0;function mN(){py.isTouch||(py.isTouch=!0,window.performance&&document.addEventListener("mousemove",L3))}function L3(){var c=performance.now();c-O3<20&&(py.isTouch=!1,document.removeEventListener("mousemove",L3)),O3=c}function gN(){var c,e=document.activeElement;if((c=e)&&c._tippy&&c._tippy.reference===c){var i=e._tippy;e.blur&&!i.state.isVisible&&e.blur()}}var vN=!(typeof window>"u"||typeof document>"u"||!window.msCrypto),m0=Object.assign({appendTo:T3,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},{animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),_N=Object.keys(m0);function N3(c){var e=(c.plugins||[]).reduce(function(i,s){var a,h=s.name,f=s.defaultValue;return h&&(i[h]=c[h]!==void 0?c[h]:(a=m0[h])!=null?a:f),i},{});return Object.assign({},c,e)}function F3(c,e){var i=Object.assign({},e,{content:I3(e.content,[c])},e.ignoreAttributes?{}:function(s,a){return(a?Object.keys(N3(Object.assign({},m0,{plugins:a}))):_N).reduce(function(h,f){var k=(s.getAttribute("data-tippy-"+f)||"").trim();if(!k)return h;if(f==="content")h[f]=k;else try{h[f]=JSON.parse(k)}catch{h[f]=k}return h},{})}(c,e.plugins));return i.aria=Object.assign({},m0.aria,i.aria),i.aria={expanded:i.aria.expanded==="auto"?e.interactive:i.aria.expanded,content:i.aria.content==="auto"?e.interactive?null:"describedby":i.aria.content},i}function wD(c,e){c.innerHTML=e}function U3(c){var e=hM();return c===!0?e.className=C3:(e.className=M3,f2(c)?e.appendChild(c):wD(e,c)),e}function j3(c,e){f2(e.content)?(wD(c,""),c.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?wD(c,e.content):c.textContent=e.content)}function xD(c){var e=c.firstElementChild,i=p2(e.children);return{box:e,content:i.find(function(s){return s.classList.contains(S3)}),arrow:i.find(function(s){return s.classList.contains(C3)||s.classList.contains(M3)}),backdrop:i.find(function(s){return s.classList.contains("tippy-backdrop")})}}function z3(c){var e=hM(),i=hM();i.className="tippy-box",i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var s=hM();function a(h,f){var k=xD(e),et=k.box,tt=k.content,rt=k.arrow;f.theme?et.setAttribute("data-theme",f.theme):et.removeAttribute("data-theme"),typeof f.animation=="string"?et.setAttribute("data-animation",f.animation):et.removeAttribute("data-animation"),f.inertia?et.setAttribute("data-inertia",""):et.removeAttribute("data-inertia"),et.style.maxWidth=typeof f.maxWidth=="number"?f.maxWidth+"px":f.maxWidth,f.role?et.setAttribute("role",f.role):et.removeAttribute("role"),h.content===f.content&&h.allowHTML===f.allowHTML||j3(tt,c.props),f.arrow?rt?h.arrow!==f.arrow&&(et.removeChild(rt),et.appendChild(U3(f.arrow))):et.appendChild(U3(f.arrow)):rt&&et.removeChild(rt)}return s.className=S3,s.setAttribute("data-state","hidden"),j3(s,c.props),e.appendChild(i),i.appendChild(s),a(c.props,c.props),{popper:e,onUpdate:a}}z3.$$tippy=!0;var yN=1,m2=[],bD=[];function AN(c,e){var i,s,a,h,f,k,et,tt,rt=F3(c,Object.assign({},m0,N3(R3(e)))),lt=!1,pt=!1,ft=!1,vt=!1,yt=[],Mt=P3(ko,rt.interactiveDebounce),xt=yN++,Et=(tt=rt.plugins).filter(function(vn,Qn){return tt.indexOf(vn)===Qn}),At={id:xt,reference:c,popper:hM(),popperInstance:null,props:rt,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:Et,clearDelayTimeouts:function(){clearTimeout(i),clearTimeout(s),cancelAnimationFrame(a)},setProps:function(vn){if(!At.state.isDestroyed){Tn("onBeforeUpdate",[At,vn]),po();var Qn=At.props,Zn=F3(c,Object.assign({},Qn,R3(vn),{ignoreAttributes:!0}));At.props=Zn,Ys(),Qn.interactiveDebounce!==Zn.interactiveDebounce&&(fr(),Mt=P3(ko,Zn.interactiveDebounce)),Qn.triggerTarget&&!Zn.triggerTarget?cS(Qn.triggerTarget).forEach(function(Vn){Vn.removeAttribute("aria-expanded")}):Zn.triggerTarget&&c.removeAttribute("aria-expanded"),or(),Fn(),Qt&&Qt(Qn,Zn),At.popperInstance&&(Fr(),Xo().forEach(function(Vn){requestAnimationFrame(Vn._tippy.popperInstance.forceUpdate)})),Tn("onAfterUpdate",[At,vn])}},setContent:function(vn){At.setProps({content:vn})},show:function(){var vn=At.state.isVisible,Qn=At.state.isDestroyed,Zn=!At.state.isEnabled,Vn=py.isTouch&&!At.props.touch,lr=vD(At.props.duration,0,m0.duration);if(!(vn||Qn||Zn||Vn||wn().hasAttribute("disabled")||(Tn("onShow",[At],!1),At.props.onShow(At)===!1))){if(At.state.isVisible=!0,En()&&(Bt.style.visibility="visible"),Fn(),Br(),At.state.isMounted||(Bt.style.transition="none"),En()){var Vr=xn();yD([Vr.box,Vr.content],0)}var es,cs,as;k=function(){var ds;if(At.state.isVisible&&!vt){if(vt=!0,Bt.offsetHeight,Bt.style.transition=At.props.moveTransition,En()&&At.props.animation){var rs=xn(),ts=rs.box,xs=rs.content;yD([ts,xs],lr),k3([ts,xs],"visible")}Wn(),or(),D3(bD,At),(ds=At.popperInstance)==null||ds.forceUpdate(),Tn("onMount",[At]),At.props.animation&&En()&&function(qr,Ss){hs(qr,function(){At.state.isShown=!0,Tn("onShown",[At])})}(lr)}},cs=At.props.appendTo,as=wn(),(es=At.props.interactive&&cs===T3||cs==="parent"?as.parentNode:I3(cs,[as])).contains(Bt)||es.appendChild(Bt),At.state.isMounted=!0,Fr()}},hide:function(){var vn=!At.state.isVisible,Qn=At.state.isDestroyed,Zn=!At.state.isEnabled,Vn=vD(At.props.duration,1,m0.duration);if(!(vn||Qn||Zn)&&(Tn("onHide",[At],!1),At.props.onHide(At)!==!1)){if(At.state.isVisible=!1,At.state.isShown=!1,vt=!1,lt=!1,En()&&(Bt.style.visibility="hidden"),fr(),Ur(),Fn(!0),En()){var lr=xn(),Vr=lr.box,es=lr.content;At.props.animation&&(yD([Vr,es],Vn),k3([Vr,es],"hidden"))}Wn(),or(),At.props.animation?En()&&function(cs,as){hs(cs,function(){!At.state.isVisible&&Bt.parentNode&&Bt.parentNode.contains(Bt)&&as()})}(Vn,At.unmount):At.unmount()}},hideWithInteractivity:function(vn){In().addEventListener("mousemove",Mt),D3(m2,Mt),Mt(vn)},enable:function(){At.state.isEnabled=!0},disable:function(){At.hide(),At.state.isEnabled=!1},unmount:function(){At.state.isVisible&&At.hide(),At.state.isMounted&&(Ks(),Xo().forEach(function(vn){vn._tippy.unmount()}),Bt.parentNode&&Bt.parentNode.removeChild(Bt),bD=bD.filter(function(vn){return vn!==At}),At.state.isMounted=!1,Tn("onHidden",[At]))},destroy:function(){At.state.isDestroyed||(At.clearDelayTimeouts(),At.unmount(),po(),delete c._tippy,At.state.isDestroyed=!0,Tn("onDestroy",[At]))}};if(!rt.render)return At;var Rt=rt.render(At),Bt=Rt.popper,Qt=Rt.onUpdate;Bt.setAttribute("data-tippy-root",""),Bt.id="tippy-"+At.id,At.popper=Bt,c._tippy=At,Bt._tippy=At;var Wt=Et.map(function(vn){return vn.fn(At)}),tn=c.hasAttribute("aria-expanded");return Ys(),or(),Fn(),Tn("onCreate",[At]),rt.showOnCreate&&mn(),Bt.addEventListener("mouseenter",function(){At.props.interactive&&At.state.isVisible&&At.clearDelayTimeouts()}),Bt.addEventListener("mouseleave",function(){At.props.interactive&&At.props.trigger.indexOf("mouseenter")>=0&&In().addEventListener("mousemove",Mt)}),At;function pn(){var vn=At.props.touch;return Array.isArray(vn)?vn:[vn,0]}function yn(){return pn()[0]==="hold"}function En(){var vn;return!((vn=At.props.render)==null||!vn.$$tippy)}function wn(){return et||c}function In(){var vn,Qn,Zn=wn().parentNode;return Zn&&(Qn=cS(Zn)[0])!=null&&(vn=Qn.ownerDocument)!=null&&vn.body?Qn.ownerDocument:document}function xn(){return xD(Bt)}function Cn(vn){return At.state.isMounted&&!At.state.isVisible||py.isTouch||h&&h.type==="focus"?0:vD(At.props.delay,vn?0:1,m0.delay)}function Fn(vn){vn===void 0&&(vn=!1),Bt.style.pointerEvents=At.props.interactive&&!vn?"":"none",Bt.style.zIndex=""+At.props.zIndex}function Tn(vn,Qn,Zn){var Vn;Zn===void 0&&(Zn=!0),Wt.forEach(function(lr){lr[vn]&&lr[vn].apply(lr,Qn)}),Zn&&(Vn=At.props)[vn].apply(Vn,Qn)}function Wn(){var vn=At.props.aria;if(vn.content){var Qn="aria-"+vn.content,Zn=Bt.id;cS(At.props.triggerTarget||c).forEach(function(Vn){var lr=Vn.getAttribute(Qn);if(At.state.isVisible)Vn.setAttribute(Qn,lr?lr+" "+Zn:Zn);else{var Vr=lr&&lr.replace(Zn,"").trim();Vr?Vn.setAttribute(Qn,Vr):Vn.removeAttribute(Qn)}})}}function or(){!tn&&At.props.aria.expanded&&cS(At.props.triggerTarget||c).forEach(function(vn){At.props.interactive?vn.setAttribute("aria-expanded",At.state.isVisible&&vn===wn()?"true":"false"):vn.removeAttribute("aria-expanded")})}function fr(){In().removeEventListener("mousemove",Mt),m2=m2.filter(function(vn){return vn!==Mt})}function rr(vn){if(!py.isTouch||!ft&&vn.type!=="mousedown"){var Qn=vn.composedPath&&vn.composedPath()[0]||vn.target;if(!At.props.interactive||!B3(Bt,Qn)){if(cS(At.props.triggerTarget||c).some(function(Zn){return B3(Zn,Qn)})){if(py.isTouch||At.state.isVisible&&At.props.trigger.indexOf("click")>=0)return}else Tn("onClickOutside",[At,vn]);At.props.hideOnClick===!0&&(At.clearDelayTimeouts(),At.hide(),pt=!0,setTimeout(function(){pt=!1}),At.state.isMounted||Ur())}}}function Ir(){ft=!0}function kr(){ft=!1}function Br(){var vn=In();vn.addEventListener("mousedown",rr,!0),vn.addEventListener("touchend",rr,o1),vn.addEventListener("touchstart",kr,o1),vn.addEventListener("touchmove",Ir,o1)}function Ur(){var vn=In();vn.removeEventListener("mousedown",rr,!0),vn.removeEventListener("touchend",rr,o1),vn.removeEventListener("touchstart",kr,o1),vn.removeEventListener("touchmove",Ir,o1)}function hs(vn,Qn){var Zn=xn().box;function Vn(lr){lr.target===Zn&&(AD(Zn,"remove",Vn),Qn())}if(vn===0)return Qn();AD(Zn,"remove",f),AD(Zn,"add",Vn),f=Vn}function _r(vn,Qn,Zn){Zn===void 0&&(Zn=!1),cS(At.props.triggerTarget||c).forEach(function(Vn){Vn.addEventListener(vn,Qn,Zn),yt.push({node:Vn,eventType:vn,handler:Qn,options:Zn})})}function Ys(){var vn;yn()&&(_r("touchstart",Xs,{passive:!0}),_r("touchend",Jo,{passive:!0})),(vn=At.props.trigger,vn.split(/\s+/).filter(Boolean)).forEach(function(Qn){if(Qn!=="manual")switch(_r(Qn,Xs),Qn){case"mouseenter":_r("mouseleave",Jo);break;case"focus":_r(vN?"focusout":"blur",cr);break;case"focusin":_r("focusout",cr)}})}function po(){yt.forEach(function(vn){var Qn=vn.node,Zn=vn.eventType,Vn=vn.handler,lr=vn.options;Qn.removeEventListener(Zn,Vn,lr)}),yt=[]}function Xs(vn){var Qn,Zn=!1;if(At.state.isEnabled&&!Nr(vn)&&!pt){var Vn=((Qn=h)==null?void 0:Qn.type)==="focus";h=vn,et=vn.currentTarget,or(),!At.state.isVisible&&_D(vn,"MouseEvent")&&m2.forEach(function(lr){return lr(vn)}),vn.type==="click"&&(At.props.trigger.indexOf("mouseenter")<0||lt)&&At.props.hideOnClick!==!1&&At.state.isVisible?Zn=!0:mn(vn),vn.type==="click"&&(lt=!Zn),Zn&&!Vn&&Nn(vn)}}function ko(vn){var Qn=vn.target,Zn=wn().contains(Qn)||Bt.contains(Qn);if(vn.type!=="mousemove"||!Zn){var Vn=Xo().concat(Bt).map(function(lr){var Vr,es=(Vr=lr._tippy.popperInstance)==null?void 0:Vr.state;return es?{popperRect:lr.getBoundingClientRect(),popperState:es,props:rt}:null}).filter(Boolean);(function(lr,Vr){var es=Vr.clientX,cs=Vr.clientY;return lr.every(function(as){var ds=as.popperRect,rs=as.popperState,ts=as.props.interactiveBorder,xs=rs.placement.split("-")[0],qr=rs.modifiersData.offset;if(!qr)return!0;var Ss=xs==="bottom"?qr.top.y:0,Is=xs==="top"?qr.bottom.y:0,zs=xs==="right"?qr.left.x:0,$l=xs==="left"?qr.right.x:0,Il=ds.top-cs+Ss>ts,Cs=cs-ds.bottom-Is>ts,$s=ds.left-es+zs>ts,Eo=es-ds.right-$l>ts;return Il||Cs||$s||Eo})})(Vn,vn)&&(fr(),Nn(vn))}}function Jo(vn){Nr(vn)||At.props.trigger.indexOf("click")>=0&&lt||(At.props.interactive?At.hideWithInteractivity(vn):Nn(vn))}function cr(vn){At.props.trigger.indexOf("focusin")<0&&vn.target!==wn()||At.props.interactive&&vn.relatedTarget&&Bt.contains(vn.relatedTarget)||Nn(vn)}function Nr(vn){return!!py.isTouch&&yn()!==vn.type.indexOf("touch")>=0}function Fr(){Ks();var vn=At.props,Qn=vn.popperOptions,Zn=vn.placement,Vn=vn.offset,lr=vn.getReferenceClientRect,Vr=vn.moveTransition,es=En()?xD(Bt).arrow:null,cs=lr?{getBoundingClientRect:lr,contextElement:lr.contextElement||wn()}:c,as=[{name:"offset",options:{offset:Vn}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Vr}},{name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(ds){var rs=ds.state;if(En()){var ts=xn().box;["placement","reference-hidden","escaped"].forEach(function(xs){xs==="placement"?ts.setAttribute("data-placement",rs.placement):rs.attributes.popper["data-popper-"+xs]?ts.setAttribute("data-"+xs,""):ts.removeAttribute("data-"+xs)}),rs.attributes.popper={}}}}];En()&&es&&as.push({name:"arrow",options:{element:es,padding:3}}),as.push.apply(as,(Qn==null?void 0:Qn.modifiers)||[]),At.popperInstance=E3(cs,Bt,Object.assign({},Qn,{placement:Zn,onFirstUpdate:k,modifiers:as}))}function Ks(){At.popperInstance&&(At.popperInstance.destroy(),At.popperInstance=null)}function Xo(){return p2(Bt.querySelectorAll("[data-tippy-root]"))}function mn(vn){At.clearDelayTimeouts(),vn&&Tn("onTrigger",[At,vn]),Br();var Qn=Cn(!0),Zn=pn(),Vn=Zn[0],lr=Zn[1];py.isTouch&&Vn==="hold"&&lr&&(Qn=lr),Qn?i=setTimeout(function(){At.show()},Qn):At.show()}function Nn(vn){if(At.clearDelayTimeouts(),Tn("onUntrigger",[At,vn]),At.state.isVisible){if(!(At.props.trigger.indexOf("mouseenter")>=0&&At.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(vn.type)>=0&&lt)){var Qn=Cn(!1);Qn?s=setTimeout(function(){At.state.isVisible&&At.hide()},Qn):a=requestAnimationFrame(function(){At.hide()})}}else Ur()}}function dM(c,e){e===void 0&&(e={});var i=m0.plugins.concat(e.plugins||[]);document.addEventListener("touchstart",mN,o1),window.addEventListener("blur",gN);var s,a=Object.assign({},e,{plugins:i}),h=(s=c,f2(s)?[s]:function(f){return _D(f,"NodeList")}(s)?p2(s):Array.isArray(s)?s:p2(document.querySelectorAll(s))).reduce(function(f,k){var et=k&&AN(k,a);return et&&f.push(et),f},[]);return f2(c)?h[0]:h}dM.defaultProps=m0,dM.setDefaultProps=function(c){Object.keys(c).forEach(function(e){m0[e]=c[e]})},dM.currentInput=py,Object.assign({},h2,{effect:function(c){var e=c.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow)}}),dM.setDefaultProps({render:z3});var ED=dM;class a1 extends s2{async _refreshUi(){var e;if(!await super._refreshUi())return!1;p0.RemoveAll(a1.PluginType);for(const i of this.variations)p0.Create(a1.PluginType,i.title,5,20,0,i.materials.map(s=>{let a;if(i.preview.startsWith("generate:"))a=this._previewGenerator.generate(s,i.preview.split(":")[1]);else{const h=s[i.preview]||"#ff00ff";a=h.image?S_(h.image,100):void 0,a||(a=WB(h,!0))}return{id:s.uuid,image:a,onClick:h=>this.applyVariation(i,h),tooltip:s.name||s.uuid}}),(s,a)=>ED(s,{placement:"bottom",content:a.tooltip}));return p0.RebuildUi((e=this._viewer)===null||e===void 0?void 0:e.container),!0}}a1.PluginType="MaterialConfiguratorPlugin";class g2 extends Js{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{var e,i;this.enabled&&((i=(e=this.uiConfig)===null||e===void 0?void 0:e.uiRefresh)===null||i===void 0||i.call(e,"postFrame",!0))},this.dependencies=[Kr],this._selectedObject=()=>{var e;return((e=this._picking)===null||e===void 0?void 0:e.getSelectedObject())||void 0},this._selectedMaterial=()=>{var e;return((e=this._selectedObject())===null||e===void 0?void 0:e.material)||void 0}}async onAdded(e){var i,s;await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("Picking"),this._previewGenerator=new nD(this._viewer),(s=this._picking)===null||s===void 0||s.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}async onRemove(e){var i,s;return(i=this._previewGenerator)===null||i===void 0||i.dispose(),this._previewGenerator=void 0,(s=this._picking)===null||s===void 0||s.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return this._uiNeedRefresh&&this.enabled&&this._refreshUiConfig(),this._uiNeedRefresh=!1,!1}}g2.PluginType="MaterialLibraryBasePlugin",function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);h>3&&f&&Object.defineProperty(e,i,f)}([Jr("Enabled")],g2.prototype,"enabled",void 0);class yw extends g2{constructor(){super(...arguments),this.replaceMaterial=!1,this.uiConfig={type:"folder",label:"Material Library",uuid:Ho(),children:[...Ap(this),()=>{var e;return{type:"dropdown",label:"Apply Material",limitedUi:!0,hidden:()=>!this._selectedObject(),children:[{label:"select one",value:""},[...this._viewer.getPlugin(Kr).materials.getMaterialsOfType((e=this._selectedMaterial())===null||e===void 0?void 0:e.typeSlug).map(i=>({label:i.name||i.uuid,value:i.uuid}))||[]]],getValue:()=>{var i;return(i=this._selectedMaterial())===null||i===void 0?void 0:i.uuid},setValue:i=>{var s,a,h,f,k;const et=(h=(a=(s=this._viewer)===null||s===void 0?void 0:s.getPlugin(Kr))===null||a===void 0?void 0:a.materials)===null||h===void 0?void 0:h.findMaterial(i);if(et)if(this.replaceMaterial)(k=(f=this._selectedObject())===null||f===void 0?void 0:f.setMaterial)===null||k===void 0||k.call(f,et);else{const tt=this._selectedMaterial();if(tt){const rt=tt.name,lt=tt.uuid;tt.copyProps(et),tt.name=rt,tt.uuid=lt,tt.userData.uuid&&(tt.userData.uuid=lt)}}this._refreshUi()}}}]}}async _refreshUi(){var e,i,s,a;if(!await super._refreshUi())return!1;const h=[$u.TypeSlug,Ml.TypeSlug],f=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(Kr))===null||i===void 0?void 0:i.materials,k=h.map(et=>[et,f==null?void 0:f.getMaterialsOfType(et)]);p0.RemoveAll(yw.PluginType);for(const[et,tt]of k)p0.Create(yw.PluginType,et,5,20,0,(s=tt)===null||s===void 0?void 0:s.filter(rt=>!rt.userData.__runtimeMaterial).map(rt=>{let lt;const pt="generate:sphere";if(pt.startsWith("generate:"))lt=this._previewGenerator.generate(rt,pt.split(":")[1]);else{const ft=rt[pt]||"#ff00ff";lt=ft.image?S_(ft.image,100):void 0,lt||(lt=HB(ft,!0))}return{id:rt.uuid,image:lt,onClick:ft=>{const vt=f==null?void 0:f.findMaterial(ft);if(console.log(vt==null?void 0:vt.name),vt){const yt=vt.userData.__appliedMeshes;if(yt!=null&&yt.size){const Mt=yt.keys().next().value;Mt.dispatchEvent({type:"select",value:Mt})}}},tooltip:rt.name||rt.uuid}}),(rt,lt)=>ED(rt,{placement:"bottom",content:lt.tooltip}));return p0.RebuildUi((a=this._viewer)===null||a===void 0?void 0:a.container),!0}}function V3(c,e,i,s){c.traverse(a=>{a&&(a.userData.cloneRotI=e,a.userData.rotationCount=i,a.userData.rotationAxis=s,a.addEventListener("beforeRender",h=>function(f,k){var et;k&&(!((et=k.map)===null||et===void 0)&&et.isTexture)&&(k.extraUniformsToUpload||(k.extraUniformsToUpload={}),k.extraUniformsToUpload.uvTransform||(k.extraUniformsToUpload.uvTransform={value:new d.Vkp}),k.extraUniformsToUpload.uvTransform.value.setUvTransform(k.map.offset.x*k.map.repeat.x*f.userData.cloneRotI/(f.userData.rotationCount||1),k.map.offset.y*k.map.repeat.y*f.userData.cloneRotI/(f.userData.rotationCount||1),k.map.repeat.x,k.map.repeat.y,k.map.rotation,k.map.center.x,k.map.center.y))}(a,h.material)))})}function Q3(c,e,i,s="x"){var a;if(c.userData.rotationCount>1&&!c.userData.rotationRoot)return c;const h=c.parent;if(!h)throw new Error("No parent");if(c.userData.cloneParent){const k=c.userData.cloneParent;if(!(c=h.children.find(et=>k===et.uuid)))return console.error("Couldn't find clone root, cannot rotate. maybe a serialization issue?",k,h),c}let f=h.children.filter(k=>{var et;return((et=k.userData)===null||et===void 0?void 0:et.cloneParent)===c.uuid}).sort((k,et)=>k.userData.cloneRotI-et.userData.cloneRotI);if(c.userData.rotationCount===e&&e===f.length&&i===void 0&&c.userData.rotationAxis===s)return c;if(i==null&&(i=(a=c.userData.rotationSkips)!==null&&a!==void 0?a:[]),i!==c.userData.rotationSkips&&(c.userData.rotationSkips=[...i]),V3(c,0,e,s),c.userData.rotationRoot=!0,c.visible=!0,e<=f.length){for(let k=e-1;k<f.length;k++)h.remove(f[k]),f[k].traverse(et=>et.userData={__disposed:!0});f=f.slice(0,e)}for(let k=1;k<e;k++){const et=k<=f.length?f[k-1]:c.clone();et.rotation.copy(c.rotation),et.rotation[s]+=k/e*Math.PI*2,V3(et,k,e,s),k>f.length&&h.add(et),et.visible=!i.includes(k)}return c.visible=!i.includes(0),c}yw.PluginType="MaterialLibraryPlugin",function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);h>3&&f&&Object.defineProperty(e,i,f)}([Jr("Replace Material")],yw.prototype,"replaceMaterial",void 0);var uS,pM=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};let fy=uS=class extends Js{constructor(){super(),this.enabled=!0,this.rotations=1,this.axis="x",this.skips="",this._selectedObjectChanged=this._selectedObjectChanged.bind(this)}async onAdded(c){var e;await super.onAdded(c),(e=c.getPluginByType("Picking"))===null||e===void 0||e.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}_selectedObjectChanged(){var c,e,i,s,a,h,f,k,et;if(!this.enabled)return;const tt=(e=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Picking"))===null||e===void 0?void 0:e.getSelectedObject();if(!tt)return void((s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0));const rt=tt.userData.rotationRoot&&(a=tt.userData.rotationCount)!==null&&a!==void 0?a:1;this.rotations=rt,this.skips=(f=(h=tt.userData.rotationSkips)===null||h===void 0?void 0:h.join(","))!==null&&f!==void 0?f:"",this.axis=tt.userData.rotationAxis||"x",(et=(k=this.uiConfig).uiRefresh)===null||et===void 0||et.call(k,"postFrame",!0)}_paramsChanged(){var c,e,i,s,a,h;if(!this.enabled)return;const f=(e=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Picking"))===null||e===void 0?void 0:e.getSelectedObject();if(f){if(this.rotations>1||f.userData.rotationCount){const k=f.userData.rotationCount,et=Q3(f,this.rotations,this.skips.split(",").map(rt=>parseInt(rt)).filter(rt=>isFinite(rt)),this.axis),tt=et==null?void 0:et.userData.rotationCount;if(tt&&tt!==k){const rt=[];et==null||et.traverseAncestors(lt=>{rt.push(lt)});for(const lt of rt)if(lt.userData.autoScaled){Rs(lt),(i=this._viewer)===null||i===void 0||i.resetCamera({rootObject:lt,centerOffset:new d.Pa4(4,4,4)});break}}f.parent&&!f.userData.__disposed||(a=(s=this._viewer)===null||s===void 0?void 0:s.getPluginByType("Picking"))===null||a===void 0||a.setSelectedObject(et,!0)}(h=this._viewer)===null||h===void 0||h.scene.setDirty({frameFade:!1,sceneUpdate:!0})}}};fy.PluginType="ObjectRotationPlugin",pM([jn(),Jr("Enabled"),hn(uS.prototype._paramsChanged)],fy.prototype,"enabled",void 0),pM([Xr("Rotation Count",[1,100],1,c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPluginByType("Picking"))===null||i===void 0)&&i.getSelectedObject())||!c.rotations}})),hn(uS.prototype._paramsChanged)],fy.prototype,"rotations",void 0),pM([vu("Axis",["x","y","z"].map(c=>({label:c})),c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPluginByType("Picking"))===null||i===void 0)&&i.getSelectedObject())||!c.rotations}})),hn(uS.prototype._paramsChanged)],fy.prototype,"axis",void 0),pM([so("Rotation Skips",c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPluginByType("Picking"))===null||i===void 0)&&i.getSelectedObject())||!c.rotations}})),hn(uS.prototype._paramsChanged)],fy.prototype,"skips",void 0),fy=uS=pM([Ws("Object Rotations")],fy);var l1,hS=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};let g0=l1=class extends Js{constructor(c=!0){super(),this.enabled=!0,this.debugNormals=!1,this.debugHitHeight=!1,this._defines={PARALLAX_NORMAL_MAP_QUALITY:0},this.stepCount=12,this.binaryStepCount=3,this._bumpMapExtension={shaderExtender:(e,i,s)=>{if(i.materialObject.bumpMap&&this.enabled){e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_begin>",""),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>",""),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",`#include <normal_fragment_begin>
#include <normal_fragment_maps>
#include <map_fragment>`);for(const a of["map_fragment","alphamap_fragment","roughnessmap_fragment","metalnessmap_fragment","emissivemap_fragment","transmission_fragment"])e.fragmentShader=e.fragmentShader.replace(`#include <${a}>`,d.WdD[a].replace("vUv","parallaxUv.xy"));(this.debugNormals||this.debugHitHeight)&&(e.fragmentShader=e.fragmentShader.replace("texture2D( map, parallaxUv.xy )",this.debugNormals?"vec4(normal, 1.); normal = geometryNormal":"vec4(parallaxUv.z,0., 0., 1.)")),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>",d.WdD.normal_fragment_maps.replace("#elif defined( TANGENTSPACE_NORMALMAP )","#elif defined( TANGENTSPACE_NORMALMAP ) && !defined( USE_BUMPMAP )").replace("normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );","vec3 parallaxUv = reliefParallaxPerturbNormal(faceDirection, normal);"))}},parsFragmentSnippet:()=>this.enabled?`#ifdef USE_BUMPMAP
mat3 mat3_inverse(mat3 A){mat3 M_t=mat3(vec3(A[0][0],A[1][0],A[2][0]),vec3(A[0][1],A[1][1],A[2][1]),vec3(A[0][2],A[1][2],A[2][2]));float det=dot(cross(M_t[0],M_t[1]),M_t[2]);mat3 adjugate=mat3(cross(M_t[1],M_t[2]),cross(M_t[2],M_t[0]),cross(M_t[0],M_t[1]));return adjugate/det;}float CalculateHeight(in vec2 texCoords){float height=texture2D(bumpMap,texCoords).x;return clamp(height,0.,1.);}const vec2 bumpMapSize=vec2(512,512);vec3 CalculateNormal(in vec2 texCoords){
#if defined( TANGENTSPACE_NORMALMAP ) && 0 
vec3 mapN=texture2D(normalMap,texCoords).xyz;mapN.xy*=normalScale;return normalize(mapN);
#else
vec2 texOffs=1./bumpMapSize;
#if PARALLAX_NORMAL_MAP_QUALITY > 0
float hx[9];hx[0]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,-1.)).r;hx[1]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;hx[2]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,-1.)).r;hx[3]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;hx[4]=texture2D(bumpMap,texCoords.st).r;hx[5]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;hx[6]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,1.)).r;hx[7]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;hx[8]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,1.)).r;vec2 deltaH=vec2(hx[0]-hx[2]+2.*(hx[3]-hx[5])+hx[6]-hx[8],hx[0]-hx[6]+2.*(hx[1]-hx[7])+hx[2]-hx[8]);
#else
float h_xa=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;float h_xb=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;float h_ya=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;float h_yb=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;vec2 deltaH=vec2(h_xa-h_xb,h_ya-h_yb);
#endif
return normalize(vec3(deltaH/texOffs,1.));
#endif
}vec3 ReliefParallax(in float frontFace,in vec3 texDir3D,in vec2 texCoord){float surf_sign=frontFace;float back_face=step(0.,-surf_sign);vec2 texStep=surf_sign*texDir3D.xy/abs(texDir3D.z);vec2 texC=texCoord.st+surf_sign*texStep+back_face*texStep.xy;float mapHeight=1.;float bumpHeightStep=1./float(PARALLAX_MAP_STEPS);float bestBumpHeight=mapHeight+bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_STEPS;i++){if(mapHeight<bestBumpHeight){bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);}}
#pragma unroll_loop_end
bestBumpHeight+=bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_B_STEPS;i++){bumpHeightStep*=0.5;bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);bestBumpHeight+=(bestBumpHeight<mapHeight)?bumpHeightStep:0.;}
#pragma unroll_loop_end
bestBumpHeight-=bumpHeightStep*clamp((bestBumpHeight-mapHeight)/bumpHeightStep,0.,1.);mapHeight=bestBumpHeight;texC-=mapHeight*texStep;return vec3(texC.xy,mapHeight);}vec3 reliefParallaxPerturbNormal(in float faceDirection,inout vec3 normal){if(abs(bumpScale)<0.001)return vec3(vUv,0.);float parallaxHeight;vec2 texCoords=vUv;float face_sign=sign(dot(normal,vViewPosition));vec3 N=normalize(normal);vec3 dp1=dFdx(-vViewPosition);vec3 dp2=dFdy(-vViewPosition);vec2 duv1=dFdx(vUv);vec2 duv2=dFdy(vUv);vec3 dp2perp=cross(dp2,N);vec3 dp1perp=cross(N,dp1);vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(T,T),dot(B,B)));mat3 tbnMat=mat3(T*invmax,B*invmax,N*bumpScale);vec3 tangentPos=normalize(mat3_inverse(tbnMat)*-vViewPosition);vec3 parallaxUv=ReliefParallax(face_sign,tangentPos,vUv);tbnMat[2]=face_sign*N/bumpScale;normal=normalize(tbnMat*CalculateNormal(parallaxUv.xy).xyz);
#ifdef FLIP_SIDED
normal=-normal;
#endif
return parallaxUv;}
#endif 

`.replaceAll("PARALLAX_MAP_STEPS",this._defines.PARALLAX_MAP_STEPS).replaceAll("PARALLAX_MAP_B_STEPS",this._defines.PARALLAX_MAP_B_STEPS):"",isCompatible:e=>e.isMeshStandardMaterial2,computeCacheKey:e=>{var i;return this.enabled+" "+((i=e.materialObject.bumpMap)===null||i===void 0?void 0:i.uuid)+" "+this.debugNormals+" "+this.debugHitHeight+"  "},onObjectRender:(e,{materialObject:i},s)=>{for(const[a,h]of Object.entries(this._defines)){const f=typeof h=="number"?h:h?1:0;i.defines[a]!==f&&(i.defines[a]=f,i.needsUpdate=!0)}}},this.dependencies=[Kr],this.enabled=c,this._updateExtension=this._updateExtension.bind(this)}_updateExtension(){var c,e,i;(e=(c=this._bumpMapExtension)===null||c===void 0?void 0:c.setDirty)===null||e===void 0||e.call(c),(i=this._viewer)===null||i===void 0||i.setDirty()}async onAdded(c){var e,i;return(i=(e=c.getPlugin(Kr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.registerMaterialExtension(this._bumpMapExtension),super.onAdded(c)}async onRemove(c){var e,i;return(i=(e=c.getPlugin(Kr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this._bumpMapExtension),super.onRemove(c)}};g0.PluginType="ReliefParallaxMapping",hS([hn(l1.prototype._updateExtension),Jr("Enabled")],g0.prototype,"enabled",void 0),hS([hn(l1.prototype._updateExtension),Jr("Debug Normals")],g0.prototype,"debugNormals",void 0),hS([hn(l1.prototype._updateExtension),Jr("Debug Hit Height")],g0.prototype,"debugHitHeight",void 0),hS([kn("PARALLAX_MAP_STEPS",void 0,!0,l1.prototype._updateExtension),Xr("Step count",[1,32],1),jn()],g0.prototype,"stepCount",void 0),hS([kn("PARALLAX_MAP_B_STEPS",void 0,!0,l1.prototype._updateExtension),Xr("Binary search steps",[1,8],1),jn()],g0.prototype,"binaryStepCount",void 0),g0=l1=hS([Ws("Parallax Mapping")],g0);var y_=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};class Fv extends bu{constructor(e,i,s,a=!1){super({vertexShader:bv,fragmentShader:`

${R1}
${Hw}
${Ev}
${QS}
${s}

${k1}

varying vec2 vUv;uniform float intensity;uniform float objectRadius;uniform float rayCount;uniform float power;uniform float bias;uniform float falloff;uniform float tolerance;uniform bool autoRadius;uniform vec2 screenSize;vec3 ComputeUniformL(vec3 N,vec2 E){vec3 L;L.xy=E;L.z=interleavedGradientNoise(gl_FragCoord.xy,frameCount*5.);L=L*2.-1.;return L;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=random3(vec3(gl_FragCoord.xy,frameCount+seed));rand_e.y=random3(vec3(gl_FragCoord.yx,rand_e.x+(frameCount)*7.));return rand_e;}vec4 calculateGI(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeUniformL(normal,E);L=normalize(L);L*=sign(dot(L,normal));float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?length(viewPos-screenToView(screenPos.xy+objectRadius/10.,screenPos.z)):mix((cameraNearFar.y)+viewPos.z,-viewPos.z-cameraNearFar.x,L.z*0.5+0.5)*objectRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount*14.+seed)+0.05;rayLen=max(rayLen,0.001);vec3 state=vec3(1.,(r+0.5)/float(RTAO_STEP_COUNT),2.);viewPos+=normal*max(-0.01*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,RTAO_STEP_COUNT);vec3 viewHitP=screenToView(screenHitP.xy,screenHitP.z);vec3 LRes=viewHitP-viewPos;if(state.z>1.)LRes=vec3(9999999.);float dist=length(LRes)*falloff;float EPS=0.01;float zBias=(viewPos.z)*bias;float ao=(max(dot(normal,L)+zBias,0.))/(dist*dist+EPS);
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 hitColor=tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy)).rgb;vec3 hitNormal=getViewNormal(screenHitP.xy);float giWeight=1.;giWeight=saturate2(giWeight/(dist+EPS),1.);giWeight*=saturate2((dot(normal,L)),1.);giWeight*=saturate2((dot(hitNormal,-L)),1.);return vec4(hitColor*giWeight,ao);
#endif
return vec4(0,0,0,ao);}float normpdf(in float x,in float sigma){return exp(-0.5*x*x/(sigma*sigma));}vec4 getLastThis(sampler2D tex,float depth,vec3 normal){vec2 direction=vec2(1,1);vec4 color=clamp(tLastThisTexelToLinear(texture2D(tex,vUv.xy)),0.,5.);return color;}void main(){float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>0.99){discard;gl_FragColor=getLastThis(tLastThis,depth,normal);return;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec4 gi=vec4(0.);gi+=calculateGI(8.,screenPos,normal,1.);if(rayCount>1.5)gi=max(gi,calculateGI(2.,screenPos,normal,0.4));if(rayCount>2.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.5));if(rayCount>3.5)gi=max(gi,calculateGI(1.,screenPos,normal,0.6));if(rayCount>4.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.));gi.a=min(1.,gi.a);gi.a=max(0.,gi.a);gi.rgb=min(vec3(3.),gi.rgb);gi.rgb=max(vec3(0.),gi.rgb);if(frameCount<3.){gl_FragColor=gi;return;}gl_FragColor=(texture2D(tLastThis,vUv));gl_FragColor=((gi+(gl_FragColor)*frameCount)/(frameCount+1.));}

            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:2.14},rayCount:{value:.1},objectRadius:{value:1},autoRadius:{value:!a},power:{value:1.1},bias:{value:.015},falloff:{value:.7},tolerance:{value:1.5},frameCount:{value:0},projection:{value:new d.yGw},screenSize:{value:new d.FM8},cameraPositionWorld:{value:new d.Pa4},cameraNearFar:{value:new d.FM8(.1,1e3)}},defines:{PERSPECTIVE_CAMERA:1,SSGI_ENABLED:a?1:0}},"tDiffuse","tLastFrame","tLastThis"),this.materialExtension={shaderExtender:(h,f,k)=>{if(!h.defines.SSRTAO_ENABLED)return;const et="vec3 totalDiffuse =";h.fragmentShader=h.fragmentShader.replace(et,`

            
            #if defined(SSRTAO_ENABLED) && SSRTAO_ENABLED > 0
vec4 ssgi=tSSGIMapTexelToLinear(texture2D(tSSGIMap,viewToScreen(vViewPosition.xyz).xy));float ambientOcclusion=1.-ssgi.a;ambientOcclusion=max(0.,ambientOcclusion);ambientOcclusion=pow(ambientOcclusion,ssaoPower);ambientOcclusion=min(1.,ambientOcclusion);reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 ssgiColor=ssgi.rgb*ssgiIntensity;reflectedLight.indirectDiffuse+=ssgiColor*(material.diffuseColor.rgb);
#endif
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));float specularOcclusion=saturate(pow(dotNV+ambientOcclusion,exp2(-16.*material.roughness-1.))-1.+ambientOcclusion);reflectedLight.indirectSpecular*=specularOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
#if !defined(SSR_ENABLED) || SSR_ENABLED < 1
reflectedLight.indirectSpecular+=ssgiColor*material.specularColor;
#endif
#endif
#endif
#endif

            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            
${et}`),h.fragmentShader=h.fragmentShader.replace("#include <aomap_fragment>",""),h.vertexUvs=!0},onObjectRender:(h,f,k)=>{var et,tt,rt;this.materialExtension.extraUniforms.tSSGIMap.value=(et=this._target)===null||et===void 0?void 0:et.texture;const lt=f.materialObject,pt=!lt.transparent&&lt.transmission<.001;let ft=this.enabled&&pt&&(this.renderWithCamera||this._renderer.frameCount>1)&&k.userData.screenSpaceRendering!==!1&&!(!((tt=lt.userData)===null||tt===void 0)&&tt.ssrtaoDisabled)&&!(!((rt=lt.userData)===null||rt===void 0)&&rt.ssaoDisabled)?1:0;lt.defines.SSRTAO_ENABLED!==ft&&(lt.defines.SSRTAO_ENABLED=ft,lt.needsUpdate=!0),ft=this.material.defines.SSGI_ENABLED,lt.defines.SSGI_ENABLED!==ft&&(lt.defines.SSGI_ENABLED=ft,lt.needsUpdate=!0),ft=this._target.texture,this.materialExtension.extraUniforms.tSSGIMap.value!==ft&&(this.materialExtension.extraUniforms.tSSGIMap.value=ft,lt.needsUpdate=!0)},parsFragmentSnippet:h=>{var f;return Ut`
            uniform float ssaoPower;
            uniform float ssgiIntensity;
            uniform sampler2D tSSGIMap;
            ${Kn("tSSGIMap",(f=this._target)===null||f===void 0?void 0:f.texture,h.capabilities.isWebGL2)}

            ${B1}

        `},extraUniforms:{tSSGIMap:{value:null},ssaoPower:this.material.uniforms.power,ssgiIntensity:this.material.uniforms.intensity},computeCacheKey:h=>{var f,k;return this.enabled?"1":"0"+((k=(f=this._target)===null||f===void 0?void 0:f.texture)===null||k===void 0?void 0:k.encoding)},isCompatible:h=>{var f;return!(!((f=h.materialObject.userData)===null||f===void 0)&&f.ssaoDisabled)&&h.isMeshStandardMaterial2}},this.intensity=2,this.power=1.1,this.autoRadius=!0,this.objectRadius=2,this.tolerance=1,this.bias=.15,this.falloff=.7,this.rayCount=2,this.stepCount=4,this.smoothEnabled=!0,this.renderWithCamera=!0,this.uiConfig={type:"folder",label:"SS Global illumination (Dev)",children:[...Ap(this),{type:"checkbox",label:"GI Enabled",hidden:()=>!this._giActivated,property:[this,"ssgiEnabled"]}]},this._renderer=e,this._target=i,this.needsSwap=!0,this._giActivated=a,this.ssgiEnabled=a,this.bilateralPass=new L1(this._target,s,"rgba")}get ssgiEnabled(){return parseInt(this.material.defines.SSGI_ENABLED)>.5}set ssgiEnabled(e){e=e&&this._giActivated,this.material.defines.SSGI_ENABLED=e?1:0,this.material.needsUpdate=!0}render(e,i,s,a,h){this.needsSwap=!1,!this.renderWithCamera&&this._renderer.frameCount<2||(this._renderer.blit(this._target.texture,i),this.uniforms.tLastThis.value=i.texture,super.render(e,this._target,s,a,h),this.smoothEnabled&&this.bilateralPass.render(e,i,s,a,h))}}y_([jn()],Fv.prototype,"bilateralPass",void 0),y_([Xr("Intensity",[0,4]),jn(),dn()],Fv.prototype,"intensity",void 0),y_([Xr("Power",[0,3]),jn(),dn()],Fv.prototype,"power",void 0),y_([Jr("Auto radius"),jn(),dn()],Fv.prototype,"autoRadius",void 0),y_([Xr("Object Radius",[.01,10]),jn(),dn()],Fv.prototype,"objectRadius",void 0),y_([Xr("Tolerance",[.1,5]),jn(),dn()],Fv.prototype,"tolerance",void 0),y_([Xr("Bias",[-.3,.3]),jn(),dn()],Fv.prototype,"bias",void 0),y_([Xr("Falloff",[1e-4,4]),jn(),dn()],Fv.prototype,"falloff",void 0),y_([Xr("Ray Count",[1,5],1),jn(),dn()],Fv.prototype,"rayCount",void 0),y_([Xr("Step count",[1,16],1),jn(),kn("RTAO_STEP_COUNT")],Fv.prototype,"stepCount",void 0),y_([Jr("Smooth Enabled"),jn()],Fv.prototype,"smoothEnabled",void 0),y_([Jr("Render with Camera")],Fv.prototype,"renderWithCamera",void 0);class v2 extends Gw{constructor(e=!0){super(),this.dependencies=[Kr,ba,dp],this._initEnabled=!1,this.setDirty=this.setDirty.bind(this),this._initEnabled=e}get rtgiTarget(){return this._rtgiTarget}async onAdded(e){var i,s;await super.onAdded(e),this.enabled=this._initEnabled,(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)}get enabled(){var e,i;return((i=(e=this.passes.ssrtgi)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.enabled)||!1}set enabled(e){var i;!((i=this.passes.ssrtgi)===null||i===void 0)&&i.passObject&&(this.passes.ssrtgi.passObject.enabled=e)}createPasses(e){var i,s,a;this._rtgiTarget=e.renderer.createTarget({sizeMultiplier:1});let h=!1;return(i=this._viewer)===null||i===void 0||i.getPluginByType("debug"),[UA(e,{passId:"ssrtgi",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new Fv(e.renderer,this._rtgiTarget,(a=(s=e.getPlugin(ba))===null||s===void 0?void 0:s.getUnpackSnippet())!==null&&a!==void 0?a:"",!0),update:()=>{var f;let k=this.enabled;if(k&&!h){const et=(f=this._viewer)===null||f===void 0?void 0:f.getPluginByType("SSAO");et!=null&&et.enabled&&(confirm("SSAO Plugin needs to be disabled to enable SSRTGI or SSRTAO. Disable now?")?et.enabled=!1:(this.enabled=!1,k=!1))}h=k,k&&this.passes.ssrtgi.passObject.bilateralPass.updateShaderProperties([e.getPlugin(ba)])}},()=>[e.getPlugin(ba),e.getPlugin(dp),e.scene.activeCamera,e.renderer])]}async onRemove(e){return e.renderer.disposeTarget(this._rtgiTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get uiConfig(){var e,i,s,a,h;const f=(s=(i=(e=this.passes.ssrtgi)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.uiConfig)!==null&&s!==void 0?s:{};return(h=(a=f.children)===null||a===void 0?void 0:a.map(k=>Ht(k)))===null||h===void 0||h.flat(2).forEach(k=>k&&(k.onChange=this.setDirty)),f}}v2.PluginType="SSGI";class Aw extends Js{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this.dependencies=[Kr],this.variations=[],this._selectedSwitchNode=()=>{var e;const i=(e=this._picking)===null||e===void 0?void 0:e.getSelectedObject();if(!i)return;const s=this.variations.map(h=>h.name);let a;return i.traverseAncestors(h=>{a||s.includes(h.name)&&(a=h)}),a},this.uiConfig={label:"Switch Node",type:"folder",children:[()=>[{type:"folder",label:"All nodes",expanded:!0,children:[this.variations.map(e=>({type:"input",label:e.title,property:[e,"name"],onChange:()=>this.refreshUi()}))]},{type:"button",label:"Add Node",value:()=>{this.variations.push({name:"switch_node",selected:"",title:"Switch Node",camView:"front",camDistance:1}),this.refreshUi()}},{type:"button",label:"Refresh UI",value:()=>this.refreshUi()},{type:"input",label:"Selected node title",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(i=>i.name===e.name),"title"]:[]},onChange:()=>this.refreshUi()},{type:"slider",bounds:[.01,2],stepSize:.01,label:"Cam Distance",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(i=>i.name===e.name),"camDistance"]:[]}},{type:"dropdown",label:"Cam View",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(i=>i.name===e.name),"camView"]:[]},onChange:()=>this.refreshUi(),children:["top","bottom","front","back","left","right"].map(e=>({label:e,value:e}))}]]}}async onAdded(e){var i,s;await super.onAdded(e),this._picking=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("Picking"),(s=this._picking)===null||s===void 0||s.addEventListener("selectedObjectChanged",()=>{var a,h;(h=(a=this.uiConfig).uiRefresh)===null||h===void 0||h.call(a)}),e.addEventListener("postFrame",()=>{this._uiNeedRefresh&&this._refreshUi()}),e.addEventListener("preRender",()=>{if(this._viewer)for(const a of this.variations){const h=this._viewer.scene.getObjectByName(a.name);if(!h||h.children.length<1)return;a.selected||(a.selected=h.children[0].name||h.children[0].uuid);for(const f of h.children)f.visible=(f.name||f.uuid)===a.selected}}),e.addEventListener("postRender",()=>{if(this._viewer)for(const a of this.variations){const h=this._viewer.scene.getObjectByName(a.name);if(!h||h.children.length<1)return;for(const f of h.children)f.visible=!0}}),this.addEventListener("deserialize",async()=>{await au(200),this.refreshUi()})}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}_refreshUi(){var e,i,s;if(this.enabled&&this._viewer){this._uiNeedRefresh=!1,p0.RemoveAll(Aw.PluginType);for(const a of this.variations){const h=this._viewer.scene.getObjectByName(a.name);h?(h.children.length<1&&console.warn("SwitchNode does not have enough children",a),p0.Create(Aw.PluginType,a.title,Math.min(5,h.children.length),20,0,h.children.map(f=>{const k=a.camView,et=new d.Pa4((k.includes("right")?1:0)-(k.includes("left")?1:0),(k.includes("top")?1:0)-(k.includes("bottom")?1:0),(k.includes("front")?1:0)-(k.includes("back")?1:0));a.camDistance||(a.camDistance=1);const tt=tD(this._viewer,f,void 0,7,et.multiplyScalar(.5*a.camDistance));return{id:f.uuid,image:tt,onClick:()=>{var rt;a.selected=f.name||f.uuid,(rt=this._viewer)===null||rt===void 0||rt.scene.setDirty({sceneUpdate:!0,frameFade:!0})},tooltip:f.name||f.uuid}}),(f,k)=>ED(f,{placement:"bottom",content:k.tooltip}))):console.warn("no object found for variation, skipping",a)}p0.RebuildUi((e=this._viewer)===null||e===void 0?void 0:e.container),(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i)}}}Aw.PluginType="SwitchNodePlugin",function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);h>3&&f&&Object.defineProperty(e,i,f)}([jn()],Aw.prototype,"variations",void 0);class SD extends d.u9r{constructor(e,i,s=32,a=64,h=!1,f=new d.FM8(1,1),k="shape"){super(),this.type="TubeShapeGeometry",this.parameters={path:i,shape:e,shapeSegments:s,tubularSegments:a,closed:h,primary:k,shapeScale:f.clone()};const et=i.computeFrenetFrames(a,h);this.frames=et;const tt=new d.Pa4,rt=new d.Pa4,lt=new d.Pa4,pt=new d.FM8;let ft=new d.Pa4;const vt=[],yt=[],Mt=[],xt=e.getSpacedPoints(s);for(const Rt of xt)Rt.multiply(f);(function(){for(let Rt=0;Rt<a;Rt++)At(Rt);At(h===!1?a:0),function(){for(let Rt=0;Rt<=a;Rt++)for(let Bt=0;Bt<=s;Bt++)pt.x=Rt/a,pt.y=Bt/s,yt.push(pt.x,pt.y)}(),function(){const Rt=k==="shape",Bt=Rt?s:a,Qt=Rt?a:s;for(let Wt=1;Wt<=Bt;Wt++)for(let tn=1;tn<=Qt;tn++){const[pn,yn]=Rt?[tn,Wt]:[Wt,tn],En=(s+1)*(pn-1)+(yn-1),wn=(s+1)*pn+(yn-1),In=(s+1)*pn+yn,xn=(s+1)*(pn-1)+yn;Mt.push(En,wn,xn),Mt.push(wn,In,xn)}}()})(),this.setIndex(Mt),this.setAttribute("position",new d.a$l(vt,3)),this.setAttribute("uv",new d.a$l(yt,2)),this.computeVertexNormals();const Et=this.attributes.normal;function At(Rt){ft=i.getPointAt(Rt/a,ft);const Bt=et.normals[Rt],Qt=et.binormals[Rt];for(let Wt=0;Wt<=s;Wt++){const tn=xt[Wt%s];rt.set(0,0,0).addScaledVector(Bt,tn.x).addScaledVector(Qt,tn.y),tt.copy(ft).add(rt),vt.push(tt.x,tt.y,tt.z)}}(function(){for(let Bt=1;Bt<s;Bt++){const Qt=Bt+a*(s+1);rt.fromBufferAttribute(Et,Bt),lt.fromBufferAttribute(Et,Qt),rt.add(lt).normalize(),Et.setXYZ(Bt,rt.x,rt.y,rt.z),Et.setXYZ(Qt,rt.x,rt.y,rt.z)}for(let Bt=1;Bt<a;Bt++){const Qt=Bt*(s+1),Wt=Qt+s;rt.fromBufferAttribute(Et,Qt),lt.fromBufferAttribute(Et,Wt),rt.add(lt).normalize(),Et.setXYZ(Qt,rt.x,rt.y,rt.z),Et.setXYZ(Wt,rt.x,rt.y,rt.z)}rt.fromBufferAttribute(Et,0),lt.fromBufferAttribute(Et,s),rt.add(lt);const Rt=a*(s+1);lt.fromBufferAttribute(Et,Rt),rt.add(lt),lt.fromBufferAttribute(Et,Rt+s),rt.add(lt),rt.normalize(),Et.setXYZ(0,rt.x,rt.y,rt.z),Et.setXYZ(s,rt.x,rt.y,rt.z),Et.setXYZ(Rt,rt.x,rt.y,rt.z),Et.setXYZ(Rt+s,rt.x,rt.y,rt.z),Et.needsUpdate=!0})()}createSplits(e){this.clearGroups();const i=this.parameters.primary==="shape"?this.parameters.shapeSegments:this.parameters.tubularSegments,s=this.index.count,a=[...e,1].sort();let h=0,f=0;for(const k of a){const et=Math.round(i*k)*s/i;this.addGroup(h,et-h,f++),h=et}return this.groups.length}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e.shape=this.parameters.shape.toJSON(),e}}var CD,ww=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};let Uv=CD=class extends Js{constructor(){super(...arguments),this.enabled=!0,this.shapeSegments=32,this.tubularSegments=32,this.shapeScale=new d.FM8(1,1),this.materialSplits="0.3, 0.6",this.horizontalSplits=!0,this.extrudeCirceTube=async()=>{var c,e;const i=(e=(c=this._viewer)===null||c===void 0?void 0:c.getPlugin(Uo))===null||e===void 0?void 0:e.getSelectedObject();if(!i)return;let s=this._viewer.prompt("Radius: Radius for the circle","1",!0);if(!s)return;s=parseFloat(s);const a=new MD(0,0,s,s,0,2*Math.PI,!0,0);await this.extrudeObject(i,a)}}async onAdded(c){await super.onAdded(c)}static CreateCurve(c,e){var i,s;if(c==="circle")return new MD(0,0,(i=e.radius)!==null&&i!==void 0?i:1,(s=e.radius)!==null&&s!==void 0?s:1,0,2*Math.PI,!0,0);throw new Error("Unknown curve type")}async extrudeObject(c,e,i=this.shapeSegments,s=this.tubularSegments,a=this.shapeScale,h=this.materialSplits.split(",").map(k=>parseFloat(k.trim())),f=this.horizontalSplits){var k,et,tt,rt,lt,pt,ft,vt;if(c.userData.isExtrudedTube,c.userData._extrudeSource){const Rt=c.userData._extrudeSource;if(c=(k=c.parent)===null||k===void 0?void 0:k.children.find(Bt=>Rt===Bt.uuid),!c)return void console.warn("Could not find extrude source with uuid",Rt)}if(c.userData.extrudedObject){const Rt=c.userData.extrudedObject,Bt=(et=c.parent)===null||et===void 0?void 0:et.children.find(Qt=>Rt===Qt.uuid);Bt&&(Bt.removeFromParent(),Bt.geometry.dispose(),Bt.geometry=null,Bt.material=null),delete c.userData.extrudedObject}const yt=c.geometry;if(!yt)return void((tt=this._viewer)===null||tt===void 0||tt.alert("Extrude: No geometry to extrude"));const Mt=[c.material];let xt;try{const Rt=CD.ConvertGeometryToFlatShape(yt);xt=new SD(Rt,e,i,s,!0,a,f?"shape":"path"),xt.computeBoundingBox(),xt.createSplits(h)}catch(Rt){return void((rt=this._viewer)===null||rt===void 0||rt.alert(typeof Rt=="string"?Rt:Rt==null?void 0:Rt.message))}Mt[0].color.set(16777215);for(let Rt=Mt.length;Rt<xt.groups.length;Rt++){const Bt=Mt[0].clone();Mt.push(Bt),Bt.color.set(16777215*Math.random())}const Et=new d.Kj0(xt,Mt);Et.userData._extrudeSource=c.uuid,Et.userData.isExtrudedTube=!0,c.visible=!1,c.userData.bboxVisible=!1,Et.name=c.name+"_extruded";const At=await((ft=(pt=(lt=this._viewer)===null||lt===void 0?void 0:lt.getManager())===null||pt===void 0?void 0:pt.importer)===null||ft===void 0?void 0:ft.processImportedSingle(Et,{autoCenter:!1,autoScale:!1}));At&&((vt=c.parent)===null||vt===void 0||vt.add(At.modelObject),c.userData.extrudedObject=At.modelObject.uuid,At.dispatchEvent({type:"select",ui:!0,value:At}))}static ExtrudeShape(c,e,i,s,a,h,f,k){const et=new SD(c,s,e,i,!0,new d.FM8(a,h),k?"shape":"path");et.computeBoundingBox(),et.createSplits(f);const tt=new d.Kj0(et,[]);return tt.userData.isExtrudedTube=!0,tt}static ConvertGeometryToFlatShape(c,e=!0){if(c.userData.__planarShape)return c.userData.__planarShape;let i=c.attributes.position;if(!i)throw"no position attribute";if(i.count>500)throw"too large to extrude";const s=c;i=s.attributes.position,s.boundingBox||s.computeBoundingBox();const a=s.boundingBox.getSize(new d.Pa4),h=a.x<.001?"x":a.y<.001?"y":a.z<.001?"z":null;if(!h)throw"geometry is not axis aligned not planar";let f=[];for(let et=0;et<i.count;et++){const tt=new d.FM8;h==="x"?tt.set(i.getY(et),i.getZ(et)):h==="y"?tt.set(i.getX(et),i.getZ(et)):tt.set(i.getX(et),i.getY(et)),f.push(tt)}if(e){let et=0;for(let tt=0;tt<f.length;tt++)(f[tt].x<f[et].x||f[tt].x===f[et].x&&f[tt].y<f[et].y)&&(et=tt);et!==0&&(f=f.slice(et).concat(f.slice(0,et)))}const k=new d.bnF(f);return c.userData.__planarShape=k,k}};Uv.PluginType="ShapeTubeExtrudePlugin",ww([Jr("Enabled")],Uv.prototype,"enabled",void 0),ww([Xr("Shape Segments (X)",[1,100],1,c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(Uo))===null||i===void 0)&&i.getSelectedObject())}}))],Uv.prototype,"shapeSegments",void 0),ww([Xr("Tube Segments (Y)",[1,100],1,c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(Uo))===null||i===void 0)&&i.getSelectedObject())}}))],Uv.prototype,"tubularSegments",void 0),ww([Qo("Shape scale",[.01,10],.01,c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(Uo))===null||i===void 0)&&i.getSelectedObject())}}))],Uv.prototype,"shapeScale",void 0),ww([so("Material Splits",c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(Uo))===null||i===void 0)&&i.getSelectedObject())}}))],Uv.prototype,"materialSplits",void 0),ww([Jr("Horizontal Splits",c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(Uo))===null||i===void 0)&&i.getSelectedObject())}}))],Uv.prototype,"horizontalSplits",void 0),ww([Ao("Extrude Circle Tube",c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(Uo))===null||i===void 0)&&i.getSelectedObject())}}))],Uv.prototype,"extrudeCirceTube",void 0),Uv=CD=ww([Ws("Extrude Tube Shapes")],Uv);class MD extends d.Ny0{getPoint(e,i){return super.getPoint(e,i||new d.Pa4)}}class fM extends Js{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.fromJSON=void 0,this._lastFrameTime=0,this._updaters=[],this.dependencies=[],this._fadeDisabled=!1,this.disableFrameFade=!0,this._postFrame=()=>{var i,s;if(!this._viewer)return;if(!this.enabled||Object.keys(this.animations).length<1)return this._lastFrameTime=0,void(this._fadeDisabled&&((i=this._viewer.getPluginByType("FrameFade"))===null||i===void 0||i.enable(fM.PluginType),this._fadeDisabled=!1));const a=mo()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=a-1/60);let h=a-this._lastFrameTime;this._lastFrameTime=a;const f=(s=this._viewer.getPluginByType("Progressive"))===null||s===void 0?void 0:s.postFrameConvergedRecordingDelta();if(f&&f>0&&(h=f),f!==0&&(h*=1e3,!(h<=.001)&&(this._updaters.forEach(k=>{let et=h;k.time+et<0&&(et=-k.time),k.time+=et,Math.abs(et)>.001&&k.u(et)}),!this._fadeDisabled&&this.disableFrameFade))){const k=this._viewer.getPluginByType("FrameFade");k&&(k.disable(fM.PluginType),this._fadeDisabled=!0)}},this.defaultDriver=i=>({start:()=>this._updaters.push({u:i,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(s=>s.u===i),1)}),this.animations={},this.enabled=e,this._postFrame=this._postFrame.bind(this)}async onAdded(e){await super.onAdded(e),e.addEventListener("postFrame",this._postFrame)}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),super.onRemove(e)}animate(e){const i=Ho(),s={id:i,options:e,stop:()=>{var a,h,f;!((a=this.animations[i])===null||a===void 0)&&a._stop?(f=(h=this.animations[i])===null||h===void 0?void 0:h._stop)===null||f===void 0||f.call(h):console.warn("Animation not started")}};return this.animations[i]=s,s.promise=new Promise((a,h)=>{const f={driver:this.defaultDriver,onComplete:()=>{var et;(et=e.onComplete)===null||et===void 0||et.call(e),a()},onStop:()=>{var et;(et=e.onStop)===null||et===void 0||et.call(e),a()},...e},k=XA(f);this.animations[i]._stop=k.stop,this.animations[i].options=f}).then(()=>(delete this.animations[i],i)),this.animations[i]}async animateAsync(e){return this.animate(e).promise}}fM.PluginType="PopmotionPlugin";const wN=async c=>_u(await(await fetch(c)).blob());async function G3(c,e=wN){const i=c.match(/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)/g);if(i)for(const s of i){const a=await e(s);c=c.replace(s,a)}return c}function TD(c,e,{width:i,height:s},a=!0){const h=`
<svg viewBox="0 0 ${i} ${s}" xmlns="http://www.w3.org/2000/svg">
    <style>
    ${e}
    </style>
    <foreignObject x="0" y="0" width="100%" height="100%">
        <div xmlns="http://www.w3.org/1999/xhtml" style="height: 100%; width: 100%; position: absolute: top:0; left:0">
            ${c}
        </div>
    </foreignObject>
</svg>
    `;return a?un(h):h}async function xN(c,e,i){const s=TD(c,e,i);return await rD(s,i)}async function bN(c,e,i){const s=TD(c,e,i);return await qB(s,i)}var ID,v0,wu=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};const Fm=c=>({onChange:e=>{e.last&&c.onChange()}});let vp=ID=class{constructor(){this.text="Custom Text",this.fontSize=100,this.width=1024,this.height=1024,this.xOffset=0,this.yOffset=0,this.boxWidth=1024,this.boxHeight=1024,this.fontFamily="",this.fontPath="",this.maskText=!1,this.innerShadow=!1,this.textColor="#000000",this.bgFillColor="#ffffff",this.svgBackground="#ffffff",this.onChange=()=>{}}set(c){Object.assign(this,c)}reset(){const c=this.onChange;Object.assign(this,new ID),this.onChange=c}toJSON(){return{text:this.text,fontFamily:this.fontFamily,fontPath:this.fontPath,svgBackground:this.svgBackground,width:this.width,height:this.height,xOffset:this.xOffset,yOffset:this.yOffset,boxWidth:this.boxWidth,boxHeight:this.boxHeight,fontSize:this.fontSize,maskText:this.maskText,innerShadow:this.innerShadow,bgFillColor:this.bgFillColor,textColor:this.textColor}}};wu([so("Text",Fm)],vp.prototype,"text",void 0),wu([Xr("Font Size",[2,400],1,Fm)],vp.prototype,"fontSize",void 0),wu([Xr("Width",[2,4096],1,Fm)],vp.prototype,"width",void 0),wu([Xr("Height",[2,4096],1,Fm)],vp.prototype,"height",void 0),wu([Xr("X Offset",[-1024,1024],1,Fm)],vp.prototype,"xOffset",void 0),wu([Xr("Y Offset",[-1024,1024],1,Fm)],vp.prototype,"yOffset",void 0),wu([Xr("V-Width",[2,4096],1,Fm)],vp.prototype,"boxWidth",void 0),wu([Xr("V-Height",[2,4096],1,Fm)],vp.prototype,"boxHeight",void 0),wu([so("Font",Fm)],vp.prototype,"fontFamily",void 0),wu([so("Font Url",Fm)],vp.prototype,"fontPath",void 0),wu([Jr("Mask Text",Fm)],vp.prototype,"maskText",void 0),wu([Jr("Inner Shadow",Fm)],vp.prototype,"innerShadow",void 0),wu([op("Text Color",Fm)],vp.prototype,"textColor",void 0),wu([op("BG Fill",Fm)],vp.prototype,"bgFillColor",void 0),wu([op("SVG BG",Fm)],vp.prototype,"svgBackground",void 0),vp=ID=wu([Ws("Text SVG Options")],vp);const H3={woff:"woff",woff2:"woff2",ttf:"truetype",otf:"opentype",eot:"embedded-opentype"},mM=c=>({hidden:()=>{const e=c.getSelected();return!e||!e.userData[jv.PluginType]}});let jv=v0=class extends Js{constructor(){super(),this.enabled=!0,this.getSelected=()=>{var c,e;return(e=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Picking"))===null||e===void 0?void 0:e.getSelectedObject()},this.options=new vp,this.applyToMap=!0,this.applyToBumpMap=!1,this.applyToAlphaMap=!0,this.inverseAlphaMap=!1,this._lastMeta=void 0,this.fonts={roboto:"https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2"},this._assetLoadOptions=void 0,this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this.addTextToSelected=this.addTextToSelected.bind(this),this._paramsChanged=this._paramsChanged.bind(this),this.options.onChange=this._paramsChanged}async onAdded(c){var e;await super.onAdded(c),(e=c.getPluginByType("Picking"))===null||e===void 0||e.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}_selectedObjectChanged(){var c,e,i,s,a,h;if(!this.enabled)return;const f=this.getSelected();if(!f)return void((e=(c=this.uiConfig).uiRefresh)===null||e===void 0||e.call(c,"postFrame",!0));const k=f.userData[v0.PluginType];if(!k)return this.options.reset(),this._lastMeta=void 0,void((s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0));this._lastMeta!==k&&(this.options.set(k),this._lastMeta=k),(h=(a=this.uiConfig).uiRefresh)===null||h===void 0||h.call(a,"postFrame",!0)}_paramsChanged(){if(!this.enabled)return;const c=this.getSelected();c&&c.isMesh&&c.userData[v0.PluginType]&&this.updateText(c,this.options.toJSON())}async addTextToSelected(){var c;const e=this.getSelected();e&&e.isMesh?e.material?(e.userData[v0.PluginType]||!e.material.map||await((c=this._viewer)===null||c===void 0?void 0:c.confirm("Add Text: This mesh already has a texture. Adding text will replace the texture. Continue?")))&&await this.addText(e):console.error("no material on mesh"):console.error("no mesh is selected")}async addText(c,e){return this.updateText(c,Object.assign(this.options.toJSON(),e))}async updateText(c,e){var i,s;if(!c.isMesh)return;if(!c.material)return void console.error("updateText: no material on mesh");let a=c.userData[v0.PluginType];a||(c.userData[v0.PluginType]=a={}),Object.assign(a,e);const h=c.material;h.map&&(h.map._isSimpleTextTexture&&h.map.dispose(),h.map=void 0),h.alphaMap&&(h.alphaMap._isSimpleTextTexture&&h.alphaMap.dispose(),h.alphaMap=void 0),h.bumpMap&&(h.bumpMap._isSimpleTextTexture&&h.bumpMap.dispose(),h.bumpMap=void 0);const f=await this.makeTextSvg(a);this.applyToMap&&(h.map=f),this.applyToAlphaMap&&(h.alphaMap=f,h.transparent=!0),this.applyToBumpMap&&(h.bumpMap=f),h.userData.inverseAlphaMap=this.inverseAlphaMap,h.setDirty(),h.needsUpdate=!0,(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)}async makeTextSvg(c){const e=c.fontFamily||"Arial",i=c.fontPath||this.fonts[e]||"";let s=c.style;if(i.length>0){const f=i.split("?")[0].split(".").pop()||"woff";s+=`
`+(i.length>0?`
            @font-face {
                font-family: ${e};
                src: url(${i}) format(${H3[f]||f});
            }`:"")}let a=function({text:f="Custom Text",svgBackground:k="#ffffff",xOffset:et=0,yOffset:tt=0,width:rt=1024,height:lt=1024,boxWidth:pt=1024,boxHeight:ft=1024,fontFamily:vt="",fontSize:yt=32,maskText:Mt=!0,innerShadow:xt=!0,bgFillColor:Et="#000000",textColor:At="#ffffff",style:Rt=""}){return`
<svg style="background-color:${k}" width="${rt}" height="${lt}" viewBox="0 0 ${pt} ${ft}"
 xmlns="http://www.w3.org/2000/svg"
 xmlns:xlink="http://www.w3.org/1999/xlink">
     <defs>
        <style>
        ${Rt}
        </style>
    </defs>

    <g style="overflow:hidden; text-anchor: middle; font-size: ${yt}px; font-family: ${vt||"Arial"}">
        <defs>

`+(Mt?`
<mask id="textMask">
<text style="fill:white; font-size: ${yt}px;" x="${et+pt/2}" y="${ft/2+tt+yt/4}" > ${f} </text>
</mask>
`:"")+`

`+(xt?`
<filter id="innerShadow" x="-20%" y="-20%" width="140%" height="140%">
<feGaussianBlur in="SourceGraphic" stdDeviation="0.5" result="blur"/>
<feOffset in="blur" dx="1.5" dy="1.5"/>
</filter>
`:"")+`

        </defs>

`+(Mt?`
        <g mask="url(#textMask)">
`:"")+`

        <rect x="0" y="0" width="${pt}" height="${ft}" style="fill:${Et}"/>
        <text style="${xt?"filter: url(#innerShadow);":""} fill:${At};" x="${et+pt/2}" y="${ft/2+tt+yt/4}"> ${f} </text>

`+(Mt?`
        </g>
`:"")+`

    </g>
</svg>
`}({...c,fontFamily:e,style:s});a=await G3(a,async f=>this._getAssetData(f)),a=un(a);const h=await this._viewer.getManager().importer.importSinglePath(a,{generateMipmaps:!1,minFilter:d.wem});return h._isSimpleTextTexture=!0,h.flipY=!1,h.needsUpdate=!0,h}async _getAssetData(c){var e,i;if(c.startsWith("http://www.w3.org"))return c;const s=(i=(e=this._viewer)===null||e===void 0?void 0:e.getManager())===null||i===void 0?void 0:i.importer;if(!s)throw new Error("no importer");this._assetLoadOptions=this._assetLoadOptions||{fileHandler:new $a(s.loadingManager),processImported:!1};try{return await s.importPath(c,this._assetLoadOptions)}catch(a){return console.error(a),""}}};jv.PluginType="SimpleTextPlugin",wu([Io(void 0,{params:mM})],jv.prototype,"options",void 0),wu([Jr("Apply Map",mM),hn(v0.prototype._paramsChanged)],jv.prototype,"applyToMap",void 0),wu([Jr("Apply Bump Map",mM),hn(v0.prototype._paramsChanged)],jv.prototype,"applyToBumpMap",void 0),wu([Jr("Apply Alpha Map",mM),hn(v0.prototype._paramsChanged)],jv.prototype,"applyToAlphaMap",void 0),wu([Jr("Invert Alpha Map",mM),hn(v0.prototype._paramsChanged)],jv.prototype,"inverseAlphaMap",void 0),wu([Ao("Add Text",c=>({hidden:()=>!c.getSelected()}))],jv.prototype,"addTextToSelected",null),jv=v0=wu([Ws("Simple Text")],jv);class PD{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y,this.array[this.top++]=e.z}}class EN{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y}}class my{constructor(e){this.plane=null,this.front=null,this.back=null,this.polygons=[],e&&this.build(e)}clone(){const e=new my;return e.plane=this.plane&&this.plane.clone(),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.polygons=this.polygons.map(i=>i.clone()),e}invert(){for(let i=0;i<this.polygons.length;i++)this.polygons[i].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();const e=this.front;this.front=this.back,this.back=e}clipPolygons(e){if(!this.plane)return e.slice();let i=new Array,s=new Array;for(let a=0;a<e.length;a++)this.plane.splitPolygon(e[a],i,s,i,s);return this.front&&(i=this.front.clipPolygons(i)),s=this.back?this.back.clipPolygons(s):[],i.concat(s)}clipTo(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)}allPolygons(){let e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e}build(e){if(!e.length)return;this.plane||(this.plane=e[0].plane.clone());const i=[],s=[];for(let a=0;a<e.length;a++)this.plane.splitPolygon(e[a],this.polygons,this.polygons,i,s);i.length&&(this.front||(this.front=new my),this.front.build(i)),s.length&&(this.back||(this.back=new my),this.back.build(s))}}class cv{constructor(e=0,i=0,s=0){this.x=e,this.y=i,this.z=s}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}clone(){return new cv(this.x,this.y,this.z)}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}times(e){return this.x*=e,this.y*=e,this.z*=e,this}dividedBy(e){return this.x/=e,this.y/=e,this.z/=e,this}lerp(e,i){return this.add(new cv().copy(e).sub(this).times(i))}unit(){return this.dividedBy(this.length())}length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}normalize(){return this.unit()}cross(e){const i=this.clone(),s=i.x,a=i.y,h=i.z,f=e.x,k=e.y,et=e.z;return this.x=a*et-h*k,this.y=h*f-s*et,this.z=s*k-a*f,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}toVector3(){return new d.Pa4(this.x,this.y,this.z)}}class c1{constructor(e,i){this.normal=e,this.w=i,this.normal=e,this.w=i}clone(){return new c1(this.normal.clone(),this.w)}flip(){this.normal.negate(),this.w=-this.w}splitPolygon(e,i,s,a,h){let f=0;const k=[];for(let et=0;et<e.vertices.length;et++){const tt=this.normal.dot(e.vertices[et].pos)-this.w,rt=tt<-c1.EPSILON?2:tt>c1.EPSILON?1:0;f|=rt,k.push(rt)}switch(f){case 0:(this.normal.dot(e.plane.normal)>0?i:s).push(e);break;case 1:a.push(e);break;case 2:h.push(e);break;case 3:{const et=[],tt=[];for(let rt=0;rt<e.vertices.length;rt++){const lt=(rt+1)%e.vertices.length,pt=k[rt],ft=k[lt],vt=e.vertices[rt],yt=e.vertices[lt];if(pt!=2&&et.push(vt),pt!=1&&tt.push(pt!=2?vt.clone():vt),(pt|ft)==3){const Mt=(this.w-this.normal.dot(vt.pos))/this.normal.dot(new cv().copy(yt.pos).sub(vt.pos)),xt=vt.interpolate(yt,Mt);et.push(xt),tt.push(xt.clone())}}et.length>=3&&a.push(new dS(et,e.shared)),tt.length>=3&&h.push(new dS(tt,e.shared));break}}}static fromPoints(e,i,s){const a=new cv().copy(i).sub(e).cross(new cv().copy(s).sub(e)).normalize();return new c1(a.clone(),a.dot(e))}}c1.EPSILON=1e-5;class dS{constructor(e,i){this.vertices=e,this.shared=i,this.plane=c1.fromPoints(e[0].pos,e[1].pos,e[2].pos)}clone(){return new dS(this.vertices.map(e=>e.clone()),this.shared)}flip(){this.vertices.reverse().map(e=>e.flip()),this.plane.flip()}}class _2{constructor(e,i,s,a){this.pos=new cv().copy(e),this.normal=new cv().copy(i),this.uv=new cv().copy(s),this.uv.z=0,a&&(this.color=new cv().copy(a))}clone(){return new _2(this.pos,this.normal,this.uv,this.color)}flip(){this.normal.negate()}interpolate(e,i){return new _2(this.pos.clone().lerp(e.pos,i),this.normal.clone().lerp(e.normal,i),this.uv.clone().lerp(e.uv,i),this.color&&e.color&&this.color.clone().lerp(e.color,i))}}class Iu{constructor(){this.polygons=new Array}static fromPolygons(e){const i=new Iu;return i.polygons=e,i}static fromGeometry(e,i){let s=[];const a=e.attributes.position,h=e.attributes.normal,f=e.attributes.uv,k=e.attributes.color,et=e.groups;let tt;if(e.index)tt=e.index.array;else{tt=new Array(a.array.length/a.itemSize|0);for(let lt=0;lt<tt.length;lt++)tt[lt]=lt}const rt=tt.length/3|0;s=new Array(rt);for(let lt=0,pt=0,ft=tt.length;lt<ft;lt+=3,pt++){const vt=new Array(3);for(let yt=0;yt<3;yt++){const Mt=tt[lt+yt],xt=3*Mt,Et=2*Mt,At=a.array[xt],Rt=a.array[xt+1],Bt=a.array[xt+2],Qt=h.array[xt],Wt=h.array[xt+1],tn=h.array[xt+2],pn=f==null?void 0:f.array[Et],yn=f==null?void 0:f.array[Et+1];vt[yt]=new _2(new cv(At,Rt,Bt),new cv(Qt,Wt,tn),new cv(pn,yn,0),k&&new cv(k.array[Et],k.array[Et+1],k.array[Et+2]))}if(i===void 0&&et&&et.length>0)for(const yt of et)lt>=yt.start&&lt<yt.start+yt.count&&(s[pt]=new dS(vt,yt.materialIndex));else s[pt]=new dS(vt,i)}return Iu.fromPolygons(s.filter(lt=>!isNaN(lt.plane.normal.x)))}static toGeometry(e,i){let s=0;const a=e.polygons;for(const ft of a)s+=ft.vertices.length-2;const h=new d.u9r,f=new PD(3*s*3),k=new PD(3*s*3),et=new EN(2*s*3);let tt;const rt=[],lt=[];for(const ft of a){const vt=ft.vertices,yt=vt.length;ft.shared!==void 0&&(rt[ft.shared]||(rt[ft.shared]=[])),yt&&vt[0].color!==void 0&&(tt||(tt=new PD(3*s*3)));for(let Mt=3;Mt<=yt;Mt++)(ft.shared===void 0?lt:rt[ft.shared]).push(f.top/3,f.top/3+1,f.top/3+2),f.write(vt[0].pos),f.write(vt[Mt-2].pos),f.write(vt[Mt-1].pos),k.write(vt[0].normal),k.write(vt[Mt-2].normal),k.write(vt[Mt-1].normal),et&&(et.write(vt[0].uv),et.write(vt[Mt-2].uv),et.write(vt[Mt-1].uv)),tt&&(tt.write(vt[0].color),tt.write(vt[Mt-2].color),tt.write(vt[Mt-1].color))}h.setAttribute("position",new d.TlE(f.array,3)),h.setAttribute("normal",new d.TlE(k.array,3)),et&&h.setAttribute("uv",new d.TlE(et.array,2)),tt&&h.setAttribute("color",new d.TlE(tt.array,3));for(let ft=0;ft<rt.length;ft++)rt[ft]===void 0&&(rt[ft]=[]);if(rt.length){let ft=[],vt=0;for(let yt=0;yt<rt.length;yt++)h.addGroup(vt,rt[yt].length,yt),vt+=rt[yt].length,ft=ft.concat(rt[yt]);h.addGroup(vt,lt.length,rt.length),ft=ft.concat(lt),h.setIndex(ft)}const pt=new d.yGw().copy(i).invert();return h.applyMatrix4(pt),h.computeBoundingSphere(),h.computeBoundingBox(),h}static fromMesh(e,i){const s=Iu.fromGeometry(e.geometry,i),a=new d.Pa4,h=new d.Vkp;h.getNormalMatrix(e.matrix);for(let f=0;f<s.polygons.length;f++){const k=s.polygons[f];for(let et=0;et<k.vertices.length;et++){const tt=k.vertices[et];tt.pos.copy(a.copy(tt.pos.toVector3()).applyMatrix4(e.matrix)),tt.normal.copy(a.copy(tt.normal.toVector3()).applyMatrix3(h))}}return s}static toMesh(e,i,s){const a=Iu.toGeometry(e,i),h=new d.Kj0(a,s);return h.matrix.copy(i),h.matrix.decompose(h.position,h.quaternion,h.scale),h.rotation.setFromQuaternion(h.quaternion),h.updateMatrixWorld(),h.castShadow=h.receiveShadow=!0,h}static union(e,i){const s=Iu.fromMesh(e),a=Iu.fromMesh(i);return Iu.toMesh(s.union(a),e.matrix,e.material)}static subtract(e,i){const s=Iu.fromMesh(e),a=Iu.fromMesh(i);return Iu.toMesh(s.subtract(a),e.matrix,e.material)}static intersect(e,i){const s=Iu.fromMesh(e),a=Iu.fromMesh(i);return Iu.toMesh(s.intersect(a),e.matrix,e.material)}clone(){const e=new Iu;return e.polygons=this.polygons.map(i=>i.clone()).filter(i=>Number.isFinite(i.plane.w)),e}toPolygons(){return this.polygons}union(e){const i=new my(this.clone().polygons),s=new my(e.clone().polygons);return i.clipTo(s),s.clipTo(i),s.invert(),s.clipTo(i),s.invert(),i.build(s.allPolygons()),Iu.fromPolygons(i.allPolygons())}subtract(e){const i=new my(this.clone().polygons),s=new my(e.clone().polygons);return i.invert(),i.clipTo(s),s.clipTo(i),s.invert(),s.clipTo(i),s.invert(),i.build(s.allPolygons()),i.invert(),Iu.fromPolygons(i.allPolygons())}intersect(e){const i=new my(this.clone().polygons),s=new my(e.clone().polygons);return i.invert(),s.clipTo(i),s.invert(),i.clipTo(s),s.clipTo(i),i.build(s.allPolygons()),i.invert(),Iu.fromPolygons(i.allPolygons())}inverse(){const e=this.clone();for(const i of e.polygons)i.flip();return e}toMesh(e,i){return Iu.toMesh(this,e,i)}toGeometry(e){return Iu.toGeometry(this,e)}}var pS=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};const DD=["union","subtract","intersect"];class oA extends Js{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[Uo],this.rootMesh=new d.Kj0,this.showResult=!1,this.csgSelectedEnabled=!1,this.csgSelectedOperation="union",this._csgNeedsUpdate=!1,this._csgVisible=!1,this._sceneUpdate=this._sceneUpdate.bind(this),this._preFrame=this._preFrame.bind(this),this.makeSelectedCSGBrush=this.makeSelectedCSGBrush.bind(this),this.refreshCSG=this.refreshCSG.bind(this),this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this._updateSelectedProperties=this._updateSelectedProperties.bind(this),this.downloadObject=this.downloadObject.bind(this),this.exportObject=this.exportObject.bind(this)}async onAdded(e){var i;await super.onAdded(e),this.rootObject=await e.createObject3D(),this.rootObject.modelObject.add(this.rootMesh),e.scene.addEventListener("sceneUpdate",this._sceneUpdate),e.addEventListener("preFrame",this._preFrame),(i=e.getPlugin(Uo))===null||i===void 0||i.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}async makeSelectedCSGBrush(){var e,i;const s=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(Uo))===null||i===void 0?void 0:i.getSelectedObject();s&&s.geometry&&(s.userData._isCSGMesh||(s.userData.csgBrush||(s.userData.csgBrush={enabled:!0,operation:"union"}),this._selectedObjectChanged()))}refreshCSG(){this._sceneUpdate()}async downloadObject(){const e=await this.exportObject();e&&Du(e,"csg."+e.ext)}async exportObject(){var e,i;const s=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("AssetExporterPlugin"))===null||i===void 0?void 0:i.exporter;if(!s||!this.rootObject)return;const a=this.rootMesh.visible;this.rootMesh.visible=!0;const h=await s.exportObject(this.rootObject.modelObject,{});return this.rootMesh.visible=a,h}_updateSelectedProperties(){var e,i;const s=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(Uo))===null||i===void 0?void 0:i.getSelectedObject();s&&s.userData.csgBrush&&(s.userData.csgBrush.enabled=this.csgSelectedEnabled,s.userData.csgBrush.operation=this.csgSelectedOperation)}_selectedObjectChanged(){var e,i,s,a,h,f,k,et;const tt=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(Uo))===null||i===void 0?void 0:i.getSelectedObject();tt&&(this.csgSelectedEnabled=(a=(s=tt.userData.csgBrush)===null||s===void 0?void 0:s.enabled)!==null&&a!==void 0&&a,this.csgSelectedOperation=(f=(h=tt.userData.csgBrush)===null||h===void 0?void 0:h.operation)!==null&&f!==void 0?f:"union"),(et=(k=this.uiConfig)===null||k===void 0?void 0:k.uiRefresh)===null||et===void 0||et.call(k,"postFrame",!0)}_preFrame(){var e,i,s;if(!this.rootObject||!this._csgNeedsUpdate&&this._csgVisible===this.showResult)return;const a=this._findCSGMeshes();this._csgNeedsUpdate&&(this._csgNeedsUpdate=!1,(e=this.rootObject)===null||e===void 0||e.modelObject.updateMatrixWorld(!0),((i=this.rootMesh.userData.dispose)!==null&&i!==void 0?i:this.rootMesh.removeFromParent)(),this.rootMesh=this._buildCSGMesh(a)),this.rootMesh&&!this.rootMesh.parent&&((s=this.rootObject)===null||s===void 0||s.modelObject.add(this.rootMesh)),this.showResult?(a.forEach(h=>{h[0].visible=!1}),this.rootObject.visible=!0,this._csgVisible=!0,this.rootObject.setDirty()):(a.forEach(h=>{h[0].visible=!0}),this.rootObject.visible=!1,this._csgVisible=!1,this.rootObject.setDirty())}_findCSGMeshes(){var e;const i=[];return(e=this._viewer)===null||e===void 0||e.scene.traverse(s=>{var a;s.isMesh&&s.geometry&&(!((a=s.userData.csgBrush)===null||a===void 0)&&a.enabled)&&i.push([s,s.userData.csgBrush.operation])}),i}_sceneUpdate(e){var i,s;!((s=(i=e==null?void 0:e.object)===null||i===void 0?void 0:i.userData)===null||s===void 0)&&s._isCSGMesh||(this._csgNeedsUpdate=!0)}}pS([Jr("Show Result",c=>({onChange:()=>{var e;return(e=c._viewer)===null||e===void 0?void 0:e.setDirty()}}))],oA.prototype,"showResult",void 0),pS([Ao("Make CSG Brush",c=>({hidden:()=>{var e,i;const s=(i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(Uo))===null||i===void 0?void 0:i.getSelectedObject();return!(s!=null&&s.userData)||!!s.userData.csgBrush||s.userData._isCSGMesh}}))],oA.prototype,"makeSelectedCSGBrush",null),pS([Jr("Enabled",c=>({hidden:()=>{var e,i;const s=(i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(Uo))===null||i===void 0?void 0:i.getSelectedObject();return!s||!s.userData.csgBrush},onChange:c._updateSelectedProperties}))],oA.prototype,"csgSelectedEnabled",void 0),pS([vu("Operation",DD.map(c=>({label:c})),c=>({hidden:()=>{var e,i;const s=(i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(Uo))===null||i===void 0?void 0:i.getSelectedObject();return!s||!s.userData.csgBrush},onChange:c._updateSelectedProperties}))],oA.prototype,"csgSelectedOperation",void 0),pS([Ao("Refresh CSG")],oA.prototype,"refreshCSG",null),pS([Ao("Export Result",c=>({hidden:()=>{var e;return!(!((e=c._viewer)===null||e===void 0)&&e.getPluginByType("AssetExporterPlugin"))}}))],oA.prototype,"downloadObject",null);function W3(c,e){let i=new Iu;const s=c.map(h=>h[0].material).flatMap(h=>h);c.forEach(([h,f])=>{if(!DD.includes(f))return void console.error(`Unknown operation ${f}`);h.updateMatrix(),h.updateMatrixWorld();const k=h.matrix;h.matrix=h.matrixWorld;let et=0;et=Array.isArray(h.material)?void 0:s.indexOf(h.material),i=i[f](Iu.fromMesh(h,et)),h.matrix=k});const a=i.toMesh(e??new d.yGw().identity(),s);return a.userData._isCSGMesh=!0,a.geometry.groups=a.geometry.groups.filter(h=>h.count>0),a}let y2=class extends oA{_buildCSGMesh(c){return W3(c)}};y2.PluginType="CSGPluginBSP",y2=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f}([Ws("CSG Plugin (BSP)")],y2);class aA{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,i){let s=1/0,a=-1/0;for(let h=0,f=e.length;h<f;h++){const k=e[h][i];s=k<s?k:s,a=k>a?k:a}this.min=s,this.max=a}setFromPoints(e,i){let s=1/0,a=-1/0;for(let h=0,f=i.length;h<f;h++){const k=i[h],et=e.dot(k);s=et<s?et:s,a=et>a?et:a}this.min=s,this.max=a}isSeparated(e){return this.min>e.max||e.min>this.max}}aA.prototype.setFromBox=function(){const c=new d.Pa4;return function(e,i){const s=i.min,a=i.max;let h=1/0,f=-1/0;for(let k=0;k<=1;k++)for(let et=0;et<=1;et++)for(let tt=0;tt<=1;tt++){c.x=s.x*k+a.x*(1-k),c.y=s.y*et+a.y*(1-et),c.z=s.z*tt+a.z*(1-tt);const rt=e.dot(c);h=Math.min(rt,h),f=Math.max(rt,f)}this.min=h,this.max=f}}();const SN=function(){const c=new d.Pa4,e=new d.Pa4,i=new d.Pa4;return function(s,a,h){const f=s.start,k=c,et=a.start,tt=e;i.subVectors(f,et),c.subVectors(s.end,a.start),e.subVectors(a.end,a.start);const rt=i.dot(tt),lt=tt.dot(k),pt=tt.dot(tt),ft=i.dot(k),vt=k.dot(k)*pt-lt*lt;let yt,Mt;yt=vt!==0?(rt*lt-ft*pt)/vt:0,Mt=(rt+yt*lt)/pt,h.x=yt,h.y=Mt}}(),RD=function(){const c=new d.FM8,e=new d.Pa4,i=new d.Pa4;return function(s,a,h,f){SN(s,a,c);let k=c.x,et=c.y;if(k>=0&&k<=1&&et>=0&&et<=1)return s.at(k,h),void a.at(et,f);if(k>=0&&k<=1)return et<0?a.at(0,f):a.at(1,f),void s.closestPointToPoint(f,!0,h);if(et>=0&&et<=1)return k<0?s.at(0,h):s.at(1,h),void a.closestPointToPoint(h,!0,f);{let tt,rt;tt=k<0?s.start:s.end,rt=et<0?a.start:a.end;const lt=e,pt=i;return s.closestPointToPoint(rt,!0,e),a.closestPointToPoint(tt,!0,i),lt.distanceToSquared(rt)<=pt.distanceToSquared(tt)?(h.copy(lt),void f.copy(rt)):(h.copy(tt),void f.copy(pt))}}}(),CN=function(){const c=new d.Pa4,e=new d.Pa4,i=new d.JOQ,s=new d.Zzh;return function(a,h){const{radius:f,center:k}=a,{a:et,b:tt,c:rt}=h;if(s.start=et,s.end=tt,s.closestPointToPoint(k,!0,c).distanceTo(k)<=f||(s.start=et,s.end=rt,s.closestPointToPoint(k,!0,c).distanceTo(k)<=f)||(s.start=tt,s.end=rt,s.closestPointToPoint(k,!0,c).distanceTo(k)<=f))return!0;const lt=h.getPlane(i);if(Math.abs(lt.distanceToPoint(k))<=f){const pt=lt.projectPoint(k,e);if(h.containsPoint(pt))return!0}return!1}}();function fS(c){return Math.abs(c)<1e-15}class gy extends d.CJI{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new d.Pa4),this.satBounds=new Array(4).fill().map(()=>new aA),this.points=[this.a,this.b,this.c],this.sphere=new d.aLr,this.plane=new d.JOQ,this.needsUpdate=!0}intersectsSphere(e){return CN(e,this)}update(){const e=this.a,i=this.b,s=this.c,a=this.points,h=this.satAxes,f=this.satBounds,k=h[0],et=f[0];this.getNormal(k),et.setFromPoints(k,a);const tt=h[1],rt=f[1];tt.subVectors(e,i),rt.setFromPoints(tt,a);const lt=h[2],pt=f[2];lt.subVectors(i,s),pt.setFromPoints(lt,a);const ft=h[3],vt=f[3];ft.subVectors(s,e),vt.setFromPoints(ft,a),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(k,e),this.needsUpdate=!1}}gy.prototype.closestPointToSegment=function(){const c=new d.Pa4,e=new d.Pa4,i=new d.Zzh;return function(s,a=null,h=null){const{start:f,end:k}=s,et=this.points;let tt,rt=1/0;for(let lt=0;lt<3;lt++){const pt=(lt+1)%3;i.start.copy(et[lt]),i.end.copy(et[pt]),RD(i,s,c,e),tt=c.distanceToSquared(e),tt<rt&&(rt=tt,a&&a.copy(c),h&&h.copy(e))}return this.closestPointToPoint(f,c),tt=f.distanceToSquared(c),tt<rt&&(rt=tt,a&&a.copy(c),h&&h.copy(f)),this.closestPointToPoint(k,c),tt=k.distanceToSquared(c),tt<rt&&(rt=tt,a&&a.copy(c),h&&h.copy(k)),Math.sqrt(rt)}}(),gy.prototype.intersectsTriangle=function(){const c=new gy,e=new Array(3),i=new Array(3),s=new aA,a=new aA,h=new d.Pa4,f=new d.Pa4,k=new d.Pa4,et=new d.Pa4,tt=new d.Zzh,rt=new d.Zzh,lt=new d.Zzh;return function(pt,ft=null){this.needsUpdate&&this.update(),pt.isExtendedTriangle?pt.needsUpdate&&pt.update():(c.copy(pt),c.update(),pt=c);const vt=this.plane,yt=pt.plane;if(Math.abs(vt.normal.dot(yt.normal))>1-1e-10){const Mt=this.satBounds,xt=this.satAxes;i[0]=pt.a,i[1]=pt.b,i[2]=pt.c;for(let Rt=0;Rt<4;Rt++){const Bt=Mt[Rt],Qt=xt[Rt];if(s.setFromPoints(Qt,i),Bt.isSeparated(s))return!1}const Et=pt.satBounds,At=pt.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let Rt=0;Rt<4;Rt++){const Bt=Et[Rt],Qt=At[Rt];if(s.setFromPoints(Qt,e),Bt.isSeparated(s))return!1}for(let Rt=0;Rt<4;Rt++){const Bt=xt[Rt];for(let Qt=0;Qt<4;Qt++){const Wt=At[Qt];if(h.crossVectors(Bt,Wt),s.setFromPoints(h,e),a.setFromPoints(h,i),s.isSeparated(a))return!1}}return ft&&(console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),ft.start.set(0,0,0),ft.end.set(0,0,0)),!0}{const Mt=this.points;let xt=!1,Et=0;for(let wn=0;wn<3;wn++){const In=Mt[wn],xn=Mt[(wn+1)%3];tt.start.copy(In),tt.end.copy(xn),tt.delta(f);const Cn=xt?rt.start:rt.end,Fn=fS(yt.distanceToPoint(In));if(fS(yt.normal.dot(f))&&Fn){rt.copy(tt),Et=2;break}if((yt.intersectLine(tt,Cn)||Fn)&&!fS(Cn.distanceTo(xn))){if(Et++,xt)break;xt=!0}}if(Et===1&&this.containsPoint(rt.start))return ft&&(ft.start.copy(rt.start),ft.end.copy(rt.start)),!0;if(Et!==2)return!1;const At=pt.points;let Rt=!1,Bt=0;for(let wn=0;wn<3;wn++){const In=At[wn],xn=At[(wn+1)%3];tt.start.copy(In),tt.end.copy(xn),tt.delta(k);const Cn=Rt?lt.start:lt.end,Fn=fS(vt.distanceToPoint(In));if(fS(vt.normal.dot(k))&&Fn){lt.copy(tt),Bt=2;break}if((vt.intersectLine(tt,Cn)||Fn)&&!fS(Cn.distanceTo(xn))){if(Bt++,Rt)break;Rt=!0}}if(Bt===1&&this.containsPoint(lt.start))return ft&&(ft.start.copy(lt.start),ft.end.copy(lt.start)),!0;if(Bt!==2)return!1;if(rt.delta(f),lt.delta(k),f.dot(k)<0){let wn=lt.start;lt.start=lt.end,lt.end=wn}const Qt=rt.start.dot(f),Wt=rt.end.dot(f),tn=lt.start.dot(f),pn=lt.end.dot(f),yn=Wt<tn,En=Qt<pn;return(Qt===pn||tn===Wt||yn!==En)&&(ft&&(et.subVectors(rt.start,lt.start),et.dot(f)>0?ft.start.copy(rt.start):ft.start.copy(lt.start),et.subVectors(rt.end,lt.end),et.dot(f)<0?ft.end.copy(rt.end):ft.end.copy(lt.end)),!0)}}}(),gy.prototype.distanceToPoint=function(){const c=new d.Pa4;return function(e){return this.closestPointToPoint(e,c),e.distanceTo(c)}}(),gy.prototype.distanceToTriangle=function(){const c=new d.Pa4,e=new d.Pa4,i=["a","b","c"],s=new d.Zzh,a=new d.Zzh;return function(h,f=null,k=null){const et=f||k?s:null;if(this.intersectsTriangle(h,et))return(f||k)&&(f&&et.getCenter(f),k&&et.getCenter(k)),0;let tt=1/0;for(let rt=0;rt<3;rt++){let lt;const pt=i[rt],ft=h[pt];this.closestPointToPoint(ft,c),lt=ft.distanceToSquared(c),lt<tt&&(tt=lt,f&&f.copy(c),k&&k.copy(ft));const vt=this[pt];h.closestPointToPoint(vt,c),lt=vt.distanceToSquared(c),lt<tt&&(tt=lt,f&&f.copy(vt),k&&k.copy(c))}for(let rt=0;rt<3;rt++){const lt=i[rt],pt=i[(rt+1)%3];s.set(this[lt],this[pt]);for(let ft=0;ft<3;ft++){const vt=i[ft],yt=i[(ft+1)%3];a.set(h[vt],h[yt]),RD(s,a,c,e);const Mt=c.distanceToSquared(e);Mt<tt&&(tt=Mt,f&&f.copy(c),k&&k.copy(e))}}return Math.sqrt(tt)}}();class q3{constructor(){this.intersectionSet={},this.ids=[]}add(e,i){const{intersectionSet:s,ids:a}=this;s[e]||(s[e]=[],a.push(e)),s[e].push(i)}}const u1=new d.zHn,Y3=new d.yGw,Um=new d.CJI,lA=new d.Pa4,X3=new d.Ltg,K3=new d.Ltg,$3=new d.Ltg,kD=new d.Ltg,A2=new d.Ltg,w2=new d.Ltg,BD=new d.Zzh,OD=1e-8;let x2=null;function J3(c){x2=c}function Z3(c,e){function i(){return Math.random()-.5}u1.origin.copy(c.a).add(c.b).add(c.c).multiplyScalar(1/3),c.getNormal(u1.direction);let s=0,a=1/0;for(let h=0;h<3;h++){u1.direction.x+=i()*OD,u1.direction.y+=i()*OD,u1.direction.z+=i()*OD;const f=e.raycastFirst(u1,d.ehD);if(f&&u1.direction.dot(f.face.normal)>0&&s++,f!==null&&(a=Math.min(a,f.distance)),a===0||s/3>.5||(h-s+1)/3>.5)break}return a===0?0:s/3>.5?-1:1}function eO(c,e,i,s,a,h,f=!1){const k=i.attributes,et=i.index,tt=3*c,rt=et.getX(tt+0),lt=et.getX(tt+1),pt=et.getX(tt+2);for(const ft in h){const vt=k[ft],yt=h[ft];if(!(ft in k))throw new Error(`CSG Operations: Attribute ${ft} not available on geometry.`);const Mt=vt.itemSize;ft==="position"?(Um.a.fromBufferAttribute(vt,rt).applyMatrix4(s),Um.b.fromBufferAttribute(vt,lt).applyMatrix4(s),Um.c.fromBufferAttribute(vt,pt).applyMatrix4(s),LD(Um.a,Um.b,Um.c,e,3,yt,f)):ft==="normal"?(Um.a.fromBufferAttribute(vt,rt).applyNormalMatrix(a),Um.b.fromBufferAttribute(vt,lt).applyNormalMatrix(a),Um.c.fromBufferAttribute(vt,pt).applyNormalMatrix(a),f&&(Um.a.multiplyScalar(-1),Um.b.multiplyScalar(-1),Um.c.multiplyScalar(-1)),LD(Um.a,Um.b,Um.c,e,3,yt,f,!0)):(X3.fromBufferAttribute(vt,rt),K3.fromBufferAttribute(vt,lt),$3.fromBufferAttribute(vt,pt),LD(X3,K3,$3,e,Mt,yt,f))}}function tO(c,e,i,s,a,h,f,k=!1){ND(c,s,a,h,f,k),ND(e,s,a,h,f,k),ND(i,s,a,h,f,k)}function nO(c,e,i=!1){switch(c){case 0:if(e===1||e===0&&i)return 1;break;case 1:if(i){if(e===-1)return 0}else if(e===1)return 1;break;case 3:if(e===-1)return 0;if(e===1)return 1;case 4:if(e===-1||e===0&&i)return 1;break;default:throw new Error(`Unrecognized CSG operation enum "${c}".`)}return 2}function LD(c,e,i,s,a,h,f=!1,k=!1){const et=tt=>{h.push(tt.x),a>1&&h.push(tt.y),a>2&&h.push(tt.z),a>3&&h.push(tt.w)};kD.set(0,0,0,0).addScaledVector(c,s.a.x).addScaledVector(e,s.a.y).addScaledVector(i,s.a.z),A2.set(0,0,0,0).addScaledVector(c,s.b.x).addScaledVector(e,s.b.y).addScaledVector(i,s.b.z),w2.set(0,0,0,0).addScaledVector(c,s.c.x).addScaledVector(e,s.c.y).addScaledVector(i,s.c.z),k&&(kD.normalize(),A2.normalize(),w2.normalize()),et(kD),f?(et(w2),et(A2)):(et(A2),et(w2))}function ND(c,e,i,s,a,h=!1){for(const f in a){const k=e[f],et=a[f];if(!(f in e))throw new Error(`CSG Operations: Attribute ${f} no available on geometry.`);const tt=k.itemSize;f==="position"?(lA.fromBufferAttribute(k,c).applyMatrix4(i),et.push(lA.x,lA.y,lA.z)):f==="normal"?(lA.fromBufferAttribute(k,c).applyNormalMatrix(s),h&&lA.multiplyScalar(-1),et.push(lA.x,lA.y,lA.z)):(et.push(k.getX(c)),tt>1&&et.push(k.getY(c)),tt>2&&et.push(k.getZ(c)),tt>3&&et.push(k.getW(c)))}}const xw=1e-14,b2=1e-7,vy=new d.Zzh,Wu=new d.Zzh,_0=new d.Pa4,rO=new d.Pa4,gM=new d.JOQ,MN=new gy;function vM(c){return c.a.distanceToSquared(c.b)<xw||c.a.distanceToSquared(c.c)<xw||c.b.distanceToSquared(c.c)<xw}class TN extends d.CJI{constructor(...e){super(...e),this.side=null,this.originalSide=null,this.coplanarCount=0}init(){this.side=null,this.originalSide=null,this.coplanarCount=0}initFrom(e){this.side=e.side,this.originalSide=e.originalSide,this.coplanarCount=e.coplanarCount}updateSide(e,i=null,s=-1){if(this.originalSide!==null&&this.side===null)return;_0.copy(this.a).add(this.b).add(this.c).multiplyScalar(1/3);const a=e.distanceToPoint(_0)<0?-1:1;i&&s!==-1?a===1&&(this.coplanarCount++,this.coplanarCount===3&&(this.side=0)):(this.originalSide===null&&(this.originalSide=a,this.side=a),a!==this.side&&(this.side=null))}}class IN{constructor(){this._pool=[],this._index=0}getTriangle(){this._index>=this._pool.length&&this._pool.push(new TN);const e=this._pool[this._index++];return e.init(),e}clear(){this._index=0}reset(){this._pool.length=0,this._index=0}}class PN{constructor(){this.trianglePool=new IN,this.triangles=[],this.normal=new d.Pa4}initialize(e){const{triangles:i,trianglePool:s,normal:a}=this;if(i.length=0,s.clear(),Array.isArray(e))for(let h=0,f=e.length;h<f;h++){const k=e[h];if(h===0)k.getNormal(a);else if(Math.abs(1-k.getNormal(_0).dot(a))>xw)throw new Error("Triangle Splitter: Cannot initialize with triangles that have different normals.");const et=s.getTriangle();et.copy(k),i.push(et)}else{e.getNormal(a);const h=s.getTriangle();h.copy(e),i.push(h)}}splitByTriangle(e){const{normal:i,triangles:s}=this;if(e.getPlane(gM),Math.abs(1-Math.abs(gM.normal.dot(i)))<b2){const a=[e.a,e.b,e.c];for(let h=0;h<3;h++){const f=(h+1)%3,k=a[h],et=a[f];_0.subVectors(et,k).normalize(),rO.crossVectors(i,_0),gM.setFromNormalAndCoplanarPoint(rO,k),this.splitByPlane(gM,e,h)}for(let h=0,f=s.length;h<f;h++)s[h].coplanarCount=0}else this.splitByPlane(gM,e)}splitByPlane(e,i=null,s=-1){const{triangles:a,trianglePool:h}=this;let f=null;i!==null&&(f=MN,f.copy(i),f.needsUpdate=!0);for(let k=0,et=a.length;k<et;k++){const tt=a[k],{a:rt,b:lt,c:pt}=tt;if(f&&(!f.intersectsTriangle(tt,vy)||vy.distance()<1e-5)){tt.updateSide(e,f,s),tt.side=null;continue}let ft=0,vt=-1,yt=0,Mt=0,xt=!1;const Et=[rt,lt,pt];for(let At=0;At<3;At++){const Rt=(At+1)%3;vy.start.copy(Et[At]),vy.end.copy(Et[Rt]);const Bt=e.distanceToPoint(vy.start),Qt=e.distanceToPoint(vy.end);Math.abs(Bt)<xw?Mt++:Bt>0&&yt++,Math.abs(Bt)<b2&&Math.abs(Qt)<b2&&(xt=!0);let Wt=!!e.intersectLine(vy,_0);!Wt&&Math.abs(Qt)<xw&&(_0.copy(vy.end),Wt=!0),!Wt||_0.distanceTo(vy.start)<xw||(_0.distanceTo(vy.end)<xw&&(vt=At),ft===0?Wu.start.copy(_0):Wu.end.copy(_0),ft++)}if(!xt&&Mt<2&&ft===2&&Wu.distance()>b2)if(vt!==-1){vt=(vt+1)%3;let At=0;At===vt&&(At=(At+1)%3);let Rt=At+1;Rt===vt&&(Rt=(Rt+1)%3);const Bt=h.getTriangle();Bt.a.copy(Et[Rt]),Bt.b.copy(Wu.end),Bt.c.copy(Wu.start),vM(Bt)||(a.push(Bt),Bt.initFrom(tt),Bt.updateSide(e,f,s)),tt.a.copy(Et[At]),tt.b.copy(Wu.start),tt.c.copy(Wu.end),vM(tt)?(a.splice(k,1),k--,et--):tt.updateSide(e,f,s)}else{const At=Et.findIndex(tn=>yt>=2?e.distanceToPoint(tn)<0:e.distanceToPoint(tn)>0);if(At===0){let tn=Wu.start;Wu.start=Wu.end,Wu.end=tn}else if(At===-1)continue;const Rt=(At+1)%3,Bt=(At+2)%3,Qt=h.getTriangle(),Wt=h.getTriangle();Et[Rt].distanceToSquared(Wu.start)<Et[Bt].distanceToSquared(Wu.end)?(Qt.a.copy(Et[Rt]),Qt.b.copy(Wu.start),Qt.c.copy(Wu.end),Wt.a.copy(Et[Rt]),Wt.b.copy(Et[Bt]),Wt.c.copy(Wu.start)):(Qt.a.copy(Et[Bt]),Qt.b.copy(Wu.start),Qt.c.copy(Wu.end),Wt.a.copy(Et[Rt]),Wt.b.copy(Et[Bt]),Wt.c.copy(Wu.end)),tt.a.copy(Et[At]),tt.b.copy(Wu.end),tt.c.copy(Wu.start),vM(Qt)||(a.push(Qt),Qt.initFrom(tt),Qt.updateSide(e,f,s)),vM(Wt)||(a.push(Wt),Wt.initFrom(tt),Wt.updateSide(e,f,s)),vM(tt)?(a.splice(k,1),k--,et--):tt.updateSide(e,f,s)}else ft===3&&console.warn("TriangleClipper: Coplanar clip not handled")}}reset(){this.triangles.length=0}}function iO(){return typeof SharedArrayBuffer<"u"}function DN(c){if(c.buffer instanceof SharedArrayBuffer)return c;const e=c.constructor,i=c.buffer,s=new SharedArrayBuffer(i.byteLength),a=new Uint8Array(i);return new Uint8Array(s).set(a,0),new e(s)}class sO{constructor(e,i=500){const s=iO()?SharedArrayBuffer:ArrayBuffer;this.expansionFactor=1.5,this.type=e,this.array=new e(new s(i*e.BYTES_PER_ELEMENT)),this.length=0}expand(e=null){const{type:i,array:s,expansionFactor:a}=this;e===null&&(e=~~(s.length*a));const h=new i(e);h.set(s,0),this.array=h}push(...e){let{array:i,length:s}=this;s+e.length>i.length&&(this.expand(),i=this.array);for(let a=0,h=e.length;a<h;a++)i[s+a]=e[a];this.length+=e.length}clear(){this.length=0}}class RN{constructor(){this.groupAttributes=[{}],this.groupCount=0}getType(e){return this.groupAttributes[0][e].type}getTotalLength(e){const{groupCount:i,groupAttributes:s}=this;let a=0;for(let h=0;h<i;h++)a+=s[h][e].length;return a}getGroupSet(e=0){const{groupAttributes:i}=this;if(i[e])return this.groupCount=Math.max(this.groupCount,e+1),i[e];const s=i[0];for(this.groupCount=Math.max(this.groupCount,e+1);e>=i.length;){const a={};i.push(a);for(const h in s)a[h]=new sO(s[h].type)}return i[e]}getGroupArray(e,i=0){const{groupAttributes:s}=this;if(!s[0][e])throw new Error(`TypedAttributeData: Attribute with "${e}" has not been initialized`);return this.getGroupSet(i)[e]}initializeArray(e,i){const{groupAttributes:s}=this,a=s[0][e];if(a){if(a.type!==i)throw new Error(`TypedAttributeData: Array ${e} already initialized with a different type.`)}else for(let h=0,f=s.length;h<f;h++)s[h][e]=new sO(i)}clear(){this.groupCount=0;const{groupAttributes:e}=this;e.forEach(i=>{for(const s in i)i[s].clear()})}delete(e){this.groupAttributes.forEach(i=>{delete i[e]})}reset(){this.groupAttributes=[]}}class kN{constructor(e){this.triangle=new d.CJI().copy(e),this.intersects={}}addTriangle(e,i){this.intersects[e]=new d.CJI().copy(i)}getIntersectArray(){const e=[],{intersects:i}=this;for(const s in i)e.push(i[s]);return e}}class oO{constructor(){this.data={}}addTriangleIntersection(e,i,s,a){const{data:h}=this;h[e]||(h[e]=new kN(i)),h[e].addTriangle(s,a)}getTrianglesAsArray(e=null){const{data:i}=this,s=[];if(e!==null)e in i&&s.push(i[e].triangle);else for(const a in i)s.push(i[a].triangle);return s}getTriangleIndices(){return Object.keys(this.data).map(e=>parseInt(e))}getIntersectionIndices(e){const{data:i}=this;return i[e]?Object.keys(i[e].intersects).map(s=>parseInt(s)):[]}getIntersectionsAsArray(e=null,i=null){const{data:s}=this,a=new Set,h=[],f=k=>{if(s[k])if(i!==null)s[k].intersects[i]&&h.push(s[k].intersects[i]);else{const et=s[k].intersects;for(const tt in et)a.has(tt)||(a.add(tt),h.push(et[tt]))}};if(e!==null)f(e);else for(const k in s)f(k);return h}reset(){this.data={}}}class BN{constructor(){this.enabled=!1,this.triangleIntersectsA=new oO,this.triangleIntersectsB=new oO,this.intersectionEdges=[]}addIntersectingTriangles(e,i,s,a){const{triangleIntersectsA:h,triangleIntersectsB:f}=this;h.addTriangleIntersection(e,i,s,a),f.addTriangleIntersection(s,a,e,i)}addEdge(e){this.intersectionEdges.push(e.clone())}reset(){this.triangleIntersectsA.reset(),this.triangleIntersectsB.reset(),this.intersectionEdges=[]}}const bw=new d.yGw,mS=new d.Vkp,h1=new d.CJI,E2=new d.CJI,S2=new d.CJI,_M=new d.CJI;function ON(c){for(const e of c)return e}function aO(c,e,i,s,a,h,f,k=0){bw.copy(e.matrixWorld).invert().multiply(c.matrixWorld),mS.getNormalMatrix(c.matrixWorld);const et=c.geometry.groupIndices,tt=c.geometry.index,rt=c.geometry.attributes.position,lt=e.geometry.boundsTree,pt=e.geometry.index,ft=e.geometry.attributes.position,vt=i.ids,yt=i.intersectionSet;for(let Mt=0,xt=vt.length;Mt<xt;Mt++){const Et=vt[Mt],At=k===-1?0:et[Et]+k,Rt=f.getGroupSet(At),Bt=3*Et,Qt=tt.getX(Bt+0),Wt=tt.getX(Bt+1),tn=tt.getX(Bt+2);h1.a.fromBufferAttribute(rt,Qt).applyMatrix4(bw),h1.b.fromBufferAttribute(rt,Wt).applyMatrix4(bw),h1.c.fromBufferAttribute(rt,tn).applyMatrix4(bw),h.initialize(h1);const pn=yt[Et];for(let En=0,wn=pn.length;En<wn;En++){const In=3*pn[En],xn=pt.getX(In+0),Cn=pt.getX(In+1),Fn=pt.getX(In+2);E2.a.fromBufferAttribute(ft,xn),E2.b.fromBufferAttribute(ft,Cn),E2.c.fromBufferAttribute(ft,Fn),h.splitByTriangle(E2)}const yn=h.triangles;for(let En=0,wn=yn.length;En<wn;En++){const In=yn[En],xn=nO(s,Z3(In,lt),a);if(xn!==2)switch(h1.getBarycoord(In.a,_M.a),h1.getBarycoord(In.b,_M.b),h1.getBarycoord(In.c,_M.c),xn){case 1:eO(Et,_M,c.geometry,c.matrixWorld,mS,Rt);break;case 0:eO(Et,_M,c.geometry,c.matrixWorld,mS,Rt,!0)}}}return vt.length}function lO(c,e,i,s,a,h,f=0){bw.copy(e.matrixWorld).invert().multiply(c.matrixWorld),mS.getNormalMatrix(c.matrixWorld);const k=e.geometry.boundsTree,et=c.geometry.groupIndices,tt=c.geometry.index,rt=c.geometry.attributes,lt=rt.position,pt=[],ft=c.geometry.halfEdges,vt=new Set;for(let yt=0,Mt=tt.count/3;yt<Mt;yt++)yt in i.intersectionSet||vt.add(yt);for(;vt.size>0;){const yt=ON(vt);vt.delete(yt),pt.push(yt);const Mt=3*yt,xt=tt.getX(Mt+0),Et=tt.getX(Mt+1),At=tt.getX(Mt+2);S2.a.fromBufferAttribute(lt,xt).applyMatrix4(bw),S2.b.fromBufferAttribute(lt,Et).applyMatrix4(bw),S2.c.fromBufferAttribute(lt,At).applyMatrix4(bw);const Rt=nO(s,Z3(S2,k),a);for(;pt.length>0;){const Bt=pt.pop(),Qt=f===-1?0:et[Bt]+f,Wt=h.getGroupSet(Qt);for(let wn=0;wn<3;wn++){const In=ft.getSiblingTriangleIndex(Bt,wn);In!==-1&&vt.has(In)&&(pt.push(In),vt.delete(In))}const tn=3*Bt,pn=tt.getX(tn+0),yn=tt.getX(tn+1),En=tt.getX(tn+2);switch(Rt){case 1:tO(pn,yn,En,rt,c.matrixWorld,mS,Wt);break;case 0:tO(En,yn,pn,rt,c.matrixWorld,mS,Wt,a)}}}}const FD=1.25,UD=65535,LN=Math.pow(2,-24);class C2{constructor(){}}function _y(c,e,i){return i.min.x=e[c],i.min.y=e[c+1],i.min.z=e[c+2],i.max.x=e[c+3],i.max.y=e[c+4],i.max.z=e[c+5],i}function cO(c){let e=-1,i=-1/0;for(let s=0;s<3;s++){const a=c[s+3]-c[s];a>i&&(i=a,e=s)}return e}function uO(c,e){e.set(c)}function hO(c,e,i){let s,a;for(let h=0;h<3;h++){const f=h+3;s=c[h],a=e[h],i[h]=s<a?s:a,s=c[f],a=e[f],i[f]=s>a?s:a}}function M2(c,e,i){for(let s=0;s<3;s++){const a=e[c+2*s],h=e[c+2*s+1],f=a-h,k=a+h;f<i[s]&&(i[s]=f),k>i[s+3]&&(i[s+3]=k)}}function yM(c){const e=c[3]-c[0],i=c[4]-c[1],s=c[5]-c[2];return 2*(e*i+i*s+s*e)}function jD(c,e,i,s,a=null){let h=1/0,f=1/0,k=1/0,et=-1/0,tt=-1/0,rt=-1/0,lt=1/0,pt=1/0,ft=1/0,vt=-1/0,yt=-1/0,Mt=-1/0;const xt=a!==null;for(let Et=6*e,At=6*(e+i);Et<At;Et+=6){const Rt=c[Et+0],Bt=c[Et+1],Qt=Rt-Bt,Wt=Rt+Bt;Qt<h&&(h=Qt),Wt>et&&(et=Wt),xt&&Rt<lt&&(lt=Rt),xt&&Rt>vt&&(vt=Rt);const tn=c[Et+2],pn=c[Et+3],yn=tn-pn,En=tn+pn;yn<f&&(f=yn),En>tt&&(tt=En),xt&&tn<pt&&(pt=tn),xt&&tn>yt&&(yt=tn);const wn=c[Et+4],In=c[Et+5],xn=wn-In,Cn=wn+In;xn<k&&(k=xn),Cn>rt&&(rt=Cn),xt&&wn<ft&&(ft=wn),xt&&wn>Mt&&(Mt=wn)}s[0]=h,s[1]=f,s[2]=k,s[3]=et,s[4]=tt,s[5]=rt,xt&&(a[0]=lt,a[1]=pt,a[2]=ft,a[3]=vt,a[4]=yt,a[5]=Mt)}const NN=(c,e)=>c.candidate-e.candidate,Ew=new Array(32).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),T2=new Float32Array(6);class yy extends d.ZzF{constructor(...e){super(...e),this.isOrientedBox=!0,this.matrix=new d.yGw,this.invMatrix=new d.yGw,this.points=new Array(8).fill().map(()=>new d.Pa4),this.satAxes=new Array(3).fill().map(()=>new d.Pa4),this.satBounds=new Array(3).fill().map(()=>new aA),this.alignedSatBounds=new Array(3).fill().map(()=>new aA),this.needsUpdate=!1}set(e,i,s){super.set(e,i),this.matrix.copy(s),this.needsUpdate=!0}copy(e){super.copy(e),this.matrix.copy(e.matrix),this.needsUpdate=!0}}yy.prototype.update=function(){const c=this.matrix,e=this.min,i=this.max,s=this.points;for(let et=0;et<=1;et++)for(let tt=0;tt<=1;tt++)for(let rt=0;rt<=1;rt++){const lt=s[1*et|2*tt|4*rt];lt.x=et?i.x:e.x,lt.y=tt?i.y:e.y,lt.z=rt?i.z:e.z,lt.applyMatrix4(c)}const a=this.satBounds,h=this.satAxes,f=s[0];for(let et=0;et<3;et++){const tt=h[et],rt=a[et],lt=s[1<<et];tt.subVectors(f,lt),rt.setFromPoints(tt,s)}const k=this.alignedSatBounds;k[0].setFromPointsField(s,"x"),k[1].setFromPointsField(s,"y"),k[2].setFromPointsField(s,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},yy.prototype.intersectsBox=function(){const c=new aA;return function(e){this.needsUpdate&&this.update();const i=e.min,s=e.max,a=this.satBounds,h=this.satAxes,f=this.alignedSatBounds;if(c.min=i.x,c.max=s.x,f[0].isSeparated(c)||(c.min=i.y,c.max=s.y,f[1].isSeparated(c))||(c.min=i.z,c.max=s.z,f[2].isSeparated(c)))return!1;for(let k=0;k<3;k++){const et=h[k],tt=a[k];if(c.setFromBox(et,e),tt.isSeparated(c))return!1}return!0}}(),yy.prototype.intersectsTriangle=function(){const c=new gy,e=new Array(3),i=new aA,s=new aA,a=new d.Pa4;return function(h){this.needsUpdate&&this.update(),h.isExtendedTriangle?h.needsUpdate&&h.update():(c.copy(h),c.update(),h=c);const f=this.satBounds,k=this.satAxes;e[0]=h.a,e[1]=h.b,e[2]=h.c;for(let lt=0;lt<3;lt++){const pt=f[lt],ft=k[lt];if(i.setFromPoints(ft,e),pt.isSeparated(i))return!1}const et=h.satBounds,tt=h.satAxes,rt=this.points;for(let lt=0;lt<3;lt++){const pt=et[lt],ft=tt[lt];if(i.setFromPoints(ft,rt),pt.isSeparated(i))return!1}for(let lt=0;lt<3;lt++){const pt=k[lt];for(let ft=0;ft<4;ft++){const vt=tt[ft];if(a.crossVectors(pt,vt),i.setFromPoints(a,e),s.setFromPoints(a,rt),i.isSeparated(s))return!1}}return!0}}(),yy.prototype.closestPointToPoint=function(c,e){return this.needsUpdate&&this.update(),e.copy(c).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e},yy.prototype.distanceToPoint=function(){const c=new d.Pa4;return function(e){return this.closestPointToPoint(e,c),e.distanceTo(c)}}(),yy.prototype.distanceToBox=function(){const c=["x","y","z"],e=new Array(12).fill().map(()=>new d.Zzh),i=new Array(12).fill().map(()=>new d.Zzh),s=new d.Pa4,a=new d.Pa4;return function(h,f=0,k=null,et=null){if(this.needsUpdate&&this.update(),this.intersectsBox(h))return(k||et)&&(h.getCenter(a),this.closestPointToPoint(a,s),h.closestPointToPoint(s,a),k&&k.copy(s),et&&et.copy(a)),0;const tt=f*f,rt=h.min,lt=h.max,pt=this.points;let ft=1/0;for(let yt=0;yt<8;yt++){const Mt=pt[yt];a.copy(Mt).clamp(rt,lt);const xt=Mt.distanceToSquared(a);if(xt<ft&&(ft=xt,k&&k.copy(Mt),et&&et.copy(a),xt<tt))return Math.sqrt(xt)}let vt=0;for(let yt=0;yt<3;yt++)for(let Mt=0;Mt<=1;Mt++)for(let xt=0;xt<=1;xt++){const Et=(yt+1)%3,At=(yt+2)%3,Rt=1<<yt|Mt<<Et|xt<<At,Bt=pt[Mt<<Et|xt<<At],Qt=pt[Rt];e[vt].set(Bt,Qt);const Wt=c[yt],tn=c[Et],pn=c[At],yn=i[vt],En=yn.start,wn=yn.end;En[Wt]=rt[Wt],En[tn]=Mt?rt[tn]:lt[tn],En[pn]=xt?rt[pn]:lt[tn],wn[Wt]=lt[Wt],wn[tn]=Mt?rt[tn]:lt[tn],wn[pn]=xt?rt[pn]:lt[tn],vt++}for(let yt=0;yt<=1;yt++)for(let Mt=0;Mt<=1;Mt++)for(let xt=0;xt<=1;xt++){a.x=yt?lt.x:rt.x,a.y=Mt?lt.y:rt.y,a.z=xt?lt.z:rt.z,this.closestPointToPoint(a,s);const Et=a.distanceToSquared(s);if(Et<ft&&(ft=Et,k&&k.copy(s),et&&et.copy(a),Et<tt))return Math.sqrt(Et)}for(let yt=0;yt<12;yt++){const Mt=e[yt];for(let xt=0;xt<12;xt++){const Et=i[xt];RD(Mt,Et,s,a);const At=s.distanceToSquared(a);if(At<ft&&(ft=At,k&&k.copy(s),et&&et.copy(a),At<tt))return Math.sqrt(At)}}return Math.sqrt(ft)}}();const I2=new d.Pa4,P2=new d.Pa4,D2=new d.Pa4,dO=new d.FM8,pO=new d.FM8,fO=new d.FM8,mO=new d.Pa4;function gO(c,e,i,s,a){const h=3*s,f=c.index.getX(h),k=c.index.getX(h+1),et=c.index.getX(h+2),tt=function(rt,lt,pt,ft,vt,yt,Mt){I2.fromBufferAttribute(lt,ft),P2.fromBufferAttribute(lt,vt),D2.fromBufferAttribute(lt,yt);const xt=function(Et,At,Rt,Bt,Qt,Wt){let tn;return tn=Wt===d._Li?Et.intersectTriangle(Bt,Rt,At,!0,Qt):Et.intersectTriangle(At,Rt,Bt,Wt!==d.ehD,Qt),tn===null?null:{distance:Et.origin.distanceTo(Qt),point:Qt.clone()}}(rt,I2,P2,D2,mO,Mt);if(xt){pt&&(dO.fromBufferAttribute(pt,ft),pO.fromBufferAttribute(pt,vt),fO.fromBufferAttribute(pt,yt),xt.uv=d.CJI.getUV(mO,I2,P2,D2,dO,pO,fO,new d.FM8));const Et={a:ft,b:vt,c:yt,normal:new d.Pa4,materialIndex:0};d.CJI.getNormal(I2,P2,D2,Et.normal),xt.face=Et,xt.faceIndex=ft}return xt}(i,c.attributes.position,c.attributes.uv,f,k,et,e);return tt?(tt.faceIndex=s,a&&a.push(tt),tt):null}function vO(c,e,i){return c===null?null:(c.point.applyMatrix4(e.matrixWorld),c.distance=c.point.distanceTo(i.ray.origin),c.object=e,c.distance<i.near||c.distance>i.far?null:c)}function Ay(c,e,i,s){const a=c.a,h=c.b,f=c.c;let k=e,et=e+1,tt=e+2;i&&(k=i.getX(e),et=i.getX(e+1),tt=i.getX(e+2)),a.x=s.getX(k),a.y=s.getY(k),a.z=s.getZ(k),h.x=s.getX(et),h.y=s.getY(et),h.z=s.getZ(et),f.x=s.getX(tt),f.y=s.getY(tt),f.z=s.getZ(tt)}function _O(c,e,i,s,a,h,f){const k=i.index,et=i.attributes.position;for(let tt=c,rt=e+c;tt<rt;tt++)if(Ay(f,3*tt,k,et),f.needsUpdate=!0,s(f,tt,a,h))return!0;return!1}class yO{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}function Sw(c,e){return e[c+15]===65535}function gS(c,e){return e[c+6]}function AM(c,e){return e[c+14]}function wM(c){return c+8}function xM(c,e){return e[c+6]}const vS=new d.ZzF,R2=new d.Pa4,FN=["x","y","z"];function zD(c,e,i,s,a){let h=2*c,f=_S,k=Cw,et=Mw;if(Sw(h,k))(function(tt,rt,lt,pt,ft,vt){for(let yt=pt,Mt=pt+ft;yt<Mt;yt++)gO(tt,rt,lt,yt,vt)})(e,i,s,gS(c,et),AM(h,k),a);else{const tt=wM(c);k2(tt,f,s,R2)&&zD(tt,e,i,s,a);const rt=xM(c,et);k2(rt,f,s,R2)&&zD(rt,e,i,s,a)}}function VD(c,e,i,s){let a=2*c,h=_S,f=Cw,k=Mw;if(Sw(a,f))return function(et,tt,rt,lt,pt){let ft=1/0,vt=null;for(let yt=lt,Mt=lt+pt;yt<Mt;yt++){const xt=gO(et,tt,rt,yt);xt&&xt.distance<ft&&(vt=xt,ft=xt.distance)}return vt}(e,i,s,gS(c,k),AM(a,f));{const et=function(yt,Mt){return Mt[yt+7]}(c,k),tt=FN[et],rt=s.direction[tt]>=0;let lt,pt;rt?(lt=wM(c),pt=xM(c,k)):(lt=xM(c,k),pt=wM(c));const ft=k2(lt,h,s,R2)?VD(lt,e,i,s):null;if(ft){const yt=ft.point[tt];if(rt?yt<=h[pt+et]:yt>=h[pt+et+3])return ft}const vt=k2(pt,h,s,R2)?VD(pt,e,i,s):null;return ft&&vt?ft.distance<=vt.distance?ft:vt:ft||vt||null}}const UN=function(){let c,e;const i=[],s=new yO(()=>new d.ZzF);return function(...h){c=s.getPrimitive(),e=s.getPrimitive(),i.push(c,e);const f=a(...h);s.releasePrimitive(c),s.releasePrimitive(e),i.pop(),i.pop();const k=i.length;return k>0&&(e=i[k-1],c=i[k-2]),f};function a(h,f,k,et,tt=null,rt=0,lt=0){function pt(Et){let At=2*Et,Rt=Cw,Bt=Mw;for(;!Sw(At,Rt);)At=2*(Et=wM(Et));return gS(Et,Bt)}function ft(Et){let At=2*Et,Rt=Cw,Bt=Mw;for(;!Sw(At,Rt);)At=2*(Et=xM(Et,Bt));return gS(Et,Bt)+AM(At,Rt)}let vt=2*h,yt=_S,Mt=Cw,xt=Mw;if(Sw(vt,Mt)){const Et=gS(h,xt),At=AM(vt,Mt);return _y(h,yt,c),et(Et,At,!1,lt,rt+h,c)}{const Et=wM(h),At=xM(h,xt);let Rt,Bt,Qt,Wt,tn=Et,pn=At;if(tt&&(Qt=c,Wt=e,_y(tn,yt,Qt),_y(pn,yt,Wt),Rt=tt(Qt),Bt=tt(Wt),Bt<Rt)){tn=At,pn=Et;const xn=Rt;Rt=Bt,Bt=xn,Qt=Wt}Qt||(Qt=c,_y(tn,yt,Qt));const yn=k(Qt,Sw(2*tn,Mt),Rt,lt+1,rt+tn);let En;if(yn===2){const xn=pt(tn);En=et(xn,ft(tn)-xn,!0,lt+1,rt+tn,Qt)}else En=yn&&a(tn,f,k,et,tt,rt,lt+1);if(En)return!0;Wt=e,_y(pn,yt,Wt);const wn=k(Wt,Sw(2*pn,Mt),Bt,lt+1,rt+pn);let In;if(wn===2){const xn=pt(pn);In=et(xn,ft(pn)-xn,!0,lt+1,rt+pn,Wt)}else In=wn&&a(pn,f,k,et,tt,rt,lt+1);return!!In}}}(),jN=function(){const c=new gy,e=new gy,i=new d.yGw,s=new yy,a=new yy;return function h(f,k,et,tt,rt=null){let lt=2*f,pt=_S,ft=Cw,vt=Mw;if(rt===null&&(et.boundingBox||et.computeBoundingBox(),s.set(et.boundingBox.min,et.boundingBox.max,tt),rt=s),!Sw(lt,ft)){const yt=f+8,Mt=vt[f+6];return _y(yt,pt,vS),rt.intersectsBox(vS)&&h(yt,k,et,tt,rt)?!0:(_y(Mt,pt,vS),!(!rt.intersectsBox(vS)||!h(Mt,k,et,tt,rt)))}{const yt=k,Mt=yt.index,xt=yt.attributes.position,Et=et.index,At=et.attributes.position,Rt=gS(f,vt),Bt=AM(lt,ft);if(i.copy(tt).invert(),et.boundsTree)return _y(f,pt,a),a.matrix.copy(i),a.needsUpdate=!0,et.boundsTree.shapecast({intersectsBounds:Wt=>a.intersectsBox(Wt),intersectsTriangle:Wt=>{Wt.a.applyMatrix4(tt),Wt.b.applyMatrix4(tt),Wt.c.applyMatrix4(tt),Wt.needsUpdate=!0;for(let tn=3*Rt,pn=3*(Bt+Rt);tn<pn;tn+=3)if(Ay(e,tn,Mt,xt),e.needsUpdate=!0,Wt.intersectsTriangle(e))return!0;return!1}});for(let Qt=3*Rt,Wt=Bt+3*Rt;Qt<Wt;Qt+=3){Ay(c,Qt,Mt,xt),c.a.applyMatrix4(i),c.b.applyMatrix4(i),c.c.applyMatrix4(i),c.needsUpdate=!0;for(let tn=0,pn=Et.count;tn<pn;tn+=3)if(Ay(e,tn,Et,At),e.needsUpdate=!0,c.intersectsTriangle(e))return!0}}}}();function k2(c,e,i,s){return _y(c,e,vS),i.intersectBox(vS,s)}const QD=[];let B2,_S,Cw,Mw;function bM(c){B2&&QD.push(B2),B2=c,_S=new Float32Array(c),Cw=new Uint16Array(c),Mw=new Uint32Array(c)}function O2(){B2=null,_S=null,Cw=null,Mw=null,QD.length&&bM(QD.pop())}const GD=Symbol("skip tree generation"),HD=new d.ZzF,WD=new d.ZzF,yS=new d.yGw,d1=new yy,EM=new yy,SM=new d.Pa4,L2=new d.Pa4,zN=new d.Pa4,VN=new d.Pa4,QN=new d.Pa4,AO=new d.ZzF,wy=new yO(()=>new gy);class Hp{static serialize(e,i={}){if(i.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),Hp.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0||arguments[2]});i={cloneBuffers:!0,...i};const s=e.geometry,a=e._roots,h=s.getIndex();let f;return f=i.cloneBuffers?{roots:a.map(k=>k.slice()),index:h.array.slice()}:{roots:a,index:h.array},f}static deserialize(e,i,s={}){if(typeof s=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),Hp.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0||arguments[2]});s={setIndex:!0,...s};const{index:a,roots:h}=e,f=new Hp(i,{...s,[GD]:!0});if(f._roots=h,s.setIndex){const k=i.getIndex();if(k===null){const et=new d.TlE(e.index,1,!1);i.setIndex(et)}else k.array!==a&&(k.array.set(a),k.needsUpdate=!0)}return f}constructor(e,i={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((i=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[GD]:!1},i)).useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,i[GD]||(this._roots=function(s,a){const h=function(ft,vt){function yt(xn){pn&&pn(xn/yn)}function Mt(xn,Cn,Fn,Tn=null,Wn=0){if(!En&&Wn>=Bt&&(En=!0,Qt&&(console.warn(`MeshBVH: Max depth of ${Bt} reached when generating BVH. Consider increasing maxDepth.`),console.warn(ft))),Fn<=Wt||Wn>=Bt)return yt(Cn+Fn),xn.offset=Cn,xn.count=Fn,xn;const or=function(rr,Ir,kr,Br,Ur,hs){let _r=-1,Ys=0;if(hs===0)_r=cO(Ir),_r!==-1&&(Ys=(Ir[_r]+Ir[_r+3])/2);else if(hs===1)_r=cO(rr),_r!==-1&&(Ys=function(po,Xs,ko,Jo){let cr=0;for(let Nr=Xs,Fr=Xs+ko;Nr<Fr;Nr++)cr+=po[6*Nr+2*Jo];return cr/ko}(kr,Br,Ur,_r));else if(hs===2){const po=yM(rr);let Xs=FD*Ur;const ko=6*Br,Jo=6*(Br+Ur);for(let cr=0;cr<3;cr++){const Nr=Ir[cr],Fr=(Ir[cr+3]-Nr)/32;if(Ur<8){const Ks=[...Ew];Ks.length=Ur;let Xo=0;for(let Nn=ko;Nn<Jo;Nn+=6,Xo++){const vn=Ks[Xo];vn.candidate=kr[Nn+2*cr],vn.count=0;const{bounds:Qn,leftCacheBounds:Zn,rightCacheBounds:Vn}=vn;for(let lr=0;lr<3;lr++)Vn[lr]=1/0,Vn[lr+3]=-1/0,Zn[lr]=1/0,Zn[lr+3]=-1/0,Qn[lr]=1/0,Qn[lr+3]=-1/0;M2(Nn,kr,Qn)}Ks.sort(NN);let mn=Ur;for(let Nn=0;Nn<mn;Nn++){const vn=Ks[Nn];for(;Nn+1<mn&&Ks[Nn+1].candidate===vn.candidate;)Ks.splice(Nn+1,1),mn--}for(let Nn=ko;Nn<Jo;Nn+=6){const vn=kr[Nn+2*cr];for(let Qn=0;Qn<mn;Qn++){const Zn=Ks[Qn];vn>=Zn.candidate?M2(Nn,kr,Zn.rightCacheBounds):(M2(Nn,kr,Zn.leftCacheBounds),Zn.count++)}}for(let Nn=0;Nn<mn;Nn++){const vn=Ks[Nn],Qn=vn.count,Zn=Ur-vn.count,Vn=vn.leftCacheBounds,lr=vn.rightCacheBounds;let Vr=0;Qn!==0&&(Vr=yM(Vn)/po);let es=0;Zn!==0&&(es=yM(lr)/po);const cs=1+FD*(Vr*Qn+es*Zn);cs<Xs&&(_r=cr,Xs=cs,Ys=vn.candidate)}}else{for(let mn=0;mn<32;mn++){const Nn=Ew[mn];Nn.count=0,Nn.candidate=Nr+Fr+mn*Fr;const vn=Nn.bounds;for(let Qn=0;Qn<3;Qn++)vn[Qn]=1/0,vn[Qn+3]=-1/0}for(let mn=ko;mn<Jo;mn+=6){let Nn=~~((kr[mn+2*cr]-Nr)/Fr);Nn>=32&&(Nn=31);const vn=Ew[Nn];vn.count++,M2(mn,kr,vn.bounds)}const Ks=Ew[31];uO(Ks.bounds,Ks.rightCacheBounds);for(let mn=30;mn>=0;mn--){const Nn=Ew[mn],vn=Ew[mn+1];hO(Nn.bounds,vn.rightCacheBounds,Nn.rightCacheBounds)}let Xo=0;for(let mn=0;mn<31;mn++){const Nn=Ew[mn],vn=Nn.count,Qn=Nn.bounds,Zn=Ew[mn+1].rightCacheBounds;vn!==0&&(Xo===0?uO(Qn,T2):hO(Qn,T2,T2)),Xo+=vn;let Vn=0,lr=0;Xo!==0&&(Vn=yM(T2)/po);const Vr=Ur-Xo;Vr!==0&&(lr=yM(Zn)/po);const es=1+FD*(Vn*Xo+lr*Vr);es<Xs&&(_r=cr,Xs=es,Ys=Nn.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${hs} used.`);return{axis:_r,pos:Ys}}(xn.boundingData,Tn,At,Cn,Fn,tn);if(or.axis===-1)return yt(Cn+Fn),xn.offset=Cn,xn.count=Fn,xn;const fr=function(rr,Ir,kr,Br,Ur){let hs=kr,_r=kr+Br-1;const Ys=Ur.pos,po=2*Ur.axis;for(;;){for(;hs<=_r&&Ir[6*hs+po]<Ys;)hs++;for(;hs<=_r&&Ir[6*_r+po]>=Ys;)_r--;if(!(hs<_r))return hs;for(let Xs=0;Xs<3;Xs++){let ko=rr[3*hs+Xs];rr[3*hs+Xs]=rr[3*_r+Xs],rr[3*_r+Xs]=ko;let Jo=Ir[6*hs+2*Xs+0];Ir[6*hs+2*Xs+0]=Ir[6*_r+2*Xs+0],Ir[6*_r+2*Xs+0]=Jo;let cr=Ir[6*hs+2*Xs+1];Ir[6*hs+2*Xs+1]=Ir[6*_r+2*Xs+1],Ir[6*_r+2*Xs+1]=cr}hs++,_r--}}(Rt,At,Cn,Fn,or);if(fr===Cn||fr===Cn+Fn)yt(Cn+Fn),xn.offset=Cn,xn.count=Fn;else{xn.splitAxis=or.axis;const rr=new C2,Ir=Cn,kr=fr-Cn;xn.left=rr,rr.boundingData=new Float32Array(6),jD(At,Ir,kr,rr.boundingData,Et),Mt(rr,Ir,kr,Et,Wn+1);const Br=new C2,Ur=fr,hs=Fn-kr;xn.right=Br,Br.boundingData=new Float32Array(6),jD(At,Ur,hs,Br.boundingData,Et),Mt(Br,Ur,hs,Et,Wn+1)}return xn}(function(xn,Cn){if(!xn.index){const Fn=xn.attributes.position.count,Tn=Cn.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;let Wn;Wn=Fn>65535?new Uint32Array(new Tn(4*Fn)):new Uint16Array(new Tn(2*Fn)),xn.setIndex(new d.TlE(Wn,1));for(let or=0;or<Fn;or++)Wn[or]=or}})(ft,vt);const xt=new Float32Array(6),Et=new Float32Array(6),At=function(xn,Cn){const Fn=xn.attributes.position,Tn=Fn.array,Wn=xn.index.array,or=Wn.length/3,fr=new Float32Array(6*or),rr=Fn.offset||0;let Ir=3;Fn.isInterleavedBufferAttribute&&(Ir=Fn.data.stride);for(let kr=0;kr<or;kr++){const Br=3*kr,Ur=6*kr,hs=Wn[Br+0]*Ir+rr,_r=Wn[Br+1]*Ir+rr,Ys=Wn[Br+2]*Ir+rr;for(let po=0;po<3;po++){const Xs=Tn[hs+po],ko=Tn[_r+po],Jo=Tn[Ys+po];let cr=Xs;ko<cr&&(cr=ko),Jo<cr&&(cr=Jo);let Nr=Xs;ko>Nr&&(Nr=ko),Jo>Nr&&(Nr=Jo);const Fr=(Nr-cr)/2,Ks=2*po;fr[Ur+Ks+0]=cr+Fr,fr[Ur+Ks+1]=Fr+(Math.abs(cr)+Fr)*LN,cr<Cn[po]&&(Cn[po]=cr),Nr>Cn[po+3]&&(Cn[po+3]=Nr)}}return fr}(ft,xt),Rt=ft.index.array,Bt=vt.maxDepth,Qt=vt.verbose,Wt=vt.maxLeafTris,tn=vt.strategy,pn=vt.onProgress,yn=ft.index.count/3;let En=!1;const wn=[],In=function(xn){if(!xn.groups||!xn.groups.length)return[{offset:0,count:xn.index.count/3}];const Cn=[],Fn=new Set;for(const Wn of xn.groups)Fn.add(Wn.start),Fn.add(Wn.start+Wn.count);const Tn=Array.from(Fn.values()).sort((Wn,or)=>Wn-or);for(let Wn=0;Wn<Tn.length-1;Wn++){const or=Tn[Wn],fr=Tn[Wn+1];Cn.push({offset:or/3,count:(fr-or)/3})}return Cn}(ft);if(In.length===1){const xn=In[0],Cn=new C2;Cn.boundingData=xt,function(Fn,Tn,Wn,or){let fr=1/0,rr=1/0,Ir=1/0,kr=-1/0,Br=-1/0,Ur=-1/0;for(let hs=6*Tn,_r=6*(Tn+Wn);hs<_r;hs+=6){const Ys=Fn[hs+0];Ys<fr&&(fr=Ys),Ys>kr&&(kr=Ys);const po=Fn[hs+2];po<rr&&(rr=po),po>Br&&(Br=po);const Xs=Fn[hs+4];Xs<Ir&&(Ir=Xs),Xs>Ur&&(Ur=Xs)}or[0]=fr,or[1]=rr,or[2]=Ir,or[3]=kr,or[4]=Br,or[5]=Ur}(At,xn.offset,xn.count,Et),Mt(Cn,xn.offset,xn.count,Et),wn.push(Cn)}else for(let xn of In){const Cn=new C2;Cn.boundingData=new Float32Array(6),jD(At,xn.offset,xn.count,Cn.boundingData,Et),Mt(Cn,xn.offset,xn.count,Et),wn.push(Cn)}return wn}(s,a);let f,k,et;const tt=[],rt=a.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let ft=0;ft<h.length;ft++){const vt=h[ft],yt=new rt(32*lt(vt));f=new Float32Array(yt),k=new Uint32Array(yt),et=new Uint16Array(yt),pt(0,vt),tt.push(yt)}return tt;function lt(ft){return ft.count?1:1+lt(ft.left)+lt(ft.right)}function pt(ft,vt){const yt=ft/4,Mt=ft/2,xt=!!vt.count,Et=vt.boundingData;for(let At=0;At<6;At++)f[yt+At]=Et[At];if(xt){const At=vt.offset,Rt=vt.count;return k[yt+6]=At,et[Mt+14]=Rt,et[Mt+15]=UD,ft+32}{const At=vt.left,Rt=vt.right,Bt=vt.splitAxis;let Qt;if(Qt=pt(ft+32,At),Qt/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return k[yt+6]=Qt/4,Qt=pt(Qt,Rt),k[yt+7]=Bt,Qt}}}(e,i),!e.boundingBox&&i.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new d.ZzF))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));const i=this.geometry,s=i.index.array,a=i.attributes.position,h=a.array,f=a.offset||0;let k,et,tt,rt,lt=3;a.isInterleavedBufferAttribute&&(lt=a.data.stride);let pt=0;const ft=this._roots;for(let yt=0,Mt=ft.length;yt<Mt;yt++)k=ft[yt],et=new Uint32Array(k),tt=new Uint16Array(k),rt=new Float32Array(k),vt(0,pt),pt+=k.byteLength;function vt(yt,Mt,xt=!1){const Et=2*yt;if(tt[Et+15]===UD){const At=et[yt+6];let Rt=1/0,Bt=1/0,Qt=1/0,Wt=-1/0,tn=-1/0,pn=-1/0;for(let yn=3*At,En=3*(At+tt[Et+14]);yn<En;yn++){const wn=s[yn]*lt+f,In=h[wn+0],xn=h[wn+1],Cn=h[wn+2];In<Rt&&(Rt=In),In>Wt&&(Wt=In),xn<Bt&&(Bt=xn),xn>tn&&(tn=xn),Cn<Qt&&(Qt=Cn),Cn>pn&&(pn=Cn)}return(rt[yt+0]!==Rt||rt[yt+1]!==Bt||rt[yt+2]!==Qt||rt[yt+3]!==Wt||rt[yt+4]!==tn||rt[yt+5]!==pn)&&(rt[yt+0]=Rt,rt[yt+1]=Bt,rt[yt+2]=Qt,rt[yt+3]=Wt,rt[yt+4]=tn,rt[yt+5]=pn,!0)}{const At=yt+8,Rt=et[yt+6],Bt=At+Mt,Qt=Rt+Mt;let Wt=xt,tn=!1,pn=!1;e?Wt||(tn=e.has(Bt),pn=e.has(Qt),Wt=!tn&&!pn):(tn=!0,pn=!0);const yn=Wt||pn;let En=!1;(Wt||tn)&&(En=vt(At,Mt,Wt));let wn=!1;yn&&(wn=vt(Rt,Mt,Wt));const In=En||wn;if(In)for(let xn=0;xn<3;xn++){const Cn=At+xn,Fn=Rt+xn,Tn=rt[Cn],Wn=rt[Cn+3],or=rt[Fn],fr=rt[Fn+3];rt[yt+xn]=Tn<or?Tn:or,rt[yt+xn+3]=Wn>fr?Wn:fr}return In}}}traverse(e,i=0){const s=this._roots[i],a=new Uint32Array(s),h=new Uint16Array(s);(function f(k,et=0){const tt=2*k,rt=h[tt+15]===UD;if(rt){const lt=a[k+6],pt=h[tt+14];e(et,rt,new Float32Array(s,4*k,6),lt,pt)}else{const lt=k+8,pt=a[k+6],ft=a[k+7];e(et,rt,new Float32Array(s,4*k,6),ft)||(f(lt,et+1),f(pt,et+1))}})(0)}raycast(e,i=d.Wl3){const s=this._roots,a=this.geometry,h=[],f=i.isMaterial,k=Array.isArray(i),et=a.groups,tt=f?i.side:i;for(let rt=0,lt=s.length;rt<lt;rt++){const pt=k?i[et[rt].materialIndex].side:tt,ft=h.length;if(bM(s[rt]),zD(0,a,pt,e,h),O2(),k){const vt=et[rt].materialIndex;for(let yt=ft,Mt=h.length;yt<Mt;yt++)h[yt].face.materialIndex=vt}}return h}raycastFirst(e,i=d.Wl3){const s=this._roots,a=this.geometry,h=i.isMaterial,f=Array.isArray(i);let k=null;const et=a.groups,tt=h?i.side:i;for(let rt=0,lt=s.length;rt<lt;rt++){const pt=f?i[et[rt].materialIndex].side:tt;bM(s[rt]);const ft=VD(0,a,pt,e);O2(),ft!=null&&(k==null||ft.distance<k.distance)&&(k=ft,f&&(ft.face.materialIndex=et[rt].materialIndex))}return k}intersectsGeometry(e,i){const s=this.geometry;let a=!1;for(const h of this._roots)if(bM(h),a=jN(0,s,e,i),O2(),a)break;return a}shapecast(e,i,s){const a=this.geometry;if(e instanceof Function){if(i){const pt=i;i=(ft,vt,yt,Mt)=>{const xt=3*vt;return pt(ft,xt,xt+1,xt+2,yt,Mt)}}e={boundsTraverseOrder:s,intersectsBounds:e,intersectsTriangle:i,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}const h=wy.getPrimitive();let{boundsTraverseOrder:f,intersectsBounds:k,intersectsRange:et,intersectsTriangle:tt}=e;if(et&&tt){const pt=et;et=(ft,vt,yt,Mt,xt)=>!!pt(ft,vt,yt,Mt,xt)||_O(ft,vt,a,tt,yt,Mt,h)}else et||(et=tt?(pt,ft,vt,yt)=>_O(pt,ft,a,tt,vt,yt,h):(pt,ft,vt)=>vt);let rt=!1,lt=0;for(const pt of this._roots){if(bM(pt),rt=UN(0,a,k,et,f,lt),O2(),rt)break;lt+=pt.byteLength}return wy.releasePrimitive(h),rt}bvhcast(e,i,s){let{intersectsRanges:a,intersectsTriangles:h}=s;const f=this.geometry.index,k=this.geometry.attributes.position,et=e.geometry.index,tt=e.geometry.attributes.position;yS.copy(i).invert();const rt=wy.getPrimitive(),lt=wy.getPrimitive();if(h){let vt=function(yt,Mt,xt,Et,At,Rt,Bt,Qt){for(let Wt=xt,tn=xt+Et;Wt<tn;Wt++){Ay(lt,3*Wt,et,tt),lt.a.applyMatrix4(i),lt.b.applyMatrix4(i),lt.c.applyMatrix4(i),lt.needsUpdate=!0;for(let pn=yt,yn=yt+Mt;pn<yn;pn++)if(Ay(rt,3*pn,f,k),rt.needsUpdate=!0,h(rt,lt,pn,Wt,At,Rt,Bt,Qt))return!0}return!1};var ft=vt;if(a){const yt=a;a=function(Mt,xt,Et,At,Rt,Bt,Qt,Wt){return!!yt(Mt,xt,Et,At,Rt,Bt,Qt,Wt)||vt(Mt,xt,Et,At,Rt,Bt,Qt,Wt)}}else a=vt}e.getBoundingBox(WD),WD.applyMatrix4(i);const pt=this.shapecast({intersectsBounds:vt=>WD.intersectsBox(vt),intersectsRange:(vt,yt,Mt,xt,Et,At)=>(HD.copy(At),HD.applyMatrix4(yS),e.shapecast({intersectsBounds:Rt=>HD.intersectsBox(Rt),intersectsRange:(Rt,Bt,Qt,Wt,tn)=>a(vt,yt,Rt,Bt,xt,Et,Wt,tn)}))});return wy.releasePrimitive(rt),wy.releasePrimitive(lt),pt}intersectsBox(e,i){return d1.set(e.min,e.max,i),d1.needsUpdate=!0,this.shapecast({intersectsBounds:s=>d1.intersectsBox(s),intersectsTriangle:s=>d1.intersectsTriangle(s)})}intersectsSphere(e){return this.shapecast({intersectsBounds:i=>e.intersectsBox(i),intersectsTriangle:i=>i.intersectsSphere(e)})}closestPointToGeometry(e,i,s={},a={},h=0,f=1/0){e.boundingBox||e.computeBoundingBox(),d1.set(e.boundingBox.min,e.boundingBox.max,i),d1.needsUpdate=!0;const k=this.geometry,et=k.attributes.position,tt=k.index,rt=e.attributes.position,lt=e.index,pt=wy.getPrimitive(),ft=wy.getPrimitive();let vt=L2,yt=zN,Mt=null,xt=null;a&&(Mt=VN,xt=QN);let Et=1/0,At=null,Rt=null;return yS.copy(i).invert(),EM.matrix.copy(yS),this.shapecast({boundsTraverseOrder:Bt=>d1.distanceToBox(Bt),intersectsBounds:(Bt,Qt,Wt)=>Wt<Et&&Wt<f&&(Qt&&(EM.min.copy(Bt.min),EM.max.copy(Bt.max),EM.needsUpdate=!0),!0),intersectsRange:(Bt,Qt)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:Wt=>EM.distanceToBox(Wt),intersectsBounds:(Wt,tn,pn)=>pn<Et&&pn<f,intersectsRange:(Wt,tn)=>{for(let pn=3*Wt,yn=3*(Wt+tn);pn<yn;pn+=3){Ay(ft,pn,lt,rt),ft.a.applyMatrix4(i),ft.b.applyMatrix4(i),ft.c.applyMatrix4(i),ft.needsUpdate=!0;for(let En=3*Bt,wn=3*(Bt+Qt);En<wn;En+=3){Ay(pt,En,tt,et),pt.needsUpdate=!0;const In=pt.distanceToTriangle(ft,vt,Mt);if(In<Et&&(yt.copy(vt),xt&&xt.copy(Mt),Et=In,At=En/3,Rt=pn/3),In<h)return!0}}}});for(let Wt=0,tn=lt?lt.count:rt.count;Wt<tn;Wt+=3){Ay(ft,Wt,lt,rt),ft.a.applyMatrix4(i),ft.b.applyMatrix4(i),ft.c.applyMatrix4(i),ft.needsUpdate=!0;for(let pn=3*Bt,yn=3*(Bt+Qt);pn<yn;pn+=3){Ay(pt,pn,tt,et),pt.needsUpdate=!0;const En=pt.distanceToTriangle(ft,vt,Mt);if(En<Et&&(yt.copy(vt),xt&&xt.copy(Mt),Et=En,At=pn/3,Rt=Wt/3),En<h)return!0}}}}),wy.releasePrimitive(pt),wy.releasePrimitive(ft),Et===1/0?null:(s.point?s.point.copy(yt):s.point=yt.clone(),s.distance=Et,s.faceIndex=At,a&&(a.point?a.point.copy(xt):a.point=xt.clone(),a.point.applyMatrix4(yS),yt.applyMatrix4(yS),a.distance=yt.sub(a.point).length(),a.faceIndex=Rt),s)}closestPointToPoint(e,i={},s=0,a=1/0){const h=s*s,f=a*a;let k=1/0,et=null;if(this.shapecast({boundsTraverseOrder:rt=>(SM.copy(e).clamp(rt.min,rt.max),SM.distanceToSquared(e)),intersectsBounds:(rt,lt,pt)=>pt<k&&pt<f,intersectsTriangle:(rt,lt)=>{rt.closestPointToPoint(e,SM);const pt=e.distanceToSquared(SM);return pt<k&&(L2.copy(SM),k=pt,et=lt),pt<h}}),k===1/0)return null;const tt=Math.sqrt(k);return i.point?i.point.copy(L2):i.point=L2.clone(),i.distance=tt,i.faceIndex=et,i}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(i=>{_y(0,new Float32Array(i),AO),e.union(AO)}),e}}const wO=Hp.prototype.raycast;Hp.prototype.raycast=function(...c){if(c[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycast" has changed. See docs for new signature.');const[e,i,s,a]=c;return wO.call(this,s,e.material).forEach(h=>{(h=vO(h,e,i))&&a.push(h)}),a}return wO.apply(this,c)};const xO=Hp.prototype.raycastFirst;Hp.prototype.raycastFirst=function(...c){if(c[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycastFirst" has changed. See docs for new signature.');const[e,i,s]=c;return vO(xO.call(this,s,e.material),e,i)}return xO.apply(this,c)};const bO=Hp.prototype.closestPointToPoint;Hp.prototype.closestPointToPoint=function(...c){if(c[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "closestPointToPoint" has changed. See docs for new signature.'),c.unshift();const e=c[1],i={};return c[1]=i,bO.apply(this,c),e&&e.copy(i.point),i.distance}return bO.apply(this,c)};const EO=Hp.prototype.closestPointToGeometry;Hp.prototype.closestPointToGeometry=function(...c){const e=c[2],i=c[3];if(e&&e.isVector3||i&&i.isVector3){console.warn('MeshBVH: The function signature and results frame for "closestPointToGeometry" has changed. See docs for new signature.');const s={},a={},h=c[1];return c[2]=s,c[3]=a,EO.apply(this,c),e&&e.copy(s.point),i&&i.copy(a.point).applyMatrix4(h),s.distance}return EO.apply(this,c)};const SO=Hp.prototype.refit;Hp.prototype.refit=function(...c){const e=c[0],i=c[1];if(i&&(i instanceof Set||Array.isArray(i))){console.warn('MeshBVH: The function signature for "refit" has changed. See docs for new signature.');const s=new Set;i.forEach(a=>s.add(a)),e&&e.forEach(a=>s.add(a)),SO.call(this,s)}else SO.apply(this,c)},["intersectsGeometry","shapecast","intersectsBox","intersectsSphere"].forEach(c=>{const e=Hp.prototype[c];Hp.prototype[c]=function(...i){return(i[0]===null||i[0].isMesh)&&(i.shift(),console.warn(`MeshBVH: The function signature for "${c}" has changed and no longer takes Mesh. See docs for new signature.`)),e.apply(this,i)}});const qD=[new d.Pa4,new d.Pa4,new d.Pa4];function YD(c){return~~(1e4*c)}function CO(c){return`${YD(c.x)},${YD(c.y)},${YD(c.z)}`}class GN{constructor(e=null){this.data=null,this.unmatchedEdges=null,this.matchedEdges=null,this.useDrawRange=!0,e&&this.updateFrom(e)}getSiblingTriangleIndex(e,i){const s=this.data[3*e+i];return s===-1?-1:~~(s/3)}getSiblingEdgeIndex(e,i){const s=this.data[3*e+i];return s===-1?-1:s%3}updateFrom(e){const i=new Map,{attributes:s}=e,a=e.index,h=s.position;let f=a?a.count/3:h.count/3;const k=f;let et=0;this.useDrawRange&&(et=e.drawRange.start,e.drawRange.count!==1/0&&(f=~~(e.drawRange.count/3)));let tt=this.data;(!tt||tt.length<3*k)&&(tt=new Int32Array(3*k)),tt.fill(-1);let rt=0,lt=0;for(let pt=0;pt<f;pt++){const ft=3*pt+et;for(let vt=0;vt<3;vt++){let yt=ft+vt;a&&(yt=a.getX(yt)),qD[vt].fromBufferAttribute(h,yt)}for(let vt=0;vt<3;vt++){const yt=(vt+1)%3,Mt=qD[vt],xt=qD[yt],Et=CO(Mt),At=CO(xt),Rt=`${At}_${Et}`;if(i.has(Rt)){const Bt=i.get(Rt);tt[ft+vt]=Bt,tt[Bt]=ft+vt,i.delete(Rt),rt--,lt++}else{const Bt=`${Et}_${At}`;i.set(Bt,ft+vt),rt++}}}this.matchedEdges=lt,this.unmatchedEdges=rt,this.data=tt}}class N2 extends d.Kj0{constructor(...e){super(...e),this.isBrush=!0,this._previousMatrix=new d.yGw,this._previousMatrix.elements.fill(0)}markUpdated(){this._previousMatrix.copy(this.matrix)}isDirty(){const{matrix:e,_previousMatrix:i}=this,s=e.elements,a=i.elements;for(let h=0;h<16;h++)if(s[h]!==a[h])return!0;return!1}prepareGeometry(){const e=this.geometry,i=e.attributes;if(iO())for(const s in i){const a=i[s];if(a.isInterleavedBufferAttribute)throw new Error("Brush: InterleavedBufferAttributes are not supported.");a.array=DN(a.array)}if(e.boundsTree||(e.boundsTree=new Hp(e,{maxLeafTris:3}),e.halfEdges&&e.halfEdges.updateFrom(e)),e.halfEdges||(e.halfEdges=new GN(e)),!e.groupIndices){const s=e.index.count/3,a=new Uint16Array(s),h=e.groups;for(let f=0,k=h.length;f<k;f++){const{start:et,count:tt}=h[f];for(let rt=et/3,lt=(et+tt)/3;rt<lt;rt++)a[rt]=f}e.groupIndices=a}}disposeCacheData(){const{geometry:e}=this;e.halfEdges=null,e.boundsTree=null,e.groupIndices=null}}function MO(c,e){let i=e;return Array.isArray(e)||(i=[],c.forEach(s=>{i[s.materialIndex]=e})),i}class HN{constructor(){this.triangleSplitter=new PN,this.attributeData=new RN,this.attributes=["position","uv","normal"],this.useGroups=!0,this.debug=new BN}evaluate(e,i,s,a=new N2){e.prepareGeometry(),i.prepareGeometry();const{triangleSplitter:h,attributeData:f,attributes:k,useGroups:et,debug:tt}=this,rt=a.geometry,lt=e.geometry.attributes;for(let xt=0,Et=k.length;xt<Et;xt++){const At=k[xt],Rt=lt[At];f.initializeArray(At,Rt.array.constructor)}for(const xt in f.attributes)k.includes(xt)||f.delete(xt);for(const xt in rt.attributes)k.includes(xt)||(rt.deleteAttribute(xt),rt.dispose());f.clear(),tt.enabled&&(tt.reset(),J3(tt)),function(xt,Et,At,Rt,Bt,Qt){const{useGroups:Wt=!0}=Qt,{aIntersections:tn,bIntersections:pn}=function(En,wn){const In=new q3,xn=new q3;return Y3.copy(En.matrixWorld).invert().multiply(wn.matrixWorld),En.geometry.boundsTree.bvhcast(wn.geometry.boundsTree,Y3,{intersectsTriangles:(Cn,Fn,Tn,Wn)=>(Cn.intersectsTriangle(Fn,BD)&&BD.distance()>1e-5&&(In.add(Tn,Wn),xn.add(Wn,Tn),x2&&(x2.addEdge(BD),x2.addIntersectingTriangles(Tn,Cn,Wn,Fn))),!1)}),{aIntersections:In,bIntersections:xn}}(xt,Et);let yn;yn=Wt?0:-1,lO(xt,Et,tn,At,!1,Bt,yn),aO(xt,Et,tn,At,!1,Rt,Bt,yn),yn=Wt?xt.geometry.groups.length||1:-1,lO(Et,xt,pn,At,!0,Bt,yn),aO(Et,xt,pn,At,!0,Rt,Bt,yn)}(e,i,s,h,f,{useGroups:et}),tt.enabled&&J3(null);const pt=et&&e.geometry.groups.length!==0?e.geometry.groups.map(xt=>({...xt})):[{start:0,count:1/0,materialIndex:0}],ft=et&&i.geometry.groups.length!==0?i.geometry.groups.map(xt=>({...xt})):[{start:0,count:1/0,materialIndex:0}],vt=MO(pt,e.material),yt=MO(ft,i.material);ft.forEach(xt=>{xt.materialIndex+=vt.length}),function(xt,Et,At,Rt){let Bt=!1,Qt=-1;const Wt=Rt.groupCount,tn=xt.attributes,pn=Rt.groupAttributes[0];for(const En in pn){const wn=Rt.getTotalLength(En,Wt),In=pn[En].type;let xn=tn[En];if(!xn||xn.array.length<wn){const Fn=Et.attributes[En];xn=new d.TlE(new In(wn),Fn.itemSize,Fn.normalized),xt.setAttribute(En,xn),Bt=!0}let Cn=0;for(let Fn=0;Fn<Wt;Fn++){const{array:Tn,type:Wn,length:or}=Rt.groupAttributes[Fn][En],fr=new Wn(Tn.buffer,0,or);xn.array.set(fr,Cn),Cn+=fr.length}xn.needsUpdate=!0,Qt=wn/xn.itemSize}xt.setDrawRange(0,Qt),xt.clearGroups();let yn=0;for(let En=0;En<Wt;En++){const wn=Rt.getGroupArray("position",En).length/3;if(wn!==0){const In=At[En];xt.addGroup(yn,wn,In.materialIndex),yn+=wn}}if(xt.index){const En=xt.index.array;if(En.length<Qt)xt.index=null,Bt=!0;else for(let wn=0,In=En.length;wn<In;wn++)En[wn]=wn}xt.boundsTree=null,Bt&&xt.dispose()}(rt,e.geometry,[...pt,...ft],f);const Mt=rt.groups;if(et){const xt=new Map,Et=[...vt,...yt];let At=0;for(let Rt=0,Bt=Et.length;Rt<Bt;Rt++)Mt.find(Qt=>Qt.materialIndex===Rt)?(xt.set(Rt,At),At++):Et[Rt]=null;for(let Rt=0,Bt=Mt.length;Rt<Bt;Rt++){const Qt=Mt[Rt];Qt.materialIndex=xt.get(Qt.materialIndex)}a.material=Et.filter(Rt=>Rt)}return a}evaluateHierarchy(e,i=new N2){e.updateMatrixWorld(!0);const s=(h,f)=>{const k=h.children;for(let et=0,tt=k.length;et<tt;et++){const rt=k[et];rt.isOperationGroup?s(rt,f):f(rt)}},a=h=>{const f=h.children;let k=!1;for(let tt=0,rt=f.length;tt<rt;tt++){const lt=f[tt];k=a(lt)||k}const et=h.isDirty();if(et&&h.markUpdated(),k&&!h.isOperationGroup){let tt;return s(h,rt=>{tt=tt?this.evaluate(tt,rt,rt.operation):this.evaluate(h,rt,rt.operation)}),h._cachedGeometry=tt.geometry,h._cachedMaterials=tt.material,!0}return k||et};return a(e),i.geometry=e._cachedGeometry,i.material=e._cachedMaterials,i}reset(){this.triangleSplitter.reset()}}const TO={union:0,subtract:1,intersect:4,difference:3};function IO(c,e){const i=new HN;i.useGroups=!0,i.attributes=["position","normal","uv"],c.forEach(h=>{for(const f of[...i.attributes])h[0].geometry.getAttribute(f)||i.attributes.splice(i.attributes.indexOf(f),1)});let s=new N2(new d._12(.01,.01,2,2));c.forEach(([h,f])=>{if(!Object.keys(TO).includes(f))return void console.error(`Unknown operation ${f}`);h.updateMatrix(),h.updateMatrixWorld();const k=new N2;k.geometry=h.geometry,k.material=h.material,h.matrixWorld.decompose(k.position,k.quaternion,k.scale),k.updateMatrix(),k.updateMatrixWorld(),s=i.evaluate(s,k,TO[f])});const a=s;return a.userData._isCSGMesh=!0,a}let F2=class extends oA{_buildCSGMesh(c){return IO(c)}};F2.PluginType="CSGPluginBVH",F2=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f}([Ws("CSG Plugin (BVH)")],F2);var PO=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};const WN=new d.Pa4(0,0,1),DO=new d.USm,qN=new d._fP,YN=new d._fP(-Math.sqrt(.5),0,0,Math.sqrt(.5)),AS=new d._fP,XN={type:"change"};let CM=class extends j{constructor(c){super(),this.enabled=!1,this.lastOrder="XYZ",this.dampingFactor=.05,this.lastQuaternion=new d._fP,this.onDeviceOrientationChangeEvent=e=>{this.deviceOrientation=e},this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this._initQuaternion=new d._fP,this._initQuaternionInvert=new d._fP,this._initQuaternionDest=new d._fP,this._lastTime=-1,window.isSecureContext===!1&&console.error("DeviceOrientationControls2: DeviceOrientationEvent is only available in secure contexts (https)"),this.object=c,this.lastOrder=this.object.rotation.order,this.object.rotation.reorder("YXZ"),this.connect()}connect(){this.onScreenOrientationChangeEvent(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(c=>{c=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(c=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",c)}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0,this._initQuaternion.copy(this.object.quaternion),this._initQuaternionInvert.copy(this.object.quaternion).invert()}disconnect(){window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternion.identity(),this._initQuaternionInvert.identity(),this._initQuaternionDest=new d._fP,this.object.rotation.reorder(this.lastOrder),this.lastOrder="XYZ",this.enabled=!1}update(){if(!this.enabled)return;const c=this.deviceOrientation;if(c){const e=c.alpha!==null?d.M8C.degToRad(c.alpha):0,i=c.beta!==null?d.M8C.degToRad(c.beta):0,s=c.gamma!==null?d.M8C.degToRad(c.gamma):0,a=this.screenOrientation?d.M8C.degToRad(this.screenOrientation.angle):0;this.setObjectQuaternion(e,i,s,a),8*(1-this.lastQuaternion.dot(this.object.quaternion))>1e-6&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(XN))}}dispose(){this.disconnect()}setObjectQuaternion(c,e,i,s){const a=mo()/1e3;DO.set(e,c,-i,"YXZ"),AS.setFromEuler(DO),AS.multiply(YN),AS.multiply(qN.setFromAxisAngle(WN,-s)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(AS).invert(),this._initQuaternionDest.__init=!0),AS.premultiply(this._initQuaternionDest),this.object.quaternion.slerp(AS,this.dampingFactor/(Math.min(1,a-this._lastTime)/(1/60))),this._lastTime=a}};PO([jn(),Xr("Damping",[0,1],.01)],CM.prototype,"dampingFactor",void 0),CM=PO([Ws("Device Orientation Controls")],CM);class XD extends Js{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._cameraChanged=e=>{var i,s,a,h;(s=(i=e.lastCamera)===null||i===void 0?void 0:i.removeControlsCtor)===null||s===void 0||s.call(i,this.controlsKey),(h=(a=e.camera)===null||a===void 0?void 0:a.setControlsCtor)===null||h===void 0||h.call(a,this.controlsKey,this._controlsCtor)}}async onAdded(e){await super.onAdded(e),this._cameraChanged({camera:e.scene.activeCamera}),e.scene.addEventListener("activeCameraChange",this._cameraChanged)}async onRemove(e){return this._cameraChanged({lastCamera:e.scene.activeCamera}),e.scene.removeEventListener("activeCameraChange",this._cameraChanged),super.onRemove(e)}}class KD extends XD{constructor(){super(...arguments),this.controlsKey="deviceOrientation",this._controlsCtor=(e,i)=>new CM(e)}}KD.PluginType="DeviceOrientationControlsPlugin";var ym=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};const RO=new d.Pa4,$D=new d.$V,JD=new d.Pa4,KN={type:"change"};let _p=class extends j{constructor(c,e){super(),this.enabled=!0,this.enableKeys=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.viewHalfX=0,this.viewHalfY=0,this.lat=0,this.lon=0,this.targetPosition=new d.Pa4,this._lastTime=-1,this.object=c,this.domElement=e,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("mousemove",this.onMouseMove),this.domElement.addEventListener("mousedown",this.onMouseDown),this.domElement.addEventListener("mouseup",this.onMouseUp),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize(),this.setOrientation()}setOrientation(){const c=this.object.quaternion;RO.set(0,0,-1).applyQuaternion(c),$D.setFromVector3(RO),this.lat=90-d.M8C.radToDeg($D.phi),this.lon=d.M8C.radToDeg($D.theta)}handleResize(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}onMouseDown(c){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(c.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0}onMouseUp(c){if(this.activeLook)switch(c.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1}onMouseMove(c){this.domElement===document?(this.mouseX=c.pageX-this.viewHalfX,this.mouseY=c.pageY-this.viewHalfY):(this.mouseX=c.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=c.pageY-this.domElement.offsetTop-this.viewHalfY)}onKeyDown(c){if(this.enableKeys)switch(c.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}}onKeyUp(c){if(this.enableKeys)switch(c.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}}lookAt(c,e,i){return c.isVector3?JD.copy(c):e===void 0||i===void 0?console.error("FirstPersonControls2.lookAt: y and z parameters are required"):JD.set(c,e,i),this.object.lookAt(JD),this.setOrientation(),this}update(){const c=mo(),e=(this._lastTime<0?16:Math.min(c-this._lastTime,1e3))/1e3;if(this._lastTime=c,!this.enabled)return;if(this.heightSpeed){const et=d.M8C.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(et*this.heightCoef)}else this.autoSpeedFactor=0;const i=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(i+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(i),this.moveLeft&&this.object.translateX(-i),this.moveRight&&this.object.translateX(i),this.moveUp&&this.object.translateY(i),this.moveDown&&this.object.translateY(-i);let s=e*this.lookSpeed;this.activeLook||(s=0);let a=1;this.constrainVertical&&(a=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.mouseX*s,this.lookVertical&&(this.lat-=this.mouseY*s*a),this.lat=Math.max(-85,Math.min(85,this.lat));let h=d.M8C.degToRad(90-this.lat);const f=d.M8C.degToRad(this.lon);this.constrainVertical&&(h=d.M8C.mapLinear(h,0,Math.PI,this.verticalMin,this.verticalMax));const k=this.object.position;this.targetPosition.setFromSphericalCoords(1,h,f).add(k),this.object.lookAt(this.targetPosition),this.dispatchEvent(KN)}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("mousedown",this.onMouseDown),this.domElement.removeEventListener("mousemove",this.onMouseMove),this.domElement.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}onContextMenu(c){this.enableKeys&&c.preventDefault()}};ym([jn(),Jr()],_p.prototype,"enabled",void 0),ym([jn(),Jr()],_p.prototype,"enableKeys",void 0),ym([jn(),so()],_p.prototype,"movementSpeed",void 0),ym([jn(),so()],_p.prototype,"lookSpeed",void 0),ym([jn(),Jr()],_p.prototype,"lookVertical",void 0),ym([jn(),Jr()],_p.prototype,"autoForward",void 0),ym([jn(),Jr()],_p.prototype,"activeLook",void 0),ym([jn(),Jr()],_p.prototype,"heightSpeed",void 0),ym([jn(),so()],_p.prototype,"heightCoef",void 0),ym([jn(),so()],_p.prototype,"heightMin",void 0),ym([jn(),so()],_p.prototype,"heightMax",void 0),ym([jn(),Jr()],_p.prototype,"constrainVertical",void 0),ym([jn(),so()],_p.prototype,"verticalMin",void 0),ym([jn(),so()],_p.prototype,"verticalMax",void 0),ym([jn(),Jr()],_p.prototype,"mouseDragOn",void 0),_p=ym([Ws("First Person Controls")],_p);class ZD extends XD{constructor(){super(...arguments),this.controlsKey="firstPerson",this._controlsCtor=(e,i)=>new _p(e,i)}}ZD.PluginType="FirstPersonControlsPlugin";var wS=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};const xS=new d.USm(0,0,0,"YXZ"),bS=new d.Pa4,$N={type:"change"},JN={type:"lock"},ZN={type:"unlock"},kO=Math.PI/2;let cA=class extends j{constructor(c,e){super(),this.isLocked=!1,this.enabled=!0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this.autoLockOnClick=!0,this._movementX=0,this._movementY=0,this._forwardDirection=new d.Pa4(0,0,-1),this.domElement=e,this.object=c,this.onElementClick=this.onElementClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onPointerlockChange=this.onPointerlockChange.bind(this),this.onPointerlockError=this.onPointerlockError.bind(this),this.connect()}onElementClick(c){this.isLocked||this.autoLockOnClick&&(c.preventDefault(),this.lock())}onMouseMove(c){this.isLocked&&(this._movementX+=c.movementX||c.mozMovementX||c.webkitMovementX||0,this._movementY+=c.movementY||c.mozMovementY||c.webkitMovementY||0)}onPointerlockChange(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(JN),this.isLocked=!0):(this.dispatchEvent(ZN),this.isLocked=!1)}onPointerlockError(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.addEventListener("click",this.onElementClick)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.removeEventListener("click",this.onElementClick)}dispose(){this.disconnect()}getDirection(c){return c.copy(this._forwardDirection).applyQuaternion(this.object.quaternion)}moveForward(c){bS.setFromMatrixColumn(this.object.matrix,0),bS.crossVectors(this.object.up,bS),this.object.position.addScaledVector(bS,c)}moveRight(c){bS.setFromMatrixColumn(this.object.matrix,0),this.object.position.addScaledVector(bS,c)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}update(){xS.setFromQuaternion(this.object.quaternion),xS.y-=.002*this._movementX*this.pointerSpeed,xS.x-=.002*this._movementY*this.pointerSpeed,this._movementX=0,this._movementY=0,xS.x=Math.max(kO-this.maxPolarAngle,Math.min(kO-this.minPolarAngle,xS.x)),this.object.quaternion.setFromEuler(xS),this.dispatchEvent($N)}};wS([Jr(),jn()],cA.prototype,"enabled",void 0),wS([so(),jn()],cA.prototype,"minPolarAngle",void 0),wS([so(),jn()],cA.prototype,"maxPolarAngle",void 0),wS([so(),jn()],cA.prototype,"pointerSpeed",void 0),wS([Jr(),jn()],cA.prototype,"autoLockOnClick",void 0),cA=wS([Ws("Pointer Lock Controls")],cA);class eR extends XD{constructor(){super(...arguments),this.controlsKey="pointerLock",this._controlsCtor=(e,i)=>new cA(e,i.ownerDocument?i:i.documentElement)}}eR.PluginType="PointerLockControlsPlugin";var eF=__webpackgi_require__(819);class A_{static _initialize(){this._inited=!0,Gv(Gt`
          #customContextMenu {
            background: #2c2c2e99;
            backdrop-filter: blur(8px);
            border: 0.5px solid rgba(20, 20, 20, 0.3);
            width: auto;
            height: auto;
            position: absolute;
            display: flex;
            flex-direction: column;
            z-index: 9999;
            padding: 0.35rem 0.20rem;
            border-radius: 0.375rem;
            min-width: 6rem;
            pointer-events: auto;
            box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);
          }

          .customContextMenuItems {
            color: white;
            font-size: 0.65rem;
            font-family: "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
            background-color: transparent;
            cursor: pointer;
            padding: 0.12rem 0.35rem;
            border-radius: 0.25rem;
            line-height: 1rem;
            font-weight: 500;
          }

          .customContextMenuItems:hover {
            color: white;
            background-color: #017AFF;
          }
        `),document.addEventListener("mouseup",e=>{this.Element&&!this.Element.contains(e.target)&&this.Remove()})}static Create(e,i,s){this._inited||this._initialize(),this.Element&&this.Remove();const a=El({id:"customContextMenu",addToBody:!1});a.style.top=s+"px",a.style.left=i+"px";for(const[h,f]of Object.entries(e)){const k=El({classList:["customContextMenuItems"],addToBody:!1,innerHTML:h});a.appendChild(k),k.onclick=f}return this.Element=a,a}static Remove(){var e;(e=this.Element)===null||e===void 0||e.remove(),this.Element=void 0}}A_.Element=void 0,A_._inited=!1;var tF=__webpackgi_require__(665);const nF=(c,e,i)=>{var s,a,h;const f=c.controller_,k=(a=(s=f.parent)===null||s===void 0?void 0:s.children)===null||a===void 0?void 0:a.indexOf(f);return!(((tt,rt)=>rt.controller_.rackController.rack===tt.controller_.parent)(c,e)&&k===i||(k!==void 0&&k>=0&&((h=f.parent)===null||h===void 0||h.remove(c)),e.add(c,i),0))},rF=(c,e,i,s)=>{var a,h,f,k,et;let tt=e.uiRef;const rt=tt==null?void 0:tt.expanded;if(tt||(tt=c.addFolder({title:""}),tt.on("fold",Mt=>{var xt,Et,At;let Rt=tt.expanded;nn(e,"expanded",Rt,!0),Rt=(xt=Ht(e.expanded))!==null&&xt!==void 0?xt:Rt,Rt!==tt.expanded&&(tt.expanded=Rt),(Et=e.uiRefresh)===null||Et===void 0||Et.call(e,"postFrame",!0),Rt&&((At=e.onExpand)===null||At===void 0||At.call(e,e))})),!tt)return tt;tt.expanded=(h=(a=Ht(e.expanded))!==null&&a!==void 0?a:rt)!==null&&h!==void 0&&h;const lt=((f=e.children)!==null&&f!==void 0?f:[]).map(Mt=>Mt&&Ht(Mt)).flat(2).filter(Mt=>Mt);let pt=0;for(const Mt of lt){let xt=Mt.uiRef;xt&&xt.controller_.viewProps.get("disposed")&&(Mt.uiRef=void 0),xt=Mt.uiRef,xt||(i.appendUiObject({uiConfig:Mt},tt),xt=Mt.uiRef),xt&&nF(xt,tt,pt++)&&i.appendUiObject({uiConfig:Mt},tt)}let ft=tt.children;for(;ft.length>pt;){const Mt=ft[ft.length-1];tt.remove(Mt),ft=tt.children}tt.controller_.props.set("title",(k=Ht(e.label))!==null&&k!==void 0?k:"");const vt=tt.controller_.view.containerElement,yt=Ht(e.domChildren,[]);if((yt==null?void 0:yt.length)!==void 0){const Mt=[];for(let xt=0;xt<vt.children.length;xt++){const Et=vt.children[xt];!((et=Et.dataset)===null||et===void 0)&&et.tpCustomDOM&&Mt.push(Et)}for(const xt of Mt)vt.removeChild(xt);for(const xt of yt)xt.parentElement!==vt&&(vt.appendChild(xt),xt.dataset.tpCustomDOM="true");tt.controller_.foldable.cleanUpTransition()}return tt},iF=(c,e,i,s)=>{var a,h;const[f,k]=(a=e.property)!==null&&a!==void 0?a:[void 0,void 0],et=(h=Ht(e.label))!==null&&h!==void 0?h:k;let tt=e.uiRef;return tt||(tt=c.addButton({title:""}),tt.on("click",async()=>{var rt;const lt=[];e.prompt&&lt.push(await i.prompt(...e.prompt));const pt=(rt=f&&k?f[k]:void 0)!==null&&rt!==void 0?rt:e.value;if(typeof pt=="function"){const ft=()=>{i.removeEventListener("postFrame",ft),pt(...lt)};i.addEventListener("postFrame",ft)}else console.warn("Invalid action type for button")})),tt&&(tt.title=et??"click me"),tt},sF=(c,e,i,s)=>{var a;const h=Object.fromEntries(((a=Ht(e.children))!==null&&a!==void 0?a:[]).map(f=>Ht(f)).flat(2).filter(f=>f).map(f=>{var k;const et=Ht(f.label);return[et,(k=f.value)!==null&&k!==void 0?k:et]}));return xy(c,e,i,{options:h,...s??{}})},oF=(c,e,i,s)=>{var a,h;const f=Ht(e.bounds),k=((a=f==null?void 0:f.length)!==null&&a!==void 0?a:0)>=2?f[1]:1,et=((h=f==null?void 0:f.length)!==null&&h!==void 0?h:0)>=1?f[0]:0,tt=e.stepSize||void 0;return xy(c,e,i,{min:et,max:k,step:tt,...s??{}})},U2=(c,e,i,s)=>{var a,h,f;const k=Ht(e.bounds);if(!k||k.length<1)return xy(c,e,i,{...s??{}});const et=((a=k.length)!==null&&a!==void 0?a:0)>=2?k[1]:1,tt=((h=k.length)!==null&&h!==void 0?h:0)>=1?k[0]:0,rt={min:tt,max:et,step:(f=e.stepSize)!==null&&f!==void 0?f:(et-tt)/100},lt={x:rt,y:rt};e.type!=="vec3"&&e.type!=="vec4"||(lt.z=rt),e.type==="vec4"&&(lt.w=rt);const pt=e.property;if(e.value===void 0&&pt&&pt[0]&&typeof pt[0]=="object"&&pt[0][pt[1]]&&Array.isArray(pt[0][pt[1]])){const[ft,vt]=pt,yt=ft[vt],Mt=yt.length,xt=new(Mt===2?d.FM8:Mt===3?d.Pa4:d.Ltg)().fromArray(yt);e.value=xt,e.property=void 0,e.onChange=[()=>{ft[vt]=xt.toArray()},...Array.isArray(e.onChange)?e.onChange:[e.onChange]].filter(Et=>Et),e.label===void 0&&(e.label=vt)}return xy(c,e,i,{...lt,...s??{}})},aF=(c,e,i,s)=>{var a;const h=e.property;if(e.value===void 0&&h&&typeof h[0]=="object"&&(!((a=h[0][h[1]])===null||a===void 0)&&a.isColor)){const[f,k]=h,et=new oo().set(f[k]).convertSRGBToLinear();Object.defineProperty(e,"value",{get:()=>{const tt=f[k];return tt?et.set(tt).convertLinearToSRGB().getHex():0},set:tt=>{const rt=f[k];et.setHex(tt).convertSRGBToLinear(),rt.isColor?rt.copy(et):typeof rt=="number"?f[k]=et.getHex():typeof rt=="string"&&(f[k]="#"+et.getHexString()),typeof(f==null?void 0:f.setDirty)=="function"&&f.setDirty()}}),e.property=void 0,e.onChange=[...Array.isArray(e.onChange)?e.onChange:[e.onChange]].filter(tt=>tt),e.label===void 0&&(e.label=k)}return(s=s??{}).view="color",Ht(e.inlinePicker)&&(s.picker="inline"),xy(c,e,i,s)},xy=(c,e,i,s)=>{var a;let h=Ht(e.property);if((e.getValue||e.setValue)&&h&&console.error("specify either property or value, or getValue and setValue",e),h)e.value&&console.warn("Both property and value are defined, value will be ignored",e);else if(e.value===void 0&&(e.getValue||e.setValue)&&(Object.defineProperty(e,"value",{get:()=>{var et;return(et=e.getValue)===null||et===void 0?void 0:et.call(e)},set:et=>{var tt;return(tt=e.setValue)===null||tt===void 0?void 0:tt.call(e,et)}}),h=[e,"value"]),h||e.value===void 0||(h=[e,"value"]),!h)return void console.error("cannot determine property",e);s=s??{};const f={label:(a=Ht(e.label))!==null&&a!==void 0?a:h[1],...s};let k=e.uiRef;if(!k&&typeof h[0]=="object"&&h[0]){const[et,tt]=h;try{k=e.isMonitor?c.addMonitor(et,tt,f):c.addInput(et,tt,f).on("change",rt=>{[e.onChange].flat().forEach(lt=>typeof lt=="function"&&(lt==null?void 0:lt(rt))),typeof(et==null?void 0:et.setDirty)=="function"&&et.setDirty(rt)})}catch(rt){if(!rt.message.startsWith("No matching controller for"))throw rt;k=void 0}}if(k){for(const[et,tt]of Object.entries(f)){const rt=k.controller_.props.value(et);rt!==void 0&&rt.rawValue!==tt&&k.controller_.props.set(et,tt)}e.type==="slider"&&(f.min!==void 0&&k.controller_.valueController.sliderController.props.set("minValue",f.min),f.max!==void 0&&k.controller_.valueController.sliderController.props.set("maxValue",f.max)),k.refresh()}return k};class BO extends j{constructor(e=!1,i=!1,s=!1,a=!0,h=document.body){super(),this._refreshQueue={preRender:[],postRender:[],preFrame:[],postFrame:[]},this._lastModeTime={preRender:0,postRender:0,preFrame:0,postFrame:0},this._typeGenerators={folder:rF,input:xy,slider:oF,dropdown:sF,checkbox:xy,color:aF,vec:U2,vec2:U2,vec3:U2,vec4:U2,button:iF,monitor:(k,et,tt,rt)=>(et.isMonitor=!0,xy(k,et,tt,rt)),dummy:(k,et,tt,rt)=>xy(k,et,tt,rt)},this.alert=async k=>alert(k),this.confirm=async k=>confirm(k),this.prompt=async(k,et,tt=!0)=>prompt(k,et),this._expand=e,this._limitedOptions=s;const f=this._createUiContainer();h.appendChild(f),this._pane=new tF.Pane({title:"Configuration",container:f}),this._pane.expanded=this._expand,a&&(this.addEventListener("postFrame",()=>this.refreshQueue("postFrame")),setTimeout(()=>{this.dispatchEvent({type:"postFrame"})},32))}refreshQueue(e){const i=this._refreshQueue[e],s=[],a=mo(),h=a-this._lastModeTime[e];i.forEach(f=>{f[2]>.001?(f[2]-=h,s.push(f)):this._refreshUiObject(f[0],f[1],f[2])}),this._refreshQueue[e]=s,this._lastModeTime[e]=a}addToRefreshQueue(e,i){var s;const a=(s=i[0])===null||s===void 0?void 0:s.uiConfig,h=a==null?void 0:a.uuid,f=this._refreshQueue[e],k=f.find(et=>et[3]===h);k?k[2]=Math.max(k[2],i[2]):f.push([...i,h]),this._refreshQueue[e]=f}dispose(){var e;(e=this._pane)===null||e===void 0||e.dispose(),this._pane=void 0}appendUiObject(e,i){e&&this._appendUiObject(e,i)}_appendUiObject(e,i){var s,a,h,f;const{uiConfig:k}=e??{};if(k&&(!this._limitedOptions||k.limitedUi)&&(i=i??this._pane,k.type)){k.uuid||(k.uuid=Ho()),k.uiRef&&k.uiRefType!==k.type&&(console.log("Removing UI object because of type mismatch",k.uiRef),this.removeUiConfig(k));const et=(a=(s=this._typeGenerators)[k.type])===null||a===void 0?void 0:a.call(s,i,k,this);et&&(et.hidden=(h=Ht(k.hidden))!==null&&h!==void 0&&h,et.disabled=(f=Ht(k.disabled))!==null&&f!==void 0&&f),k.uiRef=et,k.uiRefType=et?k.type:void 0,k.uiRefresh=(tt="postFrame",rt=!1,lt=0)=>{var pt;return this._uiObjectRefresh(tt,(pt=e==null?void 0:e.uiConfig)!==null&&pt!==void 0?pt:k,i,rt,lt)}}}removeUiObject(e){this.removeUiConfig(e==null?void 0:e.uiConfig)}removeUiConfig(e){var i,s;e&&e.uiRef&&((s=(i=e.uiRef).dispose)===null||s===void 0||s.call(i),e.uiRef=void 0,e.uiRefType=void 0,e.uiRefresh=void 0)}_uiObjectRefresh(e,i,s,a,h){(a?tR(i,s):[{uiConfig:i,parentFolder:s}]).forEach(f=>{const k=[{uiConfig:f.uiConfig},f.parentFolder,h];e==="immediate"?this._refreshUiObject(...k):this.addToRefreshQueue(e,k)})}_refreshUiObject(e,i,s=0){this._appendUiObject(e,i),s>1e-4&&console.error("no support for immediate delay")}_createUiContainer(){const e=El({id:"tweakpaneUiContainer",addToBody:!1});return Gv(Gt`
          :root{
            --tweakpane-ui-container-width: 300px;
          }
          @media only screen and (min-width: 1500px) {
            :root{
              --tweakpane-ui-container-width: 300px;
            }
          }
          @media only screen and (min-width: 2500px) {
            :root{
              --tweakpane-ui-container-width: 500px;
            }
          }
          #tweakpaneUiContainer {
            position: fixed;
            top: 0px;
            padding-right: 4px;
            padding-bottom: 10px;
            right: 10px;
            width: var(--tweakpane-ui-container-width);
            height: auto;
            overflow-y: scroll;
            z-index: 100;
            pointer-events: auto;
            max-height: calc(100% - 6rem);
            border-radius: 0.5rem;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "system-ui", "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
          }
        `),e}}function tR(c,e,i){var s;return i=i??[],c&&(i.push({uiConfig:c,parentFolder:e}),(s=c.children)===null||s===void 0||s.forEach(a=>i=tR(a,c.uiRef,i))),i}class nR{constructor(){nR.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,i,s,a,h,f,k,et,tt){const rt=this.elements;return rt[0]=e,rt[1]=a,rt[2]=k,rt[3]=i,rt[4]=h,rt[5]=et,rt[6]=s,rt[7]=f,rt[8]=tt,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,s=e.elements;return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],this}extractBasis(e,i,s){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const s=e.elements,a=i.elements,h=this.elements,f=s[0],k=s[3],et=s[6],tt=s[1],rt=s[4],lt=s[7],pt=s[2],ft=s[5],vt=s[8],yt=a[0],Mt=a[3],xt=a[6],Et=a[1],At=a[4],Rt=a[7],Bt=a[2],Qt=a[5],Wt=a[8];return h[0]=f*yt+k*Et+et*Bt,h[3]=f*Mt+k*At+et*Qt,h[6]=f*xt+k*Rt+et*Wt,h[1]=tt*yt+rt*Et+lt*Bt,h[4]=tt*Mt+rt*At+lt*Qt,h[7]=tt*xt+rt*Rt+lt*Wt,h[2]=pt*yt+ft*Et+vt*Bt,h[5]=pt*Mt+ft*At+vt*Qt,h[8]=pt*xt+ft*Rt+vt*Wt,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],s=e[1],a=e[2],h=e[3],f=e[4],k=e[5],et=e[6],tt=e[7],rt=e[8];return i*f*rt-i*k*tt-s*h*rt+s*k*et+a*h*tt-a*f*et}invert(){const e=this.elements,i=e[0],s=e[1],a=e[2],h=e[3],f=e[4],k=e[5],et=e[6],tt=e[7],rt=e[8],lt=rt*f-k*tt,pt=k*et-rt*h,ft=tt*h-f*et,vt=i*lt+s*pt+a*ft;if(vt===0)return this.set(0,0,0,0,0,0,0,0,0);const yt=1/vt;return e[0]=lt*yt,e[1]=(a*tt-rt*s)*yt,e[2]=(k*s-a*f)*yt,e[3]=pt*yt,e[4]=(rt*i-a*et)*yt,e[5]=(a*h-k*i)*yt,e[6]=ft*yt,e[7]=(s*et-tt*i)*yt,e[8]=(f*i-s*h)*yt,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,s,a,h,f,k){const et=Math.cos(h),tt=Math.sin(h);return this.set(s*et,s*tt,-s*(et*f+tt*k)+f+e,-a*tt,a*et,-a*(-tt*f+et*k)+k+i,0,0,1),this}scale(e,i){const s=this.elements;return s[0]*=e,s[3]*=e,s[6]*=e,s[1]*=i,s[4]*=i,s[7]*=i,this}rotate(e){const i=Math.cos(e),s=Math.sin(e),a=this.elements,h=a[0],f=a[3],k=a[6],et=a[1],tt=a[4],rt=a[7];return a[0]=i*h+s*et,a[3]=i*f+s*tt,a[6]=i*k+s*rt,a[1]=-s*h+i*et,a[4]=-s*f+i*tt,a[7]=-s*k+i*rt,this}translate(e,i){const s=this.elements;return s[0]+=e*s[2],s[3]+=e*s[5],s[6]+=e*s[8],s[1]+=i*s[2],s[4]+=i*s[5],s[7]+=i*s[8],this}equals(e){const i=this.elements,s=e.elements;for(let a=0;a<9;a++)if(i[a]!==s[a])return!1;return!0}fromArray(e,i=0){for(let s=0;s<9;s++)this.elements[s]=e[s+i];return this}toArray(e=[],i=0){const s=this.elements;return e[i]=s[0],e[i+1]=s[1],e[i+2]=s[2],e[i+3]=s[3],e[i+4]=s[4],e[i+5]=s[5],e[i+6]=s[6],e[i+7]=s[7],e[i+8]=s[8],e}clone(){return new this.constructor().fromArray(this.elements)}}function OO(c){return document.createElementNS("http://www.w3.org/1999/xhtml",c)}let ES;class lF{constructor(e=null){this.isSource=!0,this.uuid=er(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const s={uuid:this.uuid,url:""},a=this.data;if(a!==null){let h;if(Array.isArray(a)){h=[];for(let f=0,k=a.length;f<k;f++)a[f].isDataTexture?h.push(rR(a[f].image)):h.push(rR(a[f]))}else h=rR(a);s.url=h}return i||(e.images[this.uuid]=s),s}}function rR(c){if(typeof HTMLImageElement<"u"&&c instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&c instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&c instanceof ImageBitmap)return(class{static getDataURL(e,i=!1){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let s;if(e instanceof HTMLCanvasElement)s=e;else{ES===void 0&&(ES=OO("canvas")),ES.width=e.width,ES.height=e.height;const a=ES.getContext("2d");e instanceof ImageData?a.putImageData(e,0,0):a.drawImage(e,0,0,e.width,e.height),s=ES}return!i&&(s.width>2048||s.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),s.toDataURL("image/jpeg",.6)):s.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const i=OO("canvas");i.width=e.width,i.height=e.height;const s=i.getContext("2d");s.drawImage(e,0,0,e.width,e.height);const a=s.getImageData(0,0,e.width,e.height),h=a.data;for(let f=0;f<h.length;f++)h[f]=255*fo(h[f]/255);return s.putImageData(a,0,0),i}if(e.data){const i=e.data.slice(0);for(let s=0;s<i.length;s++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[s]=Math.floor(255*fo(i[s]/255)):i[s]=fo(i[s]);return{data:i,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}).getDataURL(c);if(c.data){let e=[];try{e=Array.from(c.data)}catch(i){i.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(i),e=c.data}return{data:e,width:c.width,height:c.height,type:c.data.constructor.name}}return console.warn("THREE.Texture: Unable to serialize Texture."),{}}let cF=0;class SS extends class{addEventListener(e,i){this._listeners===void 0&&(this._listeners={});const s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(i)===-1&&s[e].push(i)}hasEventListener(e,i){if(this._listeners===void 0)return!1;const s=this._listeners;return s[e]!==void 0&&s[e].indexOf(i)!==-1}removeEventListener(e,i){if(this._listeners===void 0)return;const s=this._listeners[e];if(s!==void 0){const a=s.indexOf(i);a!==-1&&s.splice(a,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const s=i.slice(0);for(let a=0,h=s.length;a<h;a++)s[a].call(this,e);e.target=null}}}{constructor(e=SS.DEFAULT_IMAGE,i=SS.DEFAULT_MAPPING,s=1001,a=1001,h=Mo,f=1008,k=1023,et=1009,tt=1,rt=3e3){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:cF++}),this.uuid=er(),this.name="",this.source=new lF(e),this.mipmaps=[],this.mapping=i,this.wrapS=s,this.wrapT=a,this.magFilter=h,this.minFilter=f,this.anisotropy=tt,this.format=k,this.internalFormat=null,this.type=et,this.offset=new ar(0,0),this.repeat=new ar(1,1),this.center=new ar(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new nR,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=rt,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const s={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(s.userData=this.userData),i||(e.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==300)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}}SS.DEFAULT_IMAGE=null,SS.DEFAULT_MAPPING=300;var j2=__webpackgi_require__(898),MM={};j2.Z&&j2.Z.locals&&(MM.locals=j2.Z.locals);var iR,sR=0,p1={};p1.styleTagTransform=BC(),p1.setAttributes=kC(),p1.insert=function(c,e){(e.target||document.head).appendChild(c)},p1.domAPI=xE(),p1.insertStyleElement=Px(),MM.use=function(c){return p1.options=c||{},sR++||(iR=RC()(j2.Z,p1)),MM},MM.unuse=function(){sR>0&&!--sR&&(iR(),iR=null)};var uF=MM;class oR extends BO{constructor(e=!1,i=!1,s=!1,a=document.body){super(e,i,s,!1),this.dependencies=[Kr],this._preRender=()=>this.refreshQueue("preRender"),this._postRender=()=>this.refreshQueue("postRender"),this._postFrame=h=>{this.dispatchEvent(h),this.refreshQueue("postFrame")},this._preFrame=()=>this.refreshQueue("preFrame"),this._plugins=[],this.alert=async h=>this._viewer?this._viewer.alert(h):super.alert(h),this.confirm=async h=>this._viewer?this._viewer.confirm(h):super.confirm(h),this.prompt=async(h,f,k=!0)=>this._viewer?this._viewer.prompt(h,f,k):super.prompt(h,f,k),this._pane.registerPlugin(eF),uF.use({target:a})}async onAdded(e){this._viewer=e,this._typeGenerators.image=(i=>(s,a,h,f)=>{const k=a.property,et="placeholder";if(a.value===void 0&&k&&typeof k[0]=="object"){const[tt,rt]=k,lt=aM("Render Target"),pt=aM("Data Texture"),ft=aM("CUBE Texture"),vt=aM("Compressed Texture"),yt={},Mt={};Object.defineProperty(a,"value",{get:()=>{var xt;let Et,At=tt[rt];if(At!=null&&At.get&&(At=At.get()),!At)return et;if(At.isRenderTargetTexture&&!At.image.tp_src&&(At.image.tp_src=lt),At.isDataTexture&&!At.image.tp_src&&(At.image.tp_src=pt),At.isCompressedTexture&&!At.image.tp_src&&(At.image.tp_src=vt),At.isTexture?(At.image&&(At.image instanceof ImageBitmap||At.image instanceof HTMLImageElement||At.image instanceof HTMLVideoElement)&&!At.image.tp_src&&(At.image.tp_src=S_(At.image,160)),At.image&&(Et=At.image.tp_src_uuid,Et=Et?yt[Et]:void 0,Et||(Et=At.image.tp_src||At.image.src))):typeof At=="string"?Et=At:At.domainMin?(Et=At.texture,At.texture.image&&!At.texture.image.tp_src&&(At.texture.image.tp_src=ft),At.texture.image&&(Et=At.texture.image.tp_src_uuid,Et=Et?yt[Et]:void 0,Et||(Et=At.texture.image.tp_src||At.texture.image.src))):At&&console.error("unknown value",At),Et||(Et=et),At.image&&!At.image.tp_src_uuid){const Rt=Ho();At.image.tp_src_uuid=Rt,Mt[Et]=Rt}return typeof Et=="string"&&(Et=(xt=yt[Et])!==null&&xt!==void 0?xt:Et),Et},set:xt=>{var Et,At,Rt,Bt,Qt,Wt,tn,pn,yn,En,wn;const In=tt[rt],xn=Fn=>{var Tn;tt[rt]=Fn,Fn!=null&&Fn.isTexture&&(Fn.flipY=Fn.isDataTexture?Fn.flipY:(Tn=In==null?void 0:In.flipY)===null||Tn===void 0||Tn)};if(typeof xt=="string")return void(typeof In=="string"&&xn(xt));if(!xt)return void(a.value=et);if(xt.isPlaceholder)return void(In&&(xn(typeof In=="string"?"":null),typeof(tt==null?void 0:tt.setDirty)=="function"&&tt.setDirty()));let Cn=xt.tp_src_uuid;if(Cn||(Cn=(Et=xt.src)!==null&&Et!==void 0?Et:xt.tp_src,Cn=(At=Mt[Cn])!==null&&At!==void 0?At:Cn,delete Mt[Cn],xt.tp_src_uuid=Cn),Cn&&(yt[Cn]=xt),typeof In!="string"){if(!((In==null?void 0:In.image)===xt||((Rt=In==null?void 0:In.image)===null||Rt===void 0?void 0:Rt.src)===xt.src||((Bt=In==null?void 0:In.image)===null||Bt===void 0?void 0:Bt.tp_src)===xt.tp_src&&xt.tp_src!=null||((Qt=In==null?void 0:In.image)===null||Qt===void 0?void 0:Qt.tp_src)===xt.src&&xt.src!=null||((Wt=In==null?void 0:In.image)===null||Wt===void 0?void 0:Wt.src)===xt.tp_src&&xt.tp_src!=null))if(xt instanceof File){const Fn=i==null?void 0:i.getPlugin(Kr);if(!Fn)throw"Viewer or AssetManagerPlugin not found";(tn=Fn.importer)===null||tn===void 0||tn.importSingle({file:xt,path:xt.src}).then(Tn=>{var Wn,or,fr,rr;if(Tn){Tn.isDataTexture&&(Tn.needsUpdate=!0);const Ir=(fr=(or=(Wn=xt.src)===null||Wn===void 0?void 0:Wn.split("?"))===null||or===void 0?void 0:or[0])===null||fr===void 0?void 0:fr.split(".").pop();Tn.userData&&(Tn.userData.mimeType||(Tn.userData.mimeType="image/"+(["jpg","jpeg"].includes(Ir)?"jpeg":"png"))),xn(Tn),[a.onChange].flat().forEach(kr=>typeof kr=="function"&&(kr==null?void 0:kr())),typeof(tt==null?void 0:tt.setDirty)=="function"&&tt.setDirty(),(rr=a.uiRefresh)===null||rr===void 0||rr.call(a,"postFrame",!1)}})}else{const Fn=new SS(xt);Fn.assetType="texture",Fn.needsUpdate=!0;const Tn=(En=(yn=(pn=xt.src)===null||pn===void 0?void 0:pn.split("?"))===null||yn===void 0?void 0:yn[0])===null||En===void 0?void 0:En.split(".").pop();Fn.userData.mimeType||(Fn.userData.mimeType="image/"+(["jpg","jpeg"].includes(Tn)?"jpeg":"png")),xn(Fn);const Wn=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(rt);Fn.encoding=Wn?d.rnI:d.knz,Fn.wrapS=d.rpg,Fn.wrapT=d.rpg,[a.onChange].flat().forEach(or=>typeof or=="function"&&(or==null?void 0:or())),typeof(tt==null?void 0:tt.setDirty)=="function"&&tt.setDirty(),(wn=a.uiRefresh)===null||wn===void 0||wn.call(a,"postFrame",!1)}}else xn(Cn)}}),a.property=void 0,a.label===void 0&&(a.label=rt)}return(f=f??{}).extensions=[".jpg",".png",".svg",".hdr",".exr",".jpeg",".bmp",".gif",".webp",".cube"],f.imageFit===void 0&&(f.imageFit="contain"),f.clickCallback===void 0&&(f.clickCallback=(tt,rt)=>{var lt;const pt=tt==null?void 0:tt.target,ft=pt==null?void 0:pt.getBoundingClientRect();if(!ft)return void rt.click();const vt=a.uiRef.controller_.valueController.value.rawValue,yt=vt===et||vt!=null&&vt.isPlaceholder?{}:{"remove image":()=>{var xt;a.uiRef.controller_.valueController.value.setRawValue("");const[Et,At]=k||[a,"value"],Rt=typeof Et[At]=="string";Et[At]=Rt?"":null,[a.onChange].flat().forEach(Bt=>typeof Bt=="function"&&(Bt==null?void 0:Bt())),typeof(Et==null?void 0:Et.setDirty)=="function"&&Et.setDirty(),(xt=a.uiRefresh)===null||xt===void 0||xt.call(a,"postFrame",!1),A_.Remove()},"download image":()=>{var xt,Et,At;const[Rt,Bt]=k||[a,"value"];let Qt=(Et=(xt=Rt[Bt])===null||xt===void 0?void 0:xt.image)!==null&&Et!==void 0?Et:a.uiRef.controller_.valueController.value.rawValue;Qt&&(Qt instanceof ImageBitmap||Qt instanceof HTMLImageElement||Qt instanceof HTMLVideoElement)&&!Qt.src&&(Qt=S_(Qt));const Wt=document.createElement("a");document.body.appendChild(Wt),Wt.style.display="none",Wt.href=(At=Qt==null?void 0:Qt.src)!==null&&At!==void 0?At:Qt,Wt.download="image.png",Wt.click(),document.body.removeChild(Wt),A_.Remove()}},Mt=A_.Create({...yt,"set/replace image":()=>{rt.click(),A_.Remove()},"from url":async()=>{var xt,Et;let At="";if(At&&(At.startsWith("http")||At.startsWith("data:image"))||(At=""),At=await h.prompt("Load texture: Enter Image/Texture URL",At,!0),!At||!At.startsWith("http")&&!At.startsWith("data:image"))return At!==null&&await h.alert("Loading Image: Invalid URL"),void A_.Remove();const[Rt,Bt]=k||[a,"value"],Qt=Rt[Bt];if(typeof Qt=="string")Rt[Bt]=At,[a.onChange].flat().forEach(Wt=>typeof Wt=="function"&&(Wt==null?void 0:Wt())),typeof(Rt==null?void 0:Rt.setDirty)=="function"&&Rt.setDirty(),(xt=a.uiRefresh)===null||xt===void 0||xt.call(a,"postFrame",!1);else{const Wt=i==null?void 0:i.getPlugin(Kr);if(!Wt)throw"Viewer or AssetManagerPlugin not found";(Et=Wt.importer)===null||Et===void 0||Et.importSinglePath(At).then(tn=>{var pn;if(tn){tn.isDataTexture?tn.needsUpdate=!0:tn&&(Qt==null?void 0:Qt.flipY)!==void 0&&(tn.flipY=Qt.flipY),Rt[Bt]=tn;const yn=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(Bt);tn.encoding=yn?d.rnI:d.knz,[a.onChange].flat().forEach(En=>typeof En=="function"&&(En==null?void 0:En())),typeof(Rt==null?void 0:Rt.setDirty)=="function"&&Rt.setDirty(),(pn=a.uiRefresh)===null||pn===void 0||pn.call(a,"postFrame",!1)}})}A_.Remove()},cancel:()=>{A_.Remove()}},2,ft.height+8);(lt=pt.parentElement)===null||lt===void 0||lt.appendChild(Mt),ft.y>.7*document.body.clientHeight&&(Mt.style.top="auto",Mt.style.bottom=ft.height+8+"px")}),f.view="input-image",xy(s,a,h,f)})(this._viewer),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.addEventListener("preFrame",this._preFrame),e.addEventListener("postFrame",this._postFrame)}async onDispose(e){this.dispose()}async onRemove(e){this._viewer=void 0,e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),e.removeEventListener("preFrame",this._preFrame),e.removeEventListener("postFrame",this._postFrame),this.dispose()}setupPluginUi(e){var i;const s=(i=this._viewer)===null||i===void 0?void 0:i.getPlugin(e);if(!s)return void console.warn("plugin not found:",e);this._plugins.push(s),s.uiConfig&&(s.uiConfig.limitedUi=!0),s.uiConfig&&s.uiConfig.hidden===void 0&&(s.uiConfig.hidden=!1),this._appendUiObject(s);const a=s.uiConfig;if(a!=null&&a.uiRef&&s.toJSON){const h=a.uiRef.controller_.view.element,f=El({innerHTML:"&#8942;",classList:["pluginOptionsButton"],elementTag:"button"});f.onclick=k=>{const et={};typeof s.toJSON=="function"&&(et["download preset"]=async()=>{var rt,lt;const pt=(lt=(rt=this._viewer)===null||rt===void 0?void 0:rt.getPlugin(Kr))===null||lt===void 0?void 0:lt.exportPluginPreset(s);await Du(new Blob([JSON.stringify(pt,null,2)],{type:"application/json"}),"preset."+s.constructor.PluginType+".json"),A_.Remove()}),typeof s.fromJSON=="function"&&(et["upload preset"]=async()=>{var rt,lt;A_.Remove();const pt=await E_(!1,!1);if(pt.length===0)return;const ft=pt[0],vt=await ft.text(),yt=JSON.parse(vt);await((lt=(rt=this._viewer)===null||rt===void 0?void 0:rt.getPlugin(Kr))===null||lt===void 0?void 0:lt.importPluginPreset(yt,s))});const tt=A_.Create(et,h.clientWidth-120,12);h.append(tt),k.preventDefault()},h.appendChild(f)}return a}setupPlugins(...e){e.forEach(i=>this.setupPluginUi(i))}refreshPluginsEnabled(){this._plugins.forEach(e=>{var i;const s=e.uiConfig;s&&(Ht(s.hidden)!==!0?(i=s.uiRefresh)===null||i===void 0||i.call(s,"postFrame",!0):s.uiRef&&(s.uiRef.hidden=!0))})}}oR.PluginType="TweakpaneUi";class z2 extends Js{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.bgUIConfig={label:"Color",type:"color",inlinePicker:!0,onChange:()=>{if(!this._viewer)return;const e=new oo(this.bgUIConfig.value||16777215).convertSRGBToLinear();this._viewer.setBackground(e.getHex())},expanded:!0,limitedUi:!0},this.uiConfig={label:"Background / Environment",type:"folder",expanded:!1,limitedUi:!0,children:[this.bgUIConfig,{label:"Image",property:[this,"sceneBackground"],type:"image",limitedUi:!0},{label:"EnvMap BG",type:"checkbox",property:[this,"envmapBg"]},()=>({type:"slider",label:"BG Intensity",property:[this._viewer,"backgroundIntensity"],bounds:[0,16]}),{label:"Set Transparent BG",type:"button",hidden:()=>!this._viewer||this._viewer.useRgbm,value:()=>{var e;(e=this._viewer)===null||e===void 0||e.setBackground(null)}},{label:"Environment",property:[this,"sceneEnvironment"],type:"image",limitedUi:!0},{type:"slider",label:"Env Rotation",property:[this,"sceneEnvironmentRotation"],bounds:[0,2*Math.PI],limitedUi:!0},{type:"slider",label:"Env Intensity",property:[this,"sceneEnvironmentIntensity"],bounds:[0,4],limitedUi:!0}]}}get sceneBackground(){var e;const i=(e=this._viewer)===null||e===void 0?void 0:e.getBackground();return i&&(i.isTexture||i.assetType==="texture")?i:null}set sceneBackground(e){var i,s;e?(i=this._viewer)===null||i===void 0||i.setBackground(e):(s=this._viewer)===null||s===void 0||s.setBackground(this.bgUIConfig.value)}get sceneEnvironment(){var e;return(e=this._viewer)===null||e===void 0?void 0:e.scene.getEnvironment()}set sceneEnvironment(e){var i;(i=this._viewer)===null||i===void 0||i.scene.setEnvironment(e)}get sceneEnvironmentRotation(){var e,i,s;return(s=(i=(e=this._viewer)===null||e===void 0?void 0:e.scene.getEnvironment())===null||i===void 0?void 0:i.rotation)!==null&&s!==void 0?s:0}set sceneEnvironmentRotation(e){var i,s;const a=(i=this._viewer)===null||i===void 0?void 0:i.scene.getEnvironment();a&&(a.rotation=e,(s=this._viewer)===null||s===void 0||s.scene.setDirty())}get sceneEnvironmentIntensity(){var e,i;return(i=(e=this._viewer)===null||e===void 0?void 0:e.scene.envMapIntensity)!==null&&i!==void 0?i:1}set sceneEnvironmentIntensity(e){var i;!((i=this._viewer)===null||i===void 0)&&i.scene&&(this._viewer.scene.envMapIntensity=e)}get envmapBg(){var e;return((e=this._viewer)===null||e===void 0?void 0:e.getBackground(!0))===xv}set envmapBg(e){if(this._viewer)if(e){const i=this._viewer.getBackground(!0);i&&i!==xv&&(this.lastBgVal=i),this._viewer.setBackground(xv)}else this._viewer.getBackground()===this._viewer.scene.getEnvironment()&&this._viewer.setBackground(this.lastBgVal||this.bgUIConfig.value)}async onAdded(e){var i;await super.onAdded(e);const s=e.getBackground();this.bgUIConfig.value=typeof s=="string"&&s!==xv||typeof s=="number"||!((i=s)===null||i===void 0)&&i.isColor?"#"+new oo(s).getHexString():"#000000",this.lastBgVal=s}}z2.PluginType="SimpleBackgroundEnvUiPlugin1";class V2 extends Js{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this._uiConfig={type:"folder",label:"Scene Objects",children:[],onExpand:()=>{var e,i;(i=(e=this._uiConfig).uiRefresh)===null||i===void 0||i.call(e,"postFrame",!0)}},this._clearSceneButton={type:"button",label:"Clear Scene",value:()=>{var e;(e=this._viewer)===null||e===void 0||e.scene.disposeSceneModels()}},this._sceneUpdate=this._sceneUpdate.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get uiConfig(){var e,i,s;return this._viewer?(this._uiConfig.children=[this._clearSceneButton],this._uiConfig.children.push(...(s=(i=(e=this._viewer)===null||e===void 0?void 0:e.scene.modelRoot.modelObject.children)===null||i===void 0?void 0:i.map(a=>a.assetType==="light"?null:a.uiConfig).filter(a=>a!=null))!==null&&s!==void 0?s:[]),this._uiConfig):this._uiConfig}_sceneUpdate(){var e,i;(i=(e=this._uiConfig)===null||e===void 0?void 0:e.uiRefresh)===null||i===void 0||i.call(e,"postFrame",!0)}}V2.PluginType="SimpleUi";var hF=__webpackgi_require__(1),dF=__webpackgi_require__.n(hF)();class Q2 extends Js{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.treeView=void 0,this.hierarchyDiv=El({innerHTML:"",id:"tpHierarchyContainer",addToBody:!1}),this._uiConfig={type:"folder",label:"Hierarchy",children:[]},this._buildData=(i,s)=>(i.push({text:s.name||"unnamed",id:s.uuid,children:s.children.reduce(this._buildData,[])}),i),this._findVisible=(i,s)=>(s.visible&&(s.children.length<1?i.push(s.uuid):i.push(...s.children.reduce(this._findVisible,[]))),i),this._setVisible=i=>{var s,a,h;const f=(s=this._viewer)===null||s===void 0?void 0:s.scene.modelRoot;if(!f||i==null)return;const k=new Set;f.traverse(et=>{et!==f&&(et.visible=i.includes(et.uuid),et.visible&&et.traverseAncestors(tt=>k.add(tt)))}),k.forEach(et=>et.visible=!0),(h=(a=this._viewer)===null||a===void 0?void 0:a.scene)===null||h===void 0||h.setDirty({sceneUpdate:!0,fromHierarchyPlugin:!0,updateGround:!1})},this.enabled=e,this.reset=this.reset.bind(this),Gv(Gt`
#tpHierarchyContainer{
  width: 100%;
  height: auto;
  background-color: transparent;
  color: #e9e9ed;
  margin-top: 0;
}
`)}reset(e){var i;if(e!=null&&e.fromHierarchyPlugin||!(e!=null&&e.hierarchyChanged))return;for(;this.hierarchyDiv.firstChild;)this.hierarchyDiv.firstChild.remove();const s=(i=this._viewer)===null||i===void 0?void 0:i.scene.modelRoot;if(!s)return;const a=s.children.reduce(this._buildData,[]),h=s.children.reduce(this._findVisible,[]);let f=!1;return new Promise((k,et)=>{this.treeView=new dF(this.hierarchyDiv,{closeDepth:1,data:a,loaded:function(){this.values=h,k()},onChange:()=>{f?au(200).then(()=>{this.treeView&&this._setVisible(this.treeView.values)}):f=!0},onItemLabelClick:tt=>{var rt;const lt=(rt=this._viewer)===null||rt===void 0?void 0:rt.scene.modelRoot.modelObject.getObjectByProperty("uuid",tt);lt&&s.visible&&lt.dispatchEvent({type:"select",value:lt,ui:!0})}})})}async onAdded(e){await super.onAdded(e),this.reset(),e.scene.addEventListener("sceneUpdate",this.reset)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this.reset),super.onRemove(e)}async onDispose(e){return super.onDispose(e)}get uiConfig(){return this._uiConfig.domChildren||(this._uiConfig.domChildren=[this.hierarchyDiv]),this._uiConfig}}Q2.PluginType="HierarchyUiPlugin";class G2 extends Js{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Lights",children:[{type:"button",label:"Add Directional Light",value:()=>{if(!this._viewer)return;const e=new n_;e.position.set(0,0,0),e.target.position.set(0,0,-1).normalize(),e.intensity=2,e.shadow.mapSize.set(1024,1024),this._viewer.scene.addLight(e)}}],limitedUi:!0},this.dependencies=[Kr],this._sceneUpdate=e=>{var i,s,a;if(!e.hierarchyChanged)return;const h=[];(i=this._viewer)===null||i===void 0||i.traverseSceneObjects(f=>{if(!f.lightObject)return;const k=f.uiConfig;k&&!h.includes(k)&&h.push(k)}),[...this.uiConfig.children].forEach(f=>{var k;((k=f)===null||k===void 0?void 0:k.type)==="button"||h.includes(f)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(f),1)}),h.forEach(f=>{this.uiConfig.children.includes(f)||this.uiConfig.children.push(f)}),(a=(s=this.uiConfig).uiRefresh)===null||a===void 0||a.call(s,"postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}G2.PluginType="SimpleLightsUi";class H2 extends Js{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Cameras (Loaded)",children:[{type:"button",label:"Add Camera",hidden:!0}],limitedUi:!0},this.dependencies=[Kr],this._sceneUpdate=e=>{var i,s,a;if(!e.hierarchyChanged)return;const h=[];(i=this._viewer)===null||i===void 0||i.traverseSceneObjects(f=>{if(!f.cameraObject)return;const k=f.uiConfig;k&&!h.includes(k)&&h.push(k)}),[...this.uiConfig.children].forEach(f=>{var k;((k=f)===null||k===void 0?void 0:k.type)==="button"||h.includes(f)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(f),1)}),h.forEach(f=>{this.uiConfig.children.includes(f)||this.uiConfig.children.push(f)}),(a=(s=this.uiConfig).uiRefresh)===null||a===void 0||a.call(s,"postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}H2.PluginType="SimpleSceneCamerasUi";var TM,W2=function(c,e,i,s){var a,h=arguments.length,f=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(c,e,i,s);else for(var k=c.length-1;k>=0;k--)(a=c[k])&&(f=(h<3?a(f):h>3?a(e,i,f):a(e,i))||f);return h>3&&f&&Object.defineProperty(e,i,f),f};let uA=TM=class extends Js{constructor(){super(),this.enabled=!0,this.width=0,this.height=0,this.scale=1,this._sizeChanged=this._sizeChanged.bind(this),this._refresh=this._refresh.bind(this)}refreshSize(){this._sizeChanged()}_sizeChanged(){var c;if(!this._viewer)return;const e={width:Math.round(this.width),height:Math.round(this.height)},i=this._viewer.container.getBoundingClientRect();e.width>=i.width&&delete e.width,e.height>=i.height&&delete e.height,(c=this._viewer)===null||c===void 0||c.setSize(e),this._viewer.renderer.displayCanvasScaling=this.scale}async onAdded(c){await super.onAdded(c);const e=c.canvas.clientWidth,i=c.canvas.clientHeight,s=c.renderer.displayCanvasScaling;this.width=e,this.height=i,this.scale=s,c.renderer.addEventListener("resize",this._refresh),this.addEventListener("deserialize",this._sizeChanged),this._refresh()}async onRemove(c){return this.removeEventListener("deserialize",this._sizeChanged),c.renderer.removeEventListener("resize",this._refresh),super.onRemove(c)}_refresh(){var c,e;(e=(c=this.uiConfig)===null||c===void 0?void 0:c.uiRefresh)===null||e===void 0||e.call(c,"postFrame",!0)}};uA.PluginType="RendererParamsUiPlugin",W2([jn(),hn(TM.prototype._sizeChanged),Xr("Width",void 0,1,c=>({bounds:()=>{var e;return[10,((e=c._viewer)===null||e===void 0?void 0:e.container.getBoundingClientRect().width)||1024]}}))],uA.prototype,"width",void 0),W2([jn(),hn(TM.prototype._sizeChanged),Xr("Height",void 0,1,c=>({bounds:()=>{var e;return[10,((e=c._viewer)===null||e===void 0?void 0:e.container.getBoundingClientRect().height)||1024]}}))],uA.prototype,"height",void 0),W2([jn(),hn(TM.prototype._sizeChanged),Xr("Scale",[.25,4],.25,{limitedUi:!0})],uA.prototype,"scale",void 0),uA=TM=W2([Ws("Renderer")],uA);class q2 extends Js{constructor(){super(),this.enabled=!0,this.serializeWithViewer=!1,this._refresh=this._refresh.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._refresh),e.scene.addEventListener("sceneUpdate",this._refresh)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._refresh),e.scene.removeEventListener("sceneUpdate",this._refresh),super.onRemove(e)}toJSON(e){var i;const s=super.toJSON(e);return s.activeCamera=(i=this._viewer)===null||i===void 0?void 0:i.scene.activeCamera.toJSON(),s}fromJSON(e,i){var s;return e.activeCamera&&((s=this._viewer)===null||s===void 0||s.scene.activeCamera.fromJSON(e.activeCamera),delete(e={...e}).activeCamera),super.fromJSON(e,i)}_refresh(){var e,i;this._viewer&&((i=(e=this.uiConfig).uiRefresh)===null||i===void 0||i.call(e,"postFrame",!0))}get uiConfig(){var e;return((e=this._viewer)===null||e===void 0?void 0:e.scene.activeCamera.uiConfig)||{}}}q2.PluginType="CameraUiPlugin";var pF={create:c=>{let e="button"+(c.type?" "+c.type:""),i=js.createDiv(e,c.text);return i.addEventListener("click",c.onClick),i}};let jm={createElement:(c,e,i,s)=>{let a=document.createElement(c);if(e&&(a.className=e),i&&(a.innerHTML=i),s)for(let h in s)a.setAttribute(h,s[h]);return a},createDiv:(c,e,i)=>jm.createElement("div",c,e,i),createDomTree:c=>{if(!c||!c.hasOwnProperty("dom"))return c;let e=c.dom;if(c.children)for(let i in c.children)c.children[i]&&e.appendChild(jm.createDomTree(c.children[i]));return e},removeElement:c=>{c!=null&&c.parentNode.removeChild(c)},appendToBody:c=>{document.body.appendChild(c)},makeIconHTML:c=>{let e="";return c=="ok"&&(e="#tick"),c=="error"&&(e="#cancel"),c=="info"&&(e="#info-button"),c=="caution"&&(e="#danger"),c=="min"&&(e="#line"),c=="close"&&(e="#close"),`<svg class="icon ${c}"><use xlink:href="${e}" /></svg>`},makeNftContent:c=>{let e=null;if(c.type){let i=null;i=typeof c.content=="string"?jm.createDiv("inner-content",c.content):jm.createDomTree({dom:jm.createDiv("inner-content"),children:[c.content]}),e=c.type=="text"?jm.createDomTree({dom:jm.createDiv("content text"),children:[i]}):jm.createDomTree({dom:jm.createDiv("content"),children:[jm.createDiv("state",jm.makeIconHTML(c.type)),i]})}else typeof c.content=="string"&&(e=jm.createDiv("content",c.content));return e},standardizeButtons:(c,e)=>{let i=[];if(e.buttons===void 0)return e.type!="caution"&&e.type!="info"||i.push({key:27,text:"Cancel",onClick:c.close.bind(c,"cancel")}),i.push({key:13,text:"OK",type:"main",onClick:c.close.bind(c,"ok")}),i;i=e.buttons,i.constructor!==Array&&(i=[i]);for(let s in i)!i[s].onClick&&(i[s].onClick=c.close.bind(c,i[s].id));return i},makeButtons:c=>{let e=[];if(c)for(let i in c)e.push(pF.create({text:c[i].text?c[i].text:"OK",type:c[i].normal?null:"main",onClick:c[i].onClick}));return jm.createDomTree({dom:jm.createDiv("button-wrapper"),children:e})},bindButtonKeyEvents:c=>{let e=i=>{for(let s in c)if(c[s].key===i.keyCode)return void c[s].onClick()};return window.addEventListener("keydown",e),e},unbindButtonKeyEvents:c=>{window.removeEventListener("keydown",c)}};var js=jm,qu=__webpackgi_require__(476),Wp={"wwise-overlay-in-1":{opacity:"0"},"wwise-overlay-in-2":{opacity:"1"},"wwise-overlay-out-1":{opacity:"0"},"wwise-pop-in-1":{transform:"scale(0.5, 0.5)","margin-top":"50px",opacity:".5"},"wwise-pop-in-2":{transform:"scale(1, 1)","margin-top":"0",opacity:"1"},"wwise-pop-in-3":{transform:"scale(1.05, 1.05)"},"wwise-pop-in-4":{transform:"scale(1, 1)"},"wwise-pop-out-1":{transform:"scale(0.25, 0.25)","margin-top":"50px",opacity:"0"},"wwise-flip-in-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:".2"},"wwise-flip-in-2":{transform:"none",opacity:"1"},"wwise-flip-out-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:"0"},"wwise-top-in-1":{transform:"translateY(-30vh)",opacity:".5"},"wwise-top-in-2":{transform:"none",opacity:"1"},"wwise-top-out-1":{transform:"translateY(-30vh)",opacity:"0"},"wwise-bottom-in-1":{transform:"translateY(30vh)",opacity:".5"},"wwise-bottom-in-2":{transform:"none",opacity:"1"},"wwise-bottom-out-1":{transform:"translateY(30vh)",opacity:"0"},"wwise-left-in-1":{transform:"translateX(-30vw)",opacity:".5"},"wwise-left-in-2":{transform:"none",opacity:"1"},"wwise-left-out-1":{transform:"translateX(-30vw)",opacity:"0"},"wwise-right-in-1":{transform:"translateX(30vw)",opacity:".5"},"wwise-right-in-2":{transform:"none",opacity:"1"},"wwise-right-out-1":{transform:"translateX(30vw)",opacity:"0"},"wwise-min-in-1":{"margin-top":"0",transform:"rotateX(-60deg) scale(0.2, 1.8) translateY(80vh)",opacity:".2"},"wwise-min-in-2":{transform:"none",opacity:"1"},"wwise-min-out-1":{"margin-top":"30vh",transform:"rotateX(-60deg) scale(0.05, 2) translateY(30vh)",opacity:"0"}};let y0={};y0.overlay_in=[new qu.Frame(Wp["wwise-overlay-in-1"],0),new qu.Frame(Wp["wwise-overlay-in-2"],400)],y0.overlay_out=[new qu.Frame(Wp["wwise-overlay-out-1"],300)],y0.pop_in=[new qu.Frame(Wp["wwise-pop-in-1"],0),new qu.Frame(Wp["wwise-pop-in-2"],{duration:200,"timing-function":"ease-in"}),new qu.Frame(Wp["wwise-pop-in-3"],{duration:100,"timing-function":"linear"}),new qu.Frame(Wp["wwise-pop-in-4"],{duration:100,"timing-function":"linear"})],y0.pop_out=[new qu.Frame(Wp["wwise-pop-out-1"],{duration:250,"timing-function":"ease-in"})],y0.flip_in=[new qu.Frame(Wp["wwise-flip-in-1"],0),new qu.Frame(Wp["wwise-flip-in-2"],500)],y0.flip_out=[new qu.Frame(Wp["wwise-flip-out-1"],400)],y0.min_in=[new qu.Frame(Wp["wwise-min-in-1"],0),new qu.Frame(Wp["wwise-min-in-2"],350)],y0.min_out=[new qu.Frame(Wp["wwise-min-out-1"],400)];let LO=["top","bottom","left","right"];for(let c in LO){let e=LO[c];y0[e+"_in"]=[new qu.Frame(Wp["wwise-"+e+"-in-1"],0),new qu.Frame(Wp["wwise-"+e+"-in-2"],{duration:400,"timing-function":"ease-out"})],y0[e+"_out"]=[new qu.Frame(Wp["wwise-"+e+"-out-1"],{duration:400,"timing-function":"ease-in"})]}var Y2=y0;let fF={animation:"pop",topbar:{showClose:!0,showMin:!1},keepOverlay:!1,position:"center",overlay:!1,clickOverlayToClose:!0,removeBackground:!1,noRadius:!1,zIndex:null};class aR{static create(e,i){let s=e.getElementsByClassName("title")[0];s&&(s=s.innerHTML);let a=e.getElementsByClassName("content")[0];return a&&(a=a.innerHTML),js.removeElement(e),i.title=s,i.content=a,new aR(i)}constructor(e){this.options=JSON.parse(JSON.stringify(fF));for(let et in e)e[et]!=null&&(this.options[et]=e[et]);let i=this.options.position;if(i.indexOf(" ")==-1&&(i=="left"||i=="right"?i+=" center":i=i=="top"||i=="bottom"?"center "+i:i+" "+i),this.options.position=i,this.options.overlay){let et=document.getElementsByClassName("wwise-overlay");et.length?(this.overlay=et[0],this.hasOverlay=!0):(this.overlay=js.createDiv("wwise-overlay"),this.options.zIndex&&(this.overlay.style.zIndex=this.options.zIndex)),this.overlayClickHandler=this.close.bind(this,void 0)}else this.options.clickOverlayToClose=!1;let s="content";if(this.options.topbar){let et=[];this.options.topbar.showMin&&(et.push(js.createDiv(null,js.makeIconHTML("min"))),et[et.length-1].addEventListener("click",this.min.bind(this))),this.options.topbar.showClose&&(et.push(js.createDiv(null,js.makeIconHTML("close"))),et[et.length-1].addEventListener("click",this.close.bind(this,void 0)));let tt=null;tt=typeof this.options.title=="string"?js.createDiv("title",this.options.title):js.createDomTree({dom:js.createDiv("title"),children:[this.options.title]}),this.topbar=js.createDomTree({dom:js.createDiv("topbar"),children:[{dom:js.createDiv("control"),children:et.map(rt=>({dom:rt}))},{dom:tt},{dom:js.createDiv("clear")}]})}else s+=" no-topbar";typeof this.options.content=="string"?this.content=js.createDomTree({dom:js.createDiv(s,this.options.content)}):this.content=js.createDomTree({dom:js.createDiv(s),children:[this.options.content]}),this.options.removeBackground&&(this.content.style.background="initial"),this.window=js.createDomTree({dom:js.createDiv("wwise"+(this.options.noRadius?" no-radius":"")),children:[this.topbar,this.content]});let a=js.createDiv("wwise-wrapper");this.options.zIndex&&(a.style.zIndex=this.options.zIndex),this.wrapper=js.createDomTree({dom:a,children:[this.window]}),this.dom=js.createDomTree({dom:js.createDiv(),children:[this.wrapper]});let h=this.options.position.split(" "),f=-50,k=-50;if(h[0]=="left"?(f=0,this.wrapper.classList.add("left")):h[0]=="right"?(f=-100,this.wrapper.classList.add("right")):h[0]=="center"?this.wrapper.classList.add("h-center"):this.wrapper.style.left=h[0],h[1]=="top"?(k=0,this.wrapper.classList.add("top")):h[1]=="bottom"?(k=-100,this.wrapper.classList.add("bottom")):h[1]=="center"?this.wrapper.classList.add("v-center"):this.wrapper.style.top=i[1],this.window.style.transform=`translate(${f}%, ${k}%)`,this.options.style)for(let et in this.options.style)this.window.style[et]=this.options.style[et];this.options.margin&&(this.wrapper.style.margin=this.options.margin),this.options.draggable&&this.draggable()}open(e){if(this.opened)return;this.promise=new Promise(s=>{this.promiseResolve=s}),this.appendDoms(),this.opened=!0,this.options.clickOverlayToClose&&(this.overlay.addEventListener("click",this.overlayClickHandler),this.overlay.addEventListener("touchstart",this.overlayClickHandler));let i=e?"min":this.options.animation;if(i){i!="min"&&i!="flip"||this.dom.classList.add("wwise-perspective");let s=[new qu.Queue(this.wrapper,Y2[i+"_in"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.hasOverlay&&s.push(new qu.Queue(this.overlay,Y2.overlay_in,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(s).then(()=>{this.dom.classList.remove("wwise-perspective")})}return Promise.resolve()}close(e){if(!this.opened)return;this.opened=!1;let i=e?"min":this.options.animation;if(this.overlay&&(this.overlay.removeEventListener("click",this.overlayClickHandler),this.overlay.removeEventListener("touchstart",this.overlayClickHandler)),i){i!="min"&&i!="flip"||this.dom.classList.add("wwise-perspective");let s=[new qu.Queue(this.wrapper,Y2[i+"_out"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.options.keepOverlay&&s.push(new qu.Queue(this.overlay,Y2.overlay_out,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(s).then(()=>{this.removeDoms(),this.dom.classList.remove("wwise-perspective"),this.promiseResolve()})}return this.removeDoms(),this.promiseResolve(),Promise.resolve()}min(){return this.close(!0)}resume(){return this.open(!0)}getPromise(){return this.promise}appendDoms(){this.options.overlay&&!this.hasOverlay&&(js.appendToBody(this.overlay),document.body.classList.add("wwise-no-scroll"),this.overlay.addEventListener("touchstart",e=>{e.preventDefault()})),js.appendToBody(this.dom)}removeDoms(){js.removeElement(this.dom),!this.options.keepOverlay&&this.overlay&&(js.removeElement(this.overlay),document.body.classList.remove("wwise-no-scroll"))}draggable(e=!0){this.topbar&&(e?(this.draggableMouseMoveHandler=this.handleDraggableMouseMove.bind(this),this.draggableMouseDownHandler=this.handleDraggableMouseDown.bind(this),this.draggableMouseUpHandler=this.handleDraggableMouseUp.bind(this),this.draggableMouseOutHandler=this.handleDraggableMouseOut.bind(this),window.addEventListener("mousemove",this.draggableMouseMoveHandler),window.addEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.addEventListener("mousedown",this.draggableMouseDownHandler),window.addEventListener("mouseup",this.draggableMouseUpHandler)):(window.removeEventListener("mousemove",this.draggableMouseMoveHandler),window.removeEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.removeEventListener("mousedown",this.draggableMouseDownHandler),window.removeEventListener("mouseup",this.draggableMouseUpHandler)))}handleDraggableMouseMove(e){if(this.inDragging){let i={x:e.clientX-this.dragPrev.x,y:e.clientY-this.dragPrev.y},s=window.getComputedStyle(this.wrapper),a=this.options.draggable,h=parseFloat(s.left),f=parseFloat(s.top);if(s.left.indexOf("%")!=-1){h=s.left,h=h.substr(0,h.length-1),h=parseInt(h);let k=window,et=document,tt=et.documentElement,rt=et.getElementsByTagName("body")[0];h=h*(k.innerWidth||tt.clientWidth||rt.clientWidth)/100}if(s.top.indexOf("%")!=-1){f=s.top,f=f.substr(0,f.length-1),f=parseInt(f);let k=window,et=document,tt=et.documentElement,rt=et.getElementsByTagName("body")[0];f=f*(k.innerHeight||tt.clientHeight||rt.clientHeight)/100}a!=1&&a!="horizontal"||(this.wrapper.style.left=h+i.x+"px"),a!=1&&a!="vertical"||(this.wrapper.style.top=f+i.y+"px"),this.dragPrev={x:e.clientX,y:e.clientY}}}handleDraggableMouseDown(e){this.inDragging=!0,this.dragPrev={x:e.clientX,y:e.clientY}}handleDraggableMouseUp(e){this.inDragging=!1}handleDraggableMouseOut(e){let i=e.relatedTarget;i&&i.nodeName!="HTML"||(this.inDragging=!1)}}var mF=aR,lR=class{constructor(c){let e=this.options=c;!e.type&&(e.type="ok");let i={topbar:!1};i.content=this.constructContent({type:e.type,title:e.title,text:e.text,content:e.content,buttons:e.buttons}),i.overlay=!0,i.keepOverlay=e.keepOverlay,i.clickOverlayToClose=!1,i.animation=e.animation,i.zIndex=e.zIndex,this.wwise=new mF(i)}constructContent(c){let e=js.createDiv("modal"),i=js.createDomTree({dom:js.createDiv("main "+c.type),children:[js.createDiv(null,js.makeIconHTML(c.type)),js.createDiv("title",c.title),js.createDiv("text",c.text)]});this.buttonArr=js.standardizeButtons(this,c);let s=js.makeButtons(this.buttonArr),a=null;c.content&&(a=typeof c.content=="string"?js.createDiv(null,c.content):c.content);let h=null;return s.innerHTML&&(h=js.createDomTree({dom:js.createDiv("operation "+c.type),children:[s]})),a||h||i.classList.add("no-op"),js.createDomTree({dom:e,children:[i,a,h]})}open(){if(this.wwise.opened)return;let c=this.wwise.open();return this.value=void 0,this.promise=new Promise(e=>{this.promiseResolve=e}),this.wwise.getPromise().then(this.handlePromiseResolve.bind(this)),this.keyHandler=js.bindButtonKeyEvents(this.buttonArr),this.options.closeAfter&&window.setTimeout(()=>{this.close("timer")},this.options.closeAfter),c}close(c){if(this.wwise.opened)return this.value=c,js.unbindButtonKeyEvents(this.keyHandler),this.wwise.close()}getPromise(){return this.promise}handlePromiseResolve(){this.promiseResolve(this.value)}};let gF={showCancel:!1,okText:"OK",cancelText:"Cancel",placeholder:"",validator:null},vF={type:"info",keepOverlay:!1,title:"Input",text:"",zIndex:null};var X2=__webpackgi_require__(513),IM={};X2.Z&&X2.Z.locals&&(IM.locals=X2.Z.locals);var cR,uR=0,f1={};f1.styleTagTransform=BC(),f1.setAttributes=kC(),f1.insert=function(c,e){(e.target||document.head).appendChild(c)},f1.domAPI=xE(),f1.insertStyleElement=Px(),IM.use=function(c){return f1.options=c||{},uR++||(cR=RC()(X2.Z,f1)),IM},IM.unuse=function(){uR>0&&!--uR&&(cR(),cR=null)};var _F=IM;class hR extends Js{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._previousMappings={}}async onAdded(e){await super.onAdded(e),this._previousMappings={alert:e.alert,confirm:e.confirm,prompt:e.prompt},js.appendToBody=i=>{e.container.appendChild(i)},js.makeIconHTML=i=>"",_F.use({target:e.container}),e.alert=async i=>{const s=i==null?void 0:i.split(":")[0],a=new lR({type:"info",title:s??"&ndsp;",text:(i==null?void 0:i.replace(s+":",""))||"",buttons:[{key:13,text:"OK",type:"main",id:"ok"}],animation:"overlay"});return a.open(),a.getPromise()},e.confirm=async i=>{const s=i==null?void 0:i.split(":")[0],a=new lR({type:"info",title:s??"&ndsp;",text:(i==null?void 0:i.replace(s||"","").replace(":",""))||"",buttons:[{id:"no",key:27,text:"No",normal:!0},{id:"yes",key:13,text:"Yes"}],animation:"overlay"});return a.open(),await a.getPromise()==="yes"},e.prompt=async(i,s,a=!0)=>{const h=i==null?void 0:i.split(":")[0],f=new class{constructor(k){this.options=JSON.parse(JSON.stringify(gF));for(let lt in k)k[lt]!=null&&(this.options[lt]=k[lt]);let et=this.options,tt=JSON.parse(JSON.stringify(vF));for(let lt in tt)et.hasOwnProperty(lt)&&(tt[lt]=et[lt]);let rt=[];et.showCancel&&rt.push({key:27,text:et.cancelText,normal:!0,onClick:this.handleCancel.bind(this)}),rt.push({key:13,text:et.okText,onClick:this.handleOk.bind(this)}),tt.buttons=rt,this.input=js.createElement("input","input",null,{placeholder:et.placeholder}),this.error=js.createDiv("error"),tt.content=js.createDomTree({dom:js.createDiv("input-wrapper"),children:[this.input,this.error]}),this.modal=new lR(tt)}handleCancel(){this.close().then(this.promiseReject.bind(this))}handleOk(){this.options.validator?this.options.validator(this.input.value).then(()=>{this.close().then(this.promiseResolve.bind(this,this.input.value))},k=>{this.error.innerText=k}):this.close().then(this.promiseResolve.bind(this,this.input.value))}open(){if(this.modal.wwise.opened)return;let k=this.modal.open();return this.input.value="",this.error.innerText="",this.input.focus(),this.promise=new Promise((et,tt)=>{this.promiseResolve=et,this.promiseReject=tt}),k}close(){if(this.modal.wwise.opened)return this.modal.close()}getPromise(){return this.promise}}({type:"info",title:h??"&ndsp;",placeholder:s??"",showCancel:a,animation:"overlay",text:(i==null?void 0:i.replace(h||"","").replace(":",""))||""});return f.open(),await f.getPromise().catch(async()=>null)}}async onRemove(e){return e.alert=this._previousMappings.alert,e.confirm=this._previousMappings.confirm,e.prompt=this._previousMappings.prompt,super.onRemove(e)}}hR.PluginType="WindowiseDialogPlugin";var yF=c2({defaultModifiers:[dD,fD,mD,h2]}),AF=__webpackgi_require__(388),wF=__webpackgi_require__.n(AF);function xF(c){const e=[];c.traverse(a=>{a.geometry&&e.push(a)});const i={},s={};e.forEach(a=>{var h;if(!i[a.geometry.uuid]){const et=a.geometry.toJSON().data,tt=et?wF()({a:et.attributes||{},b:et.index||[]}):"";i[a.geometry.uuid]=tt}const f=i[a.geometry.uuid],k=(h=s[f])!==null&&h!==void 0?h:s[f]=[];k.includes(a)||k.push(a)}),Object.values(s).forEach(a=>{if(a.length<2)return;const h=a[0].geometry;a.forEach((f,k)=>{k<1||(f.geometry.dispose(),f.geometry=h)})})}const hA=new d.Pa4,m1=new d.Pa4,K2=new d.Pa4,dR=new d.Pa4,$2=new d.Pa4,CS=new d.Pa4;let pR=1;const bF=new d.Pa4(0,1,0);class EF extends Qv{constructor(e,i){super(e,i),this.targetOffset=new d.Pa4(0,0,0);const s=this.update;this.update=()=>this._update(s)}_update(e){this.target.add(this.targetOffset),hA.copy(this.object.position).sub(this.target),pR=hA.length(),CS.copy(this.target);const i=e();return CS.sub(this.target),hA.copy(this.object.position).sub(this.target),pR/=hA.length(),this.target.add(CS),this.object.position.copy(this.target).add(hA),hA.normalize(),m1.crossVectors(bF,hA).normalize(),K2.crossVectors(hA,m1).normalize(),dR.crossVectors(m1,K2).normalize().negate(),m1.length()>.1&&this.object.up.crossVectors(hA.clone().normalize(),m1),this.enablePan&&($2.set(0,0,0).addScaledVector(m1,CS.x).addScaledVector(K2,CS.y).addScaledVector(dR,CS.z),this.targetOffset.add($2),this.targetOffset.multiplyScalar(1/pR)),$2.set(0,0,0).addScaledVector(m1,-this.targetOffset.x).addScaledVector(K2,-this.targetOffset.y).addScaledVector(dR,-this.targetOffset.z),this.object.lookAt($2.add(this.target)),this.object.updateMatrixWorld(),this.object.isCamera&&this.object.updateProjectionMatrix(),this.target.sub(this.targetOffset),i}}class SF extends KS{constructor(){super(),this.boundingScaleMultiplier=1.2,this._initGeometry(new d.cJO(1,0))}}function fR(c,e){var i,s;const a=Array.from(((i=c.access)!==null&&i!==void 0?i:"").split(".")),h=a.pop();let f=(s=c.targetObject)!==null&&s!==void 0?s:e;if(!h||h.length===0)return{key:void 0,tar:f};if(f=Lt(a,f),f&&!(h in f))throw console.error("invalid key",h,f,e,c),"";return{key:h,tar:f}}function mR(c,e,i,s){const{key:a,tar:h}=fR(c,e);return a&&h?ax(h,a,()=>{var f;i&&(!((f=c.updater)===null||f===void 0)&&f.length)&&c.updater.forEach(k=>i[k]()),s==null||s()}):f=>console.warn("Unable to set ",f,a,h,c,e)}async function J2(c,e,i){var s,a,h,f;const{key:k,tar:et}=fR(e,c),tt=e.animSet?[NO(et,e.animSet,i,(s=e.animSetParallel)!==null&&s!==void 0&&s)]:[];if(k&&et){const rt=(f=e.updater)!==null&&f!==void 0?f:[],lt=async()=>lx(et,k,{...e,onUpdate:pt=>{var ft;(ft=e.onUpdate)===null||ft===void 0||ft.call(e,pt),rt.forEach(vt=>{var yt;return(yt=i[vt])===null||yt===void 0?void 0:yt.call(i)})}});e.delay?tt.push(au(e.delay).then(lt)):tt.push(lt())}else(e.duration||e.delay)&&tt.push(au(((a=e.delay)!==null&&a!==void 0?a:0)+((h=e.duration)!==null&&h!==void 0?h:0)));return tt.length===1?tt[0]:Promise.all(tt)}async function NO(c,e,i,s=!1){if(s)return Promise.all(e.map(async a=>J2(c,a,i)));for(const a of e)await J2(c,a,i)}function FO(c,e,i,s){var a,h,f,k,et,tt,rt;if(!c)return;e||(e=[]);const lt=s??{},pt=c;for(let ft=0,vt=e.length;ft<vt;ft++){const yt=e[ft];if(yt.uiRef){const xt=(et=pt==null?void 0:pt.indexOf(yt.uiRef))!==null&&et!==void 0?et:-1;xt!==ft&&(xt>=0&&(pt==null||pt.splice(xt,1)),pt==null||pt.splice(ft,0,yt.uiRef))}else{yt.uiRef={type:"folder",label:(a=yt.name)!==null&&a!==void 0?a:"Animation "+ft,children:[]};const xt=[{type:"button",label:"animate",value:()=>{J2(i,yt,lt).then(()=>{var Et;return console.log(((Et=yt.uiRef)===null||Et===void 0?void 0:Et.label)+" finished")})}}];yt.access!==void 0&&xt.push({type:"input",property:[yt,"access"]}),yt.from!==void 0&&xt.push({type:(h=yt.uiObjectType)!==null&&h!==void 0?h:"input",property:[yt,"from"],onChange:()=>{var Et;mR(yt,i)(yt.from),(Et=yt.updater)===null||Et===void 0||Et.forEach(At=>At in lt&&lt[At]())}}),yt.to!==void 0&&xt.push({type:(f=yt.uiObjectType)!==null&&f!==void 0?f:"input",property:[yt,"to"],onChange:()=>{var Et;mR(yt,i)(yt.to),(Et=yt.updater)===null||Et===void 0||Et.forEach(At=>At in lt&&lt[At]())}}),yt.duration!==void 0&&xt.push({type:"input",property:[yt,"duration"]}),yt.animSet&&(yt.animSetParallel||(yt.animSetParallel=!1),xt.push({type:"input",label:"run parallel",property:[yt,"animSetParallel"]})),yt.animSet&&xt.push({type:"folder",label:"AnimSet",expanded:!1,children:[],animSetContainer:!0}),(k=yt.uiRef.children)===null||k===void 0||k.push(...xt),pt==null||pt.splice(ft,0,yt.uiRef)}const Mt=(tt=yt.uiRef.children)===null||tt===void 0?void 0:tt.map(xt=>Ht(xt)).flat(2).find(xt=>xt==null?void 0:xt.animSetContainer);yt.animSet&&Mt&&FO(Mt.children,yt.animSet,(rt=yt.targetObject)!==null&&rt!==void 0?rt:i,s)}}function UO(c,e){return e?c*(1e3/e):0}function CF(c){var e,i=c.from,s=i===void 0?0:i,a=c.velocity,h=a===void 0?0:a,f=c.min,k=c.max,et=c.power,tt=et===void 0?.8:et,rt=c.timeConstant,lt=rt===void 0?750:rt,pt=c.bounceStiffness,ft=pt===void 0?500:pt,vt=c.bounceDamping,yt=vt===void 0?10:vt,Mt=c.restDelta,xt=Mt===void 0?1:Mt,Et=c.modifyTarget,At=c.driver,Rt=c.onUpdate,Bt=c.onComplete;function Qt(Cn){return f!==void 0&&Cn<f||k!==void 0&&Cn>k}function Wt(Cn){return f===void 0?k:k===void 0||Math.abs(f-Cn)<Math.abs(k-Cn)?f:k}function tn(Cn){e==null||e.stop(),e=XA(ou(ou({},Cn),{driver:At,onUpdate:function(Fn){var Tn;Rt==null||Rt(Fn),(Tn=Cn.onUpdate)===null||Tn===void 0||Tn.call(Cn,Fn)},onComplete:Bt}))}function pn(Cn){tn(ou({type:"spring",stiffness:ft,damping:yt,restDelta:xt},Cn))}if(Qt(s))pn({from:s,velocity:h,to:Wt(s)});else{var yn=tt*h+s;Et!==void 0&&(yn=Et(yn));var En,wn,In=Wt(yn),xn=In===f?-1:1;tn({type:"decay",from:s,velocity:h,timeConstant:lt,power:tt,restDelta:xt,modifyTarget:Et,onUpdate:Qt(yn)?function(Cn){En=wn,wn=Cn,h=UO(Cn-En,lE().delta),(xn===1&&Cn>In||xn===-1&&Cn<In)&&pn({from:Cn,to:In,velocity:h})}:void 0})}return{stop:function(){return e==null?void 0:e.stop()}}}var jO=function(c){return 180*c/Math.PI},MF=function(c,e){return e===void 0&&(e=nx),jO(Math.atan2(e.y-c.y,e.x-c.x))},TF=function(c,e){var i=!0;return e===void 0&&(e=c,i=!1),function(s){return i?s-c+e:(c=s,i=!0,e)}},IF=function(c){return c},gR=function(c){return c===void 0&&(c=IF),function(e,i,s){var a=i-s,h=-(0-e+1)*(0-c(Math.abs(a)));return a<=0?i+h:i-h}},PF=gR(),DF=gR(Math.sqrt),zO=function(c){return c*Math.PI/180},Z2=function(c){return c.hasOwnProperty("x")&&c.hasOwnProperty("y")},vR=function(c){return Z2(c)&&c.hasOwnProperty("z")},eP=function(c,e){return Math.abs(c-e)};function RF(c,e){if(J1(c)&&J1(e))return eP(c,e);if(Z2(c)&&Z2(e)){var i=eP(c.x,e.x),s=eP(c.y,e.y),a=vR(c)&&vR(e)?eP(c.z,e.z):0;return Math.sqrt(Math.pow(i,2)+Math.pow(s,2)+Math.pow(a,2))}}var kF=function(c,e,i){return e=zO(e),{x:i*Math.cos(e)+c.x,y:i*Math.sin(e)+c.y}},VO=function(c,e){return e===void 0&&(e=2),e=Math.pow(10,e),Math.round(c*e)/e},QO=function(c,e,i,s){return s===void 0&&(s=0),VO(c+i*(e-c)/Math.max(s,i))},BF=function(c){c===void 0&&(c=50);var e=0,i=0;return function(s){var a=lE().timestamp,h=a!==i?a-i:0,f=h?QO(e,s,h,c):e;return i=a,e=f,f}},OF=function(c){if(typeof c=="number")return function(s){return Math.round(s/c)*c};var e=0,i=c.length;return function(s){var a=Math.abs(c[0]-s);for(e=1;e<i;e++){var h=c[e],f=Math.abs(h-s);if(f===0)return h;if(f>a)return c[e-1];if(e===i-1)return h;a=f}}};function LF(c,e){return c/(1e3/e)}var NF=function(c,e,i){var s=e-c;return((i-c)%s+s)%s+c},GO=function(c,e){return 1-3*e+3*c},HO=function(c,e){return 3*e-6*c},WO=function(c){return 3*c},tP=function(c,e,i){return((GO(e,i)*c+HO(e,i))*c+WO(e))*c},qO=function(c,e,i){return 3*GO(e,i)*c*c+2*HO(e,i)*c+WO(e)},nP=.1;function FF(c,e,i,s){if(c===e&&i===s)return $w;for(var a=new Float32Array(11),h=0;h<11;++h)a[h]=tP(h*nP,c,i);return function(f){return f===0||f===1?f:tP(function(k){for(var et=0,tt=1;tt!==10&&a[tt]<=k;++tt)et+=nP;--tt;var rt=et+(k-a[tt])/(a[tt+1]-a[tt])*nP,lt=qO(rt,c,i);return lt>=.001?function(pt,ft,vt,yt){for(var Mt=0;Mt<8;++Mt){var xt=qO(ft,vt,yt);if(xt===0)return ft;ft-=(tP(ft,vt,yt)-pt)/xt}return ft}(k,rt,c,i):lt===0?rt:function(pt,ft,vt,yt,Mt){var xt,Et,At=0;do(xt=tP(Et=ft+(vt-ft)/2,yt,Mt)-pt)>0?vt=Et:ft=Et;while(Math.abs(xt)>1e-7&&++At<10);return Et}(k,et,et+nP,c,i)}(f),e,s)}}var UF=function(c,e){return e===void 0&&(e="end"),function(i){var s=(i=e==="end"?Math.min(i,.999):Math.max(i,.001))*c,a=e==="end"?Math.floor(s):Math.ceil(s);return Q0(0,1,a/c)}};async function jF(c,{debug:e=!1,ground:i=!0,bloom:s=!0,depthTonemap:a=!1,importPopup:h=!0,caching:f=!0}){const k=new Ym(c);k.enabled=!1,e&&await k.addPlugin(Tv),await k.addPlugin(Kr,void 0,void 0,{storage:f&&window.caches?await window.caches.open("webgi-cache-storage"):void 0}),await k.addPlugin(ZC),await k.addPlugin(XP),h&&await k.addPlugin(o0),await k.addPlugin(hR),await k.addPlugin($C),await k.addPlugin(ho),await k.addPlugin(d_),await k.addPlugin(XC),await k.addPlugin(zp),await k.addPlugin(HE),await k.addPlugin(YC),await k.addPlugin(Qw),await k.addPlugin(Uo,$S,!1,!0),await BE(k,{ground:i,bloom:s,depthTonemap:a}),await k.addPlugin(v2,!1),await k.addPlugin(g0,!1),await k.addPlugin(JE,!1),await k.addPlugin(vw,!1),await k.addPlugin(KD),await k.addPlugin(ZD),await k.addPlugin(eR),await k.addPlugin(iA,!1),await k.addPlugin(fy),await k.addPlugin(Uv),await k.addPlugin(jv),await k.addPlugin(a1),await k.addPlugin(Aw),await k.addPlugin(yw),await k.addPlugin(cy),await k.addPlugin(gm),await k.addPlugin(Q2),await k.addPlugin(V2),await k.addPlugin(G2),await k.addPlugin(H2),await k.addPlugin(uA),await k.addPlugin(q2),await k.addPlugin(z2);const et=await k.addPlugin(new oR(!Tw()));return k.renderer.refreshPipeline(),k.scene.addEventListener("textureAdded",tt=>{tt.texture&&k.scene.setEnvironment(tt.texture)}),et.setupPluginUi(su),et.setupPluginUi(uA),et.setupPluginUi(q2),et.setupPluginUi(Qw),et.setupPluginUi(z2),et.setupPluginUi(ZC),et.setupPluginUi(Rl),et.setupPluginUi(J_),et.setupPluginUi(Aw),et.setupPluginUi(a1),et.setupPluginUi(Q2),et.setupPluginUi(yw),et.setupPluginUi(Xl),et.setupPluginUi(Uo),i&&et.setupPluginUi(pm),et.setupPluginUi(O1),et.setupPluginUi(lu),et.setupPluginUi(cy),et.setupPluginUi(Rx),et.setupPluginUi(DE),et.setupPluginUi(kE),et.setupPluginUi(TE),et.setupPluginUi(IE),et.setupPluginUi(t0),et.setupPluginUi(N1),et.setupPluginUi(JE),et.setupPluginUi(vw),et.setupPluginUi(V2),et.setupPluginUi(fy),et.setupPluginUi(Uv),et.setupPluginUi(dp),et.setupPluginUi(G2),et.setupPluginUi(H2),et.setupPluginUi(Im),et.setupPluginUi(pp),s&&et.setupPluginUi(X0),et.setupPluginUi(gm),et.setupPluginUi(mm),et.setupPluginUi(wx),et.setupPluginUi(vm),et.setupPluginUi(v2),et.setupPluginUi(jv),et.setupPluginUi(X_),et.setupPluginUi(Ax),et.setupPluginUi(i0),et.setupPluginUi(np),et.setupPluginUi(g0),et.setupPluginUi(o0),et.setupPluginUi(_m),et.setupPluginUi(iA),k.enabled=!0,k}})();__webpackgi_exports__.LY2;__webpackgi_exports__.HRj;__webpackgi_exports__.li4;__webpackgi_exports__.FO5;__webpackgi_exports__.Nlh;__webpackgi_exports__.QvI;__webpackgi_exports__.JHp;__webpackgi_exports__.bGH;__webpackgi_exports__.NDo;__webpackgi_exports__.gSk;__webpackgi_exports__.WMw;__webpackgi_exports__.OTo;__webpackgi_exports__.Se2;__webpackgi_exports__.cum;__webpackgi_exports__.Mig;__webpackgi_exports__.B$7;__webpackgi_exports__.i_9;__webpackgi_exports__.m7l;__webpackgi_exports__.sYA;__webpackgi_exports__.Xcj;__webpackgi_exports__.mzJ;__webpackgi_exports__.ZZA;__webpackgi_exports__.$Ph;__webpackgi_exports__.T__;__webpackgi_exports__.HkE;__webpackgi_exports__.tGC;__webpackgi_exports__.g1S;__webpackgi_exports__.I$C;__webpackgi_exports__.QIH;__webpackgi_exports__._JE;var __webpackgi_exports__AssetManagerPlugin=__webpackgi_exports__.ksm;__webpackgi_exports__.jl_;__webpackgi_exports__.b7R;__webpackgi_exports__.BDV;__webpackgi_exports__.Ea_;__webpackgi_exports__.qff;__webpackgi_exports__.tmC;__webpackgi_exports__.BON;__webpackgi_exports__.P40;__webpackgi_exports__.wLL;__webpackgi_exports__.iHO;__webpackgi_exports__.BbS;__webpackgi_exports__.kqm;__webpackgi_exports__.Hmr;__webpackgi_exports__.SJI;__webpackgi_exports__.mTL;__webpackgi_exports__.y8_;__webpackgi_exports__._Li;__webpackgi_exports__.g56;__webpackgi_exports__.bj3;__webpackgi_exports__.z81;__webpackgi_exports__._MY;__webpackgi_exports__.yEv;var __webpackgi_exports__BloomPlugin=__webpackgi_exports__.dFZ;__webpackgi_exports__.N$j;__webpackgi_exports__._YM;__webpackgi_exports__.TUj;__webpackgi_exports__.ZzF;__webpackgi_exports__.qzb;__webpackgi_exports__.GQ;__webpackgi_exports__.nvb;__webpackgi_exports__.DvJ;__webpackgi_exports__.fQA;__webpackgi_exports__.cPz;__webpackgi_exports__.TlE;__webpackgi_exports__.u9r;__webpackgi_exports__.s4_;__webpackgi_exports__.T95;__webpackgi_exports__.F5w;__webpackgi_exports__.NlP;__webpackgi_exports__.$8Z;__webpackgi_exports__.YYN;__webpackgi_exports__.CtF;__webpackgi_exports__.V1s;__webpackgi_exports__.jOv;__webpackgi_exports__.Rki;__webpackgi_exports__.pzV;__webpackgi_exports__.itZ;__webpackgi_exports__.qKx;__webpackgi_exports__.vlJ;__webpackgi_exports__.nPO;__webpackgi_exports__.zcQ;__webpackgi_exports__.GH1;__webpackgi_exports__.ROQ;__webpackgi_exports__.YN5;__webpackgi_exports__.BVQ;__webpackgi_exports__.YT8;__webpackgi_exports__._DE;__webpackgi_exports__.YGz;__webpackgi_exports__.trn;__webpackgi_exports__.zf8;__webpackgi_exports__.uWy;__webpackgi_exports__.wYQ;__webpackgi_exports__.SUY;__webpackgi_exports__.Ilk;__webpackgi_exports__.R2R;__webpackgi_exports__.epp;__webpackgi_exports__.xmJ;__webpackgi_exports__.GD$;__webpackgi_exports__.EB7;__webpackgi_exports__.DqL;__webpackgi_exports__._3;__webpackgi_exports__.b_z;__webpackgi_exports__.OCn;__webpackgi_exports__._am;__webpackgi_exports__.kB7;__webpackgi_exports__.fY$;__webpackgi_exports__.vxC;__webpackgi_exports__.BtG;__webpackgi_exports__.cBK;__webpackgi_exports__.g8_;__webpackgi_exports__.AXT;__webpackgi_exports__.yj7;__webpackgi_exports__.dYG;__webpackgi_exports__.tm_;__webpackgi_exports__.S2y;__webpackgi_exports__.B02;__webpackgi_exports__.PeU;__webpackgi_exports__.Hyl;__webpackgi_exports__.Wqd;__webpackgi_exports__.Xaj;__webpackgi_exports__.DUb;__webpackgi_exports__.dZ3;__webpackgi_exports__.m_w;__webpackgi_exports__.fHI;__webpackgi_exports__.LBq;__webpackgi_exports__.dHf;__webpackgi_exports__.Qww;__webpackgi_exports__.CGV;__webpackgi_exports__.JUT;__webpackgi_exports__.p3g;__webpackgi_exports__.IEO;__webpackgi_exports__.CN8;__webpackgi_exports__.zob;__webpackgi_exports__.yxD;__webpackgi_exports__.CUS;__webpackgi_exports__.A5E;__webpackgi_exports__.zqG;__webpackgi_exports__.PfX;__webpackgi_exports__.Q1o;__webpackgi_exports__.jfJ;__webpackgi_exports__.T_J;__webpackgi_exports__.tEQ;__webpackgi_exports__.gb4;__webpackgi_exports__.qkB;__webpackgi_exports__.cvk;__webpackgi_exports__.HWo;__webpackgi_exports__.brP;__webpackgi_exports__.$YQ;__webpackgi_exports__.X8d;__webpackgi_exports__.Zdt;__webpackgi_exports__.yNB;__webpackgi_exports__.h7x;__webpackgi_exports__.Ox3;__webpackgi_exports__.qtn;__webpackgi_exports__.cBI;__webpackgi_exports__.cU9;__webpackgi_exports__.DT1;__webpackgi_exports__.Kgo;__webpackgi_exports__.ehD;__webpackgi_exports__.fhJ;__webpackgi_exports__.y1s;__webpackgi_exports__.fSK;__webpackgi_exports__.Vdb;__webpackgi_exports__.l8J;__webpackgi_exports__.dj0;__webpackgi_exports__.QM0;__webpackgi_exports__.OIS;__webpackgi_exports__.q8b;__webpackgi_exports__.TOt;__webpackgi_exports__.xaN;__webpackgi_exports__.Ny0;__webpackgi_exports__.NeD;__webpackgi_exports__.Zof;__webpackgi_exports__.eD;__webpackgi_exports__.jwo;__webpackgi_exports__.dSO;__webpackgi_exports__.Bf4;__webpackgi_exports__.USm;__webpackgi_exports__.pBf;__webpackgi_exports__.$Vf;__webpackgi_exports__.O7d;__webpackgi_exports__.ksq;__webpackgi_exports__.gXf;__webpackgi_exports__.hH6;__webpackgi_exports__.kpi;__webpackgi_exports__.DwZ;__webpackgi_exports__.kN3;__webpackgi_exports__.e62;__webpackgi_exports__.a$l;__webpackgi_exports__.OM3;__webpackgi_exports__.VzW;__webpackgi_exports__.ybr;__webpackgi_exports__.yo9;__webpackgi_exports__.$Bt;__webpackgi_exports__.Wzm;__webpackgi_exports__.Wl3;__webpackgi_exports__.iWj;__webpackgi_exports__.DNz;var __webpackgi_exports__GBufferPlugin=__webpackgi_exports__.m1M;__webpackgi_exports__.ylh;__webpackgi_exports__.v9Y;__webpackgi_exports__.LSk;__webpackgi_exports__.LHE;__webpackgi_exports__.KE0;__webpackgi_exports__.KCF;__webpackgi_exports__.a4n;__webpackgi_exports__.zIH;__webpackgi_exports__.Hfk;__webpackgi_exports__.png;__webpackgi_exports__.tAj;__webpackgi_exports__.Eb_;__webpackgi_exports__.BT2;__webpackgi_exports__._8p;__webpackgi_exports__.V5Z;var __webpackgi_exports__GammaCorrectionPlugin=__webpackgi_exports__.s5b;__webpackgi_exports__.hkn;__webpackgi_exports__.GFY;__webpackgi_exports__.w$m;__webpackgi_exports__.ksN;__webpackgi_exports__.j4z;__webpackgi_exports__.OAl;__webpackgi_exports__.VLJ;__webpackgi_exports__.C73;__webpackgi_exports__.ZAu;__webpackgi_exports__.ibP;__webpackgi_exports__._fI;__webpackgi_exports__.hUN;__webpackgi_exports__.cLu;__webpackgi_exports__.vmT;__webpackgi_exports__.Qpg;__webpackgi_exports__.So8;__webpackgi_exports__.eOv;__webpackgi_exports__.Wjw;__webpackgi_exports__.cJO;__webpackgi_exports__.QRU;__webpackgi_exports__.S3k;__webpackgi_exports__.PpQ;__webpackgi_exports__.AHu;__webpackgi_exports__.q_9;__webpackgi_exports__.ZRs;__webpackgi_exports__.oqc;__webpackgi_exports__.T_x;__webpackgi_exports__.lb7;__webpackgi_exports__.L5s;__webpackgi_exports__.$TI;__webpackgi_exports__.SPe;__webpackgi_exports__.aVm;__webpackgi_exports__.j87;__webpackgi_exports__.RNb;__webpackgi_exports__.Kz5;__webpackgi_exports__.vpT;__webpackgi_exports__.kB5;__webpackgi_exports__._C8;__webpackgi_exports__.Syv;__webpackgi_exports__.NMF;__webpackgi_exports__.pIN;__webpackgi_exports__.eMJ;__webpackgi_exports__.rN7;__webpackgi_exports__.iUp;__webpackgi_exports__.GFd;__webpackgi_exports__.x5V;__webpackgi_exports__.tUh;__webpackgi_exports__.z8B;__webpackgi_exports__.vcl;__webpackgi_exports__.GZb;__webpackgi_exports__.p7y;__webpackgi_exports__.S9g;__webpackgi_exports__.Zr5;__webpackgi_exports__.vCF;__webpackgi_exports__.yt0;__webpackgi_exports__.uXU;__webpackgi_exports__._kC;__webpackgi_exports__.lk7;__webpackgi_exports__.USc;__webpackgi_exports__.x12;__webpackgi_exports__.Zzh;__webpackgi_exports__.nls;__webpackgi_exports__.g_z;__webpackgi_exports__.U7;__webpackgi_exports__.FT0;__webpackgi_exports__.blk;__webpackgi_exports__.ejS;__webpackgi_exports__.rnI;__webpackgi_exports__.wem;__webpackgi_exports__.lfu;__webpackgi_exports__.FDw;__webpackgi_exports__.lRj;__webpackgi_exports__.D1R;__webpackgi_exports__.qyh;__webpackgi_exports__.GUF;__webpackgi_exports__.EoG;__webpackgi_exports__.aNw;__webpackgi_exports__.Zp0;__webpackgi_exports__.lLk;__webpackgi_exports__.jAl;__webpackgi_exports__.uEv;__webpackgi_exports__.YKA;__webpackgi_exports__.cRx;__webpackgi_exports__.Y8D;__webpackgi_exports__.RsA;__webpackgi_exports__.Y0m;__webpackgi_exports__.F5T;__webpackgi_exports__.EDU;__webpackgi_exports__.z$Q;__webpackgi_exports__.KA8;__webpackgi_exports__.XUj;__webpackgi_exports__.Me$;__webpackgi_exports__.u7G;__webpackgi_exports__.PEk;__webpackgi_exports__.BG4;__webpackgi_exports__.M8C;__webpackgi_exports__.Vkp;__webpackgi_exports__.yGw;__webpackgi_exports__.Sm8;__webpackgi_exports__.Kj0;__webpackgi_exports__.vBJ;__webpackgi_exports__.QfV;__webpackgi_exports__.lRF;__webpackgi_exports__.Lun;__webpackgi_exports__.YBo;__webpackgi_exports__.kaV;__webpackgi_exports__.RSm;__webpackgi_exports__.xoR;__webpackgi_exports__.EJi;__webpackgi_exports__.Wid;__webpackgi_exports__.iuj;__webpackgi_exports__.IKL;__webpackgi_exports__.r_;__webpackgi_exports__.OoA;__webpackgi_exports__.qhX;__webpackgi_exports__.qPT;__webpackgi_exports__.M5h;__webpackgi_exports__.Ns1;__webpackgi_exports__.TyD;__webpackgi_exports__.vZf;__webpackgi_exports__.HTd;__webpackgi_exports__.aH4;__webpackgi_exports__.YLQ;__webpackgi_exports__.BVF;__webpackgi_exports__.MyG;__webpackgi_exports__.jFi;__webpackgi_exports__.aCh;__webpackgi_exports__.uL9;__webpackgi_exports__.TNj;__webpackgi_exports__.IFH;__webpackgi_exports__.bdR;__webpackgi_exports__.kM_;__webpackgi_exports__.M6v;__webpackgi_exports__.RvT;__webpackgi_exports__.dUE;__webpackgi_exports__.oe_;__webpackgi_exports__.BuN;__webpackgi_exports__.Tme;__webpackgi_exports__.N9P;__webpackgi_exports__.Gql;__webpackgi_exports__.$XY;__webpackgi_exports__.O9d;__webpackgi_exports__.zEO;__webpackgi_exports__.qfx;__webpackgi_exports__.PA7;__webpackgi_exports__.REq;__webpackgi_exports__.pQR;__webpackgi_exports__.ghN;__webpackgi_exports__.Hy8;__webpackgi_exports__.Wpd;__webpackgi_exports__.LgZ;__webpackgi_exports__.iWC;__webpackgi_exports__.mqn;__webpackgi_exports__.SKe;__webpackgi_exports__.iKG;__webpackgi_exports__._iA;__webpackgi_exports__.ntZ;__webpackgi_exports__.anP;__webpackgi_exports__.X2e;__webpackgi_exports__.FCo;__webpackgi_exports__.y$t;__webpackgi_exports__.cPb;__webpackgi_exports__.lmx;__webpackgi_exports__.JOQ;__webpackgi_exports__.BKK;__webpackgi_exports__._12;__webpackgi_exports__.tJx;__webpackgi_exports__.cek;__webpackgi_exports__.qD0;__webpackgi_exports__.xG9;__webpackgi_exports__.wI8;__webpackgi_exports__.Sgv;__webpackgi_exports__.woe;__webpackgi_exports__.UY4;__webpackgi_exports__.aq0;__webpackgi_exports__.ujx;__webpackgi_exports__.Uol;__webpackgi_exports__.JiH;__webpackgi_exports__.VYz;__webpackgi_exports__._Pm;var __webpackgi_exports__ProgressivePlugin=__webpackgi_exports__.EsW;__webpackgi_exports__.iUV;__webpackgi_exports__.tf;__webpackgi_exports__.ZQ6;__webpackgi_exports__.mXe;__webpackgi_exports__._fP;__webpackgi_exports__.iLg;__webpackgi_exports__.zbs;__webpackgi_exports__.UZH;__webpackgi_exports__.mSO;__webpackgi_exports__.wk1;__webpackgi_exports__.E2K;__webpackgi_exports__.FUD;__webpackgi_exports__.pKu;__webpackgi_exports__.GG6;__webpackgi_exports__.Gih;__webpackgi_exports__.iiP;__webpackgi_exports__.SvJ;__webpackgi_exports__.ptH;__webpackgi_exports__.jZA;__webpackgi_exports__.y2t;__webpackgi_exports__.gi4;__webpackgi_exports__.Djp;__webpackgi_exports__.BG$;__webpackgi_exports__.NYV;__webpackgi_exports__.xJs;__webpackgi_exports__.bsb;__webpackgi_exports__.ekQ;__webpackgi_exports__.CaW;__webpackgi_exports__.eaV;__webpackgi_exports__.BFQ;__webpackgi_exports__.v3W;__webpackgi_exports__.ILR;__webpackgi_exports__.UCm;__webpackgi_exports__.Inb;__webpackgi_exports__.U1$;__webpackgi_exports__.LgE;__webpackgi_exports__.fto;__webpackgi_exports__.l0P;__webpackgi_exports__.vCx;__webpackgi_exports__._AM;__webpackgi_exports__.wuA;__webpackgi_exports__.av9;__webpackgi_exports__.CtA;__webpackgi_exports__.BvQ;__webpackgi_exports__.FZJ;__webpackgi_exports__.FIo;__webpackgi_exports__.zHn;__webpackgi_exports__.iMs;__webpackgi_exports__.T_f;__webpackgi_exports__.hEm;__webpackgi_exports__.D9w;__webpackgi_exports__.sHH;__webpackgi_exports__.CdI;__webpackgi_exports__.rkc;__webpackgi_exports__.rpg;__webpackgi_exports__.ce8;__webpackgi_exports__.rOj;__webpackgi_exports__.P6m;__webpackgi_exports__.JA6;__webpackgi_exports__.V4E;__webpackgi_exports__.o8S;__webpackgi_exports__.flB;__webpackgi_exports__.DUH;__webpackgi_exports__.KI_;var __webpackgi_exports__SSAOPlugin=__webpackgi_exports__.iLN;__webpackgi_exports__.jsw;__webpackgi_exports__.srG;var __webpackgi_exports__SSRPlugin=__webpackgi_exports__.i6Z;__webpackgi_exports__.vfv;__webpackgi_exports__.xsS;__webpackgi_exports__.or;__webpackgi_exports__.EQj;__webpackgi_exports__.ov0;__webpackgi_exports__.WdD;__webpackgi_exports__.Vj0;__webpackgi_exports__.jyz;__webpackgi_exports__.mTM;__webpackgi_exports__.Mn1;__webpackgi_exports__.Hlq;__webpackgi_exports__.Fi7;__webpackgi_exports__.Tn7;__webpackgi_exports__.bnF;__webpackgi_exports__.HW6;__webpackgi_exports__.oa8;__webpackgi_exports__.T_1;__webpackgi_exports__.zHJ;__webpackgi_exports__.iDF;__webpackgi_exports__.iAb;__webpackgi_exports__.d4E;__webpackgi_exports__.lBg;__webpackgi_exports__.JeJ;__webpackgi_exports__.FKY;__webpackgi_exports__.zlZ;__webpackgi_exports__.vkg;__webpackgi_exports__.brh;__webpackgi_exports__.kZK;__webpackgi_exports__.puG;__webpackgi_exports__.OdW;__webpackgi_exports__._YX;__webpackgi_exports__.TUv;__webpackgi_exports__.Hw6;__webpackgi_exports__.aLr;__webpackgi_exports__.Aip;__webpackgi_exports__.xo$;__webpackgi_exports__.bIn;__webpackgi_exports__.$V;__webpackgi_exports__.lDi;__webpackgi_exports__.gti;__webpackgi_exports__.PMe;__webpackgi_exports__.iwP;__webpackgi_exports__.FvO;__webpackgi_exports__.jyi;__webpackgi_exports__.xeV;__webpackgi_exports__.k74;__webpackgi_exports__.RlZ;__webpackgi_exports__.KhW;__webpackgi_exports__.HgB;__webpackgi_exports__.W2J;__webpackgi_exports__.JWc;__webpackgi_exports__.u37;__webpackgi_exports__.Z6B;__webpackgi_exports__.QZ1;__webpackgi_exports__.Ir4;__webpackgi_exports__.NwF;__webpackgi_exports__.Wbm;__webpackgi_exports__.N4l;__webpackgi_exports__.ej9;__webpackgi_exports__.QmN;__webpackgi_exports__.IOt;__webpackgi_exports__.NOD;__webpackgi_exports__.L5g;__webpackgi_exports__.H$k;__webpackgi_exports__.cuP;__webpackgi_exports__.xEZ;__webpackgi_exports__.dpR;__webpackgi_exports__.wOD;__webpackgi_exports__.KNb;var __webpackgi_exports__TonemapPlugin=__webpackgi_exports__.IiN;__webpackgi_exports__.Cne;__webpackgi_exports__.XvJ;__webpackgi_exports__.XZw;__webpackgi_exports__.FE5;__webpackgi_exports__.lVp;__webpackgi_exports__.CJI;__webpackgi_exports__.z$h;__webpackgi_exports__.UlW;__webpackgi_exports__.WwZ;__webpackgi_exports__.Lcc;__webpackgi_exports__.WXh;__webpackgi_exports__.Vjr;__webpackgi_exports__.LuM;__webpackgi_exports__.LP5;__webpackgi_exports__.xfE;__webpackgi_exports__.qlB;__webpackgi_exports__.lCJ;__webpackgi_exports__.WTc;__webpackgi_exports__.rAo;__webpackgi_exports__.LZj;__webpackgi_exports__.xWb;__webpackgi_exports__.gH0;__webpackgi_exports__.rBU;__webpackgi_exports__.rDY;__webpackgi_exports__.ywz;__webpackgi_exports__.wJv;__webpackgi_exports__.JQ4;__webpackgi_exports__.k0A;__webpackgi_exports__.irR;__webpackgi_exports__.LsT;__webpackgi_exports__.q5h;__webpackgi_exports__.TKh;__webpackgi_exports__.tyg;__webpackgi_exports__.Ro5;__webpackgi_exports__.dwk;__webpackgi_exports__.FM8;__webpackgi_exports__.Pa4;__webpackgi_exports__.Ltg;__webpackgi_exports__.yC1;__webpackgi_exports__.lHq;__webpackgi_exports__.fO1;var __webpackgi_exports__ViewerApp=__webpackgi_exports__.oMA;__webpackgi_exports__.JzW;__webpackgi_exports__.QEt;__webpackgi_exports__.b5g;__webpackgi_exports__.Ywn;__webpackgi_exports__.GVz;__webpackgi_exports__.oAp;__webpackgi_exports__.kFz;__webpackgi_exports__.p7A;__webpackgi_exports__.dd2;__webpackgi_exports__.CP7;__webpackgi_exports__.fQK;__webpackgi_exports__.Wd$;__webpackgi_exports__.t1_;__webpackgi_exports__.Uk6;__webpackgi_exports__._sL;__webpackgi_exports__.Pnf;__webpackgi_exports__.c8b;__webpackgi_exports__._lf;__webpackgi_exports__.ad5;__webpackgi_exports__.sZV;__webpackgi_exports__.TfA;__webpackgi_exports__.sKX;__webpackgi_exports__.UdM;__webpackgi_exports__.P0y;__webpackgi_exports__.L_r;__webpackgi_exports__.Bve;__webpackgi_exports__.UeO;__webpackgi_exports__.$nx;__webpackgi_exports__.Bk6;__webpackgi_exports__.y4l;__webpackgi_exports__.pQ0;__webpackgi_exports__.wXW;__webpackgi_exports__.r5x;__webpackgi_exports__.MSI;__webpackgi_exports__.EUu;__webpackgi_exports__.jtH;__webpackgi_exports__.T0T;__webpackgi_exports__.gAb;__webpackgi_exports__.iwT;__webpackgi_exports__.je_;__webpackgi_exports__.wBP;__webpackgi_exports__.LU2;__webpackgi_exports__.wQL;__webpackgi_exports__.Zs7;__webpackgi_exports__.x7s;__webpackgi_exports__.Mnd;__webpackgi_exports__.A0_;__webpackgi_exports__.d73;__webpackgi_exports__.HCD;__webpackgi_exports__.RG9;__webpackgi_exports__.G2P;__webpackgi_exports__.XLf;__webpackgi_exports__.CGN;__webpackgi_exports__.mvg;__webpackgi_exports__.Hiy;__webpackgi_exports__.XMc;__webpackgi_exports__.N7M;__webpackgi_exports__.iv;__webpackgi_exports__.n55;__webpackgi_exports__.IaC;__webpackgi_exports__.h9t;__webpackgi_exports__.yDW;__webpackgi_exports__.gJv;__webpackgi_exports__.l$g;__webpackgi_exports__.vQi;__webpackgi_exports__.$MY;__webpackgi_exports__.wJl;__webpackgi_exports__.Z7Y;__webpackgi_exports__.X7D;__webpackgi_exports__.BnX;__webpackgi_exports__.uZ5;__webpackgi_exports__.zVI;__webpackgi_exports__.DpF;__webpackgi_exports__.nNb;__webpackgi_exports__.cqZ;__webpackgi_exports__.pKN;__webpackgi_exports__.d_$;__webpackgi_exports__.DdI;__webpackgi_exports__.rrX;__webpackgi_exports__.KlC;__webpackgi_exports__.KVn;__webpackgi_exports__.oau;__webpackgi_exports__.aw9;__webpackgi_exports__.Aap;__webpackgi_exports__.Dxg;__webpackgi_exports__.MjT;__webpackgi_exports__.F7Q;__webpackgi_exports__.IFq;__webpackgi_exports__.IJl;__webpackgi_exports__.O5A;__webpackgi_exports__.wCn;__webpackgi_exports__.gGT;__webpackgi_exports__.pEc;__webpackgi_exports__.Bi6;__webpackgi_exports__.fi_;__webpackgi_exports__.TT;__webpackgi_exports__.q2Z;__webpackgi_exports__.NyK;__webpackgi_exports__.bgu;__webpackgi_exports__.kcS;__webpackgi_exports__.rRN;__webpackgi_exports__.ivY;__webpackgi_exports__._s1;__webpackgi_exports__._HO;__webpackgi_exports__.tpL;__webpackgi_exports__.DMK;__webpackgi_exports__.LjN;__webpackgi_exports__.iFs;__webpackgi_exports__.qTg;__webpackgi_exports__.Wtl;__webpackgi_exports__.DmK;__webpackgi_exports__.Htt;__webpackgi_exports__.Hx7;__webpackgi_exports__.imt;__webpackgi_exports__.US6;__webpackgi_exports__.vZs;__webpackgi_exports__.TE$;__webpackgi_exports__.lmu;__webpackgi_exports__.SvO;__webpackgi_exports__.YQY;__webpackgi_exports__.mZN;__webpackgi_exports__.VvG;__webpackgi_exports__.omp;__webpackgi_exports__.utz;__webpackgi_exports__.TFV;__webpackgi_exports__.hrz;__webpackgi_exports__.JKM;__webpackgi_exports__.jZf;__webpackgi_exports__.RjL;__webpackgi_exports__.RRI;__webpackgi_exports__.RUq;__webpackgi_exports__._t4;__webpackgi_exports__.YHh;__webpackgi_exports__.R8g;__webpackgi_exports__.Bbl;__webpackgi_exports__.V9r;__webpackgi_exports__.PZ2;__webpackgi_exports__.w7A;__webpackgi_exports__.N6S;__webpackgi_exports__.Uxp;__webpackgi_exports__.tAz;__webpackgi_exports__.R$F;__webpackgi_exports__.N33;__webpackgi_exports__.gw2;__webpackgi_exports__.KlU;__webpackgi_exports__.wo6;__webpackgi_exports__.H4P;__webpackgi_exports__.swA;__webpackgi_exports__._Z3;__webpackgi_exports__.ivc;__webpackgi_exports__.rZ1;__webpackgi_exports__.CpZ;__webpackgi_exports__.dyc;__webpackgi_exports__.MxZ;__webpackgi_exports__.btp;__webpackgi_exports__.mXy;__webpackgi_exports__.Ej0;__webpackgi_exports__.ep4;__webpackgi_exports__.DQP;__webpackgi_exports__.VNr;__webpackgi_exports__.V7q;__webpackgi_exports__.zEk;__webpackgi_exports__.qfq;__webpackgi_exports__.piB;__webpackgi_exports__.IIc;__webpackgi_exports__.rrF;__webpackgi_exports__.naq;__webpackgi_exports__.sXR;__webpackgi_exports__.p5I;__webpackgi_exports__.wps;__webpackgi_exports__.wuo;__webpackgi_exports__.GpE;__webpackgi_exports__.F4b;__webpackgi_exports__.t$v;__webpackgi_exports__.tdn;__webpackgi_exports__.Y9t;__webpackgi_exports__.GEo;__webpackgi_exports__.DH3;__webpackgi_exports__.uxM;__webpackgi_exports__.zH3;__webpackgi_exports__.MLs;__webpackgi_exports__.xXG;__webpackgi_exports__.YM4;__webpackgi_exports__.B3r;__webpackgi_exports__.iAx;__webpackgi_exports__.lDn;__webpackgi_exports__.oaQ;__webpackgi_exports__.CD7;__webpackgi_exports__.Rc0;__webpackgi_exports__.iPG;var __webpackgi_exports__mobileAndTabletCheck=__webpackgi_exports__.TIc;__webpackgi_exports__.xsC;__webpackgi_exports__.zOc;__webpackgi_exports__.r46;__webpackgi_exports__.z2C;__webpackgi_exports__._X$;__webpackgi_exports__._yn;__webpackgi_exports__.Dyg;__webpackgi_exports__.cUc;__webpackgi_exports__.zGw;__webpackgi_exports__.Ctq;__webpackgi_exports__.$ch;__webpackgi_exports__.k5b;__webpackgi_exports__.kZl;__webpackgi_exports__.OCg;__webpackgi_exports__.YjH;__webpackgi_exports__.Ui8;__webpackgi_exports__.YD2;__webpackgi_exports__.vi9;__webpackgi_exports__.ij3;__webpackgi_exports__.YPW;__webpackgi_exports__.Bg1;__webpackgi_exports__.kon;__webpackgi_exports__.M3g;__webpackgi_exports__.F2z;__webpackgi_exports__.pJF;__webpackgi_exports__.knz;__webpackgi_exports__.Ejo;__webpackgi_exports__.BgY;__webpackgi_exports__.qCG;__webpackgi_exports__.HD9;__webpackgi_exports__.fEB;__webpackgi_exports__.Udc;__webpackgi_exports__.ZQg;__webpackgi_exports__.ofC;__webpackgi_exports__.yRy;__webpackgi_exports__._NL;__webpackgi_exports__.LCA;__webpackgi_exports__.j1w;__webpackgi_exports__.i8J;__webpackgi_exports__.p7C;__webpackgi_exports__.ZAS;__webpackgi_exports__.ipH;__webpackgi_exports__.$TF;__webpackgi_exports__.uZI;__webpackgi_exports__.VWG;__webpackgi_exports__.pQ7;__webpackgi_exports__.STw;__webpackgi_exports__.jc8;__webpackgi_exports__.BL_;__webpackgi_exports__.S6;__webpackgi_exports__.T8U;__webpackgi_exports__.TD6;__webpackgi_exports__.akS;__webpackgi_exports__.QKE;__webpackgi_exports__.dKx;__webpackgi_exports__.OvX;__webpackgi_exports__.VsW;__webpackgi_exports__.YMc;__webpackgi_exports__.aPg;__webpackgi_exports__.LFn;__webpackgi_exports__.wey;__webpackgi_exports__.MaE;__webpackgi_exports__.s4x;__webpackgi_exports__.FJA;__webpackgi_exports__.vIA;__webpackgi_exports__.Spv;__webpackgi_exports__.w8l;__webpackgi_exports__.riG;__webpackgi_exports__.Kbh;__webpackgi_exports__.t8K;__webpackgi_exports__.Q7n;__webpackgi_exports__.KGF;__webpackgi_exports__.e5;__webpackgi_exports__.Rik;__webpackgi_exports__.GZo;__webpackgi_exports__.Bds;__webpackgi_exports__.HTu;__webpackgi_exports__.cTq;__webpackgi_exports__.X_Y;__webpackgi_exports__.dA8;__webpackgi_exports__.bwS;__webpackgi_exports__.Lks;__webpackgi_exports__.Rvq;__webpackgi_exports__.P4F;__webpackgi_exports__.Pd0;__webpackgi_exports__.Pjo;__webpackgi_exports__.Tum;__webpackgi_exports__.dRH;__webpackgi_exports__.RX0;__webpackgi_exports__.reQ;__webpackgi_exports__.cWm;__webpackgi_exports__.NC9;__webpackgi_exports__.$Re;__webpackgi_exports__.Xo9;__webpackgi_exports__.LNO;__webpackgi_exports__.iZP;function _assertThisInitialized(b){if(b===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b}function _inheritsLoose(b,g){b.prototype=Object.create(g.prototype),b.prototype.constructor=b,b.__proto__=g}/*!
 * GSAP 3.12.2
 * https://greensock.com
 *
 * @license Copyright 2008-2023, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var _config={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},_defaults$1={duration:.5,overwrite:!1,delay:0},_suppressOverwrites$1,_reverting$1,_context$2,_bigNum$1=1e8,_tinyNum=1/_bigNum$1,_2PI=Math.PI*2,_HALF_PI=_2PI/4,_gsID=0,_sqrt=Math.sqrt,_cos=Math.cos,_sin=Math.sin,_isString$1=function b(g){return typeof g=="string"},_isFunction$1=function b(g){return typeof g=="function"},_isNumber$1=function b(g){return typeof g=="number"},_isUndefined=function b(g){return typeof g>"u"},_isObject$1=function b(g){return typeof g=="object"},_isNotFalse=function b(g){return g!==!1},_windowExists$2=function b(){return typeof window<"u"},_isFuncOrString=function b(g){return _isFunction$1(g)||_isString$1(g)},_isTypedArray=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},_isArray=Array.isArray,_strictNumExp=/(?:-?\.?\d|\.)+/gi,_numExp=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,_numWithUnitExp=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,_complexStringNumExp=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,_relExp=/[+-]=-?[.\d]+/,_delimitedValueExp=/[^,'"\[\]\s]+/gi,_unitExp=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,_globalTimeline,_win$3,_coreInitted$2,_doc$3,_globals={},_installScope={},_coreReady,_install=function b(g){return(_installScope=_merge(g,_globals))&&gsap$2},_missingPlugin=function b(g,j){return console.warn("Invalid property",g,"set to",j,"Missing plugin? gsap.registerPlugin()")},_warn=function b(g,j){return!j&&console.warn(g)},_addGlobal=function b(g,j){return g&&(_globals[g]=j)&&_installScope&&(_installScope[g]=j)||_globals},_emptyFunc=function b(){return 0},_startAtRevertConfig={suppressEvents:!0,isStart:!0,kill:!1},_revertConfigNoKill={suppressEvents:!0,kill:!1},_revertConfig={suppressEvents:!0},_reservedProps={},_lazyTweens=[],_lazyLookup={},_lastRenderedFrame,_plugins={},_effects={},_nextGCFrame=30,_harnessPlugins=[],_callbackNames="",_harness=function b(g){var j=g[0],d,nt;if(_isObject$1(j)||_isFunction$1(j)||(g=[g]),!(d=(j._gsap||{}).harness)){for(nt=_harnessPlugins.length;nt--&&!_harnessPlugins[nt].targetTest(j););d=_harnessPlugins[nt]}for(nt=g.length;nt--;)g[nt]&&(g[nt]._gsap||(g[nt]._gsap=new GSCache(g[nt],d)))||g.splice(nt,1);return g},_getCache=function b(g){return g._gsap||_harness(toArray(g))[0]._gsap},_getProperty=function b(g,j,d){return(d=g[j])&&_isFunction$1(d)?g[j]():_isUndefined(d)&&g.getAttribute&&g.getAttribute(j)||d},_forEachName=function b(g,j){return(g=g.split(",")).forEach(j)||g},_round$1=function b(g){return Math.round(g*1e5)/1e5||0},_roundPrecise=function b(g){return Math.round(g*1e7)/1e7||0},_parseRelative=function b(g,j){var d=j.charAt(0),nt=parseFloat(j.substr(2));return g=parseFloat(g),d==="+"?g+nt:d==="-"?g-nt:d==="*"?g*nt:g/nt},_arrayContainsAny=function b(g,j){for(var d=j.length,nt=0;g.indexOf(j[nt])<0&&++nt<d;);return nt<d},_lazyRender=function b(){var g=_lazyTweens.length,j=_lazyTweens.slice(0),d,nt;for(_lazyLookup={},_lazyTweens.length=0,d=0;d<g;d++)nt=j[d],nt&&nt._lazy&&(nt.render(nt._lazy[0],nt._lazy[1],!0)._lazy=0)},_lazySafeRender=function b(g,j,d,nt){_lazyTweens.length&&!_reverting$1&&_lazyRender(),g.render(j,d,nt||_reverting$1&&j<0&&(g._initted||g._startAt)),_lazyTweens.length&&!_reverting$1&&_lazyRender()},_numericIfPossible=function b(g){var j=parseFloat(g);return(j||j===0)&&(g+"").match(_delimitedValueExp).length<2?j:_isString$1(g)?g.trim():g},_passThrough$1=function b(g){return g},_setDefaults$1=function b(g,j){for(var d in j)d in g||(g[d]=j[d]);return g},_setKeyframeDefaults=function b(g){return function(j,d){for(var nt in d)nt in j||nt==="duration"&&g||nt==="ease"||(j[nt]=d[nt])}},_merge=function b(g,j){for(var d in j)g[d]=j[d];return g},_mergeDeep=function b(g,j){for(var d in j)d!=="__proto__"&&d!=="constructor"&&d!=="prototype"&&(g[d]=_isObject$1(j[d])?b(g[d]||(g[d]={}),j[d]):j[d]);return g},_copyExcluding=function b(g,j){var d={},nt;for(nt in g)nt in j||(d[nt]=g[nt]);return d},_inheritDefaults=function b(g){var j=g.parent||_globalTimeline,d=g.keyframes?_setKeyframeDefaults(_isArray(g.keyframes)):_setDefaults$1;if(_isNotFalse(g.inherit))for(;j;)d(g,j.vars.defaults),j=j.parent||j._dp;return g},_arraysMatch=function b(g,j){for(var d=g.length,nt=d===j.length;nt&&d--&&g[d]===j[d];);return d<0},_addLinkedListItem=function b(g,j,d,nt,at){d===void 0&&(d="_first"),nt===void 0&&(nt="_last");var ht=g[nt],_t;if(at)for(_t=j[at];ht&&ht[at]>_t;)ht=ht._prev;return ht?(j._next=ht._next,ht._next=j):(j._next=g[d],g[d]=j),j._next?j._next._prev=j:g[nt]=j,j._prev=ht,j.parent=j._dp=g,j},_removeLinkedListItem=function b(g,j,d,nt){d===void 0&&(d="_first"),nt===void 0&&(nt="_last");var at=j._prev,ht=j._next;at?at._next=ht:g[d]===j&&(g[d]=ht),ht?ht._prev=at:g[nt]===j&&(g[nt]=at),j._next=j._prev=j.parent=null},_removeFromParent=function b(g,j){g.parent&&(!j||g.parent.autoRemoveChildren)&&g.parent.remove&&g.parent.remove(g),g._act=0},_uncache=function b(g,j){if(g&&(!j||j._end>g._dur||j._start<0))for(var d=g;d;)d._dirty=1,d=d.parent;return g},_recacheAncestors=function b(g){for(var j=g.parent;j&&j.parent;)j._dirty=1,j.totalDuration(),j=j.parent;return g},_rewindStartAt=function b(g,j,d,nt){return g._startAt&&(_reverting$1?g._startAt.revert(_revertConfigNoKill):g.vars.immediateRender&&!g.vars.autoRevert||g._startAt.render(j,!0,nt))},_hasNoPausedAncestors=function b(g){return!g||g._ts&&b(g.parent)},_elapsedCycleDuration=function b(g){return g._repeat?_animationCycle(g._tTime,g=g.duration()+g._rDelay)*g:0},_animationCycle=function b(g,j){var d=Math.floor(g/=j);return g&&d===g?d-1:d},_parentToChildTotalTime=function b(g,j){return(g-j._start)*j._ts+(j._ts>=0?0:j._dirty?j.totalDuration():j._tDur)},_setEnd=function b(g){return g._end=_roundPrecise(g._start+(g._tDur/Math.abs(g._ts||g._rts||_tinyNum)||0))},_alignPlayhead=function b(g,j){var d=g._dp;return d&&d.smoothChildTiming&&g._ts&&(g._start=_roundPrecise(d._time-(g._ts>0?j/g._ts:((g._dirty?g.totalDuration():g._tDur)-j)/-g._ts)),_setEnd(g),d._dirty||_uncache(d,g)),g},_postAddChecks=function b(g,j){var d;if((j._time||!j._dur&&j._initted||j._start<g._time&&(j._dur||!j.add))&&(d=_parentToChildTotalTime(g.rawTime(),j),(!j._dur||_clamp$1(0,j.totalDuration(),d)-j._tTime>_tinyNum)&&j.render(d,!0)),_uncache(g,j)._dp&&g._initted&&g._time>=g._dur&&g._ts){if(g._dur<g.duration())for(d=g;d._dp;)d.rawTime()>=0&&d.totalTime(d._tTime),d=d._dp;g._zTime=-_tinyNum}},_addToTimeline=function b(g,j,d,nt){return j.parent&&_removeFromParent(j),j._start=_roundPrecise((_isNumber$1(d)?d:d||g!==_globalTimeline?_parsePosition$1(g,d,j):g._time)+j._delay),j._end=_roundPrecise(j._start+(j.totalDuration()/Math.abs(j.timeScale())||0)),_addLinkedListItem(g,j,"_first","_last",g._sort?"_start":0),_isFromOrFromStart(j)||(g._recent=j),nt||_postAddChecks(g,j),g._ts<0&&_alignPlayhead(g,g._tTime),g},_scrollTrigger=function b(g,j){return(_globals.ScrollTrigger||_missingPlugin("scrollTrigger",j))&&_globals.ScrollTrigger.create(j,g)},_attemptInitTween=function b(g,j,d,nt,at){if(_initTween(g,j,at),!g._initted)return 1;if(!d&&g._pt&&!_reverting$1&&(g._dur&&g.vars.lazy!==!1||!g._dur&&g.vars.lazy)&&_lastRenderedFrame!==_ticker.frame)return _lazyTweens.push(g),g._lazy=[at,nt],1},_parentPlayheadIsBeforeStart=function b(g){var j=g.parent;return j&&j._ts&&j._initted&&!j._lock&&(j.rawTime()<0||b(j))},_isFromOrFromStart=function b(g){var j=g.data;return j==="isFromStart"||j==="isStart"},_renderZeroDurationTween=function b(g,j,d,nt){var at=g.ratio,ht=j<0||!j&&(!g._start&&_parentPlayheadIsBeforeStart(g)&&!(!g._initted&&_isFromOrFromStart(g))||(g._ts<0||g._dp._ts<0)&&!_isFromOrFromStart(g))?0:1,_t=g._rDelay,bt=0,kt,Vt,qt;if(_t&&g._repeat&&(bt=_clamp$1(0,g._tDur,j),Vt=_animationCycle(bt,_t),g._yoyo&&Vt&1&&(ht=1-ht),Vt!==_animationCycle(g._tTime,_t)&&(at=1-ht,g.vars.repeatRefresh&&g._initted&&g.invalidate())),ht!==at||_reverting$1||nt||g._zTime===_tinyNum||!j&&g._zTime){if(!g._initted&&_attemptInitTween(g,j,nt,d,bt))return;for(qt=g._zTime,g._zTime=j||(d?_tinyNum:0),d||(d=j&&!qt),g.ratio=ht,g._from&&(ht=1-ht),g._time=0,g._tTime=bt,kt=g._pt;kt;)kt.r(ht,kt.d),kt=kt._next;j<0&&_rewindStartAt(g,j,d,!0),g._onUpdate&&!d&&_callback$1(g,"onUpdate"),bt&&g._repeat&&!d&&g.parent&&_callback$1(g,"onRepeat"),(j>=g._tDur||j<0)&&g.ratio===ht&&(ht&&_removeFromParent(g,1),!d&&!_reverting$1&&(_callback$1(g,ht?"onComplete":"onReverseComplete",!0),g._prom&&g._prom()))}else g._zTime||(g._zTime=j)},_findNextPauseTween=function b(g,j,d){var nt;if(d>j)for(nt=g._first;nt&&nt._start<=d;){if(nt.data==="isPause"&&nt._start>j)return nt;nt=nt._next}else for(nt=g._last;nt&&nt._start>=d;){if(nt.data==="isPause"&&nt._start<j)return nt;nt=nt._prev}},_setDuration=function b(g,j,d,nt){var at=g._repeat,ht=_roundPrecise(j)||0,_t=g._tTime/g._tDur;return _t&&!nt&&(g._time*=ht/g._dur),g._dur=ht,g._tDur=at?at<0?1e10:_roundPrecise(ht*(at+1)+g._rDelay*at):ht,_t>0&&!nt&&_alignPlayhead(g,g._tTime=g._tDur*_t),g.parent&&_setEnd(g),d||_uncache(g.parent,g),g},_onUpdateTotalDuration=function b(g){return g instanceof Timeline?_uncache(g):_setDuration(g,g._dur)},_zeroPosition={_start:0,endTime:_emptyFunc,totalDuration:_emptyFunc},_parsePosition$1=function b(g,j,d){var nt=g.labels,at=g._recent||_zeroPosition,ht=g.duration()>=_bigNum$1?at.endTime(!1):g._dur,_t,bt,kt;return _isString$1(j)&&(isNaN(j)||j in nt)?(bt=j.charAt(0),kt=j.substr(-1)==="%",_t=j.indexOf("="),bt==="<"||bt===">"?(_t>=0&&(j=j.replace(/=/,"")),(bt==="<"?at._start:at.endTime(at._repeat>=0))+(parseFloat(j.substr(1))||0)*(kt?(_t<0?at:d).totalDuration()/100:1)):_t<0?(j in nt||(nt[j]=ht),nt[j]):(bt=parseFloat(j.charAt(_t-1)+j.substr(_t+1)),kt&&d&&(bt=bt/100*(_isArray(d)?d[0]:d).totalDuration()),_t>1?b(g,j.substr(0,_t-1),d)+bt:ht+bt)):j==null?ht:+j},_createTweenType=function b(g,j,d){var nt=_isNumber$1(j[1]),at=(nt?2:1)+(g<2?0:1),ht=j[at],_t,bt;if(nt&&(ht.duration=j[1]),ht.parent=d,g){for(_t=ht,bt=d;bt&&!("immediateRender"in _t);)_t=bt.vars.defaults||{},bt=_isNotFalse(bt.vars.inherit)&&bt.parent;ht.immediateRender=_isNotFalse(_t.immediateRender),g<2?ht.runBackwards=1:ht.startAt=j[at-1]}return new Tween(j[0],ht,j[at+1])},_conditionalReturn=function b(g,j){return g||g===0?j(g):j},_clamp$1=function b(g,j,d){return d<g?g:d>j?j:d},getUnit=function b(g,j){return!_isString$1(g)||!(j=_unitExp.exec(g))?"":j[1]},clamp=function b(g,j,d){return _conditionalReturn(d,function(nt){return _clamp$1(g,j,nt)})},_slice=[].slice,_isArrayLike=function b(g,j){return g&&_isObject$1(g)&&"length"in g&&(!j&&!g.length||g.length-1 in g&&_isObject$1(g[0]))&&!g.nodeType&&g!==_win$3},_flatten=function b(g,j,d){return d===void 0&&(d=[]),g.forEach(function(nt){var at;return _isString$1(nt)&&!j||_isArrayLike(nt,1)?(at=d).push.apply(at,toArray(nt)):d.push(nt)})||d},toArray=function b(g,j,d){return _context$2&&!j&&_context$2.selector?_context$2.selector(g):_isString$1(g)&&!d&&(_coreInitted$2||!_wake())?_slice.call((j||_doc$3).querySelectorAll(g),0):_isArray(g)?_flatten(g,d):_isArrayLike(g)?_slice.call(g,0):g?[g]:[]},selector=function b(g){return g=toArray(g)[0]||_warn("Invalid scope")||{},function(j){var d=g.current||g.nativeElement||g;return toArray(j,d.querySelectorAll?d:d===g?_warn("Invalid scope")||_doc$3.createElement("div"):g)}},shuffle=function b(g){return g.sort(function(){return .5-Math.random()})},distribute=function b(g){if(_isFunction$1(g))return g;var j=_isObject$1(g)?g:{each:g},d=_parseEase(j.ease),nt=j.from||0,at=parseFloat(j.base)||0,ht={},_t=nt>0&&nt<1,bt=isNaN(nt)||_t,kt=j.axis,Vt=nt,qt=nt;return _isString$1(nt)?Vt=qt={center:.5,edges:.5,end:1}[nt]||0:!_t&&bt&&(Vt=nt[0],qt=nt[1]),function(zt,jt,Kt){var Ft=(Kt||j).length,nn=ht[Ft],Lt,Nt,Ht,on,en,cn,Ut,Gt,$t;if(!nn){if($t=j.grid==="auto"?0:(j.grid||[1,_bigNum$1])[1],!$t){for(Ut=-_bigNum$1;Ut<(Ut=Kt[$t++].getBoundingClientRect().left)&&$t<Ft;);$t--}for(nn=ht[Ft]=[],Lt=bt?Math.min($t,Ft)*Vt-.5:nt%$t,Nt=$t===_bigNum$1?0:bt?Ft*qt/$t-.5:nt/$t|0,Ut=0,Gt=_bigNum$1,cn=0;cn<Ft;cn++)Ht=cn%$t-Lt,on=Nt-(cn/$t|0),nn[cn]=en=kt?Math.abs(kt==="y"?on:Ht):_sqrt(Ht*Ht+on*on),en>Ut&&(Ut=en),en<Gt&&(Gt=en);nt==="random"&&shuffle(nn),nn.max=Ut-Gt,nn.min=Gt,nn.v=Ft=(parseFloat(j.amount)||parseFloat(j.each)*($t>Ft?Ft-1:kt?kt==="y"?Ft/$t:$t:Math.max($t,Ft/$t))||0)*(nt==="edges"?-1:1),nn.b=Ft<0?at-Ft:at,nn.u=getUnit(j.amount||j.each)||0,d=d&&Ft<0?_invertEase(d):d}return Ft=(nn[zt]-nn.min)/nn.max||0,_roundPrecise(nn.b+(d?d(Ft):Ft)*nn.v)+nn.u}},_roundModifier=function b(g){var j=Math.pow(10,((g+"").split(".")[1]||"").length);return function(d){var nt=_roundPrecise(Math.round(parseFloat(d)/g)*g*j);return(nt-nt%1)/j+(_isNumber$1(d)?0:getUnit(d))}},snap=function b(g,j){var d=_isArray(g),nt,at;return!d&&_isObject$1(g)&&(nt=d=g.radius||_bigNum$1,g.values?(g=toArray(g.values),(at=!_isNumber$1(g[0]))&&(nt*=nt)):g=_roundModifier(g.increment)),_conditionalReturn(j,d?_isFunction$1(g)?function(ht){return at=g(ht),Math.abs(at-ht)<=nt?at:ht}:function(ht){for(var _t=parseFloat(at?ht.x:ht),bt=parseFloat(at?ht.y:0),kt=_bigNum$1,Vt=0,qt=g.length,zt,jt;qt--;)at?(zt=g[qt].x-_t,jt=g[qt].y-bt,zt=zt*zt+jt*jt):zt=Math.abs(g[qt]-_t),zt<kt&&(kt=zt,Vt=qt);return Vt=!nt||kt<=nt?g[Vt]:ht,at||Vt===ht||_isNumber$1(ht)?Vt:Vt+getUnit(ht)}:_roundModifier(g))},random=function b(g,j,d,nt){return _conditionalReturn(_isArray(g)?!j:d===!0?!!(d=0):!nt,function(){return _isArray(g)?g[~~(Math.random()*g.length)]:(d=d||1e-5)&&(nt=d<1?Math.pow(10,(d+"").length-2):1)&&Math.floor(Math.round((g-d/2+Math.random()*(j-g+d*.99))/d)*d*nt)/nt})},pipe=function b(){for(var g=arguments.length,j=new Array(g),d=0;d<g;d++)j[d]=arguments[d];return function(nt){return j.reduce(function(at,ht){return ht(at)},nt)}},unitize=function b(g,j){return function(d){return g(parseFloat(d))+(j||getUnit(d))}},normalize=function b(g,j,d){return mapRange(g,j,0,1,d)},_wrapArray=function b(g,j,d){return _conditionalReturn(d,function(nt){return g[~~j(nt)]})},wrap=function b(g,j,d){var nt=j-g;return _isArray(g)?_wrapArray(g,b(0,g.length),j):_conditionalReturn(d,function(at){return(nt+(at-g)%nt)%nt+g})},wrapYoyo=function b(g,j,d){var nt=j-g,at=nt*2;return _isArray(g)?_wrapArray(g,b(0,g.length-1),j):_conditionalReturn(d,function(ht){return ht=(at+(ht-g)%at)%at||0,g+(ht>nt?at-ht:ht)})},_replaceRandom=function b(g){for(var j=0,d="",nt,at,ht,_t;~(nt=g.indexOf("random(",j));)ht=g.indexOf(")",nt),_t=g.charAt(nt+7)==="[",at=g.substr(nt+7,ht-nt-7).match(_t?_delimitedValueExp:_strictNumExp),d+=g.substr(j,nt-j)+random(_t?at:+at[0],_t?0:+at[1],+at[2]||1e-5),j=ht+1;return d+g.substr(j,g.length-j)},mapRange=function b(g,j,d,nt,at){var ht=j-g,_t=nt-d;return _conditionalReturn(at,function(bt){return d+((bt-g)/ht*_t||0)})},interpolate=function b(g,j,d,nt){var at=isNaN(g+j)?0:function(jt){return(1-jt)*g+jt*j};if(!at){var ht=_isString$1(g),_t={},bt,kt,Vt,qt,zt;if(d===!0&&(nt=1)&&(d=null),ht)g={p:g},j={p:j};else if(_isArray(g)&&!_isArray(j)){for(Vt=[],qt=g.length,zt=qt-2,kt=1;kt<qt;kt++)Vt.push(b(g[kt-1],g[kt]));qt--,at=function(Kt){Kt*=qt;var Ft=Math.min(zt,~~Kt);return Vt[Ft](Kt-Ft)},d=j}else nt||(g=_merge(_isArray(g)?[]:{},g));if(!Vt){for(bt in j)_addPropTween.call(_t,g,bt,"get",j[bt]);at=function(Kt){return _renderPropTweens(Kt,_t)||(ht?g.p:g)}}}return _conditionalReturn(d,at)},_getLabelInDirection=function b(g,j,d){var nt=g.labels,at=_bigNum$1,ht,_t,bt;for(ht in nt)_t=nt[ht]-j,_t<0==!!d&&_t&&at>(_t=Math.abs(_t))&&(bt=ht,at=_t);return bt},_callback$1=function b(g,j,d){var nt=g.vars,at=nt[j],ht=_context$2,_t=g._ctx,bt,kt,Vt;if(at)return bt=nt[j+"Params"],kt=nt.callbackScope||g,d&&_lazyTweens.length&&_lazyRender(),_t&&(_context$2=_t),Vt=bt?at.apply(kt,bt):at.call(kt),_context$2=ht,Vt},_interrupt=function b(g){return _removeFromParent(g),g.scrollTrigger&&g.scrollTrigger.kill(!!_reverting$1),g.progress()<1&&_callback$1(g,"onInterrupt"),g},_quickTween,_registerPluginQueue=[],_createPlugin=function b(g){if(_windowExists$2()&&g){g=!g.name&&g.default||g;var j=g.name,d=_isFunction$1(g),nt=j&&!d&&g.init?function(){this._props=[]}:g,at={init:_emptyFunc,render:_renderPropTweens,add:_addPropTween,kill:_killPropTweensOf,modifier:_addPluginModifier,rawVars:0},ht={targetTest:0,get:0,getSetter:_getSetter,aliases:{},register:0};if(_wake(),g!==nt){if(_plugins[j])return;_setDefaults$1(nt,_setDefaults$1(_copyExcluding(g,at),ht)),_merge(nt.prototype,_merge(at,_copyExcluding(g,ht))),_plugins[nt.prop=j]=nt,g.targetTest&&(_harnessPlugins.push(nt),_reservedProps[j]=1),j=(j==="css"?"CSS":j.charAt(0).toUpperCase()+j.substr(1))+"Plugin"}_addGlobal(j,nt),g.register&&g.register(gsap$2,nt,PropTween)}else g&&_registerPluginQueue.push(g)},_255=255,_colorLookup={aqua:[0,_255,_255],lime:[0,_255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,_255],navy:[0,0,128],white:[_255,_255,_255],olive:[128,128,0],yellow:[_255,_255,0],orange:[_255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[_255,0,0],pink:[_255,192,203],cyan:[0,_255,_255],transparent:[_255,_255,_255,0]},_hue=function b(g,j,d){return g+=g<0?1:g>1?-1:0,(g*6<1?j+(d-j)*g*6:g<.5?d:g*3<2?j+(d-j)*(2/3-g)*6:j)*_255+.5|0},splitColor=function b(g,j,d){var nt=g?_isNumber$1(g)?[g>>16,g>>8&_255,g&_255]:0:_colorLookup.black,at,ht,_t,bt,kt,Vt,qt,zt,jt,Kt;if(!nt){if(g.substr(-1)===","&&(g=g.substr(0,g.length-1)),_colorLookup[g])nt=_colorLookup[g];else if(g.charAt(0)==="#"){if(g.length<6&&(at=g.charAt(1),ht=g.charAt(2),_t=g.charAt(3),g="#"+at+at+ht+ht+_t+_t+(g.length===5?g.charAt(4)+g.charAt(4):"")),g.length===9)return nt=parseInt(g.substr(1,6),16),[nt>>16,nt>>8&_255,nt&_255,parseInt(g.substr(7),16)/255];g=parseInt(g.substr(1),16),nt=[g>>16,g>>8&_255,g&_255]}else if(g.substr(0,3)==="hsl"){if(nt=Kt=g.match(_strictNumExp),!j)bt=+nt[0]%360/360,kt=+nt[1]/100,Vt=+nt[2]/100,ht=Vt<=.5?Vt*(kt+1):Vt+kt-Vt*kt,at=Vt*2-ht,nt.length>3&&(nt[3]*=1),nt[0]=_hue(bt+1/3,at,ht),nt[1]=_hue(bt,at,ht),nt[2]=_hue(bt-1/3,at,ht);else if(~g.indexOf("="))return nt=g.match(_numExp),d&&nt.length<4&&(nt[3]=1),nt}else nt=g.match(_strictNumExp)||_colorLookup.transparent;nt=nt.map(Number)}return j&&!Kt&&(at=nt[0]/_255,ht=nt[1]/_255,_t=nt[2]/_255,qt=Math.max(at,ht,_t),zt=Math.min(at,ht,_t),Vt=(qt+zt)/2,qt===zt?bt=kt=0:(jt=qt-zt,kt=Vt>.5?jt/(2-qt-zt):jt/(qt+zt),bt=qt===at?(ht-_t)/jt+(ht<_t?6:0):qt===ht?(_t-at)/jt+2:(at-ht)/jt+4,bt*=60),nt[0]=~~(bt+.5),nt[1]=~~(kt*100+.5),nt[2]=~~(Vt*100+.5)),d&&nt.length<4&&(nt[3]=1),nt},_colorOrderData=function b(g){var j=[],d=[],nt=-1;return g.split(_colorExp).forEach(function(at){var ht=at.match(_numWithUnitExp)||[];j.push.apply(j,ht),d.push(nt+=ht.length+1)}),j.c=d,j},_formatColors=function b(g,j,d){var nt="",at=(g+nt).match(_colorExp),ht=j?"hsla(":"rgba(",_t=0,bt,kt,Vt,qt;if(!at)return g;if(at=at.map(function(zt){return(zt=splitColor(zt,j,1))&&ht+(j?zt[0]+","+zt[1]+"%,"+zt[2]+"%,"+zt[3]:zt.join(","))+")"}),d&&(Vt=_colorOrderData(g),bt=d.c,bt.join(nt)!==Vt.c.join(nt)))for(kt=g.replace(_colorExp,"1").split(_numWithUnitExp),qt=kt.length-1;_t<qt;_t++)nt+=kt[_t]+(~bt.indexOf(_t)?at.shift()||ht+"0,0,0,0)":(Vt.length?Vt:at.length?at:d).shift());if(!kt)for(kt=g.split(_colorExp),qt=kt.length-1;_t<qt;_t++)nt+=kt[_t]+at[_t];return nt+kt[qt]},_colorExp=function(){var b="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",g;for(g in _colorLookup)b+="|"+g+"\\b";return new RegExp(b+")","gi")}(),_hslExp=/hsl[a]?\(/,_colorStringFilter=function b(g){var j=g.join(" "),d;if(_colorExp.lastIndex=0,_colorExp.test(j))return d=_hslExp.test(j),g[1]=_formatColors(g[1],d),g[0]=_formatColors(g[0],d,_colorOrderData(g[1])),!0},_tickerActive,_ticker=function(){var b=Date.now,g=500,j=33,d=b(),nt=d,at=1e3/240,ht=at,_t=[],bt,kt,Vt,qt,zt,jt,Kt=function Ft(nn){var Lt=b()-nt,Nt=nn===!0,Ht,on,en,cn;if(Lt>g&&(d+=Lt-j),nt+=Lt,en=nt-d,Ht=en-ht,(Ht>0||Nt)&&(cn=++qt.frame,zt=en-qt.time*1e3,qt.time=en=en/1e3,ht+=Ht+(Ht>=at?4:at-Ht),on=1),Nt||(bt=kt(Ft)),on)for(jt=0;jt<_t.length;jt++)_t[jt](en,zt,cn,nn)};return qt={time:0,frame:0,tick:function(){Kt(!0)},deltaRatio:function(nn){return zt/(1e3/(nn||60))},wake:function(){_coreReady&&(!_coreInitted$2&&_windowExists$2()&&(_win$3=_coreInitted$2=window,_doc$3=_win$3.document||{},_globals.gsap=gsap$2,(_win$3.gsapVersions||(_win$3.gsapVersions=[])).push(gsap$2.version),_install(_installScope||_win$3.GreenSockGlobals||!_win$3.gsap&&_win$3||{}),Vt=_win$3.requestAnimationFrame,_registerPluginQueue.forEach(_createPlugin)),bt&&qt.sleep(),kt=Vt||function(nn){return setTimeout(nn,ht-qt.time*1e3+1|0)},_tickerActive=1,Kt(2))},sleep:function(){(Vt?_win$3.cancelAnimationFrame:clearTimeout)(bt),_tickerActive=0,kt=_emptyFunc},lagSmoothing:function(nn,Lt){g=nn||1/0,j=Math.min(Lt||33,g)},fps:function(nn){at=1e3/(nn||240),ht=qt.time*1e3+at},add:function(nn,Lt,Nt){var Ht=Lt?function(on,en,cn,Ut){nn(on,en,cn,Ut),qt.remove(Ht)}:nn;return qt.remove(nn),_t[Nt?"unshift":"push"](Ht),_wake(),Ht},remove:function(nn,Lt){~(Lt=_t.indexOf(nn))&&_t.splice(Lt,1)&&jt>=Lt&&jt--},_listeners:_t},qt}(),_wake=function b(){return!_tickerActive&&_ticker.wake()},_easeMap={},_customEaseExp=/^[\d.\-M][\d.\-,\s]/,_quotesExp=/["']/g,_parseObjectInString=function b(g){for(var j={},d=g.substr(1,g.length-3).split(":"),nt=d[0],at=1,ht=d.length,_t,bt,kt;at<ht;at++)bt=d[at],_t=at!==ht-1?bt.lastIndexOf(","):bt.length,kt=bt.substr(0,_t),j[nt]=isNaN(kt)?kt.replace(_quotesExp,"").trim():+kt,nt=bt.substr(_t+1).trim();return j},_valueInParentheses=function b(g){var j=g.indexOf("(")+1,d=g.indexOf(")"),nt=g.indexOf("(",j);return g.substring(j,~nt&&nt<d?g.indexOf(")",d+1):d)},_configEaseFromString=function b(g){var j=(g+"").split("("),d=_easeMap[j[0]];return d&&j.length>1&&d.config?d.config.apply(null,~g.indexOf("{")?[_parseObjectInString(j[1])]:_valueInParentheses(g).split(",").map(_numericIfPossible)):_easeMap._CE&&_customEaseExp.test(g)?_easeMap._CE("",g):d},_invertEase=function b(g){return function(j){return 1-g(1-j)}},_propagateYoyoEase=function b(g,j){for(var d=g._first,nt;d;)d instanceof Timeline?b(d,j):d.vars.yoyoEase&&(!d._yoyo||!d._repeat)&&d._yoyo!==j&&(d.timeline?b(d.timeline,j):(nt=d._ease,d._ease=d._yEase,d._yEase=nt,d._yoyo=j)),d=d._next},_parseEase=function b(g,j){return g&&(_isFunction$1(g)?g:_easeMap[g]||_configEaseFromString(g))||j},_insertEase=function b(g,j,d,nt){d===void 0&&(d=function(bt){return 1-j(1-bt)}),nt===void 0&&(nt=function(bt){return bt<.5?j(bt*2)/2:1-j((1-bt)*2)/2});var at={easeIn:j,easeOut:d,easeInOut:nt},ht;return _forEachName(g,function(_t){_easeMap[_t]=_globals[_t]=at,_easeMap[ht=_t.toLowerCase()]=d;for(var bt in at)_easeMap[ht+(bt==="easeIn"?".in":bt==="easeOut"?".out":".inOut")]=_easeMap[_t+"."+bt]=at[bt]}),at},_easeInOutFromOut=function b(g){return function(j){return j<.5?(1-g(1-j*2))/2:.5+g((j-.5)*2)/2}},_configElastic=function b(g,j,d){var nt=j>=1?j:1,at=(d||(g?.3:.45))/(j<1?j:1),ht=at/_2PI*(Math.asin(1/nt)||0),_t=function(Vt){return Vt===1?1:nt*Math.pow(2,-10*Vt)*_sin((Vt-ht)*at)+1},bt=g==="out"?_t:g==="in"?function(kt){return 1-_t(1-kt)}:_easeInOutFromOut(_t);return at=_2PI/at,bt.config=function(kt,Vt){return b(g,kt,Vt)},bt},_configBack=function b(g,j){j===void 0&&(j=1.70158);var d=function(ht){return ht?--ht*ht*((j+1)*ht+j)+1:0},nt=g==="out"?d:g==="in"?function(at){return 1-d(1-at)}:_easeInOutFromOut(d);return nt.config=function(at){return b(g,at)},nt};_forEachName("Linear,Quad,Cubic,Quart,Quint,Strong",function(b,g){var j=g<5?g+1:g;_insertEase(b+",Power"+(j-1),g?function(d){return Math.pow(d,j)}:function(d){return d},function(d){return 1-Math.pow(1-d,j)},function(d){return d<.5?Math.pow(d*2,j)/2:1-Math.pow((1-d)*2,j)/2})});_easeMap.Linear.easeNone=_easeMap.none=_easeMap.Linear.easeIn;_insertEase("Elastic",_configElastic("in"),_configElastic("out"),_configElastic());(function(b,g){var j=1/g,d=2*j,nt=2.5*j,at=function(_t){return _t<j?b*_t*_t:_t<d?b*Math.pow(_t-1.5/g,2)+.75:_t<nt?b*(_t-=2.25/g)*_t+.9375:b*Math.pow(_t-2.625/g,2)+.984375};_insertEase("Bounce",function(ht){return 1-at(1-ht)},at)})(7.5625,2.75);_insertEase("Expo",function(b){return b?Math.pow(2,10*(b-1)):0});_insertEase("Circ",function(b){return-(_sqrt(1-b*b)-1)});_insertEase("Sine",function(b){return b===1?1:-_cos(b*_HALF_PI)+1});_insertEase("Back",_configBack("in"),_configBack("out"),_configBack());_easeMap.SteppedEase=_easeMap.steps=_globals.SteppedEase={config:function b(g,j){g===void 0&&(g=1);var d=1/g,nt=g+(j?0:1),at=j?1:0,ht=1-_tinyNum;return function(_t){return((nt*_clamp$1(0,ht,_t)|0)+at)*d}}};_defaults$1.ease=_easeMap["quad.out"];_forEachName("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(b){return _callbackNames+=b+","+b+"Params,"});var GSCache=function b(g,j){this.id=_gsID++,g._gsap=this,this.target=g,this.harness=j,this.get=j?j.get:_getProperty,this.set=j?j.getSetter:_getSetter},Animation=function(){function b(j){this.vars=j,this._delay=+j.delay||0,(this._repeat=j.repeat===1/0?-2:j.repeat||0)&&(this._rDelay=j.repeatDelay||0,this._yoyo=!!j.yoyo||!!j.yoyoEase),this._ts=1,_setDuration(this,+j.duration,1,1),this.data=j.data,_context$2&&(this._ctx=_context$2,_context$2.data.push(this)),_tickerActive||_ticker.wake()}var g=b.prototype;return g.delay=function(d){return d||d===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+d-this._delay),this._delay=d,this):this._delay},g.duration=function(d){return arguments.length?this.totalDuration(this._repeat>0?d+(d+this._rDelay)*this._repeat:d):this.totalDuration()&&this._dur},g.totalDuration=function(d){return arguments.length?(this._dirty=0,_setDuration(this,this._repeat<0?d:(d-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},g.totalTime=function(d,nt){if(_wake(),!arguments.length)return this._tTime;var at=this._dp;if(at&&at.smoothChildTiming&&this._ts){for(_alignPlayhead(this,d),!at._dp||at.parent||_postAddChecks(at,this);at&&at.parent;)at.parent._time!==at._start+(at._ts>=0?at._tTime/at._ts:(at.totalDuration()-at._tTime)/-at._ts)&&at.totalTime(at._tTime,!0),at=at.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&d<this._tDur||this._ts<0&&d>0||!this._tDur&&!d)&&_addToTimeline(this._dp,this,this._start-this._delay)}return(this._tTime!==d||!this._dur&&!nt||this._initted&&Math.abs(this._zTime)===_tinyNum||!d&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=d),_lazySafeRender(this,d,nt)),this},g.time=function(d,nt){return arguments.length?this.totalTime(Math.min(this.totalDuration(),d+_elapsedCycleDuration(this))%(this._dur+this._rDelay)||(d?this._dur:0),nt):this._time},g.totalProgress=function(d,nt){return arguments.length?this.totalTime(this.totalDuration()*d,nt):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},g.progress=function(d,nt){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-d:d)+_elapsedCycleDuration(this),nt):this.duration()?Math.min(1,this._time/this._dur):this.ratio},g.iteration=function(d,nt){var at=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(d-1)*at,nt):this._repeat?_animationCycle(this._tTime,at)+1:1},g.timeScale=function(d){if(!arguments.length)return this._rts===-_tinyNum?0:this._rts;if(this._rts===d)return this;var nt=this.parent&&this._ts?_parentToChildTotalTime(this.parent._time,this):this._tTime;return this._rts=+d||0,this._ts=this._ps||d===-_tinyNum?0:this._rts,this.totalTime(_clamp$1(-Math.abs(this._delay),this._tDur,nt),!0),_setEnd(this),_recacheAncestors(this)},g.paused=function(d){return arguments.length?(this._ps!==d&&(this._ps=d,d?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(_wake(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==_tinyNum&&(this._tTime-=_tinyNum)))),this):this._ps},g.startTime=function(d){if(arguments.length){this._start=d;var nt=this.parent||this._dp;return nt&&(nt._sort||!this.parent)&&_addToTimeline(nt,this,d-this._delay),this}return this._start},g.endTime=function(d){return this._start+(_isNotFalse(d)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},g.rawTime=function(d){var nt=this.parent||this._dp;return nt?d&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?_parentToChildTotalTime(nt.rawTime(d),this):this._tTime:this._tTime},g.revert=function(d){d===void 0&&(d=_revertConfig);var nt=_reverting$1;return _reverting$1=d,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(d),this.totalTime(-.01,d.suppressEvents)),this.data!=="nested"&&d.kill!==!1&&this.kill(),_reverting$1=nt,this},g.globalTime=function(d){for(var nt=this,at=arguments.length?d:nt.rawTime();nt;)at=nt._start+at/(nt._ts||1),nt=nt._dp;return!this.parent&&this._sat?this._sat.vars.immediateRender?-1/0:this._sat.globalTime(d):at},g.repeat=function(d){return arguments.length?(this._repeat=d===1/0?-2:d,_onUpdateTotalDuration(this)):this._repeat===-2?1/0:this._repeat},g.repeatDelay=function(d){if(arguments.length){var nt=this._time;return this._rDelay=d,_onUpdateTotalDuration(this),nt?this.time(nt):this}return this._rDelay},g.yoyo=function(d){return arguments.length?(this._yoyo=d,this):this._yoyo},g.seek=function(d,nt){return this.totalTime(_parsePosition$1(this,d),_isNotFalse(nt))},g.restart=function(d,nt){return this.play().totalTime(d?-this._delay:0,_isNotFalse(nt))},g.play=function(d,nt){return d!=null&&this.seek(d,nt),this.reversed(!1).paused(!1)},g.reverse=function(d,nt){return d!=null&&this.seek(d||this.totalDuration(),nt),this.reversed(!0).paused(!1)},g.pause=function(d,nt){return d!=null&&this.seek(d,nt),this.paused(!0)},g.resume=function(){return this.paused(!1)},g.reversed=function(d){return arguments.length?(!!d!==this.reversed()&&this.timeScale(-this._rts||(d?-_tinyNum:0)),this):this._rts<0},g.invalidate=function(){return this._initted=this._act=0,this._zTime=-_tinyNum,this},g.isActive=function(){var d=this.parent||this._dp,nt=this._start,at;return!!(!d||this._ts&&this._initted&&d.isActive()&&(at=d.rawTime(!0))>=nt&&at<this.endTime(!0)-_tinyNum)},g.eventCallback=function(d,nt,at){var ht=this.vars;return arguments.length>1?(nt?(ht[d]=nt,at&&(ht[d+"Params"]=at),d==="onUpdate"&&(this._onUpdate=nt)):delete ht[d],this):ht[d]},g.then=function(d){var nt=this;return new Promise(function(at){var ht=_isFunction$1(d)?d:_passThrough$1,_t=function(){var kt=nt.then;nt.then=null,_isFunction$1(ht)&&(ht=ht(nt))&&(ht.then||ht===nt)&&(nt.then=kt),at(ht),nt.then=kt};nt._initted&&nt.totalProgress()===1&&nt._ts>=0||!nt._tTime&&nt._ts<0?_t():nt._prom=_t})},g.kill=function(){_interrupt(this)},b}();_setDefaults$1(Animation.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-_tinyNum,_prom:0,_ps:!1,_rts:1});var Timeline=function(b){_inheritsLoose(g,b);function g(d,nt){var at;return d===void 0&&(d={}),at=b.call(this,d)||this,at.labels={},at.smoothChildTiming=!!d.smoothChildTiming,at.autoRemoveChildren=!!d.autoRemoveChildren,at._sort=_isNotFalse(d.sortChildren),_globalTimeline&&_addToTimeline(d.parent||_globalTimeline,_assertThisInitialized(at),nt),d.reversed&&at.reverse(),d.paused&&at.paused(!0),d.scrollTrigger&&_scrollTrigger(_assertThisInitialized(at),d.scrollTrigger),at}var j=g.prototype;return j.to=function(nt,at,ht){return _createTweenType(0,arguments,this),this},j.from=function(nt,at,ht){return _createTweenType(1,arguments,this),this},j.fromTo=function(nt,at,ht,_t){return _createTweenType(2,arguments,this),this},j.set=function(nt,at,ht){return at.duration=0,at.parent=this,_inheritDefaults(at).repeatDelay||(at.repeat=0),at.immediateRender=!!at.immediateRender,new Tween(nt,at,_parsePosition$1(this,ht),1),this},j.call=function(nt,at,ht){return _addToTimeline(this,Tween.delayedCall(0,nt,at),ht)},j.staggerTo=function(nt,at,ht,_t,bt,kt,Vt){return ht.duration=at,ht.stagger=ht.stagger||_t,ht.onComplete=kt,ht.onCompleteParams=Vt,ht.parent=this,new Tween(nt,ht,_parsePosition$1(this,bt)),this},j.staggerFrom=function(nt,at,ht,_t,bt,kt,Vt){return ht.runBackwards=1,_inheritDefaults(ht).immediateRender=_isNotFalse(ht.immediateRender),this.staggerTo(nt,at,ht,_t,bt,kt,Vt)},j.staggerFromTo=function(nt,at,ht,_t,bt,kt,Vt,qt){return _t.startAt=ht,_inheritDefaults(_t).immediateRender=_isNotFalse(_t.immediateRender),this.staggerTo(nt,at,_t,bt,kt,Vt,qt)},j.render=function(nt,at,ht){var _t=this._time,bt=this._dirty?this.totalDuration():this._tDur,kt=this._dur,Vt=nt<=0?0:_roundPrecise(nt),qt=this._zTime<0!=nt<0&&(this._initted||!kt),zt,jt,Kt,Ft,nn,Lt,Nt,Ht,on,en,cn,Ut;if(this!==_globalTimeline&&Vt>bt&&nt>=0&&(Vt=bt),Vt!==this._tTime||ht||qt){if(_t!==this._time&&kt&&(Vt+=this._time-_t,nt+=this._time-_t),zt=Vt,on=this._start,Ht=this._ts,Lt=!Ht,qt&&(kt||(_t=this._zTime),(nt||!at)&&(this._zTime=nt)),this._repeat){if(cn=this._yoyo,nn=kt+this._rDelay,this._repeat<-1&&nt<0)return this.totalTime(nn*100+nt,at,ht);if(zt=_roundPrecise(Vt%nn),Vt===bt?(Ft=this._repeat,zt=kt):(Ft=~~(Vt/nn),Ft&&Ft===Vt/nn&&(zt=kt,Ft--),zt>kt&&(zt=kt)),en=_animationCycle(this._tTime,nn),!_t&&this._tTime&&en!==Ft&&this._tTime-en*nn-this._dur<=0&&(en=Ft),cn&&Ft&1&&(zt=kt-zt,Ut=1),Ft!==en&&!this._lock){var Gt=cn&&en&1,$t=Gt===(cn&&Ft&1);if(Ft<en&&(Gt=!Gt),_t=Gt?0:Vt%kt?kt:Vt,this._lock=1,this.render(_t||(Ut?0:_roundPrecise(Ft*nn)),at,!kt)._lock=0,this._tTime=Vt,!at&&this.parent&&_callback$1(this,"onRepeat"),this.vars.repeatRefresh&&!Ut&&(this.invalidate()._lock=1),_t&&_t!==this._time||Lt!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(kt=this._dur,bt=this._tDur,$t&&(this._lock=2,_t=Gt?kt:-1e-4,this.render(_t,!0),this.vars.repeatRefresh&&!Ut&&this.invalidate()),this._lock=0,!this._ts&&!Lt)return this;_propagateYoyoEase(this,Ut)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(Nt=_findNextPauseTween(this,_roundPrecise(_t),_roundPrecise(zt)),Nt&&(Vt-=zt-(zt=Nt._start))),this._tTime=Vt,this._time=zt,this._act=!Ht,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=nt,_t=0),!_t&&zt&&!at&&!Ft&&(_callback$1(this,"onStart"),this._tTime!==Vt))return this;if(zt>=_t&&nt>=0)for(jt=this._first;jt;){if(Kt=jt._next,(jt._act||zt>=jt._start)&&jt._ts&&Nt!==jt){if(jt.parent!==this)return this.render(nt,at,ht);if(jt.render(jt._ts>0?(zt-jt._start)*jt._ts:(jt._dirty?jt.totalDuration():jt._tDur)+(zt-jt._start)*jt._ts,at,ht),zt!==this._time||!this._ts&&!Lt){Nt=0,Kt&&(Vt+=this._zTime=-_tinyNum);break}}jt=Kt}else{jt=this._last;for(var un=nt<0?nt:zt;jt;){if(Kt=jt._prev,(jt._act||un<=jt._end)&&jt._ts&&Nt!==jt){if(jt.parent!==this)return this.render(nt,at,ht);if(jt.render(jt._ts>0?(un-jt._start)*jt._ts:(jt._dirty?jt.totalDuration():jt._tDur)+(un-jt._start)*jt._ts,at,ht||_reverting$1&&(jt._initted||jt._startAt)),zt!==this._time||!this._ts&&!Lt){Nt=0,Kt&&(Vt+=this._zTime=un?-_tinyNum:_tinyNum);break}}jt=Kt}}if(Nt&&!at&&(this.pause(),Nt.render(zt>=_t?0:-_tinyNum)._zTime=zt>=_t?1:-1,this._ts))return this._start=on,_setEnd(this),this.render(nt,at,ht);this._onUpdate&&!at&&_callback$1(this,"onUpdate",!0),(Vt===bt&&this._tTime>=this.totalDuration()||!Vt&&_t)&&(on===this._start||Math.abs(Ht)!==Math.abs(this._ts))&&(this._lock||((nt||!kt)&&(Vt===bt&&this._ts>0||!Vt&&this._ts<0)&&_removeFromParent(this,1),!at&&!(nt<0&&!_t)&&(Vt||_t||!bt)&&(_callback$1(this,Vt===bt&&nt>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(Vt<bt&&this.timeScale()>0)&&this._prom())))}return this},j.add=function(nt,at){var ht=this;if(_isNumber$1(at)||(at=_parsePosition$1(this,at,nt)),!(nt instanceof Animation)){if(_isArray(nt))return nt.forEach(function(_t){return ht.add(_t,at)}),this;if(_isString$1(nt))return this.addLabel(nt,at);if(_isFunction$1(nt))nt=Tween.delayedCall(0,nt);else return this}return this!==nt?_addToTimeline(this,nt,at):this},j.getChildren=function(nt,at,ht,_t){nt===void 0&&(nt=!0),at===void 0&&(at=!0),ht===void 0&&(ht=!0),_t===void 0&&(_t=-_bigNum$1);for(var bt=[],kt=this._first;kt;)kt._start>=_t&&(kt instanceof Tween?at&&bt.push(kt):(ht&&bt.push(kt),nt&&bt.push.apply(bt,kt.getChildren(!0,at,ht)))),kt=kt._next;return bt},j.getById=function(nt){for(var at=this.getChildren(1,1,1),ht=at.length;ht--;)if(at[ht].vars.id===nt)return at[ht]},j.remove=function(nt){return _isString$1(nt)?this.removeLabel(nt):_isFunction$1(nt)?this.killTweensOf(nt):(_removeLinkedListItem(this,nt),nt===this._recent&&(this._recent=this._last),_uncache(this))},j.totalTime=function(nt,at){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=_roundPrecise(_ticker.time-(this._ts>0?nt/this._ts:(this.totalDuration()-nt)/-this._ts))),b.prototype.totalTime.call(this,nt,at),this._forcing=0,this):this._tTime},j.addLabel=function(nt,at){return this.labels[nt]=_parsePosition$1(this,at),this},j.removeLabel=function(nt){return delete this.labels[nt],this},j.addPause=function(nt,at,ht){var _t=Tween.delayedCall(0,at||_emptyFunc,ht);return _t.data="isPause",this._hasPause=1,_addToTimeline(this,_t,_parsePosition$1(this,nt))},j.removePause=function(nt){var at=this._first;for(nt=_parsePosition$1(this,nt);at;)at._start===nt&&at.data==="isPause"&&_removeFromParent(at),at=at._next},j.killTweensOf=function(nt,at,ht){for(var _t=this.getTweensOf(nt,ht),bt=_t.length;bt--;)_overwritingTween!==_t[bt]&&_t[bt].kill(nt,at);return this},j.getTweensOf=function(nt,at){for(var ht=[],_t=toArray(nt),bt=this._first,kt=_isNumber$1(at),Vt;bt;)bt instanceof Tween?_arrayContainsAny(bt._targets,_t)&&(kt?(!_overwritingTween||bt._initted&&bt._ts)&&bt.globalTime(0)<=at&&bt.globalTime(bt.totalDuration())>at:!at||bt.isActive())&&ht.push(bt):(Vt=bt.getTweensOf(_t,at)).length&&ht.push.apply(ht,Vt),bt=bt._next;return ht},j.tweenTo=function(nt,at){at=at||{};var ht=this,_t=_parsePosition$1(ht,nt),bt=at,kt=bt.startAt,Vt=bt.onStart,qt=bt.onStartParams,zt=bt.immediateRender,jt,Kt=Tween.to(ht,_setDefaults$1({ease:at.ease||"none",lazy:!1,immediateRender:!1,time:_t,overwrite:"auto",duration:at.duration||Math.abs((_t-(kt&&"time"in kt?kt.time:ht._time))/ht.timeScale())||_tinyNum,onStart:function(){if(ht.pause(),!jt){var nn=at.duration||Math.abs((_t-(kt&&"time"in kt?kt.time:ht._time))/ht.timeScale());Kt._dur!==nn&&_setDuration(Kt,nn,0,1).render(Kt._time,!0,!0),jt=1}Vt&&Vt.apply(Kt,qt||[])}},at));return zt?Kt.render(0):Kt},j.tweenFromTo=function(nt,at,ht){return this.tweenTo(at,_setDefaults$1({startAt:{time:_parsePosition$1(this,nt)}},ht))},j.recent=function(){return this._recent},j.nextLabel=function(nt){return nt===void 0&&(nt=this._time),_getLabelInDirection(this,_parsePosition$1(this,nt))},j.previousLabel=function(nt){return nt===void 0&&(nt=this._time),_getLabelInDirection(this,_parsePosition$1(this,nt),1)},j.currentLabel=function(nt){return arguments.length?this.seek(nt,!0):this.previousLabel(this._time+_tinyNum)},j.shiftChildren=function(nt,at,ht){ht===void 0&&(ht=0);for(var _t=this._first,bt=this.labels,kt;_t;)_t._start>=ht&&(_t._start+=nt,_t._end+=nt),_t=_t._next;if(at)for(kt in bt)bt[kt]>=ht&&(bt[kt]+=nt);return _uncache(this)},j.invalidate=function(nt){var at=this._first;for(this._lock=0;at;)at.invalidate(nt),at=at._next;return b.prototype.invalidate.call(this,nt)},j.clear=function(nt){nt===void 0&&(nt=!0);for(var at=this._first,ht;at;)ht=at._next,this.remove(at),at=ht;return this._dp&&(this._time=this._tTime=this._pTime=0),nt&&(this.labels={}),_uncache(this)},j.totalDuration=function(nt){var at=0,ht=this,_t=ht._last,bt=_bigNum$1,kt,Vt,qt;if(arguments.length)return ht.timeScale((ht._repeat<0?ht.duration():ht.totalDuration())/(ht.reversed()?-nt:nt));if(ht._dirty){for(qt=ht.parent;_t;)kt=_t._prev,_t._dirty&&_t.totalDuration(),Vt=_t._start,Vt>bt&&ht._sort&&_t._ts&&!ht._lock?(ht._lock=1,_addToTimeline(ht,_t,Vt-_t._delay,1)._lock=0):bt=Vt,Vt<0&&_t._ts&&(at-=Vt,(!qt&&!ht._dp||qt&&qt.smoothChildTiming)&&(ht._start+=Vt/ht._ts,ht._time-=Vt,ht._tTime-=Vt),ht.shiftChildren(-Vt,!1,-1/0),bt=0),_t._end>at&&_t._ts&&(at=_t._end),_t=kt;_setDuration(ht,ht===_globalTimeline&&ht._time>at?ht._time:at,1,1),ht._dirty=0}return ht._tDur},g.updateRoot=function(nt){if(_globalTimeline._ts&&(_lazySafeRender(_globalTimeline,_parentToChildTotalTime(nt,_globalTimeline)),_lastRenderedFrame=_ticker.frame),_ticker.frame>=_nextGCFrame){_nextGCFrame+=_config.autoSleep||120;var at=_globalTimeline._first;if((!at||!at._ts)&&_config.autoSleep&&_ticker._listeners.length<2){for(;at&&!at._ts;)at=at._next;at||_ticker.sleep()}}},g}(Animation);_setDefaults$1(Timeline.prototype,{_lock:0,_hasPause:0,_forcing:0});var _addComplexStringPropTween=function b(g,j,d,nt,at,ht,_t){var bt=new PropTween(this._pt,g,j,0,1,_renderComplexString,null,at),kt=0,Vt=0,qt,zt,jt,Kt,Ft,nn,Lt,Nt;for(bt.b=d,bt.e=nt,d+="",nt+="",(Lt=~nt.indexOf("random("))&&(nt=_replaceRandom(nt)),ht&&(Nt=[d,nt],ht(Nt,g,j),d=Nt[0],nt=Nt[1]),zt=d.match(_complexStringNumExp)||[];qt=_complexStringNumExp.exec(nt);)Kt=qt[0],Ft=nt.substring(kt,qt.index),jt?jt=(jt+1)%5:Ft.substr(-5)==="rgba("&&(jt=1),Kt!==zt[Vt++]&&(nn=parseFloat(zt[Vt-1])||0,bt._pt={_next:bt._pt,p:Ft||Vt===1?Ft:",",s:nn,c:Kt.charAt(1)==="="?_parseRelative(nn,Kt)-nn:parseFloat(Kt)-nn,m:jt&&jt<4?Math.round:0},kt=_complexStringNumExp.lastIndex);return bt.c=kt<nt.length?nt.substring(kt,nt.length):"",bt.fp=_t,(_relExp.test(nt)||Lt)&&(bt.e=0),this._pt=bt,bt},_addPropTween=function b(g,j,d,nt,at,ht,_t,bt,kt,Vt){_isFunction$1(nt)&&(nt=nt(at||0,g,ht));var qt=g[j],zt=d!=="get"?d:_isFunction$1(qt)?kt?g[j.indexOf("set")||!_isFunction$1(g["get"+j.substr(3)])?j:"get"+j.substr(3)](kt):g[j]():qt,jt=_isFunction$1(qt)?kt?_setterFuncWithParam:_setterFunc:_setterPlain,Kt;if(_isString$1(nt)&&(~nt.indexOf("random(")&&(nt=_replaceRandom(nt)),nt.charAt(1)==="="&&(Kt=_parseRelative(zt,nt)+(getUnit(zt)||0),(Kt||Kt===0)&&(nt=Kt))),!Vt||zt!==nt||_forceAllPropTweens)return!isNaN(zt*nt)&&nt!==""?(Kt=new PropTween(this._pt,g,j,+zt||0,nt-(zt||0),typeof qt=="boolean"?_renderBoolean:_renderPlain,0,jt),kt&&(Kt.fp=kt),_t&&Kt.modifier(_t,this,g),this._pt=Kt):(!qt&&!(j in g)&&_missingPlugin(j,nt),_addComplexStringPropTween.call(this,g,j,zt,nt,jt,bt||_config.stringFilter,kt))},_processVars=function b(g,j,d,nt,at){if(_isFunction$1(g)&&(g=_parseFuncOrString(g,at,j,d,nt)),!_isObject$1(g)||g.style&&g.nodeType||_isArray(g)||_isTypedArray(g))return _isString$1(g)?_parseFuncOrString(g,at,j,d,nt):g;var ht={},_t;for(_t in g)ht[_t]=_parseFuncOrString(g[_t],at,j,d,nt);return ht},_checkPlugin=function b(g,j,d,nt,at,ht){var _t,bt,kt,Vt;if(_plugins[g]&&(_t=new _plugins[g]).init(at,_t.rawVars?j[g]:_processVars(j[g],nt,at,ht,d),d,nt,ht)!==!1&&(d._pt=bt=new PropTween(d._pt,at,g,0,1,_t.render,_t,0,_t.priority),d!==_quickTween))for(kt=d._ptLookup[d._targets.indexOf(at)],Vt=_t._props.length;Vt--;)kt[_t._props[Vt]]=bt;return _t},_overwritingTween,_forceAllPropTweens,_initTween=function b(g,j,d){var nt=g.vars,at=nt.ease,ht=nt.startAt,_t=nt.immediateRender,bt=nt.lazy,kt=nt.onUpdate,Vt=nt.onUpdateParams,qt=nt.callbackScope,zt=nt.runBackwards,jt=nt.yoyoEase,Kt=nt.keyframes,Ft=nt.autoRevert,nn=g._dur,Lt=g._startAt,Nt=g._targets,Ht=g.parent,on=Ht&&Ht.data==="nested"?Ht.vars.targets:Nt,en=g._overwrite==="auto"&&!_suppressOverwrites$1,cn=g.timeline,Ut,Gt,$t,un,hn,Bn,ar,sr,ur,nr,hr,zn,Yn;if(cn&&(!Kt||!at)&&(at="none"),g._ease=_parseEase(at,_defaults$1.ease),g._yEase=jt?_invertEase(_parseEase(jt===!0?at:jt,_defaults$1.ease)):0,jt&&g._yoyo&&!g._repeat&&(jt=g._yEase,g._yEase=g._ease,g._ease=jt),g._from=!cn&&!!nt.runBackwards,!cn||Kt&&!nt.stagger){if(sr=Nt[0]?_getCache(Nt[0]).harness:0,zn=sr&&nt[sr.prop],Ut=_copyExcluding(nt,_reservedProps),Lt&&(Lt._zTime<0&&Lt.progress(1),j<0&&zt&&_t&&!Ft?Lt.render(-1,!0):Lt.revert(zt&&nn?_revertConfigNoKill:_startAtRevertConfig),Lt._lazy=0),ht){if(_removeFromParent(g._startAt=Tween.set(Nt,_setDefaults$1({data:"isStart",overwrite:!1,parent:Ht,immediateRender:!0,lazy:!Lt&&_isNotFalse(bt),startAt:null,delay:0,onUpdate:kt,onUpdateParams:Vt,callbackScope:qt,stagger:0},ht))),g._startAt._dp=0,g._startAt._sat=g,j<0&&(_reverting$1||!_t&&!Ft)&&g._startAt.revert(_revertConfigNoKill),_t&&nn&&j<=0&&d<=0){j&&(g._zTime=j);return}}else if(zt&&nn&&!Lt){if(j&&(_t=!1),$t=_setDefaults$1({overwrite:!1,data:"isFromStart",lazy:_t&&!Lt&&_isNotFalse(bt),immediateRender:_t,stagger:0,parent:Ht},Ut),zn&&($t[sr.prop]=zn),_removeFromParent(g._startAt=Tween.set(Nt,$t)),g._startAt._dp=0,g._startAt._sat=g,j<0&&(_reverting$1?g._startAt.revert(_revertConfigNoKill):g._startAt.render(-1,!0)),g._zTime=j,!_t)b(g._startAt,_tinyNum,_tinyNum);else if(!j)return}for(g._pt=g._ptCache=0,bt=nn&&_isNotFalse(bt)||bt&&!nn,Gt=0;Gt<Nt.length;Gt++){if(hn=Nt[Gt],ar=hn._gsap||_harness(Nt)[Gt]._gsap,g._ptLookup[Gt]=nr={},_lazyLookup[ar.id]&&_lazyTweens.length&&_lazyRender(),hr=on===Nt?Gt:on.indexOf(hn),sr&&(ur=new sr).init(hn,zn||Ut,g,hr,on)!==!1&&(g._pt=un=new PropTween(g._pt,hn,ur.name,0,1,ur.render,ur,0,ur.priority),ur._props.forEach(function(sn){nr[sn]=un}),ur.priority&&(Bn=1)),!sr||zn)for($t in Ut)_plugins[$t]&&(ur=_checkPlugin($t,Ut,g,hr,hn,on))?ur.priority&&(Bn=1):nr[$t]=un=_addPropTween.call(g,hn,$t,"get",Ut[$t],hr,on,0,nt.stringFilter);g._op&&g._op[Gt]&&g.kill(hn,g._op[Gt]),en&&g._pt&&(_overwritingTween=g,_globalTimeline.killTweensOf(hn,nr,g.globalTime(j)),Yn=!g.parent,_overwritingTween=0),g._pt&&bt&&(_lazyLookup[ar.id]=1)}Bn&&_sortPropTweensByPriority(g),g._onInit&&g._onInit(g)}g._onUpdate=kt,g._initted=(!g._op||g._pt)&&!Yn,Kt&&j<=0&&cn.render(_bigNum$1,!0,!0)},_updatePropTweens=function b(g,j,d,nt,at,ht,_t){var bt=(g._pt&&g._ptCache||(g._ptCache={}))[j],kt,Vt,qt,zt;if(!bt)for(bt=g._ptCache[j]=[],qt=g._ptLookup,zt=g._targets.length;zt--;){if(kt=qt[zt][j],kt&&kt.d&&kt.d._pt)for(kt=kt.d._pt;kt&&kt.p!==j&&kt.fp!==j;)kt=kt._next;if(!kt)return _forceAllPropTweens=1,g.vars[j]="+=0",_initTween(g,_t),_forceAllPropTweens=0,1;bt.push(kt)}for(zt=bt.length;zt--;)Vt=bt[zt],kt=Vt._pt||Vt,kt.s=(nt||nt===0)&&!at?nt:kt.s+(nt||0)+ht*kt.c,kt.c=d-kt.s,Vt.e&&(Vt.e=_round$1(d)+getUnit(Vt.e)),Vt.b&&(Vt.b=kt.s+getUnit(Vt.b))},_addAliasesToVars=function b(g,j){var d=g[0]?_getCache(g[0]).harness:0,nt=d&&d.aliases,at,ht,_t,bt;if(!nt)return j;at=_merge({},j);for(ht in nt)if(ht in at)for(bt=nt[ht].split(","),_t=bt.length;_t--;)at[bt[_t]]=at[ht];return at},_parseKeyframe=function b(g,j,d,nt){var at=j.ease||nt||"power1.inOut",ht,_t;if(_isArray(j))_t=d[g]||(d[g]=[]),j.forEach(function(bt,kt){return _t.push({t:kt/(j.length-1)*100,v:bt,e:at})});else for(ht in j)_t=d[ht]||(d[ht]=[]),ht==="ease"||_t.push({t:parseFloat(g),v:j[ht],e:at})},_parseFuncOrString=function b(g,j,d,nt,at){return _isFunction$1(g)?g.call(j,d,nt,at):_isString$1(g)&&~g.indexOf("random(")?_replaceRandom(g):g},_staggerTweenProps=_callbackNames+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",_staggerPropsToSkip={};_forEachName(_staggerTweenProps+",id,stagger,delay,duration,paused,scrollTrigger",function(b){return _staggerPropsToSkip[b]=1});var Tween=function(b){_inheritsLoose(g,b);function g(d,nt,at,ht){var _t;typeof nt=="number"&&(at.duration=nt,nt=at,at=null),_t=b.call(this,ht?nt:_inheritDefaults(nt))||this;var bt=_t.vars,kt=bt.duration,Vt=bt.delay,qt=bt.immediateRender,zt=bt.stagger,jt=bt.overwrite,Kt=bt.keyframes,Ft=bt.defaults,nn=bt.scrollTrigger,Lt=bt.yoyoEase,Nt=nt.parent||_globalTimeline,Ht=(_isArray(d)||_isTypedArray(d)?_isNumber$1(d[0]):"length"in nt)?[d]:toArray(d),on,en,cn,Ut,Gt,$t,un,hn;if(_t._targets=Ht.length?_harness(Ht):_warn("GSAP target "+d+" not found. https://greensock.com",!_config.nullTargetWarn)||[],_t._ptLookup=[],_t._overwrite=jt,Kt||zt||_isFuncOrString(kt)||_isFuncOrString(Vt)){if(nt=_t.vars,on=_t.timeline=new Timeline({data:"nested",defaults:Ft||{},targets:Nt&&Nt.data==="nested"?Nt.vars.targets:Ht}),on.kill(),on.parent=on._dp=_assertThisInitialized(_t),on._start=0,zt||_isFuncOrString(kt)||_isFuncOrString(Vt)){if(Ut=Ht.length,un=zt&&distribute(zt),_isObject$1(zt))for(Gt in zt)~_staggerTweenProps.indexOf(Gt)&&(hn||(hn={}),hn[Gt]=zt[Gt]);for(en=0;en<Ut;en++)cn=_copyExcluding(nt,_staggerPropsToSkip),cn.stagger=0,Lt&&(cn.yoyoEase=Lt),hn&&_merge(cn,hn),$t=Ht[en],cn.duration=+_parseFuncOrString(kt,_assertThisInitialized(_t),en,$t,Ht),cn.delay=(+_parseFuncOrString(Vt,_assertThisInitialized(_t),en,$t,Ht)||0)-_t._delay,!zt&&Ut===1&&cn.delay&&(_t._delay=Vt=cn.delay,_t._start+=Vt,cn.delay=0),on.to($t,cn,un?un(en,$t,Ht):0),on._ease=_easeMap.none;on.duration()?kt=Vt=0:_t.timeline=0}else if(Kt){_inheritDefaults(_setDefaults$1(on.vars.defaults,{ease:"none"})),on._ease=_parseEase(Kt.ease||nt.ease||"none");var Bn=0,ar,sr,ur;if(_isArray(Kt))Kt.forEach(function(nr){return on.to(Ht,nr,">")}),on.duration();else{cn={};for(Gt in Kt)Gt==="ease"||Gt==="easeEach"||_parseKeyframe(Gt,Kt[Gt],cn,Kt.easeEach);for(Gt in cn)for(ar=cn[Gt].sort(function(nr,hr){return nr.t-hr.t}),Bn=0,en=0;en<ar.length;en++)sr=ar[en],ur={ease:sr.e,duration:(sr.t-(en?ar[en-1].t:0))/100*kt},ur[Gt]=sr.v,on.to(Ht,ur,Bn),Bn+=ur.duration;on.duration()<kt&&on.to({},{duration:kt-on.duration()})}}kt||_t.duration(kt=on.duration())}else _t.timeline=0;return jt===!0&&!_suppressOverwrites$1&&(_overwritingTween=_assertThisInitialized(_t),_globalTimeline.killTweensOf(Ht),_overwritingTween=0),_addToTimeline(Nt,_assertThisInitialized(_t),at),nt.reversed&&_t.reverse(),nt.paused&&_t.paused(!0),(qt||!kt&&!Kt&&_t._start===_roundPrecise(Nt._time)&&_isNotFalse(qt)&&_hasNoPausedAncestors(_assertThisInitialized(_t))&&Nt.data!=="nested")&&(_t._tTime=-_tinyNum,_t.render(Math.max(0,-Vt)||0)),nn&&_scrollTrigger(_assertThisInitialized(_t),nn),_t}var j=g.prototype;return j.render=function(nt,at,ht){var _t=this._time,bt=this._tDur,kt=this._dur,Vt=nt<0,qt=nt>bt-_tinyNum&&!Vt?bt:nt<_tinyNum?0:nt,zt,jt,Kt,Ft,nn,Lt,Nt,Ht,on;if(!kt)_renderZeroDurationTween(this,nt,at,ht);else if(qt!==this._tTime||!nt||ht||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==Vt){if(zt=qt,Ht=this.timeline,this._repeat){if(Ft=kt+this._rDelay,this._repeat<-1&&Vt)return this.totalTime(Ft*100+nt,at,ht);if(zt=_roundPrecise(qt%Ft),qt===bt?(Kt=this._repeat,zt=kt):(Kt=~~(qt/Ft),Kt&&Kt===qt/Ft&&(zt=kt,Kt--),zt>kt&&(zt=kt)),Lt=this._yoyo&&Kt&1,Lt&&(on=this._yEase,zt=kt-zt),nn=_animationCycle(this._tTime,Ft),zt===_t&&!ht&&this._initted)return this._tTime=qt,this;Kt!==nn&&(Ht&&this._yEase&&_propagateYoyoEase(Ht,Lt),this.vars.repeatRefresh&&!Lt&&!this._lock&&(this._lock=ht=1,this.render(_roundPrecise(Ft*Kt),!0).invalidate()._lock=0))}if(!this._initted){if(_attemptInitTween(this,Vt?nt:zt,ht,at,qt))return this._tTime=0,this;if(_t!==this._time)return this;if(kt!==this._dur)return this.render(nt,at,ht)}if(this._tTime=qt,this._time=zt,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=Nt=(on||this._ease)(zt/kt),this._from&&(this.ratio=Nt=1-Nt),zt&&!_t&&!at&&!Kt&&(_callback$1(this,"onStart"),this._tTime!==qt))return this;for(jt=this._pt;jt;)jt.r(Nt,jt.d),jt=jt._next;Ht&&Ht.render(nt<0?nt:!zt&&Lt?-_tinyNum:Ht._dur*Ht._ease(zt/this._dur),at,ht)||this._startAt&&(this._zTime=nt),this._onUpdate&&!at&&(Vt&&_rewindStartAt(this,nt,at,ht),_callback$1(this,"onUpdate")),this._repeat&&Kt!==nn&&this.vars.onRepeat&&!at&&this.parent&&_callback$1(this,"onRepeat"),(qt===this._tDur||!qt)&&this._tTime===qt&&(Vt&&!this._onUpdate&&_rewindStartAt(this,nt,!0,!0),(nt||!kt)&&(qt===this._tDur&&this._ts>0||!qt&&this._ts<0)&&_removeFromParent(this,1),!at&&!(Vt&&!_t)&&(qt||_t||Lt)&&(_callback$1(this,qt===bt?"onComplete":"onReverseComplete",!0),this._prom&&!(qt<bt&&this.timeScale()>0)&&this._prom()))}return this},j.targets=function(){return this._targets},j.invalidate=function(nt){return(!nt||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(nt),b.prototype.invalidate.call(this,nt)},j.resetTo=function(nt,at,ht,_t){_tickerActive||_ticker.wake(),this._ts||this.play();var bt=Math.min(this._dur,(this._dp._time-this._start)*this._ts),kt;return this._initted||_initTween(this,bt),kt=this._ease(bt/this._dur),_updatePropTweens(this,nt,at,ht,_t,kt,bt)?this.resetTo(nt,at,ht,_t):(_alignPlayhead(this,0),this.parent||_addLinkedListItem(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},j.kill=function(nt,at){if(at===void 0&&(at="all"),!nt&&(!at||at==="all"))return this._lazy=this._pt=0,this.parent?_interrupt(this):this;if(this.timeline){var ht=this.timeline.totalDuration();return this.timeline.killTweensOf(nt,at,_overwritingTween&&_overwritingTween.vars.overwrite!==!0)._first||_interrupt(this),this.parent&&ht!==this.timeline.totalDuration()&&_setDuration(this,this._dur*this.timeline._tDur/ht,0,1),this}var _t=this._targets,bt=nt?toArray(nt):_t,kt=this._ptLookup,Vt=this._pt,qt,zt,jt,Kt,Ft,nn,Lt;if((!at||at==="all")&&_arraysMatch(_t,bt))return at==="all"&&(this._pt=0),_interrupt(this);for(qt=this._op=this._op||[],at!=="all"&&(_isString$1(at)&&(Ft={},_forEachName(at,function(Nt){return Ft[Nt]=1}),at=Ft),at=_addAliasesToVars(_t,at)),Lt=_t.length;Lt--;)if(~bt.indexOf(_t[Lt])){zt=kt[Lt],at==="all"?(qt[Lt]=at,Kt=zt,jt={}):(jt=qt[Lt]=qt[Lt]||{},Kt=at);for(Ft in Kt)nn=zt&&zt[Ft],nn&&((!("kill"in nn.d)||nn.d.kill(Ft)===!0)&&_removeLinkedListItem(this,nn,"_pt"),delete zt[Ft]),jt!=="all"&&(jt[Ft]=1)}return this._initted&&!this._pt&&Vt&&_interrupt(this),this},g.to=function(nt,at){return new g(nt,at,arguments[2])},g.from=function(nt,at){return _createTweenType(1,arguments)},g.delayedCall=function(nt,at,ht,_t){return new g(at,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:nt,onComplete:at,onReverseComplete:at,onCompleteParams:ht,onReverseCompleteParams:ht,callbackScope:_t})},g.fromTo=function(nt,at,ht){return _createTweenType(2,arguments)},g.set=function(nt,at){return at.duration=0,at.repeatDelay||(at.repeat=0),new g(nt,at)},g.killTweensOf=function(nt,at,ht){return _globalTimeline.killTweensOf(nt,at,ht)},g}(Animation);_setDefaults$1(Tween.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});_forEachName("staggerTo,staggerFrom,staggerFromTo",function(b){Tween[b]=function(){var g=new Timeline,j=_slice.call(arguments,0);return j.splice(b==="staggerFromTo"?5:4,0,0),g[b].apply(g,j)}});var _setterPlain=function b(g,j,d){return g[j]=d},_setterFunc=function b(g,j,d){return g[j](d)},_setterFuncWithParam=function b(g,j,d,nt){return g[j](nt.fp,d)},_setterAttribute=function b(g,j,d){return g.setAttribute(j,d)},_getSetter=function b(g,j){return _isFunction$1(g[j])?_setterFunc:_isUndefined(g[j])&&g.setAttribute?_setterAttribute:_setterPlain},_renderPlain=function b(g,j){return j.set(j.t,j.p,Math.round((j.s+j.c*g)*1e6)/1e6,j)},_renderBoolean=function b(g,j){return j.set(j.t,j.p,!!(j.s+j.c*g),j)},_renderComplexString=function b(g,j){var d=j._pt,nt="";if(!g&&j.b)nt=j.b;else if(g===1&&j.e)nt=j.e;else{for(;d;)nt=d.p+(d.m?d.m(d.s+d.c*g):Math.round((d.s+d.c*g)*1e4)/1e4)+nt,d=d._next;nt+=j.c}j.set(j.t,j.p,nt,j)},_renderPropTweens=function b(g,j){for(var d=j._pt;d;)d.r(g,d.d),d=d._next},_addPluginModifier=function b(g,j,d,nt){for(var at=this._pt,ht;at;)ht=at._next,at.p===nt&&at.modifier(g,j,d),at=ht},_killPropTweensOf=function b(g){for(var j=this._pt,d,nt;j;)nt=j._next,j.p===g&&!j.op||j.op===g?_removeLinkedListItem(this,j,"_pt"):j.dep||(d=1),j=nt;return!d},_setterWithModifier=function b(g,j,d,nt){nt.mSet(g,j,nt.m.call(nt.tween,d,nt.mt),nt)},_sortPropTweensByPriority=function b(g){for(var j=g._pt,d,nt,at,ht;j;){for(d=j._next,nt=at;nt&&nt.pr>j.pr;)nt=nt._next;(j._prev=nt?nt._prev:ht)?j._prev._next=j:at=j,(j._next=nt)?nt._prev=j:ht=j,j=d}g._pt=at},PropTween=function(){function b(j,d,nt,at,ht,_t,bt,kt,Vt){this.t=d,this.s=at,this.c=ht,this.p=nt,this.r=_t||_renderPlain,this.d=bt||this,this.set=kt||_setterPlain,this.pr=Vt||0,this._next=j,j&&(j._prev=this)}var g=b.prototype;return g.modifier=function(d,nt,at){this.mSet=this.mSet||this.set,this.set=_setterWithModifier,this.m=d,this.mt=at,this.tween=nt},b}();_forEachName(_callbackNames+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(b){return _reservedProps[b]=1});_globals.TweenMax=_globals.TweenLite=Tween;_globals.TimelineLite=_globals.TimelineMax=Timeline;_globalTimeline=new Timeline({sortChildren:!1,defaults:_defaults$1,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});_config.stringFilter=_colorStringFilter;var _media=[],_listeners$1={},_emptyArray$1=[],_lastMediaTime=0,_contextID=0,_dispatch$1=function b(g){return(_listeners$1[g]||_emptyArray$1).map(function(j){return j()})},_onMediaChange=function b(){var g=Date.now(),j=[];g-_lastMediaTime>2&&(_dispatch$1("matchMediaInit"),_media.forEach(function(d){var nt=d.queries,at=d.conditions,ht,_t,bt,kt;for(_t in nt)ht=_win$3.matchMedia(nt[_t]).matches,ht&&(bt=1),ht!==at[_t]&&(at[_t]=ht,kt=1);kt&&(d.revert(),bt&&j.push(d))}),_dispatch$1("matchMediaRevert"),j.forEach(function(d){return d.onMatch(d)}),_lastMediaTime=g,_dispatch$1("matchMedia"))},Context=function(){function b(j,d){this.selector=d&&selector(d),this.data=[],this._r=[],this.isReverted=!1,this.id=_contextID++,j&&this.add(j)}var g=b.prototype;return g.add=function(d,nt,at){_isFunction$1(d)&&(at=nt,nt=d,d=_isFunction$1);var ht=this,_t=function(){var kt=_context$2,Vt=ht.selector,qt;return kt&&kt!==ht&&kt.data.push(ht),at&&(ht.selector=selector(at)),_context$2=ht,qt=nt.apply(ht,arguments),_isFunction$1(qt)&&ht._r.push(qt),_context$2=kt,ht.selector=Vt,ht.isReverted=!1,qt};return ht.last=_t,d===_isFunction$1?_t(ht):d?ht[d]=_t:_t},g.ignore=function(d){var nt=_context$2;_context$2=null,d(this),_context$2=nt},g.getTweens=function(){var d=[];return this.data.forEach(function(nt){return nt instanceof b?d.push.apply(d,nt.getTweens()):nt instanceof Tween&&!(nt.parent&&nt.parent.data==="nested")&&d.push(nt)}),d},g.clear=function(){this._r.length=this.data.length=0},g.kill=function(d,nt){var at=this;if(d){var ht=this.getTweens();this.data.forEach(function(bt){bt.data==="isFlip"&&(bt.revert(),bt.getChildren(!0,!0,!1).forEach(function(kt){return ht.splice(ht.indexOf(kt),1)}))}),ht.map(function(bt){return{g:bt.globalTime(0),t:bt}}).sort(function(bt,kt){return kt.g-bt.g||-1/0}).forEach(function(bt){return bt.t.revert(d)}),this.data.forEach(function(bt){return!(bt instanceof Tween)&&bt.revert&&bt.revert(d)}),this._r.forEach(function(bt){return bt(d,at)}),this.isReverted=!0}else this.data.forEach(function(bt){return bt.kill&&bt.kill()});if(this.clear(),nt)for(var _t=_media.length;_t--;)_media[_t].id===this.id&&_media.splice(_t,1)},g.revert=function(d){this.kill(d||{})},b}(),MatchMedia=function(){function b(j){this.contexts=[],this.scope=j}var g=b.prototype;return g.add=function(d,nt,at){_isObject$1(d)||(d={matches:d});var ht=new Context(0,at||this.scope),_t=ht.conditions={},bt,kt,Vt;_context$2&&!ht.selector&&(ht.selector=_context$2.selector),this.contexts.push(ht),nt=ht.add("onMatch",nt),ht.queries=d;for(kt in d)kt==="all"?Vt=1:(bt=_win$3.matchMedia(d[kt]),bt&&(_media.indexOf(ht)<0&&_media.push(ht),(_t[kt]=bt.matches)&&(Vt=1),bt.addListener?bt.addListener(_onMediaChange):bt.addEventListener("change",_onMediaChange)));return Vt&&nt(ht),this},g.revert=function(d){this.kill(d||{})},g.kill=function(d){this.contexts.forEach(function(nt){return nt.kill(d,!0)})},b}(),_gsap={registerPlugin:function b(){for(var g=arguments.length,j=new Array(g),d=0;d<g;d++)j[d]=arguments[d];j.forEach(function(nt){return _createPlugin(nt)})},timeline:function b(g){return new Timeline(g)},getTweensOf:function b(g,j){return _globalTimeline.getTweensOf(g,j)},getProperty:function b(g,j,d,nt){_isString$1(g)&&(g=toArray(g)[0]);var at=_getCache(g||{}).get,ht=d?_passThrough$1:_numericIfPossible;return d==="native"&&(d=""),g&&(j?ht((_plugins[j]&&_plugins[j].get||at)(g,j,d,nt)):function(_t,bt,kt){return ht((_plugins[_t]&&_plugins[_t].get||at)(g,_t,bt,kt))})},quickSetter:function b(g,j,d){if(g=toArray(g),g.length>1){var nt=g.map(function(Vt){return gsap$2.quickSetter(Vt,j,d)}),at=nt.length;return function(Vt){for(var qt=at;qt--;)nt[qt](Vt)}}g=g[0]||{};var ht=_plugins[j],_t=_getCache(g),bt=_t.harness&&(_t.harness.aliases||{})[j]||j,kt=ht?function(Vt){var qt=new ht;_quickTween._pt=0,qt.init(g,d?Vt+d:Vt,_quickTween,0,[g]),qt.render(1,qt),_quickTween._pt&&_renderPropTweens(1,_quickTween)}:_t.set(g,bt);return ht?kt:function(Vt){return kt(g,bt,d?Vt+d:Vt,_t,1)}},quickTo:function b(g,j,d){var nt,at=gsap$2.to(g,_merge((nt={},nt[j]="+=0.1",nt.paused=!0,nt),d||{})),ht=function(bt,kt,Vt){return at.resetTo(j,bt,kt,Vt)};return ht.tween=at,ht},isTweening:function b(g){return _globalTimeline.getTweensOf(g,!0).length>0},defaults:function b(g){return g&&g.ease&&(g.ease=_parseEase(g.ease,_defaults$1.ease)),_mergeDeep(_defaults$1,g||{})},config:function b(g){return _mergeDeep(_config,g||{})},registerEffect:function b(g){var j=g.name,d=g.effect,nt=g.plugins,at=g.defaults,ht=g.extendTimeline;(nt||"").split(",").forEach(function(_t){return _t&&!_plugins[_t]&&!_globals[_t]&&_warn(j+" effect requires "+_t+" plugin.")}),_effects[j]=function(_t,bt,kt){return d(toArray(_t),_setDefaults$1(bt||{},at),kt)},ht&&(Timeline.prototype[j]=function(_t,bt,kt){return this.add(_effects[j](_t,_isObject$1(bt)?bt:(kt=bt)&&{},this),kt)})},registerEase:function b(g,j){_easeMap[g]=_parseEase(j)},parseEase:function b(g,j){return arguments.length?_parseEase(g,j):_easeMap},getById:function b(g){return _globalTimeline.getById(g)},exportRoot:function b(g,j){g===void 0&&(g={});var d=new Timeline(g),nt,at;for(d.smoothChildTiming=_isNotFalse(g.smoothChildTiming),_globalTimeline.remove(d),d._dp=0,d._time=d._tTime=_globalTimeline._time,nt=_globalTimeline._first;nt;)at=nt._next,(j||!(!nt._dur&&nt instanceof Tween&&nt.vars.onComplete===nt._targets[0]))&&_addToTimeline(d,nt,nt._start-nt._delay),nt=at;return _addToTimeline(_globalTimeline,d,0),d},context:function b(g,j){return g?new Context(g,j):_context$2},matchMedia:function b(g){return new MatchMedia(g)},matchMediaRefresh:function b(){return _media.forEach(function(g){var j=g.conditions,d,nt;for(nt in j)j[nt]&&(j[nt]=!1,d=1);d&&g.revert()})||_onMediaChange()},addEventListener:function b(g,j){var d=_listeners$1[g]||(_listeners$1[g]=[]);~d.indexOf(j)||d.push(j)},removeEventListener:function b(g,j){var d=_listeners$1[g],nt=d&&d.indexOf(j);nt>=0&&d.splice(nt,1)},utils:{wrap,wrapYoyo,distribute,random,snap,normalize,getUnit,clamp,splitColor,toArray,selector,mapRange,pipe,unitize,interpolate,shuffle},install:_install,effects:_effects,ticker:_ticker,updateRoot:Timeline.updateRoot,plugins:_plugins,globalTimeline:_globalTimeline,core:{PropTween,globals:_addGlobal,Tween,Timeline,Animation,getCache:_getCache,_removeLinkedListItem,reverting:function b(){return _reverting$1},context:function b(g){return g&&_context$2&&(_context$2.data.push(g),g._ctx=_context$2),_context$2},suppressOverwrites:function b(g){return _suppressOverwrites$1=g}}};_forEachName("to,from,fromTo,delayedCall,set,killTweensOf",function(b){return _gsap[b]=Tween[b]});_ticker.add(Timeline.updateRoot);_quickTween=_gsap.to({},{duration:0});var _getPluginPropTween=function b(g,j){for(var d=g._pt;d&&d.p!==j&&d.op!==j&&d.fp!==j;)d=d._next;return d},_addModifiers=function b(g,j){var d=g._targets,nt,at,ht;for(nt in j)for(at=d.length;at--;)ht=g._ptLookup[at][nt],ht&&(ht=ht.d)&&(ht._pt&&(ht=_getPluginPropTween(ht,nt)),ht&&ht.modifier&&ht.modifier(j[nt],g,d[at],nt))},_buildModifierPlugin=function b(g,j){return{name:g,rawVars:1,init:function(nt,at,ht){ht._onInit=function(_t){var bt,kt;if(_isString$1(at)&&(bt={},_forEachName(at,function(Vt){return bt[Vt]=1}),at=bt),j){bt={};for(kt in at)bt[kt]=j(at[kt]);at=bt}_addModifiers(_t,at)}}}},gsap$2=_gsap.registerPlugin({name:"attr",init:function b(g,j,d,nt,at){var ht,_t,bt;this.tween=d;for(ht in j)bt=g.getAttribute(ht)||"",_t=this.add(g,"setAttribute",(bt||0)+"",j[ht],nt,at,0,0,ht),_t.op=ht,_t.b=bt,this._props.push(ht)},render:function b(g,j){for(var d=j._pt;d;)_reverting$1?d.set(d.t,d.p,d.b,d):d.r(g,d.d),d=d._next}},{name:"endArray",init:function b(g,j){for(var d=j.length;d--;)this.add(g,d,g[d]||0,j[d],0,0,0,0,0,1)}},_buildModifierPlugin("roundProps",_roundModifier),_buildModifierPlugin("modifiers"),_buildModifierPlugin("snap",snap))||_gsap;Tween.version=Timeline.version=gsap$2.version="3.12.2";_coreReady=1;_windowExists$2()&&_wake();_easeMap.Power0;_easeMap.Power1;_easeMap.Power2;_easeMap.Power3;_easeMap.Power4;_easeMap.Linear;_easeMap.Quad;_easeMap.Cubic;_easeMap.Quart;_easeMap.Quint;_easeMap.Strong;_easeMap.Elastic;_easeMap.Back;_easeMap.SteppedEase;_easeMap.Bounce;_easeMap.Sine;_easeMap.Expo;_easeMap.Circ;/*!
 * CSSPlugin 3.12.2
 * https://greensock.com
 *
 * Copyright 2008-2023, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var _win$2,_doc$2,_docElement,_pluginInitted,_tempDiv,_recentSetterPlugin,_reverting,_windowExists$1=function b(){return typeof window<"u"},_transformProps={},_RAD2DEG=180/Math.PI,_DEG2RAD=Math.PI/180,_atan2=Math.atan2,_bigNum=1e8,_capsExp$1=/([A-Z])/g,_horizontalExp=/(left|right|width|margin|padding|x)/i,_complexExp=/[\s,\(]\S/,_propertyAliases={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},_renderCSSProp=function b(g,j){return j.set(j.t,j.p,Math.round((j.s+j.c*g)*1e4)/1e4+j.u,j)},_renderPropWithEnd=function b(g,j){return j.set(j.t,j.p,g===1?j.e:Math.round((j.s+j.c*g)*1e4)/1e4+j.u,j)},_renderCSSPropWithBeginning=function b(g,j){return j.set(j.t,j.p,g?Math.round((j.s+j.c*g)*1e4)/1e4+j.u:j.b,j)},_renderRoundedCSSProp=function b(g,j){var d=j.s+j.c*g;j.set(j.t,j.p,~~(d+(d<0?-.5:.5))+j.u,j)},_renderNonTweeningValue=function b(g,j){return j.set(j.t,j.p,g?j.e:j.b,j)},_renderNonTweeningValueOnlyAtEnd=function b(g,j){return j.set(j.t,j.p,g!==1?j.b:j.e,j)},_setterCSSStyle=function b(g,j,d){return g.style[j]=d},_setterCSSProp=function b(g,j,d){return g.style.setProperty(j,d)},_setterTransform=function b(g,j,d){return g._gsap[j]=d},_setterScale=function b(g,j,d){return g._gsap.scaleX=g._gsap.scaleY=d},_setterScaleWithRender=function b(g,j,d,nt,at){var ht=g._gsap;ht.scaleX=ht.scaleY=d,ht.renderTransform(at,ht)},_setterTransformWithRender=function b(g,j,d,nt,at){var ht=g._gsap;ht[j]=d,ht.renderTransform(at,ht)},_transformProp$1="transform",_transformOriginProp=_transformProp$1+"Origin",_saveStyle=function b(g,j){var d=this,nt=this.target,at=nt.style;if(g in _transformProps&&at){if(this.tfm=this.tfm||{},g!=="transform")g=_propertyAliases[g]||g,~g.indexOf(",")?g.split(",").forEach(function(ht){return d.tfm[ht]=_get(nt,ht)}):this.tfm[g]=nt._gsap.x?nt._gsap[g]:_get(nt,g);else return _propertyAliases.transform.split(",").forEach(function(ht){return b.call(d,ht,j)});if(this.props.indexOf(_transformProp$1)>=0)return;nt._gsap.svg&&(this.svgo=nt.getAttribute("data-svg-origin"),this.props.push(_transformOriginProp,j,"")),g=_transformProp$1}(at||j)&&this.props.push(g,j,at[g])},_removeIndependentTransforms=function b(g){g.translate&&(g.removeProperty("translate"),g.removeProperty("scale"),g.removeProperty("rotate"))},_revertStyle=function b(){var g=this.props,j=this.target,d=j.style,nt=j._gsap,at,ht;for(at=0;at<g.length;at+=3)g[at+1]?j[g[at]]=g[at+2]:g[at+2]?d[g[at]]=g[at+2]:d.removeProperty(g[at].substr(0,2)==="--"?g[at]:g[at].replace(_capsExp$1,"-$1").toLowerCase());if(this.tfm){for(ht in this.tfm)nt[ht]=this.tfm[ht];nt.svg&&(nt.renderTransform(),j.setAttribute("data-svg-origin",this.svgo||"")),at=_reverting(),(!at||!at.isStart)&&!d[_transformProp$1]&&(_removeIndependentTransforms(d),nt.uncache=1)}},_getStyleSaver=function b(g,j){var d={target:g,props:[],revert:_revertStyle,save:_saveStyle};return g._gsap||gsap$2.core.getCache(g),j&&j.split(",").forEach(function(nt){return d.save(nt)}),d},_supports3D,_createElement=function b(g,j){var d=_doc$2.createElementNS?_doc$2.createElementNS((j||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),g):_doc$2.createElement(g);return d.style?d:_doc$2.createElement(g)},_getComputedProperty=function b(g,j,d){var nt=getComputedStyle(g);return nt[j]||nt.getPropertyValue(j.replace(_capsExp$1,"-$1").toLowerCase())||nt.getPropertyValue(j)||!d&&b(g,_checkPropPrefix(j)||j,1)||""},_prefixes="O,Moz,ms,Ms,Webkit".split(","),_checkPropPrefix=function b(g,j,d){var nt=j||_tempDiv,at=nt.style,ht=5;if(g in at&&!d)return g;for(g=g.charAt(0).toUpperCase()+g.substr(1);ht--&&!(_prefixes[ht]+g in at););return ht<0?null:(ht===3?"ms":ht>=0?_prefixes[ht]:"")+g},_initCore$1=function b(){_windowExists$1()&&window.document&&(_win$2=window,_doc$2=_win$2.document,_docElement=_doc$2.documentElement,_tempDiv=_createElement("div")||{style:{}},_createElement("div"),_transformProp$1=_checkPropPrefix(_transformProp$1),_transformOriginProp=_transformProp$1+"Origin",_tempDiv.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",_supports3D=!!_checkPropPrefix("perspective"),_reverting=gsap$2.core.reverting,_pluginInitted=1)},_getBBoxHack=function b(g){var j=_createElement("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),d=this.parentNode,nt=this.nextSibling,at=this.style.cssText,ht;if(_docElement.appendChild(j),j.appendChild(this),this.style.display="block",g)try{ht=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=b}catch{}else this._gsapBBox&&(ht=this._gsapBBox());return d&&(nt?d.insertBefore(this,nt):d.appendChild(this)),_docElement.removeChild(j),this.style.cssText=at,ht},_getAttributeFallbacks=function b(g,j){for(var d=j.length;d--;)if(g.hasAttribute(j[d]))return g.getAttribute(j[d])},_getBBox=function b(g){var j;try{j=g.getBBox()}catch{j=_getBBoxHack.call(g,!0)}return j&&(j.width||j.height)||g.getBBox===_getBBoxHack||(j=_getBBoxHack.call(g,!0)),j&&!j.width&&!j.x&&!j.y?{x:+_getAttributeFallbacks(g,["x","cx","x1"])||0,y:+_getAttributeFallbacks(g,["y","cy","y1"])||0,width:0,height:0}:j},_isSVG=function b(g){return!!(g.getCTM&&(!g.parentNode||g.ownerSVGElement)&&_getBBox(g))},_removeProperty=function b(g,j){if(j){var d=g.style;j in _transformProps&&j!==_transformOriginProp&&(j=_transformProp$1),d.removeProperty?((j.substr(0,2)==="ms"||j.substr(0,6)==="webkit")&&(j="-"+j),d.removeProperty(j.replace(_capsExp$1,"-$1").toLowerCase())):d.removeAttribute(j)}},_addNonTweeningPT=function b(g,j,d,nt,at,ht){var _t=new PropTween(g._pt,j,d,0,1,ht?_renderNonTweeningValueOnlyAtEnd:_renderNonTweeningValue);return g._pt=_t,_t.b=nt,_t.e=at,g._props.push(d),_t},_nonConvertibleUnits={deg:1,rad:1,turn:1},_nonStandardLayouts={grid:1,flex:1},_convertToUnit=function b(g,j,d,nt){var at=parseFloat(d)||0,ht=(d+"").trim().substr((at+"").length)||"px",_t=_tempDiv.style,bt=_horizontalExp.test(j),kt=g.tagName.toLowerCase()==="svg",Vt=(kt?"client":"offset")+(bt?"Width":"Height"),qt=100,zt=nt==="px",jt=nt==="%",Kt,Ft,nn,Lt;return nt===ht||!at||_nonConvertibleUnits[nt]||_nonConvertibleUnits[ht]?at:(ht!=="px"&&!zt&&(at=b(g,j,d,"px")),Lt=g.getCTM&&_isSVG(g),(jt||ht==="%")&&(_transformProps[j]||~j.indexOf("adius"))?(Kt=Lt?g.getBBox()[bt?"width":"height"]:g[Vt],_round$1(jt?at/Kt*qt:at/100*Kt)):(_t[bt?"width":"height"]=qt+(zt?ht:nt),Ft=~j.indexOf("adius")||nt==="em"&&g.appendChild&&!kt?g:g.parentNode,Lt&&(Ft=(g.ownerSVGElement||{}).parentNode),(!Ft||Ft===_doc$2||!Ft.appendChild)&&(Ft=_doc$2.body),nn=Ft._gsap,nn&&jt&&nn.width&&bt&&nn.time===_ticker.time&&!nn.uncache?_round$1(at/nn.width*qt):((jt||ht==="%")&&!_nonStandardLayouts[_getComputedProperty(Ft,"display")]&&(_t.position=_getComputedProperty(g,"position")),Ft===g&&(_t.position="static"),Ft.appendChild(_tempDiv),Kt=_tempDiv[Vt],Ft.removeChild(_tempDiv),_t.position="absolute",bt&&jt&&(nn=_getCache(Ft),nn.time=_ticker.time,nn.width=Ft[Vt]),_round$1(zt?Kt*at/qt:Kt&&at?qt/Kt*at:0))))},_get=function b(g,j,d,nt){var at;return _pluginInitted||_initCore$1(),j in _propertyAliases&&j!=="transform"&&(j=_propertyAliases[j],~j.indexOf(",")&&(j=j.split(",")[0])),_transformProps[j]&&j!=="transform"?(at=_parseTransform(g,nt),at=j!=="transformOrigin"?at[j]:at.svg?at.origin:_firstTwoOnly(_getComputedProperty(g,_transformOriginProp))+" "+at.zOrigin+"px"):(at=g.style[j],(!at||at==="auto"||nt||~(at+"").indexOf("calc("))&&(at=_specialProps[j]&&_specialProps[j](g,j,d)||_getComputedProperty(g,j)||_getProperty(g,j)||(j==="opacity"?1:0))),d&&!~(at+"").trim().indexOf(" ")?_convertToUnit(g,j,at,d)+d:at},_tweenComplexCSSString=function b(g,j,d,nt){if(!d||d==="none"){var at=_checkPropPrefix(j,g,1),ht=at&&_getComputedProperty(g,at,1);ht&&ht!==d?(j=at,d=ht):j==="borderColor"&&(d=_getComputedProperty(g,"borderTopColor"))}var _t=new PropTween(this._pt,g.style,j,0,1,_renderComplexString),bt=0,kt=0,Vt,qt,zt,jt,Kt,Ft,nn,Lt,Nt,Ht,on,en;if(_t.b=d,_t.e=nt,d+="",nt+="",nt==="auto"&&(g.style[j]=nt,nt=_getComputedProperty(g,j)||nt,g.style[j]=d),Vt=[d,nt],_colorStringFilter(Vt),d=Vt[0],nt=Vt[1],zt=d.match(_numWithUnitExp)||[],en=nt.match(_numWithUnitExp)||[],en.length){for(;qt=_numWithUnitExp.exec(nt);)nn=qt[0],Nt=nt.substring(bt,qt.index),Kt?Kt=(Kt+1)%5:(Nt.substr(-5)==="rgba("||Nt.substr(-5)==="hsla(")&&(Kt=1),nn!==(Ft=zt[kt++]||"")&&(jt=parseFloat(Ft)||0,on=Ft.substr((jt+"").length),nn.charAt(1)==="="&&(nn=_parseRelative(jt,nn)+on),Lt=parseFloat(nn),Ht=nn.substr((Lt+"").length),bt=_numWithUnitExp.lastIndex-Ht.length,Ht||(Ht=Ht||_config.units[j]||on,bt===nt.length&&(nt+=Ht,_t.e+=Ht)),on!==Ht&&(jt=_convertToUnit(g,j,Ft,Ht)||0),_t._pt={_next:_t._pt,p:Nt||kt===1?Nt:",",s:jt,c:Lt-jt,m:Kt&&Kt<4||j==="zIndex"?Math.round:0});_t.c=bt<nt.length?nt.substring(bt,nt.length):""}else _t.r=j==="display"&&nt==="none"?_renderNonTweeningValueOnlyAtEnd:_renderNonTweeningValue;return _relExp.test(nt)&&(_t.e=0),this._pt=_t,_t},_keywordToPercent={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},_convertKeywordsToPercentages=function b(g){var j=g.split(" "),d=j[0],nt=j[1]||"50%";return(d==="top"||d==="bottom"||nt==="left"||nt==="right")&&(g=d,d=nt,nt=g),j[0]=_keywordToPercent[d]||d,j[1]=_keywordToPercent[nt]||nt,j.join(" ")},_renderClearProps=function b(g,j){if(j.tween&&j.tween._time===j.tween._dur){var d=j.t,nt=d.style,at=j.u,ht=d._gsap,_t,bt,kt;if(at==="all"||at===!0)nt.cssText="",bt=1;else for(at=at.split(","),kt=at.length;--kt>-1;)_t=at[kt],_transformProps[_t]&&(bt=1,_t=_t==="transformOrigin"?_transformOriginProp:_transformProp$1),_removeProperty(d,_t);bt&&(_removeProperty(d,_transformProp$1),ht&&(ht.svg&&d.removeAttribute("transform"),_parseTransform(d,1),ht.uncache=1,_removeIndependentTransforms(nt)))}},_specialProps={clearProps:function b(g,j,d,nt,at){if(at.data!=="isFromStart"){var ht=g._pt=new PropTween(g._pt,j,d,0,0,_renderClearProps);return ht.u=nt,ht.pr=-10,ht.tween=at,g._props.push(d),1}}},_identity2DMatrix=[1,0,0,1,0,0],_rotationalProperties={},_isNullTransform=function b(g){return g==="matrix(1, 0, 0, 1, 0, 0)"||g==="none"||!g},_getComputedTransformMatrixAsArray=function b(g){var j=_getComputedProperty(g,_transformProp$1);return _isNullTransform(j)?_identity2DMatrix:j.substr(7).match(_numExp).map(_round$1)},_getMatrix=function b(g,j){var d=g._gsap||_getCache(g),nt=g.style,at=_getComputedTransformMatrixAsArray(g),ht,_t,bt,kt;return d.svg&&g.getAttribute("transform")?(bt=g.transform.baseVal.consolidate().matrix,at=[bt.a,bt.b,bt.c,bt.d,bt.e,bt.f],at.join(",")==="1,0,0,1,0,0"?_identity2DMatrix:at):(at===_identity2DMatrix&&!g.offsetParent&&g!==_docElement&&!d.svg&&(bt=nt.display,nt.display="block",ht=g.parentNode,(!ht||!g.offsetParent)&&(kt=1,_t=g.nextElementSibling,_docElement.appendChild(g)),at=_getComputedTransformMatrixAsArray(g),bt?nt.display=bt:_removeProperty(g,"display"),kt&&(_t?ht.insertBefore(g,_t):ht?ht.appendChild(g):_docElement.removeChild(g))),j&&at.length>6?[at[0],at[1],at[4],at[5],at[12],at[13]]:at)},_applySVGOrigin=function b(g,j,d,nt,at,ht){var _t=g._gsap,bt=at||_getMatrix(g,!0),kt=_t.xOrigin||0,Vt=_t.yOrigin||0,qt=_t.xOffset||0,zt=_t.yOffset||0,jt=bt[0],Kt=bt[1],Ft=bt[2],nn=bt[3],Lt=bt[4],Nt=bt[5],Ht=j.split(" "),on=parseFloat(Ht[0])||0,en=parseFloat(Ht[1])||0,cn,Ut,Gt,$t;d?bt!==_identity2DMatrix&&(Ut=jt*nn-Kt*Ft)&&(Gt=on*(nn/Ut)+en*(-Ft/Ut)+(Ft*Nt-nn*Lt)/Ut,$t=on*(-Kt/Ut)+en*(jt/Ut)-(jt*Nt-Kt*Lt)/Ut,on=Gt,en=$t):(cn=_getBBox(g),on=cn.x+(~Ht[0].indexOf("%")?on/100*cn.width:on),en=cn.y+(~(Ht[1]||Ht[0]).indexOf("%")?en/100*cn.height:en)),nt||nt!==!1&&_t.smooth?(Lt=on-kt,Nt=en-Vt,_t.xOffset=qt+(Lt*jt+Nt*Ft)-Lt,_t.yOffset=zt+(Lt*Kt+Nt*nn)-Nt):_t.xOffset=_t.yOffset=0,_t.xOrigin=on,_t.yOrigin=en,_t.smooth=!!nt,_t.origin=j,_t.originIsAbsolute=!!d,g.style[_transformOriginProp]="0px 0px",ht&&(_addNonTweeningPT(ht,_t,"xOrigin",kt,on),_addNonTweeningPT(ht,_t,"yOrigin",Vt,en),_addNonTweeningPT(ht,_t,"xOffset",qt,_t.xOffset),_addNonTweeningPT(ht,_t,"yOffset",zt,_t.yOffset)),g.setAttribute("data-svg-origin",on+" "+en)},_parseTransform=function b(g,j){var d=g._gsap||new GSCache(g);if("x"in d&&!j&&!d.uncache)return d;var nt=g.style,at=d.scaleX<0,ht="px",_t="deg",bt=getComputedStyle(g),kt=_getComputedProperty(g,_transformOriginProp)||"0",Vt,qt,zt,jt,Kt,Ft,nn,Lt,Nt,Ht,on,en,cn,Ut,Gt,$t,un,hn,Bn,ar,sr,ur,nr,hr,zn,Yn,sn,qn,Kn,wr,Gn,rn;return Vt=qt=zt=Ft=nn=Lt=Nt=Ht=on=0,jt=Kt=1,d.svg=!!(g.getCTM&&_isSVG(g)),bt.translate&&((bt.translate!=="none"||bt.scale!=="none"||bt.rotate!=="none")&&(nt[_transformProp$1]=(bt.translate!=="none"?"translate3d("+(bt.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(bt.rotate!=="none"?"rotate("+bt.rotate+") ":"")+(bt.scale!=="none"?"scale("+bt.scale.split(" ").join(",")+") ":"")+(bt[_transformProp$1]!=="none"?bt[_transformProp$1]:"")),nt.scale=nt.rotate=nt.translate="none"),Ut=_getMatrix(g,d.svg),d.svg&&(d.uncache?(zn=g.getBBox(),kt=d.xOrigin-zn.x+"px "+(d.yOrigin-zn.y)+"px",hr=""):hr=!j&&g.getAttribute("data-svg-origin"),_applySVGOrigin(g,hr||kt,!!hr||d.originIsAbsolute,d.smooth!==!1,Ut)),en=d.xOrigin||0,cn=d.yOrigin||0,Ut!==_identity2DMatrix&&(hn=Ut[0],Bn=Ut[1],ar=Ut[2],sr=Ut[3],Vt=ur=Ut[4],qt=nr=Ut[5],Ut.length===6?(jt=Math.sqrt(hn*hn+Bn*Bn),Kt=Math.sqrt(sr*sr+ar*ar),Ft=hn||Bn?_atan2(Bn,hn)*_RAD2DEG:0,Nt=ar||sr?_atan2(ar,sr)*_RAD2DEG+Ft:0,Nt&&(Kt*=Math.abs(Math.cos(Nt*_DEG2RAD))),d.svg&&(Vt-=en-(en*hn+cn*ar),qt-=cn-(en*Bn+cn*sr))):(rn=Ut[6],wr=Ut[7],sn=Ut[8],qn=Ut[9],Kn=Ut[10],Gn=Ut[11],Vt=Ut[12],qt=Ut[13],zt=Ut[14],Gt=_atan2(rn,Kn),nn=Gt*_RAD2DEG,Gt&&($t=Math.cos(-Gt),un=Math.sin(-Gt),hr=ur*$t+sn*un,zn=nr*$t+qn*un,Yn=rn*$t+Kn*un,sn=ur*-un+sn*$t,qn=nr*-un+qn*$t,Kn=rn*-un+Kn*$t,Gn=wr*-un+Gn*$t,ur=hr,nr=zn,rn=Yn),Gt=_atan2(-ar,Kn),Lt=Gt*_RAD2DEG,Gt&&($t=Math.cos(-Gt),un=Math.sin(-Gt),hr=hn*$t-sn*un,zn=Bn*$t-qn*un,Yn=ar*$t-Kn*un,Gn=sr*un+Gn*$t,hn=hr,Bn=zn,ar=Yn),Gt=_atan2(Bn,hn),Ft=Gt*_RAD2DEG,Gt&&($t=Math.cos(Gt),un=Math.sin(Gt),hr=hn*$t+Bn*un,zn=ur*$t+nr*un,Bn=Bn*$t-hn*un,nr=nr*$t-ur*un,hn=hr,ur=zn),nn&&Math.abs(nn)+Math.abs(Ft)>359.9&&(nn=Ft=0,Lt=180-Lt),jt=_round$1(Math.sqrt(hn*hn+Bn*Bn+ar*ar)),Kt=_round$1(Math.sqrt(nr*nr+rn*rn)),Gt=_atan2(ur,nr),Nt=Math.abs(Gt)>2e-4?Gt*_RAD2DEG:0,on=Gn?1/(Gn<0?-Gn:Gn):0),d.svg&&(hr=g.getAttribute("transform"),d.forceCSS=g.setAttribute("transform","")||!_isNullTransform(_getComputedProperty(g,_transformProp$1)),hr&&g.setAttribute("transform",hr))),Math.abs(Nt)>90&&Math.abs(Nt)<270&&(at?(jt*=-1,Nt+=Ft<=0?180:-180,Ft+=Ft<=0?180:-180):(Kt*=-1,Nt+=Nt<=0?180:-180)),j=j||d.uncache,d.x=Vt-((d.xPercent=Vt&&(!j&&d.xPercent||(Math.round(g.offsetWidth/2)===Math.round(-Vt)?-50:0)))?g.offsetWidth*d.xPercent/100:0)+ht,d.y=qt-((d.yPercent=qt&&(!j&&d.yPercent||(Math.round(g.offsetHeight/2)===Math.round(-qt)?-50:0)))?g.offsetHeight*d.yPercent/100:0)+ht,d.z=zt+ht,d.scaleX=_round$1(jt),d.scaleY=_round$1(Kt),d.rotation=_round$1(Ft)+_t,d.rotationX=_round$1(nn)+_t,d.rotationY=_round$1(Lt)+_t,d.skewX=Nt+_t,d.skewY=Ht+_t,d.transformPerspective=on+ht,(d.zOrigin=parseFloat(kt.split(" ")[2])||0)&&(nt[_transformOriginProp]=_firstTwoOnly(kt)),d.xOffset=d.yOffset=0,d.force3D=_config.force3D,d.renderTransform=d.svg?_renderSVGTransforms:_supports3D?_renderCSSTransforms:_renderNon3DTransforms,d.uncache=0,d},_firstTwoOnly=function b(g){return(g=g.split(" "))[0]+" "+g[1]},_addPxTranslate=function b(g,j,d){var nt=getUnit(j);return _round$1(parseFloat(j)+parseFloat(_convertToUnit(g,"x",d+"px",nt)))+nt},_renderNon3DTransforms=function b(g,j){j.z="0px",j.rotationY=j.rotationX="0deg",j.force3D=0,_renderCSSTransforms(g,j)},_zeroDeg="0deg",_zeroPx="0px",_endParenthesis=") ",_renderCSSTransforms=function b(g,j){var d=j||this,nt=d.xPercent,at=d.yPercent,ht=d.x,_t=d.y,bt=d.z,kt=d.rotation,Vt=d.rotationY,qt=d.rotationX,zt=d.skewX,jt=d.skewY,Kt=d.scaleX,Ft=d.scaleY,nn=d.transformPerspective,Lt=d.force3D,Nt=d.target,Ht=d.zOrigin,on="",en=Lt==="auto"&&g&&g!==1||Lt===!0;if(Ht&&(qt!==_zeroDeg||Vt!==_zeroDeg)){var cn=parseFloat(Vt)*_DEG2RAD,Ut=Math.sin(cn),Gt=Math.cos(cn),$t;cn=parseFloat(qt)*_DEG2RAD,$t=Math.cos(cn),ht=_addPxTranslate(Nt,ht,Ut*$t*-Ht),_t=_addPxTranslate(Nt,_t,-Math.sin(cn)*-Ht),bt=_addPxTranslate(Nt,bt,Gt*$t*-Ht+Ht)}nn!==_zeroPx&&(on+="perspective("+nn+_endParenthesis),(nt||at)&&(on+="translate("+nt+"%, "+at+"%) "),(en||ht!==_zeroPx||_t!==_zeroPx||bt!==_zeroPx)&&(on+=bt!==_zeroPx||en?"translate3d("+ht+", "+_t+", "+bt+") ":"translate("+ht+", "+_t+_endParenthesis),kt!==_zeroDeg&&(on+="rotate("+kt+_endParenthesis),Vt!==_zeroDeg&&(on+="rotateY("+Vt+_endParenthesis),qt!==_zeroDeg&&(on+="rotateX("+qt+_endParenthesis),(zt!==_zeroDeg||jt!==_zeroDeg)&&(on+="skew("+zt+", "+jt+_endParenthesis),(Kt!==1||Ft!==1)&&(on+="scale("+Kt+", "+Ft+_endParenthesis),Nt.style[_transformProp$1]=on||"translate(0, 0)"},_renderSVGTransforms=function b(g,j){var d=j||this,nt=d.xPercent,at=d.yPercent,ht=d.x,_t=d.y,bt=d.rotation,kt=d.skewX,Vt=d.skewY,qt=d.scaleX,zt=d.scaleY,jt=d.target,Kt=d.xOrigin,Ft=d.yOrigin,nn=d.xOffset,Lt=d.yOffset,Nt=d.forceCSS,Ht=parseFloat(ht),on=parseFloat(_t),en,cn,Ut,Gt,$t;bt=parseFloat(bt),kt=parseFloat(kt),Vt=parseFloat(Vt),Vt&&(Vt=parseFloat(Vt),kt+=Vt,bt+=Vt),bt||kt?(bt*=_DEG2RAD,kt*=_DEG2RAD,en=Math.cos(bt)*qt,cn=Math.sin(bt)*qt,Ut=Math.sin(bt-kt)*-zt,Gt=Math.cos(bt-kt)*zt,kt&&(Vt*=_DEG2RAD,$t=Math.tan(kt-Vt),$t=Math.sqrt(1+$t*$t),Ut*=$t,Gt*=$t,Vt&&($t=Math.tan(Vt),$t=Math.sqrt(1+$t*$t),en*=$t,cn*=$t)),en=_round$1(en),cn=_round$1(cn),Ut=_round$1(Ut),Gt=_round$1(Gt)):(en=qt,Gt=zt,cn=Ut=0),(Ht&&!~(ht+"").indexOf("px")||on&&!~(_t+"").indexOf("px"))&&(Ht=_convertToUnit(jt,"x",ht,"px"),on=_convertToUnit(jt,"y",_t,"px")),(Kt||Ft||nn||Lt)&&(Ht=_round$1(Ht+Kt-(Kt*en+Ft*Ut)+nn),on=_round$1(on+Ft-(Kt*cn+Ft*Gt)+Lt)),(nt||at)&&($t=jt.getBBox(),Ht=_round$1(Ht+nt/100*$t.width),on=_round$1(on+at/100*$t.height)),$t="matrix("+en+","+cn+","+Ut+","+Gt+","+Ht+","+on+")",jt.setAttribute("transform",$t),Nt&&(jt.style[_transformProp$1]=$t)},_addRotationalPropTween=function b(g,j,d,nt,at){var ht=360,_t=_isString$1(at),bt=parseFloat(at)*(_t&&~at.indexOf("rad")?_RAD2DEG:1),kt=bt-nt,Vt=nt+kt+"deg",qt,zt;return _t&&(qt=at.split("_")[1],qt==="short"&&(kt%=ht,kt!==kt%(ht/2)&&(kt+=kt<0?ht:-ht)),qt==="cw"&&kt<0?kt=(kt+ht*_bigNum)%ht-~~(kt/ht)*ht:qt==="ccw"&&kt>0&&(kt=(kt-ht*_bigNum)%ht-~~(kt/ht)*ht)),g._pt=zt=new PropTween(g._pt,j,d,nt,kt,_renderPropWithEnd),zt.e=Vt,zt.u="deg",g._props.push(d),zt},_assign=function b(g,j){for(var d in j)g[d]=j[d];return g},_addRawTransformPTs=function b(g,j,d){var nt=_assign({},d._gsap),at="perspective,force3D,transformOrigin,svgOrigin",ht=d.style,_t,bt,kt,Vt,qt,zt,jt,Kt;nt.svg?(kt=d.getAttribute("transform"),d.setAttribute("transform",""),ht[_transformProp$1]=j,_t=_parseTransform(d,1),_removeProperty(d,_transformProp$1),d.setAttribute("transform",kt)):(kt=getComputedStyle(d)[_transformProp$1],ht[_transformProp$1]=j,_t=_parseTransform(d,1),ht[_transformProp$1]=kt);for(bt in _transformProps)kt=nt[bt],Vt=_t[bt],kt!==Vt&&at.indexOf(bt)<0&&(jt=getUnit(kt),Kt=getUnit(Vt),qt=jt!==Kt?_convertToUnit(d,bt,kt,Kt):parseFloat(kt),zt=parseFloat(Vt),g._pt=new PropTween(g._pt,_t,bt,qt,zt-qt,_renderCSSProp),g._pt.u=Kt||0,g._props.push(bt));_assign(_t,nt)};_forEachName("padding,margin,Width,Radius",function(b,g){var j="Top",d="Right",nt="Bottom",at="Left",ht=(g<3?[j,d,nt,at]:[j+at,j+d,nt+d,nt+at]).map(function(_t){return g<2?b+_t:"border"+_t+b});_specialProps[g>1?"border"+b:b]=function(_t,bt,kt,Vt,qt){var zt,jt;if(arguments.length<4)return zt=ht.map(function(Kt){return _get(_t,Kt,kt)}),jt=zt.join(" "),jt.split(zt[0]).length===5?zt[0]:jt;zt=(Vt+"").split(" "),jt={},ht.forEach(function(Kt,Ft){return jt[Kt]=zt[Ft]=zt[Ft]||zt[(Ft-1)/2|0]}),_t.init(bt,jt,qt)}});var CSSPlugin={name:"css",register:_initCore$1,targetTest:function b(g){return g.style&&g.nodeType},init:function b(g,j,d,nt,at){var ht=this._props,_t=g.style,bt=d.vars.startAt,kt,Vt,qt,zt,jt,Kt,Ft,nn,Lt,Nt,Ht,on,en,cn,Ut,Gt;_pluginInitted||_initCore$1(),this.styles=this.styles||_getStyleSaver(g),Gt=this.styles.props,this.tween=d;for(Ft in j)if(Ft!=="autoRound"&&(Vt=j[Ft],!(_plugins[Ft]&&_checkPlugin(Ft,j,d,nt,g,at)))){if(jt=typeof Vt,Kt=_specialProps[Ft],jt==="function"&&(Vt=Vt.call(d,nt,g,at),jt=typeof Vt),jt==="string"&&~Vt.indexOf("random(")&&(Vt=_replaceRandom(Vt)),Kt)Kt(this,g,Ft,Vt,d)&&(Ut=1);else if(Ft.substr(0,2)==="--")kt=(getComputedStyle(g).getPropertyValue(Ft)+"").trim(),Vt+="",_colorExp.lastIndex=0,_colorExp.test(kt)||(nn=getUnit(kt),Lt=getUnit(Vt)),Lt?nn!==Lt&&(kt=_convertToUnit(g,Ft,kt,Lt)+Lt):nn&&(Vt+=nn),this.add(_t,"setProperty",kt,Vt,nt,at,0,0,Ft),ht.push(Ft),Gt.push(Ft,0,_t[Ft]);else if(jt!=="undefined"){if(bt&&Ft in bt?(kt=typeof bt[Ft]=="function"?bt[Ft].call(d,nt,g,at):bt[Ft],_isString$1(kt)&&~kt.indexOf("random(")&&(kt=_replaceRandom(kt)),getUnit(kt+"")||(kt+=_config.units[Ft]||getUnit(_get(g,Ft))||""),(kt+"").charAt(1)==="="&&(kt=_get(g,Ft))):kt=_get(g,Ft),zt=parseFloat(kt),Nt=jt==="string"&&Vt.charAt(1)==="="&&Vt.substr(0,2),Nt&&(Vt=Vt.substr(2)),qt=parseFloat(Vt),Ft in _propertyAliases&&(Ft==="autoAlpha"&&(zt===1&&_get(g,"visibility")==="hidden"&&qt&&(zt=0),Gt.push("visibility",0,_t.visibility),_addNonTweeningPT(this,_t,"visibility",zt?"inherit":"hidden",qt?"inherit":"hidden",!qt)),Ft!=="scale"&&Ft!=="transform"&&(Ft=_propertyAliases[Ft],~Ft.indexOf(",")&&(Ft=Ft.split(",")[0]))),Ht=Ft in _transformProps,Ht){if(this.styles.save(Ft),on||(en=g._gsap,en.renderTransform&&!j.parseTransform||_parseTransform(g,j.parseTransform),cn=j.smoothOrigin!==!1&&en.smooth,on=this._pt=new PropTween(this._pt,_t,_transformProp$1,0,1,en.renderTransform,en,0,-1),on.dep=1),Ft==="scale")this._pt=new PropTween(this._pt,en,"scaleY",en.scaleY,(Nt?_parseRelative(en.scaleY,Nt+qt):qt)-en.scaleY||0,_renderCSSProp),this._pt.u=0,ht.push("scaleY",Ft),Ft+="X";else if(Ft==="transformOrigin"){Gt.push(_transformOriginProp,0,_t[_transformOriginProp]),Vt=_convertKeywordsToPercentages(Vt),en.svg?_applySVGOrigin(g,Vt,0,cn,0,this):(Lt=parseFloat(Vt.split(" ")[2])||0,Lt!==en.zOrigin&&_addNonTweeningPT(this,en,"zOrigin",en.zOrigin,Lt),_addNonTweeningPT(this,_t,Ft,_firstTwoOnly(kt),_firstTwoOnly(Vt)));continue}else if(Ft==="svgOrigin"){_applySVGOrigin(g,Vt,1,cn,0,this);continue}else if(Ft in _rotationalProperties){_addRotationalPropTween(this,en,Ft,zt,Nt?_parseRelative(zt,Nt+Vt):Vt);continue}else if(Ft==="smoothOrigin"){_addNonTweeningPT(this,en,"smooth",en.smooth,Vt);continue}else if(Ft==="force3D"){en[Ft]=Vt;continue}else if(Ft==="transform"){_addRawTransformPTs(this,Vt,g);continue}}else Ft in _t||(Ft=_checkPropPrefix(Ft)||Ft);if(Ht||(qt||qt===0)&&(zt||zt===0)&&!_complexExp.test(Vt)&&Ft in _t)nn=(kt+"").substr((zt+"").length),qt||(qt=0),Lt=getUnit(Vt)||(Ft in _config.units?_config.units[Ft]:nn),nn!==Lt&&(zt=_convertToUnit(g,Ft,kt,Lt)),this._pt=new PropTween(this._pt,Ht?en:_t,Ft,zt,(Nt?_parseRelative(zt,Nt+qt):qt)-zt,!Ht&&(Lt==="px"||Ft==="zIndex")&&j.autoRound!==!1?_renderRoundedCSSProp:_renderCSSProp),this._pt.u=Lt||0,nn!==Lt&&Lt!=="%"&&(this._pt.b=kt,this._pt.r=_renderCSSPropWithBeginning);else if(Ft in _t)_tweenComplexCSSString.call(this,g,Ft,kt,Nt?Nt+Vt:Vt);else if(Ft in g)this.add(g,Ft,kt||g[Ft],Nt?Nt+Vt:Vt,nt,at);else if(Ft!=="parseTransform"){_missingPlugin(Ft,Vt);continue}Ht||(Ft in _t?Gt.push(Ft,0,_t[Ft]):Gt.push(Ft,1,kt||g[Ft])),ht.push(Ft)}}Ut&&_sortPropTweensByPriority(this)},render:function b(g,j){if(j.tween._time||!_reverting())for(var d=j._pt;d;)d.r(g,d.d),d=d._next;else j.styles.revert()},get:_get,aliases:_propertyAliases,getSetter:function b(g,j,d){var nt=_propertyAliases[j];return nt&&nt.indexOf(",")<0&&(j=nt),j in _transformProps&&j!==_transformOriginProp&&(g._gsap.x||_get(g,"x"))?d&&_recentSetterPlugin===d?j==="scale"?_setterScale:_setterTransform:(_recentSetterPlugin=d||{})&&(j==="scale"?_setterScaleWithRender:_setterTransformWithRender):g.style&&!_isUndefined(g.style[j])?_setterCSSStyle:~j.indexOf("-")?_setterCSSProp:_getSetter(g,j)},core:{_removeProperty,_getMatrix}};gsap$2.utils.checkPrefix=_checkPropPrefix;gsap$2.core.getStyleSaver=_getStyleSaver;(function(b,g,j,d){var nt=_forEachName(b+","+g+","+j,function(at){_transformProps[at]=1});_forEachName(g,function(at){_config.units[at]="deg",_rotationalProperties[at]=1}),_propertyAliases[nt[13]]=b+","+g,_forEachName(d,function(at){var ht=at.split(":");_propertyAliases[ht[1]]=nt[ht[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");_forEachName("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(b){_config.units[b]="px"});gsap$2.registerPlugin(CSSPlugin);var gsapWithCSS=gsap$2.registerPlugin(CSSPlugin)||gsap$2;gsapWithCSS.core.Tween;function _defineProperties(b,g){for(var j=0;j<g.length;j++){var d=g[j];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(b,d.key,d)}}function _createClass(b,g,j){return g&&_defineProperties(b.prototype,g),j&&_defineProperties(b,j),b}/*!
 * Observer 3.12.2
 * https://greensock.com
 *
 * @license Copyright 2008-2023, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var gsap$1,_coreInitted$1,_win$1,_doc$1,_docEl$1,_body$1,_isTouch,_pointerType,ScrollTrigger$1,_root$1,_normalizer$1,_eventTypes,_context$1,_getGSAP$1=function b(){return gsap$1||typeof window<"u"&&(gsap$1=window.gsap)&&gsap$1.registerPlugin&&gsap$1},_startup$1=1,_observers=[],_scrollers=[],_proxies=[],_getTime$1=Date.now,_bridge=function b(g,j){return j},_integrate=function b(){var g=ScrollTrigger$1.core,j=g.bridge||{},d=g._scrollers,nt=g._proxies;d.push.apply(d,_scrollers),nt.push.apply(nt,_proxies),_scrollers=d,_proxies=nt,_bridge=function(ht,_t){return j[ht](_t)}},_getProxyProp=function b(g,j){return~_proxies.indexOf(g)&&_proxies[_proxies.indexOf(g)+1][j]},_isViewport$1=function b(g){return!!~_root$1.indexOf(g)},_addListener$1=function b(g,j,d,nt,at){return g.addEventListener(j,d,{passive:!nt,capture:!!at})},_removeListener$1=function b(g,j,d,nt){return g.removeEventListener(j,d,!!nt)},_scrollLeft="scrollLeft",_scrollTop="scrollTop",_onScroll$1=function b(){return _normalizer$1&&_normalizer$1.isPressed||_scrollers.cache++},_scrollCacheFunc=function b(g,j){var d=function nt(at){if(at||at===0){_startup$1&&(_win$1.history.scrollRestoration="manual");var ht=_normalizer$1&&_normalizer$1.isPressed;at=nt.v=Math.round(at)||(_normalizer$1&&_normalizer$1.iOS?1:0),g(at),nt.cacheID=_scrollers.cache,ht&&_bridge("ss",at)}else(j||_scrollers.cache!==nt.cacheID||_bridge("ref"))&&(nt.cacheID=_scrollers.cache,nt.v=g());return nt.v+nt.offset};return d.offset=0,g&&d},_horizontal={s:_scrollLeft,p:"left",p2:"Left",os:"right",os2:"Right",d:"width",d2:"Width",a:"x",sc:_scrollCacheFunc(function(b){return arguments.length?_win$1.scrollTo(b,_vertical.sc()):_win$1.pageXOffset||_doc$1[_scrollLeft]||_docEl$1[_scrollLeft]||_body$1[_scrollLeft]||0})},_vertical={s:_scrollTop,p:"top",p2:"Top",os:"bottom",os2:"Bottom",d:"height",d2:"Height",a:"y",op:_horizontal,sc:_scrollCacheFunc(function(b){return arguments.length?_win$1.scrollTo(_horizontal.sc(),b):_win$1.pageYOffset||_doc$1[_scrollTop]||_docEl$1[_scrollTop]||_body$1[_scrollTop]||0})},_getTarget=function b(g,j){return(j&&j._ctx&&j._ctx.selector||gsap$1.utils.toArray)(g)[0]||(typeof g=="string"&&gsap$1.config().nullTargetWarn!==!1?console.warn("Element not found:",g):null)},_getScrollFunc=function b(g,j){var d=j.s,nt=j.sc;_isViewport$1(g)&&(g=_doc$1.scrollingElement||_docEl$1);var at=_scrollers.indexOf(g),ht=nt===_vertical.sc?1:2;!~at&&(at=_scrollers.push(g)-1),_scrollers[at+ht]||_addListener$1(g,"scroll",_onScroll$1);var _t=_scrollers[at+ht],bt=_t||(_scrollers[at+ht]=_scrollCacheFunc(_getProxyProp(g,d),!0)||(_isViewport$1(g)?nt:_scrollCacheFunc(function(kt){return arguments.length?g[d]=kt:g[d]})));return bt.target=g,_t||(bt.smooth=gsap$1.getProperty(g,"scrollBehavior")==="smooth"),bt},_getVelocityProp=function b(g,j,d){var nt=g,at=g,ht=_getTime$1(),_t=ht,bt=j||50,kt=Math.max(500,bt*3),Vt=function(Kt,Ft){var nn=_getTime$1();Ft||nn-ht>bt?(at=nt,nt=Kt,_t=ht,ht=nn):d?nt+=Kt:nt=at+(Kt-at)/(nn-_t)*(ht-_t)},qt=function(){at=nt=d?0:nt,_t=ht=0},zt=function(Kt){var Ft=_t,nn=at,Lt=_getTime$1();return(Kt||Kt===0)&&Kt!==nt&&Vt(Kt),ht===_t||Lt-_t>kt?0:(nt+(d?nn:-nn))/((d?Lt:ht)-Ft)*1e3};return{update:Vt,reset:qt,getVelocity:zt}},_getEvent=function b(g,j){return j&&!g._gsapAllow&&g.preventDefault(),g.changedTouches?g.changedTouches[0]:g},_getAbsoluteMax=function b(g){var j=Math.max.apply(Math,g),d=Math.min.apply(Math,g);return Math.abs(j)>=Math.abs(d)?j:d},_setScrollTrigger=function b(){ScrollTrigger$1=gsap$1.core.globals().ScrollTrigger,ScrollTrigger$1&&ScrollTrigger$1.core&&_integrate()},_initCore=function b(g){return gsap$1=g||_getGSAP$1(),gsap$1&&typeof document<"u"&&document.body&&(_win$1=window,_doc$1=document,_docEl$1=_doc$1.documentElement,_body$1=_doc$1.body,_root$1=[_win$1,_doc$1,_docEl$1,_body$1],gsap$1.utils.clamp,_context$1=gsap$1.core.context||function(){},_pointerType="onpointerenter"in _body$1?"pointer":"mouse",_isTouch=Observer.isTouch=_win$1.matchMedia&&_win$1.matchMedia("(hover: none), (pointer: coarse)").matches?1:"ontouchstart"in _win$1||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?2:0,_eventTypes=Observer.eventTypes=("ontouchstart"in _docEl$1?"touchstart,touchmove,touchcancel,touchend":"onpointerdown"in _docEl$1?"pointerdown,pointermove,pointercancel,pointerup":"mousedown,mousemove,mouseup,mouseup").split(","),setTimeout(function(){return _startup$1=0},500),_setScrollTrigger(),_coreInitted$1=1),_coreInitted$1};_horizontal.op=_vertical;_scrollers.cache=0;var Observer=function(){function b(j){this.init(j)}var g=b.prototype;return g.init=function(d){_coreInitted$1||_initCore(gsap$1)||console.warn("Please gsap.registerPlugin(Observer)"),ScrollTrigger$1||_setScrollTrigger();var nt=d.tolerance,at=d.dragMinimum,ht=d.type,_t=d.target,bt=d.lineHeight,kt=d.debounce,Vt=d.preventDefault,qt=d.onStop,zt=d.onStopDelay,jt=d.ignore,Kt=d.wheelSpeed,Ft=d.event,nn=d.onDragStart,Lt=d.onDragEnd,Nt=d.onDrag,Ht=d.onPress,on=d.onRelease,en=d.onRight,cn=d.onLeft,Ut=d.onUp,Gt=d.onDown,$t=d.onChangeX,un=d.onChangeY,hn=d.onChange,Bn=d.onToggleX,ar=d.onToggleY,sr=d.onHover,ur=d.onHoverEnd,nr=d.onMove,hr=d.ignoreCheck,zn=d.isNormalizer,Yn=d.onGestureStart,sn=d.onGestureEnd,qn=d.onWheel,Kn=d.onEnable,wr=d.onDisable,Gn=d.onClick,rn=d.scrollSpeed,dn=d.capture,kn=d.allowClicks,Cr=d.lockAxis,Ar=d.onLockAxis;this.target=_t=_getTarget(_t)||_docEl$1,this.vars=d,jt&&(jt=gsap$1.utils.toArray(jt)),nt=nt||1e-9,at=at||0,Kt=Kt||1,rn=rn||1,ht=ht||"wheel,touch,pointer",kt=kt!==!1,bt||(bt=parseFloat(_win$1.getComputedStyle(_body$1).lineHeight)||22);var Lr,ls,Rs,us,ws,io,ks,er=this,Vs=0,Ll=0,Nl=_getScrollFunc(_t,_horizontal),Qs=_getScrollFunc(_t,_vertical),So=Nl(),_l=Qs(),Mo=~ht.indexOf("touch")&&!~ht.indexOf("pointer")&&_eventTypes[0]==="pointerdown",Bo=_isViewport$1(_t),_o=_t.ownerDocument||_doc$1,fo=[0,0,0],Wl=[0,0,0],Oo=0,yl=function(){return Oo=_getTime$1()},Dp=function(Wr,os){return(er.event=Wr)&&jt&&~jt.indexOf(Wr.target)||os&&Mo&&Wr.pointerType!=="touch"||hr&&hr(Wr,os)},co=function(){er._vx.reset(),er._vy.reset(),ls.pause(),qt&&qt(er)},gu=function(){var Wr=er.deltaX=_getAbsoluteMax(fo),os=er.deltaY=_getAbsoluteMax(Wl),Al=Math.abs(Wr)>=nt,ss=Math.abs(os)>=nt;hn&&(Al||ss)&&hn(er,Wr,os,fo,Wl),Al&&(en&&er.deltaX>0&&en(er),cn&&er.deltaX<0&&cn(er),$t&&$t(er),Bn&&er.deltaX<0!=Vs<0&&Bn(er),Vs=er.deltaX,fo[0]=fo[1]=fo[2]=0),ss&&(Gt&&er.deltaY>0&&Gt(er),Ut&&er.deltaY<0&&Ut(er),un&&un(er),ar&&er.deltaY<0!=Ll<0&&ar(er),Ll=er.deltaY,Wl[0]=Wl[1]=Wl[2]=0),(us||Rs)&&(nr&&nr(er),Rs&&(Nt(er),Rs=!1),us=!1),io&&!(io=!1)&&Ar&&Ar(er),ws&&(qn(er),ws=!1),Lr=0},zo=function(Wr,os,Al){fo[Al]+=Wr,Wl[Al]+=os,er._vx.update(Wr),er._vy.update(os),kt?Lr||(Lr=requestAnimationFrame(gu)):gu()},Yu=function(Wr,os){Cr&&!ks&&(er.axis=ks=Math.abs(Wr)>Math.abs(os)?"x":"y",io=!0),ks!=="y"&&(fo[2]+=Wr,er._vx.update(Wr,!0)),ks!=="x"&&(Wl[2]+=os,er._vy.update(os,!0)),kt?Lr||(Lr=requestAnimationFrame(gu)):gu()},Rp=function(Wr){if(!Dp(Wr,1)){Wr=_getEvent(Wr,Vt);var os=Wr.clientX,Al=Wr.clientY,ss=os-er.x,Ls=Al-er.y,vs=er.isDragging;er.x=os,er.y=Al,(vs||Math.abs(er.startX-os)>=at||Math.abs(er.startY-Al)>=at)&&(Nt&&(Rs=!0),vs||(er.isDragging=!0),Yu(ss,Ls),vs||nn&&nn(er))}},oo=er.onPress=function(Ds){Dp(Ds,1)||Ds&&Ds.button||(er.axis=ks=null,ls.pause(),er.isPressed=!0,Ds=_getEvent(Ds),Vs=Ll=0,er.startX=er.x=Ds.clientX,er.startY=er.y=Ds.clientY,er._vx.reset(),er._vy.reset(),_addListener$1(zn?_t:_o,_eventTypes[1],Rp,Vt,!0),er.deltaX=er.deltaY=0,Ht&&Ht(er))},To=er.onRelease=function(Ds){if(!Dp(Ds,1)){_removeListener$1(zn?_t:_o,_eventTypes[1],Rp,!0);var Wr=!isNaN(er.y-er.startY),os=er.isDragging&&(Math.abs(er.x-er.startX)>3||Math.abs(er.y-er.startY)>3),Al=_getEvent(Ds);!os&&Wr&&(er._vx.reset(),er._vy.reset(),Vt&&kn&&gsap$1.delayedCall(.08,function(){if(_getTime$1()-Oo>300&&!Ds.defaultPrevented){if(Ds.target.click)Ds.target.click();else if(_o.createEvent){var ss=_o.createEvent("MouseEvents");ss.initMouseEvent("click",!0,!0,_win$1,1,Al.screenX,Al.screenY,Al.clientX,Al.clientY,!1,!1,!1,!1,0,null),Ds.target.dispatchEvent(ss)}}})),er.isDragging=er.isGesturing=er.isPressed=!1,qt&&!zn&&ls.restart(!0),Lt&&os&&Lt(er),on&&on(er,os)}},Gs=function(Wr){return Wr.touches&&Wr.touches.length>1&&(er.isGesturing=!0)&&Yn(Wr,er.isDragging)},Jl=function(){return(er.isGesturing=!1)||sn(er)},Xu=function(Wr){if(!Dp(Wr)){var os=Nl(),Al=Qs();zo((os-So)*rn,(Al-_l)*rn,1),So=os,_l=Al,qt&&ls.restart(!0)}},Pu=function(Wr){if(!Dp(Wr)){Wr=_getEvent(Wr,Vt),qn&&(ws=!0);var os=(Wr.deltaMode===1?bt:Wr.deltaMode===2?_win$1.innerHeight:1)*Kt;zo(Wr.deltaX*os,Wr.deltaY*os,0),qt&&!zn&&ls.restart(!0)}},xu=function(Wr){if(!Dp(Wr)){var os=Wr.clientX,Al=Wr.clientY,ss=os-er.x,Ls=Al-er.y;er.x=os,er.y=Al,us=!0,(ss||Ls)&&Yu(ss,Ls)}},jn=function(Wr){er.event=Wr,sr(er)},Pl=function(Wr){er.event=Wr,ur(er)},pu=function(Wr){return Dp(Wr)||_getEvent(Wr,Vt)&&Gn(er)};ls=er._dc=gsap$1.delayedCall(zt||.25,co).pause(),er.deltaX=er.deltaY=0,er._vx=_getVelocityProp(0,50,!0),er._vy=_getVelocityProp(0,50,!0),er.scrollX=Nl,er.scrollY=Qs,er.isDragging=er.isGesturing=er.isPressed=!1,_context$1(this),er.enable=function(Ds){return er.isEnabled||(_addListener$1(Bo?_o:_t,"scroll",_onScroll$1),ht.indexOf("scroll")>=0&&_addListener$1(Bo?_o:_t,"scroll",Xu,Vt,dn),ht.indexOf("wheel")>=0&&_addListener$1(_t,"wheel",Pu,Vt,dn),(ht.indexOf("touch")>=0&&_isTouch||ht.indexOf("pointer")>=0)&&(_addListener$1(_t,_eventTypes[0],oo,Vt,dn),_addListener$1(_o,_eventTypes[2],To),_addListener$1(_o,_eventTypes[3],To),kn&&_addListener$1(_t,"click",yl,!1,!0),Gn&&_addListener$1(_t,"click",pu),Yn&&_addListener$1(_o,"gesturestart",Gs),sn&&_addListener$1(_o,"gestureend",Jl),sr&&_addListener$1(_t,_pointerType+"enter",jn),ur&&_addListener$1(_t,_pointerType+"leave",Pl),nr&&_addListener$1(_t,_pointerType+"move",xu)),er.isEnabled=!0,Ds&&Ds.type&&oo(Ds),Kn&&Kn(er)),er},er.disable=function(){er.isEnabled&&(_observers.filter(function(Ds){return Ds!==er&&_isViewport$1(Ds.target)}).length||_removeListener$1(Bo?_o:_t,"scroll",_onScroll$1),er.isPressed&&(er._vx.reset(),er._vy.reset(),_removeListener$1(zn?_t:_o,_eventTypes[1],Rp,!0)),_removeListener$1(Bo?_o:_t,"scroll",Xu,dn),_removeListener$1(_t,"wheel",Pu,dn),_removeListener$1(_t,_eventTypes[0],oo,dn),_removeListener$1(_o,_eventTypes[2],To),_removeListener$1(_o,_eventTypes[3],To),_removeListener$1(_t,"click",yl,!0),_removeListener$1(_t,"click",pu),_removeListener$1(_o,"gesturestart",Gs),_removeListener$1(_o,"gestureend",Jl),_removeListener$1(_t,_pointerType+"enter",jn),_removeListener$1(_t,_pointerType+"leave",Pl),_removeListener$1(_t,_pointerType+"move",xu),er.isEnabled=er.isPressed=er.isDragging=!1,wr&&wr(er))},er.kill=er.revert=function(){er.disable();var Ds=_observers.indexOf(er);Ds>=0&&_observers.splice(Ds,1),_normalizer$1===er&&(_normalizer$1=0)},_observers.push(er),zn&&_isViewport$1(_t)&&(_normalizer$1=er),er.enable(Ft)},_createClass(b,[{key:"velocityX",get:function(){return this._vx.getVelocity()}},{key:"velocityY",get:function(){return this._vy.getVelocity()}}]),b}();Observer.version="3.12.2";Observer.create=function(b){return new Observer(b)};Observer.register=_initCore;Observer.getAll=function(){return _observers.slice()};Observer.getById=function(b){return _observers.filter(function(g){return g.vars.id===b})[0]};_getGSAP$1()&&gsap$1.registerPlugin(Observer);/*!
 * ScrollTrigger 3.12.2
 * https://greensock.com
 *
 * @license Copyright 2008-2023, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var gsap,_coreInitted,_win,_doc,_docEl,_body,_root,_resizeDelay,_toArray,_clamp,_time2,_syncInterval,_refreshing,_pointerIsDown,_transformProp,_i,_prevWidth,_prevHeight,_autoRefresh,_sort,_suppressOverwrites,_ignoreResize,_normalizer,_ignoreMobileResize,_baseScreenHeight,_baseScreenWidth,_fixIOSBug,_context,_scrollRestoration,_div100vh,_100vh,_limitCallbacks,_startup=1,_getTime=Date.now,_time1=_getTime(),_lastScrollTime=0,_enabled=0,_parseClamp=function b(g,j,d){var nt=_isString(g)&&(g.substr(0,6)==="clamp("||g.indexOf("max")>-1);return d["_"+j+"Clamp"]=nt,nt?g.substr(6,g.length-7):g},_keepClamp=function b(g,j){return j&&(!_isString(g)||g.substr(0,6)!=="clamp(")?"clamp("+g+")":g},_rafBugFix=function b(){return _enabled&&requestAnimationFrame(b)},_pointerDownHandler=function b(){return _pointerIsDown=1},_pointerUpHandler=function b(){return _pointerIsDown=0},_passThrough=function b(g){return g},_round=function b(g){return Math.round(g*1e5)/1e5||0},_windowExists=function b(){return typeof window<"u"},_getGSAP=function b(){return gsap||_windowExists()&&(gsap=window.gsap)&&gsap.registerPlugin&&gsap},_isViewport=function b(g){return!!~_root.indexOf(g)},_getViewportDimension=function b(g){return(g==="Height"?_100vh:_win["inner"+g])||_docEl["client"+g]||_body["client"+g]},_getBoundsFunc=function b(g){return _getProxyProp(g,"getBoundingClientRect")||(_isViewport(g)?function(){return _winOffsets.width=_win.innerWidth,_winOffsets.height=_100vh,_winOffsets}:function(){return _getBounds(g)})},_getSizeFunc=function b(g,j,d){var nt=d.d,at=d.d2,ht=d.a;return(ht=_getProxyProp(g,"getBoundingClientRect"))?function(){return ht()[nt]}:function(){return(j?_getViewportDimension(at):g["client"+at])||0}},_getOffsetsFunc=function b(g,j){return!j||~_proxies.indexOf(g)?_getBoundsFunc(g):function(){return _winOffsets}},_maxScroll=function b(g,j){var d=j.s,nt=j.d2,at=j.d,ht=j.a;return Math.max(0,(d="scroll"+nt)&&(ht=_getProxyProp(g,d))?ht()-_getBoundsFunc(g)()[at]:_isViewport(g)?(_docEl[d]||_body[d])-_getViewportDimension(nt):g[d]-g["offset"+nt])},_iterateAutoRefresh=function b(g,j){for(var d=0;d<_autoRefresh.length;d+=3)(!j||~j.indexOf(_autoRefresh[d+1]))&&g(_autoRefresh[d],_autoRefresh[d+1],_autoRefresh[d+2])},_isString=function b(g){return typeof g=="string"},_isFunction=function b(g){return typeof g=="function"},_isNumber=function b(g){return typeof g=="number"},_isObject=function b(g){return typeof g=="object"},_endAnimation=function b(g,j,d){return g&&g.progress(j?0:1)&&d&&g.pause()},_callback=function b(g,j){if(g.enabled){var d=j(g);d&&d.totalTime&&(g.callbackAnimation=d)}},_abs=Math.abs,_left="left",_top="top",_right="right",_bottom="bottom",_width="width",_height="height",_Right="Right",_Left="Left",_Top="Top",_Bottom="Bottom",_padding="padding",_margin="margin",_Width="Width",_Height="Height",_px="px",_getComputedStyle=function b(g){return _win.getComputedStyle(g)},_makePositionable=function b(g){var j=_getComputedStyle(g).position;g.style.position=j==="absolute"||j==="fixed"?j:"relative"},_setDefaults=function b(g,j){for(var d in j)d in g||(g[d]=j[d]);return g},_getBounds=function b(g,j){var d=j&&_getComputedStyle(g)[_transformProp]!=="matrix(1, 0, 0, 1, 0, 0)"&&gsap.to(g,{x:0,y:0,xPercent:0,yPercent:0,rotation:0,rotationX:0,rotationY:0,scale:1,skewX:0,skewY:0}).progress(1),nt=g.getBoundingClientRect();return d&&d.progress(0).kill(),nt},_getSize=function b(g,j){var d=j.d2;return g["offset"+d]||g["client"+d]||0},_getLabelRatioArray=function b(g){var j=[],d=g.labels,nt=g.duration(),at;for(at in d)j.push(d[at]/nt);return j},_getClosestLabel=function b(g){return function(j){return gsap.utils.snap(_getLabelRatioArray(g),j)}},_snapDirectional=function b(g){var j=gsap.utils.snap(g),d=Array.isArray(g)&&g.slice(0).sort(function(nt,at){return nt-at});return d?function(nt,at,ht){ht===void 0&&(ht=.001);var _t;if(!at)return j(nt);if(at>0){for(nt-=ht,_t=0;_t<d.length;_t++)if(d[_t]>=nt)return d[_t];return d[_t-1]}else for(_t=d.length,nt+=ht;_t--;)if(d[_t]<=nt)return d[_t];return d[0]}:function(nt,at,ht){ht===void 0&&(ht=.001);var _t=j(nt);return!at||Math.abs(_t-nt)<ht||_t-nt<0==at<0?_t:j(at<0?nt-g:nt+g)}},_getLabelAtDirection=function b(g){return function(j,d){return _snapDirectional(_getLabelRatioArray(g))(j,d.direction)}},_multiListener=function b(g,j,d,nt){return d.split(",").forEach(function(at){return g(j,at,nt)})},_addListener=function b(g,j,d,nt,at){return g.addEventListener(j,d,{passive:!nt,capture:!!at})},_removeListener=function b(g,j,d,nt){return g.removeEventListener(j,d,!!nt)},_wheelListener=function b(g,j,d){d=d&&d.wheelHandler,d&&(g(j,"wheel",d),g(j,"touchmove",d))},_markerDefaults={startColor:"green",endColor:"red",indent:0,fontSize:"16px",fontWeight:"normal"},_defaults={toggleActions:"play",anticipatePin:0},_keywords={top:0,left:0,center:.5,bottom:1,right:1},_offsetToPx=function b(g,j){if(_isString(g)){var d=g.indexOf("="),nt=~d?+(g.charAt(d-1)+1)*parseFloat(g.substr(d+1)):0;~d&&(g.indexOf("%")>d&&(nt*=j/100),g=g.substr(0,d-1)),g=nt+(g in _keywords?_keywords[g]*j:~g.indexOf("%")?parseFloat(g)*j/100:parseFloat(g)||0)}return g},_createMarker=function b(g,j,d,nt,at,ht,_t,bt){var kt=at.startColor,Vt=at.endColor,qt=at.fontSize,zt=at.indent,jt=at.fontWeight,Kt=_doc.createElement("div"),Ft=_isViewport(d)||_getProxyProp(d,"pinType")==="fixed",nn=g.indexOf("scroller")!==-1,Lt=Ft?_body:d,Nt=g.indexOf("start")!==-1,Ht=Nt?kt:Vt,on="border-color:"+Ht+";font-size:"+qt+";color:"+Ht+";font-weight:"+jt+";pointer-events:none;white-space:nowrap;font-family:sans-serif,Arial;z-index:1000;padding:4px 8px;border-width:0;border-style:solid;";return on+="position:"+((nn||bt)&&Ft?"fixed;":"absolute;"),(nn||bt||!Ft)&&(on+=(nt===_vertical?_right:_bottom)+":"+(ht+parseFloat(zt))+"px;"),_t&&(on+="box-sizing:border-box;text-align:left;width:"+_t.offsetWidth+"px;"),Kt._isStart=Nt,Kt.setAttribute("class","gsap-marker-"+g+(j?" marker-"+j:"")),Kt.style.cssText=on,Kt.innerText=j||j===0?g+"-"+j:g,Lt.children[0]?Lt.insertBefore(Kt,Lt.children[0]):Lt.appendChild(Kt),Kt._offset=Kt["offset"+nt.op.d2],_positionMarker(Kt,0,nt,Nt),Kt},_positionMarker=function b(g,j,d,nt){var at={display:"block"},ht=d[nt?"os2":"p2"],_t=d[nt?"p2":"os2"];g._isFlipped=nt,at[d.a+"Percent"]=nt?-100:0,at[d.a]=nt?"1px":0,at["border"+ht+_Width]=1,at["border"+_t+_Width]=0,at[d.p]=j+"px",gsap.set(g,at)},_triggers=[],_ids={},_rafID,_sync=function b(){return _getTime()-_lastScrollTime>34&&(_rafID||(_rafID=requestAnimationFrame(_updateAll)))},_onScroll=function b(){(!_normalizer||!_normalizer.isPressed||_normalizer.startX>_body.clientWidth)&&(_scrollers.cache++,_normalizer?_rafID||(_rafID=requestAnimationFrame(_updateAll)):_updateAll(),_lastScrollTime||_dispatch("scrollStart"),_lastScrollTime=_getTime())},_setBaseDimensions=function b(){_baseScreenWidth=_win.innerWidth,_baseScreenHeight=_win.innerHeight},_onResize=function b(){_scrollers.cache++,!_refreshing&&!_ignoreResize&&!_doc.fullscreenElement&&!_doc.webkitFullscreenElement&&(!_ignoreMobileResize||_baseScreenWidth!==_win.innerWidth||Math.abs(_win.innerHeight-_baseScreenHeight)>_win.innerHeight*.25)&&_resizeDelay.restart(!0)},_listeners={},_emptyArray=[],_softRefresh=function b(){return _removeListener(ScrollTrigger,"scrollEnd",b)||_refreshAll(!0)},_dispatch=function b(g){return _listeners[g]&&_listeners[g].map(function(j){return j()})||_emptyArray},_savedStyles=[],_revertRecorded=function b(g){for(var j=0;j<_savedStyles.length;j+=5)(!g||_savedStyles[j+4]&&_savedStyles[j+4].query===g)&&(_savedStyles[j].style.cssText=_savedStyles[j+1],_savedStyles[j].getBBox&&_savedStyles[j].setAttribute("transform",_savedStyles[j+2]||""),_savedStyles[j+3].uncache=1)},_revertAll=function b(g,j){var d;for(_i=0;_i<_triggers.length;_i++)d=_triggers[_i],d&&(!j||d._ctx===j)&&(g?d.kill(1):d.revert(!0,!0));j&&_revertRecorded(j),j||_dispatch("revert")},_clearScrollMemory=function b(g,j){_scrollers.cache++,(j||!_refreshingAll)&&_scrollers.forEach(function(d){return _isFunction(d)&&d.cacheID++&&(d.rec=0)}),_isString(g)&&(_win.history.scrollRestoration=_scrollRestoration=g)},_refreshingAll,_refreshID=0,_queueRefreshID,_queueRefreshAll=function b(){if(_queueRefreshID!==_refreshID){var g=_queueRefreshID=_refreshID;requestAnimationFrame(function(){return g===_refreshID&&_refreshAll(!0)})}},_refresh100vh=function b(){_body.appendChild(_div100vh),_100vh=_div100vh.offsetHeight||_win.innerHeight,_body.removeChild(_div100vh)},_refreshAll=function b(g,j){if(_lastScrollTime&&!g){_addListener(ScrollTrigger,"scrollEnd",_softRefresh);return}_refresh100vh(),_refreshingAll=ScrollTrigger.isRefreshing=!0,_scrollers.forEach(function(nt){return _isFunction(nt)&&++nt.cacheID&&(nt.rec=nt())});var d=_dispatch("refreshInit");_sort&&ScrollTrigger.sort(),j||_revertAll(),_scrollers.forEach(function(nt){_isFunction(nt)&&(nt.smooth&&(nt.target.style.scrollBehavior="auto"),nt(0))}),_triggers.slice(0).forEach(function(nt){return nt.refresh()}),_triggers.forEach(function(nt,at){if(nt._subPinOffset&&nt.pin){var ht=nt.vars.horizontal?"offsetWidth":"offsetHeight",_t=nt.pin[ht];nt.revert(!0,1),nt.adjustPinSpacing(nt.pin[ht]-_t),nt.refresh()}}),_triggers.forEach(function(nt){var at=_maxScroll(nt.scroller,nt._dir);(nt.vars.end==="max"||nt._endClamp&&nt.end>at)&&nt.setPositions(nt.start,Math.max(nt.start+1,at),!0)}),d.forEach(function(nt){return nt&&nt.render&&nt.render(-1)}),_scrollers.forEach(function(nt){_isFunction(nt)&&(nt.smooth&&requestAnimationFrame(function(){return nt.target.style.scrollBehavior="smooth"}),nt.rec&&nt(nt.rec))}),_clearScrollMemory(_scrollRestoration,1),_resizeDelay.pause(),_refreshID++,_refreshingAll=2,_updateAll(2),_triggers.forEach(function(nt){return _isFunction(nt.vars.onRefresh)&&nt.vars.onRefresh(nt)}),_refreshingAll=ScrollTrigger.isRefreshing=!1,_dispatch("refresh")},_lastScroll=0,_direction=1,_primary,_updateAll=function b(g){if(!_refreshingAll||g===2){ScrollTrigger.isUpdating=!0,_primary&&_primary.update(0);var j=_triggers.length,d=_getTime(),nt=d-_time1>=50,at=j&&_triggers[0].scroll();if(_direction=_lastScroll>at?-1:1,_refreshingAll||(_lastScroll=at),nt&&(_lastScrollTime&&!_pointerIsDown&&d-_lastScrollTime>200&&(_lastScrollTime=0,_dispatch("scrollEnd")),_time2=_time1,_time1=d),_direction<0){for(_i=j;_i-- >0;)_triggers[_i]&&_triggers[_i].update(0,nt);_direction=1}else for(_i=0;_i<j;_i++)_triggers[_i]&&_triggers[_i].update(0,nt);ScrollTrigger.isUpdating=!1}_rafID=0},_propNamesToCopy=[_left,_top,_bottom,_right,_margin+_Bottom,_margin+_Right,_margin+_Top,_margin+_Left,"display","flexShrink","float","zIndex","gridColumnStart","gridColumnEnd","gridRowStart","gridRowEnd","gridArea","justifySelf","alignSelf","placeSelf","order"],_stateProps=_propNamesToCopy.concat([_width,_height,"boxSizing","max"+_Width,"max"+_Height,"position",_margin,_padding,_padding+_Top,_padding+_Right,_padding+_Bottom,_padding+_Left]),_swapPinOut=function b(g,j,d){_setState(d);var nt=g._gsap;if(nt.spacerIsNative)_setState(nt.spacerState);else if(g._gsap.swappedIn){var at=j.parentNode;at&&(at.insertBefore(g,j),at.removeChild(j))}g._gsap.swappedIn=!1},_swapPinIn=function b(g,j,d,nt){if(!g._gsap.swappedIn){for(var at=_propNamesToCopy.length,ht=j.style,_t=g.style,bt;at--;)bt=_propNamesToCopy[at],ht[bt]=d[bt];ht.position=d.position==="absolute"?"absolute":"relative",d.display==="inline"&&(ht.display="inline-block"),_t[_bottom]=_t[_right]="auto",ht.flexBasis=d.flexBasis||"auto",ht.overflow="visible",ht.boxSizing="border-box",ht[_width]=_getSize(g,_horizontal)+_px,ht[_height]=_getSize(g,_vertical)+_px,ht[_padding]=_t[_margin]=_t[_top]=_t[_left]="0",_setState(nt),_t[_width]=_t["max"+_Width]=d[_width],_t[_height]=_t["max"+_Height]=d[_height],_t[_padding]=d[_padding],g.parentNode!==j&&(g.parentNode.insertBefore(j,g),j.appendChild(g)),g._gsap.swappedIn=!0}},_capsExp=/([A-Z])/g,_setState=function b(g){if(g){var j=g.t.style,d=g.length,nt=0,at,ht;for((g.t._gsap||gsap.core.getCache(g.t)).uncache=1;nt<d;nt+=2)ht=g[nt+1],at=g[nt],ht?j[at]=ht:j[at]&&j.removeProperty(at.replace(_capsExp,"-$1").toLowerCase())}},_getState=function b(g){for(var j=_stateProps.length,d=g.style,nt=[],at=0;at<j;at++)nt.push(_stateProps[at],d[_stateProps[at]]);return nt.t=g,nt},_copyState=function b(g,j,d){for(var nt=[],at=g.length,ht=d?8:0,_t;ht<at;ht+=2)_t=g[ht],nt.push(_t,_t in j?j[_t]:g[ht+1]);return nt.t=g.t,nt},_winOffsets={left:0,top:0},_parsePosition=function b(g,j,d,nt,at,ht,_t,bt,kt,Vt,qt,zt,jt,Kt){_isFunction(g)&&(g=g(bt)),_isString(g)&&g.substr(0,3)==="max"&&(g=zt+(g.charAt(4)==="="?_offsetToPx("0"+g.substr(3),d):0));var Ft=jt?jt.time():0,nn,Lt,Nt;if(jt&&jt.seek(0),isNaN(g)||(g=+g),_isNumber(g))jt&&(g=gsap.utils.mapRange(jt.scrollTrigger.start,jt.scrollTrigger.end,0,zt,g)),_t&&_positionMarker(_t,d,nt,!0);else{_isFunction(j)&&(j=j(bt));var Ht=(g||"0").split(" "),on,en,cn,Ut;Nt=_getTarget(j,bt)||_body,on=_getBounds(Nt)||{},(!on||!on.left&&!on.top)&&_getComputedStyle(Nt).display==="none"&&(Ut=Nt.style.display,Nt.style.display="block",on=_getBounds(Nt),Ut?Nt.style.display=Ut:Nt.style.removeProperty("display")),en=_offsetToPx(Ht[0],on[nt.d]),cn=_offsetToPx(Ht[1]||"0",d),g=on[nt.p]-kt[nt.p]-Vt+en+at-cn,_t&&_positionMarker(_t,cn,nt,d-cn<20||_t._isStart&&cn>20),d-=d-cn}if(Kt&&(bt[Kt]=g||-.001,g<0&&(g=0)),ht){var Gt=g+d,$t=ht._isStart;nn="scroll"+nt.d2,_positionMarker(ht,Gt,nt,$t&&Gt>20||!$t&&(qt?Math.max(_body[nn],_docEl[nn]):ht.parentNode[nn])<=Gt+1),qt&&(kt=_getBounds(_t),qt&&(ht.style[nt.op.p]=kt[nt.op.p]-nt.op.m-ht._offset+_px))}return jt&&Nt&&(nn=_getBounds(Nt),jt.seek(zt),Lt=_getBounds(Nt),jt._caScrollDist=nn[nt.p]-Lt[nt.p],g=g/jt._caScrollDist*zt),jt&&jt.seek(Ft),jt?g:Math.round(g)},_prefixExp=/(webkit|moz|length|cssText|inset)/i,_reparent=function b(g,j,d,nt){if(g.parentNode!==j){var at=g.style,ht,_t;if(j===_body){g._stOrig=at.cssText,_t=_getComputedStyle(g);for(ht in _t)!+ht&&!_prefixExp.test(ht)&&_t[ht]&&typeof at[ht]=="string"&&ht!=="0"&&(at[ht]=_t[ht]);at.top=d,at.left=nt}else at.cssText=g._stOrig;gsap.core.getCache(g).uncache=1,j.appendChild(g)}},_interruptionTracker=function b(g,j,d){var nt=j,at=nt;return function(ht){var _t=Math.round(g());return _t!==nt&&_t!==at&&Math.abs(_t-nt)>3&&Math.abs(_t-at)>3&&(ht=_t,d&&d()),at=nt,nt=ht,ht}},_shiftMarker=function b(g,j,d){var nt={};nt[j.p]="+="+d,gsap.set(g,nt)},_getTweenCreator=function b(g,j){var d=_getScrollFunc(g,j),nt="_scroll"+j.p2,at=function ht(_t,bt,kt,Vt,qt){var zt=ht.tween,jt=bt.onComplete,Kt={};kt=kt||d();var Ft=_interruptionTracker(d,kt,function(){zt.kill(),ht.tween=0});return qt=Vt&&qt||0,Vt=Vt||_t-kt,zt&&zt.kill(),bt[nt]=_t,bt.modifiers=Kt,Kt[nt]=function(){return Ft(kt+Vt*zt.ratio+qt*zt.ratio*zt.ratio)},bt.onUpdate=function(){_scrollers.cache++,_updateAll()},bt.onComplete=function(){ht.tween=0,jt&&jt.call(zt)},zt=ht.tween=gsap.to(g,bt),zt};return g[nt]=d,d.wheelHandler=function(){return at.tween&&at.tween.kill()&&(at.tween=0)},_addListener(g,"wheel",d.wheelHandler),ScrollTrigger.isTouch&&_addListener(g,"touchmove",d.wheelHandler),at},ScrollTrigger=function(){function b(j,d){_coreInitted||b.register(gsap)||console.warn("Please gsap.registerPlugin(ScrollTrigger)"),_context(this),this.init(j,d)}var g=b.prototype;return g.init=function(d,nt){if(this.progress=this.start=0,this.vars&&this.kill(!0,!0),!_enabled){this.update=this.refresh=this.kill=_passThrough;return}d=_setDefaults(_isString(d)||_isNumber(d)||d.nodeType?{trigger:d}:d,_defaults);var at=d,ht=at.onUpdate,_t=at.toggleClass,bt=at.id,kt=at.onToggle,Vt=at.onRefresh,qt=at.scrub,zt=at.trigger,jt=at.pin,Kt=at.pinSpacing,Ft=at.invalidateOnRefresh,nn=at.anticipatePin,Lt=at.onScrubComplete,Nt=at.onSnapComplete,Ht=at.once,on=at.snap,en=at.pinReparent,cn=at.pinSpacer,Ut=at.containerAnimation,Gt=at.fastScrollEnd,$t=at.preventOverlaps,un=d.horizontal||d.containerAnimation&&d.horizontal!==!1?_horizontal:_vertical,hn=!qt&&qt!==0,Bn=_getTarget(d.scroller||_win),ar=gsap.core.getCache(Bn),sr=_isViewport(Bn),ur=("pinType"in d?d.pinType:_getProxyProp(Bn,"pinType")||sr&&"fixed")==="fixed",nr=[d.onEnter,d.onLeave,d.onEnterBack,d.onLeaveBack],hr=hn&&d.toggleActions.split(" "),zn="markers"in d?d.markers:_defaults.markers,Yn=sr?0:parseFloat(_getComputedStyle(Bn)["border"+un.p2+_Width])||0,sn=this,qn=d.onRefreshInit&&function(){return d.onRefreshInit(sn)},Kn=_getSizeFunc(Bn,sr,un),wr=_getOffsetsFunc(Bn,sr),Gn=0,rn=0,dn=0,kn=_getScrollFunc(Bn,un),Cr,Ar,Lr,ls,Rs,us,ws,io,ks,er,Vs,Ll,Nl,Qs,So,_l,Mo,Bo,_o,fo,Wl,Oo,yl,Dp,co,gu,zo,Yu,Rp,oo,To,Gs,Jl,Xu,Pu,xu,jn,Pl,pu;if(sn._startClamp=sn._endClamp=!1,sn._dir=un,nn*=45,sn.scroller=Bn,sn.scroll=Ut?Ut.time.bind(Ut):kn,ls=kn(),sn.vars=d,nt=nt||d.animation,"refreshPriority"in d&&(_sort=1,d.refreshPriority===-9999&&(_primary=sn)),ar.tweenScroll=ar.tweenScroll||{top:_getTweenCreator(Bn,_vertical),left:_getTweenCreator(Bn,_horizontal)},sn.tweenTo=Cr=ar.tweenScroll[un.p],sn.scrubDuration=function(ss){Jl=_isNumber(ss)&&ss,Jl?Gs?Gs.duration(ss):Gs=gsap.to(nt,{ease:"expo",totalProgress:"+=0",duration:Jl,paused:!0,onComplete:function(){return Lt&&Lt(sn)}}):(Gs&&Gs.progress(1).kill(),Gs=0)},nt&&(nt.vars.lazy=!1,nt._initted&&!sn.isReverted||nt.vars.immediateRender!==!1&&d.immediateRender!==!1&&nt.duration()&&nt.render(0,!0,!0),sn.animation=nt.pause(),nt.scrollTrigger=sn,sn.scrubDuration(qt),oo=0,bt||(bt=nt.vars.id)),on&&((!_isObject(on)||on.push)&&(on={snapTo:on}),"scrollBehavior"in _body.style&&gsap.set(sr?[_body,_docEl]:Bn,{scrollBehavior:"auto"}),_scrollers.forEach(function(ss){return _isFunction(ss)&&ss.target===(sr?_doc.scrollingElement||_docEl:Bn)&&(ss.smooth=!1)}),Lr=_isFunction(on.snapTo)?on.snapTo:on.snapTo==="labels"?_getClosestLabel(nt):on.snapTo==="labelsDirectional"?_getLabelAtDirection(nt):on.directional!==!1?function(ss,Ls){return _snapDirectional(on.snapTo)(ss,_getTime()-rn<500?0:Ls.direction)}:gsap.utils.snap(on.snapTo),Xu=on.duration||{min:.1,max:2},Xu=_isObject(Xu)?_clamp(Xu.min,Xu.max):_clamp(Xu,Xu),Pu=gsap.delayedCall(on.delay||Jl/2||.1,function(){var ss=kn(),Ls=_getTime()-rn<500,vs=Cr.tween;if((Ls||Math.abs(sn.getVelocity())<10)&&!vs&&!_pointerIsDown&&Gn!==ss){var eo=(ss-us)/Qs,Vo=nt&&!hn?nt.totalProgress():eo,to=Ls?0:(Vo-To)/(_getTime()-_time2)*1e3||0,xa=gsap.utils.clamp(-eo,1-eo,_abs(to/2)*to/.185),Ko=eo+(on.inertia===!1?0:xa),Zl=_clamp(0,1,Lr(Ko,sn)),xl=Math.round(us+Zl*Qs),yo=on,Dl=yo.onStart,Lo=yo.onInterrupt,Hs=yo.onComplete;if(ss<=ws&&ss>=us&&xl!==ss){if(vs&&!vs._initted&&vs.data<=_abs(xl-ss))return;on.inertia===!1&&(xa=Zl-eo),Cr(xl,{duration:Xu(_abs(Math.max(_abs(Ko-Vo),_abs(Zl-Vo))*.185/to/.05||0)),ease:on.ease||"power3",data:_abs(xl-ss),onInterrupt:function(){return Pu.restart(!0)&&Lo&&Lo(sn)},onComplete:function(){sn.update(),Gn=kn(),oo=To=nt&&!hn?nt.totalProgress():sn.progress,Nt&&Nt(sn),Hs&&Hs(sn)}},ss,xa*Qs,xl-ss-xa*Qs),Dl&&Dl(sn,Cr.tween)}}else sn.isActive&&Gn!==ss&&Pu.restart(!0)}).pause()),bt&&(_ids[bt]=sn),zt=sn.trigger=_getTarget(zt||jt!==!0&&jt),pu=zt&&zt._gsap&&zt._gsap.stRevert,pu&&(pu=pu(sn)),jt=jt===!0?zt:_getTarget(jt),_isString(_t)&&(_t={targets:zt,className:_t}),jt&&(Kt===!1||Kt===_margin||(Kt=!Kt&&jt.parentNode&&jt.parentNode.style&&_getComputedStyle(jt.parentNode).display==="flex"?!1:_padding),sn.pin=jt,Ar=gsap.core.getCache(jt),Ar.spacer?So=Ar.pinState:(cn&&(cn=_getTarget(cn),cn&&!cn.nodeType&&(cn=cn.current||cn.nativeElement),Ar.spacerIsNative=!!cn,cn&&(Ar.spacerState=_getState(cn))),Ar.spacer=Bo=cn||_doc.createElement("div"),Bo.classList.add("pin-spacer"),bt&&Bo.classList.add("pin-spacer-"+bt),Ar.pinState=So=_getState(jt)),d.force3D!==!1&&gsap.set(jt,{force3D:!0}),sn.spacer=Bo=Ar.spacer,Rp=_getComputedStyle(jt),Dp=Rp[Kt+un.os2],fo=gsap.getProperty(jt),Wl=gsap.quickSetter(jt,un.a,_px),_swapPinIn(jt,Bo,Rp),Mo=_getState(jt)),zn){Ll=_isObject(zn)?_setDefaults(zn,_markerDefaults):_markerDefaults,er=_createMarker("scroller-start",bt,Bn,un,Ll,0),Vs=_createMarker("scroller-end",bt,Bn,un,Ll,0,er),_o=er["offset"+un.op.d2];var Ds=_getTarget(_getProxyProp(Bn,"content")||Bn);io=this.markerStart=_createMarker("start",bt,Ds,un,Ll,_o,0,Ut),ks=this.markerEnd=_createMarker("end",bt,Ds,un,Ll,_o,0,Ut),Ut&&(Pl=gsap.quickSetter([io,ks],un.a,_px)),!ur&&!(_proxies.length&&_getProxyProp(Bn,"fixedMarkers")===!0)&&(_makePositionable(sr?_body:Bn),gsap.set([er,Vs],{force3D:!0}),gu=gsap.quickSetter(er,un.a,_px),Yu=gsap.quickSetter(Vs,un.a,_px))}if(Ut){var Wr=Ut.vars.onUpdate,os=Ut.vars.onUpdateParams;Ut.eventCallback("onUpdate",function(){sn.update(0,0,1),Wr&&Wr.apply(Ut,os||[])})}if(sn.previous=function(){return _triggers[_triggers.indexOf(sn)-1]},sn.next=function(){return _triggers[_triggers.indexOf(sn)+1]},sn.revert=function(ss,Ls){if(!Ls)return sn.kill(!0);var vs=ss!==!1||!sn.enabled,eo=_refreshing;vs!==sn.isReverted&&(vs&&(xu=Math.max(kn(),sn.scroll.rec||0),dn=sn.progress,jn=nt&&nt.progress()),io&&[io,ks,er,Vs].forEach(function(Vo){return Vo.style.display=vs?"none":"block"}),vs&&(_refreshing=sn,sn.update(vs)),jt&&(!en||!sn.isActive)&&(vs?_swapPinOut(jt,Bo,So):_swapPinIn(jt,Bo,_getComputedStyle(jt),co)),vs||sn.update(vs),_refreshing=eo,sn.isReverted=vs)},sn.refresh=function(ss,Ls,vs,eo){if(!((_refreshing||!sn.enabled)&&!Ls)){if(jt&&ss&&_lastScrollTime){_addListener(b,"scrollEnd",_softRefresh);return}!_refreshingAll&&qn&&qn(sn),_refreshing=sn,Cr.tween&&!vs&&(Cr.tween.kill(),Cr.tween=0),Gs&&Gs.pause(),Ft&&nt&&nt.revert({kill:!1}).invalidate(),sn.isReverted||sn.revert(!0,!0),sn._subPinOffset=!1;var Vo=Kn(),to=wr(),xa=Ut?Ut.duration():_maxScroll(Bn,un),Ko=Qs<=.01,Zl=0,xl=eo||0,yo=_isObject(vs)?vs.end:d.end,Dl=d.endTrigger||zt,Lo=_isObject(vs)?vs.start:d.start||(d.start===0||!zt?0:jt?"0 0":"0 100%"),Hs=sn.pinnedContainer=d.pinnedContainer&&_getTarget(d.pinnedContainer,sn),Yl=zt&&Math.max(0,_triggers.indexOf(sn))||0,Ho=Yl,Fl,Io,Jr,qp,Xr,Qo,vu,Ao,so,op,Ku,Ap,Yp;for(zn&&_isObject(vs)&&(Ap=gsap.getProperty(er,un.p),Yp=gsap.getProperty(Vs,un.p));Ho--;)Qo=_triggers[Ho],Qo.end||Qo.refresh(0,1)||(_refreshing=sn),vu=Qo.pin,vu&&(vu===zt||vu===jt||vu===Hs)&&!Qo.isReverted&&(op||(op=[]),op.unshift(Qo),Qo.revert(!0,!0)),Qo!==_triggers[Ho]&&(Yl--,Ho--);for(_isFunction(Lo)&&(Lo=Lo(sn)),Lo=_parseClamp(Lo,"start",sn),us=_parsePosition(Lo,zt,Vo,un,kn(),io,er,sn,to,Yn,ur,xa,Ut,sn._startClamp&&"_startClamp")||(jt?-.001:0),_isFunction(yo)&&(yo=yo(sn)),_isString(yo)&&!yo.indexOf("+=")&&(~yo.indexOf(" ")?yo=(_isString(Lo)?Lo.split(" ")[0]:"")+yo:(Zl=_offsetToPx(yo.substr(2),Vo),yo=_isString(Lo)?Lo:(Ut?gsap.utils.mapRange(0,Ut.duration(),Ut.scrollTrigger.start,Ut.scrollTrigger.end,us):us)+Zl,Dl=zt)),yo=_parseClamp(yo,"end",sn),ws=Math.max(us,_parsePosition(yo||(Dl?"100% 0":xa),Dl,Vo,un,kn()+Zl,ks,Vs,sn,to,Yn,ur,xa,Ut,sn._endClamp&&"_endClamp"))||-.001,Zl=0,Ho=Yl;Ho--;)Qo=_triggers[Ho],vu=Qo.pin,vu&&Qo.start-Qo._pinPush<=us&&!Ut&&Qo.end>0&&(Fl=Qo.end-(sn._startClamp?Math.max(0,Qo.start):Qo.start),(vu===zt&&Qo.start-Qo._pinPush<us||vu===Hs)&&isNaN(Lo)&&(Zl+=Fl*(1-Qo.progress)),vu===jt&&(xl+=Fl));if(us+=Zl,ws+=Zl,sn._startClamp&&(sn._startClamp+=Zl),sn._endClamp&&!_refreshingAll&&(sn._endClamp=ws||-.001,ws=Math.min(ws,_maxScroll(Bn,un))),Qs=ws-us||(us-=.01)&&.001,Ko&&(dn=gsap.utils.clamp(0,1,gsap.utils.normalize(us,ws,xu))),sn._pinPush=xl,io&&Zl&&(Fl={},Fl[un.a]="+="+Zl,Hs&&(Fl[un.p]="-="+kn()),gsap.set([io,ks],Fl)),jt)Fl=_getComputedStyle(jt),qp=un===_vertical,Jr=kn(),Oo=parseFloat(fo(un.a))+xl,!xa&&ws>1&&(Ku=(sr?_doc.scrollingElement||_docEl:Bn).style,Ku={style:Ku,value:Ku["overflow"+un.a.toUpperCase()]},sr&&_getComputedStyle(_body)["overflow"+un.a.toUpperCase()]!=="scroll"&&(Ku.style["overflow"+un.a.toUpperCase()]="scroll")),_swapPinIn(jt,Bo,Fl),Mo=_getState(jt),Io=_getBounds(jt,!0),Ao=ur&&_getScrollFunc(Bn,qp?_horizontal:_vertical)(),Kt&&(co=[Kt+un.os2,Qs+xl+_px],co.t=Bo,Ho=Kt===_padding?_getSize(jt,un)+Qs+xl:0,Ho&&co.push(un.d,Ho+_px),_setState(co),Hs&&_triggers.forEach(function(Ws){Ws.pin===Hs&&Ws.vars.pinSpacing!==!1&&(Ws._subPinOffset=!0)}),ur&&kn(xu)),ur&&(Xr={top:Io.top+(qp?Jr-us:Ao)+_px,left:Io.left+(qp?Ao:Jr-us)+_px,boxSizing:"border-box",position:"fixed"},Xr[_width]=Xr["max"+_Width]=Math.ceil(Io.width)+_px,Xr[_height]=Xr["max"+_Height]=Math.ceil(Io.height)+_px,Xr[_margin]=Xr[_margin+_Top]=Xr[_margin+_Right]=Xr[_margin+_Bottom]=Xr[_margin+_Left]="0",Xr[_padding]=Fl[_padding],Xr[_padding+_Top]=Fl[_padding+_Top],Xr[_padding+_Right]=Fl[_padding+_Right],Xr[_padding+_Bottom]=Fl[_padding+_Bottom],Xr[_padding+_Left]=Fl[_padding+_Left],_l=_copyState(So,Xr,en),_refreshingAll&&kn(0)),nt?(so=nt._initted,_suppressOverwrites(1),nt.render(nt.duration(),!0,!0),yl=fo(un.a)-Oo+Qs+xl,zo=Math.abs(Qs-yl)>1,ur&&zo&&_l.splice(_l.length-2,2),nt.render(0,!0,!0),so||nt.invalidate(!0),nt.parent||nt.totalTime(nt.totalTime()),_suppressOverwrites(0)):yl=Qs,Ku&&(Ku.value?Ku.style["overflow"+un.a.toUpperCase()]=Ku.value:Ku.style.removeProperty("overflow-"+un.a));else if(zt&&kn()&&!Ut)for(Io=zt.parentNode;Io&&Io!==_body;)Io._pinOffset&&(us-=Io._pinOffset,ws-=Io._pinOffset),Io=Io.parentNode;op&&op.forEach(function(Ws){return Ws.revert(!1,!0)}),sn.start=us,sn.end=ws,ls=Rs=_refreshingAll?xu:kn(),!Ut&&!_refreshingAll&&(ls<xu&&kn(xu),sn.scroll.rec=0),sn.revert(!1,!0),rn=_getTime(),Pu&&(Gn=-1,Pu.restart(!0)),_refreshing=0,nt&&hn&&(nt._initted||jn)&&nt.progress()!==jn&&nt.progress(jn||0,!0).render(nt.time(),!0,!0),(Ko||dn!==sn.progress||Ut)&&(nt&&!hn&&nt.totalProgress(Ut&&us<-.001&&!dn?gsap.utils.normalize(us,ws,0):dn,!0),sn.progress=Ko||(ls-us)/Qs===dn?0:dn),jt&&Kt&&(Bo._pinOffset=Math.round(sn.progress*yl)),Gs&&Gs.invalidate(),isNaN(Ap)||(Ap-=gsap.getProperty(er,un.p),Yp-=gsap.getProperty(Vs,un.p),_shiftMarker(er,un,Ap),_shiftMarker(io,un,Ap-(eo||0)),_shiftMarker(Vs,un,Yp),_shiftMarker(ks,un,Yp-(eo||0))),Ko&&!_refreshingAll&&sn.update(),Vt&&!_refreshingAll&&!Nl&&(Nl=!0,Vt(sn),Nl=!1)}},sn.getVelocity=function(){return(kn()-Rs)/(_getTime()-_time2)*1e3||0},sn.endAnimation=function(){_endAnimation(sn.callbackAnimation),nt&&(Gs?Gs.progress(1):nt.paused()?hn||_endAnimation(nt,sn.direction<0,1):_endAnimation(nt,nt.reversed()))},sn.labelToScroll=function(ss){return nt&&nt.labels&&(us||sn.refresh()||us)+nt.labels[ss]/nt.duration()*Qs||0},sn.getTrailing=function(ss){var Ls=_triggers.indexOf(sn),vs=sn.direction>0?_triggers.slice(0,Ls).reverse():_triggers.slice(Ls+1);return(_isString(ss)?vs.filter(function(eo){return eo.vars.preventOverlaps===ss}):vs).filter(function(eo){return sn.direction>0?eo.end<=us:eo.start>=ws})},sn.update=function(ss,Ls,vs){if(!(Ut&&!vs&&!ss)){var eo=_refreshingAll===!0?xu:sn.scroll(),Vo=ss?0:(eo-us)/Qs,to=Vo<0?0:Vo>1?1:Vo||0,xa=sn.progress,Ko,Zl,xl,yo,Dl,Lo,Hs,Yl;if(Ls&&(Rs=ls,ls=Ut?kn():eo,on&&(To=oo,oo=nt&&!hn?nt.totalProgress():to)),nn&&!to&&jt&&!_refreshing&&!_startup&&_lastScrollTime&&us<eo+(eo-Rs)/(_getTime()-_time2)*nn&&(to=1e-4),to!==xa&&sn.enabled){if(Ko=sn.isActive=!!to&&to<1,Zl=!!xa&&xa<1,Lo=Ko!==Zl,Dl=Lo||!!to!=!!xa,sn.direction=to>xa?1:-1,sn.progress=to,Dl&&!_refreshing&&(xl=to&&!xa?0:to===1?1:xa===1?2:3,hn&&(yo=!Lo&&hr[xl+1]!=="none"&&hr[xl+1]||hr[xl],Yl=nt&&(yo==="complete"||yo==="reset"||yo in nt))),$t&&(Lo||Yl)&&(Yl||qt||!nt)&&(_isFunction($t)?$t(sn):sn.getTrailing($t).forEach(function(Jr){return Jr.endAnimation()})),hn||(Gs&&!_refreshing&&!_startup?(Gs._dp._time-Gs._start!==Gs._time&&Gs.render(Gs._dp._time-Gs._start),Gs.resetTo?Gs.resetTo("totalProgress",to,nt._tTime/nt._tDur):(Gs.vars.totalProgress=to,Gs.invalidate().restart())):nt&&nt.totalProgress(to,!!(_refreshing&&(rn||ss)))),jt){if(ss&&Kt&&(Bo.style[Kt+un.os2]=Dp),!ur)Wl(_round(Oo+yl*to));else if(Dl){if(Hs=!ss&&to>xa&&ws+1>eo&&eo+1>=_maxScroll(Bn,un),en)if(!ss&&(Ko||Hs)){var Ho=_getBounds(jt,!0),Fl=eo-us;_reparent(jt,_body,Ho.top+(un===_vertical?Fl:0)+_px,Ho.left+(un===_vertical?0:Fl)+_px)}else _reparent(jt,Bo);_setState(Ko||Hs?_l:Mo),zo&&to<1&&Ko||Wl(Oo+(to===1&&!Hs?yl:0))}}on&&!Cr.tween&&!_refreshing&&!_startup&&Pu.restart(!0),_t&&(Lo||Ht&&to&&(to<1||!_limitCallbacks))&&_toArray(_t.targets).forEach(function(Jr){return Jr.classList[Ko||Ht?"add":"remove"](_t.className)}),ht&&!hn&&!ss&&ht(sn),Dl&&!_refreshing?(hn&&(Yl&&(yo==="complete"?nt.pause().totalProgress(1):yo==="reset"?nt.restart(!0).pause():yo==="restart"?nt.restart(!0):nt[yo]()),ht&&ht(sn)),(Lo||!_limitCallbacks)&&(kt&&Lo&&_callback(sn,kt),nr[xl]&&_callback(sn,nr[xl]),Ht&&(to===1?sn.kill(!1,1):nr[xl]=0),Lo||(xl=to===1?1:3,nr[xl]&&_callback(sn,nr[xl]))),Gt&&!Ko&&Math.abs(sn.getVelocity())>(_isNumber(Gt)?Gt:2500)&&(_endAnimation(sn.callbackAnimation),Gs?Gs.progress(1):_endAnimation(nt,yo==="reverse"?1:!to,1))):hn&&ht&&!_refreshing&&ht(sn)}if(Yu){var Io=Ut?eo/Ut.duration()*(Ut._caScrollDist||0):eo;gu(Io+(er._isFlipped?1:0)),Yu(Io)}Pl&&Pl(-eo/Ut.duration()*(Ut._caScrollDist||0))}},sn.enable=function(ss,Ls){sn.enabled||(sn.enabled=!0,_addListener(Bn,"resize",_onResize),sr||_addListener(Bn,"scroll",_onScroll),qn&&_addListener(b,"refreshInit",qn),ss!==!1&&(sn.progress=dn=0,ls=Rs=Gn=kn()),Ls!==!1&&sn.refresh())},sn.getTween=function(ss){return ss&&Cr?Cr.tween:Gs},sn.setPositions=function(ss,Ls,vs,eo){if(Ut){var Vo=Ut.scrollTrigger,to=Ut.duration(),xa=Vo.end-Vo.start;ss=Vo.start+xa*ss/to,Ls=Vo.start+xa*Ls/to}sn.refresh(!1,!1,{start:_keepClamp(ss,vs&&!!sn._startClamp),end:_keepClamp(Ls,vs&&!!sn._endClamp)},eo),sn.update()},sn.adjustPinSpacing=function(ss){if(co&&ss){var Ls=co.indexOf(un.d)+1;co[Ls]=parseFloat(co[Ls])+ss+_px,co[1]=parseFloat(co[1])+ss+_px,_setState(co)}},sn.disable=function(ss,Ls){if(sn.enabled&&(ss!==!1&&sn.revert(!0,!0),sn.enabled=sn.isActive=!1,Ls||Gs&&Gs.pause(),xu=0,Ar&&(Ar.uncache=1),qn&&_removeListener(b,"refreshInit",qn),Pu&&(Pu.pause(),Cr.tween&&Cr.tween.kill()&&(Cr.tween=0)),!sr)){for(var vs=_triggers.length;vs--;)if(_triggers[vs].scroller===Bn&&_triggers[vs]!==sn)return;_removeListener(Bn,"resize",_onResize),sr||_removeListener(Bn,"scroll",_onScroll)}},sn.kill=function(ss,Ls){sn.disable(ss,Ls),Gs&&!Ls&&Gs.kill(),bt&&delete _ids[bt];var vs=_triggers.indexOf(sn);vs>=0&&_triggers.splice(vs,1),vs===_i&&_direction>0&&_i--,vs=0,_triggers.forEach(function(eo){return eo.scroller===sn.scroller&&(vs=1)}),vs||_refreshingAll||(sn.scroll.rec=0),nt&&(nt.scrollTrigger=null,ss&&nt.revert({kill:!1}),Ls||nt.kill()),io&&[io,ks,er,Vs].forEach(function(eo){return eo.parentNode&&eo.parentNode.removeChild(eo)}),_primary===sn&&(_primary=0),jt&&(Ar&&(Ar.uncache=1),vs=0,_triggers.forEach(function(eo){return eo.pin===jt&&vs++}),vs||(Ar.spacer=0)),d.onKill&&d.onKill(sn)},_triggers.push(sn),sn.enable(!1,!1),pu&&pu(sn),nt&&nt.add&&!Qs){var Al=sn.update;sn.update=function(){sn.update=Al,us||ws||sn.refresh()},gsap.delayedCall(.01,sn.update),Qs=.01,us=ws=0}else sn.refresh();jt&&_queueRefreshAll()},b.register=function(d){return _coreInitted||(gsap=d||_getGSAP(),_windowExists()&&window.document&&b.enable(),_coreInitted=_enabled),_coreInitted},b.defaults=function(d){if(d)for(var nt in d)_defaults[nt]=d[nt];return _defaults},b.disable=function(d,nt){_enabled=0,_triggers.forEach(function(ht){return ht[nt?"kill":"disable"](d)}),_removeListener(_win,"wheel",_onScroll),_removeListener(_doc,"scroll",_onScroll),clearInterval(_syncInterval),_removeListener(_doc,"touchcancel",_passThrough),_removeListener(_body,"touchstart",_passThrough),_multiListener(_removeListener,_doc,"pointerdown,touchstart,mousedown",_pointerDownHandler),_multiListener(_removeListener,_doc,"pointerup,touchend,mouseup",_pointerUpHandler),_resizeDelay.kill(),_iterateAutoRefresh(_removeListener);for(var at=0;at<_scrollers.length;at+=3)_wheelListener(_removeListener,_scrollers[at],_scrollers[at+1]),_wheelListener(_removeListener,_scrollers[at],_scrollers[at+2])},b.enable=function(){if(_win=window,_doc=document,_docEl=_doc.documentElement,_body=_doc.body,gsap&&(_toArray=gsap.utils.toArray,_clamp=gsap.utils.clamp,_context=gsap.core.context||_passThrough,_suppressOverwrites=gsap.core.suppressOverwrites||_passThrough,_scrollRestoration=_win.history.scrollRestoration||"auto",_lastScroll=_win.pageYOffset,gsap.core.globals("ScrollTrigger",b),_body)){_enabled=1,_div100vh=document.createElement("div"),_div100vh.style.height="100vh",_div100vh.style.position="absolute",_refresh100vh(),_rafBugFix(),Observer.register(gsap),b.isTouch=Observer.isTouch,_fixIOSBug=Observer.isTouch&&/(iPad|iPhone|iPod|Mac)/g.test(navigator.userAgent),_addListener(_win,"wheel",_onScroll),_root=[_win,_doc,_docEl,_body],gsap.matchMedia?(b.matchMedia=function(bt){var kt=gsap.matchMedia(),Vt;for(Vt in bt)kt.add(Vt,bt[Vt]);return kt},gsap.addEventListener("matchMediaInit",function(){return _revertAll()}),gsap.addEventListener("matchMediaRevert",function(){return _revertRecorded()}),gsap.addEventListener("matchMedia",function(){_refreshAll(0,1),_dispatch("matchMedia")}),gsap.matchMedia("(orientation: portrait)",function(){return _setBaseDimensions(),_setBaseDimensions})):console.warn("Requires GSAP 3.11.0 or later"),_setBaseDimensions(),_addListener(_doc,"scroll",_onScroll);var d=_body.style,nt=d.borderTopStyle,at=gsap.core.Animation.prototype,ht,_t;for(at.revert||Object.defineProperty(at,"revert",{value:function(){return this.time(-.01,!0)}}),d.borderTopStyle="solid",ht=_getBounds(_body),_vertical.m=Math.round(ht.top+_vertical.sc())||0,_horizontal.m=Math.round(ht.left+_horizontal.sc())||0,nt?d.borderTopStyle=nt:d.removeProperty("border-top-style"),_syncInterval=setInterval(_sync,250),gsap.delayedCall(.5,function(){return _startup=0}),_addListener(_doc,"touchcancel",_passThrough),_addListener(_body,"touchstart",_passThrough),_multiListener(_addListener,_doc,"pointerdown,touchstart,mousedown",_pointerDownHandler),_multiListener(_addListener,_doc,"pointerup,touchend,mouseup",_pointerUpHandler),_transformProp=gsap.utils.checkPrefix("transform"),_stateProps.push(_transformProp),_coreInitted=_getTime(),_resizeDelay=gsap.delayedCall(.2,_refreshAll).pause(),_autoRefresh=[_doc,"visibilitychange",function(){var bt=_win.innerWidth,kt=_win.innerHeight;_doc.hidden?(_prevWidth=bt,_prevHeight=kt):(_prevWidth!==bt||_prevHeight!==kt)&&_onResize()},_doc,"DOMContentLoaded",_refreshAll,_win,"load",_refreshAll,_win,"resize",_onResize],_iterateAutoRefresh(_addListener),_triggers.forEach(function(bt){return bt.enable(0,1)}),_t=0;_t<_scrollers.length;_t+=3)_wheelListener(_removeListener,_scrollers[_t],_scrollers[_t+1]),_wheelListener(_removeListener,_scrollers[_t],_scrollers[_t+2])}},b.config=function(d){"limitCallbacks"in d&&(_limitCallbacks=!!d.limitCallbacks);var nt=d.syncInterval;nt&&clearInterval(_syncInterval)||(_syncInterval=nt)&&setInterval(_sync,nt),"ignoreMobileResize"in d&&(_ignoreMobileResize=b.isTouch===1&&d.ignoreMobileResize),"autoRefreshEvents"in d&&(_iterateAutoRefresh(_removeListener)||_iterateAutoRefresh(_addListener,d.autoRefreshEvents||"none"),_ignoreResize=(d.autoRefreshEvents+"").indexOf("resize")===-1)},b.scrollerProxy=function(d,nt){var at=_getTarget(d),ht=_scrollers.indexOf(at),_t=_isViewport(at);~ht&&_scrollers.splice(ht,_t?6:2),nt&&(_t?_proxies.unshift(_win,nt,_body,nt,_docEl,nt):_proxies.unshift(at,nt))},b.clearMatchMedia=function(d){_triggers.forEach(function(nt){return nt._ctx&&nt._ctx.query===d&&nt._ctx.kill(!0,!0)})},b.isInViewport=function(d,nt,at){var ht=(_isString(d)?_getTarget(d):d).getBoundingClientRect(),_t=ht[at?_width:_height]*nt||0;return at?ht.right-_t>0&&ht.left+_t<_win.innerWidth:ht.bottom-_t>0&&ht.top+_t<_win.innerHeight},b.positionInViewport=function(d,nt,at){_isString(d)&&(d=_getTarget(d));var ht=d.getBoundingClientRect(),_t=ht[at?_width:_height],bt=nt==null?_t/2:nt in _keywords?_keywords[nt]*_t:~nt.indexOf("%")?parseFloat(nt)*_t/100:parseFloat(nt)||0;return at?(ht.left+bt)/_win.innerWidth:(ht.top+bt)/_win.innerHeight},b.killAll=function(d){if(_triggers.slice(0).forEach(function(at){return at.vars.id!=="ScrollSmoother"&&at.kill()}),d!==!0){var nt=_listeners.killAll||[];_listeners={},nt.forEach(function(at){return at()})}},b}();ScrollTrigger.version="3.12.2";ScrollTrigger.saveStyles=function(b){return b?_toArray(b).forEach(function(g){if(g&&g.style){var j=_savedStyles.indexOf(g);j>=0&&_savedStyles.splice(j,5),_savedStyles.push(g,g.style.cssText,g.getBBox&&g.getAttribute("transform"),gsap.core.getCache(g),_context())}}):_savedStyles};ScrollTrigger.revert=function(b,g){return _revertAll(!b,g)};ScrollTrigger.create=function(b,g){return new ScrollTrigger(b,g)};ScrollTrigger.refresh=function(b){return b?_onResize():(_coreInitted||ScrollTrigger.register())&&_refreshAll(!0)};ScrollTrigger.update=function(b){return++_scrollers.cache&&_updateAll(b===!0?2:0)};ScrollTrigger.clearScrollMemory=_clearScrollMemory;ScrollTrigger.maxScroll=function(b,g){return _maxScroll(b,g?_horizontal:_vertical)};ScrollTrigger.getScrollFunc=function(b,g){return _getScrollFunc(_getTarget(b),g?_horizontal:_vertical)};ScrollTrigger.getById=function(b){return _ids[b]};ScrollTrigger.getAll=function(){return _triggers.filter(function(b){return b.vars.id!=="ScrollSmoother"})};ScrollTrigger.isScrolling=function(){return!!_lastScrollTime};ScrollTrigger.snapDirectional=_snapDirectional;ScrollTrigger.addEventListener=function(b,g){var j=_listeners[b]||(_listeners[b]=[]);~j.indexOf(g)||j.push(g)};ScrollTrigger.removeEventListener=function(b,g){var j=_listeners[b],d=j&&j.indexOf(g);d>=0&&j.splice(d,1)};ScrollTrigger.batch=function(b,g){var j=[],d={},nt=g.interval||.016,at=g.batchMax||1e9,ht=function(kt,Vt){var qt=[],zt=[],jt=gsap.delayedCall(nt,function(){Vt(qt,zt),qt=[],zt=[]}).pause();return function(Kt){qt.length||jt.restart(!0),qt.push(Kt.trigger),zt.push(Kt),at<=qt.length&&jt.progress(1)}},_t;for(_t in g)d[_t]=_t.substr(0,2)==="on"&&_isFunction(g[_t])&&_t!=="onRefreshInit"?ht(_t,g[_t]):g[_t];return _isFunction(at)&&(at=at(),_addListener(ScrollTrigger,"refresh",function(){return at=g.batchMax()})),_toArray(b).forEach(function(bt){var kt={};for(_t in d)kt[_t]=d[_t];kt.trigger=bt,j.push(ScrollTrigger.create(kt))}),j};var _clampScrollAndGetDurationMultiplier=function b(g,j,d,nt){return j>nt?g(nt):j<0&&g(0),d>nt?(nt-j)/(d-j):d<0?j/(j-d):1},_allowNativePanning=function b(g,j){j===!0?g.style.removeProperty("touch-action"):g.style.touchAction=j===!0?"auto":j?"pan-"+j+(Observer.isTouch?" pinch-zoom":""):"none",g===_docEl&&b(_body,j)},_overflow={auto:1,scroll:1},_nestedScroll=function b(g){var j=g.event,d=g.target,nt=g.axis,at=(j.changedTouches?j.changedTouches[0]:j).target,ht=at._gsap||gsap.core.getCache(at),_t=_getTime(),bt;if(!ht._isScrollT||_t-ht._isScrollT>2e3){for(;at&&at!==_body&&(at.scrollHeight<=at.clientHeight&&at.scrollWidth<=at.clientWidth||!(_overflow[(bt=_getComputedStyle(at)).overflowY]||_overflow[bt.overflowX]));)at=at.parentNode;ht._isScroll=at&&at!==d&&!_isViewport(at)&&(_overflow[(bt=_getComputedStyle(at)).overflowY]||_overflow[bt.overflowX]),ht._isScrollT=_t}(ht._isScroll||nt==="x")&&(j.stopPropagation(),j._gsapAllow=!0)},_inputObserver=function b(g,j,d,nt){return Observer.create({target:g,capture:!0,debounce:!1,lockAxis:!0,type:j,onWheel:nt=nt&&_nestedScroll,onPress:nt,onDrag:nt,onScroll:nt,onEnable:function(){return d&&_addListener(_doc,Observer.eventTypes[0],_captureInputs,!1,!0)},onDisable:function(){return _removeListener(_doc,Observer.eventTypes[0],_captureInputs,!0)}})},_inputExp=/(input|label|select|textarea)/i,_inputIsFocused,_captureInputs=function b(g){var j=_inputExp.test(g.target.tagName);(j||_inputIsFocused)&&(g._gsapAllow=!0,_inputIsFocused=j)},_getScrollNormalizer=function b(g){_isObject(g)||(g={}),g.preventDefault=g.isNormalizer=g.allowClicks=!0,g.type||(g.type="wheel,touch"),g.debounce=!!g.debounce,g.id=g.id||"normalizer";var j=g,d=j.normalizeScrollX,nt=j.momentum,at=j.allowNestedScroll,ht=j.onRelease,_t,bt,kt=_getTarget(g.target)||_docEl,Vt=gsap.core.globals().ScrollSmoother,qt=Vt&&Vt.get(),zt=_fixIOSBug&&(g.content&&_getTarget(g.content)||qt&&g.content!==!1&&!qt.smooth()&&qt.content()),jt=_getScrollFunc(kt,_vertical),Kt=_getScrollFunc(kt,_horizontal),Ft=1,nn=(Observer.isTouch&&_win.visualViewport?_win.visualViewport.scale*_win.visualViewport.width:_win.outerWidth)/_win.innerWidth,Lt=0,Nt=_isFunction(nt)?function(){return nt(_t)}:function(){return nt||2.8},Ht,on,en=_inputObserver(kt,g.type,!0,at),cn=function(){return on=!1},Ut=_passThrough,Gt=_passThrough,$t=function(){bt=_maxScroll(kt,_vertical),Gt=_clamp(_fixIOSBug?1:0,bt),d&&(Ut=_clamp(0,_maxScroll(kt,_horizontal))),Ht=_refreshID},un=function(){zt._gsap.y=_round(parseFloat(zt._gsap.y)+jt.offset)+"px",zt.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+parseFloat(zt._gsap.y)+", 0, 1)",jt.offset=jt.cacheID=0},hn=function(){if(on){requestAnimationFrame(cn);var zn=_round(_t.deltaY/2),Yn=Gt(jt.v-zn);if(zt&&Yn!==jt.v+jt.offset){jt.offset=Yn-jt.v;var sn=_round((parseFloat(zt&&zt._gsap.y)||0)-jt.offset);zt.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+sn+", 0, 1)",zt._gsap.y=sn+"px",jt.cacheID=_scrollers.cache,_updateAll()}return!0}jt.offset&&un(),on=!0},Bn,ar,sr,ur,nr=function(){$t(),Bn.isActive()&&Bn.vars.scrollY>bt&&(jt()>bt?Bn.progress(1)&&jt(bt):Bn.resetTo("scrollY",bt))};return zt&&gsap.set(zt,{y:"+=0"}),g.ignoreCheck=function(hr){return _fixIOSBug&&hr.type==="touchmove"&&hn()||Ft>1.05&&hr.type!=="touchstart"||_t.isGesturing||hr.touches&&hr.touches.length>1},g.onPress=function(){on=!1;var hr=Ft;Ft=_round((_win.visualViewport&&_win.visualViewport.scale||1)/nn),Bn.pause(),hr!==Ft&&_allowNativePanning(kt,Ft>1.01?!0:d?!1:"x"),ar=Kt(),sr=jt(),$t(),Ht=_refreshID},g.onRelease=g.onGestureStart=function(hr,zn){if(jt.offset&&un(),!zn)ur.restart(!0);else{_scrollers.cache++;var Yn=Nt(),sn,qn;d&&(sn=Kt(),qn=sn+Yn*.05*-hr.velocityX/.227,Yn*=_clampScrollAndGetDurationMultiplier(Kt,sn,qn,_maxScroll(kt,_horizontal)),Bn.vars.scrollX=Ut(qn)),sn=jt(),qn=sn+Yn*.05*-hr.velocityY/.227,Yn*=_clampScrollAndGetDurationMultiplier(jt,sn,qn,_maxScroll(kt,_vertical)),Bn.vars.scrollY=Gt(qn),Bn.invalidate().duration(Yn).play(.01),(_fixIOSBug&&Bn.vars.scrollY>=bt||sn>=bt-1)&&gsap.to({},{onUpdate:nr,duration:Yn})}ht&&ht(hr)},g.onWheel=function(){Bn._ts&&Bn.pause(),_getTime()-Lt>1e3&&(Ht=0,Lt=_getTime())},g.onChange=function(hr,zn,Yn,sn,qn){if(_refreshID!==Ht&&$t(),zn&&d&&Kt(Ut(sn[2]===zn?ar+(hr.startX-hr.x):Kt()+zn-sn[1])),Yn){jt.offset&&un();var Kn=qn[2]===Yn,wr=Kn?sr+hr.startY-hr.y:jt()+Yn-qn[1],Gn=Gt(wr);Kn&&wr!==Gn&&(sr+=Gn-wr),jt(Gn)}(Yn||zn)&&_updateAll()},g.onEnable=function(){_allowNativePanning(kt,d?!1:"x"),ScrollTrigger.addEventListener("refresh",nr),_addListener(_win,"resize",nr),jt.smooth&&(jt.target.style.scrollBehavior="auto",jt.smooth=Kt.smooth=!1),en.enable()},g.onDisable=function(){_allowNativePanning(kt,!0),_removeListener(_win,"resize",nr),ScrollTrigger.removeEventListener("refresh",nr),en.kill()},g.lockAxis=g.lockAxis!==!1,_t=new Observer(g),_t.iOS=_fixIOSBug,_fixIOSBug&&!jt()&&jt(1),_fixIOSBug&&gsap.ticker.add(_passThrough),ur=_t._dc,Bn=gsap.to(_t,{ease:"power4",paused:!0,scrollX:d?"+=0.1":"+=0",scrollY:"+=0.1",modifiers:{scrollY:_interruptionTracker(jt,jt(),function(){return Bn.pause()})},onUpdate:_updateAll,onComplete:ur.vars.onComplete}),_t};ScrollTrigger.sort=function(b){return _triggers.sort(b||function(g,j){return(g.vars.refreshPriority||0)*-1e6+g.start-(j.start+(j.vars.refreshPriority||0)*-1e6)})};ScrollTrigger.observe=function(b){return new Observer(b)};ScrollTrigger.normalizeScroll=function(b){if(typeof b>"u")return _normalizer;if(b===!0&&_normalizer)return _normalizer.enable();if(b===!1)return _normalizer&&_normalizer.kill();var g=b instanceof Observer?b:_getScrollNormalizer(b);return _normalizer&&_normalizer.target===g.target&&_normalizer.kill(),_isViewport(g.target)&&(_normalizer=g),g};ScrollTrigger.core={_getVelocityProp,_inputObserver,_scrollers,_proxies,bridge:{ss:function b(){_lastScrollTime||_dispatch("scrollStart"),_lastScrollTime=_getTime()},ref:function b(){return _refreshing}}};_getGSAP()&&gsap.registerPlugin(ScrollTrigger);const scrollAnimation=(b,g,j,d)=>{gsapWithCSS.timeline().to(b,{x:j?-7:-3.38,y:j?-12.2:-10.74,z:j?-6:-5.93,scrollTrigger:{trigger:".sound-section",start:"top bottom",end:"top top",scrub:2,immediateRender:!1},onUpdate:d}).to(g,{x:j?.7:1.52,y:j?3:.77,z:j?.7:-1.08,scrollTrigger:{trigger:".sound-section",start:"top bottom",end:"top top",scrub:2,immediateRender:!1}}).to(".jumbotron-section",{opacity:0,scrollTrigger:{trigger:".sound-section",start:"top bottom",end:"top top",scrub:2,immediateRender:!1}}).to(".sound-section-content",{opacity:1,scrollTrigger:{trigger:".sound-section",start:"top bottom",end:"top top",scrub:2,immediateRender:!1}}).to(b,{x:j?9.36:1.56,y:j?10.95:5,z:j?.09:.01,scrollTrigger:{trigger:".display-section",start:"top bottom",end:"top top",scrub:2,immediateRender:!1},onUpdate:d}).to(g,{x:j?-1.62:-.55,y:j?-1:.32,z:j?-.06:0,scrollTrigger:{trigger:".display-section",start:"top bottom",end:"top top",scrub:2,immediateRender:!1}}).to(".display-section",{opacity:1,scrollTrigger:{trigger:".display-section",start:"top bottom",end:"top top",scrub:2,immediateRender:!1}})};gsapWithCSS.registerPlugin(ScrollTrigger);const WebgiViewer=reactExports.forwardRef((b,g)=>{const j=reactExports.useRef(null),[d,nt]=reactExports.useState(null),[at,ht]=reactExports.useState(null),[_t,bt]=reactExports.useState(null),[kt,Vt]=reactExports.useState(null),qt=reactExports.useRef(null),[zt,jt]=reactExports.useState(!1),[Kt,Ft]=reactExports.useState(null);reactExports.useImperativeHandle(g,()=>({triggerPreview(){jt(!0),qt.current.style.pointerEvents="all",b.contentRef.current.style.opacity=0,gsapWithCSS.to(kt,{x:13.04,y:-2.01,z:2.29,duration:2,onUpdate:()=>{d.setDirty(),_t.positionTargetUpdated(!0)}}),gsapWithCSS.to(at,{x:.11,y:0,z:0,duration:2}),d.scene.activeCamera.setCameraOptions({controlsEnabled:!0})}}));const nn=reactExports.useCallback((Ht,on,en,cn)=>{Ht&&on&&cn&&scrollAnimation(Ht,on,en,cn)},[]),Lt=reactExports.useCallback(async()=>{const Ht=new __webpackgi_exports__ViewerApp({canvas:j.current});nt(Ht);const on=__webpackgi_exports__mobileAndTabletCheck();Ft(on);const en=await Ht.addPlugin(__webpackgi_exports__AssetManagerPlugin),cn=Ht.scene.activeCamera,Ut=cn.position,Gt=cn.target;bt(cn),Vt(Ut),ht(Gt),await Ht.addPlugin(__webpackgi_exports__GBufferPlugin),await Ht.addPlugin(new __webpackgi_exports__ProgressivePlugin(32)),await Ht.addPlugin(new __webpackgi_exports__TonemapPlugin(!0)),await Ht.addPlugin(__webpackgi_exports__GammaCorrectionPlugin),await Ht.addPlugin(__webpackgi_exports__SSRPlugin),await Ht.addPlugin(__webpackgi_exports__SSAOPlugin),await Ht.addPlugin(__webpackgi_exports__BloomPlugin),Ht.renderer.refreshPipeline(),await en.addFromPath("scene-black.glb"),Ht.getPlugin(__webpackgi_exports__TonemapPlugin).config.clipBackground=!0,Ht.scene.activeCamera.setCameraOptions({controlsEnabled:!1}),on&&(Ut.set(-16.7,1.17,11.7),Gt.set(0,1.37,0),b.contentRef.current.className="mobile-or-tablet"),window.scrollTo(0,0);let $t=!0;const un=()=>{$t=!0,Ht.setDirty()};Ht.addEventListener("preFrame",()=>{$t&&(cn.positionTargetUpdated(!0),$t=!1)}),nn(Ut,Gt,on,un)},[]);reactExports.useEffect(()=>{Lt()},[]);const Nt=reactExports.useCallback(()=>{qt.current.style.pointerEvents="none",b.contentRef.current.style.opacity=1,d.scene.activeCamera.setCameraOptions({controlsEnabled:!1}),jt(!1),gsapWithCSS.to(kt,{x:Kt?9.36:1.56,y:Kt?10.95:5,z:Kt?.09:.01,scrollTrigger:{trigger:".display-section",start:"top botttom",end:"top top",scrub:2,immediateRender:!1},onUpdate:()=>{d.setDirty(),_t.positionTargetUpdated(!0)}}),gsapWithCSS.to(at,{x:Kt?-1.62:-.55,y:Kt?1:.32,z:Kt?-.06:0,scrollTrigger:{trigger:".display-section",start:"top botttom",end:"top top",scrub:2,immediateRender:!1}})},[qt,d,kt,_t,at]);return React.createElement("div",{id:"webgi-canvas-container",ref:qt},React.createElement("canvas",{id:"webgi-canvas",ref:j}),zt&&React.createElement("button",{className:"button",onClick:Nt},"Exit"))}),logo="/assets/logo-4c5a80d0.svg",search="/assets/search-963383a4.svg",store="/assets/store-ca9861af.svg",Nav=()=>React.createElement("nav",{className:"nav-wrapper"},React.createElement("div",{className:"nav-content"},React.createElement("ul",{className:"list-styled"},React.createElement("li",null,React.createElement("img",{src:logo,alt:"Apple"})),React.createElement("li",null,React.createElement("button",{className:"link-styled"},"Store")),React.createElement("li",null,React.createElement("button",{className:"link-styled"},"Mac")),React.createElement("li",null,React.createElement("button",{className:"link-styled"},"Iphone")),React.createElement("li",null,React.createElement("button",{className:"link-styled"},"Ipod")),React.createElement("li",null,React.createElement("button",{className:"link-styled"},"Watch")),React.createElement("li",null,React.createElement("button",{className:"link-styled"},"Airpods")),React.createElement("li",null,React.createElement("button",{className:"link-styled"},"TV & Home")),React.createElement("li",null,React.createElement("button",{className:"link-styled"},"Entertainment")),React.createElement("li",null,React.createElement("button",{className:"link-styled"},"Accessories")),React.createElement("li",null,React.createElement("button",{className:"link-styled"},"Support")),React.createElement("li",null,React.createElement("img",{src:search,alt:"search"})),React.createElement("li",null,React.createElement("img",{src:store,alt:"store"}))))),holdingIphone="/assets/iphone-hand-83782827.png",Jumbotron=()=>{const b=()=>{const g=document.querySelector(".sound-section");g&&g.scrollIntoView({behavior:"smooth"})};return React.createElement("div",{className:"jumbotron-section wrapper"},React.createElement("h2",{className:"title"},"New"),React.createElement("h3",{className:"title-header"},"iPhone 15 Pro"),React.createElement("p",{className:"text"},"Big & Bigger"),React.createElement("span",{className:"description"},"From $1,000.00/mo or $22.00 before trade-in"),React.createElement("ul",{className:"links"},React.createElement("li",null,React.createElement("button",{className:"button"},"Buy")),React.createElement("li",null,React.createElement("button",{className:"link",onClick:()=>{b()}},"Learn More"))),React.createElement("img",{className:"iphone-img",src:holdingIphone,alt:"iPhone"}))},SoundSection=()=>{const b=()=>{const g=document.querySelector(".display-section");g&&g.scrollIntoView({behavior:"smooth"})};return React.createElement("div",{className:"sound-section wrapper"},React.createElement("div",{className:"body"},React.createElement("div",{className:"sound-section-content content"},React.createElement("h2",{className:"title"},"New Sound System"),React.createElement("p",{className:"text"},"Feel The Base."),React.createElement("span",{className:"description"},"From $1,000.00/mo or $22.00 before trade-in"),React.createElement("ul",{className:"links"},React.createElement("li",null,React.createElement("button",{className:"button"},"Buy")),React.createElement("li",null,React.createElement("button",{className:"link",onClick:()=>{b()}},"Learn More"))))))},DisplaySection=({triggerPreview:b})=>{const g=()=>{const j=document.getElementById("top");j&&j.scrollIntoView({behavior:"smooth"})};return React.createElement("div",{className:"display-section wrapper"},React.createElement("h2",{className:"title"},"New"),React.createElement("p",{className:"text"},"Brilliant"),React.createElement("span",{className:"description"},"A display that's up to 2x brighter in the sun"),React.createElement("button",{className:"button",onClick:()=>{b()}},"Try Me!"),React.createElement("button",{className:"back-button",onClick:()=>{g()}},"Top"))};function App(){const b=reactExports.useRef(),g=reactExports.useRef(),j=()=>{b.current.triggerPreview()};return React.createElement(React.Fragment,null,React.createElement("div",{id:"top"}),React.createElement("div",{className:"App"},React.createElement(Loader,null),React.createElement("div",{id:"content",ref:g},React.createElement(Nav,null),React.createElement(Jumbotron,null),React.createElement(SoundSection,null),React.createElement(DisplaySection,{triggerPreview:j})),React.createElement(WebgiViewer,{contentRef:g,ref:b})))}client.createRoot(document.getElementById("root")).render(React.createElement(App,null));
